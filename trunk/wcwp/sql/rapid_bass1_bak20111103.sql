

/**
标志位	FLAG	INTEGER		
0   运行完成 1   正在运行
-1  运行出错 -2  重新运行 
**/

--int(replace(char(current date - 1 days),'-',''))

 db2 "load client from \
 /bassapp/bihome/panzw/tmp/02054.txt of del  \
 modified by coldel$  fastparse anyorder warningcount 1000 \
  replace into G_A_02054_DAY_DOWN
"

select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_04002_DAY_BAK'
G_S_04002_DAY	95829.84 635661807
G_S_04002_DAY	49864.68 330794180

rename bass1.G_S_04002_DAY to bass1.G_S_04002_DAY_BAK
rename BASS1.G_S_04002_DAY to BASS1.G_S_04002_DAY_BAK
select * from
BASS1.G_S_04002_DAY

rename BASS1.G_S_04002_DAY to G_S_04002_DAY_BAK
 create table BASS1.G_S_04002_DAY like BASS1.G_S_04002_DAY_BAK 
     DISTRIBUTE BY HASH(TIME_ID,  
                 PRODUCT_NO,  
                 ROAM_LOCN,  
                 ROAM_TYPE_ID,  
                 APNNI,  
                 START_TIME)   
     IN TBS_APP_BASS1 INDEX IN TBS_INDEX 

	  insert into BASS1.G_S_04002_DAY 
	  select * from  BASS1.G_S_04002_DAY_BAK
	  where time_id >= 20101101       

--RUNSTATS ON table BASS1.ALL_DIM_LKP 	with distribution and detailed indexes all  
--runstats on table bass1.G_S_04002_DAY with distribution and detailed indexes all            
select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_21003_MONTH'

select * from bass1.G_S_04002_DAY_bak
select tabname , card from syscat.tables where tabname in ('G_S_04002_DAY','G_S_04002_DAY_BAK')            
AND tabschema = 'BASS1'
SELECT COUNT(0) FROM BASS1.G_S_04002_DAY_BAK

--告警 alarm

select * from  app.sch_control_alarm 
where alarmtime >=  timestamp('20110311'||'000000') 
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 

select * from syscat.functions where funcname = 'FN_GET_ALL_DIM'

select * from   BASS1.ALL_DIM_LKP 

select count(0),count(distinct user_id)  from   bass1.g_a_02004_day

bass1.fn_get_all_dim

BODY
CREATE FUNCTION BASS1.FN_GET_ALL_DIM(GID VARCHAR(20),DID VARCHAR(20)) RETURNS VARCHAR(10) DETERMINISTIC NO EXTERNAL ACTION LANGUAGE SQL BEGIN ATOMIC RETURN SELECT BASS1_VALUE FROM BASS1.ALL_DIM_LKP WHERE BASS1_TBID = GID AND XZBAS_VALUE = DID END



select * from  table( bass1.get_before('02004')) a 
select * from  table( bass1.get_after('BASS1_INT_CHECK_Z345_DAY.tcl')) a 

select * from syscat.tables
select * from app.sch_control_runlog 
where control_code = 'TR1_VGOP_D_14303'
 select * from app.sch_control_runlog
 
 select * from app.sch_control_alarm
 select min(deal_time) from APP.G_FILE_REPORT where length(deal_time)=14
 select substr(deal_time,1,6) , count(0)
 from app.g_file_report 
 group by substr(deal_time,1,6)
 
 select tabname from syscat.tables where tabschema = 'BASS1'
and tabname like 'G_%' 
 select * from app.sch_control_map
 where module = 2 
 
 
 select * from
 BASS1.G_USER_LST
 
 select * from BASS2.ETL_TASK_LOG where task_id in ( 'I11101')
and cycle_id='20110228'

select * from APP.G_RUNLOG
where unit_code = '03004'


select * from
APP.G_FILE_REPORT_ERR

select * from
APP.G_REC_REPORT_ERR



select * from
app.g_file_report where deal_time like '%20110301%'
and err_code = '00'


select * from  bass1.G_S_22073_DAY


select  * 
--distinct left(right(filename,16),5),err_code 
from APP.G_FILE_REPORT
where filename like '%_201103_%' 
and err_code='00'


select * from app.g_runlog 
where time_id=20110117
and return_flag=1



select count(0)
select min(deal_time)
from app.g_file_report
where deal_time > '19990412211032'


select  * 
--distinct left(right(filename,16),5),err_code 
from APP.G_FILE_REPORT
where filename like '%_201103_%' 
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
order by deal_time desc

select * from 
bass1.g_rule_check where rule_code = '56'
ORDER BY 1 DESC 







select 
 time_id,
 case when rule_code='R159_1' then '新增客户数'
      when rule_code='R159_2' then '客户到达数'
      when rule_code='R159_3' then '上网本客户数'
      when rule_code='R159_4' then '离网客户数'
 end,
 target1,
 target2,
 target3
from bass1.g_rule_check
where rule_code in ('R159_1','R159_2','R159_3','R159_4')
  and time_id=20110301
  
select * from    bass1.g_rule_check where rule_code='R172' and target3 > 0.4
order by 1 desc 


select count(0) from 
select count(0) from
bass1.G_S_21003_TO_DAY
  
select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_21003_TO_DAY'

select tbsp_id,substr(tbsp_name,1,30) tbsp_name,TBSP_UTILIZATION_PERCENT from SYSIBMADM.TBSP_UTILIZATION order by tbsp_id,dbpartitionnum

select * from syscat.tables where tabname like '%04005%'
and tabschema = 'BASS1'

G_S_04005_DAY


select * from  BASS1.G_S_04005_DAY 


select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_04005_DAY'

    rename BASS1.G_S_04005_DAY to G_S_04005_DAY_BAK

    create table BASS1.G_S_04005_DAY like BASS1.G_S_04005_DAY_BAK 
                 DISTRIBUTE BY HASH(TIME_ID,  
                 PRODUCT_NO,  
                 SP_CODE,  
                 OPPOSITE_NO)   
                   IN TBS_APP_BASS1 INDEX IN TBS_INDEX NOT LOGGED INITIALLY

	  insert into BASS1.G_S_04005_DAY 
	  select * from  BASS1.G_S_04005_DAY_BAK
	  where time_id >= 20101001

select tabname , card from syscat.tables where tabname in ('G_S_04005_DAY','G_S_04005_DAY_BAK')            
AND tabschema = 'BASS1'
select time_id,count(0) cnt 
from BASS1.G_S_04005_DAY
group by  time_id
                 
select tabname , card from syscat.tables where tabname in ('G_S_04005_DAY','G_S_04005_DAY_BAK')            
AND tabschema = 'BASS1'
select * from BASS1.G_S_04005_DAY
                 
drop table BASS1.G_S_04005_DAY_BAK


select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_21003_MONTH'

select * from  bass1.G_S_21003_MONTH 

select TIME_ID , count(0) 
--, count(distinct TIME_ID ) 
from bass1.G_S_21003_MONTH 
group by  TIME_ID 
order by 1 

SQL0911N

select * from
g_s_04003_day

select count(distinct WLAN_ATTESTATION_CODE)
from BASS1.G_S_04005_DAY
where time_id between 20101201 and 20101231 
and

select * from bass2.dim_roam_type

			
select count(0),count(distinct WLAN_ATTESTATION_CODE)
from BASS1.G_S_04003_DAY
where time_id between 20101201 and 20101231 
and ROAM_TYPE_ID in ('500','110')

select *  
from BASS1.G_S_04003_DAY
where time_id between 20101201 and 20101231 
and ROAM_TYPE_ID in ('500','110')

select * from app.sch_control_before 
where control_code like '%21007%'

BASS1_EXP_G_I_03007_MONTH	BASS1_G_I_03007_MONTH.tcl
BASS1_EXP_G_I_03007_MONTH	BASS1_INT_CHECK_F7_MONTH.tcl
BASS1_EXP_G_I_03007_MONTH	BASS1_INT_CHECK_R028_MONTH.tcl
BASS1_EXP_G_I_03007_MONTH	BASS1_INT_CHECK_R029_MONTH.tcl

select * from app.sch_control_before 
where control_code = 'BASS1_INT_CHECK_R029_MONTH.tcl'


select * from app.sch_control_task 
where control_code = '%bak%'


select * from
APP.G_UNIT_INFO 

select * from APP.G_RUNLOG  order by 1 desc 

select * from bass1.g_bus_check_all_day

select * from bass1.g_bus_check_bill_month


select count(distinct HOTSPOT_AREA_ID)
from BASS1.G_S_04003_DAY
where time_id between 20101201 and 20101231 
and ROAM_TYPE_ID in ('500','110')


select distinct HOTSPOT_AREA_ID
from BASS1.G_S_04003_DAY
where time_id between 20101201 and 20101231 
and ROAM_TYPE_ID in ('500','110')


select * from   bass2.DW_ENTERPRISE_MEMBER_201102 where enterprise_id = '89103000041929'
select * from   bass2.DW_ENTERPRISE_MEMBER_HIS_201102 where enterprise_id = '89103000041929'
select * from   bass2.DW_ENTERPRISE_MEMBER_MID_20110323 where enterprise_id = '89103000041929'

select * from    bass2.DW_ENTERPRISE_SUB_DS
where ENTERPRISE_ID = '89103000041929'

select count(0),count(distinct enterprise_id) from   bass2.DW_ENTERPRISE_MEMBER_201012
select count(0),count(distinct enterprise_id) from   bass2.DW_ENTERPRISE_MEMBER_HIS_201012
select count(0),count(distinct enterprise_id) from   bass2.DW_ENTERPRISE_MEMBER_MID_201012

select * from bass2.CDR_WLAN_20100304
select * from  BASS1.G_S_04003_DAY

select count(distinct HOTSPOT_AREA_ID)
from BASS1.G_S_04003_DAY
where 
--time_id between 20101201 and 20101231 
--and 
ROAM_TYPE_ID in ('500','110')

select tabname,card  from syscat.tables where tabname like '%WLAN%'

SELECT * FROM app.sch_control_task where function_desc like '%WLAN%'

select * from G_I_02016_MONTH
select * from bass2.Dw_newbusi_wlan_20110302



select distinct HOTSPOT_AREA_ID
select *from BASS1.G_S_04003_DAY
where ROAM_TYPE_ID in ('500','110')

select min(time_id) 
from BASS1.G_S_04003_DAY


select * from BASS1.G_S_04003_DAY
where product_no not like '1%'

select  count(product_no),count(distinct product_no),count(distinct enterprise_id),count(distinct product_no||enterprise_id)
from  bass2.DW_ENTERPRISE_MEMBER_MID_201012

select sum(int(flowup)+int(flowdown))/1024 
from (
select a.product_no,a.HOTSPOT_AREA_ID,b.enterprise_id,c.ENTERPRISE_NAME
,a.flowup,a.flowdown,a.call_fee,a.info_fee,a.CALL_DURATION
from (select * from BASS1.G_S_04003_DAY 
        where time_id between 20101201 and 20101231 
        and ROAM_TYPE_ID in ('500','110')	
) a
left join  (select distinct enterprise_id,product_no 
            from bass2.DW_ENTERPRISE_MEMBER_MID_201012
            ) b 
            on a.product_no = b.product_no
left join   bass2.dw_enterprise_msg_201012 c 
            on b.enterprise_id = c.enterprise_id
) t 
where enterprise_id is not null


select max(time_id) from g_s_05001_month
select * from g_s_05001_month

select time_id,count(0) from g_s_05002_month
group by time_id




select tabname from syscat.tables where tabname like '%05002%'

select time_id,count(0)
from G_S_05001_MONTH
group by time_id 


select * from app.sch_control_task where control_code = 'BASS1_EXP_G_S_03005_MONTH'

select count(0) from G_A_02052_MONTH where time_id = 201109

select time_id,count(0)
from G_A_02052_MONTH
group by time_id



select * from APP.SCH_CONTROL_ALARM  
where control_code like '%local_busi%'

where flag in(1,-1) and control_code like 'BASS1_INT_CHECK_INDEX_WAVE_DAY.tcl%'
and date(alarmtime) = '2011-03-05'

CONTENT
R161_1 15%
R161_7 TD5%
R161_9 TD5%
R161_10 TD5%
R161_13 8%
R161_14 8%


select * from bass1.g_rule_check where rule_code in ('R161_1') order by time_id desc

select * from g_file_report

select * from app.g_runlog 


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 

select time_id, length(user_id),count(0)
from bass1.g_user_lst
group by  time_id,length(user_id)
order by 1 desc , 2 desc 

select * from    bass1.g_user_lst
where length(user_id)= 11
and time_id = 201107

select * from syscat.tables where tabname like '%22012%'

select * from G_S_22012_DAY
order by time_id desc 


select count(0) from APP.SMS_SEND_INFO

select * from APP.SMS_SEND_INFO fetch first 10 rows only  


select * from   APP.SMS_SEND_INFO
order by message_id desc 

select send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num = '15913269062'
order by send_time desc 


insert into APP.SMS_SEND_INFO(MESSAGE_CONTENT,MOBILE_NUM) 
select 'test','15913269062'
from bass2.dual

select * from bass1.mon_user_mobile

select * from    bass1.T_GS05001M

 select * from      bass1.T_GS05001M
 
 select * from bass1.T_GS05001M
 

select * from   bass1.g_s_05001_month where time_id = 201012
except
select * from bass1.T_GS05001M


CREATE TABLE "BASS1   "."T_GS05002M"  (
                  "TIME_ID" INTEGER , 
                  "BILL_MONTH" CHAR(6) , 
                  "SELF_CMCC_CODE" CHAR(5) , 
                  "SELF_SVC_BRND_ID" CHAR(1) , 
                  "OTHER_CMCC_CODE" CHAR(6) , 
                  "OTHER_SVC_BRND_ID" CHAR(6) , 
                  "IN_COUNT" CHAR(12) , 
                  "OUT_COUNT" CHAR(12) , 
                  "STLMNT_FEE" CHAR(12) , 
                  "PAY_STLMNT_FEE" CHAR(12) )   
                 DISTRIBUTE BY HASH("TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY  

select * from   g_s_05002_month where time_id = 201012
except
select * from T_GS05002M

select count(0) from app.sch_control_alarm
where control_code like 'BASS1%'
select * from app.sch_control_task where upper(cmd_line) like '%BASS1%SH%'

SCH_CONTROL_TASK


select CONTROL_CODE,'bass1_lst.sh',1,'${ALARM_CONTENT}',current timestamp,-1 
from app.SCH_CONTROL_TASK where upper(replace(CMD_LINE,' ',''))=upper('bass1_lst.sh')

 select * from app.sch_control_groupinfo
 
 dmk	BI-M01-01-MARKDB	2011-03-08 16:53:42.240912
olap_load	BI-M02-01-OLAP	2011-03-08 16:53:41.055375
app	BI-M02-01-OLAP	2011-03-08 16:53:42.407528


select mobile_num,count(0)
 from app.sms_send_info
 group by mobile_num
 


select * from SYS_TASK_RUNLOG

select * from syscat.tables where tabname like '%RUNLOG%'

select * from SYS_TASK_RUNLOG


select a.custstatus_id,coalesce(bass1.fn_get_all_dim('BASS_STD1_0028',char(a.custstatus_id)),'20') as custstatus_id 
from bass2.dwd_cust_msg_20110310 a

select * from 


select * from BASS1.ALL_DIM_LKP 


select time_id,count(0)
from G_A_02004_DAY
where time_id >= 20110101
group by time_id 
order by 1 desc 



select * from G_A_02004_DAY


select count(distinct user_id) from G_A_02004_DAY with ur
-- =2088474
select count(distinct user_id) from G_A_02008_DAY with ur

2088474


select * from   product_xhx

select * from 

select * from bass1.G_REPORT_CHECK


SELECT sum(bigint(BILLING_CAT_OF_WAP_INFO))
                  FROM BASS1.G_S_04006_DAY
                 WHERE TIME_ID/100=201102
1118057
                 
SELECT sum(bigint(INFO_FEE))
                  FROM BASS1.G_S_04006_DAY
                 WHERE TIME_ID/100=201102

5621188

select * from   app.sch_control_task where control_code like '%CHECK%MONTH%'

select * from   BASS1.G_S_04006_DAY

select * from    bass2.tmp_zcg
select * from app.SYS_TASK_RUNLOG


select * from bass2.dw_product_ins_off_ins_prod_201102
where product_instance_id='89157333132742'
  and offer_id=111099001926
                
select * from   bass1.g_s_22012_day
                
SELECT * FROM BASS2.ETL_TASK_LOG
                
select * from   app.sch_control_task where control_code like '%00000%'                

select * from   bass1.G_BUS_CHECK_BILL_MONTH

select * from   app.sch_control_task

select * from   app.sch_control_task where function_desc like '%作废%'
and control_code like 'BASS1%'
select * from   app.sch_control_task where cmd_type = 1



select cmd_type , count(0) , count(distinct cmd_type ) 
from app.sch_control_task 
group by  cmd_type 
order by 1 

select * from   APP.SCH_PERSON_PHONE

select userid , count(0) , count(distinct userid ) 
from APP.SCH_PERSON_PHONE 
group by  userid 
order by 1 

select * from   app.sch_control_groupinfo
select * from   app.sch_control_mogrpinfo




BASS2.ETL_SEND_MESSAGE

select * from BASS2.ETL_SEND_MESSAGE where phone_id = '13989094821'



select       
c.MO_GROUP_DESC,--模块名
count( case when date(current timestamp)<>date(b.begintime)  and  b.flag=0 or b.flag=-2 then a.control_code end ) not_run_cnt,--未完成数
count( case when   b.flag=1  then a.control_code end ) running_cnt,--执行数
count( case when   b.flag=-1 then a.control_code end ) run_err_cnt, --执行出错
count( case when date(current timestamp)=date(b.begintime)    and  b.flag=0 then a.control_code end ) done_cnt	--完成数
from APP.SCH_CONTROL_TASK a,
      APP.SCH_CONTROL_RUNLOG  b,
      APP.SCH_CONTROL_MOGRPINFO  c
where  a.CONTROL_CODE=b.CONTROL_CODE  
   and a.MO_GROUP_CODE = c.MO_GROUP_CODE 
   and a.deal_time in (2)
group by c.MO_GROUP_DESC,c.sort_id
order by c.sort_id
with ur	


select deal_time , count(0) , count(distinct deal_time ) 
from app.sch_control_task 
group by  deal_time 
order by 1 


select deal_time , count(0) 
--,  count(distinct deal_time ) 
from app.sch_control_task 
group by  deal_time 
order by 1 

select * from   app.sch_control_task  where deal_time = 3


select a.*,b.*
from APP.SCH_CONTROL_TASK a,
      APP.SCH_CONTROL_RUNLOG  b,
      APP.SCH_CONTROL_MOGRPINFO  c
where  a.CONTROL_CODE=b.CONTROL_CODE  
   and a.MO_GROUP_CODE = c.MO_GROUP_CODE 
   and a.deal_time in (2)
   and (date(current timestamp)<>date(b.begintime)  and  b.flag=0 or b.flag=-2)
   and c.MO_GROUP_DESC = '一经程序'
order by c.sort_id
with ur	



select       
a.MO_GROUP_CODE,
c.MO_GROUP_DESC,
a.CONTROL_CODE,
a.CMD_LINE,
a.FUNCTION_DESC,
case  when date(current timestamp)<>date(b.begintime)  and  b.flag=0 or b.flag=-2 then '未完成' 
      when   b.flag=1   then '执行中'
      when   b.flag=-1  then '执行出错'
      when   date(current timestamp)=date(b.begintime) and  b.flag=0 then '完成'
      else  '未知'
end,
b.*
from  APP.SCH_CONTROL_TASK a,
      APP.SCH_CONTROL_RUNLOG  b,
      APP.SCH_CONTROL_MOGRPINFO  c
where  a.CONTROL_CODE=b.CONTROL_CODE  
   and a.MO_GROUP_CODE = c.MO_GROUP_CODE 
   and a.deal_time in (1)
   and a.MO_GROUP_CODE = 'BASS1'
order by c.sort_id
with ur




select count(0),count(distinct ENTERPRISE_ID) 
select t2.*
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from G_A_02055_DAY where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1340'
) t 
) t2 where rn = 1 

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110301
and MANAGE_MODE = '2'
and STATUS_ID ='1'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 




select * from g_a_02059_day a
where TIME_ID < 20110301
and MANAGE_MODE = '2'
and STATUS_ID ='1'
and ENTERPRISE_BUSI_TYPE ='1340'

select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'





select t2.*
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 





select * from g_a_02059_day where ENTERPRISE_BUSI_TYPE = '1040'


select count(0),count(distinct ENTERPRISE_ID) 
select count(0)
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 



select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from g_a_02054_day 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 


select * from   g_a_02059_day



select tabname from   syscat.tables where tabname like '%ENTERPRISE_MEMBER_MID%'

select '20110313',a.ENTERPRISE_ID,a.USER_ID,'1340','2','20110313','1' from   bass2.DW_ENTERPRISE_MEMBER_MID_20110313


select * from   bass2.DW_ENTERPRISE_msg_20110313
where ENTERPRISE_ID in (
select distinct ENTERPRISE_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from G_A_02055_DAY where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1340'
) t 
) t2 where rn = 1 
)


select * from   bass2.DW_ENTERPRISE_msg_20110313
where ENTERPRISE_ID in (
select distinct ENTERPRISE_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 


select * from   bass2.DW_ENTERPRISE_msg_20110313
where ENTERPRISE_ID in (
select  distinct ENTERPRISE_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 
)


select * from   app.sch_control_task where control_code like '%02031%'

--1040	无线商务电话	
select * from    g_a_02059_day  where ENTERPRISE_BUSI_TYPE = '1040'
--02054	集团客户业务订购关系
select * from   g_a_02054_day where  ENTERPRISE_BUSI_TYPE = '1040'

select * from  bass2.dw_enterprise_msg_201102 where enterprise_id = '89100000000705'

select * from   

select * from bass1.ALL_DIM_LKP_160 c  where bass1_tbid='BASS_STD1_0108'
and C.BASS1_VALUE  in ('1230','1241','1249','1220','1320','1040')

select * from bass2.dim_enterprise_product
where service_name like  '%话%'

select * from app.sch_control_before
where control_code = 'BASS1_G_A_02059_DAY.tcl'

select * from app.sch_control_before
where control_code = 'BASS2_Dw_enterprise_extsub_rela_ds.tcl'

select * from app.sch_control_before
where control_code in (
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code = 'BASS2_Dw_enterprise_extsub_rela_ds.tcl'
)

select * from app.sch_control_before
where control_code
in (
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code in (
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code = 'BASS2_Dw_enterprise_extsub_rela_ds.tcl'
)
)

select * from app.sch_control_before
where control_code
in
(
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code
in (
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code in (
select BEFORE_CONTROL_CODE from app.sch_control_before
where control_code = 'BASS2_Dw_enterprise_extsub_rela_ds.tcl'
)
)
)


select * from app.sch_control_before
where control_code like '%enterprise%'


select * from app.sch_control_before
where before_control_code like '%BASS2_Dw_product_ds.tcl%'

BASS1_G_A_02059_DAY.tcl	BASS2_Dw_enterprise_extsub_rela_ds.tcl

select * from app.sch_control_task
where control_code like '%w_product%'

insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS2_Dw_product_regsp_ds.tcl')
insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS1_G_A_02054_DAY.tcl')
insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS2_Dw_product_ds.tcl')
insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS2_Dw_enterprise_member_mid_ds.tcl')
insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS2_Dw_enterprise_msg_ds.tcl')
commit



select * from   app.sch_control_task where upper(control_code) like '%02054%'

BASS2_Dw_enterprise_member_mid_ds.tcl
dw_enterprise_member_mid_yyyymmdd


BEFORE_CONTROL_CODE
BASS2_Dw_enterprise_sub_ds.tcl
BASS2_Dw_enterprise_membersub_ds.tcl
BASS2_Dw_product_ds.tcl


select * from app.sch_control_before
where control_code = 'BASS2_Dw_enterprise_extsub_rela_ds.tcl'


select * from   app.sch_control_task where upper(control_code) like '%DW_PRODUCT_REGSP_DS%'

DW_PRODUCT_REGSP_DS



BASS1_G_A_02059_DAY.tcl	BASS2_Dw_enterprise_extsub_rela_ds.tcl

select * from G_A_02059_DAY_0315modify
except
select * from   G_A_02059_DAY


select '20110314'
											 ,a.enterprise_id
											 ,b.user_id
											 ,'1040'
											 ,'3'
											 ,'20110314'
											 ,a.status_id
								from 	bass1.g_a_02054_day a,
								      bass2.dw_enterprise_member_mid_20110314 b,
								      bass2.dw_enterprise_msg_20110314 c,
								      bass2.dw_product_20110314 d
								where a.enterprise_id=b.enterprise_id
								  and a.enterprise_id=c.enterprise_id
								  and b.user_id=d.user_id
								  and d.usertype_id in (1,2,3,6)
								  and a.enterprise_busi_type='1040'
								  and a.time_id=20110314
								  and a.status_id='1'



select 20110314
											 ,a.enterprise_id
											 ,b.user_id
											 ,'1040'
											 ,'3'
											 ,'20110314'
											 ,a.status_id
								from 	bass1.g_a_02054_day a,
								      (select distinct enterprise_id,user_id 
								        from BASS1.G_A_02059_DAY 
								       where enterprise_busi_type='1040' 
								         and time_id<20110314) b
								where a.enterprise_id=b.enterprise_id
								  and a.time_id=20110314
								  and a.enterprise_busi_type='1040'
								  and a.status_id='2'
                                  
select A.*,char(a.RUNTIME/60)||'min',char(a.RUNTIME/60/60)||'hr' from   app.sch_control_runlog A
where control_code like 'BASS1%'
and a.RUNTIME/60 > 10
ORDER BY RUNTIME DESC 


select * from   g_s_02059_day

                                  
                                  
select * from g_a_02059_day
where time_id = 20110315
and ENTERPRISE_BUSI_TYPE = '1040'

select * from   g_a_01004_day


select * from   BASS2.DW_ENTERPRISE_ACCOUNT_20110315

select * from   bass2.dwd_cust_msg_20110315
select a.CUSTTYPE_ID, a.* from   bass2.dwd_cust_msg_20110315 a

select * from   app.sch_control_runlog where control_code like '%01004%'                                  

select count(0)
from (
 select distinct a.enterprise_id from
   (select time_id,enterprise_id,cust_statu_typ_id from bass1.G_A_01004_DAY where time_id <= 20110301 ) a,
   (select enterprise_id,max(time_id) as time_id  from bass1.G_A_01004_DAY 
                                                 where time_id<=20110301
                                              group by enterprise_id) b
where a.time_id=b.time_id and a.enterprise_id=b.enterprise_id and a.cust_statu_typ_id = '20'
) t

10:04 9075
select count(0)
from (
select distinct t.enterprise_id
from 
(
select time_id,enterprise_id,cust_statu_typ_id ,row_number()over(partition by enterprise_id order by time_id desc) rn 
from bass1.G_A_01004_DAY 
where time_id <= 20110301 
) t where t.rn = 1 and  cust_statu_typ_id = '20'
) tt 


10537


select enterprise_id,max(time_id) as time_id  from bass1.G_A_01004_DAY 
                                                 where time_id<=20110301
                                              group by enterprise_id
                                              
select  from   G_A_02004_DAY

select count(0) from   G_A_02062_DAY where char(time_id) like '201102%'

select count(0),count(distinct user_id) from   G_A_02062_DAY where time_id < 20110301 and time_id >= 20110201


02004



select time_id,count(0) from    G_A_02051_DAY
group by time_id
order by 1 desc 

select count(0),count(distinct user_id ) from    G_A_02004_DAY

select a.brand_id, count(0),count(distinct a.user_id) from  
(select user_id,BRAND_ID from G_A_02004_DAY  where SIM_CODE = '1' and USERTYPE_ID = '1') a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where a.user_id = b.user_id 
group by a.brand_id

2	5190

2	6438	4663


(select user_id,BRAND_ID ,row_number()over(partition by )
from G_A_02004_DAY  
where SIM_CODE = '1' and USERTYPE_ID = '1') a 


4622

6438
time_id <20110301

select * from   bass1.G_A_02062_DAY 

select count(0),count(distinct user_id ) from     bass1.G_A_02062_DAY 

char(time_id) like '201102%'



select SIM_CODE ,BRAND_ID, count(0) 
,  count(distinct USER_ID ) 
from bass1.G_A_02004_DAY 
group by  SIM_CODE ,BRAND_ID
order by 1 





declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110431 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110431 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')

commit


select product_no,count(0) 
from  session.int_check_user_status 
group by product_no having count(0) > 1

select product_no,count(0) 
from  session.int_check_user_status where 
usertype_id not in ('2010','2020','2030','9000')
group by product_no having count(0) > 1



select a.sim_code,a.brand_id, count(0),count(distinct a.user_id) from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'
group by a.sim_code,a.brand_id
order by 1,2



4622

2   	4622	4622
	7610	2658	193	7	2858		4622		4622	7480	130


select a.sim_code,a.brand_id, count(0),count(distinct a.user_id) from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'
group by a.sim_code,a.brand_id
order by 1,2



select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1'
 
 select count(0),count(distinct user_id ) from   G_A_02062_DAY
 where time_id <20110301
 and STATUS_ID = '1'
 
 7610
 
 select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'

 
 select * from  G_A_02062_DAY where user_id = '89460000193920'
 select * from  session.int_check_user_status where user_id = '89460000193920'
 
  select * from  session.int_check_user_status where user_id
  in (select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0')
 
 
 select * from  G_A_02062_DAY
 where user_id = '89657334067011'
 select OP_TIME,count(0) from  
 bass2.DW_ENTERPRISE_SUB_ds
 group by 
 OP_TIME
 
 select count(0) from  bass2.DW_ENTERPRISE_SUB_ds
 bass2.DW_ENTERPRISE_SUB_201011
 select * from  bass2.DW_ENTERPRISE_SUB_201011
where user_id = '89657334067011'

 select count(0) from  bass2.DW_ENTERPRISE_SUB_201102
 


select * from   bass2.dw_product_20110314
where user_id = '89657334067011'
13638968395
89657334067011	89603001340010	89601002853991	100	6	0	0	1	0	0	[NULL]	13638968395	460008961120700	[NULL]	[NULL]	896	896	1059	10590005	96011006	4	[NULL]	300001911090	0	279	10	1	1	10	101	89610012	5	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	2010-02-24 	2010-05-25 	2010-11-29 	2010-11-29 	0	0	0	0	0.00	0.00	0.00	0.00	0	0	0	0	0.00	0.00	0.00	0.00	0.00	0.00

 89657334067011 	13638968395    	0	0              	2020	20100224       	1   	20101129
89657334006049 	13638960960    	0	0              	2020	20100118       	1   	20101130


 select * from  session.int_check_user_status where user_id
  in 
  ('89157333603327'
,'89257332979496'
,'89257332980422'
,'89457332326899'
,'89460000193947'
,'89560000363718'
,'89560000363941'
,'89657334006210'
,'89157334021842'
,'89257332979460'
,'89257332980702'
,'89257333374671'
,'89457333600524'
,'89460000193798'
,'89460000339034'
,'89560000363916'
,'89560000363965'
,'89657333802412'
,'89157332844445'
,'89257332979510'
,'89360000266593'
,'89457332319392'
,'89457333729869'
,'89460000193999'
,'89560000363735'
,'89560000363905'
,'89657333043867'
,'89657333685357'
,'89657333695270'
,'89157332768972'
,'89157333603386'
,'89257332980520'
,'89257332980594'
,'89360000266440'
,'89360000266468'
,'89457333386157'
,'89460000193789'
,'89460000270137'
,'89560000363897'
,'89657333689064'
,'89157333346941'
,'89157333942045'
,'89257332979480'
,'89360000266538'
,'89360000266610'
,'89360000266686'
,'89460000193802'
,'89560000363758'
,'89657333802374'
,'89657334006049'
,'89657334067011'
,'89360000266456'
,'89360000266532'
,'89457332240376'
,'89457333035055'
,'89460000193749'
,'89657333688890'
,'89701170013122'
,'89457333038292'
,'89460000193714'
,'89560000363747'
,'89560000363894'
,'89657333685472'
,'89157332834451'
,'89157333603404'
,'89360000266628'
,'89460000193679'
,'89460000193777'
,'89460000193932'
,'89460000221143'
,'89657333695116'
,'89157332768979'
,'89157332993008'
,'89157332994577'
,'89357333334596'
,'89457332341379'
,'89460000193825'
,'89657333693001'
,'89157334002261'
,'89157334021848'
,'89360000266437'
,'89360000266524'
,'89457332341392'
,'89457333038299'
,'89460000194023'
,'89560000363859'
,'89657333043881'
,'89657334037819'
,'89157332826412'
,'89360000266462'
,'89360000266559'
,'89460000193616'
,'89460000193810'
,'89657333562860'
,'89757334249044'
,'89157332993069'
,'89157333346957'
,'89157333942188'
,'89460000193858'
,'89657333696722'
,'89657333832637'
,'89157332895961'
,'89157333603323'
,'89157333942125'
,'89360000266273'
,'89457333338562'
,'89560000363911'
,'89657333295749'
,'89657333736478'
,'89157333346922'
,'89157333872113'
,'89360000266286'
,'89360000266674'
,'89360000266703'
,'89460000193774'
,'89460000193920'
,'89460000193937'
,'89460000193954'
,'89560000363769'
,'89560000363789'
,'89657334006083'
,'89757334252690'
,'89157333942117'
,'89157334021855'
,'89357333334573'
,'89360000266167'
,'89360000266306'
,'89360000266516'
,'89560000363889'
,'89657333800018')
order by 3


 select count(0) from  bass2.DW_ENTERPRISE_SUB_ds





declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110231 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110231 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
commit


select a.sim_code,a.brand_id, count(distinct a.user_id) user_cnt from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'
group by a.sim_code,a.brand_id
order by 1,2


select case when a.sim_code = '1' then '数据SIM卡用户' else '非数据SIM卡用户' end 
,a.brand_id, count(distinct a.user_id) user_cnt from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'
group by case when a.sim_code = '1' then '数据SIM卡用户' else '非数据SIM卡用户' end 
,a.brand_id
order by 1,2



 select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'

select count(0)
from (       
 select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'     
) t        


 select test_flag,usertype_id,a.user_id
 from  session.int_check_user_status a
 where user_id
  in (select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'  )
 order by 1,2

:
TEST_FLAG	USERTYPE_ID	3
0	2010	20
0	2020	33
1	1010	67
1	2020	10

select * from bass2.dw_enterprise_membersub_ds a
where a.USER_ID in 
('89157333942045'
,'89157333603327'
,'89257332980422'
,'89157332993008'
,'89157333942117'
,'89257332980702'
,'89460000339034'
,'89257333374671'
,'89157332993069'
,'89157333942188'
,'89157332895961'
,'89157333942125'
,'89157333603323'
,'89157334002261'
,'89157333872113'
,'89157333603386'
,'89257332980594'
,'89257332980520'
,'89157332834451'
,'89157333603404'
,'89460000221143'
,'89657333695116'
,'89157332768972'
,'89657333689064'
,'89460000270137'
,'89457333386157'
,'89657334006083'
,'89757334252690'
,'89657333688890'
,'89657334037819'
,'89457333338562'
,'89657333736478'
,'89657333295749'
,'89657333696722'
,'89657333832637'
,'89157332826412'
,'89757334249044'
,'89657333562860'
,'89457333600524'
,'89657333802412'
,'89657333800018'
,'89157332768979'
,'89657333693001'
,'89157332994577'
,'89157332844445'
,'89657333695270'
,'89657333685357'
,'89457333729869'
,'89657334006210'
,'89657333685472'
,'89657333802374'
,'89657334067011'
,'89657334006049')



select *
from 
 (
 select a.*,row_number()over(partition by user_id order by time_id desc) rn 
 from  BASS1.G_A_02062_DAY a
 where
 a.USER_ID in 
('89157333942045'
,'89157333603327'
,'89257332980422'
,'89157332993008'
,'89157333942117'
,'89257332980702'
,'89460000339034'
,'89257333374671'
,'89157332993069'
,'89157333942188'
,'89157332895961'
,'89157333942125'
,'89157333603323'
,'89157334002261'
,'89157333872113'
,'89157333603386'
,'89257332980594'
,'89257332980520'
,'89157332834451'
,'89157333603404'
,'89460000221143'
,'89657333695116'
,'89157332768972'
,'89657333689064'
,'89460000270137'
,'89457333386157'
,'89657334006083'
,'89757334252690'
,'89657333688890'
,'89657334037819'
,'89457333338562'
,'89657333736478'
,'89657333295749'
,'89657333696722'
,'89657333832637'
,'89157332826412'
,'89757334249044'
,'89657333562860'
,'89457333600524'
,'89657333802412'
,'89657333800018'
,'89157332768979'
,'89657333693001'
,'89157332994577'
,'89157332844445'
,'89657333695270'
,'89657333685357'
,'89457333729869'
,'89657334006210'
,'89657333685472'
,'89657333802374'
,'89657334067011'
,'89657334006049')
) t where rn = 1 

20110212	89401560000169      	89460000270137      	1249	3	13908940254    	4 	1	cmm.hn                                                      	20110212	1	1

select * from   g_a_02008_day
where user_id = '89460000270137'


20110226	89460000270137      	2020
20101123	89460000270137      	1022

20110212	89401560000169      	89460000270137      	1249	3	13908940254    	4 	1	cmm.hn                                                      	20110212	1	1
20110127

89157333942188      

select * from   g_a_02008_day
where user_id = '89157333942188'
20110201	89157333942188      	2010


20110212
20110127
20110127
20110127
20110127
20101231



select * from    bass2.dwd_enterprise_sub_20101231 a
where
 a.SUB_ID in 
('89157333942045'
,'89157333603327'
,'89257332980422'
,'89157332993008'
,'89157333942117'
,'89257332980702'
,'89460000339034'
,'89257333374671'
,'89157332993069'
,'89157333942188'
,'89157332895961'
,'89157333942125'
,'89157333603323'
,'89157334002261'
,'89157333872113'
,'89157333603386'
,'89257332980594'
,'89257332980520'
,'89157332834451'
,'89157333603404'
,'89460000221143'
,'89657333695116'
,'89157332768972'
,'89657333689064'
,'89460000270137'
,'89457333386157'
,'89657334006083'
,'89757334252690'
,'89657333688890'
,'89657334037819'
,'89457333338562'
,'89657333736478'
,'89657333295749'
,'89657333696722'
,'89657333832637'
,'89157332826412'
,'89757334249044'
,'89657333562860'
,'89457333600524'
,'89657333802412'
,'89657333800018'
,'89157332768979'
,'89657333693001'
,'89157332994577'
,'89157332844445'
,'89657333695270'
,'89657333685357'
,'89457333729869'
,'89657334006210'
,'89657333685472'
,'89657333802374'
,'89657334067011'
,'89657334006049')



bass2.ods_product_ins_prod_20110315


select count(0)
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 

select * from   bass2.dw_enterprise_msg_his_20110316
where enterprise_id in (
'89108911013886'      
,'89100000000645'     )



select
         TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,2 STATUS_ID
from          
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 


select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id >=20110301 and ENTERPRISE_BUSI_TYPE = '1220'


select count(0) from G_A_02054_DAY


select * from BASS1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0074'

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 


select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'



CREATE TABLE BASS1.G_A_02054_DAY_20110317BAK
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    TIME_ID
   ) USING HASHING


insert into BASS1.G_A_02054_DAY_20110317BAK
select * from G_A_02054_DAY


select count(0) from    G_A_02054_DAY_20110317BAK

54697

select count(0) from    G_A_02054_DAY


CREATE TABLE BASS1.G_A_02054_DAY_0317_1220repair
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    TIME_ID
   ) USING HASHING




   ALTER TABLE BASS1.G_A_02054_DAY_0317_1220repair
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  

insert into BASS1.G_A_02054_DAY_0317_1220repair
select
         20110317
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
from g_a_02054_day 
where STATUS_ID ='1' 
			and MANAGE_MODE = '2'
			and time_id <20110301 
			and ENTERPRISE_BUSI_TYPE = '1220'

            


CREATE TABLE BASS1.G_A_02061_DAY_20110317BAK
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  EXPIRE_DATE           CHARACTER(8),
  PAY_TYPE              CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02061_DAY_20110317BAK
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

insert into   bass1.G_A_02061_DAY_20110317BAK
select * from  bass1.G_A_02061_DAY



select count(0) from     bass1.G_A_02061_DAY

select count(0) from    bass1.G_A_02061_DAY_20110317BAK



CREATE TABLE BASS1.G_A_02061_DAY_0317repair
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  EXPIRE_DATE           CHARACTER(8),
  PAY_TYPE              CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02061_DAY_0317repair
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
insert into   bass1.G_A_02061_DAY_0317repair
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'



delete from   bass1.G_A_02061_DAY_0317repair
insert into   bass1.G_A_02061_DAY_0317repair
select 
         20110317
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110317' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'




select * from    bass1.G_A_02061_DAY_0317repair


	select sum(bigint(tnet_bill_duration)) from bass1.g_s_22202_day where time_id=20110316
    571304
    
	select sum(bigint(tnet_bill_duration)) from bass1.g_s_22202_day where time_id=20110315
240017

select * from   bass1.G_RULE_CHECK
where time_id = 20110316

20110316	R161_15	571304.00000	240017.00000	1.38026	0.00000



select * from   bass1.g_s_22202_day where time_id = 20110316
20110316	20110316	876691      	571304      	217         



delete from BASS1.G_A_02054_DAY_0317_1220repair
insert into BASS1.G_A_02054_DAY_0317_1220repair
select
         20110317
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where STATUS_ID ='1' and MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 



delete from   bass1.G_A_02061_DAY_0317repair
insert into   bass1.G_A_02061_DAY_0317repair
select 
         20110317
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110317' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and STATUS_ID ='1'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 

select count(0) from   bass2.dw_product_td_20110315

select *    
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2 
where rn = 1 
and STATUS_ID ='1'


select * from   bass1.G_A_02061_DAY_0317repair

delete from   bass1.G_A_02061_DAY_0317repair
insert into   bass1.G_A_02061_DAY_0317repair
select 
         20110317
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110317' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2 
where rn = 1 
and STATUS_ID ='1'


select
         20110317
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where  MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 and STATUS_ID ='1' 


delete from BASS1.G_A_02054_DAY_0317_1220repair
insert into BASS1.G_A_02054_DAY_0317_1220repair
select
         20110317
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from g_a_02054_day where  MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1220'
) t 
) t2 where rn = 1 and STATUS_ID ='1' 


select * from    BASS1.G_A_02061_DAY


insert into BASS1.G_A_02061_DAY
select * from bass1.G_A_02061_DAY_0317repair



insert into BASS1.G_A_02054_DAY 
		select * from bass1.G_A_02054_DAY_0317_1220repair
        
select * from   bass1.G_A_02054_DAY_0317_1220repair
except
select * from   BASS1.G_A_02054_DAY 


select test_mark , count(0) 
--,  count(distinct test_mark ) 
from bass2.dw_product_20110315 
group by  test_mark 
order by 1 

select count(0) from  bass2.dw_product_20110315 
where   test_mark = 0
        
        

declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp
--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110316 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110316 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1


select case when a.sim_code = '1' then '数据SIM卡用户' else '非数据SIM卡用户' end 
,a.brand_id, count(distinct a.user_id) user_cnt from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <=20110316
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'
group by case when a.sim_code = '1' then '数据SIM卡用户' else '非数据SIM卡用户' end 
,a.brand_id
order by 1,2



select count(0)
from (       
 select distinct user_id from  G_A_02062_DAY
  where time_id <=20110316
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <=20110316
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'     
) t    

select 
         TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,PRODUCT_NO
        ,INDUSTRY_ID
        ,GPRS_TYPE
        ,DATA_SOURCE
        ,CREATE_DATE
        ,STATUS_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a
) t where rn = 1 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <=20110316
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'     


select * from   G_A_02062_DAY



select 
         20110317 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,PRODUCT_NO
        ,INDUSTRY_ID
        ,GPRS_TYPE
        ,DATA_SOURCE
        ,CREATE_DATE
        ,'2' STATUS_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a
) t where rn = 1 and STATUS_ID = '1'
and user_id in 
(
select USER_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a
) t where rn = 1 and STATUS_ID = '1'
except
select user_id 
from session.int_check_user_status a
        where a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'
)        




CREATE TABLE BASS1.G_A_02062_DAY_20110317bak
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  PRODUCT_NO            CHARACTER(15),
  INDUSTRY_ID           CHARACTER(2),
  GPRS_TYPE             CHARACTER(1),
  DATA_SOURCE           CHARACTER(60),
  CREATE_DATE           CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02062_DAY_20110317bak
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

insert into BASS1.G_A_02062_DAY_20110317bak
select * from  BASS1.G_A_02062_DAY
       74990 row(s) affected.
select count(0) from  BASS1.G_A_02062_DAY
     

CREATE TABLE BASS1.G_A_02062_DAY_20110317repair
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  PRODUCT_NO            CHARACTER(15),
  INDUSTRY_ID           CHARACTER(2),
  GPRS_TYPE             CHARACTER(1),
  DATA_SOURCE           CHARACTER(60),
  CREATE_DATE           CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02062_DAY_20110317repair
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE




delete from  BASS1.G_A_02062_DAY_20110317repair 
insert into  BASS1.G_A_02062_DAY_20110317repair
select 
         20110317 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,PRODUCT_NO
        ,INDUSTRY_ID
        ,GPRS_TYPE
        ,DATA_SOURCE
        ,CREATE_DATE
        ,'2' STATUS_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a
) t where rn = 1 and STATUS_ID = '1'
and user_id in 
(
select USER_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a
) t where rn = 1 and STATUS_ID = '1'
except
select user_id 
from session.int_check_user_status a
        where a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'
)        




delete from  BASS1.G_A_02062_DAY_20110317repair 
insert into  BASS1.G_A_02062_DAY_20110317repair
select 
         20110317 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,PRODUCT_NO
        ,INDUSTRY_ID
        ,GPRS_TYPE
        ,DATA_SOURCE
        ,CREATE_DATE
        ,'2' STATUS_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a where TIME_ID <=20110316
) t where rn = 1 and STATUS_ID = '1'
and user_id in 
(
select USER_ID
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc ) rn  
from   G_A_02062_DAY a  where TIME_ID <=20110316
) t where rn = 1 and STATUS_ID = '1'
except
select user_id 
from session.int_check_user_status a
        where a.usertype_id NOT IN ('2010','2020','2030','9000')
        and a.test_flag='0'
)        




select  from   BASS1.G_A_02059_DAY where time_id = 20110321
except
select * from   BASS1.G_A_02059_DAY_20110321fix1340

594

select count(0),count(distinct user_id) from   BASS1.G_A_02059_DAY_20110321fix1340


select * from   APP.SCH_CONTROL_RUNLOG 
where control_code like 'BASS1%'
order by endtime desc

select * from   app.sch_control_before where control_code like '%02059%'

select * from   G_A_02008_DAY where time_id > 20110101

select * from   G_A_01008_DAY
select * from   APP.SMS_SEND_INFO


select * from  app.sch_control_alarm 
where alarmtime >=  timestamp('20110311'||'000000') 
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 

select * from   bass1.int_program_data

select * from   
bass1.int_verf_err_list

select * from   
bass1.int_all_job_log

select * from   USYS_INT_CONTROL



select a.user_id,call_duration_m  from
(
select user_id,sum(call_duration_m) call_duration_m from bass2.dw_call_20110316
where MNS_TYPE=1
group by user_id
) a
inner join  (select distinct user_id from bass2.dw_product_td_20110316 where (td_call_mark =1
            or td_gprs_mark =1
            or td_addon_mark=1)
and userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9)
and test_mark=0 ) b
on a.user_id=b.user_id 
order by call_duration_m desc
 


select * from bass2.dw_cust_20110316
where cust_id in
(
select cust_id from bass2.dw_product_20110316
where user_id in
('89160000208968'
,'89160000409386'
,'89160000688192'
,'89157334175039'
,'89160000523755'
,'89160000454937'
,'89160000604528'
,'89157334216159'
,'89160000696074'
,'89157334323731')
)
 



select * from   g_a_02059_day


select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from bass1.g_a_02059_day 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 


select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110301
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'


select count(0)
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from G_A_02055_DAY where MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1340'
) t 
) t2 where rn = 1  and  STATUS_ID ='1'  



select ENTERPRISE_ID
								from 
										(
										select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
										from (
													select *
													from G_A_02055_DAY where MANAGE_MODE = '2'
													and time_id <=20110321 and ENTERPRISE_BUSI_TYPE = '1340'
													) t 
										) t2 where rn = 1  and  STATUS_ID ='1'  
                                        
                                        
select * from   G_A_02059_DAY where      ENTERPRISE_BUSI_TYPE = '1340'
                                   
select * from   bass1.g_a_02054_day
                                   
                                   


CREATE TABLE BASS1.G_A_02059_DAY_20110321bak
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02059_DAY_20110321bak
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

insert into G_A_02059_DAY_20110321bak
select * from G_A_02059_DAY
                                   
select count(0) from    G_A_02059_DAY_20110321bak
select count(0) from    G_A_02059_DAY


drop table BASS1.G_A_02059_DAY_20110321fix1340

CREATE TABLE BASS1.G_A_02059_DAY_20110321fix1340
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02059_DAY_20110321fix1340
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select * from   BASS1.G_A_02059_DAY_20110321fix1340

select * from   G_A_02055_DAY




insert into BASS1.G_A_02059_DAY_20110321fix1340
select  20110321
				,a.ENTERPRISE_ID
				,b.USER_ID
				,'1340'
				,'2'
				,'20110321'
				,'1' from   bass2.DW_ENTERPRISE_MEMBER_MID_20110320 a
				where a.ENTERPRISE_ID 
				in (
							select  ENTERPRISE_ID
								from 
										(
										select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
										from (
													select *
													from G_A_02055_DAY where MANAGE_MODE = '2'
													and time_id <=20110320 and ENTERPRISE_BUSI_TYPE = '1340'
													) t 
										) t2 where rn = 1  and  STATUS_ID ='1'  
					)



select count(0),count(distinct user_id ) from     BASS1.G_A_02059_DAY_20110321fix1340
7297	7297

select * from   BASS1.G_A_02059_DAY_20110321fix1340

select count(0) from    BASS1.G_A_02059_DAY_20110321fix1340

insert into BASS1.G_A_02059_DAY_20110321fix1340
select  20110321
				,a.ENTERPRISE_ID
				,b.USER_ID
				,'1340'
				,'2'
				,'20110321'
				,'1'                
--select count(0),count(distinct   b.USER_ID)              
from  (
						select  ENTERPRISE_ID,
							from 
									(
									select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
									from (
												select *
												from G_A_02055_DAY where MANAGE_MODE = '2'
												and time_id <=20110320 and ENTERPRISE_BUSI_TYPE = '1340'
												) t 
									) t2 where rn = 1  and  STATUS_ID ='1'  
					) a,
				  bass2.dw_enterprise_member_mid_20110320 b,
		      bass2.dw_enterprise_msg_20110320 c,
		      bass2.dw_product_20110320 d
				where a.enterprise_id=b.enterprise_id
				  and a.enterprise_id=c.enterprise_id
				  and b.user_id=d.user_id
				  and d.usertype_id in (1,2,3,6)


7039 row(s) affected.

select * from   BASS1.G_A_02059_DAY_20110321fix1340

                                   
select * from   	bass1.g_a_02055_day

select count(0) from    (
select * from  G_A_02059_DAY where time_id = 20110321
except 
select * from   G_A_02059_DAY_20110321fix1340
) t

594+7037
select count(0) from   G_A_02059_DAY where time_id = 20110321

7631


select count(0)
from 
(
select user_id
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110301
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'
) t 
join G_A_02059_DAY_20110321fix1340 b on t.user_id = b.user_id 

select test_mark,count(0) from   G_A_02059_DAY_20110321fix1340 a
join bass2.dw_product_20110320 b on a.user_id = b.user_id       
group by test_mark

select a.enterprise_id,b.ENTERPRISE_NAME,count(0) from   G_A_02059_DAY_20110321fix1340 a 
join bass2.dw_enterprise_msg_20110320 b on a.enterprise_id = b.enterprise_id
group by a.enterprise_id,b.ENTERPRISE_NAME



delete from BASS1.G_A_02059_DAY_20110321fix1340
insert into BASS1.G_A_02059_DAY_20110321fix1340
select  20110321
				,a.ENTERPRISE_ID
				,b.USER_ID
				,'1340'
				,'2'
				,'20110321'
				,'1' 
from  (
				select  ENTERPRISE_ID
					from 
							(
							select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
							from (
										select *
										from G_A_02055_DAY where MANAGE_MODE = '2'
										and time_id <=20110320 and ENTERPRISE_BUSI_TYPE = '1340'
										) t 
							) t2 where rn = 1  and  STATUS_ID ='1'  
			) a,
		  bass2.dw_enterprise_member_mid_20110320 b,
      bass2.dw_enterprise_msg_20110320 c,
      bass2.dw_product_20110320 d
where a.enterprise_id=b.enterprise_id
			and a.enterprise_id=c.enterprise_id
			and b.user_id=d.user_id
			and d.usertype_id in (1,2,3,6)
			and d.test_mark = 0 



								select 20110320
											 ,a.enterprise_id
											 ,b.user_id
											 ,'1340'
											 ,'3'
											 ,'20110320'
											 ,a.status_id
								from 	bass1.g_a_02055_day a,
								      bass2.dw_enterprise_member_mid_20110320 b,
								      bass2.dw_enterprise_msg_20110320 c,
								      bass2.dw_product_20110320 d
								where a.enterprise_id=b.enterprise_id
								  and a.enterprise_id=c.enterprise_id
								  and b.user_id=d.user_id
								  and d.usertype_id in (1,2,3,6)
								  and a.enterprise_busi_type='1340'
								  and a.time_id=20110320
								  and a.status_id='1'
								  and d.test_mark = 0		                             
                                  
select * from                                     
 BASS1.G_A_02059_DAY


select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.G_A_02059_DAY 
group by  time_id 
order by 1 


select * from   app.sch_control_map where program_name like '%test%'

select * from   bass1.int_program_data where program_name like '%02059%'

select count(0) from   syscat.tables 
                                  
135515
9234


rename BASS2.DW_ENTERPRISE_MEMBER_MID_20100520 to DW_ENTERPRISE_MEMBER_MID_20110320

rename BASS2.DW_ENTERPRISE_MEMBER_MID_20110320 to DW_ENTERPRISE_MEMBER_MID_20100520
select * from   G_A_02059_DAY_0315modify

insert into app.sch_control_before
values('BASS1_G_A_02059_DAY.tcl','BASS1_G_A_02055_DAY.tcl')

select * from   app.sch_control_before where control_code = 'BASS1_G_A_02059_DAY.tcl'

                                 

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110301
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'
                                 
                                 
select * from g_a_02059_day a
where TIME_ID < 20110321
and MANAGE_MODE = '3'
and ENTERPRISE_BUSI_TYPE ='1040'
and length(trim(user_id)) = 14
                                 
                                 
select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110316
and MANAGE_MODE = '3'
and ENTERPRISE_BUSI_TYPE ='1040'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'



select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from bass1.g_a_02059_day 
group by  TIME_ID 
order by 1 
                                 
20110321	7631

594
7039

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID <= 20110321
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'
                                 
                                                                  
                                                                  
select * from g_a_02059_day a
where TIME_ID <= 20110321
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14

select count(0),count(distinct user_id) from g_a_02059_day a
where TIME_ID <= 20110321
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14


select  count(0),count(distinct b.user_id)
from  (
				select  ENTERPRISE_ID
					from 
							(
							select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
							from (
										select *
										from G_A_02055_DAY where MANAGE_MODE = '2'
										and time_id <=20110320 and ENTERPRISE_BUSI_TYPE = '1340'
										) t 
							) t2 where rn = 1  and  STATUS_ID ='1'  
			) a,
		  bass2.dw_enterprise_member_mid_20110320 b,
      bass2.dw_enterprise_msg_20110320 c,
      bass2.dw_product_20110320 d
where a.enterprise_id=b.enterprise_id
			and a.enterprise_id=c.enterprise_id
			and b.user_id=d.user_id
			and d.usertype_id in (1,2,3,6)
			and d.test_mark = 0                                                                   

select count(0) from G_A_02059_DAY_20110321fix1340
            

select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID <= 20110321
and MANAGE_MODE = '2'
and ENTERPRISE_BUSI_TYPE ='1340'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'
                                 


select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110316
and MANAGE_MODE = '3'
and ENTERPRISE_BUSI_TYPE ='1040'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'

--44 条

select * from   bass1.g_i_06032_day


                                             
select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and  STATUS_ID ='1'

select * from   BASS1.G_A_02061_DAY

 select * from bass2.DWD_PS_NET_NUMBER_20110321 where number_segment='1820808'

select * from    g_a_02059_day 


select count(0) 
from   
(
select a.*,row_number()over(partition by user_id order by time_id desc )  rn 
from g_a_02059_day a  where time_id <= 20110320  
) t where rn = 1 and status_id = '1'



BASS2.DIM_CONTROL_INFO.del
BASS2.DIM_DEVICE_INFO.del
BASS2.DIM_DEVICE_PROFILE.del
BASS2.DIM_PROPERTY_INFO.del
BASS2.DIM_PROPERTY_VALUE_RANGE.del
select * from   g_i_77780_day

select count(0) from BASS2.DIM_CONTROL_INFO
select count(0) from BASS2.DIM_DEVICE_INFO
18386
select count(0) from BASS2.DIM_DEVICE_PROFILE
1319690
select count(0) from BASS2.DIM_PROPERTY_INFO
select count(0) from BASS2.DIM_PROPERTY_VALUE_RANGE

select * from   BASS2.DIM_DEVICE_PROFILE


CREATE TABLE BASS1.G_A_02059_DAY_down20110321
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID,
    TIME_ID
   ) USING HASHING



drop table BASS1.G_A_02059_DAY_DOWN20110321

select * from   BASS1.G_A_02059_DAY_DOWN20110321

select distinct VALUE_DESC from   BASS2.DIM_DEVICE_PROFILE   where   PROPERTY_ID =  '003001'

select * from BASS2.DIM_CONTROL_INFO        
select * from BASS2.DIM_DEVICE_INFO         
select * from BASS2.DIM_DEVICE_PROFILE      
select * from BASS2.DIM_PROPERTY_INFO       
select * from BASS2.DIM_PROPERTY_VALUE_RANGE
select tabschema,tabname from   syscat.tables where tabname like 'DIM_TERM_TAC%'

select * from   BASS2.DIM_TACNUM_DEVID
select count(0),count(distinct device_id) from BASS2.DIM_DEVICE_INFO         
18386	18385

select count(0),count(distinct device_id) from BASS2.DIM_DEVICE_PROFILE      
1319690	18385


select time_id ,count(distinct tac_num)
--,  count(distinct time_id ) 
from BASS2.DIM_TACNUM_DEVID 
group by  time_id 
order by 1 



select a.time_id ,count(distinct tac_num)
--,  count(distinct time_id ) 
from BASS2.DIM_TACNUM_DEVID  a , 
BASS2.DIM_DEVICE_INFO        b 
where b.device_id = a.dev_id 
group by  a.time_id 
order by 1 
201102	33619



select time_id , count(0) ,count(distinct tac_num),count(distinct dev_id)
--,  count(distinct time_id ) 
from BASS2.DIM_TACNUM_DEVID 
group by  time_id 
order by 1 
201102	33622	33620	15165


select * from   BASS2.DIM_TERM_TAC where 
TERM_MODEL='Iphone 4'                                                                                     
select count(0) ,count(distinct tac_num) from    BASS2.DIM_TERM_TAC
27564	27564

select int(replace(char(current date - 1 days),'-','')) from bass2.dual

select * from  bass2.dw_product_imei_rela_ds          
                                   
select * from   BASS1.G_I_02047_MONTH 

select count(0),count(distinct device_id) from BASS2.DIM_DEVICE_PROFILE      


select 1701 as kpi_id,city_id,count(distinct user_id) as kpi_value,brand_id
from bass2.
where td_user_mark = 1 and usertype_id in (1,2,9) and userstatus_id in (1,2,3,6,8) and test_mark<>1



select count(user_id) , count(distinct user_id)
                    from bass2.dw_product_201102
                   where usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1


select count(distinct substr(imei,1,8)) from    bass2.dw_product_mobilefunc_201102
where  
usertype_id in (1,2,9) 
 and userstatus_id in (1,2,3,6,8)
 
26774
 
 
33019
                                   
vs 33620
                                   

select  count(distinct substr(a.imei,1,8))
--,  count(distinct time_id ) 
from  bass2.dw_product_mobilefunc_201102  a , 
BASS2.DIM_TACNUM_DEVID        b 
where  substr(a.imei,1,8) = b.tac_num 
                   and usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     --and test_mark<>1





declare global temporary table session.t_imei
    (
        imei varchar(18)
        ,tac_num varchar(10)
    )                            
partitioning key           
 (
   imei    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp

insert into  session.t_imei
select imei,substr(a.imei,1,8) 
from   bass2.dw_product_mobilefunc_201104 a
  
select count(0),count(distinct tac_num ) from    session.t_imei                                   
4110313	33019

select count(distinct a.tac_num)
from 
( select distinct tac_num from session.t_imei      ) a ,
BASS2.DIM_TACNUM_DEVID        b 
where a.tac_num = b.TAC_NUM

19618

 select  from   bass2.dw_product_imei_rela_ds
 
 
 declare global temporary table session.t_imei2
    (
        imei varchar(18)
        ,tac_num varchar(10)
    )                            
partitioning key           
 (
   imei    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp

insert into session.t_imei2
 select distinct imei ,substr(a.imei,1,8)  from   bass2.dw_product_imei_rela_ds  a where op_time = '2011-03-22'
 and last_use_date >= '2010-12-22'

 select count(0),count(distinct tac_num ) from    session.t_imei2                                   
1701113	30058


 
select count(distinct a.tac_num)
from 
( select distinct tac_num from session.t_imei2      ) a ,
BASS2.DIM_TACNUM_DEVID        b 
where a.tac_num = b.TAC_NUM
17760


02047



select time_id,count(0) from   bass1.G_S_02047_MONTH
group by time_id




select * from   syscat.tables where tabname like '%G_I_02006_MONTH%'



CREATE TABLE BASS1.G_I_77780_DAY
 (
	 TIME_ID            		NUMBER(8)      NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       NOT NULL       ----集团客户标识    
	,ID                 		CHAR(9)        NOT NULL 				----ID              
	,ENTERPRISE_NAME    		CHAR(60)            					----集团客户名称    
	,ORG_TYPE           		CHAR(5)             					----机构类型        
	,ADDR_CODE          		CHAR(6)             					----地址代码        
	,CITY               		CHAR(20)            					----城市地区        
	,REGION             		CHAR(20)            					----区县            
	,COUNTY             		CHAR(20)            					----乡镇            
	,DOOR_NO            		CHAR(60)            					----门牌            
	,AREA_CODE          		CHAR(5)             					----区号            
	,PHONE_NO1          		CHAR(11)            					----电话1           
	,PHONE_NO2          		CHAR(10)            					----电话2           
	,POST_CODE          		CHAR(6)             					----邮政编码        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型        
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型        
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股            
	,GROUP_TYPE         		CHAR(1)             					----集团类型        
	,MANAGE_STYLE       		CHAR(1)             					----经营形式        
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类    
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类        
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码    
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE





CREATE TABLE BASS1.G_I_77780_DAY
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       NOT NULL       ----集团客户标识    
	,ID                 		CHAR(9)             					----ID              
	,ENTERPRISE_NAME    		CHAR(60)            					----集团客户名称    
	,ORG_TYPE           		CHAR(5)             					----机构类型        
	,ADDR_CODE          		CHAR(6)             					----地址代码        
	,CITY               		CHAR(20)            					----城市地区        
	,REGION             		CHAR(20)            					----区县            
	,COUNTY             		CHAR(20)            					----乡镇            
	,DOOR_NO            		CHAR(60)            					----门牌            
	,AREA_CODE          		CHAR(5)             					----区号            
	,PHONE_NO1          		CHAR(11)            					----电话1           
	,PHONE_NO2          		CHAR(10)            					----电话2           
	,POST_CODE          		CHAR(6)             					----邮政编码        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型        
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型        
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股            
	,GROUP_TYPE         		CHAR(1)             					----集团类型        
	,MANAGE_STYLE       		CHAR(1)             					----经营形式        
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类    
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类        
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码    
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE


select * from   BASS1.G_I_77780_DAY




CREATE TABLE BASS1.G_I_77780_DAY_MID
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       NOT NULL       ----集团客户标识    
	,ID                 		CHAR(9)             					----ID              
	,ENTERPRISE_NAME    		CHAR(60)            					----集团客户名称    
	,ORG_TYPE           		CHAR(5)             					----机构类型        
	,ADDR_CODE          		CHAR(6)             					----地址代码        
	,CITY               		CHAR(20)            					----城市地区        
	,REGION             		CHAR(20)            					----区县            
	,COUNTY             		CHAR(20)            					----乡镇            
	,DOOR_NO            		CHAR(60)            					----门牌            
	,AREA_CODE          		CHAR(5)             					----区号            
	,PHONE_NO1          		CHAR(11)            					----电话1           
	,PHONE_NO2          		CHAR(10)            					----电话2           
	,POST_CODE          		CHAR(6)             					----邮政编码        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型        
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型        
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股            
	,GROUP_TYPE         		CHAR(1)             					----集团类型        
	,MANAGE_STYLE       		CHAR(1)             					----经营形式        
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类    
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类        
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码    
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  select dbpartitionnum(PRODUCT_NO) as partitionnum_num, count(*)
as rows from G_S_21003_MONTH
group by dbpartitionnum(PRODUCT_NO)
order by dbpartitionnum (PRODUCT_NO)


select * from   syscat.tables where tabname like '%777%'

select count(0) from   G_I_77778_DAY


--目标表
drop table BASS1.G_I_77780_DAY
CREATE TABLE BASS1.G_I_77780_DAY
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       NOT NULL       ----集团客户标识    
	,ID                 		CHAR(9)        								----ID*              
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
	,ORG_TYPE           		CHAR(5)             					----机构类型 							BASS_STD_0001       
	,ADDR_CODE          		CHAR(6)             					----地址代码*        
	,CITY               		CHAR(20)            					----城市地区*        
	,REGION             		CHAR(20)            					----区县*            
	,COUNTY             		CHAR(20)            					----乡镇*            
	,DOOR_NO            		CHAR(60)            					----门牌*            
	,AREA_CODE          		CHAR(5)             					----区号*            
	,PHONE_NO1          		CHAR(11)            					----电话1*           
	,PHONE_NO2          		CHAR(10)            					----电话2*           
	,POST_CODE          		CHAR(6)             					----邮政编码*        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型 							BASS_STD1_0113       
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数*      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型 							BASS_STD_0002       
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股  								BASS_STD_0005          
	,GROUP_TYPE         		CHAR(1)             					----集团类型 							BASS_STD_0003       
	,MANAGE_STYLE       		CHAR(1)             					----经营形式      				BASS_STD_0004  
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类 					BASS_STD_0006   
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类     					BASS_STD_0007   
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码 					BASS_STD1_0043   
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select * from   app.sch_control_before 
where before_control_code like '%22012%'


select 'xxxxx',count(0) from app.sch_control_alarm where alarmtime >= timestamp('20110324'||'000000') and flag = -1 and control_code like 'BASS1%'

select * from    bass1.int_02011_snapshot

select * from   app.sch_control_task where control_code like '%02011%'

--自动点告警 BASS1_INT_CHECK_INDEX_WAVE_DAY.tcl
select * from app.sch_control_runlog
where control_code like '%INT_02011_SNAPSHOT.tcl%'



select * from   BASS1.G_MON_D_INTERFACE 

select * from   




select 'insert into BASS1.G_MON_D_INTERFACE values('||unit_code||','||substr(data_file,1,1)||')' from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1



select TABNAME  from   syscat.tables where tabschema = 'BASS1'

select control_code 
						            from app.sch_control_runlog 
						            where date(endtime)=date(current date)
						                  and flag=0

select flag from   app.sch_control_runlog where control_code like '%INT_CHECK_RUNLOG_DAY%'
and date(endtime)=date(current date) and flag=0



select a.unit_code ,substr(b.TABNAME,3,1) ,b.TABNAME
from 
( select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1 ) a,
 syscat.tables b where a.unit_code = substr(b.TABNAME,5,5)
and b.tabschema = 'BASS1'
and tabname like '%DAY'
g_i_01

select * from    APP.G_UNIT_INFO 

select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 2 days
--and flag = -1
--and control_code like 'BASS1%'
order by alarmtime desc 

select * from   app.sch_control_task where control_code like '%15304%'

select * from   bass2.VGOP_15304_20110324


select count(0)
                    from bass2.dw_product_20110324 a ,bass2.dwd_cust_msg_20110324 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
                     
select b.cust_name , count(0)
                    from bass2.dw_product_20110324 a ,bass2.dwd_cust_msg_20110324 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
group by    b.cust_name
order by 2 desc 
                   
select a.*,b.*
                    from bass2.dw_product_20110324 a ,bass2.dwd_cust_msg_20110324 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id

select count(0) from session.int_check_user_status where create_date = '20110324'
and test_flag = '0'

                     
4231

 323	 324
2880	4239

select * from   g_s_22012_day
20110324	20110324	4231      	1636785     	23021010    	412022      	3873747     	3424      	335706      

20110323	20110323	2878      	1635972     	22901457    	389311      	3975018     	120       	329440      


select b.cust_name,a.CRM_BRAND_ID1, count(0)
                    from bass2.dw_product_20110323 a ,bass2.dwd_cust_msg_20110323 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
and  b.CHANNEL_ID in
(91000047
,91000048
,91000049
,91000046
,91000050
,91000035
,97000019
,91000012
,97000023)
group by    b.cust_name, a.CRM_BRAND_ID1
order by 3 desc                      





select b.cust_name,b.CHANNEL_ID, count(0)
                    from bass2.dw_product_20110322 a ,bass2.dwd_cust_msg_20110322 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
group by    b.cust_name, b.CHANNEL_ID
order by 3 desc 

	91000046	126
	91000049	114
	91000047	113
	91000048	78
	91000050	77
	91000012	38
	91000035	11
	97000019	1
	97000023	1
	97000023	1
	97000019	1
	97000019	1
	97000019	1
	97000023	1
	97000019	1
	97000019	1
	97000023	1




declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   time_id        int
)                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp



insert into session.int_check_user_status (
         user_id    
        ,product_no 
        ,test_flag  
        ,sim_code   
        ,usertype_id  
        ,create_date
        ,time_id )
select e.user_id
        ,e.product_no  
        ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
        ,e.sim_code
        ,f.usertype_id  
        ,e.create_date  
        ,f.time_id       
from (select user_id,create_date,product_no,sim_code,usertype_id
                    ,row_number() over(partition by user_id order by time_id desc ) row_id   
  from bass1.g_a_02004_day
  where time_id<=20110324) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
               from bass1.g_a_02008_day
               where time_id<=20110324 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
commit



select * from bass2.ODS_PRODUCT_ORD_CUST_20110324
where bill_id in
(
select product_no from bass2.dw_product_20110324
where cust_id in
(
   select cust_id from bass2.dw_cust_20110324
    where cust_id in
        (
        select cust_id from bass2.dw_product_20110324
        where user_id in
            (
            select user_id from session.int_check_user_status 
            where create_date = '20110324'
            and test_flag='0'
            )
        )
    and cust_name like '%代理%'
)
)


select business_id,count(*) from bass2.ODS_PRODUCT_ORD_CUST_20110324
where bill_id in
(
select product_no from bass2.dw_product_20110324
where cust_id in
(
   select cust_id from bass2.dw_cust_20110324
    where cust_id in
        (
        select cust_id from bass2.dw_product_20110324
        where user_id in
            (
            select user_id from session.int_check_user_status 
            where create_date = '20110324'
            and test_flag='0'
            )
        )
    and cust_name like '%代理%'
)
)
group by business_id


BUSINESS_ID	    2
191000000007	31
191000000008	2
191000000012	1
191000000145	2063
191000001017	45
191000001024	116
193000000001	12


select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110324
where product_item_id in (191000000145)





select b.CHANNEL_ID, count(0)
                    from bass2.dw_product_20110324 a ,bass2.dwd_cust_msg_20110324 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
and b.cust_name like '%代理%'
group by    b.CHANNEL_ID
order by 2 desc 

91000047	568
91000048	535
91000049	231
91000046	177
91000050	173



select b.CHANNEL_ID, count(0)
                    from bass2.dw_product_20110321 a ,bass2.dwd_cust_msg_20110321 b 
                   where usertype_id in (1,2,9) 
                     and day_new_mark = 1 and test_mark<>1
                     and a.cust_id = b.cust_id
and b.CHANNEL_ID in (
91000047
,91000048
,91000049
,91000046
,91000050
)
group by    b.CHANNEL_ID
order by 1 desc 


select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110324
where product_item_id in (191000000145)

select * from BASS2.ODS_CHANNEL_INFO_20110324 b
where 
 b.CHANNEL_ID in (
91000047
,91000048
,91000049
,91000046
,91000050
)
order by 1 desc 



drop table BASS1.G_A_02059_DAY_down20110321
CREATE TABLE BASS1.G_A_02059_DAY_down20110321
 (
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID
   ) USING HASHING

select count(0)
from 
(
select 
        ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,STATUS_ID from bass1.G_A_02059_DAY
except 
select 
        ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,STATUS_ID from  bass1.G_A_02059_DAY_down20110321
        ) t

select ENTERPRISE_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from BASS1.G_A_02055_DAY_down20110321 where MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1340'
) t 
) t2 where rn = 1  and  STATUS_ID ='1'  
except
select ENTERPRISE_ID
from 
(
select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
from (
select *
from BASS1.G_A_02055_DAY where MANAGE_MODE = '2'
and time_id <20110301 and ENTERPRISE_BUSI_TYPE = '1340'
) t 
) t2 where rn = 1  and  STATUS_ID ='1'  


      

select * from   G_A_02055_DAY where ENTERPRISE_ID = '89103000041929'

select * from   G_A_02055_DAY_down20110321 where ENTERPRISE_ID = '89103000041929'
select * from   
bass2.dw_enterprise_member_mid_20110327 where enterprise_id = '89103000041929'


select count(0)
from (
select distinct trim(ENTERPRISE_ID) ENTERPRISE_ID,trim(USER_ID) from bass1.G_A_02059_DAY_down20110321 a 
except
select distinct trim(ENTERPRISE_ID) ENTERPRISE_ID,trim(USER_ID) from bass1.G_A_02059_DAY b
) t
select count(0) , count(distinct trim(ENTERPRISE_ID)) ENTERPRISE_ID from bass1.G_A_02059_DAY_down20110321

bass1.G_A_02059_DAY_down20110321

select ascii(ENTERPRISE_ID),ENTERPRISE_ID
from  bass1.G_A_02059_DAY_down20110321 
where ENTERPRISE_ID like  '%89403000904884%'
fetch first 1 rows only

     
select ascii(ENTERPRISE_ID)
from  bass1.G_A_02059_DAY where ENTERPRISE_ID = '89403000904884'
fetch first 1 rows only


drop table BASS1.G_A_02059_DAY_down20110321
CREATE TABLE BASS1.G_A_02059_DAY_down20110321
 (
  ENTERPRISE_ID         CHARACTER(20),
  USER_ID               CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (USER_ID
   ) USING HASHING
   
   
   
  select * from BASS1.G_A_02055_DAY where enterprise_id = '89202999392356'
  
  
  
  
CREATE TABLE BASS1.G_A_02055_DAY_down20110321
 (TIME_ID               INTEGER,
  ENTERPRISE_ID         CHARACTER(20),
  ENTERPRISE_BUSI_TYPE  CHARACTER(4),
  MANAGE_MODE           CHARACTER(1),
  PAY_TYPE              CHARACTER(1),
  CREATE_MODE           CHARACTER(1),
  ORDER_DATE            CHARACTER(8),
  STATUS_ID             CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    TIME_ID
   ) USING HASHING

ALTER TABLE BASS1.G_A_02055_DAY_down20110321
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select * from   BASS1.G_A_02055_DAY_down20110321


select * from   bass2.dw_enter

bass2.DWD_GROUP_ORDER_FEATUR_$timestamp

select tabname from syscat.tables where tabname like '%DWD_ENTERPRISE_SUB%'

select * from   G_A_02055_DAY_down20110321 where ENTERPRISE_ID = '89103000041929'


select date(DONE_DATE) from   bass2.DWD_ENTERPRISE_SUB_20101001 WHERE GROUP_ID = '89103000041929'
AND DONE_DATE LIKE '2009-11%'

select 20110328
,a.ENTERPRISE_ID
,a.ENTERPRISE_BUSI_TYPE
,a.MANAGE_MODE
,a.PAY_TYPE
,a.CREATE_MODE
,'20110328' ORDER_DATE
,'2' STATUS_ID
from bass1.G_A_02055_DAY_down20110321 a
where  ENTERPRISE_ID = '89103000041929'


select * from G_A_02055_DAY
where ENTERPRISE_ID = '89103000041929'
and ENTERPRISE_BUSI_TYPE = '1340'

delete from   G_A_02055_DAY where ENTERPRISE_ID = '89103000041929'

select * from app.sch_control_alarm 


select * from   G_A_02055_DAY


select * from app.sch_control_alarm where alarmtime >= timestamp('20110329'||'000000') --and flag = -1 and control_code like 'BASS1%'

select * from bass2.dim_test_enterprise

select * from syscat.tables where tabname like 'DIM%ENTERPRISE%'


select * from    BASS1.t_grp_id_old_new_map

--目标表
drop table BASS1.t_grp_id_old_new_map

CREATE TABLE BASS1.t_grp_id_old_new_map
 (
	 area_id            		INTEGER              ----数据日期        
	,OLD_ENTERPRISE_ID      		CHAR(20)             ----old集团客户标识    
	,NEW_ENTERPRISE_ID      		CHAR(20)            ----new集团客户标识    
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OLD_ENTERPRISE_ID,NEW_ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.t_grp_id_old_new_map
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select distinct length(trim(NEW_ENTERPRISE_ID)) from   BASS1.t_grp_id_old_new_map
where  length(trim(NEW_ENTERPRISE_ID)) <> 14

select * from   BASS1.t_grp_id_old_new_map
where  length(trim(NEW_ENTERPRISE_ID)) = 14

select * from   BASS1.t_grp_id_old_new_map
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID



 
 CREATE TABLE BASS1.grp_id_old_new_map_20110330 like BASS1.t_grp_id_old_new_map
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OLD_ENTERPRISE_ID,NEW_ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.grp_id_old_new_map_20110330
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  insert into   BASS1.grp_id_old_new_map_20110330
select * from   BASS1.t_grp_id_old_new_map
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID

select * from   BASS1.grp_id_old_new_map_20110330


select count(0),count(distinct OLD_ENTERPRISE_ID) from   BASS1.grp_id_old_new_map_20110330
select count(0),count(distinct NEW_ENTERPRISE_ID) from   BASS1.grp_id_old_new_map_20110330


select 
*
from (        
select a.*,row_number()over(partition by OLD_ENTERPRISE_ID order by ENTERPRISE_NAME desc ) rn  from   BASS1.t_grp_id_old_new_map a
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID
) t
order by 2,5

delete from  BASS1.grp_id_old_new_map_20110330
insert into   BASS1.grp_id_old_new_map_20110330
select 
         AREA_ID
        ,OLD_ENTERPRISE_ID
        ,NEW_ENTERPRISE_ID
        ,ENTERPRISE_NAME
from (        
select a.*,row_number()over(partition by OLD_ENTERPRISE_ID order by ENTERPRISE_NAME desc ) rn  from   BASS1.t_grp_id_old_new_map a
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID
) t where rn = 1





select * from    BASS1.grp_id_old_new_map_20110330


select count(0) from app.g_unit_info where unit_code='04002'

select * from app.g_unit_info where unit_code='77780'
delete from app.g_unit_info where unit_code='77780'
insert into app.g_unit_info values ('77780',0,'重要集团客户拍照置换清单','BASS1.G_I_77780_DAY',1,0,0)


CREATE TABLE BASS1.dim_bass1_std_map
 (
	 interface_code       INTEGER            
	,dim_table_id      		CHAR(20)       NOT NULL      
	,code                 CHAR(9)        NOT NULL				       
	,code_name    		    CHAR(60)       NOT NULL											
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (dim_table_id,code) USING HASHING


ALTER TABLE BASS1.dim_bass1_std_map
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE   
   
select * from   BASS1.dim_bass1_std_map where dim_table_id = 'BASS_STD1_0001' 
   



select ENTER_TYPE_ID from   G_I_77778_DAY
group by ENTER_TYPE_ID

select * from   G_I_77778_DAY

select count(0)
from 
(select distinct ENTER_TYPE_ID ENTER_TYPE_ID from   G_I_77778_DAY) a 
where ENTER_TYPE_ID  not in (select code from BASS1.dim_bass1_std_map where interface_code = '77780' and dim_table_id ='BASS_STD1_0001')

group by ENTER_TYPE_ID


drop table BASS1.dim_bass1_std_map
CREATE TABLE BASS1.dim_bass1_std_map
 (
	 interface_code       CHAR(5)            
	,dim_table_id      		CHAR(20)       NOT NULL      
	,code                 CHAR(9)        NOT NULL				       
	,code_name    		    CHAR(60)       NOT NULL											
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (dim_table_id,code) USING HASHING

ALTER TABLE BASS1.dim_bass1_std_map
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select * from  bass1.G_I_77778_DAY 

create nickname xzbass1.G_I_77778_DAY 
for db25.bass1.G_I_77778_DAY

insert into bass1.G_I_77778_DAY 
select * from 
 xzbass1.G_I_77778_DAY 
 
drop nickname xzbass1.G_I_77778_DAY 


select * from syscat.tables where tabschema = 'XZBASS2'


------------nick name 
select * from  bass1.G_I_77778_DAY 

create nickname xzbass1.G_I_77778_DAY 
for db25.bass1.G_I_77778_DAY

insert into bass1.G_I_77778_DAY 
select * from 
 xzbass1.G_I_77778_DAY 
 
drop nickname xzbass1.G_I_77778_DAY 

------------nick name 

select count(0)
from 
(select distinct EC_TYPE EC_TYPE from   G_I_77778_DAY) a 
where EC_TYPE   in 
	(select code from BASS1.dim_bass1_std_map 
		where interface_code = '77780' 
		and dim_table_id ='BASS_STD1_0002'
  )
  
  
  
select count(0)
from 
(select distinct CONTROL_TYPE CONTROL_TYPE from   G_I_77778_DAY) a 
where CONTROL_TYPE  not in 
	(select code from BASS1.dim_bass1_std_map 
		where interface_code = '77780' 
		and dim_table_id ='BASS_STD1_0005'
  )
  
  
  
 
select count(distinct ENTERPRISE_ID),count(distinct ID),count(0) from bass1.G_I_77778_DAY 

 
 
 CREATE TABLE BASS1.G_I_77780_DAY_MID like bass1.G_I_77780_DAY
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  
 
---中间表:
drop table  BASS1.G_I_77780_DAY_MID 

drop table  BASS1.G_I_77780_DAY_MID 
CREATE TABLE BASS1.G_I_77780_DAY_MID (
	 TIME_ID            		INTEGER               ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)              ----集团客户标识    
	,ID                 		CHAR(9)        								----ID*              
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
	,ORG_TYPE           		CHAR(5)             					----机构类型 							BASS_STD_0001       
		--GROUP_TYPE不规范CHAR(6) 
	,ADDR_CODE          		VARCHAR(10)             					----地址代码*        
	,CITY               		CHAR(20)            					----城市地区*        
	---REGION 不规范            		CHAR(20) 
	,REGION             		VARCHAR(100)            					----区县*            
	---COUNTY 不规范            		CHAR(20) 	
	,COUNTY             		VARCHAR(100)            					----乡镇*            
	,DOOR_NO            		CHAR(60)            					----门牌*            
	,AREA_CODE          		CHAR(5)             					----区号*            
	--PHONE_NO1 不规范  12       		CHAR(11)
	,PHONE_NO1          		varCHAR(111)            					----电话1*           
	--,PHONE_NO2  不规范  13        		CHAR(10) 
	,PHONE_NO2          		VARCHAR(110)            					----电话2*           
	--POST_CODE 不规范  14         		CHAR(6)
	,POST_CODE          		varCHAR(16)             					----邮政编码*        
--	,INDUSTRY_TYPE  不规范  15    		CHAR(4) 
	,INDUSTRY_TYPE      		VARCHAR(14)             					----行业类型 							BASS_STD1_0113       
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数*      
	--ECONOMIC_TYPE  不规范  18    		CHAR(3)
	,ECONOMIC_TYPE      		CHAR(13)             					----经济类型 							BASS_STD_0002       
	--OPEN_YEAR  不规范  19        		CHAR(4)
	,OPEN_YEAR          		varCHAR(14)             					----开业1           
	--OPEN_MONTH 不规范  20        		CHAR(2) 
	,OPEN_MONTH         		varCHAR(22)             					----开业2           
	--SHAREHOLDER不规范CHAR(1) 
	,SHAREHOLDER        		VARCHAR(4)             					----控股  								BASS_STD_0005          
	--GROUP_TYPE不规范CHAR(1) 
	,GROUP_TYPE         		VARCHAR(2)             					----集团类型 							BASS_STD_0003       
	--MANAGE_STYLE不规范CHAR(1) 
	,MANAGE_STYLE       		VARCHAR(4)             					----经营形式      				BASS_STD_0004  
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类 					BASS_STD_0006   
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类     					BASS_STD_0007   
	,INDUSTRY_CLASS_CODE		CHAR(2)            	----行业分类编码 					BASS_STD1_0043   
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)            	----上传种类标识    
)
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,ENTERPRISE_ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
    

  
  
 select * from bass1.G_I_77780_DAY_MID
 
 
 select ADDR_CODE , count(0) 
--,  count(distinct ADDR_CODE ) 
from bass1.G_I_77780_DAY_MID 
group by  ADDR_CODE 
order by 1 


select length(ADDR_CODE) , count(0) 
--,  count(distinct length(ADDR_CODE) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(ADDR_CODE) 
order by 1 



drop table BASS1.G_I_77780_DAY
CREATE TABLE BASS1.G_I_77780_DAY
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       					       ----集团客户标识    
	,ID                 		CHAR(9)        								----ID*              
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
	,ORG_TYPE           		CHAR(5)             					----机构类型 							BASS_STD_0001       
	,ADDR_CODE          		CHAR(6)             					----地址代码*        
	,CITY               		CHAR(20)            					----城市地区*        
	,REGION             		CHAR(20)            					----区县*            
	,COUNTY             		CHAR(20)            					----乡镇*            
	,DOOR_NO            		CHAR(60)            					----门牌*            
	,AREA_CODE          		CHAR(5)             					----区号*            
	,PHONE_NO1          		CHAR(11)            					----电话1*           
	,PHONE_NO2          		CHAR(10)            					----电话2*           
	,POST_CODE          		CHAR(6)             					----邮政编码*        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型 							BASS_STD1_0113       
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数*      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型 							BASS_STD_0002       
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股  								BASS_STD_0005          
	,GROUP_TYPE         		CHAR(1)             					----集团类型 							BASS_STD_0003       
	,MANAGE_STYLE       		CHAR(1)             					----经营形式      				BASS_STD_0004  
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类 					BASS_STD_0006   
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类     					BASS_STD_0007   
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码 					BASS_STD1_0043   
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  



select length(REGION) , count(0) 
--,  count(distinct length(REGION) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(REGION) 
order by 1 


select REGION , count(0) 
--,  count(distinct REGION ) 
from bass1.G_I_77780_DAY_MID 
group by  REGION 
order by 1 


select COUNTY , count(0) 
--,  count(distinct COUNTY ) 
from bass1.G_I_77780_DAY_MID 
group by  COUNTY 
order by 1 


select PHONE_NO1 , count(0) 
--,  count(distinct PHONE_NO1 ) 
from bass1.G_I_77780_DAY_MID 
group by  PHONE_NO1 
order by 1 


select PHONE_NO2 , count(0) 
--,  count(distinct PHONE_NO2 ) 
from bass1.G_I_77780_DAY_MID 
group by  PHONE_NO2 
order by 1 




select POST_CODE , count(0) 
--,  count(distinct POST_CODE ) 
from bass1.G_I_77780_DAY_MID 
group by  POST_CODE 
order by 1 



select INDUSTRY_TYPE , count(0) 
--,  count(distinct INDUSTRY_TYPE ) 
from bass1.G_I_77780_DAY_MID 
group by  INDUSTRY_TYPE 
order by 1 

select INDUSTRY_TYPE , count(0) 
--,  count(distinct INDUSTRY_TYPE ) 
from bass1.G_I_77780_DAY_MID 
where  length(INDUSTRY_TYPE)  = 6
group by  INDUSTRY_TYPE 
order by 1 

select length(INDUSTRY_TYPE) , count(0) 
--,  count(distinct length(INDUSTRY_TYPE) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(INDUSTRY_TYPE) 
order by 1 


select length(trim(ECONOMIC_TYPE)) , count(0) 
--,  count(distinct length(ECONOMIC_TYPE) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(trim(ECONOMIC_TYPE))
order by 1 

select ECONOMIC_TYPE , count(0) 
--,  count(distinct ECONOMIC_TYPE ) 
from bass1.G_I_77780_DAY_MID 
--where length(trim(ECONOMIC_TYPE)) <> 3
group by  ECONOMIC_TYPE 
order by 1 


select ECONOMIC_TYPE , count(0) 
--,  count(distinct ECONOMIC_TYPE ) 
from bass1.G_I_77780_DAY_MID 
where length(trim(ECONOMIC_TYPE)) <> 3
group by  ECONOMIC_TYPE 
order by 1 



select OPEN_YEAR , count(0) 
--,  count(distinct OPEN_YEAR ) 
from bass1.G_I_77780_DAY_MID 
group by  OPEN_YEAR 
order by 1 


select length(OPEN_YEAR) , count(0) 
--,  count(distinct length(OPEN_YEAR) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(OPEN_YEAR) 
order by 1 

select OPEN_YEAR , count(0) 
--,  count(distinct OPEN_YEAR ) 
from bass1.G_I_77780_DAY_MID 
where length(OPEN_YEAR)  <> 4 or OPEN_YEAR is null 
group by  OPEN_YEAR 
order by 1 



select length(OPEN_MONTH) , count(0) 
--,  count(distinct length(OPEN_MONTH) ) 
from bass1.G_I_77780_DAY_MID 
group by  length(OPEN_MONTH) 
order by 1 


select open_MONTH , count(0) 
--,  count(distinct open_MONTH ) 
from bass1.G_I_77780_DAY_MID 
where  length(OPEN_MONTH)  = 1
group by  open_MONTH 
order by 1 


select SHAREHOLDER , count(0) 
--,  count(distinct SHAREHOLDER ) 
from bass1.G_I_77780_DAY_MID 
group by  SHAREHOLDER 
order by 1 


select MANAGE_STYLE , count(0) 
--,  count(distinct MANAGE_STYLE ) 
from bass1.G_I_77780_DAY_MID 
group by  MANAGE_STYLE 
order by 1 



create view v_G_I_77780_DAY_MID
as
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,replace(PHONE_NO2,'-','') PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID a

insert into bass1.G_I_77780_DAY
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,replace(PHONE_NO2,'-','') PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER is null then '9' 
        	when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,case when GROUP_TYPE not in ('1','2') then '2' else GROUP_TYPE end GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID a

13908934887

select SHAREHOLDER , count(0) 
--,  count(distinct SHAREHOLDER ) 
from bass1.v_G_I_77780_DAY_MID 
group by  SHAREHOLDER 
order by 1 

select GROUP_TYPE , count(0) 
--,  count(distinct GROUP_TYPE ) 
from bass1.v_G_I_77780_DAY_MID 
group by  GROUP_TYPE 
order by 1 

select * from bass1.v_G_I_77780_DAY_MID  where GROUP_TYPE not in ('1','2')

select * from G_I_77780_DAY_MID
where enterprise_id = '89302999648433'


insert into bass1.G_I_77780_DAY
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,substr(replace(PHONE_NO2,'-',''),1,10) PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER is null then '9' 
        	when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,case when GROUP_TYPE not in ('1','2') then '2' else GROUP_TYPE end GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID a




select UPLOAD_TYPE_ID , count(0) 
--,  count(distinct UPLOAD_TYPE_ID ) 
from bass1.v_G_I_77780_DAY_MID 
group by  UPLOAD_TYPE_ID 
order by 1 


insert into bass1.G_I_77780_DAY
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,substr(replace(PHONE_NO2,'-',''),1,10) PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER is null then '9' 
        	when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,case when GROUP_TYPE not in ('1','2') then '2' else GROUP_TYPE end GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
      ,case when INDUSTRY_CLASS_CODE is null then '99' else  INDUSTRY_CLASS_CODE end INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
      ,case when UPLOAD_TYPE_ID is null then '3' else UPLOAD_TYPE_ID end UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID a







select INDUSTRY_CLASS_CODE , count(0) 
--,  count(distinct INDUSTRY_CLASS_CODE ) 
from bass1.v_G_I_77780_DAY_MID 
group by  INDUSTRY_CLASS_CODE 
order by 1 


select * from  bass1.G_I_77780_DAY



select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY


1006	786

select ENTERPRISE_ID||id , count(0)
from bass1.G_I_77780_DAY
group by  ENTERPRISE_ID||id
having count(0) > 1



select * from from bass1.G_I_77780_DAY
where ENTERPRISE_ID||id  is null 

89301560000178      71090731X	2
89301560000994      724901496	2
89302999434694      43320587X	2


select * from bass1.G_I_77780_DAY 
where ENTERPRISE_ID in 
('89301560000178'
,'89301560000994'
,'89302999434694'
)


create table bass1.G_I_77780_DAY_MID2 like bass1.G_I_77780_DAY
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING
   
   
  
ALTER TABLE BASS1.G_I_77780_DAY_MID2
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  
 
insert into bass1.G_I_77780_DAY_MID2
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,substr(replace(PHONE_NO2,'-',''),1,10) PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER is null then '9' 
        	when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,case when GROUP_TYPE not in ('1','2') then '2' else GROUP_TYPE end GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
      ,case when INDUSTRY_CLASS_CODE is null then '99'  else INDUSTRY_CLASS_CODE end INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
      ,case when UPLOAD_TYPE_ID is null then '3' else UPLOAD_TYPE_ID end UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID a
 
 
 
 select * from  BASS1.grp_id_old_new_map_20110330
 
 
 
 select
 
create table bass1.G_I_77780_DAY_MID3 like bass1.G_I_77780_DAY
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING
   
insert into bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* , row_number()over(PARTITION by ENTERPRISE_ID,id order by  UPLOAD_TYPE_ID asc ) rn 
		from  bass1.G_I_77780_DAY_MID2 a ) t where t.rn = 1 
		
        
        
        
       
select UPLOAD_TYPE_ID , count(0) 
--,  count(distinct UPLOAD_TYPE_ID ) 
from bass1.G_I_77780_DAY_MID3 
group by  UPLOAD_TYPE_ID 
order by 1 
       
       
       
      
     
 select count(0)
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
  
     
 select a.ENTERPRISE_ID , b.old_enterprise_id
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
  

     
     
select a.ENTERPRISE_ID , b.old_enterprise_id,b.new_enterprise_id
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
 
     
     
    select a.ENTERPRISE_ID , b.old_enterprise_id,b.new_enterprise_id,a.ENTERPRISE_NAME,b.ENTERPRISE_NAME
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
 and  a.ENTERPRISE_NAME<>b.ENTERPRISE_NAME
 
 
 
    select a.ENTERPRISE_ID , b.old_enterprise_id,b.new_enterprise_id,a.ENTERPRISE_NAME,b.ENTERPRISE_NAME
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
 and  a.ENTERPRISE_NAME<>b.ENTERPRISE_NAME




    select count(0),count(distinct a.ENTERPRISE_ID) ,count(distinct  b.old_enterprise_id)
    ,count(distinct b.new_enterprise_id)
    --,a.ENTERPRISE_NAME,b.ENTERPRISE_NAME
 from bass1.G_I_77780_DAY_MID3 a ,
  BASS1.grp_id_old_new_map_20110330  b where a.ENTERPRISE_ID = b.old_enterprise_id
  

select count(0),count(distinct old_enterprise_id ) from      BASS1.grp_id_old_new_map_20110330 
  
  
  select count(0),count(distinct a.ENTERPRISE_ID ) from  bass1.G_I_77780_DAY_MID3 a
  
  select ENTERPRISE_ID, count(0)
from bass1.G_I_77780_DAY_MID3
group by  ENTERPRISE_ID
having count(0) > 1



select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3

select * from bass1.G_I_77780_DAY_MID3

 update bass1.G_I_77780_DAY_MID3 a
 set a.ENTERPRISE_ID = (select b.new_enterprise_id from  BASS1.grp_id_old_new_map_20110330  b 
 				where   a.ENTERPRISE_ID = b.old_enterprise_id )
                

delete from bass1.G_I_77780_DAY_MID3
insert into bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* , row_number()over(PARTITION by ENTERPRISE_ID,id order by  UPLOAD_TYPE_ID asc ) rn 
				from  bass1.G_I_77780_DAY_MID2 a
			 ) t where t.rn = 1 
		
                
                


select a.*
from  
 bass1.G_I_77780_DAY_MID3 a
 where  a.ENTERPRISE_ID = (select b.new_enterprise_id from  BASS1.grp_id_old_new_map_20110330 b 
 				where   a.ENTERPRISE_ID = b.old_enterprise_id )
 				

                
                
delete from bass1.G_I_77780_DAY_MID3
insert into bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,NEW_ENTERPRISE_ID
        ,ID
        ,NEW_ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* 
		,VALUE(b.new_enterprise_id,a.ENTERPRISE_ID) NEW_ENTERPRISE_ID
		,VALUE(b.ENTERPRISE_NAME,a.ENTERPRISE_NAME) NEW_ENTERPRISE_NAME
		, row_number()over(PARTITION by VALUE(b.new_enterprise_id,a.ENTERPRISE_ID),id order by  UPLOAD_TYPE_ID asc ) rn 
				from  bass1.G_I_77780_DAY_MID2 a
				left join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id
			 ) t where t.rn = 1 
		

                
                
 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3

                
select UPLOAD_TYPE_ID , count(0) 
--,  count(distinct UPLOAD_TYPE_ID ) 
from bass1.G_I_77780_DAY_MID3 
group by  UPLOAD_TYPE_ID 
order by 1 


select 
         TIME_ID
        ,NEW_ENTERPRISE_ID
        ,ID
        ,NEW_ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* 
		,VALUE(b.new_enterprise_id,a.ENTERPRISE_ID) NEW_ENTERPRISE_ID
		,VALUE(b.ENTERPRISE_NAME,a.ENTERPRISE_NAME) NEW_ENTERPRISE_NAME
		, row_number()over(PARTITION by VALUE(b.new_enterprise_id,a.ENTERPRISE_ID),id order by  UPLOAD_TYPE_ID asc ) rn 
				from  bass1.G_I_77780_DAY_MID2 a
				left join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id
			 ) t 
where           t.new_enterprise_id is null 
   
		
                select count(0)
				from  bass1.G_I_77780_DAY_MID2 a
				left join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id                
                select * from bass1.G_I_77780_DAY_MID3
                
                select * from BASS1.grp_id_old_new_map_20110330
                
                
 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3

 

delete from bass1.G_I_77780_DAY_MID3
insert into bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,NEW_ENTERPRISE_ID
        ,ID
        ,NEW_ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* 
		,VALUE(b.new_enterprise_id,a.ENTERPRISE_ID) NEW_ENTERPRISE_ID
		,VALUE(b.ENTERPRISE_NAME,a.ENTERPRISE_NAME) NEW_ENTERPRISE_NAME
		, row_number()over(PARTITION by ENTERPRISE_ID,id order by  UPLOAD_TYPE_ID asc ) rn 
				from  bass1.G_I_77780_DAY_MID2 a
				left join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id
			 ) t where t.rn = 1 
		
        
select * from G_I_77780_DAY_MID3
where ENTERPRISE_ID in ('89402999933152'
,'89401560000324'
,'89401560000324'
,'89402999933152'
,'89401560000324'
,'89403000381097'
)                

select * from G_I_77780_DAY_MID2
where id in 
(   select id 
    from  G_I_77780_DAY_MID3
    where ENTERPRISE_ID in ('89402999933152'
                            ,'89401560000324'
                            ,'89401560000324'
                            ,'89402999933152'
                            ,'89401560000324'
                            ,'89403000381097'
                            )                
) 

select value(ENTERPRISE_ID,'a')||value(id,'a')
from G_I_77780_DAY_MID3
group by value(ENTERPRISE_ID,'a')||value(id,'a')
having count(0) > 1
)

       
       1
89402999933152      724904515
89401560000324      710905728
89401560000324      DX093350X
89402999933152      741930176
89401560000324      DX0933489
89403000381097      DX0933251





select * from   bass1.G_I_77780_DAY_MID2


create table bass1.G_I_77780_DAY_MID4 like bass1.G_I_77780_DAY
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING
   
   select * from     bass1.G_I_77780_DAY_MID4
   
   
  insert into     bass1.G_I_77780_DAY_MID4
select * from bass1.G_I_77780_DAY_MID3
where ENTERPRISE_ID in ('89402999933152'
,'89401560000324'
,'89401560000324'
,'89402999933152'
,'89401560000324'
,'89403000381097'
)        


select UPLOAD_TYPE_ID , count(0) 
--,  count(distinct UPLOAD_TYPE_ID ) 
from bass1.G_I_77780_DAY_MID3 
group by  UPLOAD_TYPE_ID 
order by 1 

1	242 +4
2	243 +3
3	505


delete from  bass1.G_I_77780_DAY_MID3
where ENTERPRISE_ID in ('89402999933152'
,'89401560000324'
,'89401560000324'
,'89402999933152'
,'89401560000324'
,'89403000381097'
)    
		

select distinct ENTERPRISE_ID,id ,UPLOAD_TYPE_ID from bass1.G_I_77780_DAY_MID4
where ENTERPRISE_ID in ('89402999933152'
,'89401560000324'
,'89401560000324'
,'89402999933152'
,'89401560000324'
,'89403000381097'
)    

select * from 
(
select a.*,row_number()over(partition by ENTERPRISE_ID,id ) rn 
from  bass1.G_I_77780_DAY_MID4 a )
t where rn = 1 




		
        

insert into     bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
 from 
(
select a.*,row_number()over(partition by ENTERPRISE_ID,id ) rn 
from  bass1.G_I_77780_DAY_MID4 a )
t where rn = 1 

		        
--主键校验 
 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3

997	997

ok

                
                
                
select count(0)
from 
(select distinct ORG_TYPE ORG_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ORG_TYPE  not in (select code from BASS1.dim_bass1_std_map where interface_code = '77780' and dim_table_id ='BASS_STD1_0001')

select *
from 
(select distinct ORG_TYPE ORG_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ORG_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0001')


                
select ORG_TYPE , count(0) 
--,  count(distinct ORG_TYPE ) 
from bass1.G_I_77780_DAY_MID3 
group by  ORG_TYPE 
order by 1 

                

update  bass1.G_I_77780_DAY_MID3
set ORG_TYPE = '51'
where ORG_TYPE = '5'


                
                
select INDUSTRY_TYPE , count(0) 
--,  count(distinct INDUSTRY_TYPE ) 
from bass1.G_I_77780_DAY_MID3 
group by  INDUSTRY_TYPE 
order by 1 

                
                
drop table BASS1.t_bass1_std_0113
CREATE TABLE BASS1.t_bass1_std_0113
 (
	 code    char(4)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (code) USING HASHING
                

 select count(0)
from 
(select distinct trim(INDUSTRY_TYPE) INDUSTRY_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_TYPE  not in 
(select code from BASS1.t_bass1_std_0113 )
                
                

select EMPLOYEE_CNT , count(0) 
--,  count(distinct EMPLOYEE_CNT ) 
from bass1.G_I_77780_DAY_MID3 
group by  EMPLOYEE_CNT 
order by 1 


                
               
select int(EMPLOYEE_CNT)+ 0 from bass1.G_I_77780_DAY_MID3                


update  bass1.G_I_77780_DAY_MID3
set EMPLOYEE_CNT = '0'
where EMPLOYEE_CNT is null 


select *
from 
(select distinct trim(ECONOMIC_TYPE) ECONOMIC_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ECONOMIC_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0002')

100
101
150
170

110


select ECONOMIC_TYPE , count(0) 
--,  count(distinct EMPLOYEE_CNT ) 
from bass1.G_I_77780_DAY_MID3 
group by  ECONOMIC_TYPE 
order by 1 




select *  from  BASS1.dim_bass1_std_map 

update G_I_77780_DAY_MID3 
set ECONOMIC_TYPE = '110'
where ECONOMIC_TYPE in 
('100'
,'101'
,'150'
,'170'
)



select count(0)
from 
(select distinct SHAREHOLDER SHAREHOLDER from   bass1.G_I_77780_DAY_MID3) a 
where SHAREHOLDER  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0005')



select count(0)
from 
(select distinct GROUP_TYPE GROUP_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where GROUP_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0003')



select count(0)
from 
(select distinct MANAGE_STYLE MANAGE_STYLE from   bass1.G_I_77780_DAY_MID3) a 
where MANAGE_STYLE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0004')



select count(0)
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')




update G_I_77780_DAY_MID3 
set OPERATE_REVENUE_CLASS = '0'||OPERATE_REVENUE_CLASS
where length(trim(OPERATE_REVENUE_CLASS)) = 1


update G_I_77780_DAY_MID3 
set OPERATE_REVENUE_CLASS = '10'
where OPERATE_REVENUE_CLASS is null 


select count(0)
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')




select *
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')




update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '0'||trim(CAPITAL_CLASS)
where length(trim(CAPITAL_CLASS)) = 1



update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '05'
where CAPITAL_CLASS is null 




update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '01'
where CAPITAL_CLASS = '00'



SELECT * FROM  BASS1.dim_bass1_std_map 


select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3


select distinct UPLOAD_TYPE_ID UPLOAD_TYPE_ID from   bass1.G_I_77780_DAY_MID3


update G_I_77780_DAY_MID3 
set INDUSTRY_CLASS_CODE = '0'||TRIM(INDUSTRY_CLASS_CODE)
where length(trim(INDUSTRY_CLASS_CODE)) = 1


update G_I_77780_DAY_MID3 
set CUST_STATUS = '36'
where  CUST_STATUS IS NULL 



select CUST_INFO_SRC_ID , count(0) 
--,  count(distinct CUST_INFO_SRC_ID ) 
from bass1.G_I_77780_DAY_MID3 
group by  CUST_INFO_SRC_ID 
order by 1 




update G_I_77780_DAY_MID3 
set CUST_INFO_SRC_ID = '1'
where  CUST_INFO_SRC_ID IS NULL 


select distinct  from   




 select count(0)
from 
(select distinct trim(INDUSTRY_TYPE) INDUSTRY_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_TYPE  not in 
(select code from BASS1.t_bass1_std_0113 )

delete from BASS1.G_I_77780_DAY

insert into BASS1.G_I_77780_DAY
select * from bass1.G_I_77780_DAY_MID3

select upload_type_id,count(0)
from BASS1.G_I_77780_DAY
group by upload_type_id

select * from  BASS1.G_I_77780_DAY


drop table BASS1.G_I_77780_DAY
CREATE TABLE BASS1.G_I_77780_DAY
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       					       ----集团客户标识    
	,ID                 		CHAR(9)        								----ID*              
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
	,ORG_TYPE           		CHAR(5)             					----机构类型 							BASS_STD_0001       
	,ADDR_CODE          		CHAR(6)             					----地址代码*        
	,CITY               		CHAR(20)            					----城市地区*        
	,REGION             		CHAR(20)            					----区县*            
	,COUNTY             		CHAR(20)            					----乡镇*            
	,DOOR_NO            		CHAR(60)            					----门牌*            
	,AREA_CODE          		CHAR(5)             					----区号*            
	,PHONE_NO1          		CHAR(11)            					----电话1*           
	,PHONE_NO2          		CHAR(10)            					----电话2*           
	,POST_CODE          		CHAR(6)             					----邮政编码*        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型 							BASS_STD1_0113       
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数*      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型 							BASS_STD_0002       
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股  								BASS_STD_0005          
	,GROUP_TYPE         		CHAR(1)             					----集团类型 							BASS_STD_0003       
	,MANAGE_STYLE       		CHAR(1)             					----经营形式      				BASS_STD_0004  
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类 					BASS_STD_0006   
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类     					BASS_STD_0007   
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码 					BASS_STD1_0043   
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  
  select count(0) from BASS1.G_I_77780_DAY
  
  select * from app.g_unit_info where unit_code='77780'


select * from   app.sch_control_task 

         CONTROL_CODE
        ,DEAL_TIME
        ,CMD_TYPE
        ,CMD_LINE
        ,PRIORITY_VAL
        ,TIME_VALUE
        ,FUNCTION_DESC
        ,CC_GROUP_CODE
        ,MO_GROUP_CODE
        ,CC_FLAG
        ,APP_DIR
        
select * from   app.sch_control_task where control_code like 'BASS1%DAY.tcl'
BASS1_EXP_G_A_02008_DAY	1	2	bass1_export bass1.g_a_02008_day YESTERDAY()	10000	2	02008	app	BASS1	1	/bassapp/backapp/bin/bass1_export/

delete from  app.sch_control_task  where control_code = 'BASS1_EXP_G_I_77780_DAY'

select * from   app.sch_control_task 

delete from app.sch_control_before where control_code = 'BASS1_EXP_G_I_77780_DAY'
insert into app.sch_control_before values ('BASS1_EXP_G_I_77780_DAY','BASS1_EXP_G_S_04008_DAY')
delete from  app.sch_control_task where control_code = 'BASS1_EXP_G_I_77780_DAY'
insert into app.sch_control_task values ('BASS1_EXP_G_I_77780_DAY',1,2,'bass1_export bass1.g_i_77780_day YESTERDAY()',0,-1,'重要集团客户拍照置换清单','app','BASS1',1,'/bassapp/backapp/bin/bass1_export/')


update  app.sch_control_task
set cc_flag = 2
where control_code = 'BASS1_EXP_G_I_77780_DAY'


delete from app.g_unit_info where unit_code='77780'
insert into app.g_unit_info values ('77780',0,'重要集团客户拍照置换清单','bass1.g_i_77780_day',1,0,0)

select * from   app.sch_control_map where control_code like '%7778%'

select * from   bass1.int_program_data where program_name like '%7778%'

select * from   app.sch_control_before where control_code like '%7778%'



select ENTERPRISE_ID||ID||ENTERPRISE_NAME||ORG_TYPE||ADDR_CODE||CITY||REGION||COUNTY||DOOR_NO||AREA_CODE||PHONE_NO1||PHONE_NO2||POST_CODE||INDUSTRY_TYPE||EMPLOYEE_CNT||INDUSTRY_UNIT_CNT||ECONOMIC_TYPE||OPEN_YEAR||OPEN_MONTH||SHAREHOLDER||GROUP_TYPE||MANAGE_STYLE||OPERATE_REVENUE_CLASS||CAPITAL_CLASS||INDUSTRY_CLASS_CODE||CUST_STATUS||CUST_INFO_SRC_ID||UPLOAD_TYPE_ID 
from bass1.g_i_77780_day where time_id=20101231


select *  
from bass1.g_i_77780_day where time_id=20101231



select ENTERPRISE_ID||ID||ENTERPRISE_NAME||ORG_TYPE||ADDR_CODE||CITY||REGION||COUNTY||DOOR_NO||AREA_CODE||PHONE_NO1||PHONE_NO2||POST_CODE||INDUSTRY_TYPE||EMPLOYEE_CNT||INDUSTRY_UNIT_CNT||ECONOMIC_TYPE||OPEN_YEAR||OPEN_MONTH||SHAREHOLDER||GROUP_TYPE||MANAGE_STYLE||OPERATE_REVENUE_CLASS||CAPITAL_CLASS||INDUSTRY_CLASS_CODE||CUST_STATUS||CUST_INFO_SRC_ID||UPLOAD_TYPE_ID 
from bass1.g_i_77780_day where time_id=20101231


select * from g_i_77778_day




update BASS1.G_I_77780_DAY
set ENTERPRISE_ID = ' '
where ENTERPRISE_ID is null;
UPDATE BASS1.G_I_77780_DAY SET ID = ' ' 
WHERE ID IS NULL;
UPDATE BASS1.G_I_77780_DAY SET ENTERPRISE_NAME = ' ' 
WHERE ENTERPRISE_NAME IS NULL;
UPDATE BASS1.G_I_77780_DAY SET ORG_TYPE = ' ' 
WHERE ORG_TYPE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET CITY = ' ' 
WHERE CITY IS NULL;
UPDATE BASS1.G_I_77780_DAY SET REGION = ' ' 
WHERE REGION IS NULL;
UPDATE BASS1.G_I_77780_DAY SET COUNTY = ' ' 
WHERE COUNTY IS NULL;
UPDATE BASS1.G_I_77780_DAY SET DOOR_NO = ' ' 
WHERE DOOR_NO IS NULL;
UPDATE BASS1.G_I_77780_DAY SET AREA_CODE = ' ' 
WHERE AREA_CODE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET PHONE_NO1 = ' ' 
WHERE PHONE_NO1 IS NULL;
UPDATE BASS1.G_I_77780_DAY SET PHONE_NO2 = ' ' 
WHERE PHONE_NO2 IS NULL;
UPDATE BASS1.G_I_77780_DAY SET POST_CODE = ' ' 
WHERE POST_CODE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_TYPE = ' ' 
WHERE INDUSTRY_TYPE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET EMPLOYEE_CNT = ' ' 
WHERE EMPLOYEE_CNT IS NULL;
UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_UNIT_CNT = ' ' 
WHERE INDUSTRY_UNIT_CNT IS NULL;
UPDATE BASS1.G_I_77780_DAY SET ECONOMIC_TYPE = ' ' 
WHERE ECONOMIC_TYPE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET OPEN_YEAR = ' ' 
WHERE OPEN_YEAR IS NULL;
UPDATE BASS1.G_I_77780_DAY SET OPEN_MONTH = ' ' 
WHERE OPEN_MONTH IS NULL;
UPDATE BASS1.G_I_77780_DAY SET SHAREHOLDER = ' ' 
WHERE SHAREHOLDER IS NULL;
UPDATE BASS1.G_I_77780_DAY SET GROUP_TYPE = ' ' 
WHERE GROUP_TYPE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET MANAGE_STYLE = ' ' 
WHERE MANAGE_STYLE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET OPERATE_REVENUE_CLASS = ' ' 
WHERE OPERATE_REVENUE_CLASS IS NULL;
UPDATE BASS1.G_I_77780_DAY SET CAPITAL_CLASS = ' ' 
WHERE CAPITAL_CLASS IS NULL;
UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_CLASS_CODE = ' ' 
WHERE INDUSTRY_CLASS_CODE IS NULL;
UPDATE BASS1.G_I_77780_DAY SET CUST_STATUS = ' ' 
WHERE CUST_STATUS IS NULL;
UPDATE BASS1.G_I_77780_DAY SET CUST_INFO_SRC_ID = ' ' 
WHERE CUST_INFO_SRC_ID IS NULL;
UPDATE BASS1.G_I_77780_DAY SET UPLOAD_TYPE_ID = ' ' 
WHERE UPLOAD_TYPE_ID IS NULL;
select * from    BASS1.G_I_77780_DAY

 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from   BASS1.G_I_77780_DAY



select * from app.g_runlog 
where time_id=20101231
and return_flag=0

select count(0)
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from    BASS1.G_I_77780_DAY) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')



select INDUSTRY_TYPE from    BASS1.G_I_77780_DAY
where enterprise_id
in 
('89103000135199'
,'89108911013693'
,'89103001215411'
,'89101560001610'
,'89100000003719'
)

2050
3000
7214



 select distinct CUST_STATUS CUST_STATUS from   BASS1.G_I_77780_DAY
 
CUST_STATUS
10
12
20
30
36

select * from 



update BASS1.G_I_77780_DAY
set INDUSTRY_TYPE = '7210'
where INDUSTRY_TYPE = '7214'




select CUST_STATUS , count(0) 
--,  count(distinct CUST_STATUS ) 
from BASS1.G_I_77780_DAY 
group by  CUST_STATUS 
order by 1 

10	47
12	7
20	842
30	72
36	29


10-
 11-
 12-
20-
30-
 31-
 32-
 33-
 34-
 35-
 36-
 
update BASS1.G_I_77780_DAY
set CUST_STATUS = '11'
where CUST_STATUS = '10'

update BASS1.G_I_77780_DAY
set CUST_STATUS = '31'
where CUST_STATUS = '30'






select * from  BASS1.t_bass1_std_0113
where code = '9011'

 select count(0)
from 
(select distinct trim(INDUSTRY_TYPE) INDUSTRY_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_TYPE  not in 
(select code from BASS1.t_bass1_std_0113 )




update BASS1.G_I_77780_DAY
set INDUSTRY_TYPE = '9010'
where INDUSTRY_TYPE = '9011'


89103000135199
89108911013693
89103001215411
89101560001610
89100000003719





update BASS1.G_I_77780_DAY
set INDUSTRY_TYPE = '3010'
where INDUSTRY_TYPE = '3000'


update BASS1.G_I_77780_DAY
set INDUSTRY_TYPE = '2040'
where INDUSTRY_TYPE = '2050'



select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
--and flag = -1
and control_code not  like 'BASS1%'
order by alarmtime desc 

select * from   BASS1.G_S_04002_DAY_20100501BAK


select * from   app.sch_control_before where control_code = 'BASS1_G_S_04015_DAY.tcl'
BASS1_G_S_04015_DAY.tcl	TR1_L_A98012

select * from   app.sch_control_task where control_code = 'TR1_L_A98012'

DWD_MR_OPER_CDR_YYYYMMDD

select * from  BASS2.DWD_MR_OPER_CDR_20110405
 where op_time = '20110405'
select * from   app.sch_control_runlog where control_code = 'BASS1_G_S_04015_DAY.tcl'

TR1_L_A98012	2011-03-30 6:35:13.182254	2011-03-30 6:35:50.654050	37	0


select * from   app.sch_control_before where control_code = 'TR1_L_A98012'

select * from   app.sch_control_task where control_code = 'TR1_L_A98012'


TR1_L_A98012	1	2	DWD_MR_OPER_CDR_YYYYMMDD	0	-1		-	TR1_MR	2	-

select * from   app.sch_control_runlog where control_code like 'TR1_%98%'
select hour(begintime),count(0)
 from   app.sch_control_runlog where flag = 0
 and date(begintime) = '2011-04-01 '
 group by hour(begintime)
 


select * from   syscat.tables where tabname like '%DWD_MR_OPER_CDR%'

select * from app.sch_control_task where 
control_code in (select  control_code from   app.sch_control_runlog where flag= 1)


update app.sch_control_task
set priority_val = 0
 where control_code = 'TR1_L_A98012'
 
 
 
select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabschema = 'BASS1'

 
select sum(decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2)) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabschema = 'BASS1'


select * from   app.sch_control_task where control_code like '%G_S_22204_MONTH%'



select * from   bass1.G_S_04002_DAY_20100501bak

select * from   bass1.G_S_04018_DAY_20100501bak 

 
 
 		select product_no,imei,count(*) from 
		(
			select product_no,imei from bass1.G_S_04002_DAY
			where time_id between 20110101 and 20110301
		) a
		group by product_no,imei
        
        



RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110331BAK
CREATE TABLE BASS2.DIM_TERM_TAC
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING
ALTER TABLE BASS2.DIM_TERM_TAC
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE


       
select * from   bass2.dim_term_tac
       
       


CREATE TABLE BASS2.DIM_TERM_TAC_0331
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING
ALTER TABLE BASS2.DIM_TERM_TAC_0331
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  

select * from   bass2.DIM_TERM_TAC
except 
select * from   bass2.DIM_TERM_TAC_0331 




 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110331BAK
where net_type <>'2'



       
select count(0) ,count(distinct TAC_NUM) from BASS2.DIM_TERM_TAC_20110331BAK
       
select count(0) ,count(distinct TAC_NUM) from  BASS2.DIM_TERM_TAC
27571	27571

select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110331BAK
group by tac_nuM
having count(*)>1

       
select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110331BAK
group by tac_nuM
having count(*)>1
       
drop table BASS2.DIM_TERM_TAC_0331


 
delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_0331

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110331BAK
where net_type <>'2'
       

select count(0)
from (
		select product_no,imei,count(*) 
		from bass1.G_S_04002_DAY
		where time_id between  20110101 and 20110331
		  and mns_type='1'
		group by product_no,imei
) t

4.02

select count(0)
from (
select product_no,imei,count(*) from 
(
select product_no,imei from bass1.G_S_04002_DAY
where time_id between  20110101 and 20110331
  and mns_type='1'
) a
group by product_no,imei
) t 
3.05
       
select * from   syscat.tables where tabname like '%EXPLAIN%'       


select distinct intra_product_no,product_no 
		  from bass1.G_S_04018_DAY a
		  where time_id between $last_last_month_day and $this_month_last_day
          
select * from   app.sch_control_before where before_control_code like '%G_S_22204_MONTH%'          

select * from   bass1.g_s_22204_month

select * from    bass1.td_check_user_flow

                select 
                sum(bigint(flows))
                from bass1.g_s_04002_day_flows
          
         
select * from   bass1.g_s_22204_month
select * from   bass1.g_s_04002_day_td
         
                select product_no,imei,count(0) 
                from bass1.G_S_04002_DAY a
                where time_id between 20101201 and 20110228
                group by product_no,imei
          
select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_s_22204_month 
group by  time_id 
order by 1 
          
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 
          
          
select * from   bass1.td_check_user_status_ls
          
select * from    bass1.g_s_22204_month_tmp3
          
select * from   bass1.g_s_22204_month_tmp3 


select * from  bass1.G_I_77778_DAY 

create nickname xzbass1.sch_control_map 
for db25.app.sch_control_map
select * from   app.sch_control_map 

insert into app.sch_control_map 
select * from 
xzbass1.sch_control_map 
where lower(control_code) like '%report_key_index_month%' 

drop nickname xzbass1.sch_control_map 



create nickname xzbass1.sch_control_task 
for db25.app.sch_control_task

insert into app.sch_control_task 
select * from 
xzbass1.sch_control_task 
where lower(control_code) like '%report_key_index_month%' 

drop nickname xzbass1.sch_control_task 


create nickname xzbass1.int_program_data 
for db25.bass1.int_program_data
select * from  xzbass1.int_program_data where lower(program_name) like '%report_key_index_month%' 
 

insert into bass1.int_program_data 
select * from 
xzbass1.int_program_data 
where lower(control_code) like '%report_key_index_month%' 

drop nickname xzbass1.int_program_data 



bass1.int_program_data

          
select * from    bass1.usys_int_control 
          
          
	      SELECT 
	        case 
	          when para_value='0' then char(current date - 1 days)
	          else para_value
	        end
	      FROM bass1.usys_int_control 
	      WHERE para_name='op_time'


select char(count(distinct comp_product_no)) c41
 from  bass2.Dw_comp_cust_dt
 where comp_day_new_mark=1 
  and comp_brand_id in (9,10,11)
 
select time_id,
TEL_MOBILE_NEW_ADD_CNT,
UNION_MOBILE_NEW_ADD_CNT
from 
bass1.G_S_22073_DAY
WHERE time_id >= 20110324 

select * from g_rule_check where rule_code in ('R159_1') and time_id >=20110324



 select distinct user_id from  G_A_02062_DAY
  where time_id <20110301
 and STATUS_ID = '1'
 except
 select distinct a.user_id from  
(select * from session.int_check_user_status   ) a 
,(select distinct user_id from   G_A_02062_DAY where time_id <20110301
 and STATUS_ID = '1') b 
where   a.user_id = b.user_id 
        and usertype_id NOT IN ('2010','2020','2030','9000')
        and test_flag='0'





select * from   APP.G_rule_check

select * from   APP.G_UNIT_INFO


select * from 
bass1.g_rule_check where rule_code = 'R159_4'
and time_id = 20110322


select * from 
bass1.g_rule_check where rule_code = 'R161_15'
where time_id = 20110317

select * from   app.sch_control_task where lower(cmd_line) like '%net%hlr%'

select * from   app.sch_control_runlog where control_code like '%06031%'

select count(0) from   BASS2.DIM_TACNUM_DEVID 
select count(0) from   bass1.G_A_02059_DAY_down20110321

select * from   G_A_02055_DAY


select * from   BASS2.DIM_CONTROL_INFO

select * from   BASS2.DIM_PROPERTY_VALUE_RANGE

select * from   BASS2.DIM_PROPERTY_INFO

select * from   BASS2.DIM_DEVICE_PROFILE

select * from   BASS2.DIM_DEVICE_INFO

select * from   BASS2.DIM_CONTROL_INFO

select * from   BASS2.DIM_TACNUM_DEVID

select count(0) from    BASS2.DIM_TERM_TAC

select * from   BASS2.DIM_TERM_TAC 




          

create nickname xzbass1.G_S_04008_DAY 
for db25.bass1.G_S_04008_DAY

insert into bass1.G_S_04008_DAY
select * from 
 xzbass1.G_S_04008_DAY 
 where time_id = 20110331
 
--drop nickname xzbass1.sch_control_task 

CREATE TABLE "BASS1   "."G_S_04008_DAY0331"  (
		  "TIME_ID" INTEGER NOT NULL , 
		  "PRODUCT_NO" CHAR(15) NOT NULL , 
		  "IMSI" CHAR(15) NOT NULL , 
		  "MSRN" CHAR(11) NOT NULL , 
		  "IMEI" CHAR(17) NOT NULL , 
		  "OPPOSITE_NO" CHAR(24) NOT NULL , 
		  "THIRD_NO" CHAR(24) NOT NULL , 
		  "CITY_ID" CHAR(6) NOT NULL , 
		  "ROAM_LOCN" CHAR(6) NOT NULL , 
		  "OPP_CITY_ID" CHAR(6) NOT NULL , 
		  "OPP_ROAM_LOCN" CHAR(6) NOT NULL , 
		  "ADVERSARY_ID" CHAR(6) NOT NULL , 
		  "ADVERSARY_NET_TYPE" CHAR(2) NOT NULL , 
		  "MSC_CODE" CHAR(11) NOT NULL , 
		  "CELL_ID" CHAR(10) NOT NULL , 
		  "LAC_ID" CHAR(10) NOT NULL , 
		  "OPP_CELL_ID" CHAR(10) NOT NULL , 
		  "OPP_LAC_ID" CHAR(10) NOT NULL , 
		  "OUTGO_TRNK" CHAR(15) NOT NULL , 
		  "INCOMING_TRNK" CHAR(15) NOT NULL , 
		  "START_DATE" CHAR(8) NOT NULL , 
		  "START_TIME" CHAR(6) NOT NULL , 
		  "CALL_DURATION" CHAR(6) NOT NULL , 
		  "BASE_BILL_DURATION" CHAR(6) NOT NULL , 
		  "TOLL_BILL_DURATION" CHAR(6) NOT NULL , 
		  "BILLING_ID" CHAR(1) NOT NULL , 
		  "BASE_CALL_FEE" CHAR(8) NOT NULL , 
		  "TOLL_CALL_FEE" CHAR(8) NOT NULL , 
		  "CALLFW_TOLL_FEE" CHAR(8) , 
		  "INFO_FEE" CHAR(8) NOT NULL , 
		  "FAV_BASE_CALL_FEE" CHAR(8) NOT NULL , 
		  "FAV_TOLL_CALL_FEE" CHAR(8) NOT NULL , 
		  "FAV_CALLFW_TOLL_FEE" CHAR(8) , 
		  "FAV_INFO_FEE" CHAR(8) NOT NULL , 
		  "ROAM_TYPE_ID" CHAR(3) NOT NULL , 
		  "TOLL_TYPE_ID" CHAR(3) NOT NULL , 
		  "SVCITEM_ID" CHAR(3) NOT NULL , 
		  "CALL_TYPE_ID" CHAR(2) NOT NULL , 
		  "SERVICE_CODE" CHAR(4) NOT NULL , 
		  "USER_TYPE" CHAR(1) NOT NULL , 
		  "FEE_TYPE" CHAR(1) NOT NULL , 
		  "END_CALL_TYPE" CHAR(1) NOT NULL , 
		  "MNS_TYPE" CHAR(1) , 
		  "VIDEO_TYPE" CHAR(1) )   
		 DISTRIBUTE BY HASH("TIME_ID",  
		 "PRODUCT_NO")   
		   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY  

ALTER TABLE "BASS1   "."G_S_04008_DAY0331" APPEND ON

ALTER TABLE "BASS1   "."G_S_04008_DAY0331" LOCKSIZE TABLE

insert into  bass1.G_S_04008_DAY0331
select * from   bass1.G_S_04008_DAY
where time_id = 20110331 


select * from  BASS1.G_S_04008_DAY where time_id = 20110331 

select time_id,count(0)
from    BASS1.G_S_04008_DAY0331
group by     time_id
  20110331	94470

 select * from   bass1.G_RULE_CHECK where 
rule_code in ('R107','R108')

 
 
 select * from  syscat.tables where tabname like 'SCH_CONTROL_RUN%'
 
 select * from  app.SCH_CONTROL_RUNLOG_BAKNGGJ where control_code = 'BASS1_INT_CHECK_SAMPLE_TO_DAY.tcl'
 
 select * from  bass1.G_RULE_CHECK  
 WHERE TIME_ID= 20110331
  AND RULE_CODE IN ('R107','R108')
  

select * from   syscat.indexes where tabschema = 'BASS2'

drop table "BASS1"."DUAL"
CREATE TABLE "BASS1"."DUAL" like sysibm.SYSdummy1 
 IN "TBS_APP_BASS1"

ALTER TABLE "BASS1"."DUAL"
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select 2 from bass2.dual
union all
select 'a' from "BASS1"."DUAL"

select * from   syscat.tables where tabname like '%DUMM%'

select * from     BASS2.ETL_SEND_MESSAGE


select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabschema = 'BASS1'

select * from   G_S_04002_DAY fetch 10 rows only

select * from G_S_04002_DAY fetch first 10 rows only  


create nickname xzbass1.G_S_04002_DAY 
for db25.bass1.G_S_04002_DAY

insert into bass1.G_S_04002_DAY 
select * from 
 xzbass1.G_S_04002_DAY 
 
drop nickname xzbass1.G_S_04002_DAY 



select time_id,count(0) from   bass1.G_S_04002_DAY 
group by time_id



select * from   bass1.T_GS05001M




BASS1_INT_CHECK_SAMPLE_TO_DAY.tcl	int -s INT_CHECK_SAMPLE_TO_DAY.tcl	2	R108(R139)	2011-04-01 4:32:33.235691	[NULL]	-1	[NULL]
BASS1_INT_CHECK_SAMPLE_TO_DAY.tcl	int -s INT_CHECK_SAMPLE_TO_DAY.tcl	2	R107(R138)	2011-04-01 4:20:19.310685	[NULL]	-1	[NULL]


select * from   bass1.G_RULE_CHECK where 
rule_code in ('R107')


select time_id,count(0),count(distinct user_id) from    BASS1.g_user_lst
group by time_id

201104	25702	25702
201103	24776	24776
201102	24247	24247

db2 runstats on table BASS1.g_user_lst with distribution and detailed indexes all
select * from   syscat.tables where tabname = 'G_USER_LST'


select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabschema = 'BASS1'


select time_id,count(0) 
from   G_S_05002_MONTH
group by time_id

select * from   app.sch_control_before where control_code like '%05002%'



select  * from APP.G_FILE_REPORT
where filename like '%_201103_%' and err_code='00'



CREATE TABLE BASS1.DIM_NOT_NULL_INTERFACE
 (
 	interface_code varchar(5)
 	,interface_name varchar(128)
 )
  DATA CAPTURE NONE
		 DISTRIBUTE BY HASH(interface_code)   
		   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY  
ALTER TABLE BASS1.DIM_NOT_NULL_INTERFACE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  select * from  BASS1.DIM_NOT_NULL_INTERFACE
  where interface_code 
  in
('01006'
,'01007'
,'02013'
,'02055'
,'02056'
,'02057'
,'02058'
,'02060'
,'02061'
,'02064'
,'06001'
,'04009'
,'04010'
,'04012'
,'21004'
,'21005'
,'21009'
,'21016')


  select * from  BASS1.DIM_NOT_NULL_INTERFACE
  where interface_code 
  in
('06001'
,'02017'
,'06002'
,'22401'
,'22403')


select count(0),count(distinct interface_code ) from    BASS1.DIM_NOT_NULL_INTERFACE



select * from   app.sch_control_before a,app.sch_control_task b  where 
a.CONTROL_CODE = b.CONTROL_CODE 
and b.CC_FLAG = 1 
and before_control_code like '%Dw_product_ds.tcl%'
and a.control_code like 'BASS1%DAY%'



select * from   app.sch_control_runlog where control_code like '%INT_CHECK_INDEX_SAME_DA%'

BASS1_INT_CHECK_INDEX_SAME_DAY.tcl	2011-04-02 5:06:55.734633	2011-04-02 5:08:23.158191	87	1




select * from   app.sch_control_runlog where flag  = 1



select * from   G_A_02062_DAY where time_id = 20110401



select * from   app.sch_control_task where control_code like '%04013%'

update app.sch_control_runlog
set flag = 0  
 where control_code in 
(
'BASS1_G_I_06031_DAY.tcl'
,'BASS1_G_I_06032_DAY.tcl'
,'BASS1_EXP_G_I_06032_DAY'
,'BASS1_EXP_G_I_06031_DAY'
)
select * from app.sch_control_runlog
 where control_code in 
(
'BASS1_G_I_06031_DAY.tcl'
,'BASS1_G_I_06032_DAY.tcl'
,'BASS1_EXP_G_I_06032_DAY'
,'BASS1_EXP_G_I_06031_DAY'
)




select control_code from   app.sch_control_before where control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'


select control_code from   app.sch_control_before where control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'

select control_code from   app.sch_control_before where control_code in (
select control_code from   app.sch_control_before where before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
)

select distinct control_code from   app.sch_control_before where control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
)
)
)

BASS1_G_A_02059_DAY.tcl
BASS1_G_S_22301_DAY.tcl
BASS1_G_S_22302_DAY.tcl




select distinct  control_code from   app.sch_control_before where control_code in (
select  control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
)
)
)
)

BASS1_EXP_G_A_02059_DAY
BASS1_EXP_G_S_22301_DAY
BASS1_EXP_G_S_22302_DAY


BASS1_G_S_03013_MONTH.tcl
BASS1_G_S_03017_MONTH.tcl
BASS1_G_S_22013_MONTH.tcl
BASS1_G_S_22035_MONTH.tcl
BASS1_G_S_22037_MONTH.tcl
BASS1_G_S_22303_MONTH.tcl
BASS1_G_S_22305_MONTH.tcl


select distinct  control_code from   app.sch_control_before where control_code in (
select distinct  control_code from   app.sch_control_before where before_control_code in (
select  control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code in (
select control_code from   app.sch_control_before where before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
)
)
)
)
)



select * from   app.sch_control_task where control_code = 'BASS1_G_S_22302_DAY.tcl'


select * from   app.sch_control_runlog where flag = 1 



select * from app.sch_control_task a,app.sch_control_runlog b  where a.control_code=b.control_code 
 and flag = 1 




select time_id,count(0) from    bass1.g_rule_check 
where  time_id >= 20110101
group by time_id



select * from    bass1.g_rule_check
where time_id = 20110401



select time_id,count(0) from   G_S_22302_DAY  where time_id > 20110301
group by time_id




select time_id,count(0) from   app.sch_control_before where control_code = 'BASS1_G_S_22302_DAY.tcl'
group by 


select * from   app.sch_control_before
where control_code = 'BASS1_G_S_04015_DAY.tcl'

select * from   app.sch_control_runlog 
where control_code = 'TR1_L_A98012'



select * from   app.sch_control_runlog 
where flag = 1


select * from   app.sch_control_task
where control_code = 'BASS1_G_S_04015_DAY.tcl'

PRIORITY_VAL
100

update app.sch_control_task
set PRIORITY_VAL = 200 
where control_code = 'BASS1_G_S_04015_DAY.tcl'


select  * from APP.G_FILE_REPORT
where filename like '%20110401%' and err_code='00'
in ('02013'
,'04002'
,'04003'
,'04006'
,'04007'
,'04015'
,'04016'
,'04018'
,'22038'
,'22073'
,'22102'
,'22104'
,'04008'
,'04009'
,'04010'
,'04011'
,'04012'
,'06001')



WITH n(control_code, before_control_code) AS 
          (SELECT control_code, before_control_code 
             FROM app.sch_control_before
             WHERE before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
           UNION ALL
           SELECT b.control_code,b.before_control_code 
             FROM app.sch_control_before as b, n
             WHERE b.before_control_code = n.control_code)
SELECT distinct c.control_code FROM n,app.sch_control_task c
where n.control_code = c.control_code
and c.deal_time = 1
and c.control_code not like 'OLAP_%'









select * from  app.sch_control_alarm 
where alarmtime >=  timestamp('20110402'||'000000') 
and alarmtime <=  timestamp('20110403'||'000000') 
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 


select * from app.g_rule_check 
where 


select *
from bass1.g_rule_check 
where time_id = 20110301 
	                    and rule_code in ('R161_1','R161_2','R161_3','R161_4','R161_5','R161_6','R161_7','R161_8','R161_9','R161_10','R161_11','R161_12','R161_13','R161_14','R161_15','R161_16','R161_17')
                        
                       
select count(0) from G_I_02018_MONTH where time_id = 201103
select count(0) from G_I_02019_MONTH where time_id = 201103
select count(0) from G_I_03002_MONTH where time_id = 201103

select count(0) from G_I_03003_MONTH where time_id = 201103
select count(0) from G_I_06011_MONTH where time_id = 201103

select count(0) from G_I_06012_MONTH where time_id = 201103

select count(0) from G_I_06029_MONTH where time_id = 201103


select * from app.sch_control_before where control_code 
in 
('BASS1_G_I_02018_MONTH.tcl'
,'BASS1_G_I_02019_MONTH.tcl'
,'BASS1_G_I_02020_MONTH.tcl'
,'BASS1_G_I_02021_MONTH.tcl'
,'BASS1_G_I_02049_MONTH.tcl'
,'BASS1_G_I_02053_MONTH.tcl'
,'BASS1_G_I_03001_MONTH.tcl'
,'BASS1_G_I_03002_MONTH.tcl'
,'BASS1_G_I_03003_MONTH.tcl'
,'BASS1_G_I_06011_MONTH.tcl'
,'BASS1_G_I_06012_MONTH.tcl'
,'BASS1_G_I_06029_MONTH.tcl'
,'BASS1_INT_CHECK_0204902004_MONTH.tcl'
)

                       
                       
select count(0) from   BASS1.G_I_02049_MONTH where time_id = 201103
select count(0),count(distinct filename ) 
from  APP.G_FILE_REPORT
where filename like '%20110401%' and err_code='00'                       



select * from   app.sch_control_task where control_code like '%BASS1%MONTH.tcl%'
and cc_flag = 1

select * from  G_S_03004_MONTH

select * from G_S_03004_MONTH fetch first 10 rows only  
select * from G_S_03005_MONTH fetch first 10 rows only  

select time_id,count(0) from   G_S_03004_MONTH
group by time_id

select time_id,count(0) from   G_S_03005_MONTH
group by time_id

201012	6548920


select * from   bass1.G_S_04003_DAY

select count(0),count(distinct product_no) ,sum(value(int(FLOWUP),0)/1024/1024)+value(int(FLOWDOWN),0)/1024/1024))from   bass1.G_S_04003_DAY
where time_id between  20101201 and 20101231

205	39

select * from    bass1.G_S_04003_DAY

	39	18.85	37	18.85	2	0						

select count(0),count(distinct product_no) 
,round(sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024,2)
,round(sum(bigint(flowup))*1.00/1024/1024/1024,2)
,round(sum(bigint(flowdown))*1.00/1024/1024/1024,2)
from   bass1.G_S_04003_DAY
where time_id 
between  20101201 and 20101231


select round(1.595,2) from bass2.dual



select sum(bigint(FEE_RECEIVABLE)) from  G_S_03004_MONTH where time_id = 201012
12643326679
select sum(bigint(SHOULD_FEE)) from  G_S_03005_MONTH where time_id = 201012

12643326679

select count(0) from  G_S_03005_MONTH where time_id = 201012
6548920
select count(0) from  G_S_03004_MONTH where time_id = 201012
9293551

select t.*
from (
select a.*,row_number()over(partition by unit_code order by export_num desc )  rn 
from app.g_runlog a where char(time_id) = '201103'
) t 
where t.rn =1 


and 
and unit_code = '03002'



--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20101231 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20101231 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
commit



select 
 case when a.wlan_fee > 0 and b.test_flag = '0' then  '付费用户' else '免费用户' end user_type
,count(distinct a.user_id) user_cnt
,count(distinct c.product_no) user_cnt2
,round(sum(wlan_flow),2) wlan_flow
from 
( select user_id,sum(int(FEE_RECEIVABLE))  wlan_fee
from BASS1.G_S_03004_MONTH 
where time_id  = 201012 and BILL_CYC_ID = '201012'
and ACCT_ITEM_ID in ('0715','0716')
group by user_id 
 ) a 
 ,session.int_check_user_status b 
 ,(
 		select  product_no 
 		,sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024 wlan_flow
        from   bass1.G_S_04003_DAY
		where time_id between  20101201 and 20101231
        group by product_no
	) c 
 where a.user_id = b.user_id and b.product_no = c.product_no
group by  
 case when a.wlan_fee > 0 and b.test_flag = '0' then  '付费用户' else '免费用户' end 
 

select count(0)
from 
( select user_id,sum(int(SHOULD_FEE))  wlan_fee
from BASS1.G_S_03005_MONTH 
where time_id  = 201012 and BILL_CYC_ID = '201012'
and ITEM_ID in ('0715','0716')
group by user_id 
 ) a 
 ,session.int_check_user_status b 
  where trim(a.user_id) = trim(b.user_id)
  
 
select count(0),count(distinct b.product_no)  from 
session.int_check_user_status b 
,(
 		select  product_no 
 		,round(sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024,2) wlan_flow
        from   bass1.G_S_04003_DAY
		where time_id between  20101201 and 20101231
        group by product_no
	) c where b.product_no = c.product_no
    
    
    

select count(0)
from 
( select user_id,sum(int(SHOULD_FEE))  wlan_fee
from BASS1.G_S_03004_MONTH 
where time_id  = 201012 and BILL_CYC_ID = '201012'
and ACCT_ITEM_ID in ('0715','0716')
group by user_id 
 ) a 
 ,session.int_check_user_status b 
  where trim(a.user_id) = trim(b.user_id)
  
 

select * from   bass1.G_S_03005_MONTH  
select count(0)
    from BASS1.G_S_03005_MONTH 
where ITEM_ID in ('0715','0716')


select ACCT_ITEM_ID,count(0)
from  bass1.G_S_03004_MONTH  
group by ACCT_ITEM_ID


select
 case when a.wlan_fee > 0 or b.test_flag = '2' then  '付费用户' else '免费用户' end user_type
,a.user_id,a.wlan_fee,c.product_no,wlan_flow,b.*
--,count(distinct a.user_id) user_cnt
--,sum(wlan_flow) wlan_flow
from 
( select user_id,sum(int(FEE_RECEIVABLE))  wlan_fee
from BASS1.G_S_03004_MONTH 
where time_id  = 201012 and BILL_CYC_ID = '201012'
and ACCT_ITEM_ID in ('0715','0716')
group by user_id 
 ) a 
 ,session.int_check_user_status b 
 ,(
 		select  product_no 
 		,sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024,2 wlan_flow
        from   bass1.G_S_04003_DAY
		where time_id between  20101201 and 20101231
        group by product_no
	) c 
 where a.user_id = b.user_id and b.product_no = c.product_no
 
 select * from g_i_02053_month
  where time_id = 201104
 and 
 VALID_DATE> EXPIRE_DATE
 
 update  g_i_02053_month 
 set EXPIRE_DATE = VALID_DATE
 where time_id = 201104
 and 
 VALID_DATE> EXPIRE_DATE
 
 
 201104	13908937024    	13908937024    	14	931067      	+MAILMF             	0	20101209	20101201	0	1	00
201104	13638902959    	13638902959    	14	931067      	+MAILMF             	0	20101209	20101201	0	1	00

 se
 20101209
 20101201
 
 
 select * from  bass1.G_RULE_CHECK where rule_code = 'C1'
 and time_id > 20110101
 order by 1 desc 
 
 20110521	C1	1996432.00000	2174540.00000	-0.08191	0.00000

 
 select * from  app.sch_control_task where control_code = 'BASS1_G_I___MONTH.tcl'
 
 
 select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
--and flag = -1
--and control_code like 'BASS1%'
order by alarmtime desc 

select count(0),count(distinct user_id) from   G_I_02005_MONTH where time_id in (201103)
where time_id in (201102,201103)
select time_id,count(0) from   G_I_02005_MONTH 
group by time_id

201103	10956
201102	18688

select time_id,count(0) from   G_I_02005_MONTH 
group by time_id


select count(0),count(distinct user_id||prod_id) from   G_I_02015_MONTH where time_id = 201103

select OWNER_TYPE,RENT_END_DATE,count(0)
from G_I_06022_MONTH
group by OWNER_TYPE,RENT_END_DATE



select * from app.sch_control_alarm where control_code like 'BASS1_%01005%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%02005%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%02014%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%02015%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%02016%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%02047%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%06021%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%06022%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%06023%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%22009%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%22101%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%22103%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%22105%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%22106%' 
select * from app.sch_control_alarm where control_code like 'BASS1_%06002%' 

11410
19321
19419
select count(0)  from bass2.dwd_cust_vip_card_201101  where vip_source=0 and rec_status=1
select count(0)  from bass2.dwd_cust_vip_card_201102  where vip_source=0 and rec_status=1
19321
select count(0)  from bass2.dwd_cust_vip_card_201103  where vip_source=0 and rec_status=1
11410                             
                             
                             
select * from   syscat.tables where tabname like 'G_MON%'                             
select * from   BASS1.MON_ALL_INTERFACE where INTERFACE_CODE = '06003'


CREATE TABLE BASS1.MON_ALL_INTERFACE
 (
  type						CHAR(1)
  ,INTERFACE_CODE  CHAR(5)
  ,INTERFACE_NAME  VARCHAR(100)
  ,COARSE_TYPE				  VARCHAR(30)
  ,UPLOAD_TIME					  VARCHAR(20)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (INTERFACE_CODE) USING HASHING
   
  ALTER TABLE BASS1.MON_ALL_INTERFACE
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  select * from  BASS1.MON_ALL_INTERFACE
  where interface_code = '03012'
  
  
  select a.*
  from 
  (select  * from BASS1.MON_ALL_INTERFACE where type = 'm') a 
  ,
  (select distinct unit_code from app.g_runlog 
where time_id= 201103
and return_flag=1 ) b 
where a.interface_code = b.unit_code

  
  select vip_source,count(0) from bass2.dwd_cust_vip_card_201101 a
  group by vip_source
  
  
  
  
  select * from  BASS1.G_RULE_CHECK  
  where rule_code = 'R019'
  
   
  select * from
                (select * from 
                (
                select user_id,chg_vip_time,row_number()over(partition by user_id order by time_id desc) row_id from BASS1.G_I_02005_MONTH
                where time_id=201104
                ) k
                where k.row_id =1) a
                left outer join 
                (
                select * from
                (
                select user_id,create_date,row_number()over(partition by user_id order by time_id desc) row_id 
                from BASS1.G_A_02004_DAY
                where time_id<=20110431
                ) k
                where k.row_id=1) b
                on a.user_id=b.user_id
                where bigint(chg_vip_time)<bigint(create_date)
                with ur
                
select user_id,create_date from   bass2.dw_product_201104 where user_id in ('89460000740915','89160000265019')89160000265019	2010-09-17 
89460000740915	2011-03-21 
                

select user_id,card_valid_date from    bass2.dwd_cust_vip_card_201103 where  user_id in ('89460000740915','89160000265019')       
89160000265019	2010-09-01 0:00:00.000000
89460000740915	2011-03-20 23:59:59.000000


select CUSTCLASS_ID,count(0) from   BASS1.G_I_02005_MONTH
where time_id  = 201103
group by CUSTCLASS_ID

 bass2.dwd_cust_vip_card_201103
 

89460000740915      	20110320	1	89460000740915      	20110321	1
89160000265019      	20100901	1	89160000265019      	20100917	1


update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20100917'
where user_id = '89160000265019'
and time_id = 201104


update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110321'
where user_id = '89460000740915'
and time_id = 201104


select count(0) from   
(select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201103) a, 
(select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201102) b
where a.user_id = b.user_id 

18589


select count(0) from   BASS1.G_I_02005_MONTH where time_id  = 201102

18688
select count(0) from    
select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201103
except
select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201102


89101110029853      
89101110031954      
89101110038097      
 


select * from   bass2.dw_product_201103 where user_id in ('89101110029853','89101110031954','89101110038097')
                


select max(create_date) from    bass2.dw_product_201103  where user_id in 
(
select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201103
except
select distinct user_id from   BASS1.G_I_02005_MONTH where time_id  = 201102
)

order by user_id


10189	10188





select count(0),count(distinct user_id) from   BASS1.G_I_02005_MONTH where time_id  = 201103


select time_id,count(0) from   bass1.G_I_02006_MONTH
group by time_id
order by 1

201103	788668
201102	754626
201101	733898
201012	713602
201011	676340


select * from syscat.tables where tabname like '%RUNLOG%' 

select count(0) from    app.SCH_CONTROL_RUNLOG



select * from   g_rule_check where 
rule_code in ('R076','R077','R078','R079','R080','R081','R082')
and  time_id = 201103 


select * from   g_rule_check where 
rule_code in ('R002')
and  time_id = 201103 


select count(0),count(distinct user_id) from    bass1.G_A_02052_MONTH


select cast(sum(case when b.user_id is null then 0 else 1 end) as decimal(15,2))/cast(count(a.user_id) as decimal (15,2))
                 from
                (
                 select user_id,usertype_id from
                 (
                  select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id
                  from bass1.G_A_02008_DAY
                  where time_id<=20110331
                 ) k
                where k.row_id=1 
                ) a
                inner join (select distinct user_id from G_A_02004_DAY
                where usertype_id<>'3'
                and time_id<=20110331               
                ) c
                 on a.user_id=c.user_id
                
                left outer join (select user_id,region_flag
                from
                (
                select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
                from bass1.G_A_02052_MONTH
                ) k
                where k.row_id=1) b
                 on a.user_id=b.user_id
                  and b.REGION_FLAG in('1','2','3')
                where  a.usertype_id not in ('2010','2020','2030','9000')
                with ur

BASS1_G_S_02007_MONTH.tcl

select a.*,b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'



select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'


--接口列表
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'

--update interface

update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'
)

--后续校验程序
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'
)
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)

--runlog 表的情况
select * from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'
)
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
)
and flag = 0
and date(endtime) < current date

--update check
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'
)
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
)
and flag = 0
and date(endtime) < current date
)

--后续导出程序

select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月10日前'
)
and control_code like 'BASS1%EXP%'


select * from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月8日前'
    )
    and control_code like 'BASS1%EXP%'
)
and flag = 0
and date(endtime) < current date


--update exp
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月10日前'
    )
    and control_code like 'BASS1%EXP%'
)
and flag = 0
and date(endtime) < current date
)


select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月8日前'
    )
    and control_code like 'BASS1%EXP%'
)
--and flag = 0
and date(endtime) = current date


select * from  app.sch_control_task  where control_code = 'BASS1_INT_CHECK_IMPORTSERV_MONTH'


select count(0) from   bass2.stat_zd_village_users_201102
1391237

select count(0) from   bass2.stat_zd_village_users_201103




select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月8日前'
)
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
and control_code
in
('BASS1_INT_CHECK_02006_MONTH.tcl'
,'BASS1_INT_CHECK_0205202008_MONTH.tcl'
,'BASS1_INT_CHECK_B67_MONTH.tcl'
,'BASS1_INT_CHECK_D9E234F2_651TO56_MONTH.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_L5_MONTH.tcl'
,'BASS1_INT_CHECK_R031_MONTH.tcl'
,'BASS1_INT_CHECK_R034_MONTH.tcl'
,'BASS1_INT_CHECK_R036_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
,'BASS1_INT_CHECK_R030_MONTH.tcl'
,'BASS1_INT_CHECK_R032_MONTH.tcl'
,'BASS1_INT_CHECK_R037toR039_MONTH.tcl'
,'BASS1_INT_CHECK_R040_MONTH.tcl'
,'BASS1_INT_CHECK_0200803005_MONTH.tcl'
,'BASS1_INT_CHECK_R008_MONTH.tcl'
,'BASS1_INT_CHECK_R009_MONTH.tcl'
,'BASS1_INT_CHECK_SAMPLE_MONTH.tcl'
,'BASS1_INT_CHECK_VOICE_MONTH.tcl'
)


select * from syscat.tables where tabname like '%21012%'

select time_id,count(0) from G_S_21012_MONTH
group by time_id


select * from   app.sch_control_before 
where control_code like '%G_S_21012_MONTH%'
select count(0) from    
                            bass2.dw_call_opposite_201103

194419329                            

select 
 substr(opp_number,1,5)         
, count(0)
from  bass2.dw_call_opposite_201103
where  
--substr(opp_number,1,5)     like '125%'
substr(opp_number,1,5) in ('12590','12596','12559')
group by  substr(opp_number,1,5)     
order by 1

--3月
1	2
12559	2
12590	42846
12596	1400

select 
 substr(opp_number,1,5)         
, count(0)
from  bass2.dw_call_opposite_201101
where  
--substr(opp_number,1,5)     like '125%'
substr(opp_number,1,5) in ('12590','12596','12559')
group by  substr(opp_number,1,5)     
order by 1

--2月
1	2
12559	1
12590	120052
12596	1089

--1月

12590	161846
12596	1760

--警讯通统付收入：
select sum(int(income)) from   G_S_03017_MONTH
where ent_busi_id = '1360'
and time_id = 201103

7220,00
--无非统付收入

select * from   G_S_03017_MONTH
where ent_busi_id = '1360'

--财信通通非统付收入：
select sum(int(income)) from  
 bass1.G_S_03018_MONTH
 where ent_busi_id = '1300'
 and time_id = 201103
 6007,00


select * from   app.sch_control_task where control_code like '%INT_CHECK_R029_MONTH.tcl'
BASS1_INT_CHECK_R029_MONTH.tcl
select * from   app.sch_control_before where control_code like 'BASS1_INT_CHECK_R029_MONTH.tcl'
                  
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月10日前'
    )
    and control_code like 'BASS1%EXP%'
)
and flag = 0
and date(endtime) < current date
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')  

update                

select * from   app.sch_control_runlog where control_code in ('BASS1_EXP_G_S_05001_MONTH','BASS1_EXP_G_S_05002_MONTH')
BASS1_EXP_G_S_05001_MONTH
BASS1_G_S_05002_MONTH.tcl
BASS1_EXP_G_S_05002_MONTH

update  app.sch_control_runlog 
set flag = 0
where control_code in ('BASS1_EXP_G_S_05001_MONTH','BASS1_EXP_G_S_05002_MONTH')

BASS1_EXP_G_S_05002_MONTH	2011-04-01 12:09:57.682329	2011-04-01 12:11:32.054193	94	-2
BASS1_EXP_G_S_05001_MONTH	2011-04-07 10:12:04.572475	[NULL]	[NULL]	1

db2 "load from /dev/null of del terminate into  bass1.T_GS05001M"  
db2 "load from /dev/null of del terminate into  bass1.T_GS05002M"  

stat_market_0136

select * from   bass2.stat_market_0136

db2 "load from /dev/null of del terminate into  bass2.stat_market_0136"  


select * from   bass1.T_GS05001M where time_id = 201012
select * from   bass1.T_GS05002M where time_id = 201012

select sum(bigint(OUT_DURN))*1.00/sum(bigint(IN_DURN)) from   bass1.T_GS05001M where time_id = 201012
0.83121280782
select sum(bigint(OUT_DURN))*1.00/sum(bigint(IN_DURN)) from   bass1.T_GS05001M where time_id = 201103
0.84929345800

select sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) from   bass1.T_GS05001M where time_id = 201012
0.85943690519
select sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) from   bass1.T_GS05001M where time_id = 201103
0.86976532371


select sum(bigint(IN_COUNT))*1.00/sum(bigint(OUT_COUNT)) from   bass1.T_GS05002M where time_id = 201012
0.83121280782
select sum(bigint(IN_COUNT))*1.00/sum(bigint(OUT_COUNT)) from   bass1.T_GS05002M where time_id = 201103
0.84929345800

select sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) from   bass1.T_GS05002M where time_id = 201012
0.85943690519
select sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) from   bass1.T_GS05002M where time_id = 201103
0.86976532371

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) from   bass1.T_GS05001M group by  time_id 

= 201103

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.T_GS05002M 
group by time_id 


60113021
select sum(bigint(IN_DURN)) from   bass1.T_GS05001M where time_id = 201012
72319652
select  60113021*1.00/72319652 from bass2.dual
select (select sum(bigint(OUT_DURN)) from   bass1.T_GS05001M where time_id = 201012
)
/(select sum(bigint(IN_DURN)) from   bass1.T_GS05001M where time_id = 201012
)
from bass2.dual

select * from   bass1.T_GS05002M where time_id = 201012



select * from   bass1.T_GS05001M where time_id = 201103
select * from   bass1.T_GS05002M where time_id = 201103

 g_s_05001_month/g_s_05002_month
 
select * from   bass1.g_s_05001_month where time_id = 201102
 
select * from   bass1.g_s_05001_month where time_id = 201103

select * from   bass1.g_s_05002_month where time_id = 201103

select * from   bass1.g_s_05002_month where time_id = 201102


insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201103


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201103


select time_id,count(0) from   
G_S_05003_MONTH
group by time_id

select * from   G_S_05003_MONTH where time_id = 201103
select * from   G_S_05003_MONTH where time_id = 201102

select count(0),count(distinct SP_SVR_CODE)  from   G_S_05003_MONTH where time_id = 201103
select count(0),count(distinct SP_SVR_CODE)  from   G_S_05003_MONTH where time_id = 201102


select SP_BUS_CODE,count(0),sum(bigint(PAY_FEE)),sum(bigint(PAY_BALANCE_FEE)),sum(bigint(STLMNT_FEE)),sum(bigint(INFO_FEE))
from G_S_05003_MONTH where time_id = 201103
group by SP_BUS_CODE
01	98	0	1573500	57048187	356660330
02	805	0	0	100650555	671003700
03	91	0	0	28266454	188443030
04	563	0	0	15880785	105871900
08	21	0	0	19579200	32632000
16	103	0	0	632300940	770946200

select SP_BUS_CODE,count(0),sum(bigint(PAY_FEE)),sum(bigint(PAY_BALANCE_FEE)),sum(bigint(STLMNT_FEE)),sum(bigint(INFO_FEE))
from G_S_05003_MONTH where time_id = 201102
group by SP_BUS_CODE
01	99	0	1520150	50849135	338797900
02	767	0	0	101497245	676648300
03	101	0	0	10459780	69731880
04	921	0	0	7151325	47675500
08	21	0	0	19620000	32700000
16	99	0	0	611069783	744881850


select SP_BUS_CODE,count(0),sum(bigint(PAY_FEE)),sum(bigint(PAY_BALANCE_FEE)),sum(bigint(STLMNT_FEE)),sum(bigint(INFO_FEE))
from G_S_05003_MONTH where time_id = 201101
group by SP_BUS_CODE

01	98	0	1575600	195599455	538036700
02	798	0	0	117195616	781304110
03	110	0	0	11710603	78070700
04	1133	0	0	10629885	70865900
08	21	0	0	20071800	33453000
16	104	0	0	591129135	720477760


select * from   g_s_22025_month where time_id = 201011
select * from   g_s_22025_month where time_id = 201103
select time_id,count(0) from   g_s_22025_month 
group by time_id

select * from   G_S_22033_MONTH
 where time_id = 201103
 

select * from   G_S_22033_MONTH
 where time_id = 201102

select time_id,count(0) from   G_S_22033_MONTH 
group by time_id


select sum(bigint(PAY_FEE)),sum(bigint(PAY_BALANCE_FEE)),sum(bigint(STLMNT_FEE)),sum(bigint(INFO_FEE)) from   bass1.G_S_05003_MONTH where time_id = 201103
0	1573500	853726121	2125557160

select sum(bigint(PAY_FEE)),sum(bigint(PAY_BALANCE_FEE)),sum(bigint(STLMNT_FEE)),sum(bigint(INFO_FEE)) from   bass1.G_S_05003_MONTH where time_id = 201102
0	1520150	800647268	1910435430


select * from  app.sch_control_alarm 
where 
 control_code 
 in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月15日前'
    )


select time_id,count(0) from   bass1.G_S_22039_MONTH
group by time_id

select * from   bass1.G_S_22039_MONTH 
where time_id in( 201103,201102,201101)
order by 1,3



select * from   G_S_22050_MONTH
select * from   G_S_22055_MONTH


select * from   bass1.G_S_22050_MONTH 
where time_id = 201102




update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月15日前'
)

--update check
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月15日前'
)
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
)
and flag = 0
and date(endtime) < current date
)


--update exp
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月15日前'
    )
    and control_code like 'BASS1%EXP%'
)
and flag = 0
and date(endtime) < current date
)


select * from   BASS1.G_S_22062_MONTH


select time_id,count(0) from   G_S_22062_MONTH
group by time_id 



select * from   BASS1.G_S_22064_MONTH
where time_id = 201103





select * from app.sch_control_task where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

CC_FLAG
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1
1


select * from   app.sch_control_before 
where control_code = 'BASS1_INT_CHECK_L0_TO_DAY.tcl'


update  app.sch_control_task
set CC_FLAG = 2
 where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

20 row(s) affected.

--改回去

update  app.sch_control_task
set CC_FLAG = 1
 where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

20 row(s) affected.

update  app.sch_control_task
set function_desc = '[作废]'||function_desc
 where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



update  app.sch_control_task
set function_desc = replace(function_desc,'[作废]','')
 where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



select * from    app.sch_control_task
where control_code ='BASS1_EXP_G_S_09903_DAY'




select * from   app.sch_control_before
 where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

26

delete from  app.sch_control_before
where 
before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

26 row(s) affected.

BASS1_EXP_G_I_03007_MONTH	BASS1_INT_CHECK_F7_MONTH.tcl
BASS1_EXP_G_S_04006_DAY	BASS1_INT_CHECK_F1_TO_DAY.tcl
BASS1_EXP_G_S_21001_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_S_21001_DAY	BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl
BASS1_EXP_G_S_03005_MONTH	BASS1_INT_CHECK_G047TO50_MONTH.tcl
BASS1_EXP_G_S_03005_MONTH	BASS1_INT_CHECK_L34_MONTH.tcl
BASS1_EXP_G_S_04002_DAY	BASS1_INT_CHECK_L0_TO_DAY.tcl
BASS1_EXP_G_S_04014_DAY	BASS1_INT_CHECK_L1K9_TO_DAY.tcl
BASS1_EXP_G_A_01004_DAY	BASS1_INT_CHECK_L2_TO_DAY.tcl
BASS1_EXP_G_A_02004_DAY	BASS1_INT_CHECK_33TO40_DAY.tcl
BASS1_EXP_G_A_02004_DAY	INT_CHECK_DATARULE_DAY.tcl
BASS1_EXP_G_S_21004_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_A_02008_DAY	INT_CHECK_DATARULE_DAY.tcl
BASS1_EXP_G_A_02008_DAY	BASS1_INT_CHECK_33TO40_DAY.tcl
BASS1_EXP_G_S_03012_MONTH	BASS1_INT_CHECK_E5_MONTH.tcl
BASS1_EXP_G_S_03012_MONTH	BASS1_INT_CHECK_G047TO50_MONTH.tcl
BASS1_EXP_G_S_03012_MONTH	BASS1_INT_CHECK_L34_MONTH.tcl
BASS1_EXP_G_S_03004_MONTH	BASS1_INT_CHECK_E5_MONTH.tcl
BASS1_EXP_G_S_22038_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_S_21009_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_S_02047_MONTH	BASS1_INT_CHECK_98Z6_MONTH.tcl
BASS1_EXP_G_S_04004_DAY	BASS1_INT_CHECK_A0L694B5_DAY.tcl
BASS1_EXP_G_S_04005_DAY	BASS1_INT_CHECK_L1K9_TO_DAY.tcl
BASS1_EXP_G_S_04005_DAY	BASS1_INT_CHECK_A12E6_DAY.tcl
BASS1_EXP_G_S_21008_MONTH	BASS1_INT_CHECK_8895_MONTH.tcl
BASS1_EXP_G_S_21007_DAY	BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl

insert into app.sch_control_before values ('BASS1_EXP_G_I_03007_MONTH','BASS1_INT_CHECK_F7_MONTH.tcl')
insert into app.sch_control_before values ('BASS1_EXP_G_S_04006_DAY','BASS1_INT_CHECK_F1_TO_DAY.tcl')               
insert into app.sch_control_before values ('BASS1_EXP_G_S_21001_DAY','BASS1_INT_CHECK_C567_DAY.tcl')                
insert into app.sch_control_before values ('BASS1_EXP_G_S_21001_DAY','BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl')     
insert into app.sch_control_before values ('BASS1_EXP_G_S_03005_MONTH','BASS1_INT_CHECK_G047TO50_MONTH.tcl')        
insert into app.sch_control_before values ('BASS1_EXP_G_S_03005_MONTH','BASS1_INT_CHECK_L34_MONTH.tcl')             
insert into app.sch_control_before values ('BASS1_EXP_G_S_04002_DAY','BASS1_INT_CHECK_L0_TO_DAY.tcl')               
insert into app.sch_control_before values ('BASS1_EXP_G_S_04014_DAY','BASS1_INT_CHECK_L1K9_TO_DAY.tcl')             
insert into app.sch_control_before values ('BASS1_EXP_G_A_01004_DAY','BASS1_INT_CHECK_L2_TO_DAY.tcl')               
insert into app.sch_control_before values ('BASS1_EXP_G_A_02004_DAY','BASS1_INT_CHECK_33TO40_DAY.tcl')              
insert into app.sch_control_before values ('BASS1_EXP_G_A_02004_DAY','INT_CHECK_DATARULE_DAY.tcl')                  
insert into app.sch_control_before values ('BASS1_EXP_G_S_21004_DAY','BASS1_INT_CHECK_C567_DAY.tcl')                
insert into app.sch_control_before values ('BASS1_EXP_G_A_02008_DAY','INT_CHECK_DATARULE_DAY.tcl')                  
insert into app.sch_control_before values ('BASS1_EXP_G_A_02008_DAY','BASS1_INT_CHECK_33TO40_DAY.tcl')              
insert into app.sch_control_before values ('BASS1_EXP_G_S_03012_MONTH','BASS1_INT_CHECK_E5_MONTH.tcl')              
insert into app.sch_control_before values ('BASS1_EXP_G_S_03012_MONTH','BASS1_INT_CHECK_G047TO50_MONTH.tcl')        
insert into app.sch_control_before values ('BASS1_EXP_G_S_03012_MONTH','BASS1_INT_CHECK_L34_MONTH.tcl')             
insert into app.sch_control_before values ('BASS1_EXP_G_S_03004_MONTH','BASS1_INT_CHECK_E5_MONTH.tcl')              
insert into app.sch_control_before values ('BASS1_EXP_G_S_22038_DAY','BASS1_INT_CHECK_C567_DAY.tcl')                
insert into app.sch_control_before values ('BASS1_EXP_G_S_21009_DAY','BASS1_INT_CHECK_C567_DAY.tcl')                
insert into app.sch_control_before values ('BASS1_EXP_G_S_02047_MONTH','BASS1_INT_CHECK_98Z6_MONTH.tcl')            
insert into app.sch_control_before values ('BASS1_EXP_G_S_04004_DAY','BASS1_INT_CHECK_A0L694B5_DAY.tcl')            
insert into app.sch_control_before values ('BASS1_EXP_G_S_04005_DAY','BASS1_INT_CHECK_L1K9_TO_DAY.tcl')             
insert into app.sch_control_before values ('BASS1_EXP_G_S_04005_DAY','BASS1_INT_CHECK_A12E6_DAY.tcl')               
insert into app.sch_control_before values ('BASS1_EXP_G_S_21008_MONTH','BASS1_INT_CHECK_8895_MONTH.tcl')            
insert into app.sch_control_before values ('BASS1_EXP_G_S_21007_DAY','BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl')     

select * from   app.sch_control_before
 where before_control_code in ('BASS1_G_A_06030_DAY.tcl')
 
select distinct control_code from   app.sch_control_before
 where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)


select * from    app.sch_control_task
where control_code
in (
select control_code from   app.sch_control_before
 where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)

CONTROL_CODE
BASS1_EXP_G_A_01004_DAY
BASS1_EXP_G_A_02004_DAY
BASS1_EXP_G_A_02008_DAY
BASS1_EXP_G_I_03007_MONTH
BASS1_EXP_G_S_02047_MONTH
BASS1_EXP_G_S_03004_MONTH
BASS1_EXP_G_S_03005_MONTH
BASS1_EXP_G_S_03012_MONTH
BASS1_EXP_G_S_04002_DAY
BASS1_EXP_G_S_04004_DAY
BASS1_EXP_G_S_04005_DAY
BASS1_EXP_G_S_04006_DAY
BASS1_EXP_G_S_04014_DAY
BASS1_EXP_G_S_21001_DAY
BASS1_EXP_G_S_21004_DAY
BASS1_EXP_G_S_21007_DAY
BASS1_EXP_G_S_21008_MONTH
BASS1_EXP_G_S_21009_DAY
BASS1_EXP_G_S_22038_DAY

select distinct control_code from    app.sch_control_before
where control_code
in 
('BASS1_EXP_G_A_01004_DAY    '
,'BASS1_EXP_G_A_02004_DAY    '
,'BASS1_EXP_G_A_02008_DAY    '
,'BASS1_EXP_G_I_03007_MONTH  '
,'BASS1_EXP_G_S_02047_MONTH  '
,'BASS1_EXP_G_S_03004_MONTH  '
,'BASS1_EXP_G_S_03005_MONTH  '
,'BASS1_EXP_G_S_03012_MONTH  '
,'BASS1_EXP_G_S_04002_DAY    '
,'BASS1_EXP_G_S_04004_DAY    '
,'BASS1_EXP_G_S_04005_DAY    '
,'BASS1_EXP_G_S_04006_DAY    '
,'BASS1_EXP_G_S_04014_DAY    '
,'BASS1_EXP_G_S_21001_DAY    '
,'BASS1_EXP_G_S_21004_DAY    '
,'BASS1_EXP_G_S_21007_DAY    '
,'BASS1_EXP_G_S_21008_MONTH  '
,'BASS1_EXP_G_S_21009_DAY    '
,'BASS1_EXP_G_S_22038_DAY')

select * from    app.sch_control_before
where control_code
in (
select control_code from   app.sch_control_before
 where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)



select * from  app.sch_control_task
where control_code in (
select control_code from   app.sch_control_before 
where before_control_code in (
select control_code from app.sch_control_task where function_desc like '%作废%'
and control_code like '%CHECK%'
AND control_code NOT in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)))


select * from   app.sch_control_before 
where before_control_code ='BASS1_INT_CHECK_R004_MONTH.tcl'



select distinct control_code 
from    app.sch_control_before
where control_code                                          
in                                                          
('BASS1_EXP_G_A_01004_DAY    '                             
,'BASS1_EXP_G_A_02004_DAY    '                             
,'BASS1_EXP_G_A_02008_DAY    '                             
,'BASS1_EXP_G_I_03007_MONTH  '                             
,'BASS1_EXP_G_S_02047_MONTH  '                             
,'BASS1_EXP_G_S_03004_MONTH  '                             
,'BASS1_EXP_G_S_03005_MONTH  '                             
,'BASS1_EXP_G_S_03012_MONTH  '                             
,'BASS1_EXP_G_S_04002_DAY    '                             
,'BASS1_EXP_G_S_04004_DAY    '                             
,'BASS1_EXP_G_S_04005_DAY    '                             
,'BASS1_EXP_G_S_04006_DAY    '                             
,'BASS1_EXP_G_S_04014_DAY    '                             
,'BASS1_EXP_G_S_21001_DAY    '                             
,'BASS1_EXP_G_S_21004_DAY    '                             
,'BASS1_EXP_G_S_21007_DAY    '                             
,'BASS1_EXP_G_S_21008_MONTH  '                             
,'BASS1_EXP_G_S_21009_DAY    '                             
,'BASS1_EXP_G_S_22038_DAY')                                
and 
before_control_code not in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)





select distinct control_code from    app.sch_control_before
where control_code                                          
in                                                          
('BASS1_EXP_G_A_01004_DAY    '                             
,'BASS1_EXP_G_A_02004_DAY    '                             
,'BASS1_EXP_G_A_02008_DAY    '                             
,'BASS1_EXP_G_I_03007_MONTH  '                             
,'BASS1_EXP_G_S_02047_MONTH  '                             
,'BASS1_EXP_G_S_03004_MONTH  '                             
,'BASS1_EXP_G_S_03005_MONTH  '                             
,'BASS1_EXP_G_S_03012_MONTH  '                             
,'BASS1_EXP_G_S_04002_DAY    '                             
,'BASS1_EXP_G_S_04004_DAY    '                             
,'BASS1_EXP_G_S_04005_DAY    '                             
,'BASS1_EXP_G_S_04006_DAY    '                             
,'BASS1_EXP_G_S_04014_DAY    '                             
,'BASS1_EXP_G_S_21001_DAY    '                             
,'BASS1_EXP_G_S_21004_DAY    '                             
,'BASS1_EXP_G_S_21007_DAY    '                             
,'BASS1_EXP_G_S_21008_MONTH  '                             
,'BASS1_EXP_G_S_21009_DAY    '                             
,'BASS1_EXP_G_S_22038_DAY')       
except
select distinct control_code 
from    app.sch_control_before
where control_code                                          
in                                                          
('BASS1_EXP_G_A_01004_DAY    '                             
,'BASS1_EXP_G_A_02004_DAY    '                             
,'BASS1_EXP_G_A_02008_DAY    '                             
,'BASS1_EXP_G_I_03007_MONTH  '                             
,'BASS1_EXP_G_S_02047_MONTH  '                             
,'BASS1_EXP_G_S_03004_MONTH  '                             
,'BASS1_EXP_G_S_03005_MONTH  '                             
,'BASS1_EXP_G_S_03012_MONTH  '                             
,'BASS1_EXP_G_S_04002_DAY    '                             
,'BASS1_EXP_G_S_04004_DAY    '                             
,'BASS1_EXP_G_S_04005_DAY    '                             
,'BASS1_EXP_G_S_04006_DAY    '                             
,'BASS1_EXP_G_S_04014_DAY    '                             
,'BASS1_EXP_G_S_21001_DAY    '                             
,'BASS1_EXP_G_S_21004_DAY    '                             
,'BASS1_EXP_G_S_21007_DAY    '                             
,'BASS1_EXP_G_S_21008_MONTH  '                             
,'BASS1_EXP_G_S_21009_DAY    '                             
,'BASS1_EXP_G_S_22038_DAY')                                
and 
before_control_code not in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



select * from app.sch_control_before where control_code in 
(
'BASS1_EXP_G_A_01004_DAY'
,'BASS1_EXP_G_S_04005_DAY'
,'BASS1_EXP_G_S_04006_DAY'
,'BASS1_EXP_G_S_22038_DAY')


select * from app.sch_control_before where control_code in (
select before_control_code from app.sch_control_before where control_code in 
(
'BASS1_EXP_G_A_01004_DAY'
,'BASS1_EXP_G_S_04005_DAY'
,'BASS1_EXP_G_S_04006_DAY'
,'BASS1_EXP_G_S_22038_DAY')

)


select * from    bass1.G_REPORT_CHECK 


select * from app.sch_control_before where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)


select * from syscat.tables where tabname like '%BEFORE%' 



create table bass2.t_0x1f
(cola varchar(10),colb varchar(10))
in tbs_3h


select * from   bass2.t_0x1f


select hex('') from bass2.dual 



06021
06022
06023
22061
22062
22063
22064

select * from   bass1.mon_interface_info
select * from syscat.tables where tabname like 'MON%' 

select b.CONTROL_CODE,a.* from  BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
AND INTERFACE_CODE in 									
('06021'
,'06022'
,'06023'
,'22061'
,'22062'
,'22063'
,'22064')



select * from   BASS1.G_I_06021_MONTH

select count(0),count(distinct CHANNEL_ID) from   BASS1.G_I_06021_MONTH where time_id = 201102
select count(0) from   BASS1.G_I_06022_MONTH where time_id = 201102

select time_id , count(0) 
--,  count(distinct CHANNEL_TYPE ) 
from BASS1.G_I_06021_MONTH 
group by  time_id 
order by 1 

select CHANNEL_TYPE , count(0) 
--,  count(distinct CHANNEL_TYPE ) 
from BASS1.G_I_06021_MONTH 
group by  CHANNEL_TYPE 
order by 1 



select SELF_CHANNEL_ID , count(0) 
--,  count(distinct SELF_CHANNEL_ID ) 
from BASS1.G_I_06021_MONTH 
group by  SELF_CHANNEL_ID 
order by 1 




select POSITION , count(0) 
--,  count(distinct POSITION ) 
from BASS1.G_I_06021_MONTH 
group by  POSITION 
order by 1

select CHANNEL_B_TYPE , count(0) 
--,  count(distinct CHANNEL_B_TYPE ) 
from BASS1.G_I_06021_MONTH 
group by  CHANNEL_B_TYPE 
order by 1 


 select CHANNEL_STATUS , count(0) 
--,  count(distinct CHANNEL_STATUS ) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102
group by  CHANNEL_STATUS 
order by 1 

CHANNEL_STATUS	2
1	6466
2	29
3	740

1
2/24
3/24



 select  channel_type, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' and channel_type = '1'
group by   channel_type
order by 1 ,2

1	1	133


 select  channel_type, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
group by   channel_type
order by 1 ,2

CHANNEL_B_TYPE

 select  CHANNEL_B_TYPE, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
group by   CHANNEL_B_TYPE
order by 1 ,2

CHANNEL_STAR

 select  CHANNEL_STAR, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
group by   CHANNEL_STAR
order by 1 ,2
				
646	578	2078	1784	1240

 	133
1	646
2	578
3	2078
4	1784
5	572
6	668
7	7


select count(0) from   BASS1.G_I_06022_MONTH where time_id = 201102
7235

select count(*) from bass1.g_i_06022_month
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 )
  and time_id =201102
  

0602106022


select count(0) from     BASS1.G_I_06021_MONTH 
where  CHANNEL_STATUS = '1' and channel_type = '1'
and  time_id =201102
and channel_id not in 
(select distinct channel_id from bass1.g_i_06022_month where time_id =201102 )


0602206021

select count(0) from   
(
select channel_id from   BASS1.G_I_06022_MONTH where time_id =201102
except
select channel_id from   BASS1.G_I_06021_MONTH where time_id =201102
) a 


select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_i_06022_month where time_id =201102)
  and time_id =201102
  and channel_type <>'3'
  and channel_status='1'
  
 select count(0) from   BASS1.G_I_06023_MONTH where time_id = 201102


select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_i_06023_month where time_id =201102)
  and time_id =201102
  and channel_status='1'
  
  
  
 select count(*) from bass1.g_s_22061_month where  time_id =201102
 
 
 select count(*) from bass1.g_s_22061_month
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 )
  and time_id =201102
  
  
   select * from bass1.g_i_06022_month where  time_id =201102


select OWNER_TYPE , count(0) 
--,  count(distinct PROPERTY_SRC_TYPE ) 
from BASS1.G_I_06022_MONTH 
where  time_id =201102
group by  OWNER_TYPE 
order by 1 

22061

 select count(*) from bass1.g_s_22061_month
 where channel_id  in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 and channel_type = '3' )
  and time_id =201102
 7075
 
 
 select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22061_month where time_id =201102)
  and time_id =201102
  and channel_type<>'3'
  and channel_status='1'

0

select * from    bass1.g_s_22062_month a where a.ACCEPT_TYPE

ACCEPT_TYPE

select count(0),count(distinct b.CHANNEL_ID||b.ACCEPT_TYPE) from    bass1.g_s_22062_month b
where  b.TIME_ID = 201102 

1065	1065

select count(distinct b.CHANNEL_ID) from    bass1.g_s_22062_month a, bass1.g_i_06021_month b  
where a.time_id =201102 and b.TIME_ID = 201102 
and a.CHANNEL_ID = b.CHANNEL_ID

1065	918

select count(distinct a.CHANNEL_ID) from    bass1.g_s_22062_month  a
where a.time_id =201102
select count(*) from bass1.g_s_22062_month
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 )
  and time_id =201102
  
  
select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22062_month where time_id =201102)
  and time_id =201102
  and channel_status='1'
5554
  


select count(0) from      bass1.g_s_22062_month where time_id =201102



select count(distinct b.CHANNEL_ID) from    bass1.g_s_22062_month a, bass1.g_i_06021_month b  
where a.time_id =201102 and b.TIME_ID = 201102 
and a.CHANNEL_ID = b.CHANNEL_ID



select * from   bass1.g_s_22063_month a where a.time_id =201102

select count(0),count(distinct a.CHANNEL_ID) from    bass1.g_s_22063_month  a
where a.time_id =201102




select count(*) from bass1.g_s_22063_month
where channel_id not in
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 and channel_type<>'1')
  and time_id =201102
  
  
  
  select count(*) from bass1.g_s_22063_month
where channel_id in
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102 and channel_type='1')
  and time_id =201102



select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201102)
  and time_id =201102
  and channel_type in ('2','3')
  and channel_status='1'

5481


select time_id,count(0)
from bass1.G_S_22038_DAY
where time_id > 20110101
group by time_id



select *
from bass1.G_S_22038_DAY
where time_id > 20110101
group by time_id


CREATE TABLE BASS1.mon_user_mobile
 (
MOBILE_NUM  VARCHAR(11)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (MOBILE_NUM) USING HASHING
   
  ALTER TABLE BASS1.mon_user_mobile
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  insert into BASS1.mon_user_mobile
  select '15913269062'
  from bass2.dual
  
  
  select * from BASS1.mon_user_mobile
  
  	select  ('${MESSAGE_CONTENT}'),MOBILE_NUM from bass1.mon_user_mobile

select 'xxxxx',count(0) from ( select a.* ,row_number()over(partition by substr(filename,18,5) order by deal_time desc ) rn from APP.G_FILE_REPORT a where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00' ) t where rn = 1
    
select * from    APP.G_FILE_REPORT
s_13100_20100307_04003_00_001.dat    

select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
where upload_time = '每日9点前'

substr(filename,18,5)
in    

select 'xxxxx',count(0) from ( select a.* ,row_number()over(partition by substr(filename,18,5) order by deal_time desc ) rn from APP.G_FILE_REPORT a where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'  and substr(filename,18,5) in (select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
where upload_time = '每日9点前')
) t where rn = 1 

   
   
   select  'xxxxx',count(0)\
						from \
						( \
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn \
						from APP.G_FILE_REPORT a \
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') \
						and err_code='00' \
						and substr(filename,18,5) \
						in (  select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE \
								   where upload_time = '每日11点前' \
								) \
						) t where rn = 1
                        
                        

   
   select  'xxxxx',count(0)
						from 
						( 
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
						from APP.G_FILE_REPORT a 
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
						and err_code='00' 
						and substr(filename,18,5) 
						in (  select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
								   where upload_time = '每日11点前' 
								) 
						) t where rn = 1                        
                        
select upload_time , count(0) from    BASS1.MON_ALL_INTERFACE 
group by  upload_time                       


select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201102)
  and time_id =201102
  and channel_type in ('2','3')
  and channel_status='1'
  
  
  
select * from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201102)
  and time_id =201102
  and channel_type in ('2','3')
  and channel_status='1'

  
 
select * from bass2.stat_channel_reward_0002
where channel_name like '%便民%'
 





declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int,
   CHANNEL_ID     varchar(25)
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id
    ,CHANNEL_ID    )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id  
    ,e.CHANNEL_ID     
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id,CHANNEL_ID
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110531 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110531 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
commit


select count(distinct channel_id) from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'

select count(distinct user_id) from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'

select count(*) from 
(
select distinct channel_id from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
) aa
where aa.channel_id not in
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102)


 
 
 
 select * from BASS2.DW_CHANNEL_INFO_201109 where organize_id in (30300102,380235)



" select CHANNEL_STATUS , count(0) 
--,  count(distinct CHANNEL_STATUS ) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102
group by  CHANNEL_STATUS 
order by 1 "


select channel_status,count(channel_id) from bass1.g_i_06021_month
where time_id =201102
group by channel_status


select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_b_type in ('1','2','3')
  
  
  
  select a.channel_type_id id1,a.type_name  , b.channel_type_id id2,b.type_name ,
c.channel_type_id id3,c.type_name 
from 
(select * from bass2.ods_channel_type_20110209 a where parent_type_id=-1) a ,
(select * from bass2.ods_channel_type_20110209 
where parent_type_id in
  (select channel_type_id from bass2.ods_channel_type_20110209 a where parent_type_id=-1 )) b,
(select * from bass2.ods_channel_type_20110209 
where parent_type_id in
  (select channel_type_id from bass2.ods_channel_type_20110209 a 
    where parent_type_id in( select channel_type_id from bass2.ods_channel_type_20110209 a where parent_type_id =-1))) c                  
where  b.parent_type_id=a.channel_type_id
and  c.parent_type_id=b.channel_type_id
order by id1,id2,id3


select count(*) from
(
select distinct channel_star from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type<>'3'
) aa
where channel_star <>''


select channel_type,channel_star,count(0) from   
 bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  group by  channel_type,channel_star
  
 select count(*) from
(
select distinct channel_star from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type='3'
) aa
where channel_star=''

 
 
 select count(distinct channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type='1'
  
  
 select channel_type,count(distinct channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and (longitude='0' or longitude='' or latitude='0' or latitude='')
  group by channel_type
  order by 1,2
  
  select b.CHANNEL_STATUS, count(distinct a.CHANNEL_ID) from    bass1.g_s_22062_month  a
  ,bass1.g_i_06021_month b 
  where  a.CHANNEL_ID = b.CHANNEL_ID
  and  a.time_id =201102
  and b.time_id =201102
  group by b.CHANNEL_STATUS
  order by 1,2
  
  
  select accept_type,
     sum(bigint(new_users)),
    sum(bigint(hand_cnt)),
    sum(bigint(card_sale_cnt)),
    sum(bigint(accept_cnt)),
    --,sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt)),
    --,sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt))
    --,sum(bigint(query_bas_cnt))
from g_s_22062_month
where time_id =201102
group by accept_type


    select 
     sum(bigint(new_users)),
    sum(bigint(hand_cnt)),
    sum(bigint(card_sale_cnt)),
    sum(bigint(accept_cnt)),
    --,sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt)),
    --,sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt))
    --,sum(bigint(query_bas_cnt))
from g_s_22062_month
where time_id =201104

  
  
select   CHANNEL_STATUS,sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --+sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt))+
    --+sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt)) cnt
    --+sum(bigint(query_bas_cnt)) 
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by accept_type,CHANNEL_STATUS
) t group by CHANNEL_STATUS
order by 1,2


  
select   accept_type,sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --+sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt))+
    --+sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt)) cnt
    --+sum(bigint(query_bas_cnt)) 
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by accept_type,CHANNEL_STATUS
) t group by accept_type
order by 1,2


select max(cnt)
from (
select a.CHANNEL_ID,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --+sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt))+
    --+sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt)) cnt
    --+sum(bigint(query_bas_cnt)) 
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by a.CHANNEL_ID
) t 


select count(*) from
(
select sum(bigint(card_sale_cnt)) card_sale_cnt
from g_s_22062_month
where time_id =201102
) aa
where card_sale_cnt<=0

  
  
select   sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --sum(bigint(imp_accept_cnt))+
    sum(bigint(term_sale_cnt))+
    --sum(bigint(other_sale_cnt))+
    sum(bigint(accept_bas_cnt)) +
    sum(bigint(query_bas_cnt)) cnt
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by accept_type,CHANNEL_STATUS
) t 
			
--1723732
    select 
     sum(bigint(new_users))*1.0000/1723732*100
     ,sum(bigint(hand_cnt))*1.0000/1723732*100
     ,sum(bigint(card_sale_cnt))*1.0000/1723732*100
     ,sum(bigint(accept_cnt))*1.0000/1723732*100
     ,sum(bigint(term_sale_cnt))*1.0000/1723732*100
     ,sum(bigint(accept_bas_cnt))*1.0000/1723732*100     
     ,sum(bigint(query_bas_cnt))*1.0000/1723732*100     
from g_s_22062_month
where time_id =201102

 
 
select 
sum(bigint(imp_accept_cnt))
from g_s_22062_month
where time_id =201102

select 
sum(bigint(CNT))
from g_s_22064_month
where time_id =201102



select   CHANNEL_STATUS,sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --sum(bigint(imp_accept_cnt))+
    sum(bigint(term_sale_cnt))+
    --sum(bigint(other_sale_cnt))+
    sum(bigint(accept_bas_cnt)) +
    sum(bigint(query_bas_cnt)) cnt
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by accept_type,CHANNEL_STATUS
) t 
group by CHANNEL_STATUS
order by 1,2
			

 
 
 select IMP_ACCEPTTYPE , sum(bigint(cnt)) 
--,  count(distinct IMP_ACCEPTTYPE ) 
from g_s_22064_month 
group by  IMP_ACCEPTTYPE 
order by 1 

 
 select ACCEPT_TYPE , count(0) 
--,  count(distinct IMP_ACCEPTTYPE ) 
from g_s_22064_month 
group by  ACCEPT_TYPE 
order by 1 

g_s_22065_month


select sum(bigint(cnt))
from g_s_22064_month
where time_id =201102
  and imp_accepttype='23'
  
  select sum(bigint(cnt))
from g_s_22064_month
where time_id =201102
  and imp_accepttype='23'
  
  
  
 select busi_type,apply_type,count(distinct product_no) from g_i_02053_month
where time_id =201102
  and busi_type in ('09','14','15')
  and sts='0'
  and VALID_DATE between '20110201' and '20110231'
  and EXPIRE_DATE>='20110201'
group by busi_type,apply_type

 
 
  select busi_type,apply_type,count(distinct product_no) from g_i_02053_month
where time_id =201102
  and busi_type in ('14')
  and sts='0'
  and VALID_DATE between '20110201' and '20110231'
  and EXPIRE_DATE>='20110201'
group by busi_type,apply_type
--14	00	2671


  select busi_type,apply_type,sts,count(distinct product_no) from g_i_02053_month
where time_id =201102
  and busi_type in ('14')
  --and sts='0'
 and VALID_DATE like '201102%'
  --and EXPIRE_DATE>='20110201'
group by busi_type,apply_type,sts

2695


  select count(0), count(distinct product_no) from g_i_02053_month
where time_id =201102
  and busi_type in ('14')
   and VALID_DATE like '201102%'
   
  
select 
sum(bigint(CNT))
from g_s_22064_month
where time_id =201102
and IMP_ACCEPTTYPE = '06'  

select 
sum(bigint(CNT))
from g_s_22064_month
where time_id =201102
and IMP_ACCEPTTYPE = '07' 
--2731


select 
         TIME_ID
        ,sum(bigint(ZZHI_CNT          ))
        +sum(bigint(TERM_CNT          ))
        +sum(bigint(CARD_CNT          ))
        +sum(bigint(PAYMENT_CNT       ))
        +sum(bigint(OTHER_CNT         ))
        /**,sum(bigint(E_PAY_AMOUNT      ))
        ,sum(bigint(O_TERM_AMOUNT     ))
        ,sum(bigint(ZHI_CUST_CNT      ))
        ,sum(bigint(E_CUST_CNT        ))
        ,sum(bigint(TX_CUST_CNT       ))**/
from g_s_22065_month
where TIME_ID = 201102
group by   TIME_ID
 
 
select 
         TIME_ID
        ,sum(bigint(ZZHI_CNT          ))
        +sum(bigint(TERM_CNT          ))
        +sum(bigint(CARD_CNT          ))
        +sum(bigint(PAYMENT_CNT       ))
        +sum(bigint(OTHER_CNT         ))
from g_s_22065_month
where TIME_ID = 201102
group by   TIME_ID


select   accept_type,sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --+sum(bigint(imp_accept_cnt))
    sum(bigint(term_sale_cnt))+
    --+sum(bigint(other_sale_cnt))
    sum(bigint(accept_bas_cnt))+
    sum(bigint(query_bas_cnt)) cnt
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201102
  and b.time_id =201102
group by accept_type,CHANNEL_STATUS
) t 
where accept_type = '1'
group by accept_type
order by 1,2


  
  
  select length(trim(channel_id)),count(0) from 
  bass1.g_i_06021_month
  where time_id = 201102
  group by length(trim(channel_id))
  
  
  
    select * from 
  bass1.g_i_06021_month
  where time_id = 201102
 and length(trim(channel_id)) = 7
 
  
  
declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int,
   CHANNEL_ID     varchar(25)
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


select * from   bass1.g_a_02004_day

--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id
    ,CHANNEL_ID    )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id  
    ,e.CHANNEL_ID     
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id,CHANNEL_ID
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110231 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110231 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
commit


select count(*) from 
(
select distinct channel_id from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
) aa
where aa.channel_id not in
(select distinct channel_id from bass1.g_i_06021_month where time_id =201102)
  
  
  select distinct channel_id from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
except 
select distinct channel_id from bass1.g_i_06021_month where time_id =201102
113

select count(0),count(distinct CHANNEL_ID),count(distinct ORGANIZE_ID) from    bass2.dw_channel_info_201102
7411	7411	7404


select * from    bass2.dw_channel_info_201102
where char(CHANNEL_ID) in 
 ( select distinct channel_id from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
except 
select distinct channel_id from bass1.g_i_06021_month where time_id =201102
)


select * from    g_s_22065_month
where TIME_ID = 201102



select distinct e.channel_id
				  from bass2.dw_product_ord_cust_201102 a,
				       bass2.dw_product_ord_offer_dm_201102 b,
				       bass2.dim_prod_up_product_item d,
				       bass2.dim_pub_channel e,
				       bass2.dim_sys_org_role_type f,
				       bass2.dim_cfg_static_data g,
				       bass2.dw_channel_info_201102 h
				 where a.customer_order_id = b.customer_order_id
				   and b.offer_id = d.product_item_id
				   and a.org_id = e.channel_id
				   and a.channel_type = g.code_value
				   and g.code_type = '911000'
				   and e.channeltype_id = f.org_role_type_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
				   and a.channel_type in ('Q','L','I','e','D','B','6','4')

select * from bass2.dw_product_201102 where char(channel_id) = '381716'                   
                   
                  
select * from   bass2.dw_channel_info_201102 where   char(channel_id) = '381716'        
      
select * from   bass2.dw_channel_info_201102 where   char(organize_id) = '381716'        
         
select * from    session.int_check_user_status where      char(channel_id) = '381716'       

select * from   bass2.dw_channel_info_201102 where   char(channel_id) = '381716'        
select * from   
bass2.ODS_DIM_SYS_ORGANIZE_20110410
 where   char(organize_id) = '381716'    
 



select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type='4'

select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_b_type in ('4')


select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_b_type in ('5','6')
--6551

select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type='3'
--6312




select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_b_type in ('1','2','3')

133

select count(channel_id) from bass1.g_i_06021_month
where time_id =201102
  and channel_status='1'
  and channel_type in ('1','2')
  


select staff_org_id
    ,case when opt_code in ('4464','4465','4864','4865') then '2' else '1' end
    ,sum(case when CERTIFICATE_TYPE='6' then 1 else 0 end )
    ,sum(case when CERTIFICATE_TYPE='6' then amount else 0 end )
from BASS2.dw_acct_payment_dm_201102
group by staff_org_id
        ,case when opt_code in ('4464','4465','4864','4865') then '2' else '1' end






insert into  SESSION.G_S_22062_MONTH_TMP_1
          (  	CHANNEL_ID
						, ACCEPT_TYPE
						, NEW_USERS
						, HAND_CNT
						, HAND_FEE
						, CARD_SALE_CNT
						, CARD_SALE_FEE
						, ACCEPT_CNT
						, IMP_ACCEPT_CNT
						, TERM_SALE_CNT
						, OTHER_SALE_CNT
						, ACCEPT_BAS_CNT
						, QUERY_BAS_CNT
						, OFF_ACCEPT_CNT    )
			select channel_id
						,'1'
						,count(1)
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
						,0
			from bass2.dw_product_201104
			where month_new_mark = 1
			group by Channel_ID
            
select * from   g_i_06021_month


select count(0)
from (
select char(a.CHANNEL_ID),char(user_id)
from bass2.dw_product_201102 a,bass1.g_i_06021_month b 
where month_new_mark = 1
and char(a.CHANNEL_ID) = trim(b.CHANNEL_ID)
and b.time_id = 201102
) t 
--52916
select count(0)
from (
select  char(CHANNEL_ID),char(user_id)
from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
) t 

52906

select char(CHANNEL_ID),char(user_id)
from bass2.dw_product_201102
where month_new_mark = 1
except
select  char(CHANNEL_ID),char(user_id)
from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'




select  char(CHANNEL_ID),char(user_id)
from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
except
select char(CHANNEL_ID),char(user_id)
from bass2.dw_product_201102
where month_new_mark = 1


select count(distinct user_id) from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'





select  char(CHANNEL_ID),char(user_id)
from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
except
select char(a.CHANNEL_ID),char(user_id)
from bass2.dw_product_201102 a,g_i_06021_month b 
where month_new_mark = 1
and char(a.CHANNEL_ID) = trim(b.CHANNEL_ID)
and b.time_id = 201102


select * from BASS2.ETL_SEND_MESSAGE


select * from   BASS1.G_I_06023_MONTH


select * from   bass2.ods_channel_info_20110410

select * from   bass2.Dim_channel_info
select * from   g_s_22061_month

select * from   g_i_06023_month


22062

select * from   g_s_22062_month


select * from   g_a_01004_day



CREATE TABLE BASS1.g_a_01004_tmp1
	              (
	               enterprise_id       varchar(20),
                   numbers             int
	              )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (enterprise_id) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp1
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  CREATE TABLE BASS1.g_a_01004_tmp2
	              (
	               enterprise_id       varchar(20),
                   manager_id          varchar(20)
	              )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (enterprise_id) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp2
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
 CREATE TABLE BASS1.g_a_01004_tmp10
	              (
	               enterprise_id       varchar(20)	              
	               )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (enterprise_id) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp10
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
 
 
 
 select count(0),count(distinct enterprise_id)  from  bass2.dwd_enterprise_msg_his_20110411
 
 
 
 
:
 select count(0) from
   (select time_id,enterprise_id,cust_statu_typ_id from G_A_01004_DAY where time_id <= 20110411 ) a,
   (select enterprise_id,max(time_id) as time_id  from G_A_01004_DAY 
                                                 where time_id<=20110411  
                                              group by enterprise_id)b
where a.time_id=b.time_id and a.enterprise_id=b.enterprise_id and a.cust_statu_typ_id = '20'



 select count(0) 
from 
(
select time_id,enterprise_id,cust_statu_typ_id ,row_number()over(partition by enterprise_id order by time_id desc) rn 
from bass1.G_A_01004_DAY 
where time_id <= 20110411 
) t where t.rn = 1 and  cust_statu_typ_id = '20'


  select enterprise_id
from 
(
select time_id,enterprise_id,cust_statu_typ_id ,row_number()over(partition by enterprise_id order by time_id desc) rn 
from bass1.G_A_01004_DAY 
where time_id <= 20110411 
) t where t.rn = 1 and  cust_statu_typ_id = '20'
except 
 select enterprise_id
from 
(
select time_id,enterprise_id,cust_statu_typ_id ,row_number()over(partition by enterprise_id order by time_id desc) rn 
from bass1.G_A_01004_DAY 
where time_id <= 20110411 
) t where t.rn = 1 and  cust_statu_typ_id = '20'




select distinct t.enterprise_id
from 
(
select time_id,enterprise_id,cust_statu_typ_id ,row_number()over(partition by enterprise_id order by time_id desc) rn 
from bass1.G_A_01004_DAY 
where time_id <= $timestamp   
) t where t.rn = 1 and  cust_statu_typ_id = '20'




select count(distinct a.enterprise_id) from
                 (select time_id,enterprise_id,cust_statu_typ_id from G_A_01004_DAY where time_id <= 20110411) a,
                 (select enterprise_id,max(time_id) as time_id  from G_A_01004_DAY 
                                                                 where time_id<=20110411
															                                group by enterprise_id)b
                where a.time_id=b.time_id and a.enterprise_id=b.enterprise_id and a.cust_statu_typ_id = '20' 



CREATE table  bass1.g_a_01004_tmp11 like bass2.dwd_enterprise_msg_his_20110411
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (CUST_ID
   ) USING HASHING     



	select 
  	     ENTERPRISE_ID
        ,GROUP_NAME
        ,PASSWORD
        ,GROUP_LEVEL
        ,GROUP_TYPE
        ,REGION_SPECIA
        ,GROUP_STATUS
        ,LEVEL_DEF_MODE
        ,REC_STATUS
        ,VOCATION
        ,VOCATION2
        ,VOCATION3
        ,GROUP_COUNTRY
        ,GROUP_PROVINCE
        ,GROUP_CITY
        ,REGION_TYPE
        ,REGION_DETAIL
        ,GROUP_ADDRESS
        ,GROUP_POSTCODE
        ,POST_PROVINCE
        ,POST_CITY
        ,POST_ADDRESS
        ,POST_POSTCODE
        ,PHONE_ID
        ,FAX_ID
        ,IDEN_ID
        ,IDEN_NBR
        ,OWNER_NAME
        ,TAX_ID
        ,NET_ADDRESS
        ,PAY_TYPE
        ,EMAIL
        ,CREATE_DATE
        ,DONE_DATE
        ,VALID_DATE
        ,EXPIRE_DATE
        ,OP_ID
        ,ORG_ID
        ,SO_NBR
        ,CUST_ID
        ,NOTES
        ,VPMN_ID
        ,EXT_FIELD1
        ,EXT_FIELD2
        ,EXT_FIELD3
        ,EXT_FIELD4
        ,EXT_FIELD5
        ,EXT_FIELD6
        ,EXT_FIELD7
        ,EXT_FIELD8
        ,EXT_FIELD9
        ,EXT_FIELD10
				from 
				(
				select a.*,row_number()over(partition by enterprise_id order by done_date desc) rn 
				from bass2.dwd_enterprise_msg_his_20110411 a
				) t 
				where t.rn = 1 
					and  t.rec_status = 0 
					and t.enterprise_id in (select enterprise_id from bass1.g_a_01004_tmp10) 

                    
                    
select count(0) from     bass1.g_a_01004_day
6681157
select count(0) from     bass1.g_a_01004_day_20110412bak
6681157                    
                    
select time_id , count(0) 
from bass1.g_a_01004_day 
where time_id > 20110101
group by  time_id 
order by 1 desc
           
20110411	11215
           
20110411	11705
20110410	11703


select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_a_01004_day_20110412bak 
where time_id > 20110101
group by  time_id 
order by 1 

20110411	11705
20110410	11703

select * from   bass1.g_a_01004_day_20110412bak where time_id = 20110411
except
select * from   bass1.g_a_01004_day where time_id = 20110411


select * from   bass1.g_a_01004_day where time_id = 20110411
except
select * from   bass1.g_a_01004_day_20110412bak where time_id = 20110411


select count(0)
                                from BASS2.DW_ENTERPRISE_ACCOUNT_20110411 where REC_STATUS=1

select * from   bass1.g_a_01004_tmp10 
where ENTERPRISE_ID = '891930005308'

select * from   bass1.g_a_01004_tmp11 
where ENTERPRISE_ID = '891930005308'                                        
select *    
				from 
				(
				select a.*,row_number()over(partition by enterprise_id order by done_date desc) rn 
				from bass2.dwd_enterprise_msg_his_20110411 a
				) t                                 
where ENTERPRISE_ID = '891930005308'                                        
				and t.rn = 1 
					and  t.rec_status = 0                    

select *    
				from 
				(
				select a.*,row_number()over(partition by enterprise_id order by done_date desc) rn 
				from bass2.dwd_enterprise_msg_his_20110411 a
				) t                                 
where ENTERPRISE_ID = '891930005308'                                        
				and t.rn = 1 
					and  t.rec_status = 0 

select rec_status
from 
(select a.* from 
(select * from bass2.dwd_enterprise_msg_his_20110411)  a,
(select enterprise_id,max(done_date) as done_date from bass2.dwd_enterprise_msg_his_20110411  group by enterprise_id) b
where a.done_date = b.done_date and a.enterprise_id = b.enterprise_id and rec_status = 0 and  a.enterprise_id in (select * from bass1.g_a_01004_tmp10) 
)a 
where ENTERPRISE_ID = '891930005308'                                        
					and  a.rec_status = 0 


select enterprise_id,max(done_date) as done_date,rec_status from bass2.dwd_enterprise_msg_his_20110411 
where ENTERPRISE_ID = '891930005308'  
 group by enterprise_id ,rec_status
 
 
                   
CREATE TABLE BASS1.g_a_01004_tmp3
 (TIME_ID            INTEGER,
  ENTERPRISE_ID      CHARACTER(20),
  ENT_DEF_MODE       CHARACTER(1),
  PRT_GRP_CUST_ID    CHARACTER(20),
  ENTERPRISE_NAME    CHARACTER(60),
  OWNER_NAME         CHARACTER(20),
  NET_ADDRESS        CHARACTER(250),
  FAX_NO             CHARACTER(20),
  ENT_SCALE_ID       CHARACTER(1),
  MEMBER_NUMS        CHARACTER(8),
  ENT_REGION_TYPE    CHARACTER(2),
  ENT_INDUSTRY_ID    CHARACTER(2),
  GRP_AREA_SPEC_ID   CHARACTER(2),
  ENT_MANAGER_ID     CHARACTER(20),
  CMCC_ID            CHARACTER(5),
  CREATE_DATE        CHARACTER(8),
  LINKMAN_NAME       CHARACTER(20),
  TELEPHONE_NUM      CHARACTER(20),
  MOBILE_NUM         CHARACTER(15),
  LINKMAN_TITLE      CHARACTER(20),
  LINKMAN_FAX        CHARACTER(20),
  LINKMAN_MAIL       CHARACTER(50),
  LINKMAN_ADDR       CHARACTER(70),
  POST_CODE          CHARACTER(6),
  CUST_STATU_TYP_ID  CHARACTER(2),
  UNITE_PAY_FLAG     CHARACTER(1),
  IND_RES_SCHEMA     CHARACTER(100),
  CRT_CHNL_ID        CHARACTER(25),
  ENTER_TYPE_ID      CHARACTER(2)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,
    ENTERPRISE_ID
   ) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp3
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

                                      
                                      

CREATE TABLE BASS1.g_a_01004_tmp12
 (TIME_ID            INTEGER,
  ENTERPRISE_ID      CHARACTER(20),
  ENT_DEF_MODE       CHARACTER(1),
  PRT_GRP_CUST_ID    CHARACTER(20),
  ENTERPRISE_NAME    CHARACTER(60),
  OWNER_NAME         CHARACTER(20),
  NET_ADDRESS        CHARACTER(250),
  FAX_NO             CHARACTER(20),
  ENT_SCALE_ID       CHARACTER(1),
  MEMBER_NUMS        CHARACTER(8),
  ENT_REGION_TYPE    CHARACTER(2),
  ENT_INDUSTRY_ID    CHARACTER(2),
  GRP_AREA_SPEC_ID   CHARACTER(2),
  ENT_MANAGER_ID     CHARACTER(20),
  CMCC_ID            CHARACTER(5),
  CREATE_DATE        CHARACTER(8),
  LINKMAN_NAME       CHARACTER(20),
  TELEPHONE_NUM      CHARACTER(20),
  MOBILE_NUM         CHARACTER(15),
  LINKMAN_TITLE      CHARACTER(20),
  LINKMAN_FAX        CHARACTER(20),
  LINKMAN_MAIL       CHARACTER(50),
  LINKMAN_ADDR       CHARACTER(70),
  POST_CODE          CHARACTER(6),
  CUST_STATU_TYP_ID  CHARACTER(2),
  UNITE_PAY_FLAG     CHARACTER(1),
  IND_RES_SCHEMA     CHARACTER(100),
  CRT_CHNL_ID        CHARACTER(25),
  ENTER_TYPE_ID      CHARACTER(2)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,
    ENTERPRISE_ID
   ) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp12
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE


select count(0) from    bass1.g_a_01004_tmp10 


select 
  	     ENTERPRISE_ID
        ,GROUP_NAME
        ,PASSWORD
        ,GROUP_LEVEL
        ,GROUP_TYPE
        ,REGION_SPECIA
        ,GROUP_STATUS
        ,LEVEL_DEF_MODE
        ,REC_STATUS
        ,VOCATION
        ,VOCATION2
        ,VOCATION3
        ,GROUP_COUNTRY
        ,GROUP_PROVINCE
        ,GROUP_CITY
        ,REGION_TYPE
        ,REGION_DETAIL
        ,GROUP_ADDRESS
        ,GROUP_POSTCODE
        ,POST_PROVINCE
        ,POST_CITY
        ,POST_ADDRESS
        ,POST_POSTCODE
        ,PHONE_ID
        ,FAX_ID
        ,IDEN_ID
        ,IDEN_NBR
        ,OWNER_NAME
        ,TAX_ID
        ,NET_ADDRESS
        ,PAY_TYPE
        ,EMAIL
        ,CREATE_DATE
        ,DONE_DATE
        ,VALID_DATE
        ,EXPIRE_DATE
        ,OP_ID
        ,ORG_ID
        ,SO_NBR
        ,CUST_ID
        ,NOTES
        ,VPMN_ID
        ,EXT_FIELD1
        ,EXT_FIELD2
        ,EXT_FIELD3
        ,EXT_FIELD4
        ,EXT_FIELD5
        ,EXT_FIELD6
        ,EXT_FIELD7
        ,EXT_FIELD8
        ,EXT_FIELD9
        ,EXT_FIELD10
				from bass2.dwd_enterprise_msg_his_20110411 a,
        (select enterprise_id,max(done_date) as done_date from bass2.dwd_enterprise_msg_his_20110411  group by enterprise_id) b
        where a.done_date = b.done_date 
        			and a.enterprise_id = b.enterprise_id and rec_status = 0 
        			and  a.enterprise_id in (select t.enterprise_id from bass1.g_a_01004_tmp10 t) 
				with ur                                       

select 
  	     a.ENTERPRISE_ID
        ,a.GROUP_NAME
        ,a.PASSWORD
        ,a.GROUP_LEVEL
        ,a.GROUP_TYPE
        ,a.REGION_SPECIA
        ,a.GROUP_STATUS
        ,a.LEVEL_DEF_MODE
        ,a.REC_STATUS
        ,a.VOCATION
        ,a.VOCATION2
        ,a.VOCATION3
        ,a.GROUP_COUNTRY
        ,a.GROUP_PROVINCE
        ,a.GROUP_CITY
        ,a.REGION_TYPE
        ,a.REGION_DETAIL
        ,a.GROUP_ADDRESS
        ,a.GROUP_POSTCODE
        ,a.POST_PROVINCE
        ,a.POST_CITY
        ,a.POST_ADDRESS
        ,a.POST_POSTCODE
        ,a.PHONE_ID
        ,a.FAX_ID
        ,a.IDEN_ID
        ,a.IDEN_NBR
        ,a.OWNER_NAME
        ,a.TAX_ID
        ,a.NET_ADDRESS
        ,a.PAY_TYPE
        ,a.EMAIL
        ,a.CREATE_DATE
        ,a.DONE_DATE
        ,a.VALID_DATE
        ,a.EXPIRE_DATE
        ,a.OP_ID
        ,a.ORG_ID
        ,a.SO_NBR
        ,a.CUST_ID
        ,a.NOTES
        ,a.VPMN_ID
        ,a.EXT_FIELD1
        ,a.EXT_FIELD2
        ,a.EXT_FIELD3
        ,a.EXT_FIELD4
        ,a.EXT_FIELD5
        ,a.EXT_FIELD6
        ,a.EXT_FIELD7
        ,a.EXT_FIELD8
        ,a.EXT_FIELD9
        ,a.EXT_FIELD10
				from bass2.dwd_enterprise_msg_his_20110411 a,
        (select enterprise_id,max(done_date) as done_date from bass2.dwd_enterprise_msg_his_20110411  group by enterprise_id) b
        where a.done_date = b.done_date 
        			and a.enterprise_id = b.enterprise_id and rec_status = 0 
        			and  a.enterprise_id in (select t.enterprise_id from bass1.g_a_01004_tmp10 t) 
				with ur                  
                
                

CREATE TABLE BASS1.g_a_01004_tmp4
 (TIME_ID            INTEGER,
  ENTERPRISE_ID      CHARACTER(20),
  ENT_DEF_MODE       CHARACTER(1),
  PRT_GRP_CUST_ID    CHARACTER(20),
  ENTERPRISE_NAME    CHARACTER(60),
  OWNER_NAME         CHARACTER(20),
  NET_ADDRESS        CHARACTER(250),
  FAX_NO             CHARACTER(20),
  ENT_SCALE_ID       CHARACTER(1),
  MEMBER_NUMS        CHARACTER(8),
  ENT_REGION_TYPE    CHARACTER(2),
  ENT_INDUSTRY_ID    CHARACTER(2),
  GRP_AREA_SPEC_ID   CHARACTER(2),
  ENT_MANAGER_ID     CHARACTER(20),
  CMCC_ID            CHARACTER(5),
  CREATE_DATE        CHARACTER(8),
  LINKMAN_NAME       CHARACTER(20),
  TELEPHONE_NUM      CHARACTER(20),
  MOBILE_NUM         CHARACTER(15),
  LINKMAN_TITLE      CHARACTER(20),
  LINKMAN_FAX        CHARACTER(20),
  LINKMAN_MAIL       CHARACTER(50),
  LINKMAN_ADDR       CHARACTER(70),
  POST_CODE          CHARACTER(6),
  CUST_STATU_TYP_ID  CHARACTER(2),
  UNITE_PAY_FLAG     CHARACTER(1),
  IND_RES_SCHEMA     CHARACTER(100),
  CRT_CHNL_ID        CHARACTER(25),
  ENTER_TYPE_ID      CHARACTER(2)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,
    ENTERPRISE_ID
   ) USING HASHING

ALTER TABLE BASS1.g_a_01004_tmp4
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE                
  
  			DECLARE GLOBAL TEMPORARY TABLE SESSION.G_S_22062_MONTH_TMP_1
          (  	CHANNEL_ID      		BIGINT   ,
              ACCEPT_TYPE         CHAR(1) ,
              NEW_USERS          bigint		,
						  HAND_CNT           bigint		,
						  HAND_FEE           bigint		,
						  CARD_SALE_CNT      bigint		,
						  CARD_SALE_FEE      bigint		,
						  ACCEPT_CNT         bigint		,
						  IMP_ACCEPT_CNT     bigint		,
						  TERM_SALE_CNT      bigint		,
						  OTHER_SALE_CNT     bigint		,
						  ACCEPT_BAS_CNT     bigint		,
						  QUERY_BAS_CNT      bigint		,
						  OFF_ACCEPT_CNT     bigint
           )
      PARTITIONING KEY (CHANNEL_ID,ACCEPT_TYPE) USING HASHING
      WITH REPLACE ON COMMIT PRESERVE ROWS NOT LOGGED IN TBS_USER_TEMP
  
  					create table bass1.G_S_22062_MONTH_TMP_1bak like session.G_S_22062_MONTH_TMP_1
					DATA CAPTURE NONE
					IN TBS_APP_BASS1
					INDEX IN TBS_INDEX
					PARTITIONING KEY (CHANNEL_ID,ACCEPT_TYPE) USING HASHING
                    
                    
					insert into  bass1.G_S_22062_MONTH_TMP_1bak select * from session.G_S_22062_MONTH_TMP_1

select count(0),count(distinct a.channel_id) from    bass1.G_S_22062_MONTH_TMP_1bak a
                    
select distinct char(a.channel_id) from    bass1.G_S_22062_MONTH_TMP_1bak a
left join BASS2.DW_CHANNEL_INFO_201102 b on a.channel_id = b.channel_id 
where b.channel_id is null
union 
  select distinct char(channel_id) from session.int_check_user_status
where create_date between '20110201' and '20110231'
and test_flag='0'
except 
select distinct channel_id from bass1.g_i_06021_month where time_id =201102

                    
ods_channel_info_
                    

--DW_CHANNEL_INFO_201103 有，在ODS_DIM_SYS_ORGANIZE_20110411找不到的
select * from BASS2.DW_CHANNEL_INFO_201103 a where not exists (select 1 from BASS2.ODS_DIM_SYS_ORGANIZE_20110411 b where a.organize_id = b.organize_id and b.STATE=1)
and CHANNEL_STATE=1

--在ODS_DIM_SYS_ORGANIZE_20110411有，但DW_CHANNEL_INFO_201103 没有的
select * from BASS2.ODS_DIM_SYS_ORGANIZE_20110411 a where not exists (select 1 from BASS2.DW_CHANNEL_INFO_201103 b where a.organize_id = b.organize_id and b.CHANNEL_STATE=1)
and a.state=1

--在dw_product_201103有，但ODS_DIM_SYS_ORGANIZE_20110411没有的
select distinct a.channel_id from BASS2.dw_product_201103 a where not exists (select 1 from bass2.ODS_DIM_SYS_ORGANIZE_20110411 b where a.channel_id = b.organize_id)
and userstatus_id in (1,2,3,6,8) and test_mark=0

--在dw_product_201103有，但DW_CHANNEL_INFO_201103没有的
select distinct a.channel_id from BASS2.dw_product_201103 a where not exists (select 1 from BASS2.DW_CHANNEL_INFO_201103 b where a.channel_id = b.channel_id)
and userstatus_id in (1,2,3,6,8) and test_mark=0
                    



select * from BASS2.ODS_CHANNEL_INFO_20110411 a where not exists (select 1 from BASS2.ODS_DIM_SYS_ORGANIZE_20110411 b where a.organize_id = b.organize_id and b.STATE=1)
and CHANNEL_STATE=1




--DW_CHANNEL_INFO有，在ODS_DIM_SYS_ORGANIZE找不到的,即无相应的organize_id信息
select a.channel_id,a.organize_id from BASS2.ODS_CHANNEL_INFO_20110411 a where not exists (select 1 from BASS2.ODS_DIM_SYS_ORGANIZE_20110411 b where a.organize_id = b.organize_id and b.STATE=1)
and CHANNEL_STATE=1

--在dw_product有，但DW_CHANNEL_INFO没有的,(导致开户渠道标识不在06021中,校验失败)
select distinct a.channel_id from BASS2.dw_product_201103 a where not exists (select 1 from BASS2.ODS_CHANNEL_INFO_20110411 b where a.channel_id = b.channel_id)
and userstatus_id in (1,2,3,6,8) and test_mark=0
        
        
--在ODS_DIM_SYS_ORGANIZE有，但DW_CHANNEL_INFO没有的 ,即无相应的channel_id信息
select a.organize_id from BASS2.ODS_DIM_SYS_ORGANIZE_20110411 a where not exists (select 1 from BASS2.ODS_CHANNEL_INFO_20110411 b where a.organize_id = b.organize_id and b.CHANNEL_STATE=1)
and a.state=1

--在dw_product有，但ODS_DIM_SYS_ORGANIZE没有的
select distinct a.channel_id from BASS2.dw_product_201103 a where not exists (select 1 from bass2.ODS_DIM_SYS_ORGANIZE_20110411 b where a.channel_id = b.organize_id)
and userstatus_id in (1,2,3,6,8) and test_mark=0

            
            
CREATE TABLE BASS1.dim_21003_ip_type
 (
 	ip_type_id varchar(4)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ip_type_id) USING HASHING
   
ALTER TABLE BASS1.dim_21003_ip_type
LOCKSIZE ROW
APPEND OFF
NOT VOLATILE
     

select * from   BASS1.dim_21003_ip_type
            

select count(0)
from (
select
                                        1
					,PRODUCT_NO
					,case when ip_type_id not in ('1000', '2000', '2100', '2101', '2102', '2199', '2200', '2201', 
                                        '2202', '2203', '2204', '2299', '3000', '3100', '3101', '3102', 
                                        '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', 
                                        '3111', '3112', '3113', '3114', '3199', '3200', '4000', '4100', 
                                        '4101', '4102', '4103', '4104', '4105', '4106', '4107', '4108', 
                                        '4109', '4110', '4111', '4199', '4200', '6000', '6100', '6101', 
                                        '6102', '6103', '6104', '6105', '6106', '6107', '6199', '6200', 
                                        '9000' ) 
                then '9000' else ip_type_id end
				FROM
					bass1.int_210012916_201103 a 
          WHERE op_time=20110331
				 GROUP BY
					PRODUCT_NO
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,ip_type_id
					,adversary_id
					,roam_type_id
					,call_type_id
) t             

3112611
356



lite1:14

select count(0)
from (
select
                                        1
					,PRODUCT_NO
				  ,case when b.ip_type_id is not null then b.ip_type_id else '9000' end 
					/**,case when ip_type_id not in ('1000', '2000', '2100', '2101', '2102', '2199', '2200', '2201', 
                                        '2202', '2203', '2204', '2299', '3000', '3100', '3101', '3102', 
                                        '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', 
                                        '3111', '3112', '3113', '3114', '3199', '3200', '4000', '4100', 
                                        '4101', '4102', '4103', '4104', '4105', '4106', '4107', '4108', 
                                        '4109', '4110', '4111', '4199', '4200', '6000', '6100', '6101', 
                                        '6102', '6103', '6104', '6105', '6106', '6107', '6199', '6200', 
                                        '9000' ) 
                then '9000' else ip_type_id end **/
				FROM
					bass1.int_210012916_201103 a 
					left join bass1.dim_21003_ip_type b on a.ip_type_id = b.ip_type_id
          WHERE a.op_time=20110331
				 GROUP BY
					PRODUCT_NO
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,case when b.ip_type_id is not null then b.ip_type_id else '9000' end 
					,toll_type_id
					,adversary_id
					,roam_type_id
					,call_type_id
) t 					

2:03
3112611
lite1:09
select ip_type_id,count(0)
from bass1.int_210012916_201103  a
where  a.op_time=20110331
group by ip_type_id

IP_TYPE_ID	2
1000	7269836
2102	57771
2202	1
4101	2
4102	5
4103	1
4104	2
6101	1
6104	28

select * from   bass1.int_210012916_201103 

select ip_type_id,count(0)
from bass1.int_210012916_201103  a
where  a.op_time=20110331
group by ip_type_id






select ip_type_id,count(0)
from (
select
                                        1
					,PRODUCT_NO
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
				  ,case when b.ip_type_id is not null then b.ip_type_id else '9000' end  ip_type_id
					/**,case when ip_type_id not in ('1000', '2000', '2100', '2101', '2102', '2199', '2200', '2201', 
                                        '2202', '2203', '2204', '2299', '3000', '3100', '3101', '3102', 
                                        '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', 
                                        '3111', '3112', '3113', '3114', '3199', '3200', '4000', '4100', 
                                        '4101', '4102', '4103', '4104', '4105', '4106', '4107', '4108', 
                                        '4109', '4110', '4111', '4199', '4200', '6000', '6100', '6101', 
                                        '6102', '6103', '6104', '6105', '6106', '6107', '6199', '6200', 
                                        '9000' ) 
                then '9000' else ip_type_id end **/
					,adversary_id
					,roam_type_id
					,call_type_id
					,char(bigint(sum(call_counts		)))
					,char(bigint(sum(base_bill_duration	)))
					,char(bigint(sum(toll_bill_duration	)))
					,char(bigint(sum(call_duration		)))
					,char(bigint(sum(base_call_fee		)))
					,char(bigint(sum(toll_call_fee		)))
					,char(bigint(sum(callfw_toll_fee	)))
					,char(bigint(sum(call_fee		)))
					,char(bigint(sum(favoured_basecall_fee	)))
					,char(bigint(sum(favoured_tollcall_fee	)))
					,char(bigint(sum(favoured_callfw_tollfee)))
					,char(bigint(sum(favoured_call_fee	)))
					,char(bigint(sum(free_duration		)))
					,char(bigint(sum(favour_duration	)))
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
				FROM
					bass1.int_210012916_201103 a 
					left join bass1.dim_21003_ip_type b on a.ip_type_id = b.ip_type_id
          WHERE a.op_time=20110331
				 GROUP BY
					PRODUCT_NO
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,case when b.ip_type_id is not null then b.ip_type_id else '9000' end 
					,adversary_id
					,roam_type_id
					,call_type_id
) t 					
group by ip_type_id

IP_TYPE_ID	2
1000	3074539
2102	38036
2202	1
4101	2
4102	5
4103	1
4104	2
6101	1
6104	24


2:26
select ip_type_id,count(0)
from (
select
                                        1
					,PRODUCT_NO
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,case when ip_type_id not in ('1000', '2000', '2100', '2101', '2102', '2199', '2200', '2201', 
                                        '2202', '2203', '2204', '2299', '3000', '3100', '3101', '3102', 
                                        '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', 
                                        '3111', '3112', '3113', '3114', '3199', '3200', '4000', '4100', 
                                        '4101', '4102', '4103', '4104', '4105', '4106', '4107', '4108', 
                                        '4109', '4110', '4111', '4199', '4200', '6000', '6100', '6101', 
                                        '6102', '6103', '6104', '6105', '6106', '6107', '6199', '6200', 
                                        '9000' ) 
                then '9000' else ip_type_id end ip_type_id
					,adversary_id
					,roam_type_id
					,call_type_id
					,char(bigint(sum(call_counts		)))
					,char(bigint(sum(base_bill_duration	)))
					,char(bigint(sum(toll_bill_duration	)))
					,char(bigint(sum(call_duration		)))
					,char(bigint(sum(base_call_fee		)))
					,char(bigint(sum(toll_call_fee		)))
					,char(bigint(sum(callfw_toll_fee	)))
					,char(bigint(sum(call_fee		)))
					,char(bigint(sum(favoured_basecall_fee	)))
					,char(bigint(sum(favoured_tollcall_fee	)))
					,char(bigint(sum(favoured_callfw_tollfee)))
					,char(bigint(sum(favoured_call_fee	)))
					,char(bigint(sum(free_duration		)))
					,char(bigint(sum(favour_duration	)))
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
				FROM
					bass1.int_210012916_201103 a 
          WHERE op_time=20110331
				 GROUP BY
					PRODUCT_NO
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,ip_type_id
					,adversary_id
					,roam_type_id
					,call_type_id
) t 					
group by ip_type_id

IP_TYPE_ID	2
1000	3074539
2102	38036
2202	1
4101	2
4102	5
4103	1
4104	2
6101	1
6104	24



--调度程序耗时:
select A.*,char(a.RUNTIME/60)||'min',char(a.RUNTIME/60/60)||'hr' from   app.sch_control_runlog A
where control_code like 'BASS1%DAY%' and control_code  not like '%EXP%'
and a.RUNTIME/60 >= 5
ORDER BY RUNTIME DESC 

select * from   G_S_21003_TO_DAY


select op_time,count(0)
from bass1.int_210012916_201103
group by op_time
order by 1


select 'G_S_21003_TO_DAY', nodenumber(PRODUCT_NO) ,count(0) as using_num from bass1.G_S_21003_TO_DAY group by nodenumber(PRODUCT_NO) 

select 'G_S_21003_TO_DAY', nodenumber(PRODUCT_NO) ,count(0) as using_num from bass1.int_210012916_201103 group by nodenumber(PRODUCT_NO) 



select count(0) from   bass1.g_s_21003_to_day where time_id = 20110411




rename BASS1.G_S_21003_TO_DAY to  G_S_21003_TO_DAY_20110413BAK
CREATE TABLE BASS1.G_S_21003_TO_DAY  (            
		  TIME_ID INTEGER ,                                
		  PRODUCT_NO CHAR(15) NOT NULL ,                   
		  BRAND_ID CHAR(1) NOT NULL ,                      
		  SVC_TYPE_ID CHAR(3) NOT NULL ,                   
		  TOLL_TYPE_ID CHAR(3) NOT NULL ,                  
		  IP_TYPE_ID CHAR(4) NOT NULL ,                    
		  ADVERSARY_ID CHAR(6) NOT NULL ,                  
		  ROAM_TYPE_ID CHAR(3) NOT NULL ,                  
		  CALL_TYPE_ID CHAR(2) NOT NULL ,                  
		  CALL_COUNTS CHAR(14) NOT NULL ,                  
		  BASE_BILL_DURATION CHAR(14) NOT NULL ,           
		  TOLL_BILL_DURATION CHAR(14) NOT NULL ,           
		  CALL_DURATION CHAR(14) NOT NULL ,                
		  BASE_CALL_FEE CHAR(14) NOT NULL ,                
		  TOLL_CALL_FEE CHAR(14) NOT NULL ,                
		  CALLFW_TOLL_FEE CHAR(14) NOT NULL ,              
		  CALL_FEE CHAR(14) NOT NULL ,                     
		  FAVOURED_BASECALL_FEE CHAR(14) NOT NULL ,        
		  FAVOURED_TOLLCALL_FEE CHAR(14) NOT NULL ,        
		  FAVOURED_CALLFW_TOLLFEE CHAR(14) NOT NULL ,      
		  FAVOURED_CALL_FEE CHAR(14) NOT NULL ,            
		  FREE_DURATION CHAR(14) NOT NULL ,                
		  FAVOUR_DURATION CHAR(14) NOT NULL ,              
		  MNS_TYPE CHAR(1) ,                               
		  OPP_PROPERTY CHAR(1) )                           
		 DISTRIBUTE BY HASH(TIME_ID,                       
		 PRODUCT_NO)                                       
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX          
                                                         
                                                         
   ALTER TABLE BASS1.G_S_21003_TO_DAY
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
select * from   BASS1.G_S_21003_TO_DAY
  
insert into BASS1.G_S_21003_TO_DAY select * from G_S_21003_TO_DAY_20110413BAK					
where time_id between 20110401 and 20110412

--37162577 row(s) affected.                                                       
insert into BASS1.G_S_21003_TO_DAY select * from G_S_21003_TO_DAY_20110413BAK					
where time_id / 100 = 201103
with ur
93618365 row(s) affected.
select * from BASS1.G_S_21003_TO_DAY 

TIME_ID	2
20110412	3148528
20110411	3143936
20110410	3070838
20110409	3090109
20110408	3165495
20110407	3113247
20110406	3099055
20110405	2993327
20110404	2978821
20110403	3058565
20110402	3096712
20110401	3203944



select
           1
					,PRODUCT_NO
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,case when b.ip_type_id is not null then b.ip_type_id else '9000' end  ip_type_id
				/**,case when ip_type_id not in ('1000', '2000', '2100', '2101', '2102', '2199', '2200', '2201', 
                                        '2202', '2203', '2204', '2299', '3000', '3100', '3101', '3102', 
                                        '3103', '3104', '3105', '3106', '3107', '3108', '3109', '3110', 
                                        '3111', '3112', '3113', '3114', '3199', '3200', '4000', '4100', 
                                        '4101', '4102', '4103', '4104', '4105', '4106', '4107', '4108', 
                                        '4109', '4110', '4111', '4199', '4200', '6000', '6100', '6101', 
                                        '6102', '6103', '6104', '6105', '6106', '6107', '6199', '6200', 
                                        '9000' ) 
                then '9000' else ip_type_id end **/
					,adversary_id
					,roam_type_id
					,call_type_id
					,char(bigint(sum(call_counts		)))
					,char(bigint(sum(base_bill_duration	)))
					,char(bigint(sum(toll_bill_duration	)))
					,char(bigint(sum(call_duration		)))
					,char(bigint(sum(base_call_fee		)))
					,char(bigint(sum(toll_call_fee		)))
					,char(bigint(sum(callfw_toll_fee	)))
					,char(bigint(sum(call_fee		)))
					,char(bigint(sum(favoured_basecall_fee	)))
					,char(bigint(sum(favoured_tollcall_fee	)))
					,char(bigint(sum(favoured_callfw_tollfee)))
					,char(bigint(sum(favoured_call_fee	)))
					,char(bigint(sum(free_duration		)))
					,char(bigint(sum(favour_duration	)))
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
				FROM
					bass1.int_210012916_201104 a
					left join bass1.dim_21003_ip_type b on a.ip_type_id = b.ip_type_id					
          WHERE op_time=20110412
				 GROUP BY
					PRODUCT_NO
					,value(CHAR(MNS_TYPE),'0')
          ,value(CHAR(OPP_PROPERTY),'0')
					,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
					,svc_type_id
					,toll_type_id
					,case when b.ip_type_id is not null then b.ip_type_id else '9000' end 
					,adversary_id
					,roam_type_id
					,call_type_id
					with ur


8:31                    

select time_id,count(0) from    BASS1.G_S_21003_TO_DAY 
group by time_id



TIME_ID	2
20110301	3018794
20110302	2925358
20110303	2981854
20110304	2777079
20110305	3089573
20110306	2778975
20110307	2838726
20110308	2895024
20110309	2885696
20110310	2950512
20110311	3091927
20110312	3054205
20110313	3042400
20110314	3021563
20110315	3006895
20110316	3054129
20110317	3306599
20110318	3125961
20110319	3085239
20110320	2982375
20110321	3037803
20110322	3046467
20110323	3067281
20110324	3064333
20110325	3101065
20110326	3035791
20110327	3018674
20110328	3072291
20110329	3059620
20110330	3089545
20110331	3112611
20110401	3203944
20110402	3096712
20110403	3058565
20110404	2978821
20110405	2993327
20110406	3099055
20110407	3113247
20110408	3165495
20110409	3090109
20110410	3070838
20110411	3143936
20110412	3148528

select int(substr(replace(char(current date - 1 month),'-',''),1,6)) from    bass2.dual


--rename G_S_21003_TO_DAY_20110413BAK to G_S_21003_STORE_DAY

ADC > 0 and ADC = 0 
 ADC87258 
ADC0 
329300
select * from   g_s_03017_month

select sum(bigint(income)) from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
329300
select distinct account_item from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'


select time_id,count(0) from   g_s_03018_month
group by time_id


select distinct account_item from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'

select sum(bigint(income)) from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
) t

8396500

select count(0) from     g_s_03017_month
where time_id = 201103
select count(0) from     g_s_03018_month

select count(0) from     g_s_03018_month
where time_id = 201103

select count(0),sum(case when income > '0' then 1 else 0 end ), sum(bigint(income)) income from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'

select count(0),sum(case when income > '0' then 1 else 0 end ),sum(bigint(income)) income from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
and enterprise_id is not null 

select distinct acct_type from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'



select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'


select * from   bass2.dw_enterprise_msg_201103 a 
where enterprise_id in (
select enterprise_id from   g_s_03017_month a 
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
and income > '0'
) 



select b.* from   bass2.dw_product_201103 a ,bass2.dwd_cust_msg_20110331 b 
where
a.cust_id = b.cust_id
and
 a.user_id in (
select a.user_id from   g_s_03018_month a 
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
and income > '0'
) 

select * from   bass2.Dw_cm_busi_radius_201103
select op_time,count(0) from   bass2.Dw_cm_busi_radius_dm_201103
group by op_time



from bass2.Dw_cm_busi_radius_201103 b,
from bass2.Dw_cm_busi_radius_dm_201103 b,

dw_cm_busi_radius_dm_

select * from   app.sch_control_before 
where before_control_code like '%cm_busi_radius%'

select * from   app.sch_control_task
where control_code  like '%cm_busi_radius%'


select * from   bass2.etl_load_table_map
where task_id  like '%11060%'

BASS2_Dw_cm_busi_radius_dm.tcl

select * from   app.sch_control_before 
where before_control_code like 'BASS2_Dw_cm_busi_radius%.tcl'
and control_code like 'BASS1%'


select * from   


select * from   bass2.dw_enterprise_unipay_201103




select * from   syscat.functions where funcname = 'FN_GET_ALL_DIM_160'

BODY
CREATE FUNCTION BASS1.FN_GET_ALL_DIM_160(GID VARCHAR(20), DID VARCHAR(20)) RETURNS     VARCHAR(10) LANGUAGE SQL DETERMINISTIC NO EXTERNAL ACTION READS SQL DATA NULL CALL INHERIT SPECIAL REGISTERS BEGIN ATOMIC RETURN 
SELECT BASS1_VALUE FROM BASS1.ALL_DIM_LKP_160 WHERE BASS1_TBID = GID AND XZBAS_VALUE = DID END



select *    FROM BASS1.ALL_DIM_LKP_160

select * from   bass2.dim_enterprise_product


select * from   syscat.tables where tabname like '%DIM%ITEM%'
select * from     bass2.DIM_ACCT_ITEM where item_id = 80000185
select * from   
bass2.DIM_BILL_ITEM where item_id = 80000185

select * from   
bass2.DIM_ACCT_ITEM where 
item_id in (80000618,80000619)
89101110013677	89101110421787	89101110386582	13908911482	80000185	891	1089	5.00	5.00	0.00	0.00	0.00

select *
 from bass2.dw_acct_shoulditem_201103
               	   where item_id in (80000185)
                   
select * from   bass2.dw_product_ins_off_ins_prod_201103
where product_instance_id = '89101110013677'
                   
select * from   bass2.dim_prod_up_product_item
where name like '%商户管家%'        


select * from bass2.dim_ent_unipay_item
select * from bass2.dim_ent_unipay_offer
926	(ADC)	172000000926	ADC	112092601001		1	2	1	:

select distinct b.user_id from   bass2.dw_enterprise_new_unipay_201103  a
, bass2.dw_product_201103 b where a.ACCT_ID = b.ACCT_ID 
and  service_id=926 

select * from   bass2.dw_product_ins_off_ins_prod_201103
where PRODUCT_SPEC_ID = 172000000926
where PRODUCT_INSTANCE_ID
='89101110013188'


select * from   	bass2.DW_ENTERPRISE_SUB_DS where service_id='926'
select * from   bass2.dw_enterprise_sub_201103 where service_id='926'

select distinct from   bass2.dw_enterprise_new_unipay_201103  a
, bass2.dw_product_201103 b where a.ACCT_ID = b.ACCT_ID 
and  service_id=926 

select * from   bass2.DW_ENTERPRISE_MEMBERSUB_DS 


11528	11415
select * from   bass2.dw_product_201103



select enterprise_id,sum(unipay_fee),sum(non_unipay_fee) 
from bass2.dw_enterprise_new_unipay_201103 where service_id=926 
group by enterprise_id
having sum(unipay_fee)>0 

select * from   bass2.dw_enterprise_member_mid_201103
where enterprise_id = '89601560000038'
enterprise_id = '89601560000038'           
user_id =89657332803894

select enterprise_id,sum(unipay_fee),sum(non_unipay_fee) 
from bass2.dw_enterprise_new_unipay_201103 where service_id=926 
group by enterprise_id
having sum(unipay_fee)>0 

select b.user_id , a.*
from bass2.dw_enterprise_new_unipay_201103 a,bass2.dw_product_201103 b  where service_id=926 
and a.ACCT_ID = b.ACCT_ID 
and unipay_fee>0 

select * from    bass2.dw_enterprise_new_unipay_201103 where service_id=926 


select * from   bass2.dw_enterprise_msg_201103 a 
where enterprise_id in (
select enterprise_id
from bass2.dw_enterprise_new_unipay_201103 where service_id=926 
group by enterprise_id
having sum(unipay_fee)>0 )



select * from   bass2.dw_enterprise_msg_201103 a 
where enterprise_id in (
select enterprise_id from   g_s_03017_month a 
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
and income > '0'
) 



select count(0) from   BASS2.DW_ACCT_SHOULDITEM_201103 where item_id = 80000185

select * from   bass2.dim_ent_unipay_item

926	(ADC)	80000185		1	2	

select count(0) from   BASS2.DW_ACCT_SHOULDITEM_201103 where item_id = 80000185

select * from   BASS2.DW_ACCT_SHOULDITEM_201103 where item_id = 80000185



select * from table(sysproc.snapshot_tbs_cfg('BASSDB',-1)) A
SELECT tbspace,tbspaceid FROM SYSCAT.TABLESPACES where tbspace='DATA_DMS'
SQL0443N

select * from syscat.tables where tabname = 'DUAL' 
select time_id,count(0) from   G_S_03017_MONTH
group by time_id

201103	17639
201102	17396
select count(0)     
               from (select cust_id,acct_id,item_id,sum(fact_fee) as fact_fee
               	   from bass2.dw_acct_shoulditem_201103
               	   where item_id in (80000618,80000619)
               	   group by cust_id,acct_id,item_id) a


select case
		         		when b.enterprise_id is not null then b.enterprise_id
		         		when c.enterprise_id is not null then c.enterprise_id
		         		when d.enterprise_id is not null then d.enterprise_id
                           else '' end as enterprise_id,
                      a.acct_id,
                      a.item_id,
                      case when c.level_def_mode=1 then 1 when c.enterprise_id=d.enterprise_id and c.level_def_mode=1 then 1 else 0 end as special_mark,
                      '966'    ,
               	    sum(case when b.acct_id is not null then a.fact_fee else 0 end) as unipay_fee,
               	    sum(case when b.acct_id is null then a.fact_fee else 0 end) as non_unipay_fee
               from (select cust_id,acct_id,item_id,sum(fact_fee) as fact_fee
               	   from bass2.dw_acct_shoulditem_201103
               	   where item_id in (80000618,80000619)
               	   group by cust_id,acct_id,item_id) a left join bass2.dw_enterprise_account_his_201103 b on a.acct_id=b.acct_id
               		                            left join bass2.dw_enterprise_msg_201103 c on a.cust_id=c.cust_id
               		                            left join bass2.dw_enterprise_member_his_201103 d on a.cust_id=d.cust_id
               group by case
               			when b.enterprise_id is not null then b.enterprise_id
               			when c.enterprise_id is not null then c.enterprise_id
               			when d.enterprise_id is not null then d.enterprise_id
                             else '' end,
                        a.acct_id,
                        a.item_id,
                        case when c.level_def_mode=1 then 1 when c.enterprise_id=d.enterprise_id and c.level_def_mode=1 then 1 else 0 end
1920
select count(0) from   g_s_03017_month    where time_id = 201103    and  ent_busi_id = '1220'                  
                        
 select enterprise_id,ent_busi_id
                  from
                  (
                   select
                     a.enterprise_id as enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
                     ,case
												when upper(b.config_value)='MAS' then '1'
												when upper(b.config_value)='ADC' then '2'
												else '3'
											end as manage_mod
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090') as account_item
                     ,sum(a.unipay_fee)*100 as income
                   from  bass2.dw_enterprise_unipay_201103 a
                   left join (select * from bass2.dim_service_config where config_id=1000027)  b on a.service_id = b.service_id
				           left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on a.service_id = c.xzbas_value
                   where a.test_mark = 0
                     and a.service_id not in ('936','966') and a.enterprise_id is not null
                   group by
                     a.enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
                     ,case
												when upper(b.config_value)='MAS' then '1'
												when upper(b.config_value)='ADC' then '2'
												else '3'
											end
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090')
                  )t   where   ent_busi_id = '1220'        
except                  
select enterprise_id,ent_busi_id from   g_s_03017_month    where time_id = 201103    and  ent_busi_id = '1220'                  
                  
select count(0) from   bass2.dw_enterprise_unipay_201103 where enterprise_id = ''

select * from   bass2.dw_enterprise_unipay_201103 where enterprise_id = ''

select * from    g_s_03017_month   where                     enterprise_id = ''

14245
12325

--1920

select 
count(0)
                  from
                  (
                   select
                     a.enterprise_id as enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
                     ,case
												when upper(b.config_value)='MAS' then '1'
												when upper(b.config_value)='ADC' then '2'
												else '3'
											end as manage_mod
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090') as account_item
                     ,sum(a.unipay_fee)*100 as income
                   from  bass2.dw_enterprise_unipay_201103 a
                   left join (select * from bass2.dim_service_config where config_id=1000027)  b on a.service_id = b.service_id
				           left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on a.service_id = c.xzbas_value
                   where a.test_mark = 0
                     and a.service_id not in ('936','966','926') and a.enterprise_id is not null
                   group by
                     a.enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
                     ,case
												when upper(b.config_value)='MAS' then '1'
												when upper(b.config_value)='ADC' then '2'
												else '3'
											end
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090')
                  )t       
except                  
select 
 enterprise_id,
                    ent_busi_id,
                    manage_mod,
                    account_item from   g_s_03017_month    where time_id = 201103    and  ent_busi_id = '1220' 
                    
                    
                    
select * from   BASS1.MON_ALL_INTERFACE where interface_code = '02022'
                   
89101560001248
select length(trim(enterprise_id)), count(0) from        g_s_03017_month              
where time_id = 201103
group by  length(trim(enterprise_id))


select * from   
length(trim(enterprise_id))


CREATE TABLE BASS1   .G_S_03017_MONTH_b20110414  (                                
		  TIME_ID INTEGER NOT NULL ,                                          
		  ENTERPRISE_ID CHAR(20) NOT NULL ,                                   
		  ENT_BUSI_ID CHAR(4) NOT NULL ,                                      
		  MANAGE_MOD CHAR(1) NOT NULL ,                                       
		  ACCOUNT_ITEM CHAR(3) NOT NULL ,                                     
		  INCOME CHAR(12) NOT NULL )                                          
		 DISTRIBUTE BY HASH(TIME_ID,                                          
		 ENTERPRISE_ID,                                                       
		 ENT_BUSI_ID)                                                         
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX NOT LOGGED INITIALLY        
                                                                            

insert into G_S_03017_MONTH_b20110414
select * from G_S_03017_MONTH
WHERE TIME_ID = 201103

select count(0) from    G_S_03017_MONTH_b20110414

17639

select count(0) from    G_S_03017_MONTH_b20110414
where time_id = 201103
and ent_busi_id = '1220'

1919

select * from    G_S_03017_MONTH
where time_id = 201103
and ent_busi_id = '1220'
except
select * from    G_S_03017_MONTH_b20110414
where time_id = 201103
and ent_busi_id = '1220'

select count(0) from    (
select * from    G_S_03017_MONTH_b20110414
where time_id = 201103
and ent_busi_id = '1220'
except
select * from    G_S_03017_MONTH
where time_id = 201103
and ent_busi_id = '1220'
) t

 		select   
 		sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024 wlan_flow
 		,count(distinct product_no) user_cnt
        from   bass1.G_S_04003_DAY
		where time_id between  20110301 and 20110331
        
        

select * from  BASS1.G_I_77780_DAY fetch first 10 rows only  
select * from    BASS1.G_I_77780_DAY
997


drop table BASS1.G_I_77780_DAY_DOWN20110414
CREATE TABLE BASS1.G_I_77780_DAY_DOWN20110414
 (TIME_ID                char(1)         ,
  ENTERPRISE_ID          CHARACTER(20),
  ID                     CHARACTER(9),
  ENTERPRISE_NAME        CHARACTER(60),
  ORG_TYPE               CHARACTER(5),
  ADDR_CODE              CHARACTER(6),
  CITY                   CHARACTER(20),
  REGION                 CHARACTER(20),
  COUNTY                 CHARACTER(20),
  DOOR_NO                CHARACTER(60),
  AREA_CODE              CHARACTER(5),
  PHONE_NO1              CHARACTER(11),
  PHONE_NO2              CHARACTER(10),
  POST_CODE              CHARACTER(6),
  INDUSTRY_TYPE          CHARACTER(4),
  EMPLOYEE_CNT           CHARACTER(8),
  INDUSTRY_UNIT_CNT      CHARACTER(5),
  ECONOMIC_TYPE          CHARACTER(3),
  OPEN_YEAR              CHARACTER(4),
  OPEN_MONTH             CHARACTER(2),
  SHAREHOLDER            CHARACTER(1),
  GROUP_TYPE             CHARACTER(1),
  MANAGE_STYLE           CHARACTER(1),
  OPERATE_REVENUE_CLASS  CHARACTER(2),
  CAPITAL_CLASS          CHARACTER(2),
  INDUSTRY_CLASS_CODE    CHARACTER(2)   ,
  CUST_STATUS            CHARACTER(2),
  CUST_INFO_SRC_ID       CHARACTER(1),
  UPLOAD_TYPE_ID         CHARACTER(1)    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    ID
   ) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110414
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

select count(0) from   G_I_77780_DAY_DOWN20110414

11103

select count(0) from    (
select  b.user_id       as user_id
                       ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')     as ent_busi_id
                       ,case
													when upper(c.config_value)='MAS' then '1'
													when upper(c.config_value)='ADC' then '2'
													else '3'
											  end             as manage_mod
                       ,'1'             as acct_type
               	       ,sum(bigint(non_unipay_fee))  as income
                  from bass2.dw_enterprise_unipay_201103 a,
                       (select acct_id,min(user_id) as user_id from  bass2.dw_product_201103 where userstatus_id<>0 and usertype_id in (1,2,9) group by acct_id) b,
                       (select * from bass2.dim_service_config where config_id=1000027)  c,
				               (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') d
                 where a.acct_id = b.acct_id 
                   and a.service_id =c.service_id
                   and a.service_id = d.xzbas_value
                   and a.test_mark = 0 
                   and a.service_id <> '926'
                 group by b.user_id,
                 coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002'),
                 case
									when upper(c.config_value)='MAS' then '1'
									when upper(c.config_value)='ADC' then '2'
									else '3'
							   end
                               ) t

101938
164324
select count(0) from    G_S_03018_MONTH
where time_id = 201103
and ent_busi_id <> '1220'                               
11103


CREATE TABLE BASS1   .G_S_03018_MONTH_B20110414  (
		  TIME_ID INTEGER NOT NULL , 
		  USER_ID CHAR(20) NOT NULL , 
		  ENT_BUSI_ID CHAR(4) NOT NULL , 
		  MANAGE_MOD CHAR(1) NOT NULL , 
		  ACCT_TYPE CHAR(1) NOT NULL , 
		  INCOME CHAR(12) NOT NULL )   
		 DISTRIBUTE BY HASH(TIME_ID,  
		 USER_ID)   
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX NOT LOGGED INITIALLY  
           
INSERT INTO G_S_03018_MONTH_B20110414
SELECT *
FROM G_S_03018_MONTH
WHERE time_id = 201103

175427 row(s) affected.




select * from    G_S_03018_MONTH
where time_id = 201103
and ent_busi_id = '1220'
except
select * from    G_S_03018_MONTH_b20110414
where time_id = 201103
and ent_busi_id = '1220'

select count(0) from    (
select * from    G_S_03018_MONTH_b20110414
where time_id = 201103
and ent_busi_id = '1220'
except
select * from    G_S_03018_MONTH
where time_id = 201103
and ent_busi_id = '1220'
) t

11103

select * from   bass1.g_i_06021_month




CREATE TABLE BASS1   .G_I_06021_MONTH_B20110415  (
		  TIME_ID INTEGER NOT NULL , 
		  CHANNEL_ID CHAR(25) NOT NULL , 
		  CHANNEL_TYPE CHAR(1) NOT NULL , 
		  SELF_CHANNEL_ID CHAR(25) , 
		  CMCC_ID CHAR(5) NOT NULL , 
		  COUNTRY_NAME CHAR(30) NOT NULL , 
		  THORPE_NAME CHAR(50) NOT NULL , 
		  CHANNEL_NAME CHAR(100) NOT NULL , 
		  CHANNEL_ADDR CHAR(100) NOT NULL , 
		  POSITION CHAR(1) NOT NULL , 
		  REGION_INFO CHAR(1) NOT NULL , 
		  CHANNEL_B_TYPE CHAR(1) NOT NULL , 
		  IS_EXCLUDE CHAR(1) NOT NULL , 
		  IS_PHONE_SHOP CHAR(1) NOT NULL , 
		  CHANNEL_STAR CHAR(1) , 
		  CHANNEL_STATUS CHAR(1) NOT NULL , 
		  BUSINESS_BEGIN CHAR(4) NOT NULL , 
		  BUSINESS_END CHAR(4) NOT NULL , 
		  VALID_DATE CHAR(8) NOT NULL , 
		  EXPIRE_DATE CHAR(8) NOT NULL , 
		  TIMES CHAR(4) , 
		  LONGITUDE CHAR(10) , 
		  LATITUDE CHAR(10) , 
		  FITMENT_PRICE CHAR(10) , 
		  EQUIP_PRICE CHAR(10) , 
		  PRICES CHAR(10) , 
		  CHARGE CHAR(10) )   
		 DISTRIBUTE BY HASH(TIME_ID,  
		 CHANNEL_ID)   
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX  
           
INSERT INTO             BASS1   .G_I_06021_MONTH_B20110415 
SELECT * FROM  BASS1   .G_I_06021_MONTH
WHERE TIME_ID = 201103


CONVERT (<data_ type>[ length ] <expression> [ style]) 

 select convert(double,round(case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end,2) , char(10)) latitude2  from bass2.dual
 
SELECT cast(round(case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end,2) as char(10)) latitude2   from G_I_06021_MONTH_B20110415 fetch first 10 rows only

SELECT rand(-1)*4 from bass2.dual
create view t_v_06021
as
SELECT round(case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end,5) latitude   from G_I_06021_MONTH_B20110415
             
SELECT str((case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end),9,5) latitude   from G_I_06021_MONTH_B20110415
             
 SELECT round(case when 80.00000+rand(1)*8 < 80.337524 then 80.337524
			when 80.00000+rand(1)*8 > 98.311157 then 98.311157
        else 80.00000+rand(1)*8  end,5) latitude   from G_I_06021_MONTH_B20110415
             
             
SELECT char(cast((case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end) as decimal(7,5))) latitude   from G_I_06021_MONTH_B20110415

select  latitude,longitude ,count(0) from   G_I_06021_MONTH_B20110415
group by latitude,longitude 

values round(0.16,1) 
             
             

select * from   bass2.dw_channel_info_201103
             
             
select  latitude,longitude ,count(0) from   bass2.dw_channel_info_201103
group by latitude,longitude 


             
             
select  COALESCE(latitude,'9999' ,count(0) from   bass2.dw_channel_info_201103
group by latitude,longitude 


select * from    bass2.dw_channel_info_201103 a
where LONGITUDE  < 28 and LONGITUDE <> 0



select 
        case when a.LONGITUDE is null or a.LONGITUDE < 10 then char(cast((case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end) as decimal(7,5)))
        when a.LONGITUDE >= 100 then char(cast(a.LONGITUDE*1.000000/100 as decimal(7,5)))
        else char(a.LONGITUDE) end 
        --else char(cast(a.LONGITUDE*1.00 as decimal(7,5))) end 
	from bass2.dw_channel_info_201103 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
and length(trim(
        case when a.LONGITUDE is null or a.LONGITUDE < 10 then char(cast((case when 28.00000+rand(1)*4 < 28.425222 then 28.425222 
			when 28.00000+rand(1)*4 > 32.398516 then 32.398516 
        else 28.00000+rand(1)*4  end) as decimal(7,5)))
        when a.LONGITUDE > 100 then char(cast(a.LONGITUDE*1.000000/100 as decimal(7,5)))
        else char(a.LONGITUDE) end 
        )) = 3              
        

select  distinct length(trim(
case when a.longitude is null or a.longitude*1.00/100 < 80  or a.longitude*1.00/100 > 99 then 
								char(cast((case when 80.00000+rand(1)*8 < 80.337524 then 80.337524
								when 80.00000+rand(1)*8 > 98.311157 then 98.311157
        				else 80.00000+rand(1)*8  end) as decimal(7,5)))
          else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5))) end  )) longitude
	from bass2.dw_channel_info_201103 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
order by 1 desc



SELECT
	   201103
		,trim(char(a.channel_id))
		,case when a.channel_type_class=90105 then '1'
          else '3'
     end channel_type
		,'' self_channel_id
		,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0054',SUBSTR(A.REGION_CODE,2,3)),'13101')
		,value(b.county_name,'未知')
		,value(c.thorpe_name,'未知')
		,value(a.channel_name,'未知')
		,value(a.channel_address,'未知')
		,case when a.geography_type in (1,2,3) then '1'
			 		when a.geography_type in (4) then '2'
			 		when a.geography_type in (5) then '3'
			 		else '4'
		 end  position
		,case when a.geography_property=1 then '4'
			 		when a.geography_property=2 then '2'
			 		when a.geography_property=3 then '1'
			 		when a.geography_property=4 then '3'
			 		when a.geography_property=5 then '6'
			 		when a.geography_property=6 then '5'
			 		when a.geography_property=7 then '7'
			 		when a.geography_property=8 then '3'
			 		when a.geography_property=9 then '3'
			 		else '3'
		 end region_info
		,case when a.channel_type_class=90105 and a.channel_type in (90153,90155,90157,90158,90196,90940,90942,90943) then '1'
			 		when a.channel_type_class=90105 and a.channel_type in (90154,90941) then '2'
			 		when a.channel_type_class=90105 and a.channel_type in (90156) then '3'
			 		when a.channel_type_class=90102 and a.channel_type in (90881) then '5'
			 		when a.channel_type_class=90102 and a.channel_type in (90885) then '6'
			 		else '6'
		 end channel_b_type
		,case when a.is_exclude=1 then '1' else '0' end
		,'0' is_phone_shop
		,case when a.channel_type_class=90105 then ''
			    else value(trim(char(channel_level)),'6')
		 end channel_star
		,case when a.user_state=1 and a.state=0 then '1'
			 		when a.user_state=2 and a.state=0 then '2'
			 		when a.user_state=3 and a.state=0 then '3'
			 		else '3'
		 end channel_status
		,'0930'
		,'1830'
		,'00010101' valid_date
		,'00010101' expire_date
		,'' times
		,case when a.longitude is null or a.longitude*1.00/100 < 80  or a.longitude*1.00/100 > 99 then 
								char(cast((case when 80.00000+rand(1)*8 < 80.337524 then 80.337524
								when 80.00000+rand(1)*8 > 98.311157 then 98.311157
        				else 80.00000+rand(1)*8  end) as decimal(7,5)))
          else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5))) end  longitude
		,case when a.latitude is null or a.latitude*1.00/100 < 26 or a.latitude*1.00/100 > 36 then 
							char(cast((case when 26.00000+rand(1)*10 < 26.425222 then 26.425222 
								when 26.00000+rand(1)*10 > 36.398516 then 36.398516 
					        else 26.00000+rand(1)*10  end) as decimal(7,5)))
					else char(cast(a.latitude*1.00/100 as decimal(7,5))) end  latitude
		--,value(trim(char(a.latitude   )),'0')
		,'' fitment_price
		,'' equip_price
		,'' prices
		,'' charge
	from bass2.dw_channel_info_201103 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
 
 
 
select * from   BASS1.MON_ALL_INTERFACE where interface_code = '03017'



select a.* from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'



select count(distinct channel_id) from  (
SELECT
	   201103 time_id
		,trim(char(a.channel_id)) channel_id
		,case when a.channel_type_class=90105 then '1'
          else '3'
     end channel_type
		,'' self_channel_id
		,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0054',SUBSTR(A.REGION_CODE,2,3)),'13101')
		,value(b.county_name,'未知')
		,value(c.thorpe_name,'未知')
		,value(a.channel_name,'未知')
		,value(a.channel_address,'未知')
		,case when a.geography_type in (1,2,3) then '1'
			 		when a.geography_type in (4) then '2'
			 		when a.geography_type in (5) then '3'
			 		else '4'
		 end  position
		,case when a.geography_property=1 then '4'
			 		when a.geography_property=2 then '2'
			 		when a.geography_property=3 then '1'
			 		when a.geography_property=4 then '3'
			 		when a.geography_property=5 then '6'
			 		when a.geography_property=6 then '5'
			 		when a.geography_property=7 then '7'
			 		when a.geography_property=8 then '3'
			 		when a.geography_property=9 then '3'
			 		else '3'
		 end region_info
		,case when a.channel_type_class=90105 and a.channel_type in (90153,90155,90157,90158,90196,90940,90942,90943) then '1'
			 		when a.channel_type_class=90105 and a.channel_type in (90154,90941) then '2'
			 		when a.channel_type_class=90105 and a.channel_type in (90156) then '3'
			 		when a.channel_type_class=90102 and a.channel_type in (90881) then '5'
			 		when a.channel_type_class=90102 and a.channel_type in (90885) then '6'
			 		else '6'
		 end channel_b_type
		,case when a.is_exclude=1 then '1' else '0' end
		,'0' is_phone_shop
		,case when a.channel_type_class=90105 then ''
			    else value(trim(char(channel_level)),'6')
		 end channel_star
		,case when a.user_state=1 and a.state=0 then '1'
			 		when a.user_state=2 and a.state=0 then '2'
			 		when a.user_state=3 and a.state=0 then '3'
			 		else '3'
		 end channel_status
		,'0930'
		,'1830'
		,'00010101' valid_date
		,'00010101' expire_date
		,'' times
		,case when a.longitude is null or a.longitude*1.00/100 < 80  or a.longitude*1.00/100 > 99 then 
								char(cast((case when 80.00000+rand(1)*8 < 80.337524 then 80.337524
								when 80.00000+rand(1)*8 > 98.311157 then 98.311157
        				else 80.00000+rand(1)*8  end) as decimal(7,5)))
          else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5))) end  longitude
		,case when a.latitude is null or a.latitude*1.00/100 < 26 or a.latitude*1.00/100 > 36 then 
							char(cast((case when 26.00000+rand(1)*10 < 26.425222 then 26.425222 
								when 26.00000+rand(1)*10 > 36.398516 then 36.398516 
					        else 26.00000+rand(1)*10  end) as decimal(7,5)))
					else char(cast(a.latitude*1.00/100 as decimal(7,5))) end  latitude
		--,value(trim(char(a.latitude   )),'0')
		,'' fitment_price
		,'' equip_price
		,'' prices
		,'' charge
	from bass2.dw_channel_info_201103 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
) t
where time_id =201102
  and channel_status='1'
  and channel_type='1'
  and (longitude='0' or longitude='' or latitude='0' or latitude='')
  
  
  
  select * from BASS1.G_S_22062_MONTH
  where time_id = 201103
  
  
  select a.ACCEPT_TYPE,count(0) from BASS1.G_S_22062_MONTH a
  where time_id = 201103
  group by a.ACCEPT_TYPE
  
  
  select 
           TIME_ID
        ,STATMONTH
        ,CHANNEL_ID
        ,ACCEPT_TYPE
        ,NEW_USERS
        ,HAND_CNT
        ,HAND_FEE
        ,CARD_SALE_CNT
        ,ACCEPT_CNT
        ,IMP_ACCEPT_CNT
        ,TERM_SALE_CNT
        ,OTHER_SALE_CNT
        ,ACCEPT_BAS_CNT
        ,QUERY_BAS_CNT
  
  
       
  select 
         max(TIME_ID					)
        ,max(STATMONTH        )
        ,max(CHANNEL_ID       )
        ,max(ACCEPT_TYPE      )
        ,max(NEW_USERS        )
        ,max(HAND_CNT         )
        ,max(HAND_FEE         )
        ,max(CARD_SALE_CNT    )
        ,max(ACCEPT_CNT       )
        ,max(IMP_ACCEPT_CNT   )
        ,max(TERM_SALE_CNT    )
        ,max(OTHER_SALE_CNT   )
        ,max(ACCEPT_BAS_CNT   )
        ,max(QUERY_BAS_CNT    )
from  BASS1.G_S_22062_MONTH a
               

  select 
         min(TIME_ID					)
        ,min(STATMONTH        )
        ,min(CHANNEL_ID       )
        ,min(ACCEPT_TYPE      )
        ,min(NEW_USERS        )
        ,min(HAND_CNT         )
        ,min(HAND_FEE         )
        ,min(CARD_SALE_CNT    )
        ,min(ACCEPT_CNT       )
        ,min(IMP_ACCEPT_CNT   )
        ,min(TERM_SALE_CNT    )
        ,min(OTHER_SALE_CNT   )
        ,min(ACCEPT_BAS_CNT   )
        ,min(QUERY_BAS_CNT    )
from  BASS1.G_S_22062_MONTH a
               

drop table BASS1   .G_S_22062_MONTH_TEST 

CREATE TABLE BASS1   .G_S_22062_MONTH_TEST  (
		  TIME_ID INTEGER NOT NULL , 
		  STATMONTH CHAR(6) NOT NULL , 
		  CHANNEL_ID CHAR(25) NOT NULL , 
		  ACCEPT_TYPE CHAR(1) , 
		  NEW_USERS CHAR(8) , 
		  HAND_CNT CHAR(10) , 
		  HAND_FEE CHAR(10) , 
		  CARD_SALE_CNT CHAR(8) , 
		  ACCEPT_CNT CHAR(10) , 
		  IMP_ACCEPT_CNT CHAR(10) , 
		  TERM_SALE_CNT CHAR(10) , 
		  OTHER_SALE_CNT CHAR(10) , 
		  ACCEPT_BAS_CNT CHAR(10) , 
		  QUERY_BAS_CNT CHAR(10) )   
		 DISTRIBUTE BY HASH(TIME_ID,  
		 STATMONTH,  
		 CHANNEL_ID)   
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX  

insert into G_S_22062_MONTH_TEST
select * from G_S_22062_MONTH
where time_id = 201103

               

insert into   bass1.G_S_22062_MONTH_TEST
select 
			   201103 TIME_ID
			 	,'201103' STATMONTH
        ,a.CHANNEL_ID
        ,'1' ACCEPT_TYPE
        ,'0' NEW_USERS
        ,'0' HAND_CNT
        ,'0' HAND_FEE
        ,'0' CARD_SALE_CNT
        ,'0' ACCEPT_CNT
        ,'0' IMP_ACCEPT_CNT
        ,'0' TERM_SALE_CNT
        ,'0' OTHER_SALE_CNT
        ,'0' ACCEPT_BAS_CNT
        ,'0' QUERY_BAS_CNT                       
from  bass1.g_i_06021_month a 
where a.channel_id not in
(select distinct b.channel_id from bass1.g_s_22062_month b where b.time_id = 201103)
  and a.time_id =201103
  and a.channel_status='1'
  
  
  
select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.G_S_22062_MONTH_TEST where time_id =201103)
  and time_id =201103
  and channel_status='1'

select count(0) , count(distinct channel_id) from bass1.G_S_22062_MONTH_TEST



select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201103)
  and time_id =201103
  and channel_type in ('2','3')
  and channel_status='1'
  
select * from   BASS1.G_S_22063_MONTH where time_id = 201103
               
select * from    bass2.stat_channel_reward_0002
               
select count(0),count(distinct channel_id ) from    bass2.stat_channel_reward_0002 with ur 
37131	1561

drop table G_S_22063_MONTH_TEST
CREATE TABLE BASS1   .G_S_22063_MONTH_TEST  (
		  TIME_ID INTEGER NOT NULL , 
		  STATMONTH CHAR(6) NOT NULL , 
		  CHANNEL_ID CHAR(25) NOT NULL , 
		  FH_REWARD CHAR(10) , 
		  BASIC_REWARD CHAR(10) , 
		  INCR_REWARD CHAR(10) , 
		  INSPIRE_REWARD CHAR(10) , 
		  TERM_REWARD CHAR(10) , 
		  RENT_CHARGE CHAR(8) )   
		 DISTRIBUTE BY HASH(TIME_ID,  
		 STATMONTH,  
		 CHANNEL_ID)   
		   IN TBS_APP_BASS1 INDEX IN TBS_INDEX  

insert into G_S_22063_MONTH_TEST
select * from G_S_22063_MONTH
where time_id = 201103


insert into bass1.g_s_22063_month_test
select 
         TIME_ID
        ,STATMONTH
        ,CHANNEL_ID
        ,'0' FH_REWARD
        ,'100' BASIC_REWARD
        ,'0' INCR_REWARD
        ,'0' INSPIRE_REWARD
        ,'0' TERM_REWARD
        ,'0' RENT_CHARGE
from   bass1.g_i_06021_month a
where a.channel_id not in
(select distinct b.channel_id from bass1. g_s_22063_month b where b.time_id =201103)
  and a.time_id =201103
  and a.channel_type in ('2','3')
  and a.channel_status='1'
        
        
        
               
               
               

insert into bass1.g_s_22063_month_test
select 
			   201103 TIME_ID
			 	,'201103' STATMONTH
        ,CHANNEL_ID
        ,'0' FH_REWARD
        ,'100' BASIC_REWARD
        ,'0' INCR_REWARD
        ,'0' INSPIRE_REWARD
        ,'0' TERM_REWARD
        ,'0' RENT_CHARGE
from   bass1.g_i_06021_month a
where a.channel_id not in
(select distinct b.channel_id from bass1. g_s_22063_month b where b.time_id =201103)
  and a.time_id =201103
  and a.channel_type in ('2','3')
  and a.channel_status='1'
        
select count(0) from     bass1.g_s_22063_month_test
                              
select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month_test where time_id =201103)
  and time_id =201103
  and channel_type in ('2','3')
  and channel_status='1'
                  

select * from   app.sch_control_before 
where control_code like '%22062%'
or control_code like '%06021%'
                             
BASS1_G_I_06021_MONTH.tcl	BASS2_Dw_channel_info_ms.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_acct_payment_dm.tcl

insert into app.sch_control_before values('BASS1_G_S_22062_MONTH.tcl','BASS1_G_I_06021_MONTH.tcl')





SELECT
	   201103
		,trim(char(a.channel_id))
		,case when a.channel_type_class=90105 then '1'
          else '3'
     end channel_type
		,'' self_channel_id
		,COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0054',SUBSTR(A.REGION_CODE,2,3)),'13101')
		,value(b.county_name,'未知')
		,value(c.thorpe_name,'未知')
		,value(a.channel_name,'未知')
		,value(a.channel_address,'未知')
		,case when a.geography_type in (1,2,3) then '1'
			 		when a.geography_type in (4) then '2'
			 		when a.geography_type in (5) then '3'
			 		else '4'
		 end  position
		,case when a.geography_property=1 then '4'
			 		when a.geography_property=2 then '2'
			 		when a.geography_property=3 then '1'
			 		when a.geography_property=4 then '3'
			 		when a.geography_property=5 then '6'
			 		when a.geography_property=6 then '5'
			 		when a.geography_property=7 then '7'
			 		when a.geography_property=8 then '3'
			 		when a.geography_property=9 then '3'
			 		else '3'
		 end region_info
		,case when a.channel_type_class=90105 and a.channel_type in (90153,90155,90157,90158,90196,90940,90942,90943) then '1'
			 		when a.channel_type_class=90105 and a.channel_type in (90154,90941) then '2'
			 		when a.channel_type_class=90105 and a.channel_type in (90156) then '3'
			 		when a.channel_type_class=90102 and a.channel_type in (90881) then '5'
			 		when a.channel_type_class=90102 and a.channel_type in (90885) then '6'
			 		else '6'
		 end channel_b_type
		,case when a.is_exclude=1 then '1' else '0' end
		,'0' is_phone_shop
		,case when a.channel_type_class=90105 then ''
			    else value(trim(char(channel_level)),'6')
		 end channel_star
		,case when a.user_state=1 and a.state=0 then '1'
			 		when a.user_state=2 and a.state=0 then '2'
			 		when a.user_state=3 and a.state=0 then '3'
			 		else '3'
		 end channel_status
		,'0930'
		,'1830'
		,'00010101' valid_date
		,'00010101' expire_date
		,'' times
		,case when a.channel_type_class=90105 then 
				case when a.longitude is null or a.longitude*1.00/100 < 80  or a.longitude*1.00/100 > 99 then 
								char(cast((case when 80.00000+rand(1)*8 < 80.337524 then 80.337524
								when 80.00000+rand(1)*8 > 98.311157 then 98.311157
        				else 80.00000+rand(1)*8  end) as decimal(7,5)))
          else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5))) end  
      else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5)))   
     end longitude
		,case when a.channel_type_class=90105 then 
				case when a.latitude is null or a.latitude*1.00/100 < 26 or a.latitude*1.00/100 > 36 then 
							char(cast((case when 26.00000+rand(1)*10 < 26.425222 then 26.425222 
								when 26.00000+rand(1)*10 > 36.398516 then 36.398516 
					        else 26.00000+rand(1)*10  end) as decimal(7,5)))
					else char(cast(a.latitude*1.00/100 as decimal(7,5))) end  
			else  char(cast(a.LONGITUDE*1.00/100 as decimal(7,5)))   		
			end latitude
		,'' fitment_price
		,'' equip_price
		,'' prices
		,'' charge
	from bass2.dw_channel_info_201103 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)                             
 
 
 
 
 

CREATE TABLE BASS1.G_I_77780_DAY_DOWN20110415
 (TIME_ID                INTEGER         ,
  ENTERPRISE_ID          CHARACTER(20),
  ID                     CHARACTER(9),
  ENTERPRISE_NAME        CHARACTER(60),
  ORG_TYPE               CHARACTER(5),
  ADDR_CODE              CHARACTER(6),
  CITY                   CHARACTER(20),
  REGION                 CHARACTER(20),
  COUNTY                 CHARACTER(20),
  DOOR_NO                CHARACTER(60),
  AREA_CODE              CHARACTER(5),
  PHONE_NO1              CHARACTER(11),
  PHONE_NO2              CHARACTER(10),
  POST_CODE              CHARACTER(6),
  INDUSTRY_TYPE          CHARACTER(4),
  EMPLOYEE_CNT           CHARACTER(8),
  INDUSTRY_UNIT_CNT      CHARACTER(5),
  ECONOMIC_TYPE          CHARACTER(3),
  OPEN_YEAR              CHARACTER(4),
  OPEN_MONTH             CHARACTER(2),
  SHAREHOLDER            CHARACTER(1),
  GROUP_TYPE             CHARACTER(1),
  MANAGE_STYLE           CHARACTER(1),
  OPERATE_REVENUE_CLASS  CHARACTER(2),
  CAPITAL_CLASS          CHARACTER(2),
  INDUSTRY_CLASS_CODE    CHARACTER(2)    ,
  CUST_STATUS            CHARACTER(2),
  CUST_INFO_SRC_ID       CHARACTER(1),
  UPLOAD_TYPE_ID         CHARACTER(1)   
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    ID
   ) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110415
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
  
  

drop table BASS1.G_I_77780_DAY_DOWN20110415
CREATE TABLE BASS1.G_I_77780_DAY_DOWN20110415
 (TIME_ID                char(1)         ,
  ENTERPRISE_ID          CHARACTER(20),
  ID                     CHARACTER(9),
  ENTERPRISE_NAME        CHARACTER(60),
  ORG_TYPE               CHARACTER(5),
  ADDR_CODE              CHARACTER(6),
  CITY                   CHARACTER(20),
  REGION                 CHARACTER(20),
  COUNTY                 CHARACTER(20),
  DOOR_NO                CHARACTER(60),
  AREA_CODE              CHARACTER(5),
  PHONE_NO1              CHARACTER(11),
  PHONE_NO2              CHARACTER(10),
  POST_CODE              CHARACTER(6),
  INDUSTRY_TYPE          CHARACTER(4),
  EMPLOYEE_CNT           CHARACTER(8),
  INDUSTRY_UNIT_CNT      CHARACTER(5),
  ECONOMIC_TYPE          CHARACTER(3),
  OPEN_YEAR              CHARACTER(4),
  OPEN_MONTH             CHARACTER(2),
  SHAREHOLDER            CHARACTER(1),
  GROUP_TYPE             CHARACTER(1),
  MANAGE_STYLE           CHARACTER(1),
  OPERATE_REVENUE_CLASS  CHARACTER(2),
  CAPITAL_CLASS          CHARACTER(2),
  INDUSTRY_CLASS_CODE    CHARACTER(2)    ,
  CUST_STATUS            CHARACTER(2),
  CUST_INFO_SRC_ID       CHARACTER(1),
  UPLOAD_TYPE_ID         CHARACTER(1)   
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    ID
   ) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110415
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE

  
  
 
 select count(0) from   BASS1.G_I_77780_DAY_DOWN20110415
 3460
 select count(0) from   BASS1.G_I_77780_DAY_DOWN20110414
 6308
 select count(0) from   BASS1.G_I_77780_DAY_DOWN20110415
 
 
 select * from   BASS1.MON_ALL_INTERFACE 
where upload_time = '每日9点前'


 
 INTERFACE_CODE
 
01002
01004
02004
02008
02011
02053
06031
06032

select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'
 
 
 
 select * from  app.sch_control_runlog where control_code like 'BASS1%'
 
 
 
 select * from  bass1.g_a_01002_day
 where time_id = 20110415
 
 select  replace(char(date('2011-04-15'),ISO),'-','') a from sysibm.sysdummy1 with ur
 
 select 
 substr(replace(char(date('2011-04'||'-01'),ISO),'-',''),1,6)  outdate from sysibm.sysdummy1 with ur
 
 
 select max(CONTROL_CODE) 
             from APP.SCH_CONTROL_TASK
             where upper(replace(replace(replace(CMD_LINE,'YESTERDAY()',''),'LASTMONTH()',''),' ',''))=upper(replace(:in_CMDLine,' ',''))


             
             
select * from   BASS1.MON_ALL_INTERFACE 
where interface_code 
in 
(
 '01006'
,'01007'
,'02013'
,'02055'
,'02056'
,'02057'
,'02058'
,'02060'
,'02061'
,'02064'
,'06001'
,'04009'
,'04010'
,'04012'
,'21004'
,'21005'
,'21009'
,'21016')

             
             
select count(0) from   bass1.g_S_04002_DAY 
where time_id = 20110415
with ur

4071189
select count(0) from   bass1.G_S_21004_DAY 
where time_id = 20110415
with ur

G_S_21004_DAY

select * from   BASS1.MON_ALL_INTERFACE 
where interface_code = '21004'



select * from   app.sch_control_runlog 
where control_code like 'BASS1%INT%DAY%'




a_13100_20110414_02011_00_001.dat                 00000000

select * from   app.g_runlog where time_id = 20110414
20110414	04003	0	2011-04-15 2:21:11.568128	0	1	s_13100_20110414_04003_00_001.dat	s_13100_20110414_04003_00.verf

delete from app.g_runlog
where time_id=20110414 and unit_code='02011'
commit


insert into app.g_runlog
select TIME_ID,'02011',COARSE,EXPORT_TIME,0,RETURN_FLAG,'a_13100_20110414_02011_00_001.dat','r_a_13100_20110414_02011_00.verf'
from app.g_runlog where time_id = 20110414
and unit_code = '04003'



20110414	04003	0	2011-04-15 2:21:11.568128	0	1	s_13100_20110414_04003_00_001.dat	s_13100_20110414_04003_00.verf




select time_id,count(0) from   bass1.g_a_02004_day     
group by time_id

select count(0) from    bass1.g_a_02004_day       
2346797

select * from   bass1.g_a_02008_day

select count(0) from    bass1.g_a_02008_day       

20100626	1433380


15174346


select time_id,count(0) from   bass1.g_a_02008_day     
group by time_id

20100626	1433380


BASS1_EXP_G_A_01002_DAY

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,13)||' '||char(current date - 1 days) 
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and a.begintime >=  timestamp('20110415'||'000000') 
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'


select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,13)||' '||char(current date - 1 days) 
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'

BASS1_EXP_G_I_03003_MONTH

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,15)||' '||substr(char(current date - 1 month) ,1,7)
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'

values(current month)

select char(current date - 1 month)  from   bass2.dual


select * from   app.sch_control_task where control_code like '%02053%'


select space(100-length(RET_VAL))  from G_REPORT_CHECK

select * from    bass1.g_i_06031_day where time_id = 20110415


select 
trim(char(RULE_ID))|| space(5-length(trim(char(RULE_ID)))
||trim(char(FLAG))|| space(2-length(trim(char(FLAG)))
||trim(char(RET_VAL))|| space(100-length(trim(char(RET_VAL)))
from bass1.g_i_06031_day


select 
trim(char(RULE_ID))|| space(5-length(trim(char(RULE_ID)))
||trim(char(FLAG))|| space(2-length(trim(char(FLAG)))
||trim(char(RET_VAL))|| space(100-length(trim(char(RET_VAL)))
from bass1.g_i_06031_day where time_id = 20110415



select 
trim(char(MSISDN))||space(9-length(trim(char(MSISDN))))
||trim(char(CMCC_ID))||space(5-length(trim(char(CMCC_ID))))
from bass1.g_i_06031_day where time_id = 20110415


select * from    bass1.g_i_06032_day where time_id = 20110415
20110415	13103	                                                                  	                

select 
trim(char(CMCC_ID))|| space(5-length(trim(char(CMCC_ID))))
||trim(char(CMCC_NAME))|| space(100-length(trim(char(CMCC_NAME))))
||trim(char(CMCC_DESC))|| space(20-length(trim(char(CMCC_DESC))))
from bass1.g_i_06032_day where time_id = 20110415


select 
trim(char(CMCC_DESC))--|| space(20-length(trim(char(CMCC_DESC))))
from bass1.g_i_06032_day where time_id = 20110415

select length('三') from bass2.dual
select 
space(20-length(trim(char(CMCC_DESC))))
from bass1.g_i_06032_day where time_id = 20110415

create view  t_fix_length as
select 
trim(char(CMCC_ID)) a, space(5-length(trim(char(CMCC_ID)))) b
,trim(char(CMCC_NAME)) c,space(100-length(trim(char(CMCC_NAME)))) c
,trim(char(CMCC_DESC)) e, space(20-length(trim(char(CMCC_DESC)))) f
from bass1.g_i_06032_day where time_id = 20110415



select 
trim(char(CMCC_ID))|| space(5-length(trim(char(CMCC_ID))))
||trim(char(CMCC_NAME))|| space(100-length(trim(char(CMCC_NAME))))
--||trim(char(CMCC_DESC))|| space(20-length(trim(char(CMCC_DESC))))
from bass1.g_i_06032_day where time_id = 20110415



select row_number()over() from  bass1.g_i_06032_day where time_id = 20110415


select count(0)
from   app.sch_control_runlog  a 
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and flag = 0

select control_code 
from   app.sch_control_runlog  a 
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and flag = 0

select * from app.sch_control_before
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)

select time_id,count(0) 
from bass1.g_rule_check where rule_code in('DR01','DR02','DR03','DR04','DR05','DR11','DR12','DR13','DR14','DR15','DR16','DR17','DR18','
DR19','DR21','DR22','DR31','DR32')
group by time_id



select DISTINCT before_control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



select * from app.sch_control_before where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



--后续调度依赖的前置(含要删除的)


select control_code,count(0) from app.sch_control_before
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code


select * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_before 
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code having count(0) > 1
) 


select * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_before 
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code having count(0) > 1 
) 





select * from app.sch_control_before a, app.sch_control_before  b 
where a.control_code in (
select control_code from app.sch_control_before 
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code having count(0) = 1 
) 
and a.before_control_code = b.CONTROL_CODE


SELECT * FROM APP.sch_control_before 
WHERE CONTROL_CODE IN ('BASS1_EXP_G_A_01004_DAY','BASS1_EXP_G_S_04006_DAY','BASS1_EXP_G_S_22038_DAY')



SELECT * FROM  APP.sch_control_before 
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')


select * from app.sch_control_task
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')





select * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_before 
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code having count(0) > 1
) 
and before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)




select * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_before 
where control_code IN (
select control_code from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)
)
group by control_code having count(0) > 1
) 
and before_control_code  not in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



select * from app.sch_control_task where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)


select * from app.sch_control_before where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)



select * from app.sch_control_before where before_control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
)

select count(0) from app.SCH_CONTROL_BEFORE_20110417
select count(0) from app.SCH_CONTROL_BEFORE


select * from   syscat.tables where tabname like '%SCH_CONTROL_BEFORE%'

SELECT * FROM APP.SCH_CONTROL_BEFORE_20110417 
WHERE CONTROL_CODE IN ('BASS1_EXP_G_A_01004_DAY','BASS1_EXP_G_S_04006_DAY','BASS1_EXP_G_S_22038_DAY')


select count(0) from app.SCH_CONTROL_BEFORE_20110417 WHERE CONTROL_CODE LIKE 'BASS1_%'
964
select count(0) from app.SCH_CONTROL_BEFORE WHERE CONTROL_CODE LIKE 'BASS1_%'
964



UPDATE APP.sch_control_before 
SET before_control_code = 'BASS1_G_A_01004_DAY.tcl'
WHERE CONTROL_CODE = 'BASS1_EXP_G_A_01004_DAY'

UPDATE APP.sch_control_before 
SET before_control_code = 'BASS1_G_S_04006_DAY.tcl'
WHERE CONTROL_CODE = 'BASS1_EXP_G_S_04006_DAY'

UPDATE APP.sch_control_before 
SET before_control_code = 'BASS1_G_S_22038_DAY.tcl'
WHERE CONTROL_CODE = 'BASS1_EXP_G_S_22038_DAY'


delete FROM APP.sch_control_before 
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')


update app.sch_control_task
set CC_FLAG = 2
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')



INSERT INTO  APP.sch_control_before 
SELECT * FROM APP.SCH_CONTROL_BEFORE_20110417 
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')



SELECT * FROM APP.sch_control_before 
WHERE CONTROL_CODE IN ('BASS1_EXP_G_A_01004_DAY','BASS1_EXP_G_S_04006_DAY','BASS1_EXP_G_S_22038_DAY')



select * from   app.sch_control_runlog
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')

update   app.sch_control_runlog
set flag = 0
WHERE CONTROL_CODE IN ('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')


select count(0) from app.SCH_CONTROL_BEFORE WHERE CONTROL_CODE LIKE 'BASS1_%'
964


select * from    app.SCH_CONTROL_runlog
where control_code = 'BASS1_EXP_G_S_22403_DAY'




select * from app.sch_control_task where control_code in (
 'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_36_MONTH.tcl'
,'BASS1_INT_CHECK_59_62H789I01_TO_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_8895_MONTH.tcl'
,'BASS1_INT_CHECK_98Z6_MONTH.tcl'
,'BASS1_INT_CHECK_A0L694B5_DAY.tcl'
,'BASS1_INT_CHECK_A12E6_DAY.tcl'
,'BASS1_INT_CHECK_C567_DAY.tcl'
,'INT_CHECK_DATARULE_DAY.tcl'
,'BASS1_INT_CHECK_E5_MONTH.tcl'
,'BASS1_INT_CHECK_F0_TO_DAY.tcl'
,'BASS1_INT_CHECK_F1_TO_DAY.tcl'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_G047TO50_MONTH.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_L0_TO_DAY.tcl'
,'BASS1_INT_CHECK_L1K9_TO_DAY.tcl'
,'BASS1_INT_CHECK_L2_TO_DAY.tcl'
,'BASS1_INT_CHECK_L34_MONTH.tcl'
) 
and control_code not in 
('BASS1_INT_CHECK_F1_TO_DAY.tcl','BASS1_INT_CHECK_L2_TO_DAY.tcl','BASS1_INT_CHECK_C567_DAY.tcl')





--BASS1_EXP_G_A_02061_DAY


SELECT * FROM bass1.MON_ALL_INTERFACE  t
where t


select * from   app.sch_control_before
where control_code in 
('BASS1_EXP_G_S_21004_DAY','BASS1_EXP_G_S_21001_DAY','BASS1_EXP_G_S_21009_DAY')

BASS1_EXP_G_S_21001_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_S_21004_DAY	BASS1_INT_CHECK_C567_DAY.tcl
BASS1_EXP_G_S_21009_DAY	BASS1_INT_CHECK_C567_DAY.tcl


delete from app.sch_control_before
where control_code = 'BASS1_EXP_G_S_21001_DAY'
and before_control_code = 'BASS1_INT_CHECK_C567_DAY.tcl'

delete from app.sch_control_before
where control_code = 'BASS1_EXP_G_S_21004_DAY'
and before_control_code = 'BASS1_INT_CHECK_C567_DAY.tcl'


delete from app.sch_control_before
where control_code = 'BASS1_EXP_G_S_21009_DAY'
and before_control_code = 'BASS1_INT_CHECK_C567_DAY.tcl'

select * from   app.sch_control_runlog 
where  flag = 1


select * from   app.sch_control_runlog 
where control_code like '%BASS1_EXP%'
and flag = 1


select count(0) from    G_S_21004_DAY where time_id = 20110418
select count(0) from    G_S_21001_DAY where time_id = 20110418
select count(0) from    G_S_21009_DAY where time_id = 20110418


select time_id,count(0)
from G_S_21009_DAY
where time_id > 20110101
group by time_id





select length(trim(enterprise_id)),count(0)
from G_I_77780_DAY a
group by length(trim(enterprise_id))

1	2
0	44
10	15
12	25
13	2
14	911

select length(trim(enterprise_id)),count(0)
from G_I_77780_DAY_DOWN20110415 a
group by length(trim(enterprise_id))
1	2
0	1
9	5
10	88
11	24
12	14
13	7
14	3321


select *
from G_I_77780_DAY_DOWN20110415 a
where length(trim(enterprise_id)) < 14

select * from    GRP_ID_OLD_NEW_MAP_20110330 
 
select * from syscat.tables where tabname like '%GRP_ID_OLD_NEW_MAP_20110330%' 
 select count(0) 
 from  BASS1.grp_id_old_new_map_20110330  a
 join 


select * from    BASS1.t_grp_id_old_new_map


--目标表
CREATE TABLE BASS1.t_grp_id_old_new_map
 (
	 area_id            		INTEGER              ----数据日期        
	,OLD_ENTERPRISE_ID      		CHAR(20)             ----old集团客户标识    
	,NEW_ENTERPRISE_ID      		CHAR(20)            ----new集团客户标识    
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OLD_ENTERPRISE_ID,NEW_ENTERPRISE_ID) USING HASHING;
ALTER TABLE BASS1.t_grp_id_old_new_map
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from  t_grp_id_old_new_map
  
  select count(0) from  grp_id_old_new_map_20110330
  
 select * from   BASS1.t_grp_id_old_new_map
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID

  
 select * from   BASS1.t_grp_id_old_new_map
where not( length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID
)



 CREATE TABLE BASS1.grp_id_old_new_map_20110330 like BASS1.t_grp_id_old_new_map
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OLD_ENTERPRISE_ID,NEW_ENTERPRISE_ID) USING HASHING;
ALTER TABLE BASS1.grp_id_old_new_map_20110330
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
delete from  BASS1.grp_id_old_new_map_20110330
insert into   BASS1.grp_id_old_new_map_20110330
select 
         AREA_ID
        ,OLD_ENTERPRISE_ID
        ,NEW_ENTERPRISE_ID
        ,ENTERPRISE_NAME
from (        
select a.*,row_number()over(partition by OLD_ENTERPRISE_ID order by ENTERPRISE_NAME desc ) rn  from   BASS1.t_grp_id_old_new_map a
where  length(trim(NEW_ENTERPRISE_ID)) = 14
and NEW_ENTERPRISE_ID like '8%'
and OLD_ENTERPRISE_ID <> NEW_ENTERPRISE_ID
) t where rn = 1





 
 
 select length(trim(enterprise_id)),count(0)
from G_I_77780_DAY_DOWN20110415 a
group by length(trim(enterprise_id))



select count(0)
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_DOWN20110415 b on a.NEW_ENTERPRISE_ID = b.enterprise_id


select a.*
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_DOWN20110415 b on a.NEW_ENTERPRISE_ID = b.enterprise_id



select * from    bass1.G_I_77780_DAY_MID2



select a.*,b.*
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_DOWN20110415 b on a.OLD_ENTERPRISE_ID = b.enterprise_id



89202999661354      



 where a.ENTERPRISE_ID = b.old_enterprise_id
 
 
 select * from  G_I_77780_DAY_MID2
 
 
 
 select * from   bass1.G_I_77780_DAY_MID 
 
 
 
select a.*,b.*
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_MID b on a.OLD_ENTERPRISE_ID = b.enterprise_id


--可转换的
select a.*,b.enterprise_id
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_MID b on trim(a.OLD_ENTERPRISE_ID) = trim(b.enterprise_id)

--不需要转换的
select a.*,b.enterprise_id
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_MID b on trim(a.NEW_ENTERPRISE_ID) = trim(b.enterprise_id)

 
select a.*,b.enterprise_id,c.ENTERPRISE_ID
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_MID b on trim(a.OLD_ENTERPRISE_ID) = trim(b.enterprise_id)
join G_I_77780_DAY c on a.new_ENTERPRISE_ID = c.ENTERPRISE_ID

165


select b.id
from grp_id_old_new_map_20110330 a 
join G_I_77780_DAY_DOWN20110415 b on trim(a.OLD_ENTERPRISE_ID) = trim(b.enterprise_id)
except
select b.id 
from G_I_77780_DAY_MID b


select b.id from G_I_77780_DAY_DOWN20110415 b
except
select b.id 
from G_I_77780_DAY_MID b



select count(0) from    G_I_77780_DAY_MID
1006

select count(0) from    G_I_77780_DAY
997

select count(0),count(distinct enterprise_id ),count(distinct id),count(distinct enterprise_id||id) from    G_I_77780_DAY

997	843	778	997

select count(0) from    G_I_77780_DAY a
join G_I_77780_DAY_DOWN20110415 b on trim(a.ENTERPRISE_ID) = trim(b.ENTERPRISE_ID) and trim(a.id) = trim(b.id )


612


select count(0) from    G_I_77780_DAY a
join G_I_77780_DAY_DOWN20110415 b on trim(a.ENTERPRISE_ID) = trim(b.ENTERPRISE_ID) 

1120

select  a.ENTERPRISE_ID,b.ENTERPRISE_ID,a.id,b.id  from    G_I_77780_DAY a
join G_I_77780_DAY_DOWN20110415 b on trim(a.ENTERPRISE_ID) = trim(b.ENTERPRISE_ID) 
and a.id<>b.id
508

select a.ENTERPRISE_ID,b.ENTERPRISE_ID,a.id,b.id from    G_I_77780_DAY a
join G_I_77780_DAY_DOWN20110415 b on trim(a.id) = trim(b.id)
and  a.ENTERPRISE_ID<>b.ENTERPRISE_ID
132



 744
 
 




select count(0) from    G_I_77780_DAY_DOWN20110415
3460

select count(0) from G_I_77780_DAY where 

select b.id from G_I_77780_DAY_DOWN20110415 b 
except
select b.id 
from G_I_77780_DAY_MID b

8951007828          	9917296  

select * from   G_I_77780_DAY where enterprise_id = '8951007828'



select ENTERPRISE_ID,id from   G_I_77780_DAY_DOWN20110415 a 
join grp_id_old_new_map_20110330 b on trim(a.ENTERPRISE_ID) = trim(b.old_ENTERPRISE_ID)
except 
select ENTERPRISE_ID,id from   G_I_77780_DAY

select a.*,b.ENTERPRISE_ID,b.id
from 
(select a.ENTERPRISE_ID,a.id from   G_I_77780_DAY_DOWN20110415 a 
join grp_id_old_new_map_20110330 b on trim(a.ENTERPRISE_ID) = trim(b.old_ENTERPRISE_ID)
) a join G_I_77780_DAY b 
on a.ENTERPRISE_ID = b.ENTERPRISE_ID

except 
select ENTERPRISE_ID,id from   G_I_77780_DAY





select ENTERPRISE_ID,id from   G_I_77780_DAY
except 
select ENTERPRISE_ID,id from   G_I_77780_DAY_DOWN20110415 a 
join grp_id_old_new_map_20110330 b on trim(a.ENTERPRISE_ID) = trim(b.old_ENTERPRISE_ID)


select a.*,b.ENTERPRISE_ID,b.id
from 
(select a.ENTERPRISE_ID,a.id,old_ENTERPRISE_ID,new_ENTERPRISE_ID from   G_I_77780_DAY_DOWN20110415 a 
join grp_id_old_new_map_20110330 b on trim(a.ENTERPRISE_ID) = trim(b.old_ENTERPRISE_ID)
) a join G_I_77780_DAY_mid b 
on a.ENTERPRISE_ID = b.ENTERPRISE_ID


select upload_type_id,count(0) from   G_I_77780_DAY_DOWN20110415
group by upload_type_id



select * from   G_I_77780_DAY_DOWN20110415
where enterprise_id
in 
('89102999530006'
,'89102999674130'
,'89102999677848'
,'89101560000227'
,'89103001129200'
,'89103001297331'
,'89102999719736'
,'89101560001881'
,'89103001217795'
,'89103000988259'
,'89102999676402'
,'89108911009013'
,'89103001217855'
,'89102999958291'
,'89103001340362'
,'89102999677953'
,'89101560000042'
,'89102999719613'
,'89103000115958'
,'89103001212607'
,'89101560000470'
,'89102999038707'
,'89102999677751'
,'89101560001694'
,'89101560000964'
,'89102999719542'
)



select * from   G_I_77780_DAY
where enterprise_id
in 
('89102999530006'
,'89102999674130'
,'89102999677848'
,'89101560000227'
,'89103001129200'
,'89103001297331'
,'89102999719736'
,'89101560001881'
,'89103001217795'
,'89103000988259'
,'89102999676402'
,'89108911009013'
,'89103001217855'
,'89102999958291'
,'89103001340362'
,'89102999677953'
,'89101560000042'
,'89102999719613'
,'89103000115958'
,'89103001212607'
,'89101560000470'
,'89102999038707'
,'89102999677751'
,'89101560001694'
,'89101560000964'
,'89102999719542'
)

count(0),count(distinct enterprise_id)
grp_id_old_new_map_20110330
 distinct length(enterprise_id)
 
select t.*,case when b.ENTERPRISE_ID is not null then 1 else 0 end ifok from table(
select '89102999530006' enterprise_id from bass2.dual union all
select '89102999674130' enterprise_id from bass2.dual union all
select '89102999677848' enterprise_id from bass2.dual union all
select '89101560000227' enterprise_id from bass2.dual union all
select '89103001129200' enterprise_id from bass2.dual union all
select '89103001297331' enterprise_id from bass2.dual union all
select '89102999719736' enterprise_id from bass2.dual union all
select '89101560001881' enterprise_id from bass2.dual union all
select '89103001217795' enterprise_id from bass2.dual union all
select '89103000988259' enterprise_id from bass2.dual union all
select '89102999676402' enterprise_id from bass2.dual union all
select '89108911009013' enterprise_id from bass2.dual union all
select '89103001217855' enterprise_id from bass2.dual union all
select '89102999958291' enterprise_id from bass2.dual union all
select '89103001340362' enterprise_id from bass2.dual union all
select '89102999677953' enterprise_id from bass2.dual union all
select '89101560000042' enterprise_id from bass2.dual union all
select '89102999719613' enterprise_id from bass2.dual union all
select '89103000115958' enterprise_id from bass2.dual union all
select '89103001212607' enterprise_id from bass2.dual union all
select '89101560000470' enterprise_id from bass2.dual union all
select '89102999038707' enterprise_id from bass2.dual union all
select '89102999677751' enterprise_id from bass2.dual union all
select '89101560001694' enterprise_id from bass2.dual union all
select '89101560000964' enterprise_id from bass2.dual union all
select '89102999719542' enterprise_id from bass2.dual 
) t
left join  G_I_77780_DAY_DOWN20110415 b 
on  t.enterprise_id = b.enterprise_id

grp_id_old_new_map_20110330


select t.*,b.* from table(
select '89102999530006' enterprise_id from bass2.dual union all
select '89102999674130' enterprise_id from bass2.dual union all
select '89102999677848' enterprise_id from bass2.dual union all
select '89101560000227' enterprise_id from bass2.dual union all
select '89103001129200' enterprise_id from bass2.dual union all
select '89103001297331' enterprise_id from bass2.dual union all
select '89102999719736' enterprise_id from bass2.dual union all
select '89101560001881' enterprise_id from bass2.dual union all
select '89103001217795' enterprise_id from bass2.dual union all
select '89103000988259' enterprise_id from bass2.dual union all
select '89102999676402' enterprise_id from bass2.dual union all
select '89108911009013' enterprise_id from bass2.dual union all
select '89103001217855' enterprise_id from bass2.dual union all
select '89102999958291' enterprise_id from bass2.dual union all
select '89103001340362' enterprise_id from bass2.dual union all
select '89102999677953' enterprise_id from bass2.dual union all
select '89101560000042' enterprise_id from bass2.dual union all
select '89102999719613' enterprise_id from bass2.dual union all
select '89103000115958' enterprise_id from bass2.dual union all
select '89103001212607' enterprise_id from bass2.dual union all
select '89101560000470' enterprise_id from bass2.dual union all
select '89102999038707' enterprise_id from bass2.dual union all
select '89102999677751' enterprise_id from bass2.dual union all
select '89101560001694' enterprise_id from bass2.dual union all
select '89101560000964' enterprise_id from bass2.dual union all
select '89102999719542' enterprise_id from bass2.dual 
) t
left join  grp_id_old_new_map_20110330 b 
on  t.enterprise_id = b.new_enterprise_id

select t.*,case when b.ENTERPRISE_ID is not null then 1 else 0 end ifok from table(
select '1','89102999530006' enterprise_id from bass2.dual union all
select '2','89102999674130' enterprise_id from bass2.dual union all
select '3','89102999677848' enterprise_id from bass2.dual union all
select '4','89101560000227' enterprise_id from bass2.dual union all
select '5','89103001129200' enterprise_id from bass2.dual union all
select '6','89103001297331' enterprise_id from bass2.dual union all
select '7','89102999719736' enterprise_id from bass2.dual union all
select '8','89101560001881' enterprise_id from bass2.dual union all
select '9','89103001217795' enterprise_id from bass2.dual union all
select '10','89103000988259' enterprise_id from bass2.dual union all
select '11','89102999676402' enterprise_id from bass2.dual union all
select '12','89108911009013' enterprise_id from bass2.dual union all
select '13','89103001217855' enterprise_id from bass2.dual union all
select '14','89102999958291' enterprise_id from bass2.dual union all
select '15','89103001340362' enterprise_id from bass2.dual union all
select '16','89102999677953' enterprise_id from bass2.dual union all
select '17','89101560000042' enterprise_id from bass2.dual union all
select '18','89102999719613' enterprise_id from bass2.dual union all
select '19','89103000115958' enterprise_id from bass2.dual union all
select '20','89103001212607' enterprise_id from bass2.dual union all
select '21','89101560000470' enterprise_id from bass2.dual union all
select '22','89102999038707' enterprise_id from bass2.dual union all
select '23','89102999677751' enterprise_id from bass2.dual union all
select '24','89101560001694' enterprise_id from bass2.dual union all
select '25','89101560000964' enterprise_id from bass2.dual union all
select '26','89102999719542' enterprise_id from bass2.dual 
) t
left join  G_I_77780_DAY_DOWN20110415 b 
on  t.enterprise_id = b.enterprise_id
order by 1


G_I_77780_DAY_DOWN20110415
select t.*,case when b.ENTERPRISE_ID is not null then 1 else 0 end ifok from table(
select 1,'89102999530006' enterprise_id from bass2.dual union all
select 2,'89102999674130' enterprise_id from bass2.dual union all
select 3,'89102999677848' enterprise_id from bass2.dual union all
select 4,'89101560000227' enterprise_id from bass2.dual union all
select 5,'89103001129200' enterprise_id from bass2.dual union all
select 6,'89103001297331' enterprise_id from bass2.dual union all
select 7,'89102999719736' enterprise_id from bass2.dual union all
select 8,'89101560001881' enterprise_id from bass2.dual union all
select 9,'89103001217795' enterprise_id from bass2.dual union all
select 10,'89103000988259' enterprise_id from bass2.dual union all
select 11,'89102999676402' enterprise_id from bass2.dual union all
select 12,'89108911009013' enterprise_id from bass2.dual union all
select 13,'89103001217855' enterprise_id from bass2.dual union all
select 14,'89102999958291' enterprise_id from bass2.dual union all
select 15,'89103001340362' enterprise_id from bass2.dual union all
select 16,'89102999677953' enterprise_id from bass2.dual union all
select 17,'89101560000042' enterprise_id from bass2.dual union all
select 18,'89102999719613' enterprise_id from bass2.dual union all
select 19,'89103000115958' enterprise_id from bass2.dual union all
select 20,'89103001212607' enterprise_id from bass2.dual union all
select 21,'89101560000470' enterprise_id from bass2.dual union all
select 22,'89102999038707' enterprise_id from bass2.dual union all
select 23,'89102999677751' enterprise_id from bass2.dual union all
select 24,'89101560001694' enterprise_id from bass2.dual union all
select 25,'89101560000964' enterprise_id from bass2.dual union all
select 26,'89102999719542' enterprise_id from bass2.dual 
) t
left join  G_I_77780_DAY_DOWN20110415 b 
on  t.enterprise_id = b.enterprise_id
order by 1




select t.*,case when b.ENTERPRISE_ID is not null then 1 else 0 end ifok
,upload_type_id
 from table(
select 1,'89102999530006' enterprise_id from bass2.dual union all
select 2,'89102999674130' enterprise_id from bass2.dual union all
select 3,'89102999677848' enterprise_id from bass2.dual union all
select 4,'89101560000227' enterprise_id from bass2.dual union all
select 5,'89103001129200' enterprise_id from bass2.dual union all
select 6,'89103001297331' enterprise_id from bass2.dual union all
select 7,'89102999719736' enterprise_id from bass2.dual union all
select 8,'89101560001881' enterprise_id from bass2.dual union all
select 9,'89103001217795' enterprise_id from bass2.dual union all
select 10,'89103000988259' enterprise_id from bass2.dual union all
select 11,'89102999676402' enterprise_id from bass2.dual union all
select 12,'89108911009013' enterprise_id from bass2.dual union all
select 13,'89103001217855' enterprise_id from bass2.dual union all
select 14,'89102999958291' enterprise_id from bass2.dual union all
select 15,'89103001340362' enterprise_id from bass2.dual union all
select 16,'89102999677953' enterprise_id from bass2.dual union all
select 17,'89101560000042' enterprise_id from bass2.dual union all
select 18,'89102999719613' enterprise_id from bass2.dual union all
select 19,'89103000115958' enterprise_id from bass2.dual union all
select 20,'89103001212607' enterprise_id from bass2.dual union all
select 21,'89101560000470' enterprise_id from bass2.dual union all
select 22,'89102999038707' enterprise_id from bass2.dual union all
select 23,'89102999677751' enterprise_id from bass2.dual union all
select 24,'89101560001694' enterprise_id from bass2.dual union all
select 25,'89101560000964' enterprise_id from bass2.dual union all
select 26,'89102999719542' enterprise_id from bass2.dual 
) t
left join  G_I_77780_DAY b 
on  t.enterprise_id = b.enterprise_id
order by 1


select * from   G_I_77780_DAY
where enterprise_id = '89101560000964'


select * from   G_I_77780_DAY_DOWN20110415
where enterprise_id = '89101560000964'

G_I_77780_DAY_DOWN20110415


89103001220750



select * from   G_I_77780_DAY_DOWN20110415
where enterprise_id = '89103001220750'
	89103001220750      	XZLS00181	                                                	10   	540231	              	              	              	                                                  	0891 	6934462    	          	850000	9300	7       	1    	171	2009	09	1	1	9	19	01	15	20	1	 


select * from   G_I_77780_DAY
where enterprise_id = '89103001220750'

20101231	89103001220750      	DX0121931	                                            	30   	540125	                	          	              	                                                      	0891 	6934462    	          	851400	9426	43      	1    	110	1959	09	9	1	1	19	01	99	11	3	2

89102999683759

select * from table(
select 1		sn ,'89100000000781' ent_id from bass2.dual  union all
select 2		sn ,'89102999678267' ent_id from bass2.dual  union all
select 3		sn ,'89100000000705' ent_id from bass2.dual  union all
select 4		sn ,'89102999683759' ent_id from bass2.dual  union all
select 5		sn ,'89102999839757' ent_id from bass2.dual  union all
select 6		sn ,'89103000946057' ent_id from bass2.dual  union all
select 7		sn ,'89103000064017' ent_id from bass2.dual  union all
select 8		sn ,'89100000001994' ent_id from bass2.dual  union all
select 9		sn ,'89102999435065' ent_id from bass2.dual  union all
select 10	sn ,'89103000621702' ent_id from bass2.dual    union all
select 11	sn ,'89100000000706' ent_id from bass2.dual    union all
select 12	sn ,'89100000001201' ent_id from bass2.dual    union all
select 13	sn ,'89100000001059' ent_id from bass2.dual    union all
select 14	sn ,'89100000000745' ent_id from bass2.dual    union all
select 15	sn ,'89103001622602' ent_id from bass2.dual    union all
select 16	sn ,'89103001458963' ent_id from bass2.dual    union all
select 17	sn ,'89103000617612' ent_id from bass2.dual    union all
select 18	sn ,'89103000552694' ent_id from bass2.dual    union all
select 19	sn ,'89102999506974' ent_id from bass2.dual    union all
select 20	sn ,'89103001245590' ent_id from bass2.dual    union all
select 21	sn ,'89103001406741' ent_id from bass2.dual    union all
select 22	sn ,'89103000146038' ent_id from bass2.dual    union all
select 23	sn ,'89100000000985' ent_id from bass2.dual    union all
select 24	sn ,'89103001401858' ent_id from bass2.dual    union all
select 25	sn ,'89103001479683' ent_id from bass2.dual    union all
select 26	sn ,'89103001526257' ent_id from bass2.dual    union all
select 27	sn ,'89102999492029' ent_id from bass2.dual    union all
select 28	sn ,'89103000178395' ent_id from bass2.dual    union all
select 29	sn ,'89100000003591' ent_id from bass2.dual    union all
select 30	sn ,'89100000001180' ent_id from bass2.dual    union all
select 31	sn ,'89100000003760' ent_id from bass2.dual    union all
select 32	sn ,'89100000003870' ent_id from bass2.dual    union all
select 33	sn ,'89102999541900' ent_id from bass2.dual    union all
select 34	sn ,'89103000138225' ent_id from bass2.dual    union all
select 35	sn ,'89103001127423' ent_id from bass2.dual    union all
select 36	sn ,'89102999386292' ent_id from bass2.dual    union all
select 37	sn ,'89103001243985' ent_id from bass2.dual    union all
select 38	sn ,'89101560001495' ent_id from bass2.dual    union all
select 39	sn ,'89103000994233' ent_id from bass2.dual    union all
select 40	sn ,'89103000987125' ent_id from bass2.dual    union all
select 41	sn ,'89101560000477' ent_id from bass2.dual    union all
select 42	sn ,'89103001378490' ent_id from bass2.dual    union all
select 43	sn ,'89100000001227' ent_id from bass2.dual    union all
select 44	sn ,'89102999790622' ent_id from bass2.dual    union all
select 45	sn ,'89100000001017' ent_id from bass2.dual    union all
select 46	sn ,'89101560000743' ent_id from bass2.dual    union all
select 47	sn ,'89102999567199' ent_id from bass2.dual    union all
select 48	sn ,'89102999994032' ent_id from bass2.dual    union all
select 49	sn ,'89103001186111' ent_id from bass2.dual    union all
select 50	sn ,'89101560000568' ent_id from bass2.dual    union all
select 51	sn ,'89103000980688' ent_id from bass2.dual    union all
select 52	sn ,'89103000137752' ent_id from bass2.dual    union all
select 53	sn ,'89101560001721' ent_id from bass2.dual    union all
select 54	sn ,'89103001312386' ent_id from bass2.dual    union all
select 55	sn ,'89103001185005' ent_id from bass2.dual    union all
select 56	sn ,'89103000082555' ent_id from bass2.dual    union all
select 57	sn ,'89103000150831' ent_id from bass2.dual    union all
select 58	sn ,'89103000760867' ent_id from bass2.dual    union all
select 59	sn ,'89100000003531' ent_id from bass2.dual    union all
select 60	sn ,'89100000003719' ent_id from bass2.dual    union all
select 61	sn ,'89103000730481' ent_id from bass2.dual    union all
select 62	sn ,'89103000024493' ent_id from bass2.dual    union all
select 63	sn ,'89102999961453' ent_id from bass2.dual    union all
select 64	sn ,'89102999704905' ent_id from bass2.dual    union all
select 65	sn ,'89100000001202' ent_id from bass2.dual    union all
select 66	sn ,'89100000000795' ent_id from bass2.dual    union all
select 67	sn ,'89103001561167' ent_id from bass2.dual    union all
select 68	sn ,'89100000001209' ent_id from bass2.dual    union all
select 69	sn ,'89100000001107' ent_id from bass2.dual    union all
select 70	sn ,'89103001511691' ent_id from bass2.dual    union all
select 71	sn ,'89102999540922' ent_id from bass2.dual    union all
select 72	sn ,'89100000003865' ent_id from bass2.dual    union all
select 73	sn ,'89103001217307' ent_id from bass2.dual    union all
select 74	sn ,'89103001123440' ent_id from bass2.dual    union all
select 75	sn ,'89103001247755' ent_id from bass2.dual    union all
select 76	sn ,'89103001018443' ent_id from bass2.dual    union all
select 77	sn ,'89102999484031' ent_id from bass2.dual    union all
select 78	sn ,'89103001410733' ent_id from bass2.dual    union all
select 79	sn ,'89102999040885' ent_id from bass2.dual    union all
select 80	sn ,'89103001560707' ent_id from bass2.dual    union all
select 81	sn ,'89103001555680' ent_id from bass2.dual    union all
select 82	sn ,'89103001410717' ent_id from bass2.dual    union all
select 83	sn ,'89103001478666' ent_id from bass2.dual    union all
select 84	sn ,'89100000000880' ent_id from bass2.dual    union all
select 85	sn ,'89103000604297' ent_id from bass2.dual    union all
select 86	sn ,'89103001215411' ent_id from bass2.dual    union all
select 87	sn ,'89101560001288' ent_id from bass2.dual    
) t 
left join G_I_77780_DAY b on t.ent_id = b.ENTERPRISE_ID


select * from 
table
(select 1		,'89101560000071' ent_id from bass2.dual union all
select 2		,'89103001266375' ent_id from bass2.dual union all 
select 3		,'89103001112300' ent_id from bass2.dual union all 
select 4		,'89103000225049' ent_id from bass2.dual union all 
select 5		,'89103001221427' ent_id from bass2.dual union all
select 6		,'89103000195207' ent_id from bass2.dual union all
select 7		,'89103001211641' ent_id from bass2.dual union all
select 8		,'89103001241135' ent_id from bass2.dual union all
select 9		,'89103000608698' ent_id from bass2.dual union all
select 10	,'89103001221379'   ent_id from bass2.dual union all
select 11	,'89103001221422'   ent_id from bass2.dual union all
select 12	,'89103000545529'   ent_id from bass2.dual union all
select 13	,'89102999353706'   ent_id from bass2.dual union all
select 14	,'89103000924607'   ent_id from bass2.dual union all
select 15	,'89101560001876'   ent_id from bass2.dual union all
select 16	,'89103000138204'   ent_id from bass2.dual union all
select 17	,'89103000936986'   ent_id from bass2.dual union all
select 18	,'89102999478101'   ent_id from bass2.dual union all
select 19	,'89101560000501'   ent_id from bass2.dual union all
select 20	,'89103001113778'   ent_id from bass2.dual union all
select 21	,'89103000990159'   ent_id from bass2.dual union all
select 22	,'89101560001384'   ent_id from bass2.dual union all
select 23	,'89102999987787'   ent_id from bass2.dual union all
select 24	,'89101560001460'   ent_id from bass2.dual union all
select 25	,'89102999386322'   ent_id from bass2.dual union all
select 26	,'89103001396413'   ent_id from bass2.dual union all
select 27	,'89103001061802'   ent_id from bass2.dual union all
select 28	,'89103001051735'   ent_id from bass2.dual union all
select 29	,'89103001245853'   ent_id from bass2.dual 
) t
left join G_I_77780_DAY b on t.ent_id = b.ENTERPRISE_ID




select * from 
table
(select 1		,'89101560000071' ent_id from bass2.dual union all
select 2		,'89103001266375' ent_id from bass2.dual union all 
select 3		,'89103001112300' ent_id from bass2.dual union all 
select 4		,'89103000225049' ent_id from bass2.dual union all 
select 5		,'89103001221427' ent_id from bass2.dual union all
select 6		,'89103000195207' ent_id from bass2.dual union all
select 7		,'89103001211641' ent_id from bass2.dual union all
select 8		,'89103001241135' ent_id from bass2.dual union all
select 9		,'89103000608698' ent_id from bass2.dual union all
select 10	,'89103001221379'   ent_id from bass2.dual union all
select 11	,'89103001221422'   ent_id from bass2.dual union all
select 12	,'89103000545529'   ent_id from bass2.dual union all
select 13	,'89102999353706'   ent_id from bass2.dual union all
select 14	,'89103000924607'   ent_id from bass2.dual union all
select 15	,'89101560001876'   ent_id from bass2.dual union all
select 16	,'89103000138204'   ent_id from bass2.dual union all
select 17	,'89103000936986'   ent_id from bass2.dual union all
select 18	,'89102999478101'   ent_id from bass2.dual union all
select 19	,'89101560000501'   ent_id from bass2.dual union all
select 20	,'89103001113778'   ent_id from bass2.dual union all
select 21	,'89103000990159'   ent_id from bass2.dual union all
select 22	,'89101560001384'   ent_id from bass2.dual union all
select 23	,'89102999987787'   ent_id from bass2.dual union all
select 24	,'89101560001460'   ent_id from bass2.dual union all
select 25	,'89102999386322'   ent_id from bass2.dual union all
select 26	,'89103001396413'   ent_id from bass2.dual union all
select 27	,'89103001061802'   ent_id from bass2.dual union all
select 28	,'89103001051735'   ent_id from bass2.dual union all
select 29	,'89103001245853'   ent_id from bass2.dual 
) t
left join G_I_77780_DAY_DOWN20110415 b on t.ent_id = b.ENTERPRISE_ID

89103000545529
select * from   G_I_77780_DAY
where ENTERPRISE_ID = '89103001223457'


select count(0),count(distinct xx ) from    G_I_77780_DAY_DOWN20110415

select count(0),count(distinct enterprise_id ),count(distinct id),count(distinct enterprise_id||id) from    G_I_77780_DAY_DOWN20110415


3460	3083	3412	3458




select count(0) from   G_S_03017_MONTH 
where time_id = 201103

15720
select count(0) from   G_S_03018_MONTH 
where time_id = 201103

175427



select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
) t
                    
                    
select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'




update app.g_runlog 
set return_flag = 0
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
and unit_code = '03017'



update app.g_runlog 
set return_flag = 0
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
and unit_code = '03018'

select * from   g_s_03018_month 
where income is null

select income from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'

select income  from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201103
and manage_mod = '2'
and ent_busi_id = '1220'
) t



select * from   G_S_03017_MONTH
where enterprise_id is null


group by tim



select time_id,REGION_FLAG,count(0) cnt from BASS1.g_a_02052_month a
where REGION_FLAG = '3'
group by time_id ,REGION_FLAG

select REGION_FLAG,count(0) cnt from BASS1.g_a_02052_month
group by REGION_FLAG


select * from BASS1.g_a_02052_month
where time_id = 201001
and REGION_FLAG = '3'

group by REGION_FLAG
select * from   MON_ALL_INTERFACE where interface_code = '02052'



select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,15),b.control_code from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
) t where unit_code = '02022'

select * 
 from bass2.STAT_ZD_VILLAGE_USERS_201007
 
 
 
 

select count(0) from   bass2.dw_product_201007 a ,
 bass2.STAT_ZD_VILLAGE_USERS_201007 b 
where MONTH_CALL_MARK = 1
and a.user_id = b.USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3
283292

select count(0) from   bass2.dw_product_200907 a ,
 bass2.STAT_ZD_VILLAGE_USERS_200907 b 
where MONTH_CALL_MARK = 1
and a.user_id = b.USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3

189661
                     

956348
                     
                     
bass2.dw_product_201007





select LOCNTYPE_ID,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201001
group by LOCNTYPE_ID
select LOCNTYPE_ID,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200901
group by LOCNTYPE_ID



select LOCNTYPE_ID,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201002
group by LOCNTYPE_ID


select month_call_mark , count(0)
from bass2.dw_product_201001 
group by month_call_mark



select count(0) from   bass2.dw_product_201001 a ,
 bass2.STAT_ZD_VILLAGE_USERS_201001 b 
where MONTH_CALL_MARK = 1
and a.user_id = b.USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3
0


select count(0) from   bass2.dw_product_201001 a ,
 bass2.STAT_ZD_VILLAGE_USERS_201001 b ,
 bass2.trans_user_id_20100625 c
where MONTH_CALL_MARK = 1
and a.user_id = c.new_USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3
                     and b.user_id = c.USER_ID

226787

select count(0) from   bass2.dw_product_200901 a ,
 bass2.STAT_ZD_VILLAGE_USERS_200901 b 
where MONTH_CALL_MARK = 1
and a.user_id = b.USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3

128420




select * from    bass2.STAT_ZD_VILLAGE_USERS_201002 
select * from   
bass2.trans_user_id_20100625


select * from    bass2.dw_product_201002 


0

227870

select count(0) from   bass2.dw_product_200901 a ,
 bass2.STAT_ZD_VILLAGE_USERS_200901 b 
where MONTH_CALL_MARK = 1
and a.user_id = b.USER_ID
                     and  usertype_id in (1,2,9) 
                     and userstatus_id in (1,2,3,6,8)
                     and test_mark<>1
                     and LOCNTYPE_ID = 3


                    
select * from syscat.tables where tabname like  '%STAT_ZD_VILLAGE_USERS%' 
                    
                    

select LOCNTYPE_ID,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200901
group by LOCNTYPE_ID

3	140439





select * from   bass2.STAT_ZD_VILLAGE_USERS_2009


select count(*) from bass2.dw_product_200907 a,
(
select user_id,region_flag
from
(
select time_id,user_id,region_flag
        ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.G_A_02052_MONTH
where time_id<=200907
) a
where row_id=1
  and region_flag='3'
) b,
bass2.trans_user_id_20100625 c
where b.user_id=c.new_USER_ID
  and a.user_id = c.USER_ID
  and a.usertype_id in (1,2,9) 
  and a.userstatus_id in (1,2,3,6,8)
  and a.test_mark<>1


215866



select * from     bass2.STAT_ZD_VILLAGE_USERS_200901


select '200901' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200901 where LOCNTYPE_ID = 3 union all
select '200902' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200902 where LOCNTYPE_ID = 3 union all
select '200903' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200903 where LOCNTYPE_ID = 3 union all
select '200904' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200904 where LOCNTYPE_ID = 3 union all
select '200905' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200905 where LOCNTYPE_ID = 3 union all
select '200906' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200906 where LOCNTYPE_ID = 3 union all
select '200907' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200907 where LOCNTYPE_ID = 3 union all
select '200908' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200908 where LOCNTYPE_ID = 3 union all
select '200909' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200909 where LOCNTYPE_ID = 3 union all
select '200910' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200910 where LOCNTYPE_ID = 3 union all
select '200911' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200911 where LOCNTYPE_ID = 3 union all
select '200912' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_200912 where LOCNTYPE_ID = 3 union all
select '201001' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201001 where LOCNTYPE_ID = 3 union all
select '201002' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201002 where LOCNTYPE_ID = 3 union all
select '201003' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201003 where LOCNTYPE_ID = 3 union all
select '201004' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201004 where LOCNTYPE_ID = 3 union all
select '201005' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201005 where LOCNTYPE_ID = 3 union all
select '201006' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201006 where LOCNTYPE_ID = 3 union all
select '201007' m ,count(0) from  bass2.STAT_ZD_VILLAGE_USERS_201007 where LOCNTYPE_ID = 3 
           


                    

CREATE TABLE BASS1.G_S_22080_DAY
 (
	 TIME_ID            	INTEGER             ----记录行号        
	,OP_TIME            	CHAR(8)             ----日期 主键       
	,QRY_CNT            	CHAR(12)            ----查询量 单位：次 
	,CANCEL_CNT         	CHAR(12)            ----退订量 单位：次 
	,CANCEL_FAIL_CNT    	CHAR(12)            ----退订失败量 单位：次
	,COMPLAINT_CNT      	CHAR(12)            ----投诉量 单位：次 
	,ALL_CANCEL_CNT     	CHAR(12)            ----当天退订业务总数 单位：次
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22080_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from    app.sch_control_task where priority_val > 100

                   
select time_id,count(0) from    bass1.G_A_02052_MONTH
where region_flag='3'
group by time_id                   


select * from    bass2.dw_product_unite_cancel_order_201103 where sts = 0

select  sts,count(0) from   bass2.dw_product_unite_cancel_order_201103
group by sts



select * from 
table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,13) from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'
) t where unit_code = '22012'


select * from     bass1.G_S_22012_DAY

select time_id/100,sum(bigint(M_BILL_DURATION)) from   bass1.G_S_22012_DAY
group by time_id/100
order by 1 desc


21003

21006



select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,15),b.control_code from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
) t where unit_code = '21006'


 G_S_21003_MONTH

select count(0) from    
G_S_21006_MONTH


select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201101
select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201102
select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201103
--680598277

select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201104
select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201105
select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201109
select  sum(bigint(BASE_BILL_DURATION)) d from G_S_21003_MONTH where time_id = 201107


201103	680378057

680598277	5651836140
201103	680378057

	670515699	684457694	669302779	680432919	674032989	676852669	608161793	527503654	680598277	

608161793	4822228380



BASE_BILL_DURATION
TOLL_BILL_DURATION

select time_id,sum(d) from (
select time_id, bigint(BASE_BILL_DURATION) d from G_S_21003_MONTH
union all 
select time_id,bigint(TOLL_BILL_DURATION) d from G_S_21003_MONTH
union all 
select time_id,bigint(BASE_BILL_DURATION) d from G_S_21006_MONTH
union all 
select time_id,bigint(TOLL_BILL_DURATION) d from G_S_21006_MONTH
) t 
group by time_id



select * from    bass2.dw_enterprise_msg_201103
where enterprise_id
in
('891910006907'
,'891910006537'
,'891910005097'
,'891910005160'
,'891910006292'
,'891910005743'
,'891910006739'
,'891910006669')






CREATE TABLE BASS1.G_I_77780_DAY_b20110421
 (
	 TIME_ID            		INTEGER        NOT NULL       ----数据日期        
	,ENTERPRISE_ID      		CHAR(20)       					       ----集团客户标识    
	,ID                 		CHAR(9)        								----ID*              
	,ENTERPRISE_NAME    		CHAR(60)       								----集团客户名称*    
	,ORG_TYPE           		CHAR(5)             					----机构类型 							BASS_STD_0001       
	,ADDR_CODE          		CHAR(6)             					----地址代码*        
	,CITY               		CHAR(20)            					----城市地区*        
	,REGION             		CHAR(20)            					----区县*            
	,COUNTY             		CHAR(20)            					----乡镇*            
	,DOOR_NO            		CHAR(60)            					----门牌*            
	,AREA_CODE          		CHAR(5)             					----区号*            
	,PHONE_NO1          		CHAR(11)            					----电话1*           
	,PHONE_NO2          		CHAR(10)            					----电话2*           
	,POST_CODE          		CHAR(6)             					----邮政编码*        
	,INDUSTRY_TYPE      		CHAR(4)             					----行业类型 							BASS_STD1_0113       
	,EMPLOYEE_CNT       		CHAR(8)             					----职员            
	,INDUSTRY_UNIT_CNT  		CHAR(5)             					----产业单位数*      
	,ECONOMIC_TYPE      		CHAR(3)             					----经济类型 							BASS_STD_0002       
	,OPEN_YEAR          		CHAR(4)             					----开业1           
	,OPEN_MONTH         		CHAR(2)             					----开业2           
	,SHAREHOLDER        		CHAR(1)             					----控股  								BASS_STD_0005          
	,GROUP_TYPE         		CHAR(1)             					----集团类型 							BASS_STD_0003       
	,MANAGE_STYLE       		CHAR(1)             					----经营形式      				BASS_STD_0004  
	,OPERATE_REVENUE_CLASS	CHAR(2)           						----营业收入分类 					BASS_STD_0006   
	,CAPITAL_CLASS      		CHAR(2)           						----资产分类     					BASS_STD_0007   
	,INDUSTRY_CLASS_CODE		CHAR(2)    NOT NULL         	----行业分类编码 					BASS_STD1_0043   
	,CUST_STATUS        		CHAR(2)             					----集团客户状态    
	,CUST_INFO_SRC_ID   		CHAR(1)             					----集团客户资料来源
	,UPLOAD_TYPE_ID     		CHAR(1)    NOT NULL         	----上传种类标识    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_b20110421
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into  BASS1.G_I_77780_DAY_b20110421
select * from BASS1.G_I_77780_DAY

delete from  BASS1.G_I_77780_DAY 



drop table  BASS1.G_I_77780_DAY_MID_a ;
CREATE TABLE BASS1.G_I_77780_DAY_MID_a(
   TIME_ID INTEGER ----数据日期       
   ,
   ENTERPRISE_ID CHAR(20) ----集团客户标识   
   ,
   ID CHAR(9) ----ID*             
   ,
   ENTERPRISE_NAME CHAR(60) ----集团客户名称*   
   ,
   ORG_TYPE CHAR(5) ----机构类型 							BASS_STD_0001       
   --ADDR_CODE不规范6 CHAR(6)
   ,
   ADDR_CODE VARCHAR(10) ----地址代码*       
   ,
   CITY CHAR(20) ----城市地区*        
   ---REGION 不规范 9           		CHAR(20)
   ,
   REGION VARCHAR(100) ----区县*            
   ---COUNTY 不规范 10            		CHAR(20) 	
   ,
   COUNTY VARCHAR(100) ----乡镇*           
   ,
   DOOR_NO CHAR(60) ----门牌*           
   ,
   AREA_CODE CHAR(5) ----区号*            
   --PHONE_NO1 不规范  12       		CHAR(11)
   ,
   PHONE_NO1 VARCHAR(111) ----电话1*           
   --,PHONE_NO2  不规范  13        		CHAR(10)
   ,
   PHONE_NO2 VARCHAR(110) ----电话2*           
   --POST_CODE 不规范  14         		CHAR(6)
   ,
   POST_CODE VARCHAR(16) ----邮政编码*        
   --	,INDUSTRY_TYPE  不规范  15    		CHAR(4)
   ,
   INDUSTRY_TYPE VARCHAR(14) ----行业类型 							BASS_STD1_0113      
   ,
   EMPLOYEE_CNT CHAR(8) ----职员           
   ,
   INDUSTRY_UNIT_CNT CHAR(5) ----产业单位数*      
   --ECONOMIC_TYPE  不规范  18    		CHAR(3)
   ,
   ECONOMIC_TYPE CHAR(13) ----经济类型 							BASS_STD_0002       
   --OPEN_YEAR  不规范  19        		CHAR(4)
   ,
   OPEN_YEAR VARCHAR(14) ----开业1           
   --OPEN_MONTH 不规范  20        		CHAR(2)
   ,
   OPEN_MONTH VARCHAR(22) ----开业2           
   --SHAREHOLDER不规范CHAR(1)
   ,
   SHAREHOLDER VARCHAR(4) ----控股  								BASS_STD_0005          
   --GROUP_TYPE不规范CHAR(1)
   ,
   GROUP_TYPE VARCHAR(2) ----集团类型 							BASS_STD_0003       
   --MANAGE_STYLE不规范CHAR(1)
   ,
   MANAGE_STYLE VARCHAR(4) ----经营形式      				BASS_STD_0004 
   ,
   OPERATE_REVENUE_CLASS	  CHAR(2) ----营业收入分类 					BASS_STD_0006  
   ,
   CAPITAL_CLASS CHAR(2) ----资产分类     					BASS_STD_0007  
   ,
   INDUSTRY_CLASS_CODE	  CHAR(2) ----行业分类编码 					BASS_STD1_0043  
   ,
   CUST_STATUS CHAR(2) ----集团客户状态   
   ,
   CUST_INFO_SRC_ID CHAR(1) ----集团客户资料来源
   ,
   UPLOAD_TYPE_ID CHAR(1) ----上传种类标识    
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    TIME_ID,
    ENTERPRISE_ID 
 )USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_MID_a
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from BASS1.dim_bass1_std_map
  
  
  
  select * from  BASS1.G_I_77780_DAY_MID_a
  
  
  
  CREATE TABLE BASS1.dim_bass1_std_map
 (
	 interface_code       CHAR(5)            
	,dim_table_id      		CHAR(20)       NOT NULL      
	,code                 CHAR(9)        NOT NULL				       
	,code_name    		    CHAR(60)       NOT NULL											
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (dim_table_id,code) USING HASHING;
ALTER TABLE BASS1.dim_bass1_std_map
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
CREATE TABLE bass1.G_I_77780_DAY_MID2 LIKE bass1.G_I_77780_DAY DATA CAPTURE 
NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    ENTERPRISE_ID,
    ID 
 )USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_MID2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into bass1.G_I_77780_DAY_MID2
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ID
        ,ENTERPRISE_NAME
        ,ORG_TYPE
      ,case when ADDR_CODE is null or length(ADDR_CODE) <> 6 then '540102' else ADDR_CODE end ADDR_CODE
        ,CITY
        ,substr(REGION,1,20) REGION
        ,substr(COUNTY,1,20) COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,replace(PHONE_NO1,'-','') PHONE_NO1
        ,substr(replace(PHONE_NO2,'-',''),1,10) PHONE_NO2
        ,case when POST_CODE is null or length(POST_CODE) <> 6 then '850000' else POST_CODE end POST_CODE
        ,case when INDUSTRY_TYPE is null or length(INDUSTRY_TYPE) <> 4 then '9421' else INDUSTRY_TYPE end INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,case when ECONOMIC_TYPE is null or length(trim(ECONOMIC_TYPE)) <> 3 then '190' else trim(ECONOMIC_TYPE) end ECONOMIC_TYPE
        ,case when OPEN_YEAR is null then '2002' when  length(OPEN_YEAR) <> 4  then substr(OPEN_YEAR,1,4) else OPEN_YEAR end OPEN_YEAR
        ,case when length(OPEN_MONTH) =1 then '0'||trim(OPEN_MONTH) when length(OPEN_MONTH) <> 2 then '01' else OPEN_MONTH end OPEN_MONTH
        ,case when SHAREHOLDER is null then '9' 
        	when SHAREHOLDER not in ('1','2','3','4','5') then '9' else SHAREHOLDER end SHAREHOLDER
        ,case when GROUP_TYPE not in ('1','2') then '2' else GROUP_TYPE end GROUP_TYPE
        ,case when MANAGE_STYLE is null then '9' 
        	when length(MANAGE_STYLE) = 2 and  substr(MANAGE_STYLE,2,1) in ('1','2','3') then substr(MANAGE_STYLE,2,1)
        	when length(MANAGE_STYLE) = 1 and  MANAGE_STYLE in ('1','2','3') then MANAGE_STYLE 
      		else '9' end MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
      ,case when INDUSTRY_CLASS_CODE is null then '99'  else INDUSTRY_CLASS_CODE end INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
      ,case when UPLOAD_TYPE_ID is null then '3' else UPLOAD_TYPE_ID end UPLOAD_TYPE_ID
from bass1.G_I_77780_DAY_MID_a a

create table bass1.G_I_77780_DAY_MID3 like bass1.G_I_77780_DAY
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,ID) USING HASHING;
select a.*
				from  bass1.G_I_77780_DAY_MID2 a
				 join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id




delete from bass1.G_I_77780_DAY_MID3;
insert into bass1.G_I_77780_DAY_MID3
select 
         TIME_ID
        ,NEW_ENTERPRISE_ID
        ,ID
        ,NEW_ENTERPRISE_NAME
        ,ORG_TYPE
        ,ADDR_CODE
        ,CITY
        ,REGION
        ,COUNTY
        ,DOOR_NO
        ,AREA_CODE
        ,PHONE_NO1
        ,PHONE_NO2
        ,POST_CODE
        ,INDUSTRY_TYPE
        ,EMPLOYEE_CNT
        ,INDUSTRY_UNIT_CNT
        ,ECONOMIC_TYPE
        ,OPEN_YEAR
        ,OPEN_MONTH
        ,SHAREHOLDER
        ,GROUP_TYPE
        ,MANAGE_STYLE
        ,OPERATE_REVENUE_CLASS
        ,CAPITAL_CLASS
        ,INDUSTRY_CLASS_CODE
        ,CUST_STATUS
        ,CUST_INFO_SRC_ID
        ,UPLOAD_TYPE_ID
from   (select a.* 
		,VALUE(b.new_enterprise_id,a.ENTERPRISE_ID) NEW_ENTERPRISE_ID
		,VALUE(b.ENTERPRISE_NAME,a.ENTERPRISE_NAME) NEW_ENTERPRISE_NAME
		, row_number()over(PARTITION by ENTERPRISE_ID,id order by  UPLOAD_TYPE_ID asc ) rn 
				from  bass1.G_I_77780_DAY_MID2 a
				left join  BASS1.grp_id_old_new_map_20110330  b on a.ENTERPRISE_ID = b.old_enterprise_id
			 ) t where t.rn = 1 


insert into bass1.G_I_77780_DAY_MID3
select * from 		 bass1.G_I_77780_DAY_MID2

        
        
        
select * from    bass1.G_I_77780_DAY_MID3
        
        
 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3

 
select value(ENTERPRISE_ID,'a')||value(id,'a')
,count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
  from    G_I_77780_DAY_MID3     
group by value(ENTERPRISE_ID,'a')||value(id,'a')
having count(distinct value(ENTERPRISE_ID,'a')||value(id,'a'))  > 1



89103001221422      219667969	2	1
89102999676402      XZ0309285	2	1



select * from 
G_I_77780_DAY_MID3
where ENTERPRISE_ID in ('89103001221422','89102999676402')
and id in ('219667969','XZ0309285')

update G_I_77780_DAY_MID3
set  upload_type_id = '3'
where  ENTERPRISE_ID = '89102999676402      '

delete from G_I_77780_DAY_MID3
where enterprise_id = '89103001221422'
and city = '拉萨'



delete from G_I_77780_DAY_MID3
where enterprise_id = '89102999676402'
and enterprise_name = '拉萨市八一小校'





select upload_type_id,count(0)
from G_I_77780_DAY_MID3
group by upload_type_id



 select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from  bass1.G_I_77780_DAY_MID3




select count(0)
from 
(select distinct ORG_TYPE ORG_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ORG_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0001')





select count(0)
from 
(select distinct ORG_TYPE ORG_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ORG_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0001')





drop table BASS1.t_bass1_std_0113
CREATE TABLE BASS1.t_bass1_std_0113
 (
	 code    char(4)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (code) USING HASHING;
select count(0)
from 
(select distinct trim(INDUSTRY_TYPE) INDUSTRY_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_TYPE  not in 
(select code from BASS1.t_bass1_std_0113 )



select count(0)
from 
(select distinct ECONOMIC_TYPE ECONOMIC_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ECONOMIC_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD_0002')



select ECONOMIC_TYPE,count(0)
from  bass1.G_I_77780_DAY_MID3
group by ECONOMIC_TYPE

select * from  BASS1.dim_bass1_std_map 


select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0002'



select count(0)
from 
(select distinct ECONOMIC_TYPE ECONOMIC_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ECONOMIC_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0002')




select *
from 
(select distinct ECONOMIC_TYPE ECONOMIC_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ECONOMIC_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0002')


update  bass1.G_I_77780_DAY_MID3


update G_I_77780_DAY_MID3 
set ECONOMIC_TYPE = '171'
where ECONOMIC_TYPE in 
(
'170'
)

select * from    G_I_77780_DAY_MID3 
where ECONOMIC_TYPE in 
('100'
,'101'
,'150'
,'170'
)



select count(0)
from 
(select distinct ECONOMIC_TYPE ECONOMIC_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where ECONOMIC_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0002')






select count(0)
from 
(select distinct SHAREHOLDER SHAREHOLDER from   bass1.G_I_77780_DAY_MID3) a 
where SHAREHOLDER  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0005')




select count(0)
from 
(select distinct GROUP_TYPE GROUP_TYPE from   bass1.G_I_77780_DAY_MID3) a 
where GROUP_TYPE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0003')




select count(0)
from 
(select distinct MANAGE_STYLE MANAGE_STYLE from   bass1.G_I_77780_DAY_MID3) a 
where MANAGE_STYLE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0004')






select count(0)
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')


select count(0)
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')


update G_I_77780_DAY_MID3 
set OPERATE_REVENUE_CLASS = '0'||OPERATE_REVENUE_CLASS
where  OPERATE_REVENUE_CLASS
in (select *
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')
)


select '0'||OPERATE_REVENUE_CLASS
from G_I_77780_DAY_MID3
where OPERATE_REVENUE_CLASS
in (select *
from 
(select distinct OPERATE_REVENUE_CLASS OPERATE_REVENUE_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where OPERATE_REVENUE_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0006')
)




select *
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')


select * from  bass1.G_I_77780_DAY_MID3
where CAPITAL_CLASS
in (
select *
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')
)




update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '0'||CAPITAL_CLASS
where  CAPITAL_CLASS
in (
select *
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')
)




select count(0)
from 
(select distinct CAPITAL_CLASS CAPITAL_CLASS from   bass1.G_I_77780_DAY_MID3) a 
where CAPITAL_CLASS  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')


update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '0'||trim(CAPITAL_CLASS)
where length(trim(CAPITAL_CLASS)) = 1



update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '05'
where CAPITAL_CLASS is null 




update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '01'
where CAPITAL_CLASS = '00'




select count(0)
from 
(select distinct INDUSTRY_CLASS_CODE INDUSTRY_CLASS_CODE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_CLASS_CODE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')




select *
from 
(select distinct INDUSTRY_CLASS_CODE INDUSTRY_CLASS_CODE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_CLASS_CODE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')


select distinct INDUSTRY_CLASS_CODE INDUSTRY_CLASS_CODE from   bass1.G_I_77780_DAY_MID3



update G_I_77780_DAY_MID3 
set INDUSTRY_CLASS_CODE = '0'||TRIM(INDUSTRY_CLASS_CODE)
where length(trim(INDUSTRY_CLASS_CODE)) = 1

select INDUSTRY_CLASS_CODE,count(0)
from G_I_77780_DAY_MID3
group by INDUSTRY_CLASS_CODE

update G_I_77780_DAY_MID3 
set INDUSTRY_CLASS_CODE = '08'
where 
 INDUSTRY_CLASS_CODE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')








select count(0)
from 
(select distinct INDUSTRY_CLASS_CODE INDUSTRY_CLASS_CODE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_CLASS_CODE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')


select *
from 
(select distinct INDUSTRY_CLASS_CODE INDUSTRY_CLASS_CODE from   bass1.G_I_77780_DAY_MID3) a 
where INDUSTRY_CLASS_CODE  not in 
(select code from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007')




 select distinct CUST_STATUS CUST_STATUS from   bass1.G_I_77780_DAY_MID3

select * from  bass1.G_I_77780_DAY_MID3
where CUST_STATUS = '10'

update G_I_77780_DAY_MID3 
set CUST_STATUS = '11'
where  CUST_STATUS = '10'






update G_I_77780_DAY_MID3 
set CUST_INFO_SRC_ID = '1'
where  CUST_INFO_SRC_ID IS NULL 



select * from   bass1.G_I_77780_DAY_MID3



select * from    bass1.g_i_77780_day



select * from bass1.g_i_77780_day_mid3 where TIME_ID                   is null 
select * from bass1.g_i_77780_day_mid3 where ENTERPRISE_ID             is null 
select * from bass1.g_i_77780_day_mid3 where ID                        is null 
--update bass1.g_i_77780_day set id = ' ' where ID                        is null 
select * from bass1.g_i_77780_day_mid3 where ORG_TYPE                  is null 
select * from bass1.g_i_77780_day_mid3 where ADDR_CODE                 is null 
select * from bass1.g_i_77780_day_mid3 where CITY                      is null 
select * from bass1.g_i_77780_day_mid3 where REGION                    is null 
select * from bass1.g_i_77780_day_mid3 where COUNTY                    is null 
--update  bass1.g_i_77780_day set COUNTY = ' ' where COUNTY                        is null 
select * from bass1.g_i_77780_day_mid3 where DOOR_NO                   is null 
--update  bass1.g_i_77780_day set DOOR_NO = ' ' where DOOR_NO                        is null 
select * from bass1.g_i_77780_day_mid3 where AREA_CODE                 is null 
select * from bass1.g_i_77780_day_mid3 where PHONE_NO1                 is null 
--update  bass1.g_i_77780_day set PHONE_NO1 = ' ' where PHONE_NO1                        is null 
select * from bass1.g_i_77780_day_mid3 where PHONE_NO2                 is null 
--update  bass1.g_i_77780_day set PHONE_NO2 = ' ' where PHONE_NO2                        is null 
select * from bass1.g_i_77780_day_mid3 where POST_CODE                 is null 
--update  bass1.g_i_77780_day set POST_CODE = ' ' where POST_CODE                        is null 
select * from bass1.g_i_77780_day_mid3 where INDUSTRY_TYPE             is null 
--update  bass1.g_i_77780_day set INDUSTRY_TYPE = ' ' where INDUSTRY_TYPE                        is null 
select * from bass1.g_i_77780_day_mid3 where EMPLOYEE_CNT              is null 
--
select * from bass1.g_i_77780_day_mid3 where INDUSTRY_UNIT_CNT         is null 
select * from bass1.g_i_77780_day_mid3 where ECONOMIC_TYPE             is null 
select * from bass1.g_i_77780_day_mid3 where OPEN_YEAR                 is null 
select * from bass1.g_i_77780_day_mid3 where OPEN_MONTH                is null 
select * from bass1.g_i_77780_day_mid3 where SHAREHOLDER               is null 
select * from bass1.g_i_77780_day_mid3 where GROUP_TYPE                is null 
select * from bass1.g_i_77780_day_mid3 where MANAGE_STYLE              is null 
select * from bass1.g_i_77780_day_mid3 where OPERATE_REVENUE_CLASS     is null 
select * from bass1.g_i_77780_day_mid3 where CAPITAL_CLASS             is null 
select * from bass1.g_i_77780_day_mid3 where INDUSTRY_CLASS_CODE       is null 
select * from bass1.g_i_77780_day_mid3 where CUST_STATUS               is null 
select * from bass1.g_i_77780_day_mid3 where CUST_INFO_SRC_ID          is null 
select * from bass1.g_i_77780_day_mid3 where UPLOAD_TYPE_ID            is null 

OPEN_YEAR

select GROUP_TYPE from g_i_77780_day_mid3

update g_i_77780_day_mid3
set GROUP_TYPE = '1'
where GROUP_TYPE is null 




select OPEN_YEAR,count(0)
from g_i_77780_day_mid3
group by OPEN_YEAR


select OPEN_MONTH,count(0)
from g_i_77780_day_mid3
group by OPEN_MONTH


select OPEN_MONTH,count(0)
from g_i_77780_day_mid3
group by OPEN_MONTH


update g_i_77780_day_mid3
set OPEN_MONTH = '01'
where OPEN_MONTH is null 





select * from   g_i_77780_day_mid3


delete from g_i_77780_day
insert into g_i_77780_day
select * from g_i_77780_day_mid3



select * from app.g_runlog 
where return_flag=1
and unit_code = '77780'




update app.g_runlog 
set return_flag = 0
where return_flag=1
and unit_code = '77780'





update BASS1.G_I_77780_DAY
set CUST_STATUS = ' '
where CUST_STATUS is null 
;

UPDATE BASS1.G_I_77780_DAY SET CUST_INFO_SRC_ID = ' ' 
WHERE CUST_INFO_SRC_ID IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET UPLOAD_TYPE_ID = ' ' 
WHERE UPLOAD_TYPE_ID IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET GROUP_TYPE = ' ' 
WHERE GROUP_TYPE IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET MANAGE_STYLE = ' ' 
WHERE MANAGE_STYLE IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET OPERATE_REVENUE_CLASS = ' ' 
WHERE OPERATE_REVENUE_CLASS IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET CAPITAL_CLASS = ' ' 
WHERE CAPITAL_CLASS IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_CLASS_CODE = ' ' 
WHERE INDUSTRY_CLASS_CODE IS NULL 
;

SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE TIME_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE ENTERPRISE_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE ID IS NULL ;
--update bass1.g_i_77780_day set id = ' ' where ID                        is null         ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE ORG_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE ADDR_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE CITY IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE REGION IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE COUNTY IS NULL ;
--update  bass1.g_i_77780_day set COUNTY = ' ' where COUNTY    is null                    ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE DOOR_NO IS NULL ;
--update  bass1.g_i_77780_day set DOOR_NO = ' ' where DOOR_NO  is null                    ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE AREA_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE PHONE_NO1 IS NULL ;
--update  bass1.g_i_77780_day set PHONE_NO1 = ' ' where PHONE_NO1  is null                ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE PHONE_NO2 IS NULL ;
--update  bass1.g_i_77780_day set PHONE_NO2 = ' ' where PHONE_NO2  is null                ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE POST_CODE IS NULL ;
--update  bass1.g_i_77780_day set POST_CODE = ' ' where POST_CODE   is null               ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE INDUSTRY_TYPE IS NULL ;
--update  bass1.g_i_77780_day set INDUSTRY_TYPE = ' ' where INDUSTRY_TYPE  is null        ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE EMPLOYEE_CNT IS NULL ;
--                                                                                        ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE INDUSTRY_UNIT_CNT IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE ECONOMIC_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE OPEN_YEAR IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE OPEN_MONTH IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE SHAREHOLDER IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE GROUP_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE MANAGE_STYLE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE OPERATE_REVENUE_CLASS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE CAPITAL_CLASS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE INDUSTRY_CLASS_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE CUST_STATUS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE CUST_INFO_SRC_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day_mid3 
WHERE UPLOAD_TYPE_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE TIME_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE ENTERPRISE_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE ID IS NULL ;
--update bass1.g_i_77780_day set id = ' ' where ID                        is null         ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE ORG_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE ADDR_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE CITY IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE REGION IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE COUNTY IS NULL ;
--update  bass1.g_i_77780_day set COUNTY = ' ' where COUNTY    is null                    ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE DOOR_NO IS NULL ;
--update  bass1.g_i_77780_day set DOOR_NO = ' ' where DOOR_NO  is null                    ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE AREA_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE PHONE_NO1 IS NULL ;
--update  bass1.g_i_77780_day set PHONE_NO1 = ' ' where PHONE_NO1  is null                ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE PHONE_NO2 IS NULL ;
--update  bass1.g_i_77780_day set PHONE_NO2 = ' ' where PHONE_NO2  is null                ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE POST_CODE IS NULL ;
--update  bass1.g_i_77780_day set POST_CODE = ' ' where POST_CODE   is null               ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE INDUSTRY_TYPE IS NULL ;
--update  bass1.g_i_77780_day set INDUSTRY_TYPE = ' ' where INDUSTRY_TYPE  is null        ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE EMPLOYEE_CNT IS NULL ;
--                                                                                        ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE INDUSTRY_UNIT_CNT IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE ECONOMIC_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE OPEN_YEAR IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE OPEN_MONTH IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE SHAREHOLDER IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE GROUP_TYPE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE MANAGE_STYLE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE OPERATE_REVENUE_CLASS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE CAPITAL_CLASS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE INDUSTRY_CLASS_CODE IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE CUST_STATUS IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE CUST_INFO_SRC_ID IS NULL ;
SELECT * 
FROM bass1.g_i_77780_day 
WHERE UPLOAD_TYPE_ID IS NULL ;
UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_TYPE = '2040' 
WHERE INDUSTRY_TYPE = '2050'
;

UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_TYPE = '3010' 
WHERE INDUSTRY_TYPE = '3000'
;
select count(0),count(distinct value(ENTERPRISE_ID,'a')||value(id,'a')) 
from   BASS1.G_I_77780_DAY





update BASS1.G_I_77780_DAY
set CUST_STATUS = ' '
where CUST_STATUS is null 
;

UPDATE BASS1.G_I_77780_DAY SET CUST_INFO_SRC_ID = ' ' 
WHERE CUST_INFO_SRC_ID IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET UPLOAD_TYPE_ID = ' ' 
WHERE UPLOAD_TYPE_ID IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET GROUP_TYPE = ' ' 
WHERE GROUP_TYPE IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET MANAGE_STYLE = ' ' 
WHERE MANAGE_STYLE IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET OPERATE_REVENUE_CLASS = ' ' 
WHERE OPERATE_REVENUE_CLASS IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET CAPITAL_CLASS = ' ' 
WHERE CAPITAL_CLASS IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_CLASS_CODE = ' ' 
WHERE INDUSTRY_CLASS_CODE IS NULL 
;

UPDATE BASS1.G_I_77780_DAY SET INDUSTRY_TYPE = '7210' 
WHERE INDUSTRY_TYPE = '7214'
;
update G_I_77780_DAY_MID3 
set CUST_STATUS = '36'
where  CUST_STATUS IS NULL 





update G_I_77780_DAY_MID3 
set CUST_INFO_SRC_ID = '1'
where  CUST_INFO_SRC_ID IS NULL 



update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '0'||trim(CAPITAL_CLASS)
where length(trim(CAPITAL_CLASS)) = 1




update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '05'
where CAPITAL_CLASS is null 



update G_I_77780_DAY_MID3 
set CAPITAL_CLASS = '01'
where CAPITAL_CLASS = '00'

update  bass1.G_I_77780_DAY_MID3
set ORG_TYPE = '51'
where ORG_TYPE = '5'


update G_I_77780_DAY_MID3 
set ECONOMIC_TYPE = '110'
where ECONOMIC_TYPE in 
('100'
,'101'
,'150'
,'170'
)

update G_I_77780_DAY_MID3 
set OPERATE_REVENUE_CLASS = '10'
where OPERATE_REVENUE_CLASS is null 

select * from APP.G_FILE_REPORT
where filename like '%77780%'




select * from   app.g_runlog where unit_code = '77780'


session.int_check_user_status 

select product_no, count(0) 
from session.int_check_user_status 
 where usertype_id NOT IN ('2010','2020','2030','9000')
group by product_no
having count(0) >  1



13518902680    

select * from    session.int_check_user_status 
where product_no = '13518902680'

G_S_21003_MONTH 


                select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
                from bass1.G_A_02052_MONTH

select * from    bass1.G_A_02052_MONTH



declare global temporary table session.BASE_BILL_DURATION
    (
   product_no     CHARACTER(15) ,
    BASE_BILL_DURATION bigint
    )                            
partitioning key           
 (
   product_no    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp

insert into session.BASE_BILL_DURATION
select PRODUCT_NO,sum(bigint(BASE_BILL_DURATION)) BASE_BILL_DURATION
from G_S_21003_MONTH
where time_id = 201103
group by PRODUCT_NO
1251046 row(s) affected.

select sum(BASE_BILL_DURATION) from session.BASE_BILL_DURATION

declare global temporary table session.region_flag
    (
   user_id     CHARACTER(20) ,
    REGION_FLAG  CHARACTER(1) 
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp

insert into session.region_flag
select user_id,region_flag
from 
(
                select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
                from bass1.G_A_02052_MONTH
                ) t where row_id = 1


create index session.idx_region_flag on  session.region_flag(user_id)
create index session.int_check_user_status on  session.int_check_user_status(user_id)
create index session.idx_BASE_BILL_DURATION    on    session.BASE_BILL_DURATION(PRODUCT_NO)          
select count(0),count(distinct user_id ) from    session.region_flag
select   region_flag,sum(c.BASE_BILL_DURATION) BASE_BILL_DURATION
from         session.region_flag a
inner join session.int_check_user_status b on a.user_id = b.user_id
inner join       session.BASE_BILL_DURATION c on b.PRODUCT_NO = c.PRODUCT_NO
group by region_flag

                

declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into t_int_check_user_status(
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110331 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110331 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')

create table t_int_check_user_status like     session.int_check_user_status
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING


            

declare global temporary table session.BASE_BILL_DURATION
    (
   product_no     CHARACTER(15) ,
    BASE_BILL_DURATION bigint
    )                            
partitioning key           
 (
   product_no    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


            
            

declare global temporary table session.BASE_BILL_DURATION
    (
   product_no     CHARACTER(15) ,
    BASE_BILL_DURATION bigint
    )                            
partitioning key           
 (
   product_no    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


            
 create table t_BASE_BILL_DURATION like     session.int_check_user_status
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (product_no
   ) USING HASHING
           
create table t_int_check_user_status like     session.int_check_user_status
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (product_no
   ) USING HASHING

            
            
insert into t_BASE_BILL_DURATION
select PRODUCT_NO,sum(bigint(BASE_BILL_DURATION)) BASE_BILL_DURATION
from G_S_21003_MONTH
where time_id = 201103
group by PRODUCT_NO

create index idx on  session.region_flag(user_id)
create index session.int_check_user_status on  session.int_check_user_status(user_id)
create index session.idx_BASE_BILL_DURATION    on    session.BASE_BILL_DURATION(PRODUCT_NO)                  
            
drop table t_BASE_BILL_DURATION 
create table t_BASE_BILL_DURATION like     session.BASE_BILL_DURATION
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (product_no
   ) USING HASHING



declare global temporary table session.region_flag
    (
   user_id     CHARACTER(20) ,
    REGION_FLAG  CHARACTER(1) 
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp



drop table t_region_flag 
create table t_region_flag like     session.region_flag
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING


insert into t_region_flag
select user_id,region_flag
from 
(
                select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
                from bass1.G_A_02052_MONTH
                ) t where row_id = 1
                


create index idx_region_flag on  t_region_flag(user_id)
create index idx_check_user_status on  t_int_check_user_status(user_id)
create index idx_BASE_BILL_DURATION    on   t_BASE_BILL_DURATION(PRODUCT_NO)                  
            
db2 runstats on table bass1.t_region_flag with distribution and detailed indexes all      
db2 runstats on table bass1.t_int_check_user_status with distribution and detailed indexes all      
db2 runstats on table bass1.t_BASE_BILL_DURATION with distribution and detailed indexes all      
            
select   region_flag,sum(c.BASE_BILL_DURATION) BASE_BILL_DURATION
from         t_region_flag a
inner join t_int_check_user_status b on a.user_id = b.user_id
inner join       t_int_check_user_status c on b.PRODUCT_NO = c.PRODUCT_NO
 where usertype_id NOT IN ('2010','2020','2030','9000')
group by region_flag


select   region_flag,sum(c.BASE_BILL_DURATION) BASE_BILL_DURATION
from         t_region_flag a
inner join t_int_check_user_status b on a.user_id = b.user_id
inner join      t_BASE_BILL_DURATION c on b.PRODUCT_NO = c.PRODUCT_NO
group by region_flag

select sum(BASE_BILL_DURATION) from t_BASE_BILL_DURATION
680598277


select count(0),count(distinct user_id  ) from  t_region_flag
  
select count(0),count(distinct user_id  ) from  t_int_check_user_status

select count(0),count(distinct PRODUCT_NO  ) from  t_BASE_BILL_DURATION




            
            
select  count(0)
from         t_region_flag a
inner join t_int_check_user_status b on a.user_id = b.user_id
inner join      t_BASE_BILL_DURATION c on b.PRODUCT_NO = c.PRODUCT_NO

1217756



select  time_id,target1,target3 from 
bass1.g_rule_check where rule_code = 'C1'
and time_id between  20110301 and 20110307
order by 1 desc 


select * from   bass2.ODS_UP_SP_SERVICE_20110428

select * from    bass2.ODS_DIM_UP_SP_SERVICE_20110421


select * from   bass2.ODS_DIM_UP_SP_SERVICE_20110428

select bill_flag,operator_name,count(0) from    bass2.ODS_DIM_UP_SP_SERVICE_20110428
group by bill_flag,operator_name
order by 1 desc 


select * from    bass2.ODS_DIM_UP_SP_SERVICE_20110421


select count(0),count(distinct operator_code) from   bass2.ODS_DIM_UP_SP_SERVICE_20110421
select * from   bass2.dw_cdr_


select * from   
 bass2.CDR_GPRS_LOCAL_20110421
 
 
select * from   
 bass2.CDR_GPRS_roamin_20110421
 
 select * from  
 dw_newbusi_gprs_
 
  SELECT * FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	  WITH UR;
SELECT * 
FROM bass2.DIM_NEWBUSI_SPINFO 
WITH UR;
SELECT * FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
where name like '全球通88%'




  a a.PRODUCT_ITEM_ID ;
select * from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 b b.OFFER_ID
  
  select a.*,b.*
  --select count(0),count(distinct PRODUCT_ITEM_ID)
  from 
(
select OFFER_ID,count(0) cnt
from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103
where valid_date < '2011-03-01' and expire_date >  '2011-03-01'
group by OFFER_ID
) a ,(
  SELECT PRODUCT_ITEM_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
) b where a.OFFER_ID = b.PRODUCT_ITEM_ID



select b.EXTEND_ID2,a.cnt
from 
(
select OFFER_ID,count(0) cnt
from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103
where valid_date < '2011-03-01' and expire_date >  '2011-03-01'
group by OFFER_ID
) a ,
(
SELECT PRODUCT_ITEM_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
        WHERE ITEM_TYPE='OFFER_PLAN'
  AND DEL_FLAG='1'
  AND SUPPLIER_ID IS NOT NULL
) b 
where a.OFFER_ID = b.PRODUCT_ITEM_ID


 
 
 

drop table BASS1.G_I_77780_DAY_DOWN20110422
CREATE TABLE BASS1.G_I_77780_DAY_DOWN20110422
 (TIME_ID                char(1)         ,
  ENTERPRISE_ID          CHARACTER(20),
  ID                     CHARACTER(9),
  ENTERPRISE_NAME        CHARACTER(60),
  ORG_TYPE               CHARACTER(5),
  ADDR_CODE              CHARACTER(6),
  CITY                   CHARACTER(20),
  REGION                 CHARACTER(20),
  COUNTY                 CHARACTER(20),
  DOOR_NO                CHARACTER(60),
  AREA_CODE              CHARACTER(5),
  PHONE_NO1              CHARACTER(11),
  PHONE_NO2              CHARACTER(10),
  POST_CODE              CHARACTER(6),
  INDUSTRY_TYPE          CHARACTER(4),
  EMPLOYEE_CNT           CHARACTER(8),
  INDUSTRY_UNIT_CNT      CHARACTER(5),
  ECONOMIC_TYPE          CHARACTER(3),
  OPEN_YEAR              CHARACTER(4),
  OPEN_MONTH             CHARACTER(2),
  SHAREHOLDER            CHARACTER(1),
  GROUP_TYPE             CHARACTER(1),
  MANAGE_STYLE           CHARACTER(1),
  OPERATE_REVENUE_CLASS  CHARACTER(2),
  CAPITAL_CLASS          CHARACTER(2),
  INDUSTRY_CLASS_CODE    CHARACTER(2)    ,
  CUST_STATUS            CHARACTER(2),
  CUST_INFO_SRC_ID       CHARACTER(1),
  UPLOAD_TYPE_ID         CHARACTER(1)   
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    ID
   ) USING HASHING

ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110422
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
 



select POINT_FEEDBACK_ID

select POINT_FEEDBACK_ID , count(0) 
--,  count(distinct POINT_FEEDBACK_ID ) 
from G_S_02007_month 
group by  POINT_FEEDBACK_ID 
order by 1 

 
 
 
 
select user_id,ord_code,max(offer_name) offer_name,count(*) cnt from  bass2.dw_product_ord_so_log_dm_201103  a
 where  (a.offer_name like '%充值卡%' or a.offer_name like '%送%话费%') 
	         group by user_id,ord_code 


select * from   G_S_04003_DAY

G_S_04003_DAY

FLOWUP                         SYSIBM    CHARACTER                10     0 No    
FLOWDOWN                       SYSIBM    CHARACTER                10     0 No    



select b.*
from 
(
select BASE_PROD_ID , count(0) 
--,  count(distinct BASE_PROD_ID ) 
from g_i_02018_month 
group by  BASE_PROD_ID 
) a ,bass2.dim_prod_up_product_item  b 
where a.BASE_PROD_ID = char(b.product_item_id)



select BASE_PROD_TYPE , count(0) 
--,  count(distinct BASE_PROD_TYPE ) 
from g_i_02018_month 
group by  BASE_PROD_TYPE 
order by 1 



select * from   bass2.dim_prod_up_product_item              
where name like '%全球通%88%'
and item_type = 'OFFER_PLAN'
and BUSINESS_DOMAIN_ID = 'Y'


select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,13) from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'


select * from BASS1.MON_ALL_INTERFACE where upper(INTERFACE_name) like  '%GPRS%'

        aidb_runstats $objectTable 1
	
free_res_val1

is null 
is not null 


 free_res_val1 is null 

:

is not null 

:

select 
/**
                  sum(bigint(data_flow_up1+data_flow_up2))*1.0/1024/1024/1024   as up_flows
                  ,sum(bigint(data_flow_down1+data_flow_down2))*1.0/1024/1024/1024 as down_flows
                  --
                  ,sum(case when free_res_val1 is not null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_is_pkg
                  ,sum(case when free_res_val1 is  null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_not_pkg
             **/
                  sum( case when (charge1+charge2+charge3+charge4) > 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else  0 end
             ) not_free_not_pkg
from  bass2.CDR_GPRS_LOCAL_20110423



select 
                  sum(bigint(data_flow_up1+data_flow_up2))*1.0/1024/1024/1024   as up_flows
                  ,sum(bigint(data_flow_down1+data_flow_down2))*1.0/1024/1024/1024 as down_flows
            from bass2.CDR_GPRS_LOCAL_20110423
            where drtype_id not in (8307)
              and bigint(product_no) not between 14734500000 
              and 14734999999 and apn_ni <> 'JF.XZ.IP.MOBILE.LAN.CHINAMOBILE'
              and service_code not in ('1010000001','1010000002','2000000000')
              
select count(0) from    
             bass2.CDR_GPRS_LOCAL_20110423
where  free_res_val1 is null 
and free_res_val2 is not null 
          
          select * from bass2.DIM_GPRS_SERVICE_CODE
          

select * from syscat.tables where tabname LIKE '%DIM%GPRS%'            
\

select count(0), sum(charge1+charge2+charge3+charge4),sum( bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024 )
from   bass2.CDR_GPRS_LOCAL_20110423
where SERVICE_CODE = '1040000001'


Dw_newbusi_gprs_ds
select BASE_PROD_NAME,BASE_PROD_TYPE,count(0) from   bass1.g_i_02018_month
where BASE_PROD_NAME like '%全球通%'
and time_id = 201103
group by BASE_PROD_NAME,BASE_PROD_TYPE

select * from    bass1.dim_base_prod_map

select BASE_PROD_TYPE , count(0) 
--,  count(distinct BASE_PROD_TYPE ) 
from bass1.g_i_02018_month 
group by  BASE_PROD_TYPE 
order by 1 


select base_prod_id , count(0) 
--,  count(distinct base_prod_id ) 
from bass1.g_i_02018_month 
group by  base_prod_id 
order by 1 





select * from    bass2.Dim_prod_up_offer

select * from   BASS1.MON_ALL_INTERFACE where unit_code = '04002'


select cast(row_number()over() as char(8)) from  bass1.g_i_06032_day where time_id = 20110415
select \n\r from bass2.dual
VALUES 'Hello everyone' || CHR(10) || CHR(13) || 'i''m wave'  







select * from 
 bass2.dim_product_item b
 where  b.prod_id in (90004024,90004025,90004026,90004027,90004028,99001676,99001677,90004050,90008961,90004047,90004048,90004049,90004052,90004053,90004054,90004055,90004023,90004305,73900001,73900002,73900003,73900004,73900005,73900006)
 
 
 
 drop table BASS1.dim_gprs_pkg_flow;
CREATE TABLE BASS1.dim_gprs_pkg_flow(
   prod_id INTEGER,
   flow DECIMAL(12, 2) 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    prod_id 
 )USING HASHING;
ALTER TABLE BASS1.dim_gprs_pkg_flow
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
BASS1.dim_gprs_pkg_flow values
insert into bass1.dim_gprs_pkg_flow values (90004013,10);
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001311,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004011,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009610,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001694,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009401,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004012,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004303,
   10 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009334,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001642,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004304,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001612,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001613,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001643,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90600006,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001214,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90400006,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90300006,
   20 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001324,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001330,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001329,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001323,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001326,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001327,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001321,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001313,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009392,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004024,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001212,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004040,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004015,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90008109,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001213,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009614,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001320,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009722,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001136,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001312,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001322,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001325,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001670,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001319,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001328,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004302,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009424,
   30 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003312,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003306,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001315,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003311,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003305,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003308,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001614,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003315,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003307,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001314,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003316,
   50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001660,
   60 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001644,
   60 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009292,
   70 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009721,
   70 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004305,
   70 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004023,
   70 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001002,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001335,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001504,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001316,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001502,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001320,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001009,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001311,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001308,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001001,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001317,
   77 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001663,
   85 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001676,
   100 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003213,
   100 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001661,
   100.50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001645,
   100.50 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009133,
   140 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001685,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001316,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90008110,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001634,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009393,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001137,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009720,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009723,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009615,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001671,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009431,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   92001002,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004025,
   150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003019,
   154 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001677,
   200 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009328,
   210 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009329,
   210 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001317,
   300 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003314,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003310,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003303,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003301,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003304,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003302,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003313,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90003309,
   400 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   73700001,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009616,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009724,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001672,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001690,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001687,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004014,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001689,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004026,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009437,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004052,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009490,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001686,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90001318,
   500 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001606,
   501 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001662,
   501 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001646,
   525 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004047,
   600 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004017,
   800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004018,
   800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009293,
   800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004020,
   800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004019,
   800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009114,
   980 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009617,
   1024 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001673,
   1024 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001692,
   1024 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001691,
   1024 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001664,
   1026 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001605,
   1026 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004053,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001693,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004016,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001138,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004027,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   73700002,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009438,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009491,
   2048 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004048,
   2248 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004049,
   3372 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004028,
   5120 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004054,
   5120 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001139,
   5120 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90009439,
   5120 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   73700003,
   5120 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001517,
   10000 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   99001518,
   10000 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   73700004,
   10240 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004050,
   10240 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004055,
   10240 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004007,
   13800 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004001,
   21150 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004010,
   23200 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004006,
   184000 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004008,
   188416 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004002,
   288768 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004009,
   471040 
   );
INSERT INTO bass1.dim_gprs_pkg_flow 
VALUES(
   90004003,
   721920 
   );
select count(0),count(distinct user_id)
		from bass2.dwd_product_sprom_active_20110301 a,
			 BASS1.dim_gprs_pkg_flow  b
		where a.sprom_id=b.prod_id
		  and replace(char(date(a.valid_date)),'-','')<='20110301'
		  and replace(char(date(a.expire_date)),'-','')>'20110301'
		  


  
  select * from BASS1.dim_gprs_pkg_flow 
  runstats on table bass1.dim_gprs_pkg_flow with distribution and detailed indexes all       
  
  
  
  drop table BASS1.t_gprs_prod_user;
CREATE TABLE BASS1.t_gprs_prod_user(
   user_id VARCHAR(20),
   prod_id INTEGER,
   valid_date TIMESTAMP,
   expire_date TIMESTAMP 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_prod_user
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into BASS1.t_gprs_prod_user
  select user_id,b.prod_id,a.valid_date,a.expire_date
		from bass2.dwd_product_sprom_active_20110301 a,
			 BASS1.dim_gprs_pkg_flow  b
		where a.sprom_id=b.prod_id
		  and replace(char(date(a.valid_date)),'-','')<='20110301'
		  and replace(char(date(a.expire_date)),'-','')>'20110301'		  

          
  
  select * from BASS1.t_gprs_prod_user
  where valid_date is null
  
  
  insert into  BASS1.t_gprs_prod_user2
select user_id,prod_id,valid_date
from  
(select a.*,row_number()over(PARTITION by user_id order by expire_date desc , valid_date desc  ) rn 
from 
BASS1.t_gprs_prod_user a
) t where t.rn = 1



  drop table BASS1.t_gprs_prod_user2;
CREATE TABLE BASS1.t_gprs_prod_user2(
   user_id VARCHAR(20),
   prod_id INTEGER,
   valid_date TIMESTAMP 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_prod_user2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
DROP TABLE BASS1.t_gprs_prod_user;
CREATE TABLE BASS1.t_gprs_prod_user(
   user_id VARCHAR(20),
   prod_id INTEGER,
   flow DECIMAL(12, 2),
   valid_date TIMESTAMP,
   expire_date TIMESTAMP 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_prod_user
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into BASS1.t_gprs_prod_user
  select user_id,b.prod_id,b.flow,a.valid_date,a.expire_date
		from bass2.dwd_product_sprom_active_20110301 a,
			 BASS1.dim_gprs_pkg_flow  b
		where a.sprom_id=b.prod_id
		  and replace(char(date(a.valid_date)),'-','')<='20110301'
		  and replace(char(date(a.expire_date)),'-','')>'20110301'		  


  
  drop table BASS1.t_gprs_prod_user2;
CREATE TABLE BASS1.t_gprs_prod_user2(
   user_id VARCHAR(20),
   prod_id INTEGER,
   flow DECIMAL(12, 2),
   valid_date TIMESTAMP 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_prod_user2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into  BASS1.t_gprs_prod_user2
select user_id,prod_id,valid_date
from  
(select a.*,row_number()over(PARTITION by user_id order by expire_date|| valid_date desc  ) rn 
BASS1.t_gprs_prod_user a
) t where t.rn = 1

 


insert into  BASS1.t_gprs_prod_user2
select user_id,prod_id,flow,valid_date
from  
(select a.*,row_number()over(PARTITION by user_id order by expire_date desc , valid_date desc   ) rn 
from 
BASS1.t_gprs_prod_user a
) t where t.rn = 1

 
 select sum(flow)/1024
from  BASS1.t_gprs_prod_user2


select * from    BASS1.t_gprs_prod_user2


 
 delete from BASS1.t_gprs_sum;
DROP TABLE BASS1.t_gprs_sum;
CREATE TABLE BASS1.t_gprs_sum(
   UP_FLOWS DECIMAL(12, 2),
   DOWN_FLOWS DECIMAL(12, 2),
   FREE_IS_PKG DECIMAL(12, 2),
   FREE_NOT_PKG DECIMAL(12, 2),
   NOT_FREE_NOT_PKG DECIMAL(12, 2) 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    UP_FLOWS 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_sum
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from  BASS1.t_gprs_sum 
  
  
  select 
                  sum(bigint(data_flow_up1+data_flow_up2))*1.0/1024/1024/1024   as up_flows
                  ,sum(bigint(data_flow_down1+data_flow_down2))*1.0/1024/1024/1024 as down_flows
                  ,sum(case when free_res_val1 is not null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_is_pkg
                  ,sum(case when free_res_val1 is  null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_not_pkg
                  ,sum( case when (charge1+charge2+charge3+charge4) > 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else  0 end
             ) not_free_not_pkg 
from  bass2.CDR_GPRS_LOCAL_20110322 a
left join BASS1.t_gprs_prod_user2 b on  a.user_id = b.user_id 
where  b.user_id is null 


select min(flow) from BASS1.t_gprs_prod_user2



 drop table BASS1.t_gprs_sum2;
CREATE TABLE BASS1.t_gprs_sum2(
   UP_FLOWS DECIMAL(12, 5),
   DOWN_FLOWS DECIMAL(12, 5),
   FREE_IS_PKG DECIMAL(12, 5),
   FREE_NOT_PKG DECIMAL(12, 5),
   NOT_FREE_NOT_PKG DECIMAL(12, 5) 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    UP_FLOWS 
 )USING HASHING;
ALTER TABLE BASS1.t_gprs_sum2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from t_gprs_sum
  
  
  select sum(UP_FLOWS+DOWN_FLOWS) all_flow
,sum(FREE_IS_PKG) FREE_IS_PKG
,sum(FREE_NOT_PKG) FREE_NOT_PKG
,sum(NOT_FREE_NOT_PKG) NOT_FREE_NOT_PKG
  from t_gprs_sum
  select sum(flow)/1024 from BASS1.t_gprs_prod_user2
  
  
  select flow,count(0)
  from  BASS1.t_gprs_prod_user2
  group by flow
  order by 1
  

select * from   BASS1.t_gprs_sum2
  
  
    
  
  select sum(UP_FLOWS+DOWN_FLOWS) all_flow
,sum(FREE_IS_PKG) FREE_IS_PKG
,sum(FREE_NOT_PKG) FREE_NOT_PKG
,sum(NOT_FREE_NOT_PKG) NOT_FREE_NOT_PKG
  from t_gprs_sum2

  
  
 select * from  bass2.DW_PRODUCT_BASS1_20110323
 
 
 dim_up_product_
 
 select * from   bass2.DIM_PROD_UP_PRODUCT_ITEM
 where platform_id = 2
 
 
 select count(0) from  bass2.DIM_PROD_UP_PRODUCT_ITEM
 where extend_id2 is not null 
 
 
  select count(0),count(distinct  from  bass2.DIM_PROD_UP_PRODUCT_ITEM
 where extend_id2 is not null 
 
 
 
 where name like '%全球通%'
 and name not like '%存%'
 and name not like '%积分%'
 and item_type = 'OFFER_PLAN'
 and extend_id is not null
 
 
  
 select * from  bass2.DIM_PROD_UP_PRODUCT_ITEM
 where name like '%尊享%'
 and item_type = 'OFFER_PLAN'
 
 
   
 select * from  bass2.DIM_PROD_UP_PRODUCT_ITEM
 where name like '%凤凰资讯%'
 
 
 
 
 and item_type = 'OFFER_PLAN'
SELECT * FROM G_S_04002_DAY WHERE TIME_ID = 20110321


 bass1.fn_get_all_dim
 
 select * from syscat.functions where funcname = 'FN_GET_ALL_DIM'
select * from 

BODY
CREATE FUNCTION BASS1.FN_GET_ALL_DIM(GID VARCHAR(20),DID VARCHAR(20)) RETURNS VARCHAR(10) DETERMINISTIC NO EXTERNAL ACTION LANGUAGE SQL BEGIN ATOMIC RETURN SELECT BASS1_VALUE FROM BASS1.ALL_DIM_LKP WHERE BASS1_TBID = GID AND XZBAS_VALUE = DID;
END

select count(0)
from  bass1.g_s_03004_month
where time_id = 201102
and ACCT_ITEM_ID in ('0626','0627')

dim_acct_item	eG3	80000508		BASS_STD1_0074	0626	GPRS
dim_acct_item	 	80000512		BASS_STD1_0074	0626	GPRS
dim_acct_item	 	80000513		BASS_STD1_0074	0627	GPRS


select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0114'


select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0074'
and bass1_value in ('0626','0627')

select c.*
from 
(
select user_id
from  bass1.g_s_03004_month
where time_id = 201103
and ACCT_ITEM_ID in ('0626','0627')
) a ,bass2.dw_product_201103 b 
, bass2.dwd_cust_msg_20110331 c 
where a.user_id = b.user_id 
and b.cust_id = c.cust_id


t_int_check_user_status

select * from    bass1.g_s_03004_month
select count(0)
from 
 bass1.td_check_user_mobile a ,
 t_int_check_user_status c 
 where a.PRODUCT_NO = c.PRODUCT_NO
select count(0) from   
G_S_03005_MONTH
where time_id = 201103
and ITEM_ID in ('0626','0627')

select b.*
from 
 bass1.td_check_user_mobile a ,
 t_int_check_user_status c ,
 (
select user_id
from  bass1.g_s_03004_month
where time_id = 201103
and ACCT_ITEM_ID in ('0626','0627')
) b , bass2.dwd_cust_msg_20110331 d
where a.product_no = c.product_no 
and c.user_id = b.user_id 

select * from  bass2.dwd_cust_msg_20110331 fetch first 10 rows only  
select count(0) from    t_int_check_user_status

select b.*
from 
 t_int_check_user_status c ,
 (
select user_id
from  bass1.g_s_03004_month
where time_id = 201103
and ACCT_ITEM_ID in ('0626','0627')
) b
where
 c.user_id = b.user_id 



declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp

--session临时表跑数慢，建实体表
drop table t_int_check_user_status
create table t_int_check_user_status like     session.int_check_user_status
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHINGdrop table t_int_check_user_status
create table t_int_check_user_status like     session.int_check_user_status
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING



--抓取用户资料入表
insert into t_int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110331 and SIM_CODE = '0') e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110331 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1



select count(0) from   bass1.td_check_user_mobile

select count(0)
from 
(
select product_no from t_int_check_user_status where usertype_id NOT IN ('2010','2020','2030','9000')
except 
select product_no from  bass1.td_check_user_mobile
)t



select  b.ITEM_ID, UPPER(item_name) ,count(0)     
                        from   bass2.dw_acct_shoulditem_201103 a , bass2.dim_acct_item b
                        where a.ITEM_ID = b.item_id 
                        and  UPPER(item_name) like '%GPRS%' 
group by    b.ITEM_ID, UPPER(item_name) 
order by 1,2

ITEM_ID	2	3
80000103	GPRS	30
80000634	E-GPRS	4011
80000663	M2M GPRS	18
80000664	M2M_GPRS(530M/)	18
                      

select  b.ITEM_ID, UPPER(item_name) ,count(0)     
                        from   bass2.dw_acct_shoulditem_201103 a , bass2.dim_acct_item b
                        where a.ITEM_ID = b.item_id 
                        AND  UPPER(item_name) like '%流量%'
group by    b.ITEM_ID, UPPER(item_name) 
order by 1,2

ITEM_ID	2	3
80000078		677714
80000104		187057
80000462	G3	206
80000531	G3	140



                        
                          a.item_id in (80000508,80000512,80000513) 
0626	GPRS	GPRS
0627	GPRS	GPRSGPRS
                          
                          
dim_acct_item	eG3	80000508		BASS_STD1_0074	0626	GPRS
dim_acct_item	 	80000512		BASS_STD1_0074	0626	GPRS
dim_acct_item	 	80000513		BASS_STD1_0074	0627	GPRS


select * from   bass2.dim_acct_item where UPPER(item_name) like '%GPRS%'
select count(0),count(distinct item_id ) from    bass2.dim_acct_item 


drop view t_gprs_03

create view t_gprs_03
as
select 
                  sum(bigint(data_flow_up1+data_flow_up2))*1.0/1024/1024/1024   as up_flows
                  ,sum(bigint(data_flow_down1+data_flow_down2))*1.0/1024/1024/1024 as down_flows
                  --
                  ,sum(case when free_res_val1 is not null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_is_pkg
                  ,sum(case when free_res_val1 is  null and (charge1+charge2+charge3+charge4) = 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else 0 end     ) free_not_pkg
             
                  ,sum( case when (charge1+charge2+charge3+charge4) > 0 then 
             bigint(data_flow_up1+data_flow_up2+data_flow_down1+data_flow_down2)*1.0/1024/1024/1024  else  0 end
             ) not_free_not_pkg 
from  bass2.CDR_GPRS_LOCAL_20110423 a,
BASS1.t_gprs_prod_user2 b 
where a.user_id = b.user_id 
 
 UP_FLOWS	DOWN_FLOWS	FREE_IS_PKG	FREE_NOT_PKG
40.15598522219	226.62631536461	128.06665484731	122.77105686100


 40.15598522219	226.62631536461	128.06665484731	122.77105686100
not_free_not_pkg
 15.94457482177
 
 
  
 select * from  bass1.g_i_02019_month 
 where OVER_PROD_AREA = '1'
 and OVER_PROD_NAME like '%阅读%'
 
 select * from  bass1.g_i_02018_month where base_prod_type = '113'
 
 
 
 select * from  bass2.dim_prod_up_plan_plan_rel
 
 
 
 WITH  tmp1 as (
 select 
		    a.product_item_id                         base_prod_id,
		    b.trademark
		from bass2.dim_prod_up_product_item a,
		  bass2.Dim_prod_up_offer b
		where a.item_type = 'OFFER_PLAN' 
		and b.offer_type in ('OFFER_PLAN')
		and a.product_item_id = b.offer_id
		and a.platform_id in (1,2)
) t
        
select * from  bass2.DW_ACCT_PAYMENT_DM_201103  fetch first 10 rows only          
select count(0),count(distinct PEER_SEQ) from    bass2.DW_ACCT_PAYMENT_DM_201103 
select * from   bass2.DW_ACCT_PAYMENT_DM_201103 where remarks like '%SP退费%'
select * from   bass2.DW_ACCT_PAYMENT_DM_201103 where upper(remarks) like '%SP%'



select replace(char(date(a.OP_TIME)),'-','')  time_id
,count(0) op_time
,sum(amount) back_cnt
from bass2.DW_ACCT_PAYMENT_DM_201103 a
where a.remarks like '%SP退费%'
group by replace(char(date(a.OP_TIME)),'-','')



select replace(char(date(a.OP_TIME)),'-','')  time_id
,count(0) back_cnt
,sum(amount) back_fee
from bass2.DW_ACCT_PAYMENT_DM_201103 a
where a.remarks like '%SP退费%'
and replace(char(date(a.OP_TIME)),'-','') = '20110330'
group by replace(char(date(a.OP_TIME)),'-','')




select replace(char(date(a.OP_TIME)),'-','')  time_id
,char(count(0)) back_cnt
,char(bigint(sum(amount))) back_fee
from bass2.DW_ACCT_PAYMENT_DM_201103 a
where a.remarks like '%SP退费%'
and replace(char(date(a.OP_TIME)),'-','') = '20110330'
group by replace(char(date(a.OP_TIME)),'-','')


select count(0),count(distinct sp_code ) from   bass2.DIM_NEWBUSI_SPINFO
select count(0),count(distinct serv_code ) from   bass2.DIM_NEWBUSI_SPINFO
select tabname from syscat.tables where tabname like  'VGOP%20110407%' 

select * from   bass2.VGOP_11201_20110407

VGOP_11201_20110407


select sum(bigint(free_point)) from   g_i_02006_month where time_id = 201103



select 
case 
     when a.crm_brand_id2=70 then '1' 
     else '0' 
    end
    ,count(0) cnt 
from  bass2.dw_product_bass1_20110401 a
,BASS1.t_gprs_prod_user2 b 
where a.user_id = b.user_id 
group by 
case 
     when a.crm_brand_id2=70 then '1' 
     else '0' 
    end
              
select product_no,b.flow
from  bass2.dw_product_bass1_20110401 a
,BASS1.t_gprs_prod_user2 b 
where a.user_id = b.user_id 
and  a.crm_brand_id2=70
group by 
case 
     when a.crm_brand_id2=70 then '1' 
     else '0' 
    end
              
              
db2 runstats on table bass1.t_gprs_prod_user2 with distribution and detailed indexes all    
db2 runstats on table  bass2.dw_product_bass1_20110401 with distribution and detailed indexes all    






CREATE TABLE BASS1.mon_interface_not_
 (
interface_code  char(5)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (interface_code) USING HASHING
   
  ALTER TABLE BASS1.mon_interface_not_empty
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
  
  
insert into BASS1.mon_interface_not_empty values 
 ('01002')
,('02004')
,('02008')
,('02011')
,('02014')
,('02015')
,('02016')
,('02018')
,('02019')
,('02020')
,('02021')
,('02047')
,('02049')
,('02050')
,('02052')
,('02053')
,('02063')
,('03001')
,('03002')
,('03004')
,('03005')
,('03013')
,('04002')
,('04004')
,('04005')
,('04006')
,('04007')
,('04008')
,('04011')
,('05001')
,('05002')
,('05003')
,('06021')
,('06022')
,('06023')
,('06011')
,('06012')
,('06029')
,('06031')
,('06032')
,('21001')
,('21002')
,('21007')
,('21003')
,('21008')
,('21011')
,('21012')
,('21013')
,('21014')
,('21015')
,('21020')
,('22012')
,('22013')
,('22038')
,('22039')
,('22032')
,('22033')
,('22035')
,('22052')
,('22070')
,('22073')
,('22061')
,('22062')
,('22063')
,('22064')
,('22065')
,('22049')
,('22050')
,('22055')
,('22056')
,('22101')
,('22102')
,('22103')
,('22104')
,('22105')
,('22201')
,('22202')
,('22203')
,('22080')
,('22081')
,('22082')
,('22083')
,('22084')
,('22085')
;
select * from bass1.MON_ALL_INTERFACE
where interface_code not in (
select  interface_code  from     BASS1.mon_interface_not_empty  
)


WITH TEST(NAME_TEST, BDAY_TEST) AS   
(   
VALUES ('张三','1997-7-1'),('李四','1949-10-1')   
)   
select * from test
SELECT NAME_TEST FROM TEST WHERE BDAY_TEST='1949-10-1'

CREATE TABLE BASS1.G_S_22084_DAY
 (
	 TIME_ID            	INTEGER             ----记录行号        
	,OP_TIME            	CHAR(8)             ----日期 主键       
	,BACK_CNT           	CHAR(12)            ----退费笔数        
	,BACK_FEE           	CHAR(12)            ----退费金额 单位：元
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22084_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
TBS_APP_BASS1


select * from   g_s_22009_month


select * from    bass2.dim_newbusi_spinfo
where serv_code > '0'
order by expire_date asc 


select * from    bass2.dim_newbusi_spinfo
where serv_code > '0'
and valid_date = expire_date
order by expire_date asc 


select * 
                                      from  bass2.dim_newbusi_spinfo a,
                                            bass2.dwd_product_regsp_20110425 b
                                       where bigint(b.sp_code)>0 
                                           and bigint(substr(replace(char(date(b.valid_date)),'-',''),1,6))=201103                               
                                           and bigint(a.sp_code)=bigint(b.sp_code)   
                                           

select a.*
from bass2.dim_newbusi_spinfo a 
left join (
  select b.EXTEND_ID2,a.cnt
  from 
(
select OFFER_ID,count(0) cnt
from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103
where valid_date < '2011-03-01' and expire_date >  '2011-03-01'
group by OFFER_ID
) a ,(
  	SELECT PRODUCT_ITEM_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
) b 
where a.OFFER_ID = b.PRODUCT_ITEM_ID
) b on a.serv_code = b.EXTEND_ID2
where serv_code > '0' and b.EXTEND_ID2 is null

                                           
                                           

--22085接口单元名称：收费争议先退费后查证月汇总 
CREATE TABLE BASS1.G_S_22085_MONTH
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,OP_TIME            	CHAR(6)             ----月份 主键       
	,BACK_SP_NAME       	CHAR(50)            ----退费SP企业名称 主键
	,BACK_SP_CODE       	CHAR(12)            ----SP企业代码 主键 
	,BACK_CNT           	CHAR(12)            ----退费笔数        
	,BACK_FEE           	CHAR(12)            ----当月退费总额 单位： 元
	,SP_ACT_INCOME      	CHAR(15)            ----当月SP实收账款 单位： 元
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,BACK_SP_NAME,BACK_SP_CODE
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22085_MONTH
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from    bass1.int_program_data
                                           
                                           
select * from         bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

select PROGRAM_TYPE , count(0) 
--,  count(distinct PROGRAM_TYPE ) 
from bass1.int_program_data 
group by  PROGRAM_TYPE 
order by 1 

                                           
                                           
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22085_MONTH.tcl' PROGRAM_NAME
,'G_S_22085_MONTH.BASS1' SOURCE_DATA
,'G_S_22085_MONTH_e' OBJECTIVE_DATA
,'G_S_22085_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

                                           
select * from    bass1.G_S_22085_MONTH
                                           
                                           
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22084_DAY.tcl' PROGRAM_NAME
,'G_S_22084_DAY.BASS1' SOURCE_DATA
,'G_S_22084_DAY_e' OBJECTIVE_DATA
,'G_S_22084_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'
                                           

select * from   bass1.G_S_22084_DAY

90001319
90001320
90001321
90001322
90001323
90001324
90001325


90001326
90001327
90001328

111090001319
111090001320
111090001321
111090001322
111090001323
111090001324
111090001325
111090001326
111090001327
111090001328


select BASE_PROD_ID,count(0) 
from    bass1.g_i_02020_month 
where BASE_PROD_ID
in
('111090001319'
,'111090001320'
,'111090001321'
,'111090001322'
,'111090001323'
,'111090001324'
,'111090001325'
,'111090001326'
,'111090001327'
,'111090001328')
group by BASE_PROD_ID

                                           
select offer_id,count(0)
from bass2.dw_product_ins_prod_201103 a 
where  offer_id
in
(111090001319
,111090001320
,111090001321
,111090001322
,111090001323
,111090001324
,111090001325
,111090001326
,111090001327
,111090001328)
group by offer_id

 select base_prod_id from bass1.g_i_02018_month 
 where  base_prod_id
in
(111090001319
,111090001320
,111090001321
,111090001322
,111090001323
,111090001324
,111090001325
,111090001326
,111090001327
,111090001328)

select offer_id,count(0)
from bass2.dw_product_ins_prod_ds a 
where  offer_id
in
(111090001319
,111090001320
,111090001321
,111090001322
,111090001323
,111090001324
,111090001325
,111090001326
,111090001327
,111090001328)
group by offer_id



CREATE TABLE BASS1.G_I_02022_DAY
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,USER_ID            	CHAR(20)            ----用户标识 主键   
	,BASE_PKG_ID        	CHAR(30)            ----基础套餐标识    
	,VALID_DT           	CHAR(8)             ----套餐生效日期     
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,USER_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_02022_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from   bass2.dw_product_ins_prod_ds

select * from   bass2.ODS_PRODUCT_INS_PROD_20110426



		select 
		     count(0)
		from bass2.dw_product_ins_prod_201103 a,
		    (
		    select product_instance_id user_id from bass2.dw_product_ins_prod_201103
		    where state in ('1','4','6','8','M','7','C','9')
		      and user_type_id =1
		      and valid_type = 1
		      and bill_id not in ('D15289014474','D15289014454')
		    except
		    select user_id from bass2.dw_product_test_phone_201103
		    where sts=1
		    ) b
		where a.product_instance_id=b.user_id
		  and a.state in ('1','4','6','8','M','7','C','9')
		  and a.user_type_id =1
		  and a.valid_type = 1
		  and a.bill_id not in ('D15289014474','D15289014454')

1598727

          
		select 
		     count(0)
		from bass2.dw_product_ins_prod_201103 a
		where  a.state in ('1','4','6','8','M','7','C','9')
		  and a.user_type_id =1
		  and a.valid_type = 1
		  and a.bill_id not in ('D15289014474','D15289014454')
          and not exists (select 1 from bass2.dw_product_test_phone_201103 b where a.product_instance_id = b.USER_ID  and b.sts = 1) 
1598726
          
select count(0) from   bass2.dw_product_test_phone_201103 
select count(0) from   bass2.dwd_product_test_phone_20110331
 
          
select * from    BASS1.ALL_DIM_LKP

CREATE TABLE "BASS1"."ALL_DIM_LKP"
 ("XZBAS_TBNAME"      VARCHAR(100),
  "XZBAS_COLNAME"     VARCHAR(100)    NOT NULL,
  "XZBAS_VALUE"       VARCHAR(100)    NOT NULL,
  "BASS1_TBN_DESC"    VARCHAR(100)    NOT NULL,
  "BASS1_TBID"        VARCHAR(100)    NOT NULL,
  "BASS1_VALUE"       VARCHAR(100)    NOT NULL,
  "BASS1_VALUE_DESC"  VARCHAR(100)
 )
  DATA CAPTURE NONE
 IN "TBS_APP_BASS1"
 INDEX IN "TBS_INDEX"
  PARTITIONING KEY
   (BASS1_TBID
   ) USING HASHING;
ALTER TABLE "BASS1"."ALL_DIM_LKP"
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from    bass2.DIM_PROD_UP_PRODUCT_ITEM 


insert into "BASS1"."ALL_DIM_LKP"
select 'bass2.DIM_PROD_UP_PRODUCT_ITEM' 
,a.name 
,char(bass2_id)
,'全球通全网统一资费基础套餐标识' 
,'BASS_STD1_0114'
,trim(bass1_id)
,trim(bass1_name)
from   bass2.DIM_PROD_UP_PRODUCT_ITEM a,
    table(
select 'W_QQT_JC_SW58		' bass1_id,'全球通全网统一资费上网套餐58元' bass1_name,						0				 bass2_id from bass2.dual union all
select 'W_QQT_JC_SW88		' bass1_id,'全球通全网统一资费上网套餐88元' bass1_name,	         0          bass2_id from bass2.dual union all
select 'W_QQT_JC_SW128		' bass1_id,'全球通全网统一资费上网套餐128元' bass1_name,	      0           bass2_id from bass2.dual union all
select 'W_QQT_JC_SL58		' bass1_id,'全球通全网统一资费商旅套餐58元' bass1_name,	111090001319       bass2_id from bass2.dual union all
select 'W_QQT_JC_SL88		' bass1_id,'全球通全网统一资费商旅套餐88元' bass1_name,	111090001320       bass2_id from bass2.dual union all
select 'W_QQT_JC_SL128		' bass1_id,'全球通全网统一资费商旅套餐128元' bass1_name,	111090001321     bass2_id from bass2.dual union all
select 'W_QQT_JC_SL158		' bass1_id,'全球通全网统一资费商旅套餐158元' bass1_name,	111090001322     bass2_id from bass2.dual union all
select 'W_QQT_JC_SL188		' bass1_id,'全球通全网统一资费商旅套餐188元' bass1_name,	111090001323     bass2_id from bass2.dual union all
select 'W_QQT_JC_SL288		' bass1_id,'全球通全网统一资费商旅套餐288元' bass1_name,	111090001324     bass2_id from bass2.dual union all
select 'W_QQT_JC_SL388		' bass1_id,'全球通全网统一资费商旅套餐388元' bass1_name,	111090001325     bass2_id from bass2.dual union all
select 'W_QQT_JC_SL588		' bass1_id,'全球通全网统一资费商旅套餐588元' bass1_name,	        0         bass2_id from bass2.dual union all
select 'W_QQT_JC_SL888		' bass1_id,'全球通全网统一资费商旅套餐888元' bass1_name,	          0       bass2_id from bass2.dual union all
select 'W_QQT_JC_BD58		' bass1_id,'全球通全网统一资费本地套餐58元' bass1_name,	111090001326       bass2_id from bass2.dual union all
select 'W_QQT_JC_BD88		' bass1_id,'全球通全网统一资费本地套餐88元' bass1_name,	111090001327       bass2_id from bass2.dual union all
select 'W_QQT_JC_BD128		' bass1_id,'全球通全网统一资费本地套餐128元' bass1_name,	111090001328     bass2_id from bass2.dual 
) t      where a.PRODUCT_ITEM_ID = t.bass2_id



select * from  bass1.all_dim_lkp
where BASS1_TBID = 'BASS_STD1_0114'

dim_acct_item		80000417		BASS_STD1_0114	0901	

select * 
from  bass1.all_dim_lkp
where BASS1_TBID = 'BASS_STD1_0114'
and XZBAS_TBNAME = 'dim_acct_item'

update  bass1.all_dim_lkp
set BASS1_TBID = 'BASS_STD1_0074'
where BASS1_TBID = 'BASS_STD1_0114'
and XZBAS_TBNAME = 'dim_acct_item'
select * from bass2.dim_acct_item where item_id = 80000417

select * from  bass1.all_dim_lkp
where BASS1_TBN_DESC = '全球通全网统一资费基础套餐标识' 

update  bass1.all_dim_lkp
set BASS1_VALUE = upper(BASS1_VALUE)
where BASS1_TBN_DESC = '全球通全网统一资费基础套餐标识' 

INSERT INTO bass1.all_dim_lkp
SELECT 'BASS2.DIM_PROD_UP_PRODUCT_ITEM' 
,A.NAME 
,CHAR(BASS2_ID)
,'全球通全网统一资费基础套餐标识' 
,'BASS_STD1_0114'
,TRIM(BASS1_ID)
,TRIM(BASS1_NAME)
FROM   BASS2.DIM_PROD_UP_PRODUCT_ITEM A,
    TABLE(
SELECT 'w_qqt_jc_sw58		' BASS1_ID,'全球通全网统一资费上网套餐58元' BASS1_NAME,						0				 BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sw88		' BASS1_ID,'全球通全网统一资费上网套餐88元' BASS1_NAME,	         0          BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sw128		' BASS1_ID,'全球通全网统一资费上网套餐128元' BASS1_NAME,	      0           BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl58		' BASS1_ID,'全球通全网统一资费商旅套餐58元' BASS1_NAME,	111090001319       BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl88		' BASS1_ID,'全球通全网统一资费商旅套餐88元' BASS1_NAME,	111090001320       BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl128		' BASS1_ID,'全球通全网统一资费商旅套餐128元' BASS1_NAME,	111090001321     BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl158		' BASS1_ID,'全球通全网统一资费商旅套餐158元' BASS1_NAME,	111090001322     BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl188		' BASS1_ID,'全球通全网统一资费商旅套餐188元' BASS1_NAME,	111090001323     BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl288		' BASS1_ID,'全球通全网统一资费商旅套餐288元' BASS1_NAME,	111090001324     BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl388		' BASS1_ID,'全球通全网统一资费商旅套餐388元' BASS1_NAME,	111090001325     BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl588		' BASS1_ID,'全球通全网统一资费商旅套餐588元' BASS1_NAME,	        0         BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_sl888		' BASS1_ID,'全球通全网统一资费商旅套餐888元' BASS1_NAME,	          0       BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_bd58		' BASS1_ID,'全球通全网统一资费本地套餐58元' BASS1_NAME,	111090001326       BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_bd88		' BASS1_ID,'全球通全网统一资费本地套餐88元' BASS1_NAME,	111090001327       BASS2_ID FROM BASS2.DUAL UNION ALL
SELECT 'w_qqt_jc_bd128		' BASS1_ID,'全球通全网统一资费本地套餐128元' BASS1_NAME,	111090001328     BASS2_ID FROM BASS2.DUAL 
) T      WHERE A.product_item_id = T.BASS2_ID


select 
		count(0),count(distinct product_instance_id)
	from  bass2.ODS_PRODUCT_INS_PROD_20110425 a
	where a.state in ('1','4','6','8','M','7','C','9')
	  and a.user_type_id =1
	  and a.valid_type = 1
	  and a.bill_id not in ('D15289014474','D15289014454')
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110425 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
			 ) 


select 
		20110425 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
		,replace(char(date(a.create_date)),'-','') VALID_DT
	from  bass2.ODS_PRODUCT_INS_PROD_20110425 a
	where a.state in ('1','4','6','8','M','7','C','9')
	  and a.user_type_id =1
	  and a.valid_type = 1
	  and a.bill_id not in ('D15289014474','D15289014454')
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110425 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
			 ) 
	  and bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) is not null 
      

select count(*) from 
	            (
		     select user_id from bass1.g_i_02022_day
		      where time_id =20110425
		       except
			  select user_id from bass2.dw_product_20110425
			    where usertype_id in (1,2,9) 
			    and userstatus_id in (1,2,3,6,8)
			    and test_mark<>1               
	            ) as a      
                

 select base_prod_id from bass1.g_i_02018_month 


select count(0)
from bass2.ODS_PRODUCT_INS_PROD_20110425 a
	where a.state in ('1','4','6','8','M','7','C','9')
	  and a.user_type_id =1
	  and a.valid_type = 1
	  and a.bill_id not in ('D15289014474','D15289014454')
group by product_instance_id having count(0) > 1

                
                


CREATE TABLE BASS1.G_I_77780_DAY_DOWN20110429
 (TIME_ID                char(1)         ,
  ENTERPRISE_ID          CHARACTER(20),
  ID                     CHARACTER(9),
  ENTERPRISE_NAME        CHARACTER(60),
  ORG_TYPE               CHARACTER(5),
  ADDR_CODE              CHARACTER(6),
  CITY                   CHARACTER(20),
  REGION                 CHARACTER(20),
  COUNTY                 CHARACTER(20),
  DOOR_NO                CHARACTER(60),
  AREA_CODE              CHARACTER(5),
  PHONE_NO1              CHARACTER(11),
  PHONE_NO2              CHARACTER(10),
  POST_CODE              CHARACTER(6),
  INDUSTRY_TYPE          CHARACTER(4),
  EMPLOYEE_CNT           CHARACTER(8),
  INDUSTRY_UNIT_CNT      CHARACTER(5),
  ECONOMIC_TYPE          CHARACTER(3),
  OPEN_YEAR              CHARACTER(4),
  OPEN_MONTH             CHARACTER(2),
  SHAREHOLDER            CHARACTER(1),
  GROUP_TYPE             CHARACTER(1),
  MANAGE_STYLE           CHARACTER(1),
  OPERATE_REVENUE_CLASS  CHARACTER(2),
  CAPITAL_CLASS          CHARACTER(2),
  INDUSTRY_CLASS_CODE    CHARACTER(2)    ,
  CUST_STATUS            CHARACTER(2),
  CUST_INFO_SRC_ID       CHARACTER(1),
  UPLOAD_TYPE_ID         CHARACTER(1)   
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110429
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_I_02022_DAY.tcl' PROGRAM_NAME
,'G_I_02022_DAY.BASS1' SOURCE_DATA
,'G_I_02022_DAY_e' OBJECTIVE_DATA
,'G_I_02022_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

select * from   BASS1.G_I_77780_DAY_DOWN20110427
where id in (             
select id  from     BASS1.G_I_77780_DAY_DOWN20110427
group by id having count(0) > 1
)

               

 select base_prod_id from bass1.g_i_02018_month 
 where  base_prod_id
in
('111090001319'
,'111090001320'
,'111090001321'
,'111090001322'
,'111090001323'
,'111090001324'
,'111090001325'
,'111090001326'
,'111090001327'
,'111090001328')



CREATE TABLE BASS1.G_I_02023_DAY
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,USER_ID            	CHAR(20)            ----用户标识 主键   
	,ADD_PKG_ID         	CHAR(30)            ----叠加套餐标识 主键
	,VALID_DT           	CHAR(8)             ----套餐生效日期      
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID,USER_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_02023_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_I_02023_DAY.tcl' PROGRAM_NAME
,'G_I_02023_DAY.BASS1' SOURCE_DATA
,'G_I_02023_DAY_e' OBJECTIVE_DATA
,'G_I_02023_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

replace(char(create_date),'-','')

select replace(char(date(create_date)),'-','') from   bass2.ODS_THREE_ITEM_STAT_20110426

select count(0) from    BASS2.ODS_PRODUCT_UNITE_CANCEL_ORDER_20110426

drop table BASS1.G_S_22080_DAY


CREATE TABLE BASS1.G_S_22080_DAY
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,OP_TIME            	CHAR(8)             ----日期 主键       
	,QRY_CNT            	CHAR(12)            ----查询量 单位：次 
	,CANCEL_CNT         	CHAR(12)            ----退订量 单位：次 
	,CANCEL_FAIL_CNT    	CHAR(12)            ----退订失败量 单位：次
	,COMPLAINT_CNT      	CHAR(12)            ----投诉量 单位：次 
	,CANCEL_BUSI_TYPE_CNT     	CHAR(12)            ----当天退订业务总数 单位：次 确认为业务的种数
--	,ALL_CANCEL_CNT     	CHAR(12)            ----当天退订业务总数 单位：次
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (TIME_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22080_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select      20110427 TIME_ID
             replace(char(date(a.create_date)),'-','') op_time
             ,a.TYCX_QUERY             qry_cnt
             ,a.TYCX_TUIDING           cancel_cnt
             ,a.TYCX_TUIDING_FAIL      cancel_fail_cnt
             ,a.TYCX_TOUSU_LIANG       complaint_cnt
             ,b.tuiding_cnt CANCEL_BUSI_TYPE_CNT
        from bass2.ODS_THREE_ITEM_STAT_20110427 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                       	BASS2.ODS_PRODUCT_UNITE_CANCEL_ORDER_$timestamp a
                        where a.sts = 1
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110427' 
				and    replace(char(date(a.create_date)),'-','') = b.op_time
                


select       20110426 TIME_ID
        from bass2.ODS_THREE_ITEM_STAT_20110426 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time
                ,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                       	BASS2.ODS_PRODUCT_UNITE_CANCEL_ORDER_$timestamp a
                        where a.sts = 1
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110426' 
				and    replace(char(date(a.create_date)),'-','') = b.op_time                
                
                
                

select       20110426 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,a.TYCX_QUERY             qry_cnt
             ,a.TYCX_TUIDING           cancel_cnt
             ,a.TYCX_TUIDING_FAIL      cancel_fail_cnt
             ,a.TYCX_TOUSU_LIANG       complaint_cnt
             ,b.CANCEL_BUSI_TYPE_CNT 				   CANCEL_BUSI_TYPE_CNT
        from bass2.ODS_THREE_ITEM_STAT_20110426 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                       	BASS2.ODS_PRODUCT_UNITE_CANCEL_ORDER_20110426 a
                        where a.sts = 1
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110426' 
				and    replace(char(date(a.create_date)),'-','') = b.op_time                
                

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22080_DAY.tcl' PROGRAM_NAME
,'G_S_22080_DAY.BASS1' SOURCE_DATA
,'G_S_22080_DAY_e' OBJECTIVE_DATA
,'G_S_22080_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'




                
select *   from bass1.G_S_22080_DAY where time_id=20110426


                
                

CREATE TABLE BASS1.G_S_22081_MONTH
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,OP_TIME            	CHAR(6)             ----月份 主健       
	,BUSI_CODE          	CHAR(20)            ----业务代码 主健   
	,BUSI_NAME          	CHAR(60)            ----业务名称 主健   
	,BUSI_PROVIDER_NAME 	CHAR(60)            ----业务提供商名称  
	,CANCEL_CNT         	CHAR(12)            ----成功退订量      
	,COMPLAINT_CNT      	CHAR(12)            ----投诉量          
	,ORDER_CNT          	CHAR(10)            ----订购用户数     
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22081_MONTH
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
DROP TABLE BASS1.G_S_22081_MONTH_1;
CREATE TABLE BASS1.G_S_22081_MONTH_1(
   BUSI_CODE VARCHAR(20) ,
   ORDER_CNT INTEGER 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    BUSI_CODE 
 )USING HASHING;
ALTER TABLE BASS1.G_S_22081_MONTH_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
set sql_buff "ALTER TABLE check_temp_02008_last ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE"

select * from   bass2.ODS_PRODUCT_SP_INFO_201103
select t.sp_code ,t.sp_name
from
(      
select a.sp_code ,a.sp_name
    ,row_number()over(partition by a.sp_code order by EXPIRE_DATE desc , VALID_DATE desc  ) rn 
from   bass2.ODS_PRODUCT_SP_INFO_201103 a
) t where t.rn = 1 

select count(0),count(distinct sp_code ) from        bass2.ODS_PRODUCT_SP_INFO_201103
     
     

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22081_MONTH.tcl' PROGRAM_NAME
,'G_S_22081_MONTH.BASS1' SOURCE_DATA
,'G_S_22081_MONTH_e' OBJECTIVE_DATA
,'G_S_22081_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'


    
select * from   BASS1.G_S_22081_MONTH_1
    
select * from   bass1.G_S_22081_MONTH 
where time_id = 201105
order by    bigint(CANCEL_CNT)  desc 
    
   
drop table BASS1.G_S_22081_MONTH_2;
CREATE TABLE BASS1.G_S_22081_MONTH_2(
   SP_CODE VARCHAR(20),
   SP_NAME VARCHAR(100) 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    SP_CODE 
 )USING HASHING;
ALTER TABLE BASS1.G_S_22081_MONTH_2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from  bass1.G_S_22081_MONTH
  
  
  
          select 
          201103 TIME_ID
          ,a.op_time
          ,a.BUSI_CODE
          ,a.BUSI_NAME
          ,a.BUSI_PROVIDER_NAME
          ,a.CANCEL_CNT
          ,a.COMPLAINT_CNT
          ,b.ORDER_CNT
        from (
                select   substr(replace(char(date(a.create_date)),'-',''),1,6) op_time
                         ,a.sp_code BUSI_CODE
                         ,a.name BUSI_NAME
                         ,b.sp_name BUSI_PROVIDER_NAME
                         ,sum(case when a.sts = 1 then 1 else 0 end ) CANCEL_CNT
                         ,'0' COMPLAINT_CNT
                         ,'0' ORDER_CNT
                         from  bass2.dw_product_unite_cancel_order_201103 a ,
                                BASS1.G_S_22081_MONTH_2 b 
                         where char(a.sp_id) = b.sp_code
                         group by substr(replace(char(date(a.create_date)),'-',''),1,6)
                          ,a.sp_code
                         ,a.name
                         ,b.sp_name 
             ) a ,
             BASS1.G_S_22081_MONTH_1 b 
        where a.BUSI_CODE = b.BUSI_CODE
        
        
select * from    bass2.ODS_PRODUCT_SP_INFO_201103

select * from    bass1.G_S_22081_MONTH


                select  OP_TIME||BUSI_CODE||BUSI_NAME, count(0)  cnt
                from bass1.G_S_22081_MONTH
                where time_id =201103
                group by OP_TIME||BUSI_CODE||BUSI_NAME having count(0) > 1
                
update   app.sch_control_alarm 
set   flag = 1
where control_code = 'BASS1_G_S_22081_MONTH.tcl'
            

select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
order by alarmtime desc 

select * from   bass1.G_S_22081_MONTH

select count(0),count(distinct BUSI_CODE ) from     BASS1.G_S_22081_MONTH_1
                
                
select count(0),count(distinct PRODUCT_ITEM_ID )
from 
		(
						SELECT PRODUCT_ITEM_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
								WHERE ITEM_TYPE='OFFER_PLAN'
						  AND DEL_FLAG='1'
						  AND SUPPLIER_ID IS NOT NULL
					) b 


select * from  BASS1.G_S_22081_MONTH_1
where busi_code in (
select busi_code from  BASS1.G_S_22081_MONTH_1
group by  busi_code having  count(0) >  1
)                   


select * from   bass2.DIM_PROD_UP_PRODUCT_ITEM


drop table BASS1.G_S_22081_MONTH_1;
CREATE TABLE BASS1.G_S_22081_MONTH_1(
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   ORDER_CNT INTEGER 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    BUSI_CODE 
 )USING HASHING;
ALTER TABLE BASS1.G_S_22081_MONTH_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select  OP_TIME||BUSI_CODE||BUSI_NAME, count(0)  cnt
                from bass1.G_S_22081_MONTH
                where time_id =201103
                group by OP_TIME||BUSI_CODE||BUSI_NAME having count(0) > 1
                

select * from    BASS1.G_S_22081_MONTH_1
  select count(0),count(distinct sp_id||BUSI_CODE ) from        bass1.G_S_22081_MONTH_1

select length(sp_id) ,count(0) from  bass1.G_S_22081_MONTH_1 
group by length(sp_id)



select sum(bigint(order_cnt)) from bass1.G_S_22081_MONTH
2042764

select count(0) from   bass1.G_S_22081_MONTH a
where a.order_cnt is null 

select sum(bigint(cancel_cnt)) from    bass1.G_S_22081_MONTH


select count(0) from    bass1.G_S_22081_MONTH


select * from  bass1.G_S_22081_MONTH_1
where busi_code in (
select busi_code  from    bass1.G_S_22081_MONTH 
where order_cnt is null 
)

select sum(bigint(cancel_cnt))  from    bass1.G_S_22081_MONTH 
where order_cnt is null 

update  bass1.G_S_22081_MONTH  a
set order_cnt = value((select char(b.ORDER_CNT) from  bass1.G_S_22081_MONTH_1 b where a.BUSI_CODE = b.BUSI_CODE),'0')
where a.order_cnt is null 



select * from   bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103

select count(0),count(distinct user_id ) from    
(select distinct user_id from bass2.dw_product_201103 where userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9) ) u
  
  
  select * from bass1.G_S_22080_DAY
  
  select 1500*30 from bass2.dual
  
  select count(0),count(distinct sms_id ) from   bass2.dw_product_unite_cancel_order_201103
  
  select * from bass2.dw_product_unite_cancel_order_201103
  
  
  
 
 
 select * from  bass1.G_S_22081_MONTH 
 where bigint(cancel_cnt) > bigint(order_cnt)
 
 
 
 
 select 
replace(char(date(a.create_date)),'-','')
,ext1 sp_id
,ext4 sp_busi_code
,count(0) alert_sms_cnt
,count(distinct case when trim(confirm_code) <>'是' and return_message is not null 
      then bill_id||RSP_SEQ||ext1||ext4 end ) reply_sms_cnt
,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
        then 1 else 0 end ) cancel_cnt
,0 hotline_out_cnt
,0 complaint_cnt
--,sum(case when return_message is null then 1 else 0 end ) null_cnt
from bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110427  a 
where  RSP_SEQ LIKE '10086901%' 
and  replace(char(date(a.create_date)),'-','') = '20110427' 
and ext4 is not null 
group by 
 replace(char(date(a.create_date)),'-','')
,ext1
,ext4



CREATE TABLE BASS1.G_S_22082_DAY
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,OP_TIME            	CHAR(8)             ----日期 主键       
	,BUSI_BILLING_TYPE  	CHAR (2)            ----业务计费类型 主键
	,ALERT_SMS_CNT      	CHAR(12)            ----扣费提醒发送量  
	,REPLY_SMS_CNT      	CHAR(12)            ----短信回复量      
	,CANCEL_CNT         	CHAR(12)            ----业务成功退订量  
	,HOTLINE_OUT_CNT    	CHAR(12)            ----热线外呼量 对于当月首次订购72小时免费的业务该项统一填0
	,COMPLAINT_CNT      	CHAR(12)            ----投诉量     	
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,BUSI_BILLING_TYPE
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22082_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
DROP TABLE BASS1.G_S_22082_DAY_1;
CREATE TABLE BASS1.G_S_22082_DAY_1(
   OP_TIME CHAR(8) ,
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   alert_sms_cnt INTEGER ,
   reply_sms_cnt INTEGER ,
   cancel_cnt INTEGER ,
   hotline_out_cnt INTEGER ,
   complaint_cnt INTEGER 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   BUSI_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22082_DAY_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from   bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110427
     where return_message = '否'
     select return_message from   bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110427
     where return_message like '%否%'
          

select replace('"a"b"c','"','') from bass2.dual


select count(0) from   bass2.ODS_PM_SP_OPERATOR_CODE_201103

select count(0),count(distinct char(OPERATOR_CODE)||char(SP_CODE) ) from    bass2.ODS_PM_SP_OPERATOR_CODE_201103



insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22082_DAY.tcl' PROGRAM_NAME
,'G_S_22082_DAY.BASS1' SOURCE_DATA
,'G_S_22082_DAY_e' OBJECTIVE_DATA
,'G_S_22082_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'




select * from    BASS1.G_S_22082_DAY_1

select count(0),count(distinct char(OPERATOR_CODE)||char(SP_CODE) )  from     bass2.ODS_PM_SP_OPERATOR_CODE_201103 a ,
bass1.G_S_22082_DAY_1 b where char(a.SP_CODE) = b.SP_ID and a.OPERATOR_CODE = b.BUSI_CODE

924	889

select a.* from     bass2.ODS_PM_SP_OPERATOR_CODE_201103 a ,
bass1.G_S_22082_DAY_1 b where char(a.SP_CODE) = b.SP_ID and a.OPERATOR_CODE = b.BUSI_CODE
select * from   
bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426



select char(OPERATOR_CODE)||char(SP_CODE) ,count(0)  from     bass2.ODS_PM_SP_OPERATOR_CODE_201103 a ,
bass1.G_S_22082_DAY_1 b where char(a.SP_CODE) = b.SP_ID and a.OPERATOR_CODE = b.BUSI_CODE
group by char(OPERATOR_CODE)||char(SP_CODE) having count(0) > 1


600902000001078458      600902              	2
600902000001132273      600902              	2


select * from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b 
 where 
 OPERATOR_CODE = '600902000001132273'
 and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 


select distinct char(a.SP_CODE),a.OPERATOR_CODE,delay_time  from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b ,
 bass1.G_S_22082_DAY_1 c 
 where char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 --and 
 --and OPERATOR_CODE = '600902000001132273'
 --and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 
 
 
 select count(0),count(distinct  char(a.SP_CODE)||a.OPERATOR_CODE)
 from (
 select distinct char(a.SP_CODE) SP_CODE,a.OPERATOR_CODE,delay_time  from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b ,
 bass1.G_S_22082_DAY_1 c 
 where char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 --and 
 --and OPERATOR_CODE = '600902000001132273'
 --and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 ) a 
 
 
 
 
 select count(0),char(a.SP_CODE)||a.OPERATOR_CODE
 from (
 select distinct char(a.SP_CODE) SP_CODE,a.OPERATOR_CODE,delay_time  from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b ,
 bass1.G_S_22082_DAY_1 c 
 where char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 --and 
 --and OPERATOR_CODE = '600902000001132273'
 --and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 ) a 
 group by char(a.SP_CODE)||a.OPERATOR_CODE
 having count(0) > 1
 
 
 2	901808              -UMGCSSQ
2	901808              -UMGFCSD
2	931001              -DZ217
2	931001              -DZ218
2	931002              -TQLS
2	931002              -TQRKZ
2	931002              -TQRKZDQ
2	931002              TQMF
2	931048              -BXGZ
2	931048              -XHKX
2	931048              -XHTY
2	931048              -XHXW



select * 
from (
 select distinct char(a.SP_CODE) SP_CODE,a.OPERATOR_CODE,delay_time  from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b ,
 bass1.G_S_22082_DAY_1 c 
 where char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 --and 
 --and OPERATOR_CODE = '600902000001132273'
 --and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 ) a where    char(a.SP_CODE)||a.OPERATOR_CODE in (
 select char(a.SP_CODE)||a.OPERATOR_CODE
 from (
 select distinct char(a.SP_CODE) SP_CODE,a.OPERATOR_CODE,delay_time  from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b ,
 bass1.G_S_22082_DAY_1 c 
 where char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 --and 
 --and OPERATOR_CODE = '600902000001132273'
 --and a.SP_CODE = 600902
 and a.sp_type = b.serv_type 
 ) a 
 group by char(a.SP_CODE)||a.OPERATOR_CODE
 having count(0) > 1
 )
 
 
 
 
 901808              	-UMGCSSQ	72

PM_SP_OPERATOR_CODE
 OPERATOR_CODE = '-UMGCSSQ'
 and a.SP_CODE = 901808

select * from   
 bass2.ODS_PM_SP_OPERATOR_CODE_201103 a,bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b 
 where 
 OPERATOR_CODE = '-UMGCSSQ'
 and a.SP_CODE = 901808
 and a.sp_type = b.serv_type 
 
 select * from  bass2.ODS_PM_SP_OPERATOR_CODE_201103
 

select SP_CODE,BUSI_CODE,delay_time,bill_flag
from (
 select distinct char(c.SP_ID) SP_CODE,c.BUSI_CODE,delay_time,a.bill_flag
 ,row_number()over(partition by c.SP_ID,c.BUSI_CODE order by  value(b.SP_CODE,0) asc) rn 
 from   bass1.G_S_22082_DAY_1 c 
 left join  bass2.ODS_PM_SP_OPERATOR_CODE_201103 a on  char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
 left join bass2.ODS_PM_SERV_TYPE_VS_EXPR_20110426 b on  a.sp_type = b.serv_type 
    ) a where a.rn = 1 
    


	drop table BASS1.G_S_22082_DAY_2;
CREATE TABLE BASS1.G_S_22082_DAY_2
	 (
		sp_id 			VARCHAR(20)
		,BUSI_CODE 	varchar(20)
		,DELAY_TIME              INTEGER(4) 
		,BILL_FLAG               SMALLINT(2)  
	 )
	  DATA CAPTURE NONE
	 IN TBS_APP_BASS1
	 INDEX IN TBS_INDEX
	  PARTITIONING KEY
	   (BUSI_CODE
	   ) USING HASHING;
ALTER TABLE BASS1.G_S_22082_DAY_2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
DROP TABLE BASS1.G_S_22082_DAY_2;
CREATE TABLE BASS1.G_S_22082_DAY_2(
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   DELAY_TIME INTEGER ,
   BILL_FLAG SMALLINT 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   sp_id,
   BUSI_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22082_DAY_2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from   BASS1.G_S_22082_DAY_2


select * from    bass1.G_S_22082_DAY

select * from   bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104


select * from syscat.tables where tabname like  '%HIS_DSMP_SMS_SEND_MESSAGE%'      

select trim(confirm_code) , trim(return_message)   from      
bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104 

select 
				ext1 sp_id
				,ext4 sp_busi_code
				,count(0) alert_sms_cnt
				,count(distinct case when trim(confirm_code) <>'是' 
					and return_message is not null 
				      then bill_id||RSP_SEQ||ext1||ext4 end ) reply_sms_cnt
				,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
					then 1 else 0 end ) cancel_cnt
				,0 hotline_out_cnt
				,0 complaint_cnt
				from  bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104  a 
				where  RSP_SEQ LIKE '10086901%' 
				and ext4 is not null 
                and   trim(confirm_code) = trim(return_message)  
				group by 
				 replace(char(date(a.create_date)),'-','')
				,ext1
				,ext4
			 with ur 



             

select ENTERPRISE_ID||ID||ENTERPRISE_NAME||ORG_TYPE||ADDR_CODE||CITY||REGION||COUNTY||DOOR_NO||AREA_CODE||PHONE_NO1||PHONE_NO2||POST_CODE||INDUSTRY_TYPE||EMPLOYEE_CNT||INDUSTRY_UNIT_CNT||ECONOMIC_TYPE||OPEN_YEAR||OPEN_MONTH||SHAREHOLDER||GROUP_TYPE||MANAGE_STYLE||OPERATE_REVENUE_CLASS||CAPITAL_CLASS||INDUSTRY_CLASS_CODE||CUST_STATUS||CUST_INFO_SRC_ID||UPLOAD_TYPE_ID from BASS1.G_I_77780_DAY where time_id=20101231

             

select * from   app.g_runlog where data_file like '%77780%'


select * from   bass2.DW_THREE_ITEM_STAT_DM_20110427

select * from   bass2.DW_THREE_ITEM_STAT_DM_201104
select * from   bass2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104


select * from syscat.tables where tabname like '%DW_PRODUCT_UNITE_CANCEL_ORDER_DM_%' 


select * from   G_S_22080_DAY
20110426	20110426	2378        	1469        	30          	0           	177         


select  replace(char(date(a.create_date)),'-','') op_time
                                                ,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                        BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104 a
                        where a.sts = 1
                        and replace(char(date(a.create_date)),'-','') =  '20110427'  
                        group by replace(char(date(a.create_date)),'-','')
                        
select * from    bass2.DW_THREE_ITEM_STAT_DM_201104

 select      20110427 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
            -- ,char(b.CANCEL_BUSI_TYPE_CNT)       CANCEL_BUSI_TYPE_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201104 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time
                                                ,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                        BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104 a
                        where a.sts = 1
                        and replace(char(date(a.create_date)),'-','') =  '20110427'  
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110427' 
                                and    replace(char(date(a.create_date)),'-','') = b.op_time

                                
                                

select 
         'dim_acct_item' XZBAS_TBNAME
        ,'数据流量月基本费' XZBAS_COLNAME
        ,'80000104' XZBAS_VALUE
        ,'帐目科目' BASS1_TBN_DESC
        ,'BASS_STD1_0074' BASS1_TBID
        ,'0626' BASS1_VALUE
        ,'GPRS套餐费' BASS1_VALUE_DESC
        from bass2.dim_acct_item a 
        where item_id = 80000104

                                
                                


insert into BASS1.ALL_DIM_LKP
(
         XZBAS_TBNAME
        ,XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
)
select 
         'dim_acct_item' XZBAS_TBNAME
        ,'G3上网卡超出套餐流量费' XZBAS_COLNAME
        ,'80000531' XZBAS_VALUE
        ,'帐目科目' BASS1_TBN_DESC
        ,'BASS_STD1_0074' BASS1_TBID
        ,'0627' BASS1_VALUE
        ,'GPRS通信费' BASS1_VALUE_DESC
        from bass2.dim_acct_item a 
        where item_id = 80000531
;

INSERT INTO BASS1.ALL_DIM_LKP(
   XZBAS_TBNAME,
   XZBAS_COLNAME,
   XZBAS_VALUE,
   BASS1_TBN_DESC,
   BASS1_TBID,
   BASS1_VALUE,
   BASS1_VALUE_DESC 
)
SELECT 'dim_acct_item' XZBAS_TBNAME,
   'G3上网本超出套餐流量费' XZBAS_COLNAME,
   '80000462' XZBAS_VALUE,
   '帐目科目' BASS1_TBN_DESC,
   'BASS_STD1_0074' BASS1_TBID,
   '0627' BASS1_VALUE,
   'GPRS通信费' BASS1_VALUE_DESC 
        FROM bass2.dim_acct_item a 
        WHERE item_id = 80000462
;

INSERT INTO BASS1.ALL_DIM_LKP(
   XZBAS_TBNAME,
   XZBAS_COLNAME,
   XZBAS_VALUE,
   BASS1_TBN_DESC,
   BASS1_TBID,
   BASS1_VALUE,
   BASS1_VALUE_DESC 
)
SELECT 'dim_acct_item' XZBAS_TBNAME,
   '超出套餐数据流量费' XZBAS_COLNAME,
   '80000078' XZBAS_VALUE,
   '帐目科目' BASS1_TBN_DESC,
   'BASS_STD1_0074' BASS1_TBID,
   '0627' BASS1_VALUE,
   'GPRS通信费' BASS1_VALUE_DESC 
        FROM bass2.dim_acct_item a 
        WHERE item_id = 80000078
;
insert into BASS1.ALL_DIM_LKP
(
         XZBAS_TBNAME
        ,XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
)
select 
         'dim_acct_item' XZBAS_TBNAME
        ,'数据流量月基本费' XZBAS_COLNAME
        ,'80000104' XZBAS_VALUE
        ,'帐目科目' BASS1_TBN_DESC
        ,'BASS_STD1_0074' BASS1_TBID
        ,'0626' BASS1_VALUE
        ,'GPRS套餐费' BASS1_VALUE_DESC
        from bass2.dim_acct_item a 
        where item_id = 80000104



select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0074'
and bass1_value in ('0626','0627')








select * from 
table (
select '00991399X' id ,       '89301560001719' ent_id,      '3'  type from bass2.dual union all
select '00991399X' id ,       '89308931002159' ent_id,      '1'  type from bass2.dual union all
select '219663597' id ,       '89403001180810' ent_id,      '2'  type from bass2.dual union all
select '219663597' id ,       '89401560001290' ent_id,      '1'  type from bass2.dual union all
select '433205933' id ,       '89403001180136' ent_id,      '2'  type from bass2.dual union all
select '433205933' id ,       '89401560000761' ent_id,      '1'  type from bass2.dual union all
select '433208683' id ,       '89403000939855' ent_id,      '2'  type from bass2.dual union all
select '433208683' id ,       '89403001062209' ent_id,      '1'  type from bass2.dual union all
select '71091507X' id ,       '89301560001340' ent_id,      '3'  type from bass2.dual union all
select '71091507X' id ,       '              ' ent_id,      '2'  type from bass2.dual union all
select '724901576' id ,       '89303001627014' ent_id,      '3'  type from bass2.dual union all
select '724901576' id ,       '89303000084579' ent_id,      '1'  type from bass2.dual union all
select '724903408' id ,       '89403001201978' ent_id,      '2'  type from bass2.dual union all
select '724903408' id ,       '89401560000346' ent_id,      '1'  type from bass2.dual union all
select '741930838' id ,       '89302999049682' ent_id,      '2'  type from bass2.dual union all
select '741930838' id ,       '89303001225874' ent_id,      '1'  type from bass2.dual union all
select 'DX0908507' id ,       '89401560001112' ent_id,      '1'  type from bass2.dual union all
select 'DX0908507' id ,       '89403001395933' ent_id,      '2'  type from bass2.dual union all
select 'DX0915539' id ,       '89403001180125' ent_id,      '2'  type from bass2.dual union all
select 'DX0915539' id ,       '89403001424049' ent_id,      '1'  type from bass2.dual union all
select 'DX0927142' id ,       '89403001395728' ent_id,      '2'  type from bass2.dual union all
select 'DX0927142' id ,       '89403000162592' ent_id,      '1'  type from bass2.dual union all
select 'DX0932398' id ,       '89401560000442' ent_id,      '1'  type from bass2.dual union all
select 'DX0932398' id ,       '89403001180944' ent_id,      '2'  type from bass2.dual union all
select 'K39846332' id ,       '89303001232669' ent_id,      '3'  type from bass2.dual union all
select 'K39846332' id ,       '89302999633984' ent_id,      '1'  type from bass2.dual union all
select 'XZLZK0043' id ,       '89103001051734' ent_id,      '2'  type from bass2.dual union all
select 'XZLZK0043' id ,       '89102999829280' ent_id,      '1'  type from bass2.dual union all
select 'XZLZK0044' id ,       '89102999086604' ent_id,      '1'  type from bass2.dual union all
select 'XZLZK0044' id ,       '89103001061802' ent_id,      '2'  type from bass2.dual
) t , 

                                
                                

select sum(bigint(FEE_RECEIVABLE)) from  G_S_03004_MONTH where time_id = 201103
and ACCT_ITEM_ID in ('0627','0626')


61351903

G_S_03004_MONTH_b20110429

select sum(bigint(FEE_RECEIVABLE)) from  G_S_03004_MONTH_b20110429 where time_id = 201103
and ACCT_ITEM_ID in ('0627','0626')
7374500
select sum(bigint(FEE_RECEIVABLE)) from  G_S_03004_MONTH where time_id = 201103
and ACCT_ITEM_ID in ('0627','0626')
527107179                                
                                

select sum(bigint(FEE_RECEIVABLE)) from  G_S_03004_MONTH_b20110429 where time_id = 201103
and ACCT_ITEM_ID in ('0627','0626')
                   7374500
                   
select * from  bass2.dim_acct_item  where item_id in (80000027,80000032,80000033,80000101)


select count(0) from   bass2.ODS_THREE_ITEM_STAT_20110428
select op_time,count(0) from   bass2.DW_THREE_ITEM_STAT_DM_201104
group by op_time


select replace(char(date(a.create_date)),'-',''),count(0) from   bass2.DW_THREE_ITEM_STAT_DM_201104 a
group by replace(char(date(a.create_date)),'-','')


select      20110428 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
             --,char(b.CANCEL_BUSI_TYPE_CNT)       CANCEL_BUSI_TYPE_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201104 a
         where replace(char(date(a.create_date)),'-','') = '20110428' 
         

select      20110428 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
             ,char(b.CANCEL_BUSI_TYPE_CNT)       CANCEL_BUSI_TYPE_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201104 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time
                                                ,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                        BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104 a
                        where a.sts = 1
                        and replace(char(date(a.create_date)),'-','') =  '20110428'  
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110428' 
                                and    replace(char(date(a.create_date)),'-','') = b.op_time
                                
                                
                                
select 
         OP_TIME
        ,TYCX_QUERY
        ,TYCX_TUIDING
        ,TYCX_TUIDING_FAIL
        ,TYCX_TUIDING_AVG
        --,TYCX_FIRST20_BUSI_NAME
        ,TYCX_TOUSU_LIANG
        ,KOUFEI_TIXING
        ,KOUFEI_DXHFL
        ,KOUFEI_REXWH
        ,KOUFEI_TUIDINGL
        --,KOUFEI_TDFIRST20_NAME
        ,KOUFEI_TOUSU_LIAN
        ,MW_SHOULILIANG
        ,MW_TUIFEI
        --,MW_ZYFIRST20_NAME
        ,CREATE_DATE
from 
 bass2.DW_THREE_ITEM_STAT_DM_201104
order by    OP_TIME desc , CREATE_DATE desc 


select  replace(char(date(a.create_date)),'-','')
,count(0)
from  bass2.DW_THREE_ITEM_STAT_DM_201104 a
group by  replace(char(date(a.create_date)),'-','')

select * from 
bass2.ODS_THREE_ITEM_STAT_DM_20110428

select * from syscat.tables where tabname like '%THREE_ITEM_STAT%' 


select * from   bass2.ODS_THREE_ITEM_STAT_20110428



select  replace(char(date(a.create_date)),'-','')
,count(0)
from  bass2.ODS_THREE_ITEM_STAT_20110428 a
group by  replace(char(date(a.create_date)),'-','')



select * from   app.sch_control_task where 


select count(0) from    bass2.ODS_THREE_ITEM_STAT_20110428

select count(0) from    bass2.ODS_THREE_ITEM_STAT_DM_20110428


select 
        TYCX_QUERY
        ,TYCX_TUIDING
        ,TYCX_TUIDING_FAIL
        ,TYCX_TUIDING_AVG
        --,TYCX_FIRST20_BUSI_NAME
        ,TYCX_TOUSU_LIANG
        ,KOUFEI_TIXING
        ,KOUFEI_DXHFL
        ,KOUFEI_REXWH
        ,KOUFEI_TUIDINGL
        --,KOUFEI_TDFIRST20_NAME
        ,KOUFEI_TOUSU_LIAN
        ,MW_SHOULILIANG
        ,MW_TUIFEI
        --,MW_ZYFIRST20_NAME
        ,CREATE_DATE
from   bass2.ODS_THREE_ITEM_STAT_20110428 
order by CREATE_DATE desc





select  replace(char(date(a.create_date)),'-','') op_time
                                                ,count(distinct a.sp_code) CANCEL_BUSI_TYPE_CNT
                       from   
                        BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104 a
                        where a.sts = 1
                        and replace(char(date(a.create_date)),'-','') =  '20110428'  
                        group by replace(char(date(a.create_date)),'-','')
                        
                        


select count(0) from    bass2.ODS_PRODUCT_SP_INFO_201103

select count(0) from    bass2.DW_PRODUCT_SP_INFO_201103

select * from   G_S_22081_MONTH
                        
                        


select op_time,count(0)
from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104
group by op_time
                        
select * from   bass2.Dim_pm_sp_operator_code

select count(0) from     BASS1.G_S_22082_DAY_1

select count(0) from    BASS1.G_S_22082_DAY_2

select count(0) from     BASS1.G_S_22082_DAY_1
select count(0) from    bass1.G_S_22082_DAY
select * from    bass1.G_S_22082_DAY
CREATE TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
 (TIME_ID                char(1)         ,
  PROV_ID          CHARACTER(5), 
  ENTERPRISE_ID          CHARACTER(20),
  USER_ID                     CHARACTER(20),
  SNAP_INCOME        INTEGER
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    USER_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
drop table  BASS1.G_I_77780_DAY_SNAP_DOWN20110429
CREATE TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
 (TIME_ID                char(1)         ,
  op_time							char(6),
  PROV_ID          CHARACTER(5), 
  ENTERPRISE_ID          CHARACTER(20),
  USER_ID                     CHARACTER(20),
  SNAP_INCOME        INTEGER
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    USER_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from    bass1.G_I_77780_DAY_SNAP_DOWN20110429

                       
CREATE TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
 (TIME_ID                char(1)         ,
  op_time							char(6),
  PROV_ID          CHARACTER(5), 
  ENTERPRISE_ID          CHARACTER(20),
  USER_ID                     CHARACTER(20),
  SNAP_INCOME        decimal(10,2)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (ENTERPRISE_ID,
    USER_ID
   ) USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_SNAP_DOWN20110429
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from   bass2.dw_product_ins_prod_201103
                       
                       

select count(0) from    bass2.ODS_PRODUCT_INS_PROD_20110428

select * from   bass2.Dw_product_ins_off_ins_prod_ds


select count(0) from    bass2.Dw_product_ins_off_ins_prod_ds
                      
select count(0) from     bass2.ods_product_ins_off_ins_prod_20110428       


                      
                      
select * from   bass2.dim_prod_up_product_item
where                       


  SELECT * FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
      and   extend_id in(90001363, 90001364, 90001365, 90001366, 90001367, 90001368 )
	  WITH UR;
insert into "BASS1"."ALL_DIM_LKP"
values
('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属短信包','111090001363','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_DX0001','全球通全网统一资费套餐专属数据包-短信包')
,('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属彩信包','111090001364','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_CX0001','全球通全网统一资费套餐专属数据包-彩信包')
,('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属尊享包','111090001365','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_ZX0001','全球通全网统一资费套餐专属数据包-全球通尊享包')
,('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属阅读包','111090001366','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_YD0001','全球通全网统一资费套餐专属数据包-全球通阅读包')
,('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属音乐包','111090001367','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_YY0001','全球通全网统一资费套餐专属数据包-全球通音乐包')
,('bass2.DIM_PROD_UP_PRODUCT_ITEM','全球通专属凤凰资讯包','111090001368','全球通全网统一资费专属叠加资费套餐标识','BASS_STD1_0114','QW_QQT_DJ_FHZX0001','全球通全网统一资费套餐专属数据包-全球通凤凰资讯包')


select * from   "BASS1"."ALL_DIM_LKP"
where BASS1_TBID in ('BASS_STD1_0114','BASS_STD1_0115')
     
update  "BASS1"."ALL_DIM_LKP"
set BASS1_TBID = 'BASS_STD1_0115'
where bass1_value like 'QW_QQT_DJ%'     

select * from    "BASS1"."ALL_DIM_LKP"
where xzbas_value = '80000418'

select * from   "BASS1"."ALL_DIM_LKP"
where BASS1_TBID in ('BASS_STD1_0074')

select * from   "BASS1"."ALL_DIM_LKP"
where xzbas_tbname like '%dim_acct_item%'
select CREATE_DATE,VALID_DATE from   bass2.Dw_product_ins_off_ins_prod_ds
where CREATE_DATE=VALID_DATE 



select count(0) from   bass2.Dw_product_ins_off_ins_prod_ds
where CREATE_DATE=VALID_DATE 




insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_I_02023_DAY.tcl' PROGRAM_NAME
,'G_I_02023_DAY.BASS1' SOURCE_DATA
,'G_I_02023_DAY_e' OBJECTIVE_DATA
,'G_I_02023_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'




select * from   bass1.g_i_02023_day


        select 
                count(0)
                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                ,                bass2.dw_product_20110428 b
                    where b.usertype_id in (1,2,9) 
                    and b.userstatus_id in (1,2,3,6,8)
                    and b.test_mark<>1
                          and a.OP_TIME = '2011-04-28'
                          and a.state=1
                    and date(a.VALID_DATE)<='2011-04-28'
                    and a.valid_type = 1
                    and bass1.fn_get_all_dim('BASS_STD1_0115',char(a.offer_id)) is not null 
                    and a.PRODUCT_INSTANCE_ID = b.user_id 


select * from   bass1.g_i_02023_day
                   


select * from syscat.tables where lower(tabname) like '%w_product_ins_off_ins_prod_ds%'

create index session.idx_region_flag on  session.region_flag(user_id)

drop index idx_ins_off_ins_prod_ds
create index idx_ins_off_ins_prod_ds   on bass2.Dw_product_ins_off_ins_prod_ds (PRODUCT_INSTANCE_ID)
                  
                  

	drop table BASS1.G_I_02023_DAY_1;
CREATE TABLE BASS1.G_I_02023_DAY_1(
   USER_ID CHAR(20) ----用户标识 主键  
   ,
   ADD_PKG_ID CHAR(30) ----叠加套餐标识 主键
   ,
   VALID_DT CHAR(8) ----套餐生效日期      
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   USER_ID 
)USING HASHING;
ALTER TABLE BASS1.G_I_02023_DAY_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from                   
 BASS1.ALL_DIM_LKP


db2 runstats on table BASS1.ALL_DIM_LKP with distribution and detailed indexes all            


select * from    bass2.Dw_product_ins_off_ins_prod_ds 
                  
                  
                        select 
                                USER_ID
                                ,ADD_PKG_ID
                                ,VALID_DT
                        FROM (
                                SELECT
                                 a.PRODUCT_INSTANCE_ID as USER_ID
                                ,bass1.fn_get_all_dim('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
                                ,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
                                ,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     where a.offer_id = 112094500001 
                                     and a.valid_type = 1 
                                     and a.state=1
                                 and a.OP_TIME = '2011-04-28'
                                 and date(a.VALID_DATE)<='2011-04-28'
                            ) AS T where t.rn = 1 
                         with ur 

select * from 
bass2.dim_prod_up_product_item 
 where extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
and item_type='OFFER_PLAN'

                         
                         
                         
                         
RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110430BAK;
CREATE TABLE BASS2.DIM_TERM_TAC(
   ID INTEGER,
   TAC_NUM VARCHAR(15),
   TERM_ID VARCHAR(10),
   TERM_MODEL VARCHAR(50),
   TERMPROD_ID VARCHAR(10),
   TERMPROD_NAME VARCHAR(200),
   NET_TYPE CHARACTER(1),
   TERM_TYPE CHARACTER(1) 
)DATA CAPTURE NONE 
 IN TBS_DIM PARTITIONING KEY(
    ID 
 )USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from  BASS2.DIM_TERM_TAC

RENAME TABLE BASS2.DIM_TERM_TAC_20110430BAK TO DIM_TERM_TAC2;
drop table BASS2.DIM_TERM_TAC
RENAME TABLE BASS2.DIM_TERM_TAC2 TO DIM_TERM_TAC;
select * from bass2.DIM_TERM_TAC



drop table BASS2.DIM_TERM_TAC_0430
CREATE TABLE BASS2.DIM_TERM_TAC_0430
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_0430
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110430BAK;
CREATE TABLE BASS2.DIM_TERM_TAC(
   ID INTEGER,
   TAC_NUM VARCHAR(15),
   TERM_ID VARCHAR(10),
   TERM_MODEL VARCHAR(50),
   TERMPROD_ID VARCHAR(10),
   TERMPROD_NAME VARCHAR(200),
   NET_TYPE CHARACTER(1),
   TERM_TYPE CHARACTER(1) 
)DATA CAPTURE NONE 
 IN TBS_DIM PARTITIONING KEY(
    ID 
 )USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_0430

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110430BAK
where net_type <>'2';
COMMIT;
select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110331BAK
group by tac_nuM
having count(*)>1


select count(0) from   BASS2.DIM_TERM_TAC_20110430BAK
                        
select count(0) from   BASS2.DIM_TERM_TAC
select count(0),count(distinct tac_num) from      BASS2.DIM_TERM_TAC


select * from app.sch_control_task where 
control_code in (select  control_code from   app.sch_control_runlog where flag= 1)

select  control_code from   app.sch_control_runlog where flag= 1


select time_id,count(0) from   bass1.g_a_02004_day 
group by time_id 

select product_no,count(0),count(distinct user_id) from   bass1.g_a_02004_day 
where time_id = 20110429
group by PRODUCT_NO 

select product_no,count(0) from   bass1.g_a_02004_day 
where time_id = 20110429
group by PRODUCT_NO having count(0) > 1


select user_id,count(0) from   bass1.g_a_02004_day 
where time_id = 20110429
group by user_id having count(0) > 1

select count(0),count(distinct a.product_no),count(distinct b.user_id) from   bass1.g_a_02004_day a
, bass1.g_a_02008_day b 
where a.time_id = 20110429
and b.time_id = 20110429
and a.user_id = b.user_id 


select count(0),count(distinct a.product_no),count(distinct a.user_id) from   bass1.g_a_02004_day a
where a.time_id = 20110428

select count(0),count(distinct a.product_no),count(distinct b.user_id) from   bass1.g_a_02004_day a
, bass1.g_a_02008_day b 
where a.time_id = 20110428
and b.time_id = 20110428
and a.user_id = b.user_id 



select * from G_S_22302_DAY

select count(0),count(distinct enterprise_id) from G_S_22302_DAY where time_id in (20110423,20110424)

select * from BASS1.MON_ALL_INTERFACE a where a.INTERFACE_CODE = '04008'

 
 select * from  app.sch_control_before where control_code = 'BASS1_INT_CHECK_Z345_DAY.tcl'
 select * from  app.sch_control_before where before_control_code = 'BASS1_INT_CHECK_Z345_DAY.tcl'
 BASS1_INT_CHECK_Z345_DAY.tcl	int -s INT_CHECK_Z345_DAY.tcl	2	R022	2011-04-27 3:09:29.549279	[NULL]	-1	[NULL]
BASS1_INT_CHECK_Z345_DAY.tcl	int -s INT_CHECK_Z345_DAY.tcl	2	R021	2011-04-27 3:07:10.948531	[NULL]	-1	[NULL]

select * from   BASS1.G_RULE_CHECK  where rule_code in ('R021')
and time_id > 20110401

select * from   BASS1.G_RULE_CHECK  where rule_code in ('R021')
and time_id > 20110401


select * from   BASS1.G_RULE_CHECK  where rule_code in ('R021')
and time_id > 20110401
20110426	R021	929980.00000	953866.00000	-0.02504	0.00000
20110425	R021	953866.00000	954734.00000	-0.00090	0.00000

select * from   BASS1.G_RULE_CHECK  where rule_code in ('R022')
and time_id in (20110425,20110426)


20110426	R022	373681.00000	386079.00000	-0.03211	0.00000
20110425	R022	386079.00000	388145.00000	-0.00532	0.00000

select count(0) from   g_a_02004_day where time_id = 20110426

select count(0) from   g_a_02008_day where time_id = 20110426



R159_2
select * from   BASS1.G_RULE_CHECK  where rule_code in ('R159_1')
ORDER BY 1 DESC 

and time_id in (20110425,20110426)

select * from   BASS1.G_RULE_CHECK  where rule_code in ('C1')
and time_id > 20110425

20110428	C1	2155029.00000	1990225.00000	0.08281	0.00000
20110427	C1	1990225.00000	1987809.00000	0.00122	0.00000
20110426	C1	1987809.00000	2017461.00000	-0.01470	0.00000

                        
select * from   bass1.G_S_22080_DAY


select * from    bass1.G_S_22081_MONTH 
                        
select * from    BASS1.G_I_02023_DAY_1
select * from   g_i_02022_day
                       

select * from    bass1.G_S_22082_DAY

select * from   bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104

select count(0) from   bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110429



select op_time,count(0) from   bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104                       
group by op_time


	drop table BASS1.G_S_22083_MONTH_1;
CREATE TABLE BASS1.G_S_22083_MONTH_1(
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   cancel_cnt INTEGER ,
   complaint_cnt INTEGER 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   sp_id,
   BUSI_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22083_MONTH_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22083_MONTH.tcl' PROGRAM_NAME
,'G_S_22083_MONTH.BASS1' SOURCE_DATA
,'G_S_22083_MONTH_e' OBJECTIVE_DATA
,'G_S_22083_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'




CREATE TABLE BASS1.G_S_22083_MONTH
 (
	 TIME_ID            	INTEGER             ----数据日期        
	,OP_TIME            	CHAR(6)             ----月份 主健       
	,BUSI_CODE          	CHAR(20)            ----业务代码 主健   
	,BUSI_NAME          	CHAR(60)            ----业务名称 主健   
	,BUSI_PROVIDER_NAME 	CHAR(60)            ----业务提供商名称  
	,BUSI_BILLING_TYPE  	CHAR (2)            ----业务计费类型    
	,CANCEL_CNT         	CHAR(12)            ----成功退订量      
	,COMPLAINT_CNT      	CHAR(12)            ----投诉量          
	,ORDER_CNT          	CHAR(10)            ----订购用户数    
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,BUSI_CODE,BUSI_NAME
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22083_MONTH
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
CREATE TABLE bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201103 LIKE bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104
 IN TBS_ODS_OTHER INDEX 
IN tbs_index partitioning KEY(
   done_code 
)USING hashing 
NOT logged initially;
select * from   bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201103

insert into bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201103
select date(create_date),
                DONE_CODE,
                BILL_ID,
                RSP_SEQ,
                MESSAGE_TYPE,
                SRCTYPE,
                OPTCODE,
                CREATE_DATE,
                FLAG,
                SEND_DATE,
                MSP_END_DATE,
                DONE_DATE,
                CONFIRM_TYPE,
                CONFIRM_CODE,
                RETURN_MESSAGE,
                RETURN_DATE,
                EXTEND_SEQ,
                EXT1,
                EXT2,
                EXT3,
                EXT4
from bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110429 a 
where  date(create_date) between '2011-03-01' and '2011-03-31'
                

select * from   BASS1.G_S_22083_MONTH_1
     

	drop table BASS1.G_S_22083_MONTH_2;
CREATE TABLE BASS1.G_S_22083_MONTH_2(
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   DELAY_TIME INTEGER ,
   BILL_FLAG SMALLINT 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   sp_id,
   BUSI_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22083_MONTH_2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from   bass2.DIM_PM_SP_OPERATOR_CODE

      
select * from    bass2.DW_PRODUCT_SP_INFO_201103


select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104 
group by  op_time 
order by 1 




insert into bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201104
select date(create_date),
                DONE_CODE,
                BILL_ID,
                RSP_SEQ,
                MESSAGE_TYPE,
                SRCTYPE,
                OPTCODE,
                CREATE_DATE,
                FLAG,
                SEND_DATE,
                MSP_END_DATE,
                DONE_DATE,
                CONFIRM_TYPE,
                CONFIRM_CODE,
                RETURN_MESSAGE,
                RETURN_DATE,
                EXTEND_SEQ,
                EXT1,
                EXT2,
                EXT3,
                EXT4
from bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110429 a 
where  date(create_date) between '2011-04-01' and '2011-04-26'
                


  select count(0),count(distinct  from  bass2.DIM_PROD_UP_PRODUCT_ITEM
 where extend_id2 is not null                 
 

select * from   bass2.ODS_DIM_UP_SP_SERVICE_20110428
select count(0),count(distinct OPERATOR_CODE ||SP_CODE) from      bass2.ODS_DIM_UP_SP_SERVICE_20110428
where state = 'A'


 bass2.ODS_DIM_UP_SP_SERVICE_20110428
 
select * from syscat.tables where tabname like '%DIM_UP_SP_SERVICE%' 
 
 
 select STATE , count(0) 
--,  count(distinct STATE ) 
from bass2.ODS_DIM_UP_SP_SERVICE_20110428 
group by  STATE 
order by 1 



select DEL_FLAG , count(0) 
--,  count(distinct DEL_FLAG ) 
from bass2.ODS_DIM_UP_SP_SERVICE_20110428 
group by  DEL_FLAG 
order by 1 




select * from      bass2.ODS_DIM_UP_SP_SERVICE_20110428
where state = 'E'

select  SP_CODE,OPERATOR_CODE,OPERATOR_NAME
from
(
select SP_CODE,OPERATOR_CODE,OPERATOR_NAME,row_number()over(partition by SP_CODE,OPERATOR_CODE 
    order by EXPIRE_DATE desc , VALID_DATE desc ) rn 
from  bass2.ODS_DIM_UP_SP_SERVICE_20110428 a
) t where t.rn = 1



drop table BASS1.G_S_22083_MONTH_3;
CREATE TABLE BASS1.G_S_22083_MONTH_3(
   SP_CODE VARCHAR(20),
   SP_NAME VARCHAR(100) 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   SP_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22083_MONTH_3
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from    bass1.G_S_22083_MONTH_3
      
      
select * from    BASS1.G_S_22083_MONTH_2
      
      
select * from    BASS1.G_S_22083_MONTH_1

select * from    bass1.G_S_22083_MONTH
      
      

select valid_date,sum(order_cnt)
from (
                                                select valid_date,OFFER_ID,count(0)  order_cnt
                                                from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 p ,
                                                (select distinct user_id from bass2.dw_product_201103
                                                        where userstatus_id in (1,2,3,6,8)
                                                and usertype_id in (1,2,9) 
                                        ) u
                                                where valid_date < '2011-03-01' and expire_date >  '2011-03-01'
                                                and p.PRODUCT_INSTANCE_ID = u.user_id
                                                group by valid_date,OFFER_ID
                                        ) a ,
                                        (
                                                SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                                WHERE ITEM_TYPE='OFFER_PLAN'
                                                  AND DEL_FLAG='1'
                                                  AND SUPPLIER_ID IS NOT NULL
                                        ) b 
                                where a.OFFER_ID = b.PRODUCT_ITEM_ID
                                and valid_date >= '2010-10-01'
group by      valid_date
                           





select valid_date,sum(order_cnt)
from (
                                                select valid_date,OFFER_ID,count(0)  order_cnt
                                                from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 p ,
                                                (select distinct user_id from bass2.dw_product_201103
                                                        where userstatus_id in (1,2,3,6,8)
                                                and usertype_id in (1,2,9) 
                                        ) u
                                                where valid_date < '2011-03-01' and expire_date >  '2011-03-01'
                                                and p.PRODUCT_INSTANCE_ID = u.user_id
                                                group by valid_date,OFFER_ID
                                        ) a ,
                                        (
                                                SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                                WHERE ITEM_TYPE='OFFER_PLAN'
                                                  AND DEL_FLAG='1'
                                                  AND SUPPLIER_ID IS NOT NULL
                                        ) b 
                                where a.OFFER_ID = b.PRODUCT_ITEM_ID
                                and valid_date = '2010-10-01'
group by      valid_date
                           




select OFFER_ID,valid_date,expire_date,CREATE_DATE
                                                from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103
                                                
                        
select (days('2011-04-05') - days('2011-03-01')) from bass2.dual

                        
select                              days(valid_date)  - days(CREATE_DATE)
,count(0)
from (
                        select OFFER_ID,valid_date,expire_date,CREATE_DATE
                        from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 p ,
                        (select distinct user_id from bass2.dw_product_201103
                                where userstatus_id in (1,2,3,6,8)
                        and usertype_id in (1,2,9) 
                ) u
                        where valid_date < expire_date and expire_date > date(current timestamp)
                        and p.PRODUCT_INSTANCE_ID = u.user_id
                ) a ,
                (
                        SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                        WHERE ITEM_TYPE='OFFER_PLAN'
                          AND DEL_FLAG='1'
                          AND SUPPLIER_ID IS NOT NULL
                ) b 
        where a.OFFER_ID = b.PRODUCT_ITEM_ID
        
group by    days(valid_date)  - days(CREATE_DATE)
order by 2 desc  
        
select a.*
from (
                        select OFFER_ID,valid_date,expire_date,CREATE_DATE
                        from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 p ,
                        (select distinct user_id from bass2.dw_product_201103
                                where userstatus_id in (1,2,3,6,8)
                        and usertype_id in (1,2,9) 
                ) u
                        where valid_date < expire_date and expire_date > date(current timestamp)
                        and p.PRODUCT_INSTANCE_ID = u.user_id
                ) a ,
                (
                        SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                        WHERE ITEM_TYPE='OFFER_PLAN'
                          AND DEL_FLAG='1'
                          AND SUPPLIER_ID IS NOT NULL
                ) b 
        where a.OFFER_ID = b.PRODUCT_ITEM_ID
and     days(valid_date)  - days(CREATE_DATE) <> 0
    

	drop table BASS1.G_S_22083_MONTH_4;
CREATE TABLE BASS1.G_S_22083_MONTH_4(
   sp_id VARCHAR(20) ,
   BUSI_CODE VARCHAR(20) ,
   ORDER_CNT INTEGER 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   BUSI_CODE 
)USING HASHING;
ALTER TABLE BASS1.G_S_22083_MONTH_4
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from   BASS1.G_S_22083_MONTH_4
    
select count(0) from    bass1.G_S_22083_MONTH_1
select count(0) from    bass1.G_S_22083_MONTH_2

select count(0) from    
BASS1.G_S_22083_MONTH_3

select * from   bass1.G_S_22083_MONTH
(select distict SP_CODE,OPERATOR_CODE from       
bass2.ODS_DIM_UP_SP_SERVICE_20110429    )



    
         
         

(select distinct SP_CODE,OPERATOR_CODE from       
bass2.ODS_DIM_UP_SP_SERVICE_20110429    ) c

(
						SELECT distinct SUPPLIER_ID SP_CODE,EXTEND_ID2 OPERATOR_CODE ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
								WHERE ITEM_TYPE='OFFER_PLAN'
						  AND DEL_FLAG='1'
						  AND SUPPLIER_ID IS NOT NULL
                          ) c
                          
select      a.*,b.*
                        from   bass1.G_S_22083_MONTH_1 a 
                               join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
                join (
						SELECT distinct SUPPLIER_ID SP_CODE,EXTEND_ID2 OPERATOR_CODE ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
								WHERE ITEM_TYPE='OFFER_PLAN'
						  AND DEL_FLAG='1'
						  AND SUPPLIER_ID IS NOT NULL
                          ) c   on  a.SP_ID = c.SP_CODE and a.BUSI_CODE = c.OPERATOR_CODE
                                JOIN BASS1.G_S_22083_MONTH_3 D ON a.sp_id = d.SP_CODE
                                left join BASS1.G_S_22083_MONTH_4 e on a.sp_id = e.SP_ID and a.BUSI_CODE = b.BUSI_CODE
                        group by 
                     a.BUSI_CODE
                     ,c.OPERATOR_NAME 
                     ,d.SP_NAME
                     ,case when b.bill_flag = 3 and DELAY_TIME = 72 then '11' 
                                when b.bill_flag = 3 and b.DELAY_TIME = 0 then '12'
                                                                else '20' end   

                                                                

select      a.*,b.*
                        from   bass1.G_S_22083_MONTH_1 a 
                               join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
               left  join (
						SELECT distinct SUPPLIER_ID SP_CODE,EXTEND_ID2 OPERATOR_CODE ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
								WHERE ITEM_TYPE='OFFER_PLAN'
						  AND DEL_FLAG='1'
						  AND SUPPLIER_ID IS NOT NULL
                          ) c   on  a.SP_ID = c.SP_CODE and a.BUSI_CODE = c.OPERATOR_CODE
where c.OPERATOR_CODE is null


select * from   bass2.DIM_PM_SP_OPERATOR_CODE


select * from    bass1.G_S_22083_MONTH


select * from

select * from product.up_product_item where extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )

select * from product.up_product_item where extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )

  SELECT * FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
WHERE ITEM_TYPE='OFFER_PLAN'
and ( extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
or extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )

      )
     

bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001363		BASS_STD1_0114	QW_QQT_DJ_DX0001	-			
bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001364		BASS_STD1_0114	QW_QQT_DJ_CX0001	-			
bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001365		BASS_STD1_0114	QW_QQT_DJ_ZX0001	-			
bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001366		BASS_STD1_0114	QW_QQT_DJ_YD0001	-			
bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001367		BASS_STD1_0114	QW_QQT_DJ_YY0001	-			
bass2.DIM_PROD_UP_PRODUCT_ITEM		111090001368		BASS_STD1_0114	QW_QQT_DJ_FHZX0001	-			



select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0114'



  SELECT 'bass2.DIM_PROD_UP_PRODUCT_ITEM' bas_tb,a.name ,a.PRODUCT_ITEM_ID
  ,'全球通全网统一资费基础套餐标识' bass1_name
  ,'BASS_STD1_0114'
  ,'' bass1_id
  ,'' bass1_name
  FROM bass2.DIM_PROD_UP_PRODUCT_ITEM a
WHERE ITEM_TYPE='OFFER_PLAN'
and ( extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
or extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )

      )
     
     

QW_QQT_JC_SW58	58
QW_QQT_JC_SW88	88
QW_QQT_JC_SW128	128
QW_QQT_JC_SL58	58
QW_QQT_JC_SL88	88
QW_QQT_JC_SL128	128
QW_QQT_JC_SL158	158
QW_QQT_JC_SL188	188
QW_QQT_JC_SL288	288
QW_QQT_JC_SL388	388
QW_QQT_JC_SL588	588
QW_QQT_JC_SL888	888
QW_QQT_JC_BD58	58
QW_QQT_JC_BD88	88
QW_QQT_JC_BD128	128
     

select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0114'

delete from  BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0114'

insert into   BASS1.ALL_DIM_LKP     
select a.*,t.b from  (
  SELECT 'bass2.DIM_PROD_UP_PRODUCT_ITEM' bas_tb,a.name ,char(a.PRODUCT_ITEM_ID)
  ,'全球通全网统一资费基础套餐标识' bass1_name
  ,'BASS_STD1_0114'
  ,
case 
when name like '%上网%128%' then 'QW_QQT_JC_SW128'
when name like '%上网%88%' then 'QW_QQT_JC_SW88'
when name like '%上网%58%' then 'QW_QQT_JC_SW58'
when name like '%本地%128%' then 'QW_QQT_JC_BD128'
when name like '%本地%88%' then 'QW_QQT_JC_BD88'
when name like '%本地%58%' then 'QW_QQT_JC_BD58'
--
when name like '%商旅%888%' then 'QW_QQT_JC_SL888'
when name like '%商旅%588%' then 'QW_QQT_JC_SL588'
when name like '%商旅%388%' then 'QW_QQT_JC_SL388'
when name like '%商旅%288%' then 'QW_QQT_JC_SL288'
when name like '%商旅%188%' then 'QW_QQT_JC_SL188'
when name like '%商旅%158%' then 'QW_QQT_JC_SL158'
when name like '%商旅%128%' then 'QW_QQT_JC_SL128'
when name like '%商旅%88%' then 'QW_QQT_JC_SL88'
when name like '%商旅%58%' then 'QW_QQT_JC_SL58'
end 
  bass1_id
  FROM bass2.DIM_PROD_UP_PRODUCT_ITEM a
WHERE ITEM_TYPE='OFFER_PLAN'
and ( extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
or extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )
)  
) a,
      table (
select 'QW_QQT_JC_SW58' a ,'全球通全网统一资费上网套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_SW88' a ,'全球通全网统一资费上网套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_SW128' a ,'全球通全网统一资费上网套餐128元' b from  bass2.dual union all
select 'QW_QQT_JC_SL58' a ,'全球通全网统一资费商旅套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_SL88' a ,'全球通全网统一资费商旅套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_SL128' a ,'全球通全网统一资费商旅套餐128元' b from  bass2.dual union all
select 'QW_QQT_JC_SL158' a ,'全球通全网统一资费商旅套餐158元' b from  bass2.dual union all
select 'QW_QQT_JC_SL188' a ,'全球通全网统一资费商旅套餐188元' b from  bass2.dual union all
select 'QW_QQT_JC_SL288' a ,'全球通全网统一资费商旅套餐288元' b from  bass2.dual union all
select 'QW_QQT_JC_SL388' a ,'全球通全网统一资费商旅套餐388元' b from  bass2.dual union all
select 'QW_QQT_JC_SL588' a ,'全球通全网统一资费商旅套餐588元' b from  bass2.dual union all
select 'QW_QQT_JC_SL888' a ,'全球通全网统一资费商旅套餐888元' b from  bass2.dual union all
select 'QW_QQT_JC_BD58' a ,'全球通全网统一资费本地套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_BD88' a ,'全球通全网统一资费本地套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_BD128' a ,'全球通全网统一资费本地套餐128元' b from  bass2.dual ) t where a.bass1_id = t.a
     
     

select * from   bass1.g_i_02022_day


        select 
                20110429 TIME_ID
                ,char(a.product_instance_id)  USER_ID
                ,bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
                ,replace(char(date(a.create_date)),'-','') VALID_DT
        from  bass2.ODS_PRODUCT_INS_PROD_20110429 a
where bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) is not null 



        select 
                20110429 TIME_ID ,offer_id
                ,char(a.product_instance_id)  USER_ID
                ,bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
                ,replace(char(date(a.create_date)),'-','') VALID_DT
        from  bass2.ODS_PRODUCT_INS_PROD_20110429 a
where    a.offer_id in (  select   PRODUCT_ITEM_ID
  FROM bass2.DIM_PROD_UP_PRODUCT_ITEM a
WHERE ITEM_TYPE='OFFER_PLAN'
and ( extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
or extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )
)  )


select * from   bass1.G_S_22080_DAY

select count(0) from    bass1.g_i_02022_day
where time_id = 20110531

select count(0) from    bass1.g_i_02022_day
where time_id = 20110531

select count(0) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'


select count(0) from    bass1.g_i_02023_day


select * from   app.sch_control_map


select MODULE , count(0) 
--,  count(distinct MODULE ) 
from app.sch_control_map 
group by  MODULE 
order by 1 



insert into app.sch_control_map
values
 (2,'G_I_02022_DAY.tcl','BASS1_G_I_02022_DAY.tcl')
,(2,'G_I_02023_DAY.tcl','BASS1_G_I_02023_DAY.tcl')
,(2,'G_S_22080_DAY.tcl','BASS1_G_S_22080_DAY.tcl')
,(2,'G_S_22081_MONTH.tcl','BASS1_G_S_22081_MONTH.tcl')
,(2,'G_S_22082_DAY.tcl','BASS1_G_S_22082_DAY.tcl')
,(2,'G_S_22083_MONTH.tcl','BASS1_G_S_22083_MONTH.tcl')
,(2,'G_S_22084_DAY.tcl','BASS1_G_S_22084_DAY.tcl')
,(2,'G_S_22085_MONTH.tcl','BASS1_G_S_22085_MONTH.tcl')


insert into app.sch_control_map
values
(2,'EXP_G_I_02022_DAY','BASS1_EXP_G_I_02022_DAY')
,(2,'EXP_G_I_02023_DAY','BASS1_EXP_G_I_02023_DAY')
,(2,'EXP_G_S_22080_DAY','BASS1_EXP_G_S_22080_DAY')
,(2,'EXP_G_S_22081_MONTH','BASS1_EXP_G_S_22081_MONTH')
,(2,'EXP_G_S_22082_DAY','BASS1_EXP_G_S_22082_DAY')
,(2,'EXP_G_S_22083_MONTH','BASS1_EXP_G_S_22083_MONTH')
,(2,'EXP_G_S_22084_DAY','BASS1_EXP_G_S_22084_DAY')
,(2,'EXP_G_S_22085_MONTH','BASS1_EXP_G_S_22085_MONTH')


select upper(control_code) from app.sch_control_task where upper(control_code) like '%ODS_PRODUCT_INS_PROD_%' 
	or upper(control_code) like '%ALL_DIM_LKP%' 
	or upper(control_code) like '%DWD_PRODUCT_TEST_PHONE_%' 
	or upper(control_code) like '%DW_PRODUCT_%' 
	or upper(control_code) like '%DW_PRODUCT_INS_OFF_INS_PROD_DS%' 
	or upper(control_code) like '%ALL_DIM_LKP%' 
	or upper(control_code) like '%DW_PRODUCT_%' 
	or upper(control_code) like '%DW_THREE_ITEM_STAT_DM_%' 
	or upper(control_code) like '%DW_PRODUCT_UNITE_CANCEL_ORDER_DM_%' 	
	or upper(control_code) like '%DW_PRODUCT_INS_OFF_INS_PROD_%' 
	or upper(control_code) like '%DW_PRODUCT_%' 
	or upper(control_code) like '%DIM_PROD_UP_PRODUCT_ITEM%' 
	or upper(control_code) like '%DW_PRODUCT_SP_INFO_%' 
	or upper(control_code) like '%DW_PRODUCT_UNITE_CANCEL_ORDER_%' 
	or upper(control_code) like '%DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_%' 
	or upper(control_code) like '%DIM_PM_SP_OPERATOR_CODE%' 
	or upper(control_code) like '%DIM_PM_SERV_TYPE_VS_EXPR%' 
	or upper(control_code) like '%DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_%' 
	or upper(control_code) like '%DIM_PM_SP_OPERATOR_CODE%' 
	or upper(control_code) like '%DIM_PM_SERV_TYPE_VS_EXPR%' 
	or upper(control_code) like '%DW_PRODUCT_SP_INFO_%' 
	or upper(control_code) like '%DW_PRODUCT_INS_OFF_INS_PROD_%' 
	or upper(control_code) like '%DW_PRODUCT_%' 
	or upper(control_code) like '%DIM_PROD_UP_PRODUCT_ITEM%' 
	or upper(control_code) like '%ODS_DIM_UP_SP_SERVICE_%' 


\

select control_code from app.sch_control_task where lower(control_code) like '%dw_three_item_stat_dm_%' 

select control_code, CMD_LINE from app.sch_control_task 
WHERE lower(CMD_LINE)   like '%dw_acct_payment_dm_%' 
CONTROL_CODE
BASS2_Dw_acct_payment_dm.tcl



select count(0),count(distinct b),count(distinct c)
from (
select trim(a) a,trim(b) b,trim(c) c from 
table 
(
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ins_prod_ds.tcl ' b,' ods_product_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dwd_product_test_phone_ds.tcl ' b,' dwd_product_test_phone_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ds.tcl ' b,' dw_product_ins_off_ins_prod_ds  ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_three_item_stat_dm.tcl ' b,' dw_three_item_stat_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' bass2 ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' dw_product_unite_cancel_order_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code  ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' TR1_L_18009 ' b,' ods_dim_up_sp_service_  ' c from bass2.dual ) t
) a 





insert into app.sch_control_before
select trim(a) a,trim(b) b from 
table 
(
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ins_prod_ds.tcl ' b,' ods_product_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dwd_product_test_phone_ds.tcl ' b,' dwd_product_test_phone_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ds.tcl ' b,' dw_product_ins_off_ins_prod_ds  ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_three_item_stat_dm.tcl ' b,' dw_three_item_stat_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' bass2 ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' dw_product_unite_cancel_order_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code  ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' TR1_L_18009 ' b,' ods_dim_up_sp_service_  ' c from bass2.dual ) t





insert into app.sch_control_before
select replace('BASS1_EXP'||substr(trim(a),6),'.tcl','') b ,trim(a) a from 
table 
(
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ins_prod_ds.tcl ' b,' ods_product_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dwd_product_test_phone_ds.tcl ' b,' dwd_product_test_phone_ ' c from bass2.dual union all
select ' BASS1_G_I_02022_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ds.tcl ' b,' dw_product_ins_off_ins_prod_ds  ' c from bass2.dual union all
select ' BASS1_G_I_02023_DAY.tcl ' a,' BASS2_Dw_product_ds.tcl ' b,' dw_product_ ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_three_item_stat_dm.tcl ' b,' dw_three_item_stat_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22080_DAY.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' bass2 ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_ ' c from bass2.dual union all
select ' BASS1_G_S_22081_MONTH.tcl ' a,' BASS2_Dw_product_unite_cancel_order_dm.tcl ' b,' dw_product_unite_cancel_order_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_ ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code  ' c from bass2.dual union all
select ' BASS1_G_S_22082_DAY.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_his_dsmp_sms_send_message_dm.tcl ' b,' dw_his_dsmp_sms_send_message_dm_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_sp_operator_code_ms.tcl ' b,' dim_pm_sp_operator_code ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_pm_serv_type_vs_expr_ds.tcl ' b,' dim_pm_serv_type_vs_expr  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_sp_info_ms.tcl ' b,' dw_product_sp_info_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ins_off_ins_prod_ms.tcl ' b,' dw_product_ins_off_ins_prod_ ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dw_product_ms.tcl ' b,' dw_product_  ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' BASS2_Dim_prod_up_product_item_ds.tcl ' b,' dim_prod_up_product_item ' c from bass2.dual union all
select ' BASS1_G_S_22083_MONTH.tcl ' a,' TR1_L_18009 ' b,' ods_dim_up_sp_service_  ' c from bass2.dual ) t


select * from 
app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1 

select * from app.sch_control_alarm 
update app.sch_control_alarm 
set flag = 1 
where flag = -1 
and  alarmtime >=  current timestamp - 1 days

select * from app.sch_control_before
where control_code in( 'BASS1_G_S_22084_DAY.tcl','BASS1_G_S_22085_MONTH.tcl')



insert into app.sch_control_before values('BASS1_EXP_G_S_22084_DAY','BASS1_G_S_22084_DAY.tcl');
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_EXP_G_S_22085_MONTH',
   'BASS1_G_S_22085_MONTH.tcl' 
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22084_DAY.tcl',
   'BASS2_Dw_acct_payment_dm.tcl' 
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22085_MONTH.tcl',
   'BASS2_Dw_acct_payment_dm.tcl' 
   );
select * from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'



select count(0),count(distinct control_code ) from    app.sch_control_task

select * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)


select distinct * from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)



select  control_code,before_control_code , count(0) from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)
group by control_code,before_control_code having count(0) > 1




delete from  app.sch_control_before 
where control_code||before_control_code  in (
select  control_code||before_control_code 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)
group by control_code,before_control_code having count(0) > 1
)




select * from  app.sch_control_before 
where control_code||before_control_code  in (
select  control_code||before_control_code 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)
group by control_code,before_control_code having count(0) > 1
)




select * from  app.sch_control_before 
where control_code||before_control_code  in (
select  control_code||before_control_code from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)
group by control_code,before_control_code having count(0) > 1
)


delete from  app.sch_control_before 
where control_code||before_control_code  in (
select  control_code||before_control_code from app.sch_control_before 
where control_code in (
select control_code from app.sch_control_task where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
)
group by control_code,before_control_code having count(0) > 1
)


insert into  app.sch_control_before 
values ('BASS1_EXP_G_I_02022_DAY','BASS1_G_I_02022_DAY.tcl')
,('BASS1_EXP_G_I_02023_DAY','BASS1_G_I_02023_DAY.tcl')
,('BASS1_EXP_G_S_22080_DAY','BASS1_G_S_22080_DAY.tcl')
,('BASS1_EXP_G_S_22081_MONTH','BASS1_G_S_22081_MONTH.tcl')
,('BASS1_EXP_G_S_22082_DAY','BASS1_G_S_22082_DAY.tcl')
,('BASS1_EXP_G_S_22083_MONTH','BASS1_G_S_22083_MONTH.tcl')





select * from app.g_unit_info
where UNIT_CODE in 
(
 '22080'
,'22082'
,'22084'
,'22085'
,'22081'
,'02023'
,'22083'
,'02022'
)



select count(0) from   BASS2.dw_acct_payment_dm_201103
 WHERE opt_code='4158' AND state= '0'
 
 select * from  bass2.ETL_LOAD_TABLE_MAP
 
 
 
 select * from  bass2.DIM_PM_SP_OPERATOR_CODE



 
 select * from user_list
 
 
 
 
 sele
 
 select * from  bass2.DW_ACCT_BOOK_201104
 
 
 select TABNAME,CREATE_TIME from syscat.tables where tabname like 'ODS%201105'
   
   SELECT MAX(TABLE_ID) FROM bass2.USYS_TABLE_MAINTAIN
select * from   bass2.USYS_TABLE_MAINTAIN
where 
 where table_name like '%PM_SP_OPERATOR_CODE%'
 
 select * from  bass2.ODS_PM_SP_OPERATOR_CODE_20110430
 
 
 select * from  app.sch_control_task where control_code = 'TR1_L_11042'
 
 TR1_L_11042	2	2	ODS_PM_SP_OPERATOR_CODE_YYYYMMDD	0	-1	SP	-	TR1_BOSS	2	-

UPDATE  app.sch_control_task
set cmd_line = 'ODS_PM_SP_OPERATOR_CODE_YYYYMM'
where control_code = 'TR1_L_11042'
1 row(s) affected.


 select * from  bass2.ETL_LOAD_TABLE_MAP  where TABLE_NAME_TEMPLET like '%SP_OPERATOR_CODE%'
 
 M11042	ODS_PM_SP_OPERATOR_CODE_YYYYMM	SP	0	NGCP.PM_SP_OPERATOR_CODE

select * from   bass2.USYS_TABLE_MAINTAIN where TABLE_NAME like '%SP_OPERATOR_CODE%'


alter table bass2.ODS_PM_SP_OPERATOR_CODE_YYYYMM add column OPERATOR_NAME varchar(256)


TABNAME
DIM_PM_SP_OPERATOR_CODE
ODS_PM_SP_OPERATOR_CODE_201103
ODS_PM_SP_OPERATOR_CODE_20110426
ODS_PM_SP_OPERATOR_CODE_20110427
ODS_PM_SP_OPERATOR_CODE_20110428
ODS_PM_SP_OPERATOR_CODE_20110429
ODS_PM_SP_OPERATOR_CODE_20110430
ODS_PM_SP_OPERATOR_CODE_YYYYMMDD


select * from   bass2.ODS_PM_SP_OPERATOR_CODE_201103

CREATE TABLE BASS2   .ODS_PM_SP_OPERATOR_CODE_YYYYMM  (
                  OPERATOR_CODE VARCHAR(24) NOT NULL , 
                  SP_CODE BIGINT NOT NULL , 
                  BILL_FLAG SMALLINT NOT NULL , 
                  SP_TYPE INTEGER NOT NULL,
                  OPERATOR_NAME varchar(256)
                  )   
                 DISTRIBUTE BY HASH(OPERATOR_CODE)   
                   IN TBS_ODS_OTHER INDEX IN TBS_INDEX ;
ALTER TABLE BASS2 .ODS_PM_SP_OPERATOR_CODE_YYYYMM
   LOCKSIZE TABLE;
select * 
from  BASS1.ALL_DIM_LKP 
where BASS1_TBID = 'BASS_STD1_0114'
      and bass1_value like 'QW_QQT_JC%'
                          
                          


alter table bass2.ODS_PM_SP_OPERATOR_CODE_201103 add column OPERATOR_NAME varchar(256)



CREATE TABLE BASS2   .ODS_PM_SP_OPERATOR_CODE_201104  (
                  OPERATOR_CODE VARCHAR(24) NOT NULL , 
                  SP_CODE BIGINT NOT NULL , 
                  BILL_FLAG SMALLINT NOT NULL , 
                  SP_TYPE INTEGER NOT NULL,
                  OPERATOR_NAME varchar(256)
                  )   
                 DISTRIBUTE BY HASH(OPERATOR_CODE)   
                   IN TBS_ODS_OTHER INDEX IN TBS_INDEX ;
ALTER TABLE BASS2 .ODS_PM_SP_OPERATOR_CODE_201104
   LOCKSIZE TABLE;
select * from   bass2.ODS_PM_SP_OPERATOR_CODE_201103


alter table bass2.Dim_pm_sp_operator_code add column OPERATOR_NAME varchar(256)


select count(0) from    bass2.ODS_PM_SP_OPERATOR_CODE_20110427

TABNAME
DIM_PM_SP_OPERATOR_CODE
ODS_PM_SP_OPERATOR_CODE_201103
drop table ODS_PM_SP_OPERATOR_CODE_20110426
drop table ODS_PM_SP_OPERATOR_CODE_20110427
drop table ODS_PM_SP_OPERATOR_CODE_20110428
drop table ODS_PM_SP_OPERATOR_CODE_20110429
drop table ODS_PM_SP_OPERATOR_CODE_20110430
drop table ODS_PM_SP_OPERATOR_CODE_YYYYMMDD


drop table bass2.ODS_PM_SP_OPERATOR_CODE_20110426
drop table bass2.ODS_PM_SP_OPERATOR_CODE_20110427
drop table bass2.ODS_PM_SP_OPERATOR_CODE_20110428
drop table bass2.ODS_PM_SP_OPERATOR_CODE_20110429
drop table bass2.ODS_PM_SP_OPERATOR_CODE_20110430
drop table bass2.ODS_PM_SP_OPERATOR_CODE_YYYYMMDD



select * from   bass2.ODS_PM_SP_OPERATOR_CODE_201103
select * from   bass2.ODS_PM_SP_OPERATOR_CODE_201104




select * from    bass2.Dim_pm_sp_operator_code 


select count(0) from     bass1.mon_all_interface 
where type = 'd'


select count(0) from     bass1.mon_all_interface 
where type = 'm'



select count(0) from     bass1.mon_all_interface 

81+56=137
137 + 8 = 145 

13
insert into bass1.mon_all_interface values
 ('d','02022','用户选择全球通全网统一基础资费套餐','每日全量','每日13点前')
,('d','02023','用户选择全球通专属叠加资费套餐','每日全量','每日13点前')
,('d','22080','统一查询退订日汇总','每日新增','每日13点前')
,('d','22082','业务扣费主动提醒日汇总','每日新增','每日13点前')
,('d','22084','收费争议先退费后查证日汇总','每日新增','每日13点前')


delete from  bass1.mon_all_interface
where type = 'd'
and UPLOAD_TIME like '%月%'

insert into bass1.mon_all_interface values
('m','22081','统一查询和退订月汇总','每月新增','每月8日前')
,('m','22083','业务扣费主动提醒月汇总','每月新增','每月8日前')
,('m','22085','收费争议先退费后查证月汇总','每月新增','每月8日前')



select interface_code from    bass1.mon_all_interface
where type = 'd' and deadline =13
and sts = 1
except

select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1




select UPLOAD_TIME , count(0) 
--,  count(distinct UPLOAD_TIME ) 
from bass1.mon_all_interface 
group by  UPLOAD_TIME 
order by 1 



select * from   int(replace(char(current date - 1 days),'-',''))

values int(replace(char(current date - 1 days),'-',''))


select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月3日前'




select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_i_02018_month 
group by  time_id 
order by 1 




               select 
                    a.product_item_id                         base_prod_id,
                    a.name                                    base_prod_name,
                    case when a.del_flag='1' then '1'
                    else '2' end                              prod_status,
                    replace(char(date(a.create_date)),'-','') prod_begin_time,
                    replace(char(date(a.exp_date)),'-','')    prod_end_time,
                    a.platform_id,
                    b.trademark
                from bass2.dim_prod_up_product_item a,
                  bass2.Dim_prod_up_offer b
                where a.item_type = 'OFFER_PLAN' 
                and b.offer_type IN ('OFFER_PLAN')
                and a.product_item_id = b.offer_id
                and a.platform_id in (1,2)
                and replace(char(date(a.create_date)),'-','')<='20110430'
                and replace(char(date(b.create_date)),'-','')<='20110430'
                
                
                
select * from    bass2.Dim_prod_up_offer 


select b.* ,a.* from bass2.Dim_prod_up_offer a,
 bass2.DIM_PROD_UP_PRODUCT_ITEM b
WHERE b.ITEM_TYPE='OFFER_PLAN'
and ( extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
or extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )
or  extend_id in
(89110016, 89210016, 89310016, 89410016, 89510016, 89610016, 89710016, 89110017, 89210017, 89310017, 89410017, 89510017, 89610017, 89710017, 89110018, 89210018, 89310018, 89410018, 89510018, 89610018, 89710018)
      )
      and a.offer_id = b.PRODUCT_ITEM_ID
      
      
      
      select * from bass1.dim_base_prod_map
      
      
select * from 
bass2.dim_prod_up_product_item 
 where  extend_id in
(89110016, 89210016, 89310016, 89410016, 89510016, 89610016, 89710016, 89110017, 89210017, 89310017, 89410017, 89510017, 89610017, 89710017, 89110018, 89210018, 89310018, 89410018, 89510018, 89610018, 89710018)
and item_type='OFFER_PLAN'

                         


select a.*,t.b from  (
  SELECT 'bass2.DIM_PROD_UP_PRODUCT_ITEM' bas_tb,a.name ,char(a.PRODUCT_ITEM_ID)
  ,'全球通全网统一资费基础套餐标识' bass1_name
  ,'BASS_STD1_0114'
  ,
case 
when name like '%上网%128%' then 'QW_QQT_JC_SW128'
when name like '%上网%88%' then 'QW_QQT_JC_SW88'
when name like '%上网%58%' then 'QW_QQT_JC_SW58'
when name like '%本地%128%' then 'QW_QQT_JC_BD128'
when name like '%本地%88%' then 'QW_QQT_JC_BD88'
when name like '%本地%58%' then 'QW_QQT_JC_BD58'
--
when name like '%商旅%888%' then 'QW_QQT_JC_SL888'
when name like '%商旅%588%' then 'QW_QQT_JC_SL588'
when name like '%商旅%388%' then 'QW_QQT_JC_SL388'
when name like '%商旅%288%' then 'QW_QQT_JC_SL288'
when name like '%商旅%188%' then 'QW_QQT_JC_SL188'
when name like '%商旅%158%' then 'QW_QQT_JC_SL158'
when name like '%商旅%128%' then 'QW_QQT_JC_SL128'
when name like '%商旅%88%' then 'QW_QQT_JC_SL88'
when name like '%商旅%58%' then 'QW_QQT_JC_SL58'
end 
  bass1_id
  FROM bass2.DIM_PROD_UP_PRODUCT_ITEM a
WHERE ITEM_TYPE='OFFER_PLAN'
and extend_id in
(89110016, 89210016, 89310016, 89410016, 89510016, 89610016, 89710016, 89110017, 89210017, 89310017, 89410017, 89510017, 89610017, 89710017, 89110018, 89210018, 89310018, 89410018, 89510018, 89610018, 89710018)
) a,
      table (
select 'QW_QQT_JC_SW58' a ,'全球通全网统一资费上网套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_SW88' a ,'全球通全网统一资费上网套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_SW128' a ,'全球通全网统一资费上网套餐128元' b from  bass2.dual union all
select 'QW_QQT_JC_SL58' a ,'全球通全网统一资费商旅套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_SL88' a ,'全球通全网统一资费商旅套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_SL128' a ,'全球通全网统一资费商旅套餐128元' b from  bass2.dual union all
select 'QW_QQT_JC_SL158' a ,'全球通全网统一资费商旅套餐158元' b from  bass2.dual union all
select 'QW_QQT_JC_SL188' a ,'全球通全网统一资费商旅套餐188元' b from  bass2.dual union all
select 'QW_QQT_JC_SL288' a ,'全球通全网统一资费商旅套餐288元' b from  bass2.dual union all
select 'QW_QQT_JC_SL388' a ,'全球通全网统一资费商旅套餐388元' b from  bass2.dual union all
select 'QW_QQT_JC_SL588' a ,'全球通全网统一资费商旅套餐588元' b from  bass2.dual union all
select 'QW_QQT_JC_SL888' a ,'全球通全网统一资费商旅套餐888元' b from  bass2.dual union all
select 'QW_QQT_JC_BD58' a ,'全球通全网统一资费本地套餐58元' b from  bass2.dual union all
select 'QW_QQT_JC_BD88' a ,'全球通全网统一资费本地套餐88元' b from  bass2.dual union all
select 'QW_QQT_JC_BD128' a ,'全球通全网统一资费本地套餐128元' b from  bass2.dual ) t where a.bass1_id = t.a
     
     



                         

select 
         'bass2.DIM_PROD_UP_PRODUCT_ITEM' XZBAS_TBNAME
        ,a.name XZBAS_COLNAME
        ,char(a.PRODUCT_ITEM_ID) XZBAS_VALUE
        ,'全球通全网统一资费基础套餐标识' BASS1_TBN_DESC
        ,'BASS_STD1_0114' BASS1_TBID
from bass2.DIM_PROD_UP_PRODUCT_ITEM      a    
WHERE ITEM_TYPE='OFFER_PLAN'
and extend_id in
(89110016, 89210016, 89310016, 89410016, 89510016, 89610016, 89710016, 89110017, 89210017, 89310017, 89410017, 89510017, 89610017, 89710017, 89110018, 89210018, 89310018, 89410018, 89510018, 89610018, 89710018)

                         
                         

insert into BASS1.ALL_DIM_LKP
select 
         'bass2.DIM_PROD_UP_PRODUCT_ITEM' XZBAS_TBNAME
        ,a.name XZBAS_COLNAME
        ,char(a.PRODUCT_ITEM_ID) XZBAS_VALUE
        ,'全球通全网统一资费基础套餐标识' BASS1_TBN_DESC
        ,'BASS_STD1_0114' BASS1_TBID
        ,''
        ,''
from bass2.DIM_PROD_UP_PRODUCT_ITEM      a    
WHERE ITEM_TYPE='OFFER_PLAN'
and extend_id in
(89110016, 89210016, 89310016, 89410016, 89510016, 89610016, 89710016, 89110017, 89210017, 89310017, 89410017, 89510017, 89610017, 89710017, 89110018, 89210018, 89310018, 89410018, 89510018, 89610018, 89710018)

                         
                         
select *
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'

2.2)	111 112113

select * from bass1.dim_base_prod_map

insert into                          
bass1.dim_base_prod_map
select bigint( xzbas_value ) 
,case 
when XZBAS_COLNAME like '%上网套餐%' then  '111'
when XZBAS_COLNAME like '%商旅套餐%' then  '112'
when XZBAS_COLNAME like '%本地套餐%' then  '113'
end 
from  BASS1.ALL_DIM_LKP 
where BASS1_TBID = 'BASS_STD1_0114'
                    
                    


             select 
                    a.product_item_id                         base_prod_id,
                    a.name                                    base_prod_name,
                    case when a.del_flag='1' then '1'
                    else '2' end                              prod_status,
                    replace(char(date(a.create_date)),'-','') prod_begin_time,
                    replace(char(date(a.exp_date)),'-','')    prod_end_time,
                    a.platform_id,
                    b.trademark
                from bass2.dim_prod_up_product_item a,
                  bass2.Dim_prod_up_offer b
                where a.item_type = 'OFFER_PLAN' 
                --and b.offer_type IN ('OFFER_PLAN')
                and a.product_item_id = b.offer_id
                and a.platform_id in (1,2)
                and replace(char(date(a.create_date)),'-','')<='20110430'
                and replace(char(date(b.create_date)),'-','')<='20110430'



select * from   bass1.g_i_02018_month
where time_id = 201104

                    
                    

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02019_MONTH
group by  time_id 
order by 1 


select * from   G_I_02019_MONTH where over_prod_name like '%全球通专属%'

select * from    bass2.dim_prod_up_plan_plan_rel 

select RELAT_PRODUCT_ITEM_ID from 
 bass2.dim_prod_up_plan_plan_rel 
where RELAT_PRODUCT_ITEM_ID  in (
select product_item_id from bass2.dim_prod_up_product_item
where  extend_id in(90001363, 90001364, 90001365, 90001366, 90001367, 90001368 )
)                    


select * from bass2.dim_prod_up_product_item
where product_item_id in (
select RELAT_PRODUCT_ITEM_ID from 
 bass2.dim_prod_up_plan_plan_rel 
where RELAT_PRODUCT_ITEM_ID  in (
select product_item_id from bass2.dim_prod_up_product_item
where  extend_id in(90001363, 90001364, 90001365, 90001366, 90001367, 90001368 )
)   )



select * from   app.sch_control_before where control_code = 'BASS2_Dw_product_sp_info_ms.tcl'

select * from   app.sch_control_runlog where control_code = 'TR1_L_11039'

select * from   app.sch_control_task where control_code = 'TR1_L_11039'

select * from   bass2.ODS_PRODUCT_SP_INFO_201105


select * from   app.sch_control_runlog 
where control_code like  'BASS1%2208%MONTH%'




CREATE TABLE "BASS2   "."ODS_PRODUCT_SP_INFO_201104"  (
                  "SP_INFO_ID" VARCHAR(12) NOT NULL , 
                  "SERV_TYPE" VARCHAR(50) , 
                  "SP_CODE" VARCHAR(20) , 
                  "SP_NAME" VARCHAR(100) , 
                  "SP_TYPE" INTEGER , 
                  "SERV_CODE" VARCHAR(50) , 
                  "PROV_CODE" VARCHAR(20) , 
                  "BAL_PROV" VARCHAR(20) , 
                  "DEV_CODE" VARCHAR(20) , 
                  "PLATFORM_ID" INTEGER , 
                  "IS_USER_CONFIRM" SMALLINT , 
                  "IS_GLOBAL" SMALLINT , 
                  "IS_THIRD_CONFIRM" SMALLINT , 
                  "DESCRIPTION" VARCHAR(200) , 
                  "VALID_DATE" TIMESTAMP , 
                  "EXPIRE_DATE" TIMESTAMP , 
                  "DEL_FLAG" VARCHAR(1) , 
                  "SP_SHORT_NAME" VARCHAR(100) , 
                  "STATE" VARCHAR(1) , 
                  "SP_SVC_ID" VARCHAR(32) , 
                  "CSR_TEL" VARCHAR(128) , 
                  "CSR_URL" VARCHAR(128) , 
                  "SP_EN_NAME" VARCHAR(128) , 
                  "SERV_ID_ALIAS" VARCHAR(128) , 
                  "DONE_DATE" TIMESTAMP , 
                  "OPER_MODE" VARCHAR(2) )   
                 DISTRIBUTE BY HASH("SP_INFO_ID",  
                 "SP_CODE")   
                   IN "TBS_ODS_OTHER" INDEX IN "TBS_INDEX" ;
ALTER TABLE "BASS2   "."ODS_PRODUCT_SP_INFO_201104"
   LOCKSIZE TABLE;
select * from   bass1.g_s_22082_day


select * from app.sch_control_runlog where flag = 1



select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.G_S_04003_DAY 
group by  time_id 
order by 1 desc

select count(0) from    
bass2.cdr_wlan_20110501


select * from   app.sch_control_before where control_code = 'BASS2_Dw_enterprise_industry_apply.tcl'


BEFORE_CONTROL_CODE
BASS2_Dim_pm_serv_type_vs_expr_ds.tcl
BASS2_Dim_pm_sp_operator_code_ms.tcl
BASS2_Dw_his_dsmp_sms_send_message_dm.tcl


select * from   app.sch_control_runlog where control_code = 'BASS2_Dim_pm_serv_type_vs_expr_ds.tcl'

BEFORE_CONTROL_CODE
BASS2_Dw_product_unite_cancel_order_dm.tcl
BASS2_Dw_three_item_stat_dm.tcl


select * from   app.sch_control_task where control_code = 'BASS2_Dw_enterprise_industry_apply.tcl'


update PRIORITY_VAL
0

CONTROL_CODE
BASS2_Dw_three_item_stat_dm.tcl



WITH n(control_code, before_control_code) AS 
          (SELECT control_code, before_control_code 
             FROM app.sch_control_before
             WHERE before_control_code = 'BASS2_Dw_product_ms.tcl'
           UNION ALL
           SELECT b.control_code,b.before_control_code 
             FROM app.sch_control_before as b, n
             WHERE b.before_control_code = n.control_code)
SELECT distinct c.control_code FROM n,app.sch_control_task c
where n.control_code = c.control_code
and c.deal_time = 2
and c.control_code not like 'OLAP_%' 
    AND c.control_code not like 'BASS1_%' 
    AND c.control_code not like 'NUTS_%' 

             
             
             
             
update   app.sch_control_runlog 
set flag=-2
where control_code 
in ('BASS2_dw_ng1_chl_term_planquery_mm.tcl',
'BASS2_dw_ng1_chl_uniformterm_mm.tcl',
'BASS2_Dw_acct_sale_discount_ms.tcl',
'BASS2_Dw_channel_msg_ms.tcl',
'BASS2_Dw_channel_named_busi_ms.tcl',
'BASS2_Dw_chl_e_10086_user_dm.tcl',
'BASS2_Dw_chl_e_all_user_mt.tcl',
'BASS2_Dw_chl_e_sms_user_dm.tcl',
'BASS2_Dw_chl_e_touch_user_dm.tcl',
'BASS2_Dw_chl_e_ussd_user_dm.tcl',
'BASS2_Dw_chl_e_wap_user_dm.tcl',
'BASS2_Dw_chl_e_web_user_dm.tcl',
'BASS2_Dw_ent_adc_ms.tcl',
'BASS2_Dw_ent_imp_vocation_ms.tcl',
'BASS2_Dw_ent_mas_ms.tcl',
'BASS2_Dw_ent_msg_ms.tcl',
'BASS2_Dw_ent_snapshot_mem_ms.tcl',
'BASS2_Dw_ent_snapshot_ms.tcl',
'BASS2_Dw_ent_subpro_mr_ms.tcl',
'BASS2_Dw_ent_target_ms.tcl',
'BASS2_Dw_ent_term_ms.tcl',
'BASS2_Dw_ent_use_prod_ms.tcl',
'BASS2_Dw_enterprise_industry_apply.tcl',
'BASS2_Dw_enterprise_keycust_msg_mm.tcl',
'BASS2_Dw_enterprise_member_mid_ms.tcl',
'BASS2_Dw_enterprise_msg_ext_ms.tcl',
'BASS2_Dw_enterprise_new_unipay_ms.tcl',
'BASS2_Dw_enterprise_unipay_ms.tcl',
'BASS2_Dw_have_value_ms.tcl',
'BASS2_Dw_have_value_snapshot_ms.tcl',
'BASS2_Dw_ng1_chl_e_useinfo_ms.tcl',
'BASS2_Dw_ng1_chl_like_chl_ms.tcl',
'BASS2_Dw_ng1_chl_phy_useinfo_ms.tcl',
'BASS2_Dw_ng1_chl_selfterm_userinfo_ms.tcl',
'BASS2_Dw_ng1_chl_smssend_useinfo_ms.tcl',
'BASS2_Dw_ng1_chl_term_custinfo_ms.tcl',
'BASS2_Dw_ng1_chl_term_msg_ms.tcl',
'BASS2_Dw_ng1_univ_term_custcharac_ms.tcl',
'BASS2_Dw_product_activity_ms.tcl',
'BASS2_Dw_product_cust_unite_ms.tcl',
'BASS2_Dw_product_ext_ms_1.tcl',
'BASS2_Dw_product_ext_ms.tcl',
'BASS2_Dw_product_snapshot_ms.tcl',
'BASS2_Dw_product_td_addon_ms.tcl',
'BASS2_Dw_product_td_gene_ms.tcl',
'BASS2_Dw_product_td_gprs_ms.tcl',
'BASS2_Dw_product_td_income_ms.tcl',
'BASS2_Dw_product_td_ms.tcl',
'BASS2_Dw_td_check_user_ms.tcl',
'BASS2_group_collection.tcl',
'BASS2_group_dmrn_potential_basic.tcl',
'BASS2_group_inc.tcl',
'BASS2_group_info.tcl',
'BASS2_group_level_change.tcl',
'BASS2_group_mbmreco.tcl',
'BASS2_group_memberloss.tcl',
'BASS2_group_nums.tcl',
'BASS2_group_perspect_base_list.tcl',
'BASS2_group_perspect_base.tcl',
'BASS2_group_perspect_basic.tcl',
'BASS2_group_perspect_fw.tcl',
'BASS2_group_perspect_group_base.tcl',
'BASS2_group_perspect_group_member_base.tcl',
'BASS2_group_perspect_load.tcl',
'BASS2_group_perspect_roam.tcl',
'BASS2_group_perspect_sms_detail.tcl',
'BASS2_group_perspect_sms.tcl',
'BASS2_group_perspect.tcl',
'BASS2_group_score.tcl',
'BASS2_mart_comp_users_mm.tcl',
'BASS2_mart_ent_manager_accosche_mm.tcl',
'BASS2_mart_ent_manager_accosche_order_mm.tcl',
'BASS2_mart_ent_manager_index_mm.tcl',
'BASS2_mart_ent_sinent_multi_anal_mm.tcl',
'BASS2_mart_entmember_call_yyyymm.tcl',
'BASS2_mart_kpi_monthly.tcl',
'BASS2_mart_product_yyyymm.tcl',
'BASS2_mart_vip_callandfee_yyyymm.tcl',
'BASS2_mart_vip_manager_accosche_mm.tcl',
'BASS2_mart_vip_manager_accosche_order_mm.tcl',
'BASS2_mart_vip_manager_index_mm.tcl',
'BASS2_region_custchange_monthly.tcl',
'BASS2_region_enterprisekpi_monthly.tcl',
'BASS2_region_examkpi_monthly_2011.tcl',
'BASS2_region_examkpi_monthly_qz_2011.tcl',
'BASS2_region_feedis_monthly.tcl',
'BASS2_region_gridsnapkpi_monthly.tcl',
'BASS2_region_si_kpi_monthly.tcl',
'BASS2_region_snapshotkpi2_monthly_fetion.tcl',
'BASS2_region_snapshotkpi2_monthly.tcl',
'BASS2_region_snapshotkpi3_monthly_fetion.tcl',
'BASS2_region_snapshotkpi3_monthly.tcl',
'BASS2_regioncell_channelplan_monthly.tcl',
'BASS2_regioncell_character_monthly.tcl',
'BASS2_regioncell_custservice_monthly.tcl',
'BASS2_regioncell_hotcell_monthly.tcl',
'BASS2_regioncell_rualdevelop_monthly.tcl',
'BASS2_regioncell_snapshotkpi_monthly.tcl',
'BASS2_regionchannel_kpi_monthly.tcl',
'BASS2_regionpromo_monthly.tcl',
'BASS2_Region_download_mm.tcl',
'BASS2_Region_user_gridsnap_ms.tcl',
'BASS2_st_product_td_call_mm.tcl',
'BASS2_st_product_td_gene_mm.tcl',
'BASS2_st_product_td_gprs_mm.tcl',
'BASS2_st_product_td_owe_mm.tcl',
'BASS2_stat_mart_ent_manager_index_mm.tcl',
'BASS2_td_cust_base_info_ms.tcl',
'BASS2_td_cust_data_info_ms.tcl',
'BASS2_td_cust_info_view_ms.tcl',
'BASS2_td_cust_net_info_ms.tcl',
'BASS2_td_cust_voice_info_ms.tcl',
'BASS2_td_cust_voice_info_other_ms.tcl',
'BASS2_td_doublecard_0001_m.tcl',
'BASS2_td_doublecard_0002_m.tcl',
'BASS2_td_doublecard_0003_m.tcl',
'DMK_mart_bad_analysis_mm.tcl',
'DMK_mart_bad_woff_analysis_mm.tcl',
'DMK_mart_ent_vpmn_latent.tcl',
'DMK_mart_online_product_anal.tcl',
'DMK_mart_online_product_yyyymm.tcl',
'DMK_mart_product_yyyymm_add.tcl',
'DMK_mart_region_newsreport_mm.tcl',
'DMK_mart_regioncomp_call_mm.tcl',
'DMK_martd_snapshot_user_1_mm.tcl',
'DMK_martd_snapshot_user_mm_3.tcl',
'DMK_martd_snapshot_user_mm.tcl',
'DMK_stat_enterprise_actbad_detail_mm.tcl',
'DMK_stat_month_call_mm.tcl',
'DMK_stat_owe_callback_detail_yyyymm.tcl',
'DMK_stat_owe_callback_mm.tcl',
'DMK_stat_region_actbad_detail_mm.tcl',
'DMK_stat_region_entnewbusiuser_mm.tcl',
'DMK_stat_region_newuser_mm.tcl',
'MPM_mtl_dmsale_consume_lmonth_yyyymm.tcl',
'MPM_mtl_dmsale_output.tcl',
'MPM_mtl_gindex.tcl',
'MPM_mtl_PartUser.tcl',
'MPM_mtl_UserBase.tcl',
'MPM_mtl_UserExt.tcl',
'NG1_Dw_ng1_co_careuser_mm.tcl',
'NG1_Dw_ng1_co_unsatisfy_mm.tcl',
'NG1_Dw_ng1_custsvc_co_aim_dm.tcl',
'NG1_Dw_ng1_product_ms.tcl',
'NG1CUSTUSG_call_analy_mm.tcl',
'NG1CUSTUSG_call_mou_analy_mm.tcl',
'NG1CUSTUSG_consumption_analy_mm.tcl',
'NG1CUSTUSG_cring_analysis_mm.tcl',
'NG1CUSTUSG_cust_analy_mm.tcl',
'NG1CUSTUSG_databusi_analy_mm.tcl',
'NG1CUSTUSG_entcust_analy_mm.tcl',
'NG1CUSTUSG_interbusi_infoanaly_mm.tcl',
'NG1CUSTUSG_interroam_in_dataanaly_mm.tcl',
'NG1CUSTUSG_interroam_out_dataanaly_mm.tcl',
'NG1CUSTUSG_interroam_out_voiceanaly_mm.tcl',
'NG1CUSTUSG_intertga_roam_out_voiceanaly_mm.tcl',
'NG1CUSTUSG_mms_analy_mm.tcl',
'NG1CUSTUSG_mobile_newspaper_analysis_mm.tcl',
'NG1CUSTUSG_sms_analy_mm.tcl',
'NG1CUSTUSG_sms_mms_out_busianaly_mm.tcl',
'NG1CUSTUSG_vipcust_analy_mm.tcl',
'NG1CUSTUSG_wirelessmusic_analy_mm.tcl',
'NG1ENT_dw_ng1_ent_acct_ms.tcl',
'NG1ENT_dw_ng1_ent_acctmem_ms.tcl',
'NG1ENT_dw_ng1_ent_busistat_ms.tcl',
'NG1ENT_dw_ng1_ent_cm_hidemember_ms.tcl',
'NG1ENT_dw_ng1_ent_comp_hidemember_ms.tcl',
'NG1ENT_dw_ng1_ent_costbenefit_ms.tcl',
'NG1ENT_dw_ng1_ent_infofee_ms.tcl',
'NG1ENT_dw_ng1_ent_linker_ms.tcl',
'NG1ENT_dw_ng1_ent_mem_mobmail_ms.tcl',
'NG1ENT_dw_ng1_ent_mem_univ_ms.tcl',
'NG1ENT_dw_ng1_ent_mem_vpmn_ms.tcl',
'NG1ENT_dw_ng1_ent_memshould_ms.tcl',
'NG1ENT_dw_ng1_ent_mobmail_ms.tcl',
'NG1ENT_dw_ng1_ent_ms.tcl',
'NG1ENT_dw_ng1_ent_off_base_ms.tcl',
'NG1ENT_dw_ng1_ent_owefee_ms.tcl',
'NG1ENT_dw_ng1_ent_platform_product_ms.tcl',
'NG1ENT_dw_ng1_ent_platform_use_ms.tcl',
'NG1ENT_dw_ng1_ent_promemshd_ms.tcl',
'NG1ENT_dw_ng1_ent_scorereturn_ms.tcl',
'NG1ENT_dw_ng1_ent_should_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_cr_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_det_cr_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_swbd_calldtl_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_swbd_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_swbdcall_ms.tcl',
'NG1ENT_dw_ng1_ent_subpro_swbdin_ms.tcl',
'NG1ENT_dw_ng1_ent_subpromemcall_ms.tcl',
'NG1ENT_dw_ng1_ent_subproshould_ms.tcl',
'NG1ENT_dw_ng1_ent_term_call_ms.tcl',
'NG1ENT_dw_ng1_ent_term_user_ms.tcl',
'NG1ENT_dw_ng1_ent_value_det_info_ms.tcl',
'NG1ENT_dw_ng1_ent_vipscorereturn_ms.tcl',
'NG1ENT_dw_ng1_ent_vpmn_ms.tcl',
'NG1ENT_dw_ng1_entmem_busistat_ms.tcl',
'NG1ENT_st_ng1_ent_busi_use_mm.tcl',
'NG1ENT_st_ng1_ent_busistat_mm.tcl',
'NG1ENT_st_ng1_ent_calllac_mm.tcl',
'NG1ENT_st_ng1_ent_complaint_mm.tcl',
'NG1ENT_st_ng1_ent_costbenefit_mm.tcl',
'NG1ENT_st_ng1_ent_custincome_mm.tcl',
'NG1ENT_st_ng1_ent_industry_use_mm.tcl',
'NG1ENT_st_ng1_ent_industryapp_mm.tcl',
'NG1ENT_st_ng1_ent_levchange_mm.tcl',
'NG1ENT_st_ng1_ent_manage_mm.tcl',
'NG1ENT_st_ng1_ent_markprog_mm.tcl',
'NG1ENT_st_ng1_ent_mem_univ_mm.tcl',
'NG1ENT_st_ng1_ent_mm.tcl',
'NG1ENT_st_ng1_ent_owe_analy_mm.tcl',
'NG1ENT_st_ng1_ent_platform_use_mm.tcl',
'NG1ENT_st_ng1_ent_precust_mm.tcl',
'NG1ENT_st_ng1_ent_prosol_adcmas_mm.tcl',
'NG1ENT_st_ng1_ent_prosol_mm.tcl',
'NG1ENT_st_ng1_ent_serivce_mm.tcl',
'NG1ENT_st_ng1_ent_sershould_mm.tcl',
'NG1ENT_st_ng1_ent_smslac_ad_mm.tcl',
'NG1ENT_st_ng1_ent_subpro_cr_mm.tcl',
'NG1ENT_st_ng1_ent_subpro_pmail_mm.tcl',
'NG1ENT_st_ng1_ent_subpro_swbd_mm.tcl',
'NG1ENT_st_ng1_ent_subpro_vpmn_mm.tcl',
'NG1ENT_st_ng1_ent_subprocall_mm.tcl',
'NG1ENT_st_ng1_ent_subproshould_mm.tcl',
'NG1ENT_st_ng1_ent_term_nums_mm.tcl',
'NG1ENT_st_ng1_ent_term_use_mm.tcl',
'NG1ENT_st_ng1_ent_total_fee_mm.tcl',
'NG1REP_dw_ng1_report_0001.tcl',
'NG1REP_dw_ng1_report_0005.tcl',
'NG1REP_dw_ng1_report_0006.tcl',
'NG1REP_dw_ng1_report_0008.tcl',
'NG1REP_dw_ng1_report_0009.tcl',
'NG1REP_dw_ng1_report_0010.tcl',
'NG1REP_dw_ng1_report_0011.tcl',
'NG1REP_dw_ng1_report_0012.tcl',
'NG1REP_dw_ng1_report_0014.tcl',
'NG1REP_dw_ng1_report_0015.tcl',
'NG1REP_dw_ng1_report_0016.tcl',
'NG1REP_dw_ng1_report_0018.tcl',
'NG1REP_dw_ng1_report_0020.tcl',
'NG1st_ng1_csvc_complaint_point_mm.tcl',
'NG1st_ng1_csvc_complaint_specust_mm.tcl',
'NG1st_ng1_csvc_locale_complaint_mm.tcl',
'NG1st_ng1_csvc_othernet_consult_mm.tcl',
'NG1st_ng1_csvc_re_complaint_mm.tcl',
'NG1st_ng1_csvc_timelimit_mm.tcl',
'NG1st_ng1_csvc_update_complaint_mm.tcl',
'NG1st_ng1_custdev_brand_change_analy_ms.tcl',
'NG1st_ng1_custdev_brand_new_off_analy_ms.tcl',
'NG1st_ng1_custdev_brand_total_analy_ms.tcl',
'REP_app_fxyx_offuser_list_total_m.tcl',
'REP_app_fxyx_onuser_list_arpu.tcl',
'REP_app_fxyx_onuser_list_credit.tcl',
'REP_app_fxyx_onuser_list_fee_m.tcl',
'REP_app_fxyx_onuser_list_planrank.tcl',
'REP_app_fxyx_onuser_list_total_m.tcl',
'REP_App_ent_churn_analysis_mm.tcl',
'REP_App_ent_churn_entalarm_list_ms.tcl',
'REP_App_ent_churn_entalarm_type_ms.tcl',
'REP_App_ent_churn_memalarm_list_ms.tcl',
'REP_App_ent_churn_memalarm_type_ms.tcl',
'REP_App_ent_churn_memstable_type_ms.tcl',
'REP_App_ent_churn_vipalarm_type_ms.tcl',
'REP_App_ent_evaluate_coneandlvl_mm.tcl',
'REP_App_ent_evaluate_conesurvey_mm.tcl',
'REP_App_ent_evaluate_entscorecalt_mm.tcl',
'REP_App_ent_evaluate_entscoremant_mm.tcl',
'REP_App_ent_evaluate_feesurvey_mm.tcl',
'REP_App_ent_evaluate_mktfee_mm.tcl',
'REP_App_ent_evaluate_planeffect_mm.tcl',
'REP_App_ent_evaluate_planimpact_mm.tcl',
'REP_App_ent_evaluate_plannow_mm.tcl',
'REP_App_xysc_comp_user_ms.tcl',
'REP_App_xysc_new_user_ms.tcl',
'REP_App_xysc_new_user_xs_ms.tcl',
'REP_App_xysc_school_user_ms.tcl',
'REP_channel_bbusi_reward_ms.tcl',
'REP_channel_charge_reward_ms.tcl',
'REP_channel_etop_reward_ms.tcl',
'REP_channel_nbusi_reward_ms.tcl',
'REP_channel_user_reward_ms.tcl',
'REP_home_user_allcall_ms.tcl',
'REP_home_user_base_call_ms.tcl',
'REP_home_user_call_2.tcl',
'REP_home_user_call_3.tcl',
'REP_home_user_call_opp.tcl',
'REP_home_user_callfee.tcl',
'REP_home_user_channel_concat_ms.tcl',
'REP_home_user_channel_info.tcl',
'REP_home_user_comp_dig.tcl',
'REP_home_user_fee_analysis.tcl',
'REP_home_user_fee.tcl',
'REP_home_user_match_busi.tcl',
'REP_home_user_promo_trend.tcl',
'REP_home_user_promofav_analysis.tcl',
'REP_home_user_promotype_analysis.tcl',
'REP_home_user_sens_analysis.tcl',
'REP_home_user_termtype_analysis.tcl',
'REP_report_stat_twocity_mm.tcl',
'REP_st_echannel_report_mm.tcl',
'REP_st_ng1_chl_phy_rwd_openphone_mm.tcl',
'REP_stat_acct_td_001.tcl',
'REP_stat_acct_td_002.tcl',
'REP_stat_acct_td_003.tcl',
'REP_stat_acct_td_004.tcl',
'REP_stat_areaserver_0001_0010.tcl',
'REP_stat_busichl_0001.tcl',
'REP_stat_busichl_0002.tcl',
'REP_stat_channel_0004.tcl',
'REP_stat_channel_0006.tcl',
'REP_stat_channel_0007.tcl',
'REP_stat_channel_0021.tcl',
'REP_stat_channel_0022.tcl',
'REP_stat_channel_0023.tcl',
'REP_stat_channel_0024.tcl',
'REP_stat_channel_reward_0002.tcl',
'REP_stat_channel_reward_0003.tcl',
'REP_stat_channel_reward_0004.tcl',
'REP_stat_channel_reward_0005.tcl',
'REP_stat_channel_reward_0006.tcl',
'REP_stat_channel_reward_0007.tcl',
'REP_stat_channel_reward_0008.tcl',
'REP_stat_channel_reward_0009.tcl',
'REP_stat_channel_reward_0010.tcl',
'REP_stat_channel_reward_0011.tcl',
'REP_stat_channel_reward_0012.tcl',
'REP_stat_channel_reward_0013.tcl',
'REP_stat_channel_reward_0014.tcl',
'REP_stat_channel_reward_0015.tcl',
'REP_stat_channel_reward_0016.tcl',
'REP_stat_channel_reward_0017.tcl',
'REP_stat_channel_reward_0018.tcl',
'REP_stat_channel_reward_0019.tcl',
'REP_stat_channel_reward_0020.tcl',
'REP_stat_channel_reward_detail_ms.tcl',
'REP_stat_cust_value_0002.tcl',
'REP_stat_cust_value_0003.tcl',
'REP_stat_data_0023_rkz.tcl',
'REP_stat_data_0023.tcl',
'REP_stat_data_0024.tcl',
'REP_stat_data_0026.tcl',
'REP_stat_data_0030.tcl',
'REP_stat_data_0031.tcl',
'REP_stat_data_0032.tcl',
'REP_stat_data_0033.tcl',
'REP_stat_data_0034.tcl',
'REP_stat_data_0035.tcl',
'REP_stat_data_0036.tcl',
'REP_stat_data_0038.tcl',
'REP_stat_data_0039.tcl',
'REP_stat_data_0040.tcl',
'REP_stat_data_0041.tcl',
'REP_stat_data_0043.tcl',
'REP_stat_data_0044.tcl',
'REP_stat_data_0045.tcl',
'REP_stat_data_0046.tcl',
'REP_stat_data_0047.tcl',
'REP_stat_data_0048.tcl',
'REP_stat_data_0049.tcl',
'REP_stat_data_0050.tcl',
'REP_stat_data_0051.tcl',
'REP_stat_data_0052.tcl',
'REP_stat_data_0053.tcl',
'REP_stat_data_0055.tcl',
'REP_stat_data_0056.tcl',
'REP_stat_data_0057.tcl',
'REP_stat_data_0058.tcl',
'REP_stat_data_0059.tcl',
'REP_stat_data_0060.tcl',
'REP_stat_data_0061.tcl',
'REP_stat_data_0062.tcl',
'REP_stat_data_0063.tcl',
'REP_stat_data_0064.tcl',
'REP_stat_data_0065.tcl',
'REP_stat_data_0066.tcl',
'REP_stat_ecustsvc_0006.tcl',
'REP_stat_ecustsvc_0009.tcl',
'REP_stat_ecustsvc_0010.tcl',
'REP_stat_ecustsvc_0011.tcl',
'REP_stat_ecustsvc_0012.tcl',
'REP_stat_ecustsvc_0013.tcl',
'REP_stat_ecustsvc_0014.tcl',
'REP_stat_ecustsvc_0016.tcl',
'REP_stat_ecustsvc_0017.tcl',
'REP_stat_ecustsvc_0018.tcl',
'REP_stat_ecustsvc_0022.tcl',
'REP_stat_ecustsvc_0024.tcl',
'REP_stat_ecustsvc_0025.tcl',
'REP_stat_ecustsvc_0031.tcl',
'REP_stat_ecustsvc_0032.tcl',
'REP_stat_ecustsvc_0033.tcl',
'REP_stat_ecustsvc_0034.tcl',
'REP_stat_ecustsvc_0035.tcl',
'REP_stat_ecustsvc_0036.tcl',
'REP_stat_ecustsvc_0037.tcl',
'REP_stat_ecustsvc_0038.tcl',
'REP_stat_ecustsvc_0039.tcl',
'REP_stat_ecustsvc_0040.tcl',
'REP_stat_ecustsvc_0041.tcl',
'REP_stat_ecustsvc_0043.tcl',
'REP_stat_ecustsvc_0045.tcl',
'REP_stat_ecustsvc_0046_a.tcl',
'REP_stat_ecustsvc_0046_b.tcl',
'REP_stat_ecustsvc_0047.tcl',
'REP_stat_ecustsvc_0048.tcl',
'REP_stat_ecustsvc_0049.tcl',
'REP_stat_ecustsvc_0050.tcl',
'REP_stat_enterprise_0002.tcl',
'REP_stat_enterprise_0005.tcl',
'REP_stat_enterprise_0009.tcl',
'REP_stat_enterprise_0013.tcl',
'REP_stat_enterprise_0014.tcl',
'REP_stat_enterprise_0015.tcl',
'REP_stat_enterprise_0016.tcl',
'REP_stat_enterprise_0017.tcl',
'REP_stat_enterprise_0018.tcl',
'REP_stat_enterprise_0020.tcl',
'REP_stat_enterprise_0021.tcl',
'REP_stat_enterprise_0023.tcl',
'REP_stat_enterprise_0024.tcl',
'REP_stat_enterprise_0025.tcl',
'REP_stat_enterprise_0026.tcl',
'REP_stat_enterprise_0027.tcl',
'REP_stat_enterprise_0028.tcl',
'REP_stat_enterprise_0029.tcl',
'REP_stat_enterprise_0030.tcl',
'REP_stat_enterprise_0031.tcl',
'REP_stat_enterprise_0032_2010_new.tcl',
'REP_stat_enterprise_0032_2010.tcl',
'REP_stat_enterprise_0032_2011_1.tcl',
'REP_stat_enterprise_0032.tcl',
'REP_stat_enterprise_0033_2010.tcl',
'REP_stat_enterprise_0033.tcl',
'REP_stat_enterprise_0034_2010.tcl',
'REP_stat_enterprise_0034.tcl',
'REP_stat_enterprise_0035_2010_new.tcl',
'REP_stat_enterprise_0035_2010.tcl',
'REP_stat_enterprise_0035.tcl',
'REP_stat_enterprise_0036.tcl',
'REP_stat_enterprise_0037.tcl',
'REP_stat_enterprise_0041.tcl',
'REP_stat_enterprise_0044.tcl',
'REP_stat_enterprise_0047.tcl',
'REP_stat_enterprise_0048.tcl',
'REP_stat_enterprise_0049.tcl',
'REP_stat_enterprise_0050.tcl',
'REP_stat_enterprise_0051.tcl',
'REP_stat_enterprise_0052.tcl',
'REP_stat_enterprise_0054_a.tcl',
'REP_stat_enterprise_0054_b.tcl',
'REP_stat_enterprise_0055_a.tcl',
'REP_stat_enterprise_0055_b.tcl',
'REP_stat_imei_0001.tcl',
'REP_stat_local_0001.tcl',
'REP_stat_market_0014.tcl',
'REP_stat_market_0029.tcl',
'REP_stat_market_0040.tcl',
'REP_stat_market_0042.tcl',
'REP_stat_market_0063.tcl',
'REP_stat_market_0064.tcl',
'REP_stat_market_0065.tcl',
'REP_stat_market_0066.tcl',
'REP_stat_market_0067.tcl',
'REP_stat_market_0068.tcl',
'REP_stat_market_0069.tcl',
'REP_stat_market_0070.tcl',
'REP_stat_market_0073.tcl',
'REP_stat_market_0074_mm.tcl',
'REP_stat_market_0075_mm.tcl',
'REP_stat_market_0076.tcl',
'REP_stat_market_0096_user.tcl',
'REP_stat_market_0096.tcl',
'REP_stat_market_0097.tcl',
'REP_stat_market_0098.tcl',
'REP_stat_market_0099.tcl',
'REP_stat_market_0100.tcl',
'REP_stat_market_0101.tcl',
'REP_stat_market_0104.tcl',
'REP_stat_market_0105.tcl',
'REP_stat_market_0108.tcl',
'REP_stat_market_0110_user.tcl',
'REP_stat_market_0110.tcl',
'REP_stat_market_0113.tcl',
'REP_stat_market_0114.tcl',
'REP_stat_market_0116_a.tcl',
'REP_stat_market_0116_b.tcl',
'REP_stat_market_0116_c.tcl',
'REP_stat_market_0116_d.tcl',
'REP_stat_market_0116_e.tcl',
'REP_stat_market_0118.tcl',
'REP_stat_market_0119.tcl',
'REP_stat_market_0120.tcl',
'REP_stat_market_0121.tcl',
'REP_stat_market_0122.tcl',
'REP_stat_market_0123.tcl',
'REP_stat_market_0125.tcl',
'REP_stat_market_0126.tcl',
'REP_stat_market_0128.tcl',
'REP_stat_market_0132.tcl',
'REP_stat_market_0133.tcl',
'REP_stat_market_0134.tcl',
'REP_stat_market_td_009.tcl',
'REP_stat_market_td_010.tcl',
'REP_stat_market_td_011.tcl',
'REP_stat_market_td_012.tcl',
'REP_stat_market_td_013.tcl',
'REP_stat_market_td_014.tcl',
'REP_stat_market_td_015.tcl',
'REP_stat_market_td_016.tcl',
'REP_stat_mobile_value_0002.tcl',
'REP_stat_network_0006.tcl',
'REP_stat_network_0011.tcl',
'REP_stat_network_0012.tcl',
'REP_stat_network_0016.tcl',
'REP_stat_network_td_001.tcl',
'REP_stat_network_td_002.tcl',
'REP_stat_network_td_003.tcl',
'REP_stat_newproduct_kpi.tcl',
'REP_stat_plan_0001.tcl',
'REP_stat_plan_0002.tcl',
'REP_stat_rep_channel_2cityin1_mm.tcl',
'REP_stat_rep_city_2cityin1_mm.tcl',
'REP_stat_rep_long_pkg_incomeanddurn.tcl',
'REP_stat_sp_busi_cancel_mm.tcl',
'REP_stat_sp_cancel_top5_mm.tcl',
'REP_stat_sprom_value_0002.tcl',
'REP_stat_threebrand_analyzing_0033.tcl',
'REP_stat_xysc_001.tcl',
'REP_stat_xysc_002.tcl',
'REP_stat_xysc_003.tcl',
'REP_stat_xysc_004.tcl',
'REP_stat_xysc_005.tcl',
'REP_stat_xysc_006.tcl',
'REP_stat_xysc_007.tcl',
'REP_stat_xysc_008.tcl',
'REP_stat_xysc_009.tcl',
'REP_St_ng1_chl_develop_arpu_mm.tcl',
'REP_St_ng1_chl_phy_analy_mm.tcl',
'REP_St_ng1_chl_phy_area_loadpeak_mm.tcl',
'REP_St_ng1_chl_phy_chl_cmps_mm.tcl',
'REP_St_ng1_chl_phy_newuser_live_mm.tcl',
'REP_St_ng1_chl_phy_newuser_srv_mm.tcl',
'REP_St_ng1_chl_res_resalert_mm.tcl',
'REP_St_ng1_chl_term_custanaly_mm.tcl',
'REP_St_ng1_chl_term_custinfo_mm.tcl',
'REP_St_ng1_chl_term_info_mm.tcl',
'REP_St_ng1_chl_term_markinfo_mm.tcl',
'REP_St_ng1_chl_user_payfee_mm.tcl',
'REP_St_ng1_chl_user_query_mm.tcl',
'REP_St_ng1_chl_user_score_mm.tcl',
'REP_St_ng1_chl_xp_busirec_mm.tcl',
'REP_St_ng1_echl_acceptsuc_rate_mm.tcl',
'REP_St_ng1_echl_busi_det_mm.tcl',
'REP_St_ng1_echl_busi_impt_mm.tcl',
'REP_St_ng1_echl_busi_mm.tcl',
'REP_St_ng1_echl_busianaly_mm.tcl',
'REP_St_ng1_echl_kpi_mm.tcl',
'REP_St_ng1_echl_sms_user_busi_mm.tcl',
'REP_St_ng1_echl_sms_user_menu_mm.tcl',
'REP_St_ng1_echl_user_busi_det_mm.tcl',
'REP_St_ng1_echl_wap_user_busi_mm.tcl',
'REP_St_ng1_echl_wap_user_oper_mm.tcl',
'REP_St_ng1_echl_web_user_busi_mm.tcl',
'REP_St_ng1_echl_web_user_oper_mm.tcl',
'REP_St_ng1_term_cycle_query_mm.tcl',
'REP_td_cust_busi_user_dtl.tcl',
'REP_td_cust_follow_friend_dtl.tcl',
'REP_td_cust_sjzq_user_dtl.tcl',
'REP_td_cust_vip_netuser_dtl.tcl',
'REP_td_cust_wlan_user_dtl.tcl'
) 


update  app.sch_control_task 
set PRIORITY_VAL = 10000
where control_code  = 'BASS2_Dw_enterprise_industry_apply.tcl'

 select * from   app.sch_control_task where control_code = 'BASS2_Dw_enterprise_member_mid_ms.tcl'

update  app.sch_control_task 
set PRIORITY_VAL = 10000
where control_code  = 'BASS2_Dw_product_unite_cancel_order_dm.tcl'



BASS2_Dw_product_ms.tcl

select * from   app.sch_control_task where control_code = 'BASS2_Dw_product_ms.tcl'


select * from   BASS2.Dw_product_201104

select * from app.sch_control_runlog where control_code in (
select before_control_code from   app.sch_control_before where control_code = 'BASS2_Dw_enterprise_industry_apply.tcl'
)


select BEFORE_CONTRO from   app.sch_control_before where control_code='BASS2_Dw_product_ms.tcl' ;
select * from app.sch_control_runlog where control_code in (
select before_control_code from   app.sch_control_before where control_code = 'BASS2_Dw_product_ms.tcl'
)

select * from app.sch_control_runlog where control_code
 = 'BASS2_Dw_enterprise_member_mid_ms.tcl'

SELECT * FROM BASS2.Dw_acct_should_201104


select * from app.sch_control_runlog where control_code in (
select before_control_code from   app.sch_control_before where control_code = 'BASS2_Dw_product_ms.tcl'
)


BASS2_Dw_acct_should_ms.tcl


select * from app.sch_control_runlog where control_code in (
select before_control_code from   app.sch_control_before where control_code = 'BASS2_Dw_acct_should_ms.tcl'
)


BASS2_Dw_acct_should_extdtl_ms.tcl

select * from app.sch_control_runlog where control_code in (
select before_control_code from   app.sch_control_before where control_code = 'BASS2_Dw_acct_should_extdtl_ms.tcl'
)


select * from   G_S_22082_DAY


select * from   app.g_runlog  where unit_code = '22302'
and char(date(export_time)) like '%02'





select * from  app.sch_control_alarm 
where alarmtime >=  timestamp('20110402'||'000000') 
and alarmtime <=  timestamp('20110403'||'000000') 
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 


select * from app.g_runlog 
where unit_code in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
except
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0
)
where time_id=int(replace(char(current date - 1 days),'-',''))



select * from   bass1.MON_ALL_INTERFACE
where interface_code in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
except
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0

)



WITH n(control_code, before_control_code) AS 
          (SELECT control_code, before_control_code 
             FROM app.sch_control_before
             WHERE before_control_code = 'BASS2_Dw_acct_should_dtl_today_ds.tcl'
           UNION ALL
           SELECT b.control_code,b.before_control_code 
             FROM app.sch_control_before as b, n
             WHERE b.before_control_code = n.control_code)
             
             
SELECT distinct c.control_code FROM n,app.sch_control_task c
where n.control_code = c.control_code
and c.deal_time = 1
and c.control_code not like 'OLAP_%'


select count(*) from bass2.dw_product_201104;
SELECT COUNT(*) 
FROM bass2.dw_product_20110430;
select * from app.sch_control_runlog
where control_code ='BASS2_Dw_acct_sale_discount_ms.tcl'

select * from bass2.Dw_acct_sale_discount_201104

select * from  app.sch_control_runlog 
where control_code in 
(
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月3日前'
)


BASS1_G_I_02018_MONTH.tcl	2011-04-02 17:51:52.165434	2011-04-02 17:52:46.478397	54	-2
BASS1_G_I_02019_MONTH.tcl	2011-04-02 17:56:01.577983	2011-04-02 17:56:13.359047	11	-2
BASS1_G_I_02021_MONTH.tcl	2011-04-02 17:58:01.525347	2011-04-02 18:17:19.011434	1157	-2
BASS1_G_I_02020_MONTH.tcl	2011-04-02 17:58:40.074220	2011-04-02 17:59:01.097497	21	-2



update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
and upload_time = '每月3日前'
)




update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in 
            (
            select distinct control_code 
            from   app.sch_control_before 
            where  before_control_code in (
                    select b.CONTROL_CODE from    
                    BASS1.MON_ALL_INTERFACE a
                    , app.sch_control_task b 
                    where a.INTERFACE_CODE = substr(control_code , 11,5)
                    and a.TYPE = 'm'
                    and b.control_code like '%MONTH%'
                    and upload_time = '每月3日前'
            )
and control_code like '%CHECK%'
and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
)
and flag = 0
and date(endtime) <= current date
)


--重运导出程序
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
select control_code from app.sch_control_runlog 
where control_code in (
select distinct control_code from   app.sch_control_before 
where  before_control_code in (
    select b.CONTROL_CODE from    
    BASS1.MON_ALL_INTERFACE a
    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
    and a.TYPE = 'm'
    and b.control_code like '%MONTH%'
    and upload_time = '每月3日前'
    )
    and control_code like 'BASS1%EXP%'
)
and flag = 0
and date(endtime) <= current date
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')


select * from  app.sch_control_runlog  where control_code like 'BASS1%'
and flag = -2
and control_code in (
select control_code from app.sch_control_task where cc_flag = 1)


		select * from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
        
        

		select control_code from app.sch_control_runlog 
		where control_code in (
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
				)
		and control_code like '%CHECK%'
		and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
        
        
        
        
		select * from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
                        
                        



select * from  app.sch_control_before  where  control_code = 'BASS1_EXP_G_I_03002_MONTH'

select * from    app.sch_control_runlog 
where                        
 control_code like '%03002%'


select * from    app.sch_control_runlog  where control_code = 'BASS1_EXP_G_I_03001_MONTH' 
 update  app.sch_control_runlog 
 set flag = 0
 where control_code = 'BASS1_EXP_G_I_03001_MONTH'
 
 
 select month(current timestamp) from bass2.dual
 
 
 
 
 select * from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and date(endtime) <= current date and month(endtime)  = month(current timestamp)
        


BASS1_EXP_G_I_06012_MONTH	2011-05-01 12:07:07.389058	2011-05-01 12:07:58.384345	50	-2
BASS1_EXP_G_I_06029_MONTH	2011-05-01 12:04:04.291375	2011-05-01 12:06:46.503925	162	-2


getbefore('');
select *    
from   app.sch_control_before 
where control_code = 'BASS1_EXP_G_I_06012_MONTH'



        
        
select * from  app.sch_control_task  where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月3日前'
)        



						select * from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'

		select * from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		--and flag <> 0
		and date(endtime) <= current date and month(endtime)  = month(current timestamp)
        


BASS1_EXP_G_I_02018_MONTH	2011-04-02 17:54:13.389856	2011-04-02 17:54:46.423732	33	-2
BASS1_EXP_G_I_02019_MONTH	2011-04-02 17:57:22.727616	2011-04-02 17:58:03.608087	40	-2
BASS1_EXP_G_I_02020_MONTH	2011-04-02 18:01:55.786727	2011-04-02 18:15:35.176069	819	-2
BASS1_EXP_G_I_02021_MONTH	2011-04-02 18:17:23.337166	2011-04-02 18:53:23.070741	2159	-2


update    app.sch_control_runlog 
set flag = 0
where control_code = 'BASS1_EXP_G_I_02021_MONTH'
and flag = -2
      
      

      

BASS1_G_I_02018_MONTH.tcl	2011-04-02 17:51:52.165434	2011-04-02 17:52:46.478397	54	-2
BASS1_G_I_02019_MONTH.tcl	2011-04-02 17:56:01.577983	2011-04-02 17:56:13.359047	11	-2
BASS1_G_I_02021_MONTH.tcl	2011-04-02 17:58:01.525347	2011-04-02 18:17:19.011434	1157	-2
BASS1_G_I_02020_MONTH.tcl	2011-04-02 17:58:40.074220	2011-04-02 17:59:01.097497	21	-2



      
update    app.sch_control_runlog 
set flag = 0
where control_code = 'BASS1_INT_CHECK_L34_MONTH.tcl'
and flag = -2
      
      
BASS1_INT_CHECK_L34_MONTH.tcl	2011-04-06 13:09:06.172715	2011-04-06 13:09:09.015966	2	-2



      

		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)

        
        

select * from   app.sch_control_task where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)     
)        



select * from   app.sch_control_before 
where control_code = 'BASS1_EXP_G_I_02049_MONTH'

select * from   app.sch_control_before 
where control_code = 'BASS1_EXP_G_I_02049_MONTH'


		select * from app.sch_control_runlog 
		where control_code in 
        (
        select before_control_code from   app.sch_control_before 
        where control_code = 'BASS1_INT_CHECK_L34_MONTH.tcl'
        )
        
BASS1_INT_CHECK_L34_MONTH.tcl


select * from app.sch_control_before
		where control_code in (
'BASS1_EXP_G_I_03001_MONTH'
)


		select * from app.sch_control_runlog 
		where control_code in (
'BASS1_INT_CHECK_R058_MONTH.tcl'
)

select * from app.sch_control_task
		where control_code in (
'BASS1_INT_CHECK_R058_MONTH.tcl'
)


select * from   app.sch_control_runlog where flag = 1 



update  app.sch_control_task 
set PRIORITY_VAL = 1000
		where control_code in (
'BASS1_G_I_02018_MONTH.tcl'
)
and  PRIORITY_VAL = 0



update  app.sch_control_task 
set PRIORITY_VAL = 0
		where control_code in (
'BASS1_G_I_02018_MONTH.tcl'
)
and  PRIORITY_VAL = 1000





select * from   app.sch_control_task 
--select * from   app.sch_control_runlog
where CONTROL_CODE in (
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月3日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	
    
    )
    
    

select * from   app.sch_control_task where control_code = 'APP_ALARM_5'
    
    

select * from    APP.SMS_SEND_INFO 
select * from   APP.SMS_SEND_INFO  where date(send_time) = '2011-05-02'
order by message_id desc

    
    
    select tabname from syscat.tables where tabname like '%BEFORE%' 
    select * from   
    app.SCH_CONTROL_BEFORE_20110212
    where control_code = 'BASS1_EXP_G_I_02049_MONTH'
    
    
    
    select * from   app.sch_control_runlog where flag = 1 







update  app.sch_control_task  
set priority_val = 100
where control_code
in (
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月3日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月3日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月3日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
)
and  priority_val = 0

    
    
    
    select * from   BASS1.MON_ALL_INTERFACE 
    
    


select * from    bass2.Dim_prod_up_offer
where offer_id = 111090001340


select * from    bass2.dim_prod_up_product_item 
where product_item_id in 
 (   
select offer_id from    bass2.Dim_prod_up_offer
where OFFER_TYPE = 'OFFER_PROM'
)
 = 111090001340

    
    
   select * from    g_i_02018_month
where time_id = 201104



select count(0) from    bass2.dim_prod_up_plan_plan_rel



   
   

select * from   BASS1.DIM_NOT_NULL_INTERFACE
where interface_code  
in
('06001'
,'02061'
,'02062'
,'02004'
,'02022'
,'02023'
,'02056'
,'04014'
,'02055'
,'02064'
,'02058'
,'02060'
,'02057'
,'04003'
,'04010'
,'04009'
,'04012'
,'02013'
,'21009'
,'21005'
,'21004'
,'21016'
,'01006'
,'01007')
   
   

insert into  BASS1.DIM_NOT_NULL_INTERFACE values
 ('22080','统一查询退订日汇总')
,('22081','统一查询和退订月汇总')
,('22082','业务扣费主动提醒日汇总')
,('22083','业务扣费主动提醒月汇总')
,('22084','收费争议先退费后查证日汇总')
,('22085','收费争议先退费后查证月汇总')
   
   
   select count(0),count(distinct interface_code ) from      BASS1.DIM_NOT_NULL_INTERFACE values
   

('BASS1_G_S_02047_MONTH.tcl'
,'BASS1_G_I_02015_MONTH.tcl'
,'BASS1_G_I_06002_MONTH.tcl'
,'BASS1_G_I_06021_MONTH.tcl'
,'BASS1_G_A_01005_MONTH.tcl'
,'BASS1_G_I_02016_MONTH.tcl'
,'BASS1_G_I_06023_MONTH.tcl'
,'BASS1_G_I_02014_MONTH.tcl'
,'BASS1_G_I_06022_MONTH.tcl')                         

select * from app.sch_control_task
where control_code in 
('BASS1_G_S_02047_MONTH.tcl'
,'BASS1_G_I_02015_MONTH.tcl'
,'BASS1_G_I_06002_MONTH.tcl'
,'BASS1_G_I_06021_MONTH.tcl'
,'BASS1_G_A_01005_MONTH.tcl'
,'BASS1_G_I_02016_MONTH.tcl'
,'BASS1_G_I_06023_MONTH.tcl'
,'BASS1_G_I_02014_MONTH.tcl'
,'BASS1_G_I_06022_MONTH.tcl')    

where 
	 control_code like '%01005%MONTH%'
or control_code like '%02014%MONTH%'
or control_code like '%02015%MONTH%'
or control_code like '%02016%MONTH%'
or control_code like '%02047%MONTH%'
or control_code like '%06021%MONTH%'
or control_code like '%06022%MONTH%'
or control_code like '%06023%MONTH%'
or control_code like '%06002%MONTH%'



	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	
    
    
   

select * from  app.sch_control_runlog 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)

)
  



update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
)
and 		 date(endtime) < current date
and month(endtime)  = month(current timestamp)

 

update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
)
and date(endtime) < current date
and month(endtime)  = month(current timestamp) 

select * from  app.sch_control_runlog 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')
	and date(endtime) < current date
	and month(endtime)  = month(current timestamp)
    
    

update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')
	and date(endtime) < current date
	and month(endtime)  = month(current timestamp)
		
       

update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20100917'
where user_id = '89160000265019'
and time_id = 201104


update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110321'
where user_id = '89460000740915'
and time_id = 201104



select * from   app.sch_control_task
where control_code = 'BASS1_G_A_01005_MONTH.tcl'       


update  app.sch_control_task a
set  time_value = 310
where control_code in 
('BASS1_G_S_02047_MONTH.tcl'
,'BASS1_G_I_02015_MONTH.tcl'
,'BASS1_G_I_06002_MONTH.tcl'
,'BASS1_G_I_06021_MONTH.tcl'
,'BASS1_G_A_01005_MONTH.tcl'
,'BASS1_G_I_02016_MONTH.tcl'
,'BASS1_G_I_06023_MONTH.tcl'
,'BASS1_G_I_02014_MONTH.tcl'
,'BASS1_G_I_06022_MONTH.tcl')    
and time_value = 312


update  app.sch_control_task a
set  time_value = 310
where control_code in 
('BASS1_G_S_02047_MONTH.tcl'
,'BASS1_G_I_02015_MONTH.tcl'
,'BASS1_G_I_06002_MONTH.tcl'
,'BASS1_G_I_06021_MONTH.tcl'
,'BASS1_G_A_01005_MONTH.tcl'
,'BASS1_G_I_02016_MONTH.tcl'
,'BASS1_G_I_06023_MONTH.tcl'
,'BASS1_G_I_02014_MONTH.tcl'
,'BASS1_G_I_06022_MONTH.tcl')    
and time_value = 312




	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月10日前'
        
        

update  app.sch_control_task a
set time_value = 310
where control_code in 
(
 'BASS1_G_S_22103_MONTH.tcl'
,'BASS1_G_S_22106_MONTH.tcl'
,'BASS1_G_I_02005_MONTH.tcl'
,'BASS1_G_S_22105_MONTH.tcl'
,'BASS1_G_S_22009_MONTH.tcl'
,'BASS1_G_S_22101_MONTH.tcl'
)    
and time_value = 212
        
        
        

select * from   G_I_06021_MONTH
where time_id = 201104

        
        
select time_id,count(0) from    bass1.G_S_02007_month
group by time_id         

111090001333

select  a.product_item_id 
 ,b.offer_id,a.item_type 
 ,b.offer_type 
		from bass2.dim_prod_up_product_item a,
		  bass2.Dim_prod_up_offer b
		where a.item_type = 'OFFER_PLAN' 
		and a.product_item_id = b.offer_id
and a.product_item_id  =     111090001333 



select a.name ,b.*    
                from bass2.dim_prod_up_product_item a,
                  bass2.Dim_prod_up_offer b
                where a.item_type = 'OFFER_PLAN' 
                and a.product_item_id = b.offer_id
                and a.platform_id in (1,2)
                and replace(char(date(a.create_date)),'-','')<='20110430'
                and replace(char(date(b.create_date)),'-','')<='20110430'
                and 
                (extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )
                or  extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )
                
                )
                a.extend_id in(90001331, 90001332, 90001333, 90001334, 90001335, 90001336, 90001337, 90001338, 90001339, 90001340, 90001341, 90001342, 90001343, 90001344, 90001345 )


select * from   bass2.Dim_prod_up_offer where offer_id = 111090001331


select * from    bass2.dim_prod_up_plan_plan_rel
where product_item_id = 111089110016


select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_A_02052_MONTH 
group by  time_id 
order by 1 






declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20100731 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20100731 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1

and f.usertype_id NOT IN ('2010','2020','2030','9000')


select count(0) from    session.int_check_user_status



declare global temporary table session.int_region_flag
    (
   user_id        CHARACTER(15),
   region_flag   CHARACTER(1)
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


insert into session.int_region_flag
select user_id,region_flag
from
(
select time_id,user_id,region_flag
        ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.G_A_02052_MONTH
where time_id<=201007
) a where row_id = 1 



select count(0)
from  session.int_check_user_status a 
join  session.int_region_flag b 
on a.user_id = b.user_id 

1454749





declare global temporary table session.int_check_user_status2
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status2 (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20090731 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20090731 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1



select count(0) from   session.int_region_flag
select count(0) from   session.int_region_flag2



declare global temporary table session.int_region_flag2
    (
   user_id        CHARACTER(15),
   region_flag   CHARACTER(1)
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


insert into session.int_region_flag2
select user_id,region_flag
from
(
select time_id,user_id,region_flag
        ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.G_A_02052_MONTH
where time_id<=200907
) a where row_id = 1 


1217557 row(s) affected.


1454749

values (1454749*1.00/1217557 - 1)

0.1948097707129933136

select * from   session.int_check_user_status 



select count(0) from     bass1.g_i_02018_month
where time_id = 201104
479

select * from     bass1.g_i_02018_month
where time_id = 201104
and 

select * from     bass1.g_i_02019_month
where time_id = 201104

select count(0) from     bass1.g_i_02019_month
where time_id = 201104


 select count(0) dup_cnt
        from (
                select count(0)  cnt
                from bass1.G_I_02018_MONTH
                where time_id =201104
                group by base_prod_id having count(0) > 1
                ) t 




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02021_MONTH 
group by  time_id 
order by 1 

                
                
                

	drop table BASS1.g_i_02019_month_1;
CREATE TABLE BASS1.g_i_02019_month_1(
   base_prod_id BIGINT,
   trademark BIGINT 
) DATA CAPTURE NONE 	 
	 IN TBS_APP_BASS1 INDEX 	 
	 IN TBS_INDEX PARTITIONING KEY(
   base_prod_id 
)USING HASHING;
ALTER TABLE BASS1.g_i_02019_month_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from    bass1.g_i_02019_month_1

                
                

	CREATE TABLE BASS1.g_i_02019_month_2
	 (
		  base_prod_id        bigint,
			base_prod_name      character(200),
			prod_status         character(1),
			prod_begin_time     character(8),
			prod_end_time       character(8),
			platform_id         int,
			trademark           int
	 )
	  DATA CAPTURE NONE
	 IN TBS_APP_BASS1
	 INDEX IN TBS_INDEX
	  PARTITIONING KEY
	   (base_prod_id
	   ) USING HASHING;
ALTER TABLE BASS1.g_i_02019_month_2
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select count(0) from    bass1.g_i_02019_month where time_id = 201104
                
select count(0) from    bass1.g_i_02019_month_2 

		    select distinct
		       base_prod_id
		    from bass1.g_i_02019_month_2
            
               


select * from   app.sch_control_before where control_code like '%G_I_02021_MONTH%'
               
               
select count(0) from    t_int_check_user_status
               
               
              
select   region_flag,sum(c.BASE_BILL_DURATION) BASE_BILL_DURATION
from         t_region_flag a
inner join t_int_check_user_status b on a.user_id = b.user_id
inner join      t_BASE_BILL_DURATION c on b.PRODUCT_NO = c.PRODUCT_NO
group by region_flag
             

select c.REGION_FLAG , sum(BASE_BILL_DURATION) , sum(case when c.USER_ID is null then 1 else 0 end ) no_sts_cnt
from t_BASE_BILL_DURATION a
left join  t_int_check_user_status b on a.product_no = b.PRODUCT_NO 
left join t_region_flag c on b.user_id = c.user_id  
group by  c.REGION_FLAG 



select c.REGION_FLAG , sum(BASE_BILL_DURATION) , sum(case when c.USER_ID is null then 1 else 0 end ) no_sts_cnt
from t_BASE_BILL_DURATION a
left join  t_int_check_user_status b on a.product_no = b.PRODUCT_NO 
left join t_region_flag c on b.user_id = c.user_id  
group by  c.REGION_FLAG 




REGION_FLAG	2
1	227778905
2	298697296
3	138782850
[NULL]	15339226


           
select count(0) from    t_int_check_user_status1003


select count(0) 
,count(distinct a.user_id) tb_user_cnt
,count(distinct b.user_id) tb_region_cnt
,sum(case when a.user_id is not null and b.user_id is null then 1 else 0 end ) no_region_cnt
,sum(case when a.user_id is  null and b.user_id is not null then 1 else 0 end ) no_user_sts_cnt
from   t_int_check_user_status1003 a
full join t_region_flag1003 b  on a.user_id = b.user_id 


db2 RUNSTATS ON table BASS1.t_int_check_user_status1003 	with distribution and detailed indexes all            db2 RUNSTATS ON table BASS1.t_region_flag1003 	with distribution and detailed indexes all             






select c.REGION_FLAG , sum(BASE_BILL_DURATION) , sum(case when c.USER_ID is null then 1 else 0 end ) no_sts_cnt
from t_BASE_BILL_DURATION a
left join t_region_flag c on b.user_id = c.user_id  
left join 
group by  c.REGION_FLAG 


left join  t_int_check_user_status b on a.product_no = b.PRODUCT_NO 




select count(0) 
,count(distinct a.user_id) tb_user_cnt
,count(distinct b.user_id) tb_region_cnt
,count(case when a.user_id is not null and b.user_id is null then a.user_id end ) no_region_cnt
,count(case when a.user_id is not null and b.user_id is not null then a.user_id end ) join_cnt
,sum(case when a.user_id is not null and b.user_id is null then 1 else 0 end ) no_region_cnt
,sum(case when a.user_id is  null and b.user_id is not null then 1 else 0 end ) no_user_sts_cnt
from    (select * from t_int_check_user_status a where  a.TEST_FLAG = '0' ) a
full join t_region_flag b  on a.user_id = b.user_id 


select count(0) from    
t_region_flag

select count(0)    
from t_int_check_user_status a
join t_region_flag c on a.user_id = c.user_id 
1530452


select REGION_FLAG , count(0) 
--,  count(distinct REGION_FLAG ) 
from G_A_02052_MONTH 
group by  REGION_FLAG 
order by 1 



	CREATE TABLE BASS1.g_i_02019_month_4
	 (
		  base_prod_id        bigint
	 )
	  DATA CAPTURE NONE
	 IN TBS_APP_BASS1
	 INDEX IN TBS_INDEX
	  PARTITIONING KEY
	   (base_prod_id
	   ) USING HASHING;
ALTER TABLE BASS1.g_i_02019_month_4
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
create index bass1.idx_g_i_02019_month_4 on BASS1.g_i_02019_month_4(base_prod_id)
   
   drop index bass1.idx_g_i_02019_month_4 
   
   
   select * from    BASS1.g_i_02019_month_4
   
   
   create index idx_ins_off_201104 on bass2.dw_product_ins_off_ins_prod_201104  (offer_id)
   
   
 db2  RUNSTATS ON table BASS2.dw_product_ins_off_ins_prod_201104 	with distribution and detailed indexes all  
   
   
   
select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02021_MONTH 
group by  time_id 
order by 1 

TIME_ID	2
201104	4542241
201103	4490016
201102	4410991
201101	4403127
201012	4325562


201104	4542241



select * from syscat.indexes where tabname = upper('tablename')

select * from SYSCAT.REFERENCES where tabname = upper('tablename')

select * from SYSCAT.TRIGGERS where tabname = upper('tablename')


select bass1_value bass1_offer_id,XZBAS_VALUE
							from  BASS1.ALL_DIM_LKP  b
							where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
                          and bass1_value <> ''
				        and a.BASE_PROD_ID = b.XZBAS_VALUE 
                        
                        

update bass1.g_i_02020_month a
set a.BASE_PROD_ID = (select bass1_value 
							from  BASS1.ALL_DIM_LKP  b
							where b.BASS1_TBID = 'BASS_STD1_0114'
					      and b.bass1_value like 'QW_QQT_JC%'
				        and trim(a.BASE_PROD_ID) = trim(b.XZBAS_VALUE) )
                        

 update bass1.G_I_77780_DAY_MID3 a
 set a.ENTERPRISE_ID = (select b.new_enterprise_id from  BASS1.grp_id_old_new_map_20110330  b 
 				where   a.ENTERPRISE_ID = b.old_enterprise_id )
                
               
select *
from bass2.dual  a 
  left join  bass2.dual c on a.DUMMY = c.DUMMY
  , 
  bass2.dual b 
where a.DUMMY = b.DUMMY


             
             

select count(0)
		from bass2.dw_product_ins_prod_201104 a
	  left join (select xzbas_value  as offer_id ,bass1_value bass1_offer_id
							from  BASS1.ALL_DIM_LKP 
							where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
				      ) d on char(a.offer_id) = d.offer_id 
		    ,(
		    select product_instance_id user_id from bass2.dw_product_ins_prod_201104
		    where state in ('1','4','6','8','M','7','C','9')
		      and user_type_id =1
		      and valid_type = 1
		      and bill_id not in ('D15289014474','D15289014454')
		    except
		    select user_id from bass2.dw_product_test_phone_201104
		    where sts=1
		    ) b
		where a.product_instance_id=b.user_id
		  and a.state in ('1','4','6','8','M','7','C','9')
		  and a.user_type_id =1
		  and a.valid_type = 1
		  and a.bill_id not in ('D15289014474','D15289014454')

             
             
select time_id , count(0) 
--,  count(distinct time_id ) 
from g_i_02020_month 
group by  time_id 
order by 1 

             
             
TIME_ID	2
201104	1623498
201103	1598727
201102	1570869
201101	1568523
201012	1567598

1
1623498

             
             
            
select BASE_PROD_ID , count(0) 
--,  count(distinct BASE_PROD_ID ) 
from g_i_02020_month 
group by  BASE_PROD_ID 
order by 1 


 
 select count(0) from   g_i_02018_month where time_id = 201104
 479+15 = 494 
 
 
 select count(0) from   g_i_02019_month where time_id = 201104
 
 
 
 select * from  BASS1.G_RULE_CHECK where rule_code = 'R002'
 order by 1 desc 
 
 
 
 
 
 	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
        


select b.*
, lower(
 'ls *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'ls *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'
and          upload_time = '每月8日前'




SELECT * FROM ams.payment_0891_1103 WHERE opt_code='4158' AND state=0 
select count(0) from    
BASS2.dw_acct_payment_dm_201102 a
 WHERE opt_code='4158' AND state='0'
 
 

select * from syscat.tables where tabname like '%ODS%PAYMENT%' 


select STAFF_ORG_ID,CHANNEL_ID from   BASS2.dw_acct_payment_dm_201104  

select STAFF_ORG_ID , count(0) 
--,  count(distinct STAFF_ORG_ID ) 
from BASS2.dw_acct_payment_dm_201104 
group by  STAFF_ORG_ID 
order by 1 

select * from   BASS2.dw_acct_payment_dm_201104 



select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from BASS2.dw_acct_payment_dm_201104 
group by  CHANNEL_ID 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22062_MONTH 
group by  time_id 
order by 1 

TIME_ID	2
201103	1147
201102	1065
201101	1101
201012	1179
201011	1198



    select 
     sum(bigint(new_users))*1.0000/1723732*100
     ,sum(bigint(hand_cnt))*1.0000/1723732*100
     ,sum(bigint(card_sale_cnt))*1.0000/1723732*100
     ,sum(bigint(accept_cnt))*1.0000/1723732*100
     ,sum(bigint(term_sale_cnt))*1.0000/1723732*100
     ,sum(bigint(accept_bas_cnt))*1.0000/1723732*100     
     ,sum(bigint(query_bas_cnt))*1.0000/1723732*100     
from g_s_22062_month
where time_id =201104




select   sum(cnt)
  from (
select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users))+
    sum(bigint(hand_cnt))+
    sum(bigint(card_sale_cnt))+
    sum(bigint(accept_cnt))+
    --sum(bigint(imp_accept_cnt))+
    sum(bigint(term_sale_cnt))+
    --sum(bigint(other_sale_cnt))+
    sum(bigint(accept_bas_cnt)) +
    sum(bigint(query_bas_cnt)) cnt
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201104
  and b.time_id =201104
group by accept_type,CHANNEL_STATUS
) t 
   
   
   
   select accept_type,CHANNEL_STATUS,
     sum(bigint(new_users)),
    sum(bigint(hand_cnt)),
    sum(bigint(card_sale_cnt)),
    sum(bigint(accept_cnt)),
    sum(bigint(term_sale_cnt)),
    sum(bigint(other_sale_cnt)),
    sum(bigint(accept_bas_cnt)),
    sum(bigint(query_bas_cnt))
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201104
  and b.time_id =201104
  group by accept_type,CHANNEL_STATUS
  
  
     
   
   select 
     sum(bigint(new_users))
    ,sum(bigint(hand_cnt))
    ,sum(bigint(card_sale_cnt))
    ,sum(bigint(accept_cnt))
    ,sum(bigint(term_sale_cnt))
    ,sum(bigint(other_sale_cnt))
    ,sum(bigint(accept_bas_cnt))
    ,sum(bigint(query_bas_cnt))
from g_s_22062_month a,g_i_06021_month b
where a.CHANNEL_ID=b.CHANNEL_ID
  and a.time_id =201104
  and b.time_id =201104
  
  
  
  
  select staff_org_id
          ,case when opt_code in ('4464','4465','4864','4865') then '2' else '1' end
          ,0
          ,count(distinct payment_id)
          ,sum(amount)
          ,sum(case when opt_code='4158' AND state='0' then 1 else 0 end )
          ,sum(case when opt_code='4158' AND state='0' then amount else 0 end )
          ,0
          ,0
          ,0
          ,0
          ,0
          ,0
          ,0
from BASS2.dw_acct_payment_dm_201104
group by staff_org_id
                  ,case when opt_code in ('4464','4465','4864','4865') then '2' else '1' end



select * from   BASS1.G_S_22062_MONTH


select sum(bigint(card_sale_cnt)) from    BASS1.G_S_22062_MONTH
where time_id = 201105




select * from    BASS2.DW_CHANNEL_INFO_201104 



select * from   ams.scrd_gift_update


select * from   bass2.Dw_product_sc_payment_dm_201103


select * from   bass2.Dwd_product_sc_scorelist_201103


select * from    bass2.dim_pub_channel 



update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月15日前'
)
and  flag = 0 



--重运校验代码
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月15日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)
)




  
  select staff_org_id
          ,sum(case when opt_code='4158' AND state='0' then 1 else 0 end )
from BASS2.dw_acct_payment_dm_201104
group by staff_org_id
having sum(case when opt_code='4158' AND state='0' then 1 else 0 end )
> 0
                  
                  

select * from t_region_flag
where 
user_id 
in 
(
 '89357333501989'
,'89457332997454'
,'89657333835100'
,'89557333500619'
,'89157333653495'
,'89501150037395'
,'89401140015226'
,'89157332357663'
,'89157333426659'
,'89257332794215'
,'89457332253242'
,'89657332860422'
,'89357334150278'
,'89357334219964'
,'89257333683395'
,'89157333830554'
,'89157333760965'
,'89757333409956'
)





select b.*
                 from
                (
                 select user_id,usertype_id from
                 (
                  select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id
                  from bass1.G_A_02008_DAY
                  where time_id<=20110331
                 ) k
                where k.row_id=1 
                ) a
                inner join (select distinct user_id from G_A_02004_DAY
                where time_id<=20110331
                ) c
                 on a.user_id=c.user_id
                
                left outer join (select user_id,region_flag
                from
                (
                select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
                from bass1.G_A_02052_MONTH
                ) k
                where k.row_id=1) b
                 on a.user_id=b.user_id
                  and b.REGION_FLAG in('1','2','3')
                where  a.usertype_id not in ('2010','2020','2030','9000')
and  
a.user_id 
in 
(
 '89357333501989'
,'89457332997454'
,'89657333835100'
,'89557333500619'
,'89157333653495'
,'89501150037395'
,'89401140015226'
,'89157332357663'
,'89157333426659'
,'89257332794215'
,'89457332253242'
,'89657332860422'
,'89357334150278'
,'89357334219964'
,'89257333683395'
,'89157333830554'
,'89157333760965'
,'89757333409956'
,'89457332338084'
,'89257333515849'
)
                with ur
                
                  
select * from                     
t_int_check_user_status a
where 
a.user_id 
in (
		 '89357333501989'
		,'89457332997454'
		,'89657333835100'
		,'89557333500619'
		,'89157333653495'
		,'89501150037395'
		,'89401140015226'
		,'89157332357663'
		,'89157333426659'
		,'89257332794215'
		,'89457332253242'
		,'89657332860422'
		,'89357334150278'
		,'89357334219964'
		,'89257333683395'
		,'89157333830554'
		,'89157333760965'
		,'89757333409956'
        ,'89457332338084'
        ,'89257333515849'
        )
                with ur
                


select b.*
                 from
                (
	                 select user_id,usertype_id from
	                 (
	                  select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id
	                  from bass1.G_A_02008_DAY
	                  where time_id<=20110331
	                 ) k
                where k.row_id=1 
                ) a
                inner join (
		                select distinct user_id from G_A_02004_DAY
		                where usertype_id<>'3'
		                and time_id<=20110331               
			   ) c
                 on a.user_id=c.user_id
                left outer join 
		(
			select user_id,region_flag
			from
			(
				select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
				from bass1.G_A_02052_MONTH
	                ) k
	                where k.row_id=1
                ) b on a.user_id=b.user_id and b.REGION_FLAG in('1','2','3')
                where  a.usertype_id not in ('2010','2020','2030','2040','9000')
		and a.user_id in 
		(
		 '89357333501989'
		,'89457332997454'
		,'89657333835100'
		,'89557333500619'
		,'89157333653495'
		,'89501150037395'
		,'89401140015226'
		,'89157332357663'
		,'89157333426659'
		,'89257332794215'
		,'89457332253242'
		,'89657332860422'
		,'89357334150278'
		,'89357334219964'
		,'89257333683395'
		,'89157333830554'
		,'89157333760965'
		,'89757333409956'
,'89457332338084'
,'89257333515849'        
		)
                with ur                  
                
                
                
                

select a.*,b.*
                 from
                (
	                 select user_id,usertype_id from
	                 (
	                  select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id
	                  from bass1.G_A_02008_DAY
	                  where time_id<=20110331
	                 ) k
                where k.row_id=1 
                ) a
                inner join (
		                select distinct user_id from G_A_02004_DAY
		                where time_id<=20110331               
			   ) c
                 on a.user_id=c.user_id
                left outer join 
		(
			select user_id,region_flag
			from
			(
				select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
				from bass1.G_A_02052_MONTH
	                ) k
	                where k.row_id=1
                ) b on a.user_id=b.user_id 
                where  a.user_id 
in (
		 '89357333501989'
		,'89457332997454'
		,'89657333835100'
		,'89557333500619'
		,'89157333653495'
		,'89501150037395'
		,'89401140015226'
		,'89157332357663'
		,'89157333426659'
		,'89257332794215'
		,'89457332253242'
		,'89657332860422'
		,'89357334150278'
		,'89357334219964'
		,'89257333683395'
		,'89157333830554'
		,'89157333760965'
		,'89757333409956'
        ,'89457332338084'
        ,'89257333515849'
        )
                with ur                
                
                
                

			select count(0)
			from
			(
				select user_id,region_flag,row_number()over(partition by user_id order by time_id desc) row_id 
				from bass1.G_A_02052_MONTH where time_id <= 201103
	                ) k
	                where k.row_id=1
                    
                    

select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_A_02052_MONTH 
group by  time_id 
order by 1 

select length(trim(user_id)) , count(0) 
--,  count(distinct length(user_id) ) 
from bass1.G_A_02052_MONTH 
group by  length(trim(user_id))
order by 1 



select * from    bass2.dw_channel_local_busi_201104


select channel_id,count(0) from   bass2.dw_channel_local_busi_201104
group by channel_id


DW_CHANNEL_INFO_


select * from channel.CHANNEL_LOCAL_BUSI @dbl_ggdb 
where 1=1 and entity_type in(72,73 ) and rec_status=1
/*ext_field1  充值卡序列号
ext_field7  充值卡面值 单位分
ext_field9  渠道编号
*/





select * from   bass2.dw_channel_local_busi_201104
where  entity_type in(72,73 ) and rec_status=1
group by CHANNEL_ID


select * from   BASS2.DW_CHANNEL_INFO_201104  a,
(select CHANNEL_ID channel_id, count(0) from   bass2.dw_channel_local_busi_201104
where  entity_type in(72,73 ) and rec_status=1
group by CHANNEL_ID
) b 
where a.CHANNEL_ID = b.CHANNEL_ID
                    
select tabname from syscat.tables where tabname like '%DW_CHANNEL_LOCAL_BUSI_%'                     

select * from   app.sch_control_task 
where control_code like '%local_busi%'

select * from   bass2.dw_channel_local_busi_201104

select * from   bass2.ods_channel_local_busi_20110430



select * from   bass2.ODS_CHANNEL_LOCAL_BUSI_20110430


select * from   bass2.dw_product_ord_so_log_dm_201104


select * from   bass2.ETL_LOAD_TABLE_MAP
where upper( boss_table_name) like '%AMS%'



select upper( substr(task_id,2)) from   bass2.ETL_LOAD_TABLE_MAP
where upper( substr(task_id,2)) like '11%'




select upper( substr(task_id,2)) from   bass2.ETL_LOAD_TABLE_MAP
where upper( substr(task_id,2)) like '11%'

select * from  bass2.ETL_LOAD_TABLE_MAP
where task_id like '%11222%'



SELECT MAX(TABLE_ID) FROM bass2.USYS_TABLE_MAINTAIN



/**	2011-5-4 14:16	added by  panzhiwei	**/
--DROP TABLE bass1.ODS_SC_SCRD_ORD_INFO_YYYYMM;			
CREATE TABLE bass2.ODS_SC_SCRD_ORD_INFO_201103 (			
op_time	VARCHAR(8)	--CBOSS入数据必须填此字段	
,ORD_SEQ	VARCHAR(20)	--订单号	
,SUB_ORD_SEQ	VARCHAR(20)	--非异常订单填空	
,MOB_NUM	VARCHAR(50)	--用户手机号码 	
,ORDER_SUM_POINT	BIGINT	--订单应扣总积分 	
,ORD_TYPE	SMALLINT	--01:正常订单02:异常订单"	
,EXP_ORD_TYPE	VARCHAR(10)	--01-拒收退货 02-拒收换货 03-事后退货 04-事后换货	
,EXP_REASON	VARCHAR(10)	--01―物流商  02―礼品商 03―客户	
,ORD_STS	VARCHAR(6)	--正常订单：001-待处理  002―正在处理订单  003-已发货 004―已签收  005―撤销  006―用户拒收  007―拒收退单  008―拒收换货  009―无人签收 011―无人签收积分回滚成功  012―撤销积分回滚成功 013―省内拒收积分回滚成功	
,ORG_ID	VARCHAR(10)	--0001  积分平台0002  短信渠道0003  CRM渠道0004  WAP渠道"	
,ITEM_ID	VARCHAR(16)	--礼品ID	
,ITEM_NAME	VARCHAR(256)	--礼品名称 	
,ITEM_TYPE	VARCHAR(2)	--礼品分类：01全网、02省内	
,ITEM_POINT	BIGINT	--积分 	
,ITEM_POINT_VALUE	BIGINT	--积分价值 	
,TYPE1	VARCHAR(10)	--00:实物类,01:自有类,02:合作类	
,ITEM_E_PRICE	decimal(10,2)	--兑换价格	
,ITEM_G_POINT	INTEGER	--全球通积分值	
,ITEM_M_POINT	INTEGER	--动感地带M值	
,ITEM_B_PRICE	decimal(10,2)	--支付价格	
,ITEM_STATUS	SMALLINT	--礼品状态0-未上线,1-上线,2-人工下线,3-自动下线(缺货),4-预上线,5-预下线,6-预下线转自动下线"	
 )
  DATA CAPTURE NONE
 IN TBS_3H
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   ( ord_seq,mob_num )
 USING HASHING;
INSERT INTO etl_load_table_map 
VALUES(
   'M11222',
   'ODS_SC_SCRD_ORD_INFO_YYYYMM',
   '统一积分平台订单',
   0,
   'AMS.SCRD_ORD_INFO_YYYYMMDD' 
   );
INSERT INTO bass2.etl_load_table_map 
VALUES(
   'M11222',
   'ODS_SC_SCRD_ORD_INFO_YYYYMM',
   '统一积分平台订单',
   0,
   'AMS.SCRD_ORD_INFO_YYYYMMDD' 
   );
INSERT INTO bass2.USYS_TABLE_MAINTAIN 
VALUES(
   11038,
   '统一积分平台订单',
   'ODS_SC_SCRD_ORD_INFO',
   '1',
   'month',
   255,
   '0',
   '',
   '',
   'BASS2',
   'ODS_SC_SCRD_ORD_INFO_YYYYMM',
   'TBS_3H',
   'TBS_INDEX',
   'ORD_SEQ,MOB_NUM',
   1 
   );
INSERT INTO app.sch_control_task 
VALUES(
   'TR1_L_11222',
   1,
   2,
   'ODS_SC_SCRD_ORD_INFO_YYYYMM',
   0,
   - 1,
   '统一积分平台订单',
   '-',
   'TR1_BOSS',
   2,
   '-' 
   );
java ETLMain 20110300 taskList_tmp_pzw.properties




select * from   bass2.ODS_SC_SCRD_ORD_INFO_201103


select ITEM_TYPE , count(0) 
--,  count(distinct ITEM_TYPE ) 
from bass2.ODS_SC_SCRD_ORD_INFO_201104 
group by  ITEM_TYPE 
order by 1 

ITEM_TYPE	2
01	17


select type1 , count(0) 
--,  count(distinct type1 ) 
from bass2.ODS_SC_SCRD_ORD_INFO_201104 
group by  type1 
order by 1 

TYPE1	2
00	12
	5

case 
when type1 = '实物类' then '00'
when type1 = '自有类' then '01'
when type1 = '合作类' then '02'
else type1 end type1 



2
BOSSBOSSBOSS 4.2
4.2.1BOSS
ItemType0102Type100
0102ITEMIDITEMID ItemTypeType1


case when 


select
				 mob_num 
				,ITEM_TYPE
				,case 
					when type1 = '实物类' then '00'
					when type1 = '自有类' then '01'
					when type1 = '合作类' then '02'
					else type1 end type1 
				,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
				,count(distinct ORD_SEQ)  cnt
	 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
	 			  group by 
				 mob_num 
				,ITEM_TYPE
				,case 
					when type1 = '实物类' then '00'
					when type1 = '自有类' then '01'
					when type1 = '合作类' then '02'
					else type1 end 
 
from                   
(                   
select mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00' feedback_id
,sum(ORDER_SUM_POINT)  used_point
,sum(cnt) feedback_cnt 
from 
(
select
				 mob_num 
				,ITEM_TYPE
				,case 
					when type1 = '实物类' then '00'
					when type1 = '自有类' then '01'
					when type1 = '合作类' then '02'
					else type1 end type1 
				,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
				,count(distinct ORD_SEQ)  cnt
	 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
	 			  group by 
				 mob_num 
				,ITEM_TYPE
				,case 
					when type1 = '实物类' then '00'
					when type1 = '自有类' then '01'
					when type1 = '合作类' then '02'
					else type1 end 
) t
group by                    
mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00'
)a





select 
	  a.feedback_id,
	  b.user_id,
	  sum(a.used_point),
	  sum(a.feedback_cnt)
	from (                   
					select mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00' feedback_id
					,sum(ORDER_SUM_POINT)  used_point
					,sum(cnt) feedback_cnt 
						from 
						(
						select
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end type1 
										,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
										,count(distinct ORD_SEQ)  cnt
							 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
							 			  group by 
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end 
                                            having sum(value(ORDER_SUM_POINT,0)) > 0
						) t
						group by                    
						mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00'
						) a, 
	 bass2.dw_product_201104 b
	 where a.mob_num = b.product_no
	    and b.userstatus_id in (1,2,3,6,8) 
		  and b.usertype_id in (1,2,9) 
		  and b.test_mark=0
         
group by 	  a.feedback_id,
	  b.user_id         
      
      
      
      
      select 
	  a.feedback_id,
	  b.user_id,
	  sum(a.used_point),
	  sum(a.feedback_cnt)
	from (                   
					select mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00' feedback_id
					,sum(ORDER_SUM_POINT)  used_point
					,sum(cnt) feedback_cnt 
						from 
						(
						select
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end type1 
										,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
										,count(distinct ORD_SEQ)  cnt
							 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
							 			where substr(OP_TIME,1,6) = '201104'
							 			  group by 
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end 
						) t
						group by                    
						mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00'
						) a, 
	 bass2.dw_product_201104 b
	 where a.mob_num = b.product_no
	    and b.userstatus_id in (1,2,3,6,8) 
		  and b.usertype_id in (1,2,9) 
		  and b.test_mark=0
         
group by 	  a.feedback_id,
	  b.user_id
	
    
    
    select * from   bass1.G_S_02007_month
    where time_id = 201104
    
    


select * from channel.CHANNEL_LOCAL_BUSI @dbl_ggdb 
where 1=1 and entity_type in(72,73 ) and rec_status=1
/*ext_field1  充值卡序列号
ext_field7  充值卡面值 单位分
ext_field9  渠道编号
*/

    
    

select count(0),count(distinct ord_seq||mob_num) from     bass2.ODS_SC_SCRD_ORD_INFO_201104
  
  
  select count(0) from    bass2.DW_SC_SCRD_ORD_INFO_201104
  
  
  

select 
	  a.feedback_id,
	  b.user_id,
	  sum(a.used_point),
	  sum(a.feedback_cnt)
	from (                   
					select mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00' feedback_id
					,sum(ORDER_SUM_POINT)  used_point
					,sum(cnt) feedback_cnt 
						from 
						(
						select
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end type1 
										,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
										,count(distinct case when value(ORDER_SUM_POINT,0) > 0 then  ORD_SEQ||mob_num  end )  cnt
							 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
							 			where substr(OP_TIME,1,6) = '201104'
							 			  group by 
										 mob_num 
										,ITEM_TYPE
										,case 
											when type1 = '实物类' then '00'
											when type1 = '自有类' then '01'
											when type1 = '合作类' then '02'
											else type1 end 
										having sum(value(ORDER_SUM_POINT,0)) > 0
						) t
						group by                    
						mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00'
						) a, 
	 bass2.dw_product_201104 b
	 where a.mob_num = b.product_no
	    and b.userstatus_id in (1,2,3,6,8) 
		  and b.usertype_id in (1,2,9) 
		  and b.test_mark=0
group by 	  a.feedback_id,
	  b.user_id
	
  
  
  select  USER_ID
  ,USED_POINT
  ,bigint(T_USED_POINT)
  +bigint(T_USED_POINT)
  +bigint(TTWO_USED_POINT)
  from   bass1.G_S_02007_month
  where time_id = 201103
  and 
    bigint(USED_POINT) < (
  bigint(T_USED_POINT)
  +bigint(T_USED_POINT)
  +bigint(TTWO_USED_POINT)
  )
  
  
  
  
  
  
  CREATE TABLE "BASS1   "."G_S_02007_MONTH_B20110504"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "POINT_FEEDBACK_ID" CHAR(4) NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "USED_POINT" CHAR(8) NOT NULL , 
                  "T_USED_POINT" CHAR(8) NOT NULL , 
                  "TONE_USED_POINT" CHAR(8) NOT NULL , 
                  "TTWO_USED_POINT" CHAR(8) NOT NULL , 
                  "TTHREE_USED_POINT" CHAR(8) NOT NULL , 
                  "USED_COUNT" CHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into "BASS1   "."G_S_02007_MONTH_B20110504" 
select * from G_S_02007_MONTH







select POINT_FEEDBACK_ID , count(0) 
--,  count(distinct POINT_FEEDBACK_ID ) 
from G_S_02007_MONTH 
group by  POINT_FEEDBACK_ID 
order by 1 



update app.g_runlog 
set return_flag = 0
where time_id= in (201101,201102,201102)
and return_flag=1
and unit_code = '02007'


select * from app.g_runlog 
where time_id in (201101,201102,201103)
and unit_code = '02007'

update app.g_runlog 
set return_flag = 0
where time_id between 20110701 and 20110824
and return_flag=1
and unit_code = '22091'



select 
          a.feedback_id,
          b.user_id,
          sum(a.used_point),
          count(distinct mob_num||feedback_id) feedback_cnt
        from (                   
                                        select mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00' feedback_id
                                        ,sum(ORDER_SUM_POINT)  used_point
                                                from 
                                                (
                                                select
                                                                                 mob_num 
                                                                                ,ITEM_TYPE
                                                                                ,case 
                                                                                        when type1 = 'êμ??àà' then '00'
                                                                                        when type1 = '×?óDàà' then '01'
                                                                                        when type1 = 'o?×÷àà' then '02'
                                                                                        else type1 end type1 
                                                                                ,sum(value(ORDER_SUM_POINT,0)) ORDER_SUM_POINT
                                                         from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
                                                                                where substr(OP_TIME,1,6) = '201104'
                                                                                  group by 
                                                                                 mob_num 
                                                                                ,ITEM_TYPE
                                                                                ,case 
                                                                                        when type1 = 'êμ??àà' then '00'
                                                                                        when type1 = '×?óDàà' then '01'
                                                                                        when type1 = 'o?×÷àà' then '02'
                                                                                        else type1 end 
                                                                                having sum(value(ORDER_SUM_POINT,0)) > 0
                                                ) t
                                                group by                    
                                                mob_num,substr(ITEM_TYPE,2,1)||cast(int(substr(type1,2,1))+1 as char(1))||'00'
                                                ) a, 
         bass2.dw_product_201104 b
         where a.mob_num = b.product_no
            and b.userstatus_id in (1,2,3,6,8) 
                  and b.usertype_id in (1,2,9) 
                  and b.test_mark=0
group by          a.feedback_id,
          b.user_id
        
        
        
        
        


select
type1,count(0)
							 from bass2.ODS_SC_SCRD_ORD_INFO_201104 a
							 			where substr(OP_TIME,1,6) = '201104'
							 			  group by 
type1



select * from   bass2.DW_PRODUCT_SP_INFO_201104


TIME_ID	2
201012	6421
201101	1880
201102	816
201103	1086
201104	1128


TIME_ID	2
201012	6421
201101	2144
201102	983
201103	1259
201104	1128




update app.g_runlog 
set return_flag = 0
where time_id in (201101,201102,201103)
and return_flag=1
and unit_code = '02007'






select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_02007_MONTH 
group by  time_id 
order by 1 


select count(0),count(distinct POINT_FEEDBACK_ID||USER_ID) from    G_S_02007_MONTH
where time_id = 201101




select * from   app.g_runlog 
where time_id = 201101
and unit_code = '02007'



select * from   app.g_runlog 
where time_id = 201102
and unit_code = '02007'



select * from syscat.tables where tabname like '%DIM%STAFF%' 


select * from   app.g_runlog 
where time_id = 201103
and unit_code = '02007'


select * from   bass2.DIM_BOSS_STAFF


select * 
                        from  BASS2.dw_channel_local_busi_201104
                        where entity_type in(72,73 ) and rec_status=1


      select 
            CHANNEL_ID
                                                ,'1'
                                                ,0
                                                ,0
                                                ,0
                                                ,count(0)
                                                ,sum(value(card_value,0)/100)
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                        from  BASS2.dw_channel_local_busi_201104
                        where entity_type in(72,73 ) and rec_status=1
                        group by CHANNEL_ID
                        


      select 
            CHANNEL_ID
                                                ,'1'
                                                ,0
                                                ,0
                                                ,0
                                                ,count(0)
                                                ,sum(value(card_value,0)/100)
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                                                ,0
                        from  BASS2.dw_channel_local_busi_201104
                        where entity_type in(72,73 ) and rec_status=1
                        and substr(char(date(done_date)),1,7) = '2011-04'
                        group by CHANNEL_ID




                        int(replace(char(current date - 1 days),'-',''))
                        
                        
                        
select date(done_date),count(0)
from BASS2.dw_channel_local_busi_201104
group by      date(done_date)
                    
                    
                    
                    

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and manage_mod = '2'
and ent_busi_id = '1220'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and manage_mod = '2'
and ent_busi_id = '1220'
) t
                    
                    
                    select count(0)
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
from 
(
select * from G_A_02061_DAY
where ENTERPRISE_BUSI_TYPE = '1220'
and  MANAGE_MODE = '2'
and length(trim(user_id)) = 14
) t
) t2
where rn = 1 and STATUS_ID ='1'


SELECT * FROM bass1.MON_ALL_INTERFACE  t
WHERE t.INTERFACE_CODE not IN (
select substr(a.control_code,15,5) from   app.sch_control_runlog  A
where control_code like 'BASS1_EXP%MONTH'
AND date(a.begintime) < '2011-05-01'
and date(a.begintime) > '2011-04-01'
AND FLAG = 0
)
AND TYPE='m'



select * from syscat.tables where tabname like '%RUNNING%' 

select * from   bass2.ETL_TASK_RUNNING
where cycle_id  = '20110503'





	              select user_id,char(LOCNTYPE_ID)
	                from bass2.STAT_ZD_VILLAGE_USERS_201104
                      where month_new_mark = 1
                      
                      
select count(0) from    bass2.STAT_ZD_VILLAGE_USERS_201104

select count(0) from    bass2.STAT_ZD_VILLAGE_USERS_201109


                      
                      
select *  from   bass2.ODS_AS_WORK_ACCEPT_20110503 where                
length(ACCEPT_DETAIL) = 2000

                     

                     
                     

	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
        and a.INTERFACE_CODE = '22081'
        

	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
        and a.INTERFACE_CODE = '05001'
        
update  app.sch_control_task
set time_value = 510
where  time_value = 112
and control_code = 'BASS1_G_S_05002_MONTH.tcl'
                   
                   

	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
                           
select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and( month(a.begintime) =  month(current date) or  month(a.begintime) = 04 )
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'
and deadline = 10


select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
, lower(
 ' *'||b.interface_code||'*dat \' 
) list
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (5)
and type = 'm'




select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (15)
and type = 'm'
and sts = 1

select * from   G_S_22039_MONTH
order by 2 desc ,3


select * from   g_s_21004_day

select * from   mon_all_interface where interface_code = '04014'


where UNIT_CODE in 
(
 '22085'
,'22081'
,'22083'
)
                           
update app.sch_control_task 
set time_value = 510
where CONTROL_CODE in (
select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.INTERFACE_CODE   
in 
(
 '22085'
,'22081'
,'22083'
)
)
and       time_value = -1
             

select t.*,substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1
            

select * from   app.sch_control_runlog where control_code like '%02052%'            
select * from   app.sch_control_runlog where control_code like '%22081%'            

select * from   app.sch_control_runlog where control_code in (
select BEFORE_CONTROL_CODE from   app.sch_control_before where control_code = 'BASS1_G_S_22081_MONTH.tcl'
)



select * from   app.sch_control_before where control_code = 'BASS2_Dw_product_sp_info_ms.tcl'



select * from   app.sch_control_runlog where control_code = 'TR1_L_11039'

select * from   app.sch_control_runlog where control_code = 'TR1_L_11039'

select a.*,b.*,c.*
from app.sch_control_task a 
left join app.sch_control_runlog b  on  a.CONTROL_CODE = b.CONTROL_CODE 
left join app.sch_control_before c  on  a.CONTROL_CODE = c.CONTROL_CODE
where a.control_code = 'BASS1_G_A_02052_MONTH.tcl'


update app.sch_control_task a 
set cc_flag = 1
where a.control_code = 'TR1_L_11039'


select * from   bass2.ODS_PRODUCT_SP_INFO_201104


select * from   bass2.Dw_product_sp_info_201104


               
update app.sch_control_task  a
set time_value = 510
where a.control_code = 'BASS1_G_A_02052_MONTH.tcl'
and       time_value = 512

BASS1.MON_ALL_INTERFACE
alter table bass1.MON_ALL_INTERFACE add column remarks varchar(1000)

select * from  bass1.MON_ALL_INTERFACE
where interface_code = '21008'





select time_id,count(0) from   G_S_03012_MONTH
group by time_id




select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_a_02004_day 
group by  time_id 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_a_02008_day 
group by  time_id 
order by 1 


select * from   bass1.G_S_21008_MONTH



	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	
    
    
    
    

	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
        
    
    
    update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月3日前'
)


update  app.sch_control_runlog 
set flag = -2 
select * from app.sch_control_runlog 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
        and  INTERFACE_CODE
in(
'22040'
,'22085'
,'02017'
,'03018'
,'22305'
,'03017'
,'22072'
,'21020'
,'21011'
,'22304'
,'22401'
,'21012'
,'22303'
,'22036'
,'03012'
,'22306'
,'02007'
,'02006'
,'21006'
,'21008'
,'22204'
,'03015'
,'22307'
,'03016')
)
and  flag not in (0,-2)



update  app.sch_control_runlog 
set flag = -2 
--select * from app.sch_control_runlog 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)
)





update  app.sch_control_runlog 
set flag = -2 
--select * from app.sch_control_runlog 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
                                and INTERFACE_CODE
in(
'22040'
,'22085'
,'02017'
,'03018'
,'22305'
,'03017'
,'22072'
,'21020'
,'21011'
,'22304'
,'22401'
,'21012'
,'22303'
,'22036'
,'03012'
,'22306'
,'02007'
,'02006'
,'21006'
,'21008'
,'22204'
,'03015'
,'22307'
,'03016')
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)        
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')

\
select * from bass1.mon_all_interface
where interface_code in ('02017','03012','21006','22040','22306','22401')


alter table bass1.MON_ALL_INTERFACE add column deadline smallint

alter table bass1.MON_ALL_INTERFACE add column deadline smallint



select upload_time , count(0) 
--,  count(distinct upload_time ) 
from bass1.MON_ALL_INTERFACE 
group by  upload_time 
order by 1 
UPLOAD_TIME
8
5
3
15
10

15
13
11

select * from    bass1.MON_ALL_INTERFACE 
where type = 'm'
and deadline = 8
and  interface_code  in 
(select substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1)



update   bass1.MON_ALL_INTERFACE a
set deadline = (
select 
case 
when UPLOAD_TIME = '每日9点前' then 9
when UPLOAD_TIME = '每日11点前' then 11
when UPLOAD_TIME = '每日13点前' then 13
when UPLOAD_TIME = '每日15点前' then 15
when UPLOAD_TIME = '每月3日前' then 3
when UPLOAD_TIME = '每月5日前' then 5
when UPLOAD_TIME = '每月8日前' then 8
when UPLOAD_TIME = '每月10日前' then 10
when UPLOAD_TIME = '每月11日前' then 11
when UPLOAD_TIME = '每月15日前' then 15
end deadline
from  bass1.MON_ALL_INTERFACE b where a.INTERFACE_CODE = b.INTERFACE_CODE and a.type = b.type) 




select * from   app.sch_control_before where control_code = 'BASS1_G_A_02052_MONTH.tcl'




select * from    app.g_runlog 
where time_id in (201103)
and return_flag=1
and unit_code in ('03017','03018')





select * from   app.sch_control_runlog_his
where control_code like '%BASS1_INT_CHECK_Z345_DAY.tcl%'


select * from   app.g_file_report
where filename like '%03017%'


select BUSI_BILLING_TYPE , count(0) 
--,  count(distinct BUSI_BILLING_TYPE ) 
from G_S_22083_MONTH 
group by  BUSI_BILLING_TYPE 
order by 1 



select * from    bass1.G_S_22083_MONTH


select bill_flag , count(0) 
--,  count(distinct bill_flag ) 
from bass1.G_S_22083_MONTH_2 
group by  bill_flag 
order by 1 

select * from (

                 select      201104 TIME_ID
                             ,'201104' op_time
                             ,a.BUSI_CODE
                             ,c.OPERATOR_NAME BUSI_NAME
                             ,d.SP_NAME BUSI_PROVIDER_NAME
                             ,case when b.bill_flag = 3 and DELAY_TIME = 72 then '11' 
                                        when b.bill_flag = 3 and b.DELAY_TIME = 0 then '12'
                                                                        else '20' end  BUSI_BILLING_TYPE                             , b.BILL_FLAG f1,c.BILL_FLAG f2
                             ,char(sum(a.CANCEL_CNT))   CANCEL_CNT 
                             ,char(sum(a.COMPLAINT_CNT)) COMPLAINT_CNT   
                             ,char(sum(value(e.ORDER_CNT,0))) ORDER_CNT      
                        			from   bass1.G_S_22083_MONTH_1 a 
			       join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
			       join bass2.DIM_PM_SP_OPERATOR_CODE c on  a.SP_ID = char(c.SP_CODE) and a.BUSI_CODE = c.OPERATOR_CODE
				JOIN BASS1.G_S_22083_MONTH_3 D ON a.sp_id = d.SP_CODE
				left join BASS1.G_S_22083_MONTH_4 e on a.sp_id = e.SP_ID and a.BUSI_CODE = b.BUSI_CODE
			group by 
                     a.BUSI_CODE
                     ,c.OPERATOR_NAME 
                     ,d.SP_NAME
                     , b.BILL_FLAG,c.BILL_FLAG
                     ,case when b.bill_flag = 3 and DELAY_TIME = 72 then '11' 
                                when b.bill_flag = 3 and b.DELAY_TIME = 0 then '12'
                                                                else '20' end      
                                                                ) t 
                                                                where f1 <> f2
                                                                

                                                                

select * from app.sch_control_before where control_code = 'BASS1_REPORT_KEY_INDEX_MONTH.tcl'

SELECT * FROM app.sch_control_RUNLOG
WHERE control_code IN (
select BEFORE_CONTROL_CODE  from app.sch_control_before where control_code = 'BASS1_G_S_22302_DAY.tcl'
)

BASS2_Dw_enterprise_industry_apply.tcl



SELECT * FROM app.sch_control_RUNLOG
WHERE control_code IN (
select BEFORE_CONTROL_CODE  from app.sch_control_before where 
control_code like 'BASS1_G_I_02018_MONTH.tcl'
)



select * from    app.sch_control_before
where control_code like '%02018%'


select *  from app.sch_control_runlog where control_code = 'BASS1_G_I_02018_MONTH.tcl'


select time_id,count(0)
from BASS1.G_S_22302_DAY
group by time_id 
order by 1 desc 



alter table BASS1.G_S_04003_DAY ALTER column FLOWUP 	SET DATA TYPE CHARACTER(13)
alter table BASS1.G_S_04003_DAY ALTER column FLOWDOWN  SET DATA TYPE CHARACTER(13)

FLOWUP                         SYSIBM    CHARACTER                13     0 No    
FLOWDOWN                       SYSIBM    CHARACTER                13     0 No   



select time_id , count(0) from   BASS1.G_USER_LST
group by time_id 





select ent_busi_type from   BASS1.G_S_22302_DAY where time_id = 20110501
except   
select ent_busi_type from   BASS1.G_S_22302_DAY where time_id = 20110430




select ent_busi_type,count(0)
from BASS1.G_S_22302_DAY
where time_id = 20110501
group by ent_busi_type 
order by 1 desc 




select ent_busi_type,count(0)
from BASS1.G_S_22302_DAY
where time_id = 20110430
group by ent_busi_type 
order by 1 desc 






select * from app.g_unit_info
where unit_code in ('02022','02023','22080','22082','22084')

update app.g_unit_info
set table_name = lower(table_name)
where unit_code in ('22081','22083','2208')





select * from   g_s_04003_day where time_id = 20110502


select over_prod_id , bigint(over_prod_id) from bass1.g_i_02019_month b  where  b.time_id = 201104




CREATE TABLE "BASS1   "."G_S_04003_DAY_B20110504"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "HOME_LOCN" CHAR(6) NOT NULL , 
                  "ROAM_LOCN" CHAR(6) NOT NULL , 
                  "USER_TYPE" CHAR(1) NOT NULL , 
                  "ROAM_TYPE_ID" CHAR(3) NOT NULL , 
                  "START_DATE" CHAR(8) NOT NULL , 
                  "START_TIME" CHAR(6) NOT NULL , 
                  "END_DATE" CHAR(8) NOT NULL , 
                  "END_TIME" CHAR(6) NOT NULL , 
                  "CALL_DURATION" CHAR(6) NOT NULL , 
                  "FLOWUP" CHAR(13) NOT NULL , 
                  "FLOWDOWN" CHAR(13) NOT NULL , 
                  "SVCITEM_ID" CHAR(2) NOT NULL , 
                  "SERVICE_CODE" CHAR(2) NOT NULL , 
                  "WLAN_ATTESTATION_CODE" CHAR(2) NOT NULL , 
                  "HOTSPOT_AREA_ID" CHAR(16) NOT NULL , 
                  "AS_IP" CHAR(8) NOT NULL , 
                  "ATTESTATION_AS_IP" CHAR(8) NOT NULL , 
                  "CALL_FEE" CHAR(6) NOT NULL , 
                  "INFO_FEE" CHAR(6) NOT NULL , 
                  "SERVICE_ID" CHAR(8) NOT NULL , 
                  "ISP_ID" CHAR(6) NOT NULL , 
                  "BELONG_OPER_ID" CHAR(5) NOT NULL , 
                  "ROAM_OPER_ID" CHAR(5) NOT NULL , 
                  "REASON_OF_STOP_CODE" CHAR(2) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "PRODUCT_NO")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
insert into G_S_04003_DAY_B20110504
select * from G_S_04003_DAY

select count(0) from    G_S_04003_DAY_B20110504
select count(0) from    G_S_04003_DAY


select * from    G_S_04003_DAY
where time_id = 20110503





select count(0) from    G_S_02007_MONTH
where time_id = 201104


select POINT_FEEDBACK_ID , count(0) 
--,  count(distinct POINT_FEEDBACK_ID ) 
from G_S_02007_MONTH 
group by  POINT_FEEDBACK_ID 
order by 1 


select count(0) from    G_S_02007_MONTH
where 
time_id = ''
POINT_FEEDBACK_ID
not in 
('2210','2220','2230','2240','2250'
,'1100','1200','1300','2100','2100')


                select count(0) 
                from    G_S_02007_MONTH
                where 
                time_id = 201104
                and POINT_FEEDBACK_ID   not in ('2210','2220','2230','2240','2250'
                                                                ,'1100','1200','1300','2100','2100')
                                                                
                                                                


                                                                                                          
                                                                                                          
	select *
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
    ,app.sch_control_runlog c 
	where a.INTERFACE_CODE = substr(b.control_code , 11,5)
    and b.control_code = c.control_code 
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月10日前'
        
                                                                                                                  
                                                                                                                  
                                                                                                                  

	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月10日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月10日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月10日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	

                                                                                                                  
                                                                                                                  
                                                                                                                  
                                                                                                                  
                                                                                                                  

update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月10日前'
)
and  flag = 0 
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')


                                                                                                                  
                                                                                                                  
                                                                                                                  
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)
)



update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月10日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)
)


                                                                                                                  

update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月10日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)
and control_code not in ('BASS1_G_S_05001_MONTH.tcl','BASS1_G_S_05002_MONTH.tcl')

                                                                                                                  
                                                                                                                  
                                                                                                                  
                                                                                                                  
select * from app.sch_control_runlog where control_code like '%05001%'                                                                                                                     
BASS1_EXP_G_S_05001_MONTH	2011-05-05 18:29:40.371433	[NULL]	[NULL]	1



select * from   app.sch_control_before where control_code like '%22062%'

select * from   app.sch_control_before where control_code like '%local_bus%'

BASS2_Dw_channel_local_busi_ds.tcl	TR1_L_14108

insert into app.sch_control_before
select 'BASS1_G_S_22062_MONTH.tcl','BASS2_Dw_channel_local_busi_ds.tcl' from bass2.dual



select * from    bass1.MON_ALL_INTERFACE 
where type = 'm'
and deadline = 10
and  interface_code  in 
(select substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1)



select time_id ,sum(bigint(BASE_BILL_DURATION))
--,  count(distinct time_id ) 
from G_S_21001_DAY 
where time_id between 20110401 and 20110506
group by  time_id 
order by 1  desc 

select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE from G_S_21001_DAY
where time_id = 20110503
except
select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE from G_S_21001_DAY
where time_id = 20110502




select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110503
group by BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) a left join 
(
select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) b on 
a.BRAND_ID||a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.IP_TYPE_ID||a.ROAM_TYPE_ID||a.CALL_TYPE_ID||a.MNS_TYPE 
=
b.BRAND_ID||b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.IP_TYPE_ID||b.ROAM_TYPE_ID||b.CALL_TYPE_ID||b.MNS_TYPE 



select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110501
group by BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) a left join 
(
select BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by BRAND_ID,SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) b on 
a.BRAND_ID||a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.IP_TYPE_ID||a.ROAM_TYPE_ID||a.CALL_TYPE_ID||a.MNS_TYPE 
=
b.BRAND_ID||b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.IP_TYPE_ID||b.ROAM_TYPE_ID||b.CALL_TYPE_ID||b.MNS_TYPE 





select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end,
         target1,
         target2,
         target3
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
    and time_id between 20110401 and 20110506
    order by 1 desc 
   





select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110501
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) a left join 
(
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID,CALL_TYPE_ID,MNS_TYPE 
) b on 
a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.IP_TYPE_ID||a.ROAM_TYPE_ID||a.CALL_TYPE_ID||a.MNS_TYPE 
=
b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.IP_TYPE_ID||b.ROAM_TYPE_ID||b.CALL_TYPE_ID||b.MNS_TYPE 



   
   



select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110501
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
) a left join 
(
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
) b on 
a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.IP_TYPE_ID||a.ROAM_TYPE_ID
=
b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.IP_TYPE_ID||b.ROAM_TYPE_ID


   
   
   


select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110501
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
) a left join 
(
select SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by SVC_TYPE_ID,TOLL_TYPE_ID,IP_TYPE_ID,ROAM_TYPE_ID
) b on 
a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.IP_TYPE_ID||a.ROAM_TYPE_ID
=
b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.IP_TYPE_ID||b.ROAM_TYPE_ID

   
   
  select DAY_CALL_MARK,count(0)
from bass2.dw_product_20110502
group by   DAY_CALL_MARK
1	975411

1	931536


  select DAY_CALL_MARK,count(0)
from bass2.dw_product_20110503
group by   DAY_CALL_MARK
1	944630




select time_id,ROAM_TYPE_ID,sum(bigint(BASE_BILL_DURATION))
from G_S_21001_DAY
where  time_id between 20110401 and 20110506
and ROAM_TYPE_ID <> '500'
group by time_id,ROAM_TYPE_ID
order by 1 desc , 2 desc 



select time_id,sum(bigint(BASE_BILL_DURATION))
from G_S_21001_DAY
where  time_id between 20110401 and 20110506
and ROAM_TYPE_ID <> '500'
group by time_id
order by 1 desc , 2 desc 



select count(0) from    bass2.cdr_call_dtl_20110502

9327822
select count(0) from    bass2.cdr_call_dtl_20110501


10350327

select count(0) from    bass2.cdr_call_dtl_20110503


10206502


select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110503

10206502	944629

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110502

9327822	931534

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110501
10350327	975409



select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100501
8959663	839616


select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100502

7900994	802405


select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100503

7893695	800935




select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100403
8042325	799054

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100404
7972046	804797

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20100405
8014808	806938


select OWE_MARK,count(0)
from bass2.dw_product_201104 
group by owe_mark

1	1065148


select OWE_MARK,count(0)
from bass2.dw_product_201103
group by owe_mark
1	1004838

select OWE_MARK,count(0)
from bass2.dw_product_201102
group by owe_mark

1	958718


select * from syscat.tables where tabname like '%OWE%' 


select BILL_CYCLE,count(distinct USER_ID )
from  bass2.DW_ACCT_OWE_201004
group by BILL_CYCLE
having sum(UNPAY_FEE) >  0
201004	226855
201104	294487

select BILL_CYCLE,count(distinct USER_ID )
from  bass2.DW_ACCT_OWE_201003
group by BILL_CYCLE
having sum(UNPAY_FEE) >  0
201003	215599

201103	284380




select BILL_CYCLE,count(distinct USER_ID )
from  bass2.DW_ACCT_OWE_201102
group by BILL_CYCLE
having sum(UNPAY_FEE) >  0
201102	294667


select * from   BASS1.ALL_DIM_LKP where bass1_tbid='BASS_STD2_0012'

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110502
where roamtype_id <> 0

1114930	114246


select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110501
where roamtype_id <> 0
1249954	121657

select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110503
where roamtype_id <> 0

1	2
1166203	110917



select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110430
where roamtype_id <> 0
1	2
1262590	122586


select count(0),count(distinct product_no) from    bass2.cdr_call_dtl_20110429
where roamtype_id <> 0

1	2
1281704	119684





select a.*,value(b.dur,0),a.dur - value(b.dur,0)
from (
select SVC_TYPE_ID,TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110503
group by SVC_TYPE_ID,TOLL_TYPE_ID,ROAM_TYPE_ID
) a left join 
(
select SVC_TYPE_ID,TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by SVC_TYPE_ID,TOLL_TYPE_ID,ROAM_TYPE_ID
) b on 
a.SVC_TYPE_ID||a.TOLL_TYPE_ID||a.ROAM_TYPE_ID
=
b.SVC_TYPE_ID||b.TOLL_TYPE_ID||b.ROAM_TYPE_ID

   
   
   
   
  select a.*,value(b.dur,0),a.dur - value(b.dur,0) 
from (
select TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110501
group by TOLL_TYPE_ID,ROAM_TYPE_ID
) a left join 
(
select TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110502
group by TOLL_TYPE_ID,ROAM_TYPE_ID
) b on 
a.TOLL_TYPE_ID||a.ROAM_TYPE_ID
=
b.TOLL_TYPE_ID||b.ROAM_TYPE_ID

 
 
 
 
 
   
  select a.*,value(b.dur,0),a.dur - value(b.dur,0) 
from (
select TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110428
group by TOLL_TYPE_ID,ROAM_TYPE_ID
) a left join 
(
select TOLL_TYPE_ID,ROAM_TYPE_ID
,sum(bigint(BASE_BILL_DURATION)) dur
from G_S_21001_DAY
where time_id = 20110429
group by TOLL_TYPE_ID,ROAM_TYPE_ID
) b on 
a.TOLL_TYPE_ID||a.ROAM_TYPE_ID
=
b.TOLL_TYPE_ID||b.ROAM_TYPE_ID

ROAM_TYPE_ID = 500  

 
 
 select time_id ,sum(bigint(BASE_BILL_DURATION))
--,  count(distinct time_id ) 
from G_S_21001_DAY 
where time_id between 20110401 and 20110506
and ROAM_TYPE_ID = '500'
group by  time_id 
order by 1  desc 




	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月15日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月15日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月15日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	
    
update  app.sch_control_runlog 
set flag = -2 
--select * from  app.sch_control_runlog 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月15日前'
)
and  flag = 0     



update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月15日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) < current date
		and month(endtime)  = month(current timestamp)
)


select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22062_month where time_id =201104)
  and time_id =201104
  and channel_status='1'
  
  
  
select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.G_S_22062_MONTH_TEST where time_id =201103)
  and time_id =201103
  and channel_status='1'



select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month_test where time_id =201103)
  and time_id =201103
  and channel_type in ('2','3')
  and channel_status='1'
  
  
  select * from BASS1.G_I_06021_MONTH
  where time_id = 201104
  
  
  select count(distinct channel_id) from bass1.g_i_06021_month
where time_id =201104
  and channel_status='1'
  and channel_type='1'
  and (longitude='0' or longitude='' or latitude='0' or latitude='')



select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22062_month where time_id =201104)
  and time_id =201104
  and channel_status='1'
  
  
  
  select * from  app.sch_control_before where control_code = 'BASS1_G_S_22062_MONTH.tcl'
  
  
  select * from bass1.g_i_06021_month
  
  
  
                        select count(*) from bass1.g_i_06021_month
                        where channel_id not in
                        (select distinct channel_id from bass1.g_s_22062_month where time_id =201103 )
                          and time_id =201103
                          and channel_status='1'

select count(0) from    bass1.g_s_22062_month
where time_id = 201104




                          
                          
select * from    bass1.g_s_22062_month
        where time_id = 201104                  
        
        select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201103)
  and time_id =201103
  and channel_type in ('2','3')
  and channel_status='1'
  
  
  
  
  update  app.sch_control_runlog 
set flag = -2 
--select * from   app.sch_control_runlog 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月15日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)
and control_code not in ('BASS1_EXP_G_S_05001_MONTH','BASS1_EXP_G_S_05002_MONTH')


select count(0) from    bass2.dw_product_201004


select tabname from syscat.tables where tabname like '%ADVISE%' 




select 'xxxxx', count(0) from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 with ur 




CREATE FUNCTION bass1.get_before(p_control_code varchar(128))
RETURNS
TABLE (control_code varchar(128),before_control_code varchar(128))
RETURN
select control_code,before_control_code from app.sch_control_before where control_code = p_control_code

CREATE FUNCTION bass1.get_after(p_before_control_code varchar(128))
RETURNS
TABLE (control_code varchar(128),before_control_code varchar(128))
RETURN
select control_code,before_control_code from app.sch_control_before where before_control_code = p_before_control_code


select * from  table( bass1.get_after('04015')) a 
select * from  table( bass1.get_before('22403')) a 
select count(0) from    G_S_22403_MONTH where time_id = 201108

select * from  bass1.T_GS05001M where time_id = 201103
select * from  bass1.T_GS05002M where time_id = 201103


insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201104


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201104


insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201104


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201104



select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 




select * from syscat.tables where tabname like '%DWD_I_USER_RADIUS_ORDER%' 

select count(0) from    bass2.DWD_I_USER_RADIUS_ORDER_20110508


select * from    bass2.DWD_I_USER_RADIUS_ORDER_20100501




select distinct  before_control_code from   app.sch_control_before where control_code in (
select control_code from    app.sch_control_task
where
(
   control_code like 'BASS1%22080%'
or control_code like 'BASS1%22082%'
or control_code like 'BASS1%22084%'
or control_code like 'BASS1%22085%'
or control_code like 'BASS1%22081%'
or control_code like 'BASS1%02023%'
or control_code like 'BASS1%22083%'
or control_code like 'BASS1%02022%'
)
and function_desc not like '%作废%'
and cc_flag = 1 
) and control_code not like '%EXP%'



select * from   
BASS1.G_S_22081_MONTH

select 'drop table '||tabname  from syscat.tables where tabschema = 'BASS1'  and date(CREATE_TIME) > '2011-03-01'
order by  CREATE_TIME 
desc 

drop table T_REGION_FLAG1003
drop table T_INT_CHECK_USER_STATUS1003

drop table T_INT_CHECK_USER_STATUS
drop table T_GPRS_SUM2
drop table T_GPRS_SUM
drop table T_GPRS_PROD_USER2
drop table T_GPRS_PROD_USER


drop table T_REGION_FLAG
drop table T_BASE_BILL_DURATION
drop table T_BASS1_STD_0113

drop table GRP_ID_OLD_NEW_MAP_20110330
drop table T_GRP_ID_OLD_NEW_MAP
drop table G_I_77780_DAY_DOWN20110415
drop view T_V_06021



select 'drop table '||tabname  from syscat.tables 
where tabschema = 'BASS1'  
--and tabname like '%DOWN%'
and date(CREATE_TIME) > '2011-03-01'
order by  CREATE_TIME 
desc 

drop table G_S_04003_DAY_B20110504
drop table G_I_77780_DAY_DOWN20110427
drop table G_I_77780_DAY_DOWN20110422
drop table G_I_77780_DAY_DOWN20110414
drop table G_A_02055_DAY_DOWN20110321
drop table G_A_02059_DAY_DOWN20110321


drop table G_I_06021_MONTH_B20110415
drop table G_S_03018_MONTH_B20110414
drop table G_S_03017_MONTH_B20110414




drop table G_I_77780_DAY_MID6
drop table G_I_77780_DAY_MID5
drop table G_I_77780_DAY_MID4
drop table G_I_77780_DAY_MID_A2
drop table G_I_77780_DAY_MID_A



drop table G_I_77780_DAY_MID3
drop table G_I_77780_DAY_MID2
drop table G_I_77780_DAY_B20110421


drop table G_S_22062_MONTH_TMP_1BAK




 		select   
 		sum(bigint(flowup)+bigint(flowdown))*1.00/1024/1024/1024 wlan_flow
 		,count(distinct product_no) user_cnt
        from   bass1.G_S_04003_DAY
		where time_id between  20110401 and 20110430
        


select card,npages,stats_time from syscat.tables where tabname = 'G_S_04003_DAY'


        
db2 RUNSTATS ON table BASS1.G_S_04003_DAY 	with distribution and detailed indexes all  


select * from   syscat.tables where tabname like 'MON%'        

select tabname, card,npages,stats_time 
,substr(tabname,5,5)
 from   syscat.tables 
where substr(tabname,5,5) in (
select interface_code from 
MON_ALL_INTERFACE
)
and tabname like 'G%'
and ( date(stats_time) < '2011-05-01'
or stats_time is null 
)
select * from   
MON_INTERFACE_NOT_EMPTY
select * from   
MON_USER_MOBILE
select * from   
MONIT_SQL
select * from   
MONITOR_CONFIG
MONITOR_LIST
MONTH_02006_MID1
MONTH_02006_MID2




select tabname, card,npages,stats_time 
,substr(tabname,5,5)
 from   syscat.tables 
where substr(tabname,5,5) in (
select interface_code from 
MON_ALL_INTERFACE
)
and tabname like 'G%'
and ( date(stats_time) < '2011-05-01'
or stats_time is null 
)


select tabname, card,npages,stats_time 
,substr(tabname,5,5)
 from   syscat.tables 
where substr(tabname,5,5) in (
select interface_code from 
MON_ALL_INTERFACE
)
and tabname like 'G%'
and ( date(stats_time) < '2011-05-10'
or stats_time is null 
)

select tabname, card,npages,stats_time 
,substr(tabname,5,5)
 from   syscat.tables 
where substr(tabname,5,5) in (
select interface_code from 
MON_ALL_INTERFACE
)
and tabname like 'G%'
and ( date(stats_time) < '2011-05-10'
or stats_time is null 
)
AND  NOT (tabname  like '%DAY'
OR tabname  like '%MONTH'
)


select tabname, card,npages,stats_time 
 from   syscat.tables 
where tabname
in
('DIM_21003_IP_TYPE'
,'G_A_01002_DAY'
,'G_A_01004_DAY'
,'G_A_01004_TMP1'
,'G_A_01004_TMP10'
,'G_A_01004_TMP11'
,'G_A_01004_TMP12'
,'G_A_01004_TMP2'
,'G_A_01004_TMP3'
,'G_A_01004_TMP4'
,'G_A_01005_MONTH'
,'G_A_01006_DAY'
,'G_A_01007_DAY'
,'G_A_02004_DAY'
,'G_A_02004_DAY_create'
,'G_A_02004_DAY_CREATE'
,'G_A_02004_DAY_CREATE_2'
,'G_A_02004_DAY_create_2'
,'G_A_02004_DAY_T'
,'G_A_02004_DAY_TAKE'
,'G_A_02008_DAY'
,'G_A_02008_DAY_T'
,'G_A_02008_DAY_TAKE'
,'G_A_02011_DAY'
,'G_A_02013_DAY'
,'G_A_02052_MONTH'
,'G_A_02053_DAY'
,'G_A_02054_DAY'
,'G_A_02054_DAY_0317_1220REPAIR'
,'G_A_02054_DAY_BLACK'
,'G_A_02055_DAY'
,'G_A_02056_DAY'
,'G_A_02057_DAY'
,'G_A_02058_DAY'
,'G_A_02059_DAY'
,'G_A_02059_DAY_0315MODIFY'
,'G_A_02059_DAY_20110321FIX1340'
,'G_A_02060_DAY'
,'G_A_02061_DAY'
,'G_A_02061_DAY_0317REPAIR'
,'G_A_02062_DAY'
,'G_A_02062_DAY_20110317REPAIR'
,'G_A_02064_DAY'
,'G_A_06001_DAY'
,'G_I_01006_MONTH'
,'G_I_02005_MONTH'
,'G_I_02006_MONTH'
,'G_I_02014_MONTH'
,'G_I_02015_MONTH'
,'G_I_02016_MONTH'
,'G_I_02017_MONTH'
,'G_I_02018_MONTH'
,'G_I_02019_MONTH'
,'G_I_02019_MONTH_1'
,'G_I_02019_MONTH_2'
,'G_I_02019_MONTH_4'
,'G_I_02020_MONTH'
,'G_I_02021_MONTH'
,'G_I_02021_MONTH_TEMP1'
,'G_I_02021_MONTH_TEMP2'
,'G_I_02022_DAY'
,'G_I_02022_MONTH'
,'G_I_02023_DAY'
,'G_I_02023_DAY_1'
,'G_I_02023_MONTH'
,'G_I_02049_MONTH'
,'G_I_02053_MONTH'
,'G_I_02063_DAY'
,'G_I_03001_MONTH'
,'G_I_03002_MONTH'
,'G_I_03003_MONTH'
,'G_I_03007_MONTH'
,'G_I_06001_MONTH'
,'G_I_06002_MONTH'
,'G_I_06011_MONTH'
,'G_I_06012_MONTH'
,'G_I_06021_MONTH'
,'G_I_06022_MONTH'
,'G_I_06023_MONTH'
,'G_I_06029_MONTH'
,'G_I_06031_DAY'
,'G_I_06032_DAY'
,'G_I_21020_MONTH'
,'G_S_02007_DAY'
,'G_S_02007_MONTH'
,'G_S_02047_MONTH'
,'G_S_03002_MONTH'
,'G_S_03002_MONTH_TYM'
,'G_S_03004_MONTH'
,'G_S_03004_MONTH_TD'
,'G_S_03005_MONTH'
,'G_S_03012_MONTH'
,'G_S_03015_MONTH'
,'G_S_03016_MONTH'
,'G_S_03016_MONTH_LS'
,'G_S_03017_MONTH'
,'G_S_03018_MONTH'
,'G_S_04002_DAY'
,'G_S_04002_DAY_FLOWS'
,'G_S_04002_DAY_TD'
,'G_S_04002_DAY_TD1'
,'G_S_04002_DAY_TD2'
,'G_S_04002_DAY_TMP'
,'G_S_04003_DAY'
,'G_S_04004_DAY'
,'G_S_04005_DAY'
,'G_S_04006_DAY'
,'G_S_04007_DAY'
,'G_S_04008_DAY'
,'G_S_04009_DAY'
,'G_S_04010_DAY'
,'G_S_04011_DAY'
,'G_S_04012_DAY'
,'G_S_04014_DAY'
,'G_S_04015_DAY'
,'G_S_04016_DAY'
,'G_S_04017_DAY'
,'G_S_04017_DAY_TD'
,'G_S_04018_DAY'
,'G_S_04018_DAY_FLOWS'
,'G_S_05001_MONTH'
,'G_S_05002_MONTH'
,'G_S_05003_MONTH'
,'G_S_21001_DAY'
,'G_S_21002_DAY'
,'G_S_21003_MONTH'
,'G_S_21003_MONTH_TD'
,'G_S_21003_MONTH_TMP'
,'G_S_21003_TO_DAY'
,'G_S_21004_DAY'
,'G_S_21005_DAY'
,'G_S_21006_MONTH'
,'G_S_21006_TO_DAY'
,'G_S_21007_DAY'
,'G_S_21008_MONTH'
,'G_S_21008_TO_DAY'
,'G_S_21009_DAY'
,'G_S_21010_MONTH'
,'G_S_21011_MONTH'
,'G_S_21012_MONTH'
,'G_S_21013_MONTH'
,'G_S_21014_MONTH'
,'G_S_21015_MONTH'
,'G_S_21016_DAY'
,'G_S_21020_MONTH'
,'G_S_22009_MONTH'
,'G_S_22012_DAY'
,'G_S_22013_MONTH'
,'G_S_22021_MONTH'
,'G_S_22025_MONTH'
,'G_S_22032_MONTH'
,'G_S_22033_MONTH'
,'G_S_22036_MONTH'
,'G_S_22038_DAY'
,'G_S_22039_MONTH'
,'G_S_22040_MONTH'
,'G_S_22041_MONTH'
,'G_S_22042_MONTH'
,'G_S_22043_MONTH'
,'G_S_22049_MONTH'
,'G_S_22050_MONTH'
,'G_S_22052_MONTH'
,'G_S_22055_MONTH'
,'G_S_22056_MONTH'
,'G_S_22061_MONTH'
,'G_S_22062_MONTH'
,'G_S_22063_MONTH'
,'G_S_22064_MONTH'
,'G_S_22065_MONTH'
,'G_S_22072_MONTH'
,'G_S_22073_DAY'
,'G_S_22073_DAY_TEST'
,'G_S_22080_DAY'
,'G_S_22081_MONTH'
,'G_S_22081_MONTH_1'
,'G_S_22081_MONTH_2'
,'G_S_22082_DAY'
,'G_S_22082_DAY_1'
,'G_S_22082_DAY_2'
,'G_S_22083_MONTH'
,'G_S_22083_MONTH_1'
,'G_S_22083_MONTH_2'
,'G_S_22083_MONTH_3'
,'G_S_22083_MONTH_4'
,'G_S_22084_DAY'
,'G_S_22085_MONTH'
,'G_S_22101_MONTH'
,'G_S_22102_DAY'
,'G_S_22103_MONTH'
,'G_S_22104_DAY'
,'G_S_22105_MONTH'
,'G_S_22106_MONTH'
,'G_S_22201_DAY'
,'G_S_22202_DAY'
,'G_S_22203_DAY'
,'G_S_22204_MONTH'
,'G_S_22204_MONTH_TMP3'
,'G_S_22301_DAY'
,'G_S_22302_DAY'
,'G_S_22303_MONTH'
,'G_S_22304_MONTH'
,'G_S_22305_MONTH'
,'G_S_22306_MONTH'
,'G_S_22307_MONTH'
,'G_S_22401_MONTH'
,'INT_02011_SNAPSHOT')





select a.tabname,sum(decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2)) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.TABSCHEMA = 'BASS1'
group by a.TABNAME having sum(decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2)) > 1000
order by 2 desc 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04002_DAY 
group by  time_id 
order by 1 


	  insert into BASS1.G_S_04002_DAY 
	  select * from  BASS1.G_S_04002_DAY_BAK
	  where time_id >= 20101101

delete from   BASS1.G_S_04002_DAY 


    rename BASS1.G_S_04002_DAY to G_S_04002_DAY_BAK
    create table BASS1.G_S_04002_DAY like BASS1.G_S_04002_DAY_BAK 
     DISTRIBUTE BY HASH(TIME_ID,  
                 PRODUCT_NO,  
                 ROAM_LOCN,  
                 ROAM_TYPE_ID,  
                 APNNI,  
                 START_TIME)   
     IN TBS_APP_BASS1 INDEX IN TBS_INDEX 
                   
	  insert into BASS1.G_S_04002_DAY 
	  select * from  BASS1.G_S_04002_DAY_BAK
	  where time_id >= 20110101
	  --about 15min
	 db2 RUNSTATS ON TABLE BASS1.G_S_04002_DAY	with distribution and detailed indexes all  
	  drop table BASS1.G_S_04002_DAY_BAK

     
     
select * from   app.sch_control_before where control_code like '%210012916%'     

select * from  table( bass1.get_after('Dim_pm_sp_operator_code_ms')) a 



select count(0) from   BASS1.G_I_77780_DAY_DOWN20110429
3554

select count(0),count(distinct id),count(distinct enterprise_id),count(distinct id||enterprise_id) from    BASS1.G_I_77780_DAY_DOWN20110429
3554	3552	3151



BASS1.G_I_77780_DAY_DOWN20110429

select count(distinct a.ENTERPRISE_ID ),count(0) from   bass2.dw_enterprise_msg_201101 a ,
BASS1.G_I_77780_DAY_DOWN20110429 b 
where a.ENTERPRISE_ID = b.ENTERPRISE_ID
3076	3464

select count(distinct a.ENTERPRISE_ID ),count(0) from   bass2.dw_enterprise_msg_201104 a ,
BASS1.G_I_77780_DAY_DOWN20110429 b 
where a.ENTERPRISE_ID = b.ENTERPRISE_ID

3077	3465

drop table INT_210012916_201010
drop table INT_210012916_201011
drop table INT_210012916_201012
drop table INT_210012916_201103






select * from   mon_all_interface where interface_code in ('21001','21002','21009','21016')

select tabname from syscat.tables where tabname like '%CDR_CALL_DTL_%' 





    rename BASS1.G_S_04005_DAY to G_S_04005_DAY_BAK
    create table BASS1.G_S_04005_DAY like BASS1.G_S_04005_DAY_BAK 
                 DISTRIBUTE BY HASH(TIME_ID,  
                 PRODUCT_NO,  
                 SP_CODE,  
                 OPPOSITE_NO)   
                   IN TBS_APP_BASS1 INDEX IN TBS_INDEX NOT LOGGED INITIALLY ;
insert into BASS1.G_S_04005_DAY 
	  select * from  BASS1.G_S_04005_DAY_BAK
	  where time_id >= 20110101
	  --about 10min

RUNSTATS ON TABLE BASS1.G_S_04005_DAY	with distribution and detailed indexes all  

select tabname , card from syscat.tables where tabname in ('G_S_04005_DAY','G_S_04005_DAY_BAK')            
AND tabschema = 'BASS1'

G_S_04005_DAY	159753255
G_S_04005_DAY_BAK	433834695

drop table BASS1.G_S_04005_DAY_BAK



G_S_21003_TO_DAY	52537.03


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_21003_TO_DAY 
group by  time_id 
order by 1 



select tablespace_name
,PAGE_SIZE,TOTAL_PAGES,USED_PAGES,FREE_PAGES
,rtrim(char(USED_PAGES/TOTAL_PAGES*100))||'%' as USED_RATE
,rtrim(char(FREE_PAGES/TOTAL_PAGES*100))||'%' as Free_RATE 
FROM TABLE( SNAPSHOT_TBS_CFG( 'BASSDB', -1 )) as SNAPSHOT_TBS_CFG 


select * from   G_S_21003_MONTH


select * from   SYSIBMADM.TBSP_UTILIZATION


select * from   syscat.tablespaces




select sum(TBSP_TOTAL_PAGES)*32/1024 as total_tbsp_size,sum(TBSP_USED_PAGES)*32/1024  as used_tbsp_size,substr(TBSP_NAME,1,8) as tbsp_name from sysibmadm.snaptbsp_part group by tbsp_name having TBSP_NAME='TS_DATA' with ur




select * from   bass2.dim_cust_agelev

select age_id from  bass2.dw_product_201103


select count(0)
from bass2.dw_product_201103 a 
join  bass2.dim_cust_agelev  b on a.AGE_ID = b.AGE_ID 


select count(0)
from  bass2.dim_cust_agelev a 
join  bass2.dw_product_201103 b on a.AGE_ID = b.AGE_ID 





select b.*
from bass2.dw_product_201103 a 
left outer join  bass2.dim_cust_agelev  b on a.AGE_ID = b.AGE_ID 


select a.*
from  bass2.dim_cust_agelev a 
left outer join  bass2.dw_product_201103 b on a.AGE_ID = b.AGE_ID 



select count(0) from    
bass2.dual a 
left outer join bass2.dw_product_201103 b on a.DUMMY = b.USER_ID



select count(0) from    
 bass2.dw_product_201103 a ,
 bass2.dual b 


select count(0) from    
 bass2.dw_product_201103 a 
left outer join  bass2.dw_product_201104 b on b.USER_ID = a.USER_ID


select count(0) from    
 bass2.dw_product_201103 a 
join  bass2.dw_product_201104 b on b.USER_ID = a.USER_ID




select count(0) from    
 bass2.dw_product_201103 a 
join  bass2.dw_product_201104 b on a.product_no = b.product_no


select max(product_no) from  bass2.dw_product_201103

select max(user_id) from  bass2.dw_product_201103

select * from   syscat.indexes


select * from   syscat.indexes where tabname = 'DW_PRODUCT_INS_OFF_INS_PROD_201103'

hsj
select count(0) from    
bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 a 
 join bass2.dw_product_201103 b on b.user_id  = a.PRODUCT_INSTANCE_ID 


select * from     bass2.dw_product_201103 fetch first 10 rows only  
select * from /**table**/ fetch first 10 rows only  

select count(0) from    
  bass2.dw_product_201103 b
 join bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 a on a.PRODUCT_INSTANCE_ID = b.user_id 
where   PRODUCT_INSTANCE_ID = '89101110178910'



select count(0) from    
  bass2.dw_product_201103 b ,
  bass2.DW_PRODUCT_INS_OFF_INS_PROD_201103 a  
where   PRODUCT_INSTANCE_ID = '89101110178910'
and a.PRODUCT_INSTANCE_ID = b.user_id 


select * from   BASS1.MON_ALL_INTERFACE
where interface_name like '%飞信%'


nlj:
select count(0)
from (
select char(a.CHANNEL_ID),char(user_id)
from bass1.g_i_06021_month b ,bass2.dw_product_201102 a
where month_new_mark = 1
and char(a.CHANNEL_ID) = trim(b.CHANNEL_ID)
and b.time_id = 201102
) t 




select user_id from   bass2.dw_product_201103
order by user_id desc


select * from   syscat.indexes where tabname = 'DW_PRODUCT_201103'



select max(user_id) from   bass2.dw_product_201103
order by user_id desc


select * from   bass2.dw_product_201103
order by user_id asc



SET A = expr1;
select * from    BASS1.MON_ALL_INTERFACE where interface_code = '02053'

select * from   bass2.dwd_i_user_radius_order_ds


select * from syscat.tables where tabname like '%I_USER_RADIUS_ORDER%'



select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'DW_I_USER_RADIUS_ORDER_DS'

select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'DWD_I_USER_RADIUS_ORDER_20110430'


select count(0),count(distinct USER_ID ) from    bass2.DW_I_USER_RADIUS_ORDER_DS

select count(0),count(distinct serv_id ) from    bass2.DWD_I_USER_RADIUS_ORDER_20110511




select count(0) from    G_I_02053_MONTH



CREATE TABLE "BASS1"."G_I_02053_MONTH_B20110512"
 ("TIME_ID"       INTEGER,
  "PRODUCT_NO"    CHARACTER(15),
  "PRODUCT_NO_3"  CHARACTER(15),
  "BUSI_TYPE"     CHARACTER(2),
  "SP_CODE"       CHARACTER(12),
  "SERV_CODE"     CHARACTER(20),
  "STS"           CHARACTER(1),
  "VALID_DATE"    CHARACTER(8),
  "EXPIRE_DATE"   CHARACTER(8),
  "BILL_FLAG"     CHARACTER(1),
  "REMARK"        CHARACTER(1),
  "APPLY_TYPE"    CHARACTER(2)
 )
  DATA CAPTURE NONE
 IN "TBS_APP_BASS1"
 INDEX IN "TBS_INDEX"
  PARTITIONING KEY
   (TIME_ID,
    PRODUCT_NO
   ) USING HASHING;
ALTER TABLE "BASS1"."G_I_02053_MONTH_B20110512"
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
INSERT INTO G_I_02053_MONTH_B20110512
SELECT * FROM G_I_02053_MONTH
 
 
 select * from  BASS2.DW_I_USER_RADIUS_ORDER_201104
 
 
 
 select count(0) from   bass1.g_a_02053_day where time_id=20110511
 
 
 select count(0) from   G_I_02053_MONTH_B20110512
 where time_id = 201104
 
 507268
 
 
 select count(0) from   G_I_02053_MONTH
 where time_id = 201104
 
 
 select count(0)    
                 from bass2.DWD_PRODUCT_REGSP_20110430 a
                 left outer join bass2.dw_product_20110430 b
                  on a.user_id=b.user_id
                 inner join (select distinct USER_ID  from BASS2.DW_I_USER_RADIUS_ORDER_201104) c
                  on a.user_id=c.USER_ID
                where a.busi_type in ('115','119','130')
                
                
508139

                

 select count(0)    
                 from bass2.DWD_PRODUCT_REGSP_20110430 a
                 left outer join bass2.dw_product_20110430 b
                  on a.user_id=b.user_id
                 --inner join (select distinct USER_ID  from BASS2.DW_I_USER_RADIUS_ORDER_201104) c
                  --on a.user_id=c.USER_ID
                where a.busi_type in ('115','119','130')
                 and exists (select 1 from  BASS2.DW_I_USER_RADIUS_ORDER_201104 c where a.user_id = c.user_id )
                 

 
 select count(0)    
                 from bass2.DWD_PRODUCT_REGSP_20110430 a
                 inner join (select distinct USER_ID  from BASS2.DW_I_USER_RADIUS_ORDER_201104) c
                  on a.user_id=c.USER_ID                 
                 left outer join bass2.dw_product_20110430 b
                  on a.user_id=b.user_id
                where a.busi_type in ('115','119','130')
                



 select count(0)    
                 from bass2.DWD_PRODUCT_REGSP_20110430 a
                 left outer join bass2.dw_product_20110430 b
                  on a.user_id=b.user_id
                where a.busi_type in ('115','119','130')
                 and exists (select 1 from  BASS2.DW_I_USER_RADIUS_ORDER_201104 c where a.user_id = c.user_id )
                 


                select count(0) from g_i_02053_month
                  where time_id = 201104
                 and 
                 VALID_DATE> EXPIRE_DATE
                 with ur
                 
select count(0) from    bass2.DW_I_USER_RADIUS_ORDER_DS
                 

CREATE TABLE "BASS1"."G_A_02053_DAY_B20110512"
 ("TIME_ID"       INTEGER,
  "PRODUCT_NO"    CHARACTER(15),
  "PRODUCT_NO_3"  CHARACTER(15),
  "BUSI_TYPE"     CHARACTER(2),
  "SP_CODE"       CHARACTER(12),
  "SERV_CODE"     CHARACTER(20),
  "STS"           CHARACTER(1),
  "VALID_DATE"    CHARACTER(8),
  "EXPIRE_DATE"   CHARACTER(8),
  "BILL_FLAG"     CHARACTER(1),
  "REMARK"        CHARACTER(1),
  "APPLY_TYPE"    CHARACTER(2)
 )
  DATA CAPTURE NONE
 IN "TBS_APP_BASS1"
 INDEX IN "TBS_INDEX"
  PARTITIONING KEY
   (TIME_ID,
    PRODUCT_NO
   ) USING HASHING;
ALTER TABLE "BASS1"."G_A_02053_DAY_B20110512"
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
INSERT INTO                  
BASS1.G_A_02053_DAY_B20110512
SELECT * FROM G_A_02053_DAY


DROP TABLE G_I_02053_MONTH_B20110512


select count(0) from    G_A_02053_DAY where time_id = 20110511

134048

select * from mon_all_interface where interface_code like '%2240%'
select * from   app.sch_control_before where control_code like '%02053%'

select * from   app.sch_control_task where control_code like '%radius_order_ds%'

Dw_i_user_radius_order_ds

BASS1_G_I_02053_MONTH.tcl	BASS2_Dwd_product_regsp_ds.tcl
BASS1_G_A_02053_DAY.tcl	BASS2_Dwd_i_user_radius_order_ds.tcl

BASS2_Dw_i_user_radius_order_ds.tcl

select * from  table( bass1.get_before('BASS1_G_A_02053_DAY.tcl')) a 
select * from  table( bass1.get_after('R238')) a 


BASS1_G_A_02053_DAY.tcl	BASS2_Dw_product_bass1_ds.tcl
BASS1_G_A_02053_DAY.tcl	BASS2_Dwd_product_regsp_ds.tcl
BASS1_G_A_02053_DAY.tcl	BASS2_Dwd_i_user_radius_order_ds.tcl
BASS1_G_I_02053_MONTH.tcl	BASS2_Dwd_product_regsp_ds.tcl
BASS1_G_I_02053_MONTH.tcl	BASS2_Dw_product_ds.tcl
BASS1_G_I_02053_MONTH.tcl	BASS2_Dwd_i_user_radius_order_ds.tcl


update  app.sch_control_before 
set before_control_code = 'BASS2_Dw_i_user_radius_order_ds.tcl'
where control_code = 'BASS1_G_A_02053_DAY.tcl'
and before_control_code = 'BASS2_Dwd_i_user_radius_order_ds.tcl'


update  app.sch_control_before 
set before_control_code = 'BASS2_Dw_i_user_radius_order_ds.tcl'
where control_code = 'BASS1_G_I_02053_MONTH.tcl'
and before_control_code = 'BASS2_Dwd_i_user_radius_order_ds.tcl'



select * from   app.sch_control_before where control_code like '%02053%'



select count(0) from    G_I_02053_MONTH where time_id = 201104



select count(0) from    g_i_02022_day


set a=1


select TBSP_ID ID,
       substr(TBSP_NAME,1,18) TBSP_NAME,
       substr(TBSP_TYPE,1,4) TYPE,
       -- TBSP_TOTAL_SIZE_KB / 1024 / 1024 as total_size,
       TBSP_USED_SIZE_KB / 1024 / 1024 as used,
       TBSP_FREE_SIZE_KB / 1024 / 1024 as free,
       TBSP_UTILIZATION_PERCENT as percent,
       substr(TBSP_STATE,1,12) STATE,
       DBPARTITIONNUM as par
  from SYSIBMADM.TBSP_UTILIZATION
  and 
 order by TBSP_ID,DBPARTITIONNUM
 select * from  app.sch
select * from  table( bass1.get_task('02011')) a 
App_xysc_school_user_ms.tcl
 
 select * from app.sch_control_task where control_code = 'REP_App_xysc_school_user_ms.tcl'
 locate('04015',control_code) > 0 cont
 
CREATE FUNCTION bass1.get_task(p_control_code varchar(128))
RETURNS
TABLE (control_code varchar(128),FUNCTION_DESC           VARCHAR(200))
RETURN
select control_code,FUNCTION_DESC 
from app.sch_control_task 
where  locate(upper(p_control_code),upper(control_code)) > 0


select * from  table( bass1.get_task('dim_enterprise_product')) a 
select tabname from syscat.tables where tabname like '%%'   

BASS2_Dw_acct_payitem_dm.tcl


select * from  table( bass1.get_task('22012')) a 


BASS1_G_S_04015_DAY.tcl
select * from   app.sch_control_runlog 
where control_code in (
select before_control_code  from  table( bass1.get_before('BASS1_G_S_22012_DAY.tcl')) a 
)

BASS2_Dwd_ps_net_number_ds.tcl




select date(alarmtime) from  app.sch_control_alarm where content like '%一致性检查离网%'
order by  date(alarmtime) desc 


select * from   bass1.g_s_22012_day  a , bass1.g_rule_check b 
where a.time_id = b.time_id
and b.rule_code like 'R159_%'
ORDER BY a.TIME_ID DESC 



select * from   bass1.g_rule_check b 
where time_id = 20110512



select * from   bass1.g_s_22012_day  a , bass1.g_rule_check b 
where a.time_id = b.time_id
and b.rule_code = 'R159_4'
ORDER BY a.TIME_ID DESC 



select count(user_id) 
                    from bass2.dw_product_20110429  
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1
                     


        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110517 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110517 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1


                        select count(distinct user_id) from session.int_check_user_status
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110429


select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110429                       
except
select user_id 
from bass2.dw_product_20110429  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
 
 
 
 USER_ID
89360000853341 
89360000853343 
89360000853342 
89260000852773 

select * from   session.int_check_user_status  
where user_id in 
(
 '89360000853341'
,'89360000853343'
,'89360000853342'
,'89260000852773'
)

PRODUCT_NO
18289031824    
18289031854    
18289032624    
18889020019    



select usertype_id,day_off_mark,userstatus_id,test_mark from   bass2.dw_product_20110429  
where user_id in 
(
 '89360000853341'
,'89360000853343'
,'89360000853342'
,'89260000852773'
)


from bass2.dw_product_20110429  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
 
 
20110427	20110427	2255      	1625550     	24163151    	457063      	3867935     	2478      	299223      	20110427	R159_4	2478.00000	2479.00000	-0.00040	0.00000
20110426	20110426	2476      	1625771     	24109824    	436466      	3755052     	41773     	279559      	20110426	R159_4	41773.00000	41775.00000	-0.00004	0.00000

 
 
 
 select * from  table( bass1.get_task('R216')) a 
 select * from  app.sch_control_task where control_code = 'BASS2_Dw_channel_rule_ms.tcl'
 TR1_L_11044
 select * from  table( bass1.get_before('22059')) a 

select * from  table( bass1.get_after('BASS1_INT_CHECK_R192_MONTH.tcl')) a 

BASS2_Dw_product_ord_busi_other_ms.tcl	TR1_L_11044

select * from app.sch_control_runlog where control_code in(
select before_control_code from  table( bass1.get_before('02052')) a 
)



select * from  table( bass1.get_task('02052')) a 

select * from   bass2.DIM_TERM_TAC



select date(alarmtime - 1 days ),a.* from   app.sch_control_alarm a where content like '%R161%'



select date(alarmtime - 1 days ),a.* from   app.sch_control_alarm a where content like '%R161%'
and date(alarmtime - 1 days ) = '2011-04-01'



select substr(content,1,7) , count(0) from   app.sch_control_alarm a where content like '%R161%'
group by  substr(content,1,7)
order by 1

1	2
R161_1 	65
R161_10	66
R161_13	155
R161_14	189
R161_15	12
R161_16	33
R161_17	71
R161_2 	3
R161_3 	63
R161_4 	2
R161_5 	20
R161_6 	10
R161_7 	45
R161_9 	41


select date(alarmtime - 1 days ),a.* from   app.sch_control_alarm a where content like '%R161_15%'

select a.*,a.target3*100 from 
bass1.g_rule_check a where rule_code = 'R161_11'


select date(alarmtime - 1 days ),a.* from   app.sch_control_alarm a where content like '%一致性%'
ORDER BY 1 DESC 




select * from 
bass1.g_rule_check where rule_code = 'R172'
and time_id >  20110501 







select * from 
bass1.g_rule_check where rule_code = 'R170'
and time_id between  20110501 and 20110520






select * from 
bass1.g_rule_check where rule_code = 'R161_13'
and time_id between  20110501 and 20110520


select * from 
bass1.g_rule_check where rule_code in( 'R161_14','R161_13')
and target3 > 0.8



select a.*,target3*100 from 
bass1.g_rule_check a where rule_code like 'R161_%'
and time_id = 20110517
order by rule_code


CREATE FUNCTION BASS1.FN_GET_ALL_DIM_EX(
GID VARCHAR(20)
,DID VARCHAR(20)
) RETURNS 
VARCHAR(32) 
DETERMINISTIC 
NO EXTERNAL 
ACTION LANGUAGE SQL 
BEGIN ATOMIC 
		RETURN 
		SELECT 
			BASS1_VALUE 
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = GID 
			AND XZBAS_VALUE = DID 
END


CREATE FUNCTION BASS1.FN_GET_ALL_DIM_EX(GID VARCHAR(20),DID VARCHAR(32)) RETURNS VARCHAR(10) DETERMINISTIC NO EXTERNAL ACTION LANGUAGE SQL BEGIN ATOMIC RETURN SELECT BASS1_VALUE FROM BASS1.ALL_DIM_LKP WHERE BASS1_TBID = GID AND XZBAS_VALUE = DID END


SET SCHEMA BASS1;
SET CURRENT PATH = "SYSIBM", "SYSFUN", "SYSPROC", "BASS1";
CREATE FUNCTION "BASS1"."FN_GET_ALL_DIM"
 ("GID" VARCHAR(20),
  "DID" VARCHAR(20)
 ) 
  RETURNS VARCHAR(32)
  LANGUAGE SQL
  DETERMINISTIC
  READS SQL DATA
  STATIC DISPATCH
  CALLED ON NULL INPUT
  NO EXTERNAL ACTION
  INHERIT SPECIAL REGISTERS
  BEGIN ATOMIC
    RETURN
      SELECT BASS1_VALUE
        FROM BASS1.ALL_DIM_LKP
        WHERE BASS1_TBID = GID
          AND XZBAS_VALUE = DID;
END;
select count(0) from    G_A_02053_DAY
                                                                
select * from   bass2.Dw_product_ins_off_ins_prod_ds where offer_id like '%QW_QQT_DJ%'

select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                              
                        select 
                                USER_ID
                                ,ADD_PKG_ID
                                ,VALID_DT
                        FROM (
                                SELECT
                                 a.PRODUCT_INSTANCE_ID as USER_ID
                                ,bass1.fn_get_all_dim('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
                                ,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
                                ,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id 
                                        order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id 
                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-05-17'
                                 and date(a.VALID_DATE)<='2011-05-17'
                            ) AS T where t.rn = 1 
                         with ur 
                                                                
SELECT a.OFFER_ID
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-05-17'
                                 and date(a.VALID_DATE)<='2011-05-17'                                                                 
                                 
select  *
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'                                 
                                              
select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
except
SELECT a.OFFER_ID
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-05-17'
                                 and date(a.VALID_DATE)<='2011-05-17'
                                 

SELECT *
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id  
except
SELECT *
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-05-17'
                                 and date(a.VALID_DATE)<='2011-05-17'                                 
                                 
                                 
                                 select distinct user_id from  g_i_02023_day
                                 select * from  g_i_02024_day
                                 
                                 select * from  g_i_02022_day
                                
select * from   g_i_02023_day
                                
                                
select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
                                
                                
        select 
                20110511 TIME_ID
                ,char(a.product_instance_id)  USER_ID
                ,bass1.fn_get_all_dim('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
                ,replace(char(date(a.create_date)),'-','') VALID_DT
        from  bass2.ODS_PRODUCT_INS_PROD_20110517 a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                      ) c
        where  char(a.offer_id) = c.offer_id 
select 
			FROM (
				SELECT
				 a.PRODUCT_INSTANCE_ID as USER_ID
				,bass1.fn_get_all_dim_ex('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
				,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
				,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id 
					order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
				from  bass2.Dw_product_ins_off_ins_prod_ds a 
				     ,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      ) b 
				where char(a.offer_id) = b.offer_id 
				and a.state=1
				and a.valid_type = 1 
				 and a.OP_TIME = '$op_time'
				 and date(a.VALID_DATE)<='$op_time'
			    ) AS T where t.rn = 1 
			 with ur 

select count(0) from    g_i_02023_day
                                
                                

select 
				USER_ID
				,ADD_PKG_ID
				,VALID_DT
			FROM (
				SELECT
				 a.PRODUCT_INSTANCE_ID as USER_ID
				,bass1.fn_get_all_dim_ex('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
				,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
				,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id 
					order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
				from  bass2.Dw_product_ins_off_ins_prod_ds a 
				     ,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      ) b 
				where char(a.offer_id) = b.offer_id 
				and a.state=1
				and a.valid_type = 1 
				 and a.OP_TIME = '2011-05-17'
				 and date(a.VALID_DATE)<='2011-05-17'
			    ) AS T where t.rn = 1 
			 with ur 

select * from    BASS1.G_I_02023_DAY_1

                                
                                
	select 
			20110517 as TIME_ID
			,a.USER_ID
			,a.ADD_PKG_ID
			,a.VALID_DT
		from  bass1.G_I_02023_DAY_1 as a 
		      ,bass2.dw_product_20110517 as b
		    where a.user_id = b.user_id
		    and b.usertype_id in (1,2,9) 
		    and b.userstatus_id in (1,2,3,6,8)
		    and b.test_mark<>1
	with ur 
                                
select * from    bass1.g_i_02023_day
select * from   BASS1.G_I_02023_DAY_1
select * from   bass2.Dw_product_ins_off_ins_prod_ds


select * from bass2.dim_prod_up_product_item where extend_id in(90001348, 90001349, 90001350, 90001351, 90001352, 90001353, 90001354, 90001355, 90001356, 90001357, 90001358, 90001359, 90001360, 90001361, 90001362 )

select * from    BASS1.ALL_DIM_LKP 
where    bass1_tbid   = 'BASS_STD1_0114'                          
                                
select * from   bass2.ODS_PRODUCT_INS_PROD_20110517 a
where char(a.offer_id) in (
select xzbas_value
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114' )
                                

select * from bass2.dim_prod_up_product_item
where   PRODUCT_ITEM_ID =      111089710018                         
111089110016
                                

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02023_DAY 
group by  time_id 
order by 1 
                                
                                


select * from   bass2.ODS_PRODUCT_INS_PROD_20110517 a                                
where a.offer_id = 111090001331

                                


select * from   bass2.ODS_PRODUCT_INS_PROD_20110517 a                                
where a.offer_id = 111090001331

select * from   bass2.Dw_product_ins_off_ins_prod_ds a
where a.offer_id = 111090001331


select a.product_instance_id, b.*
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id ,BASS1_VALUE_DESC
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id 
				and a.state=1
				and a.valid_type = 1 
				 and a.OP_TIME = '2011-05-17'
				 and date(a.VALID_DATE)<='2011-05-17'



	select 
		20110517 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,bass1.fn_get_all_dim_EX('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
		,replace(char(date(a.create_date)),'-','') VALID_DT
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
				      ) c
	where  char(a.offer_id) = c.offer_id 
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-05-17'	  
	  and date(a.VALID_DATE)<='2011-05-17'	  
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110517 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
                )
	 with ur 

                                

select * from   bass1.g_i_02022_day
                                
                                
select * from   bass2.Dw_product_ins_off_ins_prod_ds a
where product_instance_id = '89160000912058'
                                      
                                     

	select a.*,
		20110517 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,bass1.fn_get_all_dim_EX('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
		,replace(char(date(a.create_date)),'-','') VALID_DT
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
				      ) c
	where  char(a.offer_id) = c.offer_id 
    and a.product_instance_id = '89160000912058'
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-05-17'	  
	  and date(a.VALID_DATE)<='2011-05-17'	  
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110517 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
                )
	 with ur 
                                     

select * from bass2.dim_prod_up_product_item
where   PRODUCT_ITEM_ID =      111090001352                                          
OFFER_ID
111090001335
111090001352


select count(0),count(distinct user_id ) from     bass1.g_i_02022_day                                     

select * from    bass1.g_i_02022_day      

select * from    bass1.g_i_02023_day      

select user_id from   bass1.g_i_02022_day      
group by user_id having count(0) > 1

select user_id from    bass1.g_i_02023_day      
except
select user_id from    bass1.g_i_02022_day
      
select * from   bass1.g_i_02023_day      


select user_id from    bass1.g_i_02022_day      
except
select user_id from    bass1.g_i_02023_day




	select a.*,c.*
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id ,XZBAS_COLNAME
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
				      ) c
	where  char(a.offer_id) = c.offer_id 
    and a.product_instance_id in (select user_id from   bass1.g_i_02022_day      
group by user_id having count(0) > 1)
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-05-17'	  
	  and date(a.VALID_DATE)<='2011-05-17'	  
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110517 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
                )
	 with ur 
     
             


select a.*,target3*100
,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0'
end IF_OK
,substr(rule_code,6) seq
 from 
bass1.g_rule_check a where rule_code like 'R161_%'
--and time_id = 20110523
and rule_code = 'R161_3'
order by 
time_id desc ,
CASE WHEN LENGTH(rule_code) =  7 
THEN 'S'||rule_code 
ELSE rule_code END 
asc 

            
            
            


update app.g_runlog 
set return_flag = 0
where time_id in (20110517)
and return_flag = 1
and unit_code in ('02022','02023')






session.int_check_user_status 


select * from   g_a_02008_day  a 
,bass1.g_i_02022_day       b 
where a.user_id = b.USER_ID
and a.TIME_ID > 20100626
order by 2,1

            

select * from   session.int_check_user_status  a 
,bass1.g_i_02023_day       b 
where a.user_id = b.USER_ID


select * from    bass2.Dw_product_ins_off_ins_prod_ds where product_instance_id = '89601160028204'
            
select * from   bass1.g_a_02004_day where user_id = '89601160028204'

           
select * from    bass2.Dw_product_ins_off_ins_prod_ds where product_instance_id = '89601160028204'


select * from   bass2.dw_product_20110517 where user_id = '89601160028204'
13638968642


select * from   bass2.dim_pub_plan
order by 2



select user_id from       bass2.dw_product_20110517 a 
,bass2.dim_pub_plan b where a.plan_id = b.PLAN_ID 
        and a.plan_id 
       in 
(
 89710018
,89510018
,89110018
,89410018
,89610018
,89210018
,89310018
,89710017
,89510017
,89110017
,89410017
,89610017
,89210017
,89310017
,89710016
,89510016
,89110016
,89410016
,89610016
,89210016
,89310016
) 
except 
select user_id from bass1.g_i_02022_day   


select * from  bass2.dw_product_20110517
where user_id in (

select user_id from       bass2.dw_product_20110517 a 
,bass2.dim_pub_plan b where a.plan_id = b.PLAN_ID 
        and a.plan_id 
       in 
(
 89710018
,89510018
,89110018
,89410018
,89610018
,89210018
,89310018
,89710017
,89510017
,89110017
,89410017
,89610017
,89210017
,89310017
,89710016
,89510016
,89110016
,89410016
,89610016
,89210016
,89310016
) 
except 
select user_id from bass1.g_i_02022_day   

)



select count(0),count(distinct product_instance_id )     
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  char(a.offer_id) = c.offer_id 
          and a.OP_TIME = '2011-05-17'    
          and date(a.VALID_DATE)<='2011-05-17'    
          and a.state =1
          and a.valid_type = 1
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110517 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         ) 
                         


select * from    bass1.g_a_02004_day   
where user_id = '89160000879573'                         



select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_i_02022_day 
group by  time_id 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_i_02023_day 
group by  time_id 
order by 1 

select VALID_DT , count(0) 
--,  count(distinct VALID_DT ) 
from bass1.g_i_02022_day 
group by  VALID_DT 
order by 1 






select * from bass1.g_i_02022_day  where time_id = 20110518




select * from   
bass1.g_rule_check a 
where rule_code like 'R161_%'
and time_id = 20110517


select * from   table( bass1.chk_wave() ) a


select * from   BASS1.G_S_22035_MONTH



select * from   table( bass1.chk_wave() ) a
order by 2



select a.*,target3*100
,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0'
end rule_name
,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0'
end IF_OK
,substr(rule_code,6) seq
 from 
bass1.g_rule_check a where rule_code like 'R161_%'
and time_id = 20110531
order by CASE WHEN LENGTH(rule_code) =  7 
THEN 'S'||rule_code 
ELSE rule_code END 
asc 


/**
select * from  app.sch_control_alarm 
where alarmtime >=  timestamp('20110322'||'000000') 
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 
**/



                                                  
                                                                
select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1. g_s_22063_month where time_id =201104)
  and time_id =201104
  and channel_type in ('2','3')
  and channel_status='1'
                                                                
                                                                
                                                                


           
           

TABNAME
MON_ALL_INTERFACE
MON_INTERFACE_NOT_EMPTY
MON_USER_MOBILE
MONIT_SQL
MONITOR_CONFIG
MONITOR_LIST
MONTH_02006_MID1
MONTH_02006_MID2


select * from   MON_INTERFACE_NOT_EMPTY

select count(0) from     BASS1.G_I_02022_DAY where time_id = 20110520

select count(0) from     BASS1.G_I_02022_DAY where time_id = 20110519
select count(0) from     BASS1.G_I_02022_DAY where time_id = 20110518

select count(0) from     BASS1.G_I_02023_DAY where time_id = 20110520
select count(0) from     BASS1.G_I_02023_DAY where time_id = 20110519
select count(0) from     BASS1.G_I_02023_DAY where time_id = 20110518




select 
time_id
,int(substr(rule_code,6)) seq
,case 
    when rule_code = 'R161_1' then '新增客户数'
    when rule_code = 'R161_2' then '客户到达数'
    when rule_code = 'R161_3' then '净增客户数'
    when rule_code = 'R161_4' then '通信客户数'
    when rule_code = 'R161_5' then '当月累计通信客户数'
    when rule_code = 'R161_6' then '使用TD网络的客户数'
    when rule_code = 'R161_7' then '当月累计使用TD网络的手机客户数'
    when rule_code = 'R161_8' then '当月累计使用TD网络的信息机客户数'
    when rule_code = 'R161_9' then '当月累计使用TD网络的数据卡客户数'
    when rule_code = 'R161_10' then '当月累计使用TD网络的上网本客户数'
    when rule_code = 'R161_11' then '联通移动客户总数'
    when rule_code = 'R161_12' then '电信移动客户总数'
    when rule_code = 'R161_13' then '联通移动新增客户数'
    when rule_code = 'R161_14' then '电信移动新增客户数'
    when rule_code = 'R161_15' then '使用TD网络的客户在T网上计费时长'
    when rule_code = 'R161_16' then '使用TD网络的客户在T网上的数据流量'
    when rule_code = 'R161_17' then '离网客户数' else '0' end rule_name 
    , target3*100 wave_rate
    ,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0' end if_ok
from 
bass1.g_rule_check a 
where rule_code like 'R161_%'
and time_id = 20110521



select * from app.sch_control_task a 
where control_code like  '%BUSI%REC%'



select * from app.sch_control_task a 
where control_code like  '%G_S_22062_MONTH%'
and cc_flag = 1

select * from app.sch_control_task a 
where control_code like  '%G_S_22064_MONTH%'
and cc_flag = 1

select * from app.sch_control_task a 
where control_code like  '%G_S_22065_MONTH%'
and cc_flag = 1




select channel_id , count(0) 
--,  count(distinct channel_id ) 
from session.int_check_user_status 
group by  channel_id 
order by 1 



select bigint(QRY_CNT),bigint(CANCEL_CNT) from    bass1.G_S_22080_DAY
where bigint(QRY_CNT)<bigint(CANCEL_CNT)


select int(replace(char(date(a.create_date)),'-','') ),count(0)
from 	BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201105 a 
group by int(replace(char(date(a.create_date)),'-','') )






select count(0) from    bass2.dw_product_ins_prod_201104
select count(0) from    bass2.dw_product_ins_prod_201104


                select count(0)
                from bass2.dw_product_ins_prod_201104 a
          left join (select xzbas_value  as offer_id ,bass1_value bass1_offer_id
                                                        from  BASS1.ALL_DIM_LKP 
                                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                      ) d on char(a.offer_id) = d.offer_id 
                    ,(
                    select product_instance_id user_id from bass2.dw_product_ins_prod_201104
                    where state in ('1','4','6','8','M','7','C','9')
                      and user_type_id =1
                      and valid_type = 1
                      and bill_id not in ('D15289014474','D15289014454')
                    except
                    select user_id from bass2.dw_product_test_phone_201104
                    where sts=1
                    ) b
                where a.product_instance_id=b.user_id
                  and a.state in ('1','4','6','8','M','7','C','9')
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')


select count(0),count(distinct product_instance_id)
from bass2.dw_product_ins_prod_201104 a
left join (select xzbas_value  as offer_id ,bass1_value bass1_offer_id
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                              and bass1_value like 'QW_QQT_JC%'
                      ) d on char(a.offer_id) = d.offer_id 
where 
  a.state in ('1','4','6','8','M','7','C','9')
  and a.user_type_id =1
  and a.valid_type = 1
  and a.bill_id not in ('D15289014474','D15289014454')
  and not exists (select 1 from  bass2.dw_product_test_phone_201104 b where a.product_instance_id
  = b.user_id and  b.sts=1)
  

bill_id not in ('D5289014474','D15289014454')
bill_id not in ('D15289014474','D15289014454')
select count(0),count(distinct product_instance_id )   from bass2.dw_product_ins_prod_201104
                    where state in ('1','4','6','8','M','7','C','9')
                      and user_type_id =1
                      and valid_type = 1
                      and bill_id not in ('D15289014474','D15289014454')

select count(0) from    
                    (select distinct product_instance_id user_id  from bass2.dw_product_ins_prod_201104
                    where state in ('1','4','6','8','M','7','C','9')
                      and user_type_id =1
                      and valid_type = 1
                      and bill_id not in ('D15289014474','D15289014454')
                      ) t 
                    ,(
                    select user_id from bass2.dw_product_test_phone_201104
                    where sts=1 ) a where t.user_id = a.user_id 


1430


select count(0) from    bass1.g_i_02020_month where time_id = 201104

1623498

1623498


select count(0),count(distinct user_id) from    BASS1.G_I_02022_DAY where time_id = 20110523
                   


select count(0),count(distinct product_instance_id ) from    bass2.dw_product_ins_prod_ds a 
, (select user_id from   BASS1.G_I_02022_DAY where time_id = 20110523 ) b 
where a.product_instance_id = b.user_id 



select * from   bass1.g_i_02020_month where time_id = 201104

                   
                   

                select 
                     201104,d.bass1_offer_id,
                     value(d.bass1_offer_id,char(a.product_instance_id)),
                     char(a.offer_id),
                     replace(char(date(a.create_date)),'-','')
                from bass2.dw_product_ins_prod_201104 a
          left join (select xzbas_value  as offer_id ,bass1_value bass1_offer_id
                                                        from  BASS1.ALL_DIM_LKP 
                                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                      ) d on char(a.offer_id) = d.offer_id                 
                where  a.state in ('1','4','6','8','M','7','C','9')
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201104 b 
where a.product_instance_id
                                                                                                                                        = b.user_id and  b.sts=1
                                )
and d.bass1_offer_id is not null 

select control_code  from  table( bass1.get_task('ZD_VILLAGE_USERS')) a 

select * from   app.sch_control_task where control_code 
in (select control_code  from  table( bass1.get_task('ZD_VILLAGE_USERS')) a 
)

update  app.sch_control_task 
set time_value = 310
where control_code 
= 'BASS1_G_S_22061_MONTH.tcl'

update app.sch_control_task set time_value = -1
where  control_code = 'BASS1_G_I_03007_MONTH.tcl'


select * from   G_A_01006_DAY

insert into app.sch_control_before 
select 'BASS1_G_S_22082_DAY.tcl','.tcl' from bass2.dual


select count(0) from    bass1.g_i_02020_month where time_id = 201104
and BASE_PROD_ID like '%QW%'

                                
                                
select * from    bass2.DIM_PROD_UP_PRODUCT_ITEM
where supplier_id = '701776'

                                

select * from  bass1.g_i_02022_day

                                

select * from   app.sch_control_map
                                
                                
	select count(0) from 
	(select count(0) cnt from bass1.g_i_02022_day a where time_id = 20110531
			except 
	 select count(0) cnt from bass1.g_i_02020_month a where time_id = 201105
	) a 
	with ur 

    
    select 
        (select count(0) cnt from bass1.g_i_02022_day a where time_id = 20110430) - 
                         
         (select count(0) cnt from bass1.g_i_02020_month a where time_id = 201104 and 
         BASE_PROD_ID like 'QW_QQT_JC%') from bass2.dual
        ) a 
        with ur 



    select 
        (select count(0) cnt from bass1.g_i_02022_day a where time_id = 20110430)                
         - (select count(0) cnt from bass1.g_i_02020_month a where time_id = 201104 and  BASE_PROD_ID like 'QW_QQT_JC%') 
         from bass2.dual
        with ur 

select count(0),count(distinct BASE_PROD_ID ) from   bass1.g_i_02019_month_4



select * from    bass1.G_I_02023_DAY where time_id = 20110524

                                

                select 
                     a.product_instance_id,
                     a.offer_id,
                     replace(char(date(min(a.create_date))),'-','')
                from (select a.offer_id,a.product_instance_id,a.create_date 
                                        from  bass2.dw_product_ins_off_ins_prod_ds a
                                        where 
                                        replace(char(date(a.create_date)),'-','')<='20110524'
                                and replace(char(date(a.expire_date)),'-','')>='20110501'
                                and a.state=1
                                        and a.valid_type = 1
                                        ) a,
                                  (select xzbas_value  as base_prod_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      )  b 
                where 
                                char(a.offer_id)=char(b.base_prod_id )
        group by a.product_instance_id,a.offer_id
        with ur


select * from  table( bass1.get_before('BASS1_EXP_G_I_03001_MONTH')) a 
select * from   app.sch_control_before where control_code like '%02019%'                                
BASS1_INT_CHECK_R029_MONTH.tcl

select * from    app.sch_control_runlog where control_code in (
select before_control_code from  table( bass1.get_before('BASS1_EXP_G_S_21003_MONTH')) a 
)



select * from   
 bass1.g_i_02021_month
 where OVER_PROD_ID in 
  (select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      ) 
 
 
 
 
 
                select 
                     a.product_instance_id
                from (select a.offer_id,a.product_instance_id,a.create_date 
                                        from  bass2.dw_product_ins_off_ins_prod_ds a
                                        where 
                                        replace(char(date(a.create_date)),'-','')<='20110524'
                                and replace(char(date(a.expire_date)),'-','')>='20110501'
                                and a.state=1
                                and a.valid_type = 1
                                        ) a,
                                  (select xzbas_value  as base_prod_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      )  b 
                where 
                                char(a.offer_id)=char(b.base_prod_id )
                                and not exists (    select 1 from bass2.dw_product_test_phone_201104 c 
    where sts=1 and a.product_instance_id = c.user_id)
                           
        group by a.product_instance_id
except 
select USER_ID from G_I_02023_DAY
where time_id = 20110524

1
89160000877968
89160000878345

select * from    bass2.dw_product_test_phone_201104 where user_id = '89160000877968'

select test_mark  from bass2.dw_product_20110524 where  
user_id = '89160000877968'

select * from    bass2.dw_product_ins_off_ins_prod_ds  a ,
 (select xzbas_value  as base_prod_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      )  b 
                where 
                                char(a.offer_id)=char(b.base_prod_id )
and product_instance_id = '89160000878345'
 



                        select 
                        distinct 
                                USER_ID
                                ,ADD_PKG_ID
                                ,VALID_DT
                        FROM (
                                SELECT
                                 a.PRODUCT_INSTANCE_ID as USER_ID
                                ,bass1.fn_get_all_dim_ex('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
                                ,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
                                ,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id 
                                        order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id 
                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-05-24'
                                 and date(a.VALID_DATE)<='2011-05-24'
                            ) AS T where t.rn = 1 
                            and USER_ID = '89160000877968'
                         with ur 



select distinct user_id from bass2.dw_product_201104
							where userstatus_id in (1,2,3,6,8)
  						and usertype_id in (1,2,9) 
and   			
                         
                         

CREATE TABLE BASS1.t_imei_a
 (
        imei varchar(18)
        ,tac_num varchar(10)	  
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (imei) USING HASHING

ALTER TABLE BASS1.t_imei_a
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE
                         
                         
insert into   BASS1.t_imei_a
select imei,substr(a.imei,1,8) 
from   bass2.dw_product_mobilefunc_201104 a

db2 RUNSTATS ON table  BASS1.t_imei_a	with distribution and detailed indexes all  
                          BASS1.t_imei_a
 
 select user_id from bass2.dw_product_mobilefunc_201104 where imei in (
select imei from       BASS1.t_imei_a where tac_num in                        
(
select tac_num from   BASS2.DIM_TERM_TAC where 
TERM_MODEL='Iphone 4'  )    
)
                          
1010
                          
                          
select count(0) from    
(
 select user_id from bass2.dw_product_mobilefunc_201104 where imei in (
select imei from       BASS1.t_imei_a where tac_num in                        
(
select tac_num from   BASS2.DIM_TERM_TAC where 
upper(TERM_MODEL) LIKE 'IPHONE%'  )    
)) a ,                           
(
select  user_id from bass2.dw_product_201104
							where userstatus_id in (1,2,3,6,8)
  						and usertype_id in (1,2,9) ) b 
where a.user_id = b.user_id 
                        
                        
970

6300                        5481



drop table BASS1.t_imei_a 





select USER_ID from G_I_02023_DAY
where time_id = 20110524
 except 
                select 
                     a.product_instance_id
                from (select a.offer_id,a.product_instance_id,a.create_date 
                                        from  bass2.dw_product_ins_off_ins_prod_ds a
                                        where 
                                        replace(char(date(a.create_date)),'-','')<='20110524'
                                and replace(char(date(a.expire_date)),'-','')>='20110501'
                                and a.state=1
                                and a.valid_type = 1
                                        ) a,
                                  (select xzbas_value  as base_prod_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      )  b 
                where 
                                char(a.offer_id)=char(b.base_prod_id )
                                and not exists (    select 1 from bass2.Dwd_product_test_phone_20110524 c 
    where sts=1 and a.product_instance_id = c.user_id)
                           
        group by a.product_instance_id
        
        


                select 
                     a.product_instance_id
                from (select a.offer_id,a.product_instance_id,a.create_date 
                                        from  bass2.dw_product_ins_off_ins_prod_ds a
                                        where 
                                        replace(char(date(a.create_date)),'-','')<='20110524'
                                and replace(char(date(a.expire_date)),'-','')>='20110501'
                                and a.state=1
                                and a.valid_type = 1
                                        ) a,
                                  (select xzbas_value  as base_prod_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0115'
					      and bass1_value like 'QW_QQT_DJ%'
				      )  b 
                where 
                                char(a.offer_id)=char(b.base_prod_id )
                                and not exists (    select 1 from bass2.Dwd_product_test_phone_20110524 c 
    where sts=1 and a.product_instance_id = c.user_id)
                           
        group by a.product_instance_id        
except 
select USER_ID from G_I_02023_DAY
where time_id = 20110524
 
 
 select count(0) from   bass1.g_i_02021_month
 where 
 
 
 select * from  bass1.g_i_02023_day
 
 
     select 
        (select count(0) cnt from bass1.g_i_02023_day a where time_id = 20110531)                     
         - (select count(0) cnt from bass1.g_i_02021_month a where time_id = 201104 and  OVER_PROD_ID like 'QW_QQT_DJ%')
         from bass2.dual
	with ur 
    
    

select * from   G_I_02018_MONTH where time_id = 201104
   

select * from   G_I_02019_MONTH where time_id = 201104

   
   

select count(*) from 
                    (
                     select distinct  BASE_PROD_ID from bass1.g_i_02020_month
                      where time_id =201104
               except
                                                         select  BASE_PROD_ID from bass1.g_i_02018_month 
                                                          where time_id =201104            
                    ) as a
                    with ur
                    
                   
                   
select count(0),count(distinct interface_code) from    MON_INTERFACE_NOT_EMPTY                   

select * from   
MON_INTERFACE_NOT_EMPTY
where interface_code 
in
('22091'
,'22092'
,'22066'
,'22067'
,'22068'
,'22086'
)

22091
22092
22066
22067
22068
22086

insert into MON_INTERFACE_NOT_EMPTY
values 
 '22091'
,'22092'
,'22066'
,'22067'
,'22068'
,'22086'



select count(0) from  bass2.dw_product_bass1_20110524

                   
select time_id,count(0)
from BASS1.G_S_04011_DAY
group by time_id
order by 1 desc 
                   
                   

select * from   bass1.G_RULE_CHECK where rule_code = 'R109'      
order by time_id desc 





select count(0) from     BASS1.G_S_04012_DAY 


select * from   MON_ALL_INTERFACE
where 

select * from   bass1.MON_ALL_INTERFACE where interface_code = '04011'

select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'
and deadline =9








select * from   
BASS1.G_S_04011_DAY



select count(0) from    BASS1.G_S_04011_DAY_LS


 SELECT time_id,COUNT(*) AS TXL  FROM BASS1.G_S_04011_DAY
 WHERE TIME_ID=20110525
       AND CDR_TYPE IN ('00','10','21')
       AND SVC_TYPE IN ('11','12','13')
       AND SMS_STATUS='0'
  group by time_id



 SELECT PRODUCT_NO,COUNT(*) AS TXL  FROM BASS1.G_S_04011_DAY
 WHERE TIME_ID=20110525
       AND CDR_TYPE IN ('00','10','21')
       AND SVC_TYPE IN ('11','12','13')
       AND SMS_STATUS='0'
 GROUP BY PRODUCT_NO
 
 
 select count(0) from    BASS1.G_S_04011_DAY where time_id = 20110525
 
 
 
 
 
 
 select count(0) from    BASS1.G_S_04011_DAY_LS 
 
 
alter table BASS1.G_S_04011_DAY_LS activate not logged initially with empty table;
COMMIT;
INSERT INTO BASS1.G_S_04011_DAY_LS 
SELECT * 
FROM bass1.g_s_04011_day 
WHERE time_id = 20110525 
  AND CDR_TYPE 
IN ('00', '10', '21') 
   AND SVC_TYPE 
IN ('11', '12', '13') 
   AND SMS_STATUS = '0';
COMMIT;
DELETE 
FROM BASS1.G_S_04011_DAY 
WHERE TIME_ID = 20110525 
   AND CDR_TYPE 
IN ('00', '10', '21') 
   AND SVC_TYPE 
IN ('11', '12', '13') 
   AND SMS_STATUS = '0';
COMMIT;
select count(*) from BASS1.G_S_04011_DAY_LS

select count(*) from 
(
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<9
) bb



insert into BASS1.G_S_04011_DAY
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<9;
COMMIT;
select a.*,TARGET3*100 from   g_rulE_check a where rule_code in ('R173','R174')
and TARGET3*100 > 40
ORDER BY 1 DESC 



select time_id , count(0) 
,  count(distinct user_id ) 
from BASS1.G_I_02005_MONTH 
group by  time_id 
order by 1 


select * from   G_A_01004_DAY


select * from   bass1.G_A_02059_DAY

select count(0),count(distinct enterprise_id ) from     bass1.G_A_02059_DAY
select * from bass1.G_A_02059_DAY a 
where 
time_id / 100 = 201104
AND trim(A.enterprise_id) <> ''
and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )




select * from   app.g_unit_info




insert into app.sch_control_map
values
 (2,'INT_CHECK_R177182_DAY.tcl','BASS1_INT_CHECK_R177182_DAY.tcl')



select * from    bass1.int_program_data


select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R177182_DAY.tcl' PROGRAM_NAME
,'R177182.bass' SOURCE_DATA
,'R177182._e' OBJECTIVE_DATA
,'R177182._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R177182_DAY.tcl' PROGRAM_NAME
,'R177182.bass' SOURCE_DATA
,'R177182._e' OBJECTIVE_DATA
,'R177182._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


select * from   BASS1.G_RULE_CHECK where  rule_code in ('R178','R183') 


                select count(0) from bass1.G_A_02059_DAY a 
                where 
                time_id / 100 = 201105
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
                



        select count(0) from bass1.G_A_02059_DAY a 
        where 
                time_id  = 20110525
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t where a.user_id = t.user_id )
                with ur
 
 INSERT INTO BASS1.G_RULE_CHECK VALUES (20110525,'R177',0,0,0,0) 

                select count(0) from bass1.G_A_02059_DAY a 
                where 
                time_id = 20110525
                AND trim(A.enterprise_id) <> ''         
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
                with ur
                
                
select * from   G_A_02060_DAY

insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02059_DAY','BASS1_INT_CHECK_R177182_DAY.tcl' from bass2.dual
                
                
delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R177182_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R177182_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R177182_DAY.tcl',
   10000,
   - 1,
   'R177/R182 02059校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R177182_DAY.tcl','BASS1_G_A_02059_DAY.tcl' from bass2.dual



insert into app.sch_control_map
values
 (2,'INT_CHECK_R178183_DAY.tcl','BASS1_INT_CHECK_R178183_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R178183_DAY.tcl' PROGRAM_NAME
,'R178183.bass' SOURCE_DATA
,'R178183._e' OBJECTIVE_DATA
,'R178183._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'                


select * from   bass1.G_A_02060_DAY 

select * from   BASS1.G_RULE_CHECK where  rule_code in ('R177','R182') 

select * from   G_I_06021_MONTH
select * from   G_A_02061_DAY


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R178183_DAY.tcl','BASS1_G_A_02060_DAY.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02060_DAY','BASS1_INT_CHECK_R178183_DAY.tcl' from bass2.dual


delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R178183_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R178183_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R178183_DAY.tcl',
   10000,
   - 1,
   'R178/R183 02060校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
insert into app.sch_control_map
values
 (2,'INT_CHECK_R179184_DAY.tcl','BASS1_INT_CHECK_R179184_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R179184_DAY.tcl' PROGRAM_NAME
,'R179184.bass' SOURCE_DATA
,'R179184._e' OBJECTIVE_DATA
,'R179184._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R179184_DAY.tcl','BASS1_G_A_02061_DAY.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02061_DAY','BASS1_INT_CHECK_R179184_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R179184_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R179184_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R179184_DAY.tcl',
   10000,
   - 1,
   'R179/R184 02061校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
select * from   BASS1.G_RULE_CHECK where  rule_code in ('R179','R184') 




insert into app.sch_control_map
values
 (2,'INT_CHECK_R180185_DAY.tcl','BASS1_INT_CHECK_R180185_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R180185_DAY.tcl' PROGRAM_NAME
,'R180185.bass' SOURCE_DATA
,'R180185._e' OBJECTIVE_DATA
,'R180185._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R180185_DAY.tcl','BASS1_G_A_02062_DAY.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02062_DAY','BASS1_INT_CHECK_R180185_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R180185_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R180185_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R180185_DAY.tcl',
   10000,
   - 1,
   'R180/R185 02062校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
select * from   BASS1.G_RULE_CHECK where  rule_code in ('R180','R185') 

select * from    bass1.G_S_03018_MONTH 


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R177182_DAY.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R177182_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R178183_DAY.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R178183_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R178183_DAY.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R178183_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R179184_DAY.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R179184_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R180185_DAY.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R180185_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual



select * from   BASS1.G_RULE_CHECK where  rule_code in ('R181') 
delete from  BASS1.G_RULE_CHECK where time_id=20110525 and rule_code in ('R181') 

insert into app.sch_control_map
values
 (2,'INT_CHECK_R181_MONTH.tcl','BASS1_INT_CHECK_R181_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R181_MONTH.tcl' PROGRAM_NAME
,'R181.bass' SOURCE_DATA
,'R181._e' OBJECTIVE_DATA
,'R181._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R181_MONTH.tcl','BASS1_G_S_03018_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R181_MONTH.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_EXP_G_S_03018_MONTH','BASS1_INT_CHECK_R181_MONTH.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R181_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R181_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R181_MONTH.tcl',
   10000,
   - 1,
   'R181 03018校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
--166280
        select count(0) from bass1.G_S_03018_MONTH a 
        where 
                time_id = 201104
                
        select count(0) from bass1.G_S_03018_MONTH a 
        where 
                time_id = 201104 and ent_busi_id = '1300'
                
        select * from bass1.G_S_03018_MONTH a 
        where 
                time_id = 201104
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t where a.user_id = t.user_id )
        with ur
        

89457333577058      

select * from   bass2.dw_product_bass1_20110525
where user_id = '89457333577058'



select * from   BASS1.G_RULE_CHECK where  rule_code in ('R186') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R186_DAY.tcl','BASS1_INT_CHECK_R186_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R186_DAY.tcl' PROGRAM_NAME
,'R186.bass' SOURCE_DATA
,'R186._e' OBJECTIVE_DATA
,'R186._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R186_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R186_DAY.tcl','BASS1_G_A_02054_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02054_DAY','BASS1_INT_CHECK_R186_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R186_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R186_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R186_DAY.tcl',
   10000,
   - 1,
   'R186 02054校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
select count(0) from     bass1.G_A_02054_DAY

select * from   BASS1.G_RULE_CHECK where  rule_code in ('R186') 



select * from   BASS1.G_RULE_CHECK where  rule_code in ('R187') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R187_DAY.tcl','BASS1_INT_CHECK_R187_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R187_DAY.tcl' PROGRAM_NAME
,'R187.bass' SOURCE_DATA
,'R187._e' OBJECTIVE_DATA
,'R187._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R187_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R187_DAY.tcl','BASS1_G_A_02055_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02055_DAY','BASS1_INT_CHECK_R187_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R187_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R187_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R187_DAY.tcl',
   10000,
   - 1,
   'R187 02055校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
select count(0) from bass1.G_A_02055_DAY a 
                where 
                time_id / 100 = 201105          
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
                with ur
                
                
                

select * from   BASS1.G_RULE_CHECK where  rule_code in ('R188') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R188_DAY.tcl','BASS1_INT_CHECK_R188_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R188_DAY.tcl' PROGRAM_NAME
,'R188.bass' SOURCE_DATA
,'R188._e' OBJECTIVE_DATA
,'R188._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R188_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R188_DAY.tcl','BASS1_G_A_02056_DAY.tcl' from bass2.dual

select count(0) from    G_I_02023_DAY where time_id = 20110525


insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02056_DAY','BASS1_INT_CHECK_R188_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R188_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R188_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R188_DAY.tcl',
   10000,
   - 1,
   'R188 02056校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/' 
   );
ALTER TABLE BASS1.G_S_04011_DAY_LS activate 
   NOT logged initially 
   WITH empty TABLE;
COMMIT;
INSERT INTO BASS1.G_S_04011_DAY_LS 
SELECT * 
FROM bass1.g_s_04011_day 
WHERE time_id = 20110526 
  AND CDR_TYPE 
IN ('00', '10', '21') 
   AND SVC_TYPE 
IN ('11', '12', '13') 
   AND SMS_STATUS = '0';
COMMIT;
DELETE 
FROM BASS1.G_S_04011_DAY 
WHERE TIME_ID = 20110526 
   AND CDR_TYPE 
IN ('00', '10', '21') 
   AND SVC_TYPE 
IN ('11', '12', '13') 
   AND SMS_STATUS = '0';
COMMIT;
select count(*) from BASS1.G_S_04011_DAY_LS

select count(*) from 
(
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<9
) bb



insert into BASS1.G_S_04011_DAY
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<9;
COMMIT;
select count(0)     
                from bass1.g_i_02022_day
                where time_id =20110526
        from (
                select user_id ,count(0)  cnt
                from bass1.g_i_02022_day
                where time_id =20110526
                group by user_id having count(0) > 1
                ) t 


89160000935432      

select * from    bass1.g_i_02022_day where user_id = '89160000935432'
        select  count(0)
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  
         char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and a.OP_TIME = '2011-05-26'    
          and date(a.VALID_DATE)<='2011-05-26'    
          and date(a.expire_date) > '2011-05-26'    
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110526 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         )          with ur
                




        select a.product_instance_id
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  
         char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and a.OP_TIME = '2011-05-26'    
          and date(a.VALID_DATE)<='2011-05-26'    
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110526 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         )         
except

        select product_instance_id 
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  
         char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and a.OP_TIME = '2011-05-26'    
          and date(a.VALID_DATE)<='2011-05-26'    
          and date(a.expire_date) > '2011-05-26'    
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110526 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         )          with ur                                                
                         
                         
                         
        select *
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  a.product_instance_id = '89157333894595'
         and char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and a.OP_TIME = '2011-05-26'    
          and date(a.VALID_DATE)<='2011-05-26'    
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110526 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         )          with ur    
89157333894595                         

select * from   bass2.dw_product_20110526
where user_id = '89157333894595'


select * from   bass2.dim_pub_plan where plan_id = 89110011




select 	TIME_ID,USER_ID,BASE_PKG_ID,VALID_DT
from (
	select 
		20110526 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,bass1.fn_get_all_dim_ex('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
		,replace(char(date(a.VALID_DATE)),'-','') VALID_DT
		,row_number()over(partition by a.product_instance_id order by expire_date desc ,VALID_DATE desc ) rn 
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'
				      ) c
	where  char(a.offer_id) = c.offer_id 
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-05-26'	  
	  and date(a.VALID_DATE)<='2011-05-26'	  
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20110526 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
			 ) 
) t where t.rn = 1
except 
select count(0),count(distinct user_id) from   bass1.g_i_02021_day
where time_id /100 = 201105



  select * from bass2.dw_product_ins_off_ins_prod_ds where product_instance_id = '89157333894595'
  and sysdate between valid_date and expire_date;
SELECT offer_id
FROM bass2.Dw_product_ins_prod_ds 
WHERE product_instance_id = '89157333894595' 
AND sysdate BETWEEN valid_date 
AND expire_date;
111089110011
  select * from  BASS1.ALL_DIM_LKP 
  where xzbas_value = '111089110011'
  
  select * from  bass2.DIM_PROD_UP_PRODUCT_ITEM
  where PRODUCT_ITEM_ID = 111089110011
  
  
  
  
  
select * from   BASS1.G_RULE_CHECK where  rule_code in ('R189') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R189_DAY.tcl','BASS1_INT_CHECK_R189_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R189_DAY.tcl' PROGRAM_NAME
,'R189.bass' SOURCE_DATA
,'R189._e' OBJECTIVE_DATA
,'R189._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R189_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R189_DAY.tcl','BASS1_G_A_02057_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02057_DAY','BASS1_INT_CHECK_R189_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R189_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R189_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R189_DAY.tcl',
   10000,
   - 1,
   'R189 02057校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select * from   app.sch_control_runlog where control_code like '%INT_CHECK_R189_DAY.tcl'


                select count(0) from bass1.G_A_02057_DAY a 
                where 
                time_id / 100 = 201105          
                
                



//////////////////////////////////////////////////////////////////////////////////

select * from   BASS1.G_RULE_CHECK where  rule_code in ('R190') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R190_DAY.tcl','BASS1_INT_CHECK_R190_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R190_DAY.tcl' PROGRAM_NAME
,'R190.bass' SOURCE_DATA
,'R190._e' OBJECTIVE_DATA
,'R190._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R190_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R190_DAY.tcl','BASS1_G_A_02058_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02058_DAY','BASS1_INT_CHECK_R190_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R190_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R190_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R190_DAY.tcl',
   10000,
   - 1,
   'R190 02058校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
//////////////////////////////////////////////////////////////////////////////////

select * from   BASS1.G_RULE_CHECK where  rule_code in ('R192') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R192_MONTH.tcl','BASS1_INT_CHECK_R192_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R192_MONTH.tcl' PROGRAM_NAME
,'R192.bass' SOURCE_DATA
,'R192._e' OBJECTIVE_DATA
,'R192._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R192_MONTH.tcl','BASS1_G_S_03017_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R192_MONTH.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_EXP_G_S_03017_MONTH','BASS1_INT_CHECK_R192_MONTH.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R192_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R192_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R192_MONTH.tcl',
   10000,
   - 1,
   'R192 03017校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select * from   BASS1.G_RULE_CHECK where  rule_code in ('R191') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R191_DAY.tcl','BASS1_INT_CHECK_R191_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R191_DAY.tcl' PROGRAM_NAME
,'R191.bass' SOURCE_DATA
,'R191._e' OBJECTIVE_DATA
,'R191._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R191_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R191_DAY.tcl','BASS1_G_A_02064_DAY.tcl' from bass2.dual




insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02064_DAY','BASS1_INT_CHECK_R191_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R191_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R191_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R191_DAY.tcl',
   10000,
   - 1,
   'R191 02064校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select * from    bass1.G_A_01007_DAY



select * from   BASS1.G_RULE_CHECK where  rule_code in ('R193','R194') 


insert into app.sch_control_map
values
 (2,'INT_CHECK_R193194_DAY.tcl','BASS1_INT_CHECK_R193194_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R193194_DAY.tcl' PROGRAM_NAME
,'R193194.bass' SOURCE_DATA
,'R193194._e' OBJECTIVE_DATA
,'R193194._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R193194_DAY.tcl','BASS1_G_A_01007_DAY.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R193194_DAY.tcl','BASS1_G_A_01004_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_EXP_G_A_01007_DAY','BASS1_INT_CHECK_R193194_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R193194_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R193194_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R193194_DAY.tcl',
   10000,
   - 1,
   'R193/R194 01007校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_A_01007_DAY 
group by  time_id 
order by 1 

select * from bass1.G_A_01007_DAY 


        select count(0) from bass1.G_A_01007_DAY a 
        where 
                time_id / 100 = 201105
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
        with ur
        
select * from   bass1.G_A_01005_DAY
        
        
select * from   bass1.G_A_01004_DAY
        
select count(0),count(distinct enterprise_id ) from    bass1.G_A_01004_DAY

        select count(0) from bass1.G_A_01007_DAY a 
        where 
                 not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
        with ur


select * from   G_A_01005_MONTH

select * from   bass1.G_A_01007_DAY

select RELA_STATE , count(0) 
--,  count(distinct RELA_STATE ) 
from bass1.G_A_01007_DAY 
group by  RELA_STATE 
order by 1 

select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_A_01007_DAY 
group by  time_id 
order by 1 desc 
        
select * from   bass1.G_A_01004_DAY 

        select count(0) from bass1.G_S_03017_MONTH a 
        where 
                time_id = 201104
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
        with ur
        
        select * from bass1.G_S_03017_MONTH a 
        where 
                time_id = 201104
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
        with ur
        

select count(0) from    G_S_03017_MONTH where time_id = 201104
        

select * from   bass1.G_A_01007_DAY
                select count(0) from bass1.G_A_01007_DAY a 
                where 
                time_id / 100 = 201105          
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01006_DAY ) t where a.enterprise_id = t.enterprise_id )
                with ur
                

        select count(0) from bass1.G_A_01007_DAY a 
        where 
                time_id / 100 = 201105
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
        with ur

        

select * from   bass1.MON_ALL_INTERFACE
where interface_code = '22303'                



select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from BASS1.G_A_02059_DAY 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 





select * from   ADC	0.05		



insert into app.sch_control_map
values
 (2,'INT_CHECK_R196TO207_DAY.tcl','BASS1_INT_CHECK_R196TO207_DAY.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R196TO207_DAY.tcl' PROGRAM_NAME
,'R196TO207.bass' SOURCE_DATA
,'R196TO207._e' OBJECTIVE_DATA
,'R196TO207._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R196TO207_DAY.tcl','BASS1_G_A_02054_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R196TO207_DAY.tcl','BASS1_G_A_02059_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R196TO207_DAY.tcl','BASS1_G_A_02061_DAY.tcl' from bass2.dual



insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02061_DAY','BASS1_INT_CHECK_R196TO207_DAY.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_A_02054_DAY','BASS1_INT_CHECK_R196TO207_DAY.tcl' from bass2.dual

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R196TO207_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R196TO207_DAY.tcl',
   1,
   2,
   'int -s INT_CHECK_R196TO207_DAY.tcl',
   10000,
   - 1,
   'R196TO207校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select count(0) cnt
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from g_a_02054_day where  MANAGE_MODE = '2'
                        and time_id <= 20110526 and ENTERPRISE_BUSI_TYPE = '1220'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
                        

                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02061_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE = '1220'
                                                and  MANAGE_MODE = '2'
                                                and time_id <= 20110526
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'

select * from   G_A_02061_DAY

select * from   G_A_02056_DAY


select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from G_A_02054_DAY 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 



select SUB_BUSI_TYPE , count(0) 
--,  count(distinct SUB_BUSI_TYPE ) 
from G_A_02058_DAY 
group by  SUB_BUSI_TYPE 
order by 1 


select * from   bass2.dw_enterprise_msg_201012  where ENTERPRISE_ID in (
                        select ENTERPRISE_ID
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110530 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
    )

select * from syscat.tables where tabname LIKE '%TRANS%ENTERPRISE%' 
                        
select * from   bass2.TRANS_ENTERPRISE_ID_20100625
                        




RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110527BAK;
CREATE TABLE BASS2.DIM_TERM_TAC(
   ID INTEGER,
   TAC_NUM VARCHAR(15),
   TERM_ID VARCHAR(10),
   TERM_MODEL VARCHAR(50),
   TERMPROD_ID VARCHAR(10),
   TERMPROD_NAME VARCHAR(200),
   NET_TYPE CHARACTER(1),
   TERM_TYPE CHARACTER(1) 
) DATA CAPTURE NONE 
 IN TBS_DIM PARTITIONING KEY(
    ID 
 )USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
drop table BASS2.DIM_TERM_TAC_MID
CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
SELECT ID,
   TAC_NUM,
   TERM_ID,
   TERM_MODEL,
   TERMPROD_ID,
   TERMPROD_NAME,
   NET_TYPE,
   TERM_TYPE
FROM BASS2.DIM_TERM_TAC_20110527BAK 
WHERE net_type <> '2';
select count(0) from    BASS2.DIM_TERM_TAC


delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110527BAK
where net_type <>'2';
COMMIT;
select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110527BAK
group by tac_nuM
having count(*)>1

drop table BASS2.DIM_TERM_TAC_MID

  
  
  
select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from g_a_02059_day 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 



				select count(0)
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02059_DAY
						where 
								 ENTERPRISE_BUSI_TYPE  in ('1000','1010','1020')
						and  MANAGE_MODE = '1'
						and time_id <= 20110526
						and length(trim(user_id)) = 14
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'
                
                


select type, DEADLINE , count(0) 
--,  count(distinct DEADLINE ) 
from BASS1.MON_ALL_INTERFACE 
group by type, DEADLINE 
order by 1 ,2

                

                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02059_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1040')                                              
                                                and time_id <= 20110527
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'

                                
                                

select * from   G_A_02059_DAY where      ENTERPRISE_BUSI_TYPE = '1180'
                                   
select * from   bass1.g_a_02054_day where ENTERPRISE_BUSI_TYPE = '1520'


select * from   G_A_02057_DAY


select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from G_A_02057_DAY 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 

                                
value(sum(bigint((PORT_NUMS,)),0) PORT_NUMS                                
                                

			select value(sum(bigint(PORT_NUMS)),0) PORT_NUMS                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from g_a_02057_day where  time_id <= 20110527 
                                        and ENTERPRISE_BUSI_TYPE in ('1040')
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'

                                

			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02057_day where  time_id <= 20110527 
					and ENTERPRISE_BUSI_TYPE in ('1040')
			) t 



                        select *
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from g_a_02054_day where  time_id <= 20110531 
                                        and ENTERPRISE_BUSI_TYPE in ('1230')
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
and ENTERPRISE_ID = '89103000161144       '

                                
select * from   G_A_02060_DAY


                                select *
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02060_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110527
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'


      
select enterprise_name from   bass2.dw_enterprise_msg_201012  where ENTERPRISE_ID 
='89103000161144'
ENTERPRISE_NAME



                                
89103000161144      

select * from   G_A_02060_DAY where     ENTERPRISE_ID = '89103000161144'


                            
select count(0) from   G_S_22303_MONTH where ENT_BUSI_ID = '1360'
and time_id = 201104
and bigint(BILL_CUST_NUMS) >  bigint(USE_CUST_NUMS)

select * from   G_S_22303_MONTH
where time_id = 201104

select count(0),count(distinct ENTERPRISE_ID||ENT_BUSI_ID||MANAGE_MOD||char(TIME_ID)) from    G_S_22303_MONTH                            

select count(0) from   G_S_22303_MONTH where ENT_BUSI_ID = '1310'
and time_id = 201104
and bigint(BILL_CUST_NUMS) >  bigint(USE_CUST_NUMS)



select  bigint(BILL_CUST_NUMS) ,  bigint(USE_CUST_NUMS)
 from   G_S_22303_MONTH where ENT_BUSI_ID = '1380'
and time_id = 201104
and bigint(BILL_CUST_NUMS) <  bigint(USE_CUST_NUMS)





select *
 from   G_S_22303_MONTH where ENT_BUSI_ID = '1380'
 order by 1 desc 
 
 
 select count(0) from   G_S_22303_MONTH where ENT_BUSI_ID = '1380'
and time_id = 201104
and bigint(BILL_CUST_NUMS) >  bigint(USE_CUST_NUMS)

 
 select * from  
 G_A_02064_DAY
 
 
 select * from  G_S_03017_MONTH
 where ENT_BUSI_ID = '1520'
 and time_id = 201109
 select * from  G_S_03018_MONTH
  where ENT_BUSI_ID = '1520'


 
select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
) t
                
                
02054 
02064 400
02049 
select count(0),count(distinct USER_ID ) from    G_I_02049_MONTH                
where time_id = 201104



db2 RUNSTATS ON table  BASS1.G_I_02049_MONTH	with distribution and detailed indexes all  


select count(0) from   bass1.g_a_02054_day where ENTERPRISE_BUSI_TYPE = '1520'
and time_id/100 = 201109



select count(0) from   bass1.g_a_02064_day where ENTERPRISE_BUSI_TYPE = '1520'
and time_id = 201104


select * from    bass1.g_a_02064_day

select * from   bass2.dw_enterprise_msg_201101  where ENTERPRISE_ID in(
			select ENTERPRISE_ID
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
)

select * from   bass2.dw_enterprise_msg_201101  where ENTERPRISE_ID in(
			select ENTERPRISE_ID
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02064_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
)            

select * from   G_I_21020_MONTH
(130131132155156185186145


select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' and 
 substr(COMP_PRODUCT_NO,1,3) not 
in ('130','131','132','155','156','185','186','145')   


select  substr(COMP_PRODUCT_NO,1,3)  , count(0) 
--,  count(distinct  substr(COMP_PRODUCT_NO,1,3)  ) 
from G_I_21020_MONTH 
where COMP_BRAND_ID = '021000' 
group by   substr(COMP_PRODUCT_NO,1,3)  
order by 1 


select * from   G_I_21020_MONTH
where
 substr(COMP_PRODUCT_NO,1,3)  
in ('130','131','132','155','156','185','186','145')   
and 
COMP_BRAND_ID <> '021000'  

031000

select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '031000' and 
 substr(COMP_PRODUCT_NO,1,3) not 
in ('133','153','180','189')   

(133153180189


select count(0) from   G_I_21020_MONTH
where char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201104 



select * from   G_I_21020_MONTH
where char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201104 


select sum(bigint(UNION_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201104

13760

select char(count(distinct comp_product_no)) c37
from bass2.Dw_comp_cust_201104
where COMP_MONTH_OFF_MARK=1
 and comp_brand_id in(3,4) 
 13606      
 
values (13606*1.000/13760 - 1 )


select char(count(distinct comp_product_no)) c36
from bass2.Dw_comp_cust_dt
where comp_day_off_mark=1
 and comp_brand_id in(3,4)
 
 
 
 G_I_21020_MONTH
 
 
 
 select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and COMP_LAST_DATE < '20110201'
and time_id = 201104




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_21020_MONTH 
group by  time_id 
order by 1 


select sum(bigint(UNION_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201104


select UNION_MOBILE_LOST_CNT
from bass1.G_S_22073_DAY
where time_id/100 = 201104



select char(count(distinct comp_product_no)) c36
from bass2.Dw_comp_cust_dt
where comp_day_off_mark=1
 and comp_brand_id in(3,4)
 
 b
 select * from  bass2.dim_comp_brand
 
 
 
  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201104
and substr(COMP_LAST_DATE ,1,6) not in ('201104','201103')



select count(0),count(distinct COMP_PRODUCT_NO ) from    G_I_21020_MONTH
 where  time_id = 201104
 
  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201104
and substr(COMP_LAST_DATE ,1,6)  in ('201102')


values (13606*1.000/13760 - 1 )

14723

values (14723*1.000/13760 - 1 )


  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201103
and substr(COMP_LAST_DATE ,1,6)  in ('201101')

16052

select sum(bigint(UNION_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201103

13222


  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201103
and substr(COMP_LAST_DATE ,1,6)  in ('201101')


select * from   bass1.G_S_22073_DAY
order by 1 desc 

  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201104
 and days(date('2011-04-01'))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2)))>=90
 
 values date('2011-04-01')
 
 
  select  days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,6)||'-'||substr(COMP_LAST_DATE,7,8)))
  from G_I_21020_MONTH 
fetch first 10 rows only 
  
  
  select substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2)
    from G_I_21020_MONTH 
fetch first 10 rows only 

  select date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))
    from G_I_21020_MONTH 
fetch first 10 rows only 



  select  count(0)  from   G_I_21020_MONTH
where
(days(date('2011-04-01')) -
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))) 
 ) >= 90
 
 
 select * from  bass2.dim_comp_status
 
 
 
  select  count(0)  from   G_I_21020_MONTH
where
time_id = 201104 and 
days(date('2011-04-30')) -
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))) 
 
 
 
 select * from   BASS1.G_S_21006_MONTH
 
 
 session.int_check_user_status 
 
 select count(0),count(distinct product_no ) from   session.int_check_user_status 
 
 1191504	1191504

select count(0) from    
 session.int_check_user_status a
 where not exists (select 1 from bass1.g_s_03004_month b  where a.user_id= b.USER_ID and b.time_id = 201104)
 
 
 values 7129*1.000/1191504
 
 
 
 select count(0),count(distinct xx ) from   
 
  from bass1.g_s_03004_month b  where a.user_id= b.USER_ID
  
  "21003 GSM/TD普通语音业务月使用
21006 智能网语音业务月使用
21009 智能网VPMN业务使用
02004 用户
02008 用户状态
收入中间表"


  select count(0) from   session.int_check_user_status

declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110431 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110431 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')

  1624924 row(s) affected.

select count(0),count(distinct product_no  ) from    session.int_check_user_status

select count(0) from     BASS1.t_product_no 

select count(0) from     BASS1.t_product_no 	 a 
,session.int_check_user_status b 
where a.product_no = b.product_no

1269412

12183

select count(0) from    BASS1.t_product_no 	 a 
,session.int_check_user_status b 
where a.product_no = b.product_no
 and not exists (select 1 from bass1.g_s_03004_month c  where c.time_id = 201104
 and b.user_id= c.USER_ID and ACCT_ITEM_ID between '0100'  and '0403'
 )
 
 23124

values 23124*1.000/1269412


drop table BASS1.t_product_no;
CREATE TABLE BASS1.t_product_no(
   product_no CHAR(20) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    product_no 
 )USING HASHING;
ALTER TABLE BASS1.t_product_no
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
insert into  BASS1.t_product_no
select distinct PRODUCT_NO from G_S_21003_MONTH where time_id = 201104  and bigint(BASE_BILL_DURATION)> 0 
 

db2 RUNSTATS ON table  BASS1.t_product_no 	with distribution and detailed indexes all   

1273649 row(s) affected.

drop table  BASS1.t_product_no


select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_i_06022_month where time_id =201104)
  and time_id =201104
  and channel_type <>'3'
  and channel_status='1'
  
  


 select  channel_type, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
group by   channel_type
order by 1 ,2

select count(0) from    
BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
and   channel_type in ('1','2')


 select  CHANNEL_B_TYPE, count(0) 
from BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
group by   CHANNEL_B_TYPE
order by 1 ,2

select count(0) from    
BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in ('1','2','3')



select count(0) from    
BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in  ('5','6')


select count(0) from    
BASS1.G_I_06021_MONTH 
where time_id = 201102 and CHANNEL_STATUS = '1' 
and   channel_type in ('3')




        select *
          from bass2.DIM_TERM_TAC
          where net_type='2'
          

 
91002	DIM_TACNUM_DEVID
91003	DIM_CONTROL_INFO
91004	DIM_DEVICE_INFO
91005	DIM_DEVICE_PROFILE
91006	DIM_PROPERTY_INFO
91007	DIM_PROPERTY_VALUE_RANGE

          

 
 
select * from 	bass2.DIM_TACNUM_DEVID
select * from 	bass2.DIM_CONTROL_INFO
select * from 	bass2.DIM_DEVICE_INFO
select * from 	bass2.DIM_DEVICE_PROFILE where value = '001001006'
select * from 	bass2.DIM_PROPERTY_INFO
select * from 	bass2.DIM_PROPERTY_VALUE_RANGE


select * from   bass1.td_check_03


select * from    BASS1.MON_ALL_INTERFACE
 where interface_name like '%智能网用户明细收入%'
 
 
 
 
          
          
select * from   g_s_22204_month_tmp3

select * from   G_S_22204_MONTH


select CYCLE_ID, bigint(TD_TERM_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'


select count(0) from    bass1.td_check_06_2010
where TD_TERMINAL_MARK = '1'


select * from   g_s_04017_day 


select count(0) from    bass1.td_check_ls_02

47381


47700

values 47700*1.0000/47381 -1





select  bigint(TD_CUST_DUR) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'

select sum(bigint(BILL_DURATION)) from bass1.g_s_21003_month_td
where 

select sum(bigint(BASE_BILL_DURATION)) from    bass1.g_s_21003_month_tmp 


select count(0) from    bass1.td_check_user
select count(0) from    bass1.td_check_06
select count(0),count(distinct product_no ) from      bass1.td_check_06

select count(0) from    bass1.td_check_06_2010



		select count(distinct PRODUCT_NO)
		from 
		(
		select product_no,imei_14,call_cnt from bass1.td_check_ls_02
		union 
		select product_no,imei_14,call_cnt from bass1.td_check_03
		union 
		select product_no,imei_14,call_cnt from bass1.td_check_04
		union
		select product_no,imei_14,call_cnt from bass1.td_check_05
		) a
        


select  bigint(TD_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'


values 48753*1.000/48417 - 1
        
        
values (48753*1.000/48417 - 1)*100


select  bigint(TD_NET_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'

33996


select count(0),count(distinct product_no ) from     bass1.g_s_04002_day_td2
select count(0),count(distinct product_no ) from     bass1.g_s_04002_day_td1

        
		select count(distinct PRODUCT_NO)
		from 
  bass1.g_s_04002_day_td2
        
        
        select  bigint(TD_NET_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'

33996
43984


values (33996*1.000/43984 - 1)*100

select  bigint(TD_NET_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'



		select count(distinct PRODUCT_NO)
		from 
  bass1.g_s_04002_day_td2
  
  
  
  
		select 
		   sum(bigint(a.base_bill_duration))
		 from bass1.g_s_21003_month_tmp a,
		 		(
		select product_no from bass1.td_check_ls_02
		union 
		select product_no from bass1.td_check_03
		union 
		select product_no from bass1.td_check_04
		union
		select product_no from bass1.td_check_05
		)  b
		where a.product_no=b.product_no
	
    
    select  bigint(TD_CUST_DUR) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'
    
    
    select sum(bigint(BILL_DURATION)) from bass1.g_s_21003_month_td




		select count(distinct a.product_no),
		   sum(bigint(a.base_bill_duration))
		 from bass1.g_s_21003_month_tmp a,
		 		(
		select product_no from bass1.td_check_ls_02
		union 
		select product_no from bass1.td_check_03
		union 
		select product_no from bass1.td_check_04
		union
		select product_no from bass1.td_check_05
		)  b
		where a.product_no=b.product_no
	
		   
           
           
values (34289847*1.000/34232296 - 1)*100
           
           

		select 
		   sum(bigint(a.base_bill_duration))
		 from bass1.g_s_21003_month_tmp a,(
		select product_no from bass1.td_check_ls_02
		union 
		select product_no from bass1.td_check_03
		union 
		select product_no from bass1.td_check_04
		union
		select product_no from bass1.td_check_05
		)   b
		where a.product_no=b.product_no



select  bigint(td_cust_t_dur) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'

           
		select 
		   sum(bigint(a.base_bill_duration))
		 from bass1.g_s_21003_month_tmp a,
		 		(
		select product_no from bass1.td_check_ls_02
		union 
		select product_no from bass1.td_check_03
		union 
		select product_no from bass1.td_check_04
		union
		select product_no from bass1.td_check_05
		)  b
		where a.product_no=b.product_no
		   and mns_type='1'



values (8593650*1.000/8625412 - 1)*100


select  bigint(TD_CUST_FLOWS) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'


select * from    G_S_22204_MONTH


select * from    bass1.G_S_02047_MONTH
select count(0),count(distinct product_no ) from     bass1.G_S_02047_MONTH
where time_id = 201104
2171324	1271765
21003 GSM/TD
21006 
21009 VPMN

select count(0) from    G_S_21009_DAY
select * from   G_S_21009_DAY
where time_id = 201104

select count(0) from  
(
select   distinct product_no from        G_S_21003_MONTH where time_id = 201104
union 
select   distinct product_no from        G_S_21006_MONTH where time_id = 201104
union 
select   distinct product_no from        G_S_21009_DAY where time_id/100 = 201104
) a 

values (1271765*1.000/1273649 - 1)*100


select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end rule_name,
         target1,
         target2,
         target3*100
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
    order by 1 desc 
    
    and time_id=20110527



select * from    bass1.g_rule_check
where rule_code in ('R025')



  select count(0),count(distinct COMP_PRODUCT_NO)  from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
 and (days(date('2011-04-01'))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))>=90
 and 
 (days(date('2011-04-01'))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2)))) <=120
 and char(time_id) not in ('201104','201103','201102')
 
 
select * from   G_A_02060_DAY where     ENTERPRISE_ID = '89103000161144'


select STATUS_ID , count(0) 
--,  count(distinct STATUS_ID ) 
from G_A_02060_DAY 
group by  STATUS_ID 
order by 1 




select * from   G_A_02060_DAY where     ENTERPRISE_ID = '89103000161144' 
select 
        20110530 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110530' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from  G_A_02060_DAY
where    ENTERPRISE_ID = '89103000161144' 
and time_id = 20110117     



select '890',
case when (days(date(a.expire_date))-days(date('2011-05-01')))/30<1 then 14
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=1 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<3 then 15
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=3 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<5 then 16
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=5 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<8 then 17
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=8 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<12 then 18
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=12 then 19
end,
                        count(distinct case when a.brand_id=1 then a.user_id end),
                        sum(case when a.brand_id=4 then 1 else 0 end),
                        sum(case when a.brand_id in (3,5,7) then 1 else 0 end),
                        sum(case when c.user_id is not null then 1 else 0 end),
                        count(distinct a.cond_name)
from
(
select distinct 
 a.user_id,a.brand_id,b.cond_id,b.cond_name,b.expire_date
        from bass2.stat_market_qu_0133_t1 a,
             (select distinct user_id,promo_id,promo_name,cond_id,cond_name,expire_date
                from bass2.dw_product_user_promo_201104 where date(expire_date)>=date('2011-05-01')) b
        where a.user_id=b.user_id
         ) a
left join
                (
                select distinct b.user_id from bass2.dw_product_sprom_201104 b,bass2.dim_product_item c
                where c.prod_name like '%138资费%' and b.active_mark = 1
                ) c on a.user_id=c.user_id
group by 
case when (days(date(a.expire_date))-days(date('2011-05-01')))/30<1 then 14
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=1 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<3 then 15
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=3 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<5 then 16
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=5 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<8 then 17
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=8 and (days(date(a.expire_date))-days(date('2011-05-01')))/30<12 then 18
when (days(date(a.expire_date))-days(date('2011-05-01')))/30>=12 then 19
end  

select product_no,count(0) from    
(
    select product_no,
					case when brand_id=1 then 1
					     when brand_id=4 then 2
					     when brand_id in (3,5,7) then 3
					end brand_id,
	      case when (days(date(b.expire_date))-days(date('2011-05-01')))/30<1 then 14
	           when (days(date(b.expire_date))-days(date('2011-05-01')))/30>=1 and (days(date(b.expire_date))-days(date('2011-05-01')))/30<3 then 15
	           when (days(date(b.expire_date))-days(date('2011-05-01')))/30>=3 and (days(date(b.expire_date))-days(date('2011-05-01')))/30<5 then 16
	           when (days(date(b.expire_date))-days(date('2011-05-01')))/30>=5 and (days(date(b.expire_date))-days(date('2011-05-01')))/30<8 then 17
	           when (days(date(b.expire_date))-days(date('2011-05-01')))/30>=8 and (days(date(b.expire_date))-days(date('2011-05-01')))/30<12 then 18
	           when (days(date(b.expire_date))-days(date('2011-05-01')))/30>=12 then 19
	      end lvl
			from bass2.stat_market_qu_0133_t1 a,
			     (select distinct user_id,promo_id,promo_name,cond_id,cond_name,expire_date
			        from bass2.dw_product_user_promo_201104 where date(expire_date)>=date('2011-05-01')) b
			where a.user_id=b.user_id
) t
where lvl = 14 
and brand_id = 1
group by product_no
having count(0) > 1 


13889084441	2
13989980006	2

select * from   bass2.stat_market_qu_0133_t1
where product_no in ('13889084441','13989980006')


USER_ID
89101110223621
89157332348769
select * from 
 (select distinct user_id,promo_id,promo_name,cond_id,cond_name,expire_date
			        from bass2.dw_product_user_promo_201104 where date(expire_date)>=date('2011-05-01')) b
where user_id in ('89101110223621','89157332348769')                    
                    
                    


select user_id
from
(
select distinct 
 a.user_id,a.brand_id,b.cond_id,b.cond_name,b.expire_date
        from bass2.stat_market_qu_0133_t1 a,
             (select distinct user_id,promo_id,promo_name,cond_id,cond_name,expire_date
                from bass2.dw_product_user_promo_201104 where date(expire_date)>=date('2011-05-01')) b
        where a.user_id=b.user_id
         ) a group by user_id having count(0) > 1
         





select 
        20110530 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110530' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from  (select * from G_A_02060_DAY 
union all 
select * from G_A_02060_DAY ) t 
where    ENTERPRISE_ID = '89103000161144' 
and time_id = 20110117     



select * from   bass2.dw_enterprise_msg_201101  where ENTERPRISE_ID in (
                        select 
                             
                            ENTERPRISE_ID
                           
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110526 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
                        and enterprise_id in 
                        (
'89103000401351'
,'89103000498290'
,'89100000000684'
,'89108911013493'
,'89108911013886'

                        )
)

                        

                        select 
                             TIME_ID
                            ,ENTERPRISE_ID
                            ,ENTERPRISE_BUSI_TYPE
                            ,MANAGE_MODE
                            ,PAY_TYPE
                            ,ORDER_DATE
                            ,STATUS_ID
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110526 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
        

                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02061_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE = '1210'
                                                and time_id <= 20110526
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
        


                        select 
                             TIME_ID
                            ,ENTERPRISE_ID
                            ,ENTERPRISE_BUSI_TYPE
                            ,MANAGE_MODE
                            ,PAY_TYPE
                            ,ORDER_DATE
                            ,STATUS_ID
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110526 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
                        and enterprise_id in 
                        (
'89103000401351'
,'89103000498290'
,'89100000000684'
,'89108911013493'
,'89108911013886'
,'89100000000645'

                        )
                        

                        select 
                             20110530 TIME_ID
                            ,ENTERPRISE_ID
                            ,ENTERPRISE_BUSI_TYPE
                            ,MANAGE_MODE
                            ,PAY_TYPE
                            ,ORDER_DATE
                            ,'2' STATUS_ID
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from (select * from  G_A_02056_DAY 
                        union all 
                        select * from  G_A_02056_DAY_T ) a
                        where   time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
and enterprise_id in 
(
'89103000401351'
,'89103000498290'
,'89100000000684'
,'89108911013493'
,'89108911013886'
,'89100000000645'
)                        



CREATE TABLE "BASS1   "."G_A_02056_DAY_T"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "PAY_TYPE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   G_A_02056_DAY_T


insert into G_A_02056_DAY_T
                        select 
                             20110530 TIME_ID
                            ,ENTERPRISE_ID
                            ,ENTERPRISE_BUSI_TYPE
                            ,MANAGE_MODE
                            ,PAY_TYPE
                            ,ORDER_DATE
                            ,'2' STATUS_ID
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110526 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
and enterprise_id in 
(
'89103000401351'
,'89103000498290'
,'89100000000684'
,'89108911013493'
,'89108911013886'
,'89100000000645'
)


select * from   G_A_02060_DAY_T




select * from   bass1.g_s_04002_day_td

select count(0) from    bass1.td_check_06 




CREATE TABLE "BASS1   "."G_A_02060_DAY_T"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "USER_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "EXPIRE_DATE" CHAR(8) , 
                  "PAY_TYPE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
insert into G_A_02060_DAY_T
select 
        20110530 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,'20110530' EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
from  G_A_02060_DAY
where    ENTERPRISE_ID = '89103000161144' 
and time_id = 20110117     



select * from   G_A_02060_DAY_T



                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02060_DAY t 
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110531
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
        
        


                                select *
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                G_A_02060_DAY t 
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110531
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'


select count(0) from     bass1.td_check_06_2010 


create table g_s_22204_month_down_20110530(
subs_id 											char(20)  --用户标识 
,td_infophone_flg             char(1)  --TD信息机客户标志 
,td_mobile_flg                char(1)  --TD手机客户标志 
,td_crd_flg                   char(1)  --TD数据卡客户标志 
,td_book_flg                  char(1)  --TD上网本客户标志 
,TD_trmnl_cust_flg            char(1)  --TD终端客户标志 
,usdTD_ntwk_cust_flg          char(1)  --使用TD网络客户标志 
,usd_voicTD_ntwk_cust_flg     char(1)  --使用语音TD网络客户标志 
,usd_GPRSTD_ntwk_cust_flg     char(1)  --使用GPRSTD网络客户标志 
,usd_ntbkTD_ntwk_cust_flg     char(1)  --使用上网本TD网络客户标志 
) 
 IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
db2 "load client from /bassapp/bihome/panzw/tmp/13100_TD_user_3mon.txt of del modified by 
coldel$  fastparse anyorder 
warningcount 1000 replace into g_s_22204_month_down_20110530"
                                
                                
select count(0),count(distinct subs_id ) from    g_s_22204_month_down_20110530                                
where usdTD_ntwk_cust_flg   = '1'

33815	33815



values (33996*1.000/33815 - 1)*100


select count(0) from     bass1.td_check_06_2010 
where TD_NET_MARK = '1'




select count(0),count(distinct subs_id ) from    g_s_22204_month_down_20110530                                
where usd_voicTD_ntwk_cust_flg   = '1'
or usd_GPRSTD_ntwk_cust_flg              = '1'
or usd_ntbkTD_ntwk_cust_flg              = '1'





select * from   BASS1.G_I_77780_DAY_DOWN20110429
where id like '2011%'


select count(0),count(distinct id ) from    BASS1.G_I_77780_DAY_DOWN20110429

select length(trim(id)),count(0) from     BASS1.G_I_77780_DAY_DOWN20110429
group by length(trim(id))


order by employee_cnt 



select UPLOAD_TYPE_ID , count(0) 
--,  count(distinct UPLOAD_TYPE_ID ) 
from BASS1.G_I_77780_DAY_DOWN20110429 
group by  UPLOAD_TYPE_ID 
order by 1 

drop TABLE "BASS1   "."G_A_01005_MONTH_MID2" 

CREATE TABLE "BASS1   "."G_A_01005_MONTH_MID2"  (
                  "ID" CHAR(9) NOT NULL , 
                  "ENTERPRISE_ID" CHAR(14) NOT NULL )   
                 DISTRIBUTE BY HASH("ID",  
                 "ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   G_A_01005_MONTH_MID

select count(0) , count(distinct a.ENTERPRISE_ID||A.ID)
from 
G_I_77780_DAY_DOWN20110429 a
,G_A_01005_MONTH_MID b 
where a.ENTERPRISE_ID = b.ENTERPRISE_ID 
and a.ID = b.ID

117	117
select count(0) from    G_A_01005_MONTH_MID




select count(0) from    G_I_77780_DAY_DOWN20110429


select length(trim(id)),count(0) from     BASS1.G_A_01005_MONTH_MID
group by length(trim(id))



select CUST_STATUS , count(0) 
--,  count(distinct CUST_STATUS ) 
from G_I_77780_DAY_DOWN20110429 
group by  CUST_STATUS 
order by 1 



$ db2 load client from /bassapp/bihome/panzw/tmp/BOSS.txt of del \
> modified by coldel$  fastparse anyorder warningcount 1000 \
messages G_A_01005_MONTH_MID.msg \
> messages G_A_01005_MONTH_MID.msg \place into G_A_01005_MONTH_MID
> replace into G_A_01005_MONTH_MID


select * from   G_A_02056_DAY


                        select count(0) cnt
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from G_A_02056_DAY where   time_id <= 20110530 and ENTERPRISE_BUSI_TYPE = '1210'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
                        
                        


                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02061_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE = '1210'
                                                and time_id <= 20110530
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'




                                select *
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                G_A_02060_DAY t 
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110531
                                                and length(trim(user_id)) = 14
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'




select a.*,b.*
FROM 
(
    select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
 
 

select count(0) from 
(
                select t.*
                ,row_number()over(partition by user_id order by time_id desc ) rn 
                from 
                G_A_02060_DAY  t
  ) a
where rn = 1
and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t 
where a.user_id = t.user_id )
with ur



			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by user_id order by time_id desc ) rn 
			                from 
			                G_A_02060_DAY  t
			  ) a
			where rn = 1
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
        


select * from   bass2.dw_product_20110531
where user_id in (
                        select user_id from 
                        (
                                        select t.*
                                        ,row_number()over(partition by user_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY_DOWN  t
                                        
                          ) a
                        where rn = 1            
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t where a.user_id = t.user_id )
        with ur

select * from   bass2.dw_product_20110530
where user_id in (
                        select user_id from G_A_02059_DAY_down     a     
                where not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                )
        with ur


                        select * from G_A_02059_DAY_down     a     
                where not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )

USER_ID
89160000013694      
89160000011237      
89160000011226      
89160000011221      
89160000011232      
89157334298506      
89157334142626      
89157333869348      
89157333757193      
89157333620031      

                        select a.* from G_A_02059_DAY    a     
where user_id = '89157333620031      '


select * from   g_a_01004_day where time_id = 20110920



                        select count(0) from 
                        (
                                        select t.*,value(s.NEW_USER_ID,t.user_id) ID
                                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                        ,bass2.TRANS_USER_ID s where t.user_id = s.USER_ID
                                        and time_id >= 20100624
                          ) a
                        where rn = 1            
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t 
                where a.id = t.user_id )
        with ur


select time_id , count(0) 
--,  count(distinct time_id ) 
from g_a_02008_day 
group by  time_id 
order by 1 






                        select count(0) from 
                        (
                                        select t.*--,value(s.NEW_USER_ID,t.user_id) ID
                                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                        where time_id >= 20100624
                          ) a
                        where rn = 1            
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t 
                where a.user_id= t.user_id )
        with ur


select time_id,count(0)  from G_A_02059_DAY
group by time_id



                        select * from 
                        (
                                        select t.*--,value(s.NEW_USER_ID,t.user_id) ID
                                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                        where time_id >= 20100624
                          ) a
                        where rn = 1            
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day ) t 
                where a.user_id= t.user_id )
        with ur




select * from syscat.tables where tabname like '%TRANS%'         

bass2.TRANS_USER_ID


select * from  bass1.g_a_02004_day where user_id = '89160000013694'


select * from syscat.tables where tabname like '%02059%' 

length

select count(0) from    G_A_02059_DAY_DOWN


89160000013694      






select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_a_01004_day 
group by  time_id 
order by 1 desc


select * from bass2.dw_cust_20110530 
where cust_id in (
select cust_id from   bass2.dw_product_20110530
where user_id in (
                        select user_id from G_A_02059_DAY_down     a     
                where not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                ) )
        with ur
        
        
        
select * from    G_A_02059_DAY        
where enterprise_id = ''


select * from syscat.tables where tabname like '%TRANS%EN%' 

select * from   bass2.DW_ENTERPRISE_EXTSUB_RELA_DM_201006
where USER_ID = '89157333869348'


select * from   g_a_02054_day where enterprise_id in (
 select enterprise_id from G_A_02059_DAY_down     a     
                where not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                ) 
                and ENTERPRISE_BUSI_TYPE in ('1140','1170')
                
                
select * from   G_S_22303_MONTH
where                 
ENT_BUSI_ID = '1170'


select * from G_A_02059_DAY WHERE USER_ID IN (
 select user_id from G_A_02059_DAY_down     a     
                where not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                )
                
                

			select count(0) from 
			(
			                select value(s.NEW_USER_ID , t.USER_ID) USER_ID
			                ,row_number()over(partition by t.user_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
			                left join bass2.TRANS_USER_ID s on  t.user_id = s.USER_ID
											where time_id >= 20100626
			  ) a
			where rn = 1		
		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
	with ur


			select count(0) from 
			(
			                select USER_ID
			                ,row_number()over(partition by t.user_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1		
		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
	with ur

                
                
			select * from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                (select * from G_A_02059_DAY union all select * from G_A_02059_DAY_T) t
											where time_id >= 20100626
			  ) a
			where rn = 1	and 	STATUS_ID = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur


        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02059_DAY  t
                        where time_id >= 20100626
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
with ur

    
    			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
                
			select * from 
			(
			                select enterprise_id
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1		
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur


CREATE TABLE "BASS1   "."G_A_02059_DAY_T"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "USER_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
select * from   G_A_02059_DAY_T


insert into G_A_02059_DAY_T
select 
         20110531 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID                
from         

			(
			                select 
         TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,STATUS_ID
			                ,row_number()over(partition by t.user_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1		
		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
	with ur



select length(trim(enterprise_id)) , count(0) 
--,  count(distinct length(enterprise_id) ) 
from G_A_01004_DAY 
group by  length(trim(enterprise_id))
order by 1 



select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID 

    

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur



        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02059_DAY  t
                        where time_id >= 20100626
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur


select count(0) from    G_A_02060_DAY


			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.user_id order by time_id desc ) rn 
			                from  G_A_02060_DAY  t
			  ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur

        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02059_DAY  t
                        where time_id >= 20100626
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur



			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02060_DAY  t
			  ) a
			where rn = 1
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur

            
			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02060_DAY  t
			  ) a
			where rn = 1 and 	STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02061_DAY 
group by  time_id 
order by 1 


select * from    G_A_02061_DAY
where time_id < 20100624
and status_id = '1'


        select * from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02061_DAY  t  where time_id >= 20100624
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur	


        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02061_DAY  t  where time_id >= 20100626
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur	



			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02061_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		



        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02062_DAY  t
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur	

            
			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02062_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		

           

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02054_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		

           
		select count(0) from bass1.G_A_02054_DAY a 
		where 
		time_id / 100 = $curr_month		
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur

			select * from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02054_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02054_DAY 
group by  time_id 
order by 1 


select * from bass2.TRANS_ENTERPRISE_ID_20100625
where enterprise_id = '891891000825'
           
select * from bass2.TRANS_ENTERPRISE_ID_20100625
where NEW_ENTERPRISE_ID = '891891000825'           



			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02054_DAY_DOWN  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        
       select count(0) from     G_A_02054_DAY_DOWN a
        
       where STATUS_ID = '1' and  not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        

  select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' 
and time_id = 201104

select COMP_LAST_DATE,count(0) from    (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a 
group by COMP_LAST_DATE



94379



select * from syscat.tables where tabname like '%02054%' 


select * from G_A_02054_DAY_DOWN where enterprise_id = '891891000825'




select length(trim(enterprise_id)) , count(0) 
--,  count(distinct length(trim(enterprise_id)) ) 
from G_A_02054_DAY_DOWN 
group by  length(trim(enterprise_id)) 
order by 1 

select * from   G_A_02054_DAY_DOWN
where  length(replace(ltrim(rtrim(enterprise_id))),' ','')  = 15 

select * from   G_A_02054_DAY_DOWN
where trim(enterprise_id) = '89601560000732'



select length(trim(enterprise_id)) , count(0) 
--,  count(distinct length(trim(enterprise_id)) ) 
from G_A_02054_DAY
group by  length(trim(enterprise_id)) 
order by 1 



CREATE TABLE "BASS1   "."G_A_02054_DAY_DOWN_A"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into 
G_A_02054_DAY_DOWN_A
(
         ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,STATUS_ID
        )
select 
         replace(trim(ENTERPRISE_ID)
        ,trim(ENTERPRISE_BUSI_TYPE)
        ,trim(MANAGE_MODE)
        ,trim(ORDER_DATE)
        ,trim(STATUS_ID)
from         G_A_02054_DAY_DOWN




select  length(trim(replace(enterprise_id,' ','')))  , count(0) 
--,  count(distinct length(trim(enterprise_id)) ) 
from G_A_02054_DAY_DOWN_A 
group by  length(trim(replace(enterprise_id,' ',''))) 
order by 1 




select * from   G_A_02054_DAY_DOWN_A
where length(trim(replace(enterprise_id,' ',''))) = 0


drop table G_A_02054_DAY_DOWN


CREATE TABLE "BASS1   "."G_A_02054_DAY_DOWN"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from     G_A_02054_DAY_DOWN a
        
       where STATUS_ID = '1' and  not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        
        
        
        
        

CREATE TABLE "BASS1   "."G_A_02054_DAY_T"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
delete from G_A_02054_DAY_T


insert into         G_A_02054_DAY_T
select 
         20110531 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
from    G_A_02054_DAY_DOWN a
        
       where STATUS_ID = '1' and  not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        


select * from G_A_02054_DAY
where  enterprise_id || ENTERPRISE_BUSI_TYPE 
in  (select  enterprise_id || ENTERPRISE_BUSI_TYPE  
from G_A_02054_DAY_T )

        
select * from   G_A_02054_DAY_T


			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                (select * from G_A_02054_DAY) t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur



			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02054_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur

        
        

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02060_DAY  t
			  ) a
			where rn = 1 and 	STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur


  select * from   G_A_02059_DAY_T

			select * from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur

        
        select * from   G_A_02055_DAY
        

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02055_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		

        
			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02056_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur		
        

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02057_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur			

        
        

			select * from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02058_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur			


ENTERPRISE_ID
8919110195          
8919110301          
891910006688        


select count(0) from    G_A_02058_DAY

select * from 
G_A_02058_DAY
where ENTERPRISE_ID
in ('','','')


        
select * from   BASS2.TRANS_ENTERPRISE_ID_20100625
where ENTERPRISE_ID = '891910006688'        

CREATE TABLE "BASS1   "."G_A_02058_DAY_T"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "SUB_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
G_A_02058_DAY_T

select * from   G_A_02058_DAY_T


insert into G_A_02058_DAY_T

			select 
         20110531 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,SUB_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
            from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			               (select * from  G_A_02058_DAY union all select * from G_A_02058_DAY_T ) t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur			


			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
			                from 
			                G_A_02064_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur			
        
        	select cust_id from bass1.G_A_01007_DAY a 
	select count(0) from bass1.G_A_01007_DAY a 
	where RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
	with ur
        
        


select length(trim(cust_id)) , count(0) 
--,  count(distinct length(trim(cust_id)) ) 
from G_A_01007_DAY 
group by  length(trim(cust_id)) 
order by 1 


		select * from bass1.G_A_01007_DAY a 
		where 
		 not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01006_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        

CREATE TABLE "BASS1   "."G_A_01007_DAY_T1"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(9) , 
                  "CUST_ID" CHAR(20) , 
                  "RELA_STATE" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   G_A_01007_DAY_T

delete from G_A_01007_DAY_T

select count(0) from    G_A_01007_DAY_T


insert into G_A_01007_DAY select * from   G_A_01007_DAY_T    

select * from   G_A_01007_DAY 
where time_id = 20110531


insert into G_A_01007_DAY_T
select 
        20110531 TIME_ID
        ,ENTERPRISE_ID
        ,CUST_ID
        ,'2' RELA_STATE
from 
bass1.G_A_01007_DAY a 
where  a.RELA_STATE = '1'
		and 
		 not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01006_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        






		select count(0) from 
		(select a.* , row_number()over(partition by ENTERPRISE_ID,CUST_ID order by time_id desc ) rn 
			from bass1.G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01006_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
        

		select count(0) from 
		(select a.* , row_number()over(partition by ENTERPRISE_ID,CUST_ID order by time_id desc ) rn 
			from bass1.G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t 
        where a.cust_id = t.enterprise_id )
	with ur




select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_A_01007_DAY 
group by  time_id 
order by 1 


select * from   G_A_01007_DAY


CREATE TABLE "BASS1   "."G_A_01007_DAY_T1"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(9) , 
                  "CUST_ID" CHAR(20) , 
                  "RELA_STATE" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
delete from G_A_01007_DAY_T1


insert into   G_A_01007_DAY_T1
select                  
20110531 time_id 
,a.ENTERPRISE_ID
,value(b.NEW_ENTERPRISE_ID,a.CUST_ID) ENTERPRISE_ID
,a.RELA_STATE
from G_A_01007_DAY a
left join bass2.TRANS_ENTERPRISE_ID_20100625 b on a.CUST_ID = b.ENTERPRISE_ID 

select * from   G_A_01007_DAY_T1


select length(trim(CUST_ID)) , count(0) 
--,  count(distinct length(trim(CUST_ID)) ) 
from G_A_01007_DAY_T1 
group by  length(trim(CUST_ID)) 
order by 1 




select  count(0) 
--,  count(distinct length(trim(CUST_ID)) ) 
from G_A_01007_DAY_T1 
where length(trim(CUST_ID))  <> 14
order by 1 



1329


select * from   G_A_01007_DAY_T1



		select count(0) from 
		(select a.* , row_number()over(partition by CUST_ID order by time_id desc ) rn 
			from (select * from bass1.G_A_01007_DAY union all select * from  G_A_01007_DAY_T1) a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
	with ur
    
    
    


select  cust_id
--,  count(distinct length(trim(CUST_ID)) ) 
select count(0)     
from G_A_01007_DAY_T1 
where length(trim(CUST_ID))  <> 14
except

		select count(0),count(distinct cust_id) from 
		(select a.* , row_number()over(partition by enterprise_id order by time_id desc ) rn 
			from (select * from bass1.G_A_01007_DAY union all select * from  G_A_01007_DAY_T1) a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
	with ur
    

    
    1291
    
    

update G_A_01007_DAY_T1
set     RELA_STATE = '2' 
where enterprise_id in 
(
		select enterprise_id from 
		(select a.* , row_number()over(partition by enterprise_id order by time_id desc ) rn 
			from (select * from bass1.G_A_01007_DAY union all select * from  G_A_01007_DAY_T1) a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
)


    



		select count(0),count(distinct cust_id) from 
		(select a.* , row_number()over(partition by enterprise_id order by time_id desc ) rn 
			from (select * from bass1.G_A_01007_DAY union all select * from  G_A_01007_DAY_T1) a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
	with ur
    
select * from G_A_01007_DAY_T
    
    
select * from   G_A_01007_DAY
where time_id = 20110531
and ENTERPRISE_ID ='519155287'
and CUST_ID = '89103001418752'
and RELA_STATE = '2'


delete from G_A_01007_DAY
where     
insert into G_A_01007_DAY select * from   G_A_01007_DAY_T
insert into G_A_01007_DAY select * from   G_A_01007_DAY_T1
    
    20110531	519155287	89103001418752      	2
TIME_ID	ENTERPRISE_ID	CUST_ID	RELA_STATE
20110531	519155287	89103001418752      	2


delete from G_A_01007_DAY
where time_id = 20110531
and ENTERPRISE_ID ='519155287'


select * from   G_A_01007_DAY_T
except 
select * from   G_A_01007_DAY



		select count(0) from 
		(select a.* , row_number()over(partition by ENTERPRISE_ID,CUST_ID order by time_id desc ) rn 
			from bass1.G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
	with ur
    
    
                		

		select count(0),count(distinct cust_id) from 
		(select a.* , row_number()over(partition by enterprise_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )
            		

		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )


	with ur
    
    
    		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )



delete from G_A_01007_DAY
where time_id = 20110531 


insert into G_A_01007_DAY_T1
select distinct 
20110531 TIME_ID
,ENTERPRISE_ID
,CUST_ID
,'2'
from G_A_01007_DAY
where ENTERPRISE_ID || CUST_ID
in (select ENTERPRISE_ID || CUST_ID
from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
)



insert into G_A_01007_DAY
select * from G_A_01007_DAY_T1



    
    		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )






    
    		select * from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )


select * from   G_A_01007_DAY_t1
where cust_id = '89103000988805'


20110531	710918086	89103000988805      	1	1

select * from   G_A_01007_DAY_t1
where enterprise_id = 'DX0191796'




select * from   G_A_01004_DAY
where ENTERPRISE_ID = '89103000988805'
select * from   
BASS2.TRANS_ENTERPRISE_ID_20100625 
where ENTERPRISE_ID = '89103000988805'


    
    		select * from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where trim(a.cust_id) = t.enterprise_id )
        
        
        
        select * from   bass1.G_A_01004_DAY where enterprise_id = '89102999112991'

        
insert into G_A_01007_DAY_T1
select distinct 
20110531 TIME_ID
,ENTERPRISE_ID
,CUST_ID
,'2'
from 
		(select a.* , row_number()over(partition by enterprise_id ,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY ) t where a.cust_id = t.enterprise_id )

        
        

		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
	

        
delete from   G_A_01007_DAY_T1
where time_id = 20110531 
and ENTERPRISE_ID||cust_id
in (select ENTERPRISE_ID||cust_id
 from 
		(select a.* , row_number()over(partition by enterprise_id,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
)
	
    
delete from    G_A_01007_DAY
where time_id = 20110531

insert into  G_A_01007_DAY
select * from G_A_01007_DAY_t1


		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
	

    

		select count(0) from 
		(select a.* , row_number()over(partition by enterprise_id,cust_id order by time_id desc ) rn 
			from G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.cust_id = t.enterprise_id )
	

    
    
    		select count(0) from 
		(select a.* , row_number()over(partition by ENTERPRISE_ID,CUST_ID order by time_id desc ) rn 
			from bass1.G_A_01007_DAY a 
		) a where a.rn = 1 
		and RELA_STATE = '1'
		and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01006_DAY ) t where a.enterprise_id = t.enterprise_id )
		with ur
        

				select *
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02061_DAY
						where 
								 ENTERPRISE_BUSI_TYPE = '1220'
						and  MANAGE_MODE = '2'
						and time_id <= 20110531
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'



                
                
                
select MANAGE_MODE , count(0) 
--,  count(distinct MANAGE_MODE ) 
from G_A_02061_DAY 
group by  MANAGE_MODE 
order by 1 

select MANAGE_MODE , count(0) 
--,  count(distinct MANAGE_MODE ) 
from g_a_02054_day 
group by  MANAGE_MODE 
order by 1 


			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from G_A_02054_DAY where   time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1220'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where  MANAGE_MODE = '1'
			and time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1220'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            
select * from    g_a_02054_day where  ENTERPRISE_BUSI_TYPE = '1220'

and STATUS_ID ='1'

select * from   G_A_02054_DAY

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE,MANAGE_MODE order by time_id desc ) rn 
			                from 
			                G_A_02054_DAY  t
			  ) a
			where rn = 1	and STATUS_ID = '1'
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur
        
        
        
        				select count(0)
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02061_DAY
						where 
								 ENTERPRISE_BUSI_TYPE = '1220'
						and  MANAGE_MODE = '1'
						and time_id <= 20110531
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'
                
                
                
                			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where  ENTERPRISE_BUSI_TYPE = '1220'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            
            

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where  MANAGE_MODE = '3'
			and time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1220'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            

				select count(0)
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02059_DAY
						where 
								 ENTERPRISE_BUSI_TYPE  in ('1000','1010')				
						and time_id <= 20110531
						and MANAGE_MODE = '3'
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'

                
                
                70629
                

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where  time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1000','1010')
					and MANAGE_MODE = '3'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'

                

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where    time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1040')
						and MANAGE_MODE = '3'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'

                
                

				select count(0)
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02059_DAY
						where 
								 ENTERPRISE_BUSI_TYPE  in ('1040')						
						and  time_id <= 20110531 
						and MANAGE_MODE = '3'						
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'



			select count(0) cnt 
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02057_day where  time_id <= $timestamp 
					and ENTERPRISE_BUSI_TYPE in ('1180')
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'



			select count(0) cnt 
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02057_day where   time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1180')
					and MANAGE_MODE = '3'						

			) t 
			) t2 where rn = 1 and STATUS_ID ='1'

                
                

			select count(0) cnt 
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where  time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1180')
					and MANAGE_MODE = '3'						
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            
               			select value(sum(bigint(PORT_NUMS)),0) PORT_NUMS   
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02057_day where    time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1180')
			) t 
			) t2 where rn = 1 and STATUS_ID ='1' 
            
            
            
            select count(0) cnt 
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where   time_id <= 20110531 
					and ENTERPRISE_BUSI_TYPE in ('1230')
                    and MANAGE_MODE = '3'		
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            
           	select count(0)
				from 
				(
						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02060_DAY
						where 
								 ENTERPRISE_BUSI_TYPE  in ('1230')						
						and  time_id <= 20110531 
                    and MANAGE_MODE = '3'		
						) t
				) t2
				where rn = 1 and STATUS_ID ='1'
                
                

   select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02059_DAY  t
                        where time_id >= 20100626
          ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur

                
                

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.user_id order by time_id desc ) rn 
			                from  G_A_02060_DAY  t
			  ) a
        where rn = 1	and 	STATUS_ID = '1'
    		and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
		with ur

                
                

			select count(0) from 
			(
			                select t.*
			                ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
			                from 
			                G_A_02059_DAY  t
											where time_id >= 20100626
			  ) a
			where rn = 1	and STATUS_ID = '1'
			AND trim(A.enterprise_id) <> ''
			and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
		with ur

                
                

select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' and 
 substr(COMP_PRODUCT_NO,1,3) not 
in ('130','131','132','155','156','185','186','145')   



			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'


select * from   g_a_02054_day

select * from   G_A_02064_DAY
                

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02064_day where 
			 time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1520'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'

                

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1520'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1520'
) t

               

select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' and 
 substr(COMP_PRODUCT_NO,1,3) not 
in ('130','131','132','155','156','185','186','145')   
and time_id = 201104


               


select COMP_LAST_DATE,count(0) from    (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a 
group by COMP_LAST_DATE


               
               
               
select count(0)     
from   table (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a 




drop table BASS1.tttttttttt;
CREATE TABLE BASS1.tttttttttt(
   TIME_ID CHAR(1) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    ENTERPRISE_ID 
 )USING HASHING;
ALTER TABLE BASS1.G_I_77780_DAY_DOWN20110422
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
DROP TABLE BASS1.G_I_21020_MONTH_calendar;
CREATE TABLE BASS1.G_I_21020_MONTH_calendar(
   date_seq CHAR(8) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    date_seq 
 )USING HASHING;
ALTER TABLE BASS1.G_I_21020_MONTH_calendar
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from  BASS1.G_I_21020_MONTH_calendar
 
 
 insert into BASS1.G_I_21020_MONTH_calendar
values
 '20110501'
,'20110502'
,'20110503'
,'20110504'
,'20110505'
,'20110506'
,'20110507'
,'20110508'
,'20110509'
,'20110510'
,'20110511'
,'20110512'
,'20110513'
,'20110514'
,'20110515'
,'20110516'
,'20110517'
,'20110518'
,'20110519'
,'20110520'
,'20110521'
,'20110522'
,'20110523'
,'20110524'
,'20110525'
,'20110526'
,'20110527'
,'20110528'
,'20110529'
,'20110530'
,'20110531'
,'20110401'
,'20110402'
,'20110403'
,'20110404'
,'20110405'
,'20110406'
,'20110407'
,'20110408'
,'20110409'
,'20110410'
,'20110411'
,'20110412'
,'20110413'
,'20110414'
,'20110415'
,'20110416'
,'20110417'
,'20110418'
,'20110419'
,'20110420'
,'20110421'
,'20110422'
,'20110423'
,'20110424'
,'20110425'
,'20110426'
,'20110427'
,'20110428'
,'20110429'
,'20110430'

select * from    BASS1.G_I_21020_MONTH_calendar

select count(0) from     BASS1.G_I_21020_MONTH_calendar

select * from    BASS1.G_I_21020_MONTH_calendar

select count(0),count(distinct date_seq ) from     BASS1.G_I_21020_MONTH_calendar


insert into BASS1.G_I_21020_MONTH_calendar
select distinct char(time_id ),substr(char(time_id ),1,4)||'-'||substr(char(time_id ),5,2)||'-'||substr(char(time_id ),7,2)
from G_S_22073_DAY
where char(time_id)
not in (select date_seq from 
G_I_21020_MONTH_calendar
)


select  distinct char(time_id) ,
--,  count(distinct time_id ) 
from G_S_22073_DAY 
group by  time_id 
order by 1 

select count(distinct a.COMP_PRODUCT_NO) from    
table (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a , BASS1.G_I_21020_MONTH_calendar b 
where 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
 
 15503
 154
 
 select count(0) from   
( 
 select COMP_PRODUCT_NO,COMP_LAST_DATE
 from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '021000' 
) a 
,
(
 select COMP_PRODUCT_NO,COMP_BEGIN_DATE
 from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '021000' 
) b 
,BASS1.G_I_21020_MONTH_calendar c
where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
and 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
 and  char(COMP_BEGIN_DATE  ) > char(date_seq)
 
 
 
 
alter table bass1.G_I_21020_MONTH_calendar add column date2 varchar(10)

update  bass1.G_I_21020_MONTH_calendar 
set date2 = date(substr(date_seq,1,4)||'-'||substr(date_seq,5,2)||'-'||substr(date_seq,7,2))
 
 select * from   bass1.G_I_21020_MONTH_calendar 


 select sum(bigint(UNION_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201104

13760

15503

15503


values (13760*1.000/15503 - 1)*100


 15503
 154
 
 
 
select count(distinct a.COMP_PRODUCT_NO) from    
table (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '031000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '031000' 
and time_id = 201104
) a , BASS1.G_I_21020_MONTH_calendar b 
where 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
 and b.date_seq like '201104%'
 12473
 
 9320
 
  select count(0) from   
( 
 select COMP_PRODUCT_NO,COMP_LAST_DATE
 from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '031000' 
) a 
,
(
 select COMP_PRODUCT_NO,COMP_BEGIN_DATE
 from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '031000' 
) b 
,BASS1.G_I_21020_MONTH_calendar c
where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
and 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
 and  char(COMP_BEGIN_DATE  ) > char(date_seq)
  and c.date_seq like '201104%'

 465
 
 values 9320 +465
 9785
 
 values 12473 + 465
 12938
 
 
 
 
 select sum(bigint(TEL_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201104

8620

 values 12473 + 465


values (8620*1.000/9785 - 1)*100




select * from    
table (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a , BASS1.G_I_21020_MONTH_calendar b 





select count(distinct a.COMP_PRODUCT_NO) from    
table (
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201103
except 
select COMP_PRODUCT_NO,COMP_LAST_DATE
from         G_I_21020_MONTH
where COMP_BRAND_ID = '021000' 
and time_id = 201104
) a , BASS1.G_I_21020_MONTH_calendar b 
where 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
   and b.date_seq like '201104%'


 select count(0) from   
( 
 select COMP_PRODUCT_NO,COMP_LAST_DATE
 from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '021000' 
) a 
,
(
 select COMP_PRODUCT_NO,COMP_BEGIN_DATE
 from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '021000' 
) b 
,BASS1.G_I_21020_MONTH_calendar c
where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
and 
(days(date(date2))-
 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
 and  char(COMP_BEGIN_DATE  ) > char(date_seq)
  and c.date_seq like '201104%'




 select sum(bigint(UNION_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201104


values (13760*1.000/(154+14168) - 1)*100


values 23124*1.000/1269412





select USERTYPE_ID , count(0) 
--,  count(distinct USERTYPE_ID ) 
from G_A_02008_DAY 
group by  USERTYPE_ID 
order by 1 


select count(0) from     BASS1.t_product_no


////
 1624924 row(s) affected.

select count(0) from     BASS1.t_product_no 	 a 
,session.int_check_user_status b 
where a.product_no = b.product_no


select count(0) from    BASS1.t_product_no 	 a 
,session.int_check_user_status b 
where a.product_no = b.product_no
 and not exists (select 1 from bass1.g_s_03004_month c  where c.time_id = 201104
 and b.user_id= c.USER_ID and (ACCT_ITEM_ID between '0100'  and '0335'
 or ACCT_ITEM_ID in ('0401','0403','0407'))
 )
 23124
 
 select count(0) from     BASS1.t_product_no 	 a 
,session.int_check_user_status b 
where a.product_no = b.product_no



 values 23124*1.000/1269412



select count(0),count(distinct subs_id ) from    g_s_22204_month_down_20110530                                
where 
		usd_voicTD_ntwk_cust_flg   					 = '1'
or usd_GPRSTD_ntwk_cust_flg              = '1'
or usd_ntbkTD_ntwk_cust_flg              = '1'



$ desc  bass1.td_check_06_2010

Column                         Type      Type
name                           schema    name               Length   Scale Nulls
------------------------------ --------- ------------------ -------- ----- ------
PRODUCT_NO                     SYSIBM    CHARACTER                15     0 No    
TD_TERMINAL_MARK               SYSIBM    CHARACTER                 1     0 Yes   
NOTNET_TERMINAL_MARK           SYSIBM    CHARACTER                 1     0 Yes   
TD_NET_MARK                    SYSIBM    CHARACTER                 1     0 Yes   
TD_CDR_NET_MARK                SYSIBM    CHARACTER                 1     0 Yes   
TD_GPRS_NET_MARK               SYSIBM    CHARACTER                 1     0 Yes   
SPECIAL_TERMINAL_MARK          SYSIBM    CHARACTER                 1     0 Yes   
SHANGWANGBEN_MARK              SYSIBM    CHARACTER                 1     0 Yes   

select count(0) 
from  bass1.td_check_06_2010
where TD_CDR_NET_MARK = '1'
or TD_GPRS_NET_MARK = '1'
or SHANGWANGBEN_MARK= '1'


select *
from  bass1.td_check_06_2010
where value(TD_CDR_NET_MARK,'0') = '1'
or value(TD_GPRS_NET_MARK,'0')  = '1'
or value(SHANGWANGBEN_MARK,'0') = '1'


		select count(distinct PRODUCT_NO)
		from 
  bass1.g_s_04002_day_td2 a
  
  
  
  select SHANGWANGBEN_MARK , count(0) 
--,  count(distinct SHANGWANGBEN_MARK ) 
from bass1.td_check_06_2010 
group by  SHANGWANGBEN_MARK 
order by 1 

select TD_CDR_NET_MARK , count(0) 
--,  count(distinct TD_CDR_NET_MARK ) 
from bass1.td_check_06_2010 
group by  TD_CDR_NET_MARK 
order by 1 


		select
		  '3'
		  ,bigint(count(distinct product_no))
		  from bass1.td_check_06_2010
		 where td_cdr_net_mark='1' or td_gprs_net_mark='1' or shangwangben_mark='1'
         
         

select * from    bass1.td_check_06_2010

select  bigint(TD_NET_CUST) from   G_S_22204_MONTH
where time_id = 201104
and CYCLE_ID = '3'



select td_cdr_net_mark , count(0) 
--,  count(distinct td_cdr_net_mark ) 
from bass1.td_check_06_2010 
group by  td_cdr_net_mark 
order by 1 


select * from   bass1.td_check_06_2010

select count(0) from     bass1.td_check_06_2010

select count(0),count(distinct product_no ) from     bass1.td_check_06_2010

select count(0),count(distinct subs_id ) from    g_s_22204_month_down_20110530                                


update app.g_runlog 
set return_flag = 0
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
and unit_code = '03017'


select * from   
BASS1.MON_ALL_INTERFACE
 where type = 'm'
 and deadline = 3
 
 
 
 select * from   
BASS1.MON_ALL_INTERFACE
where interface_code = '01007'

select count(0),count(distinct ENTERPRISE_ID||CUST_ID||RELA_STATE) from    G_A_01007_DAY
where time_id = 201105311	2
9163	7863


1	2
9163	7863

select * from   G_A_01007_DAY
where ENTERPRISE_ID||CUST_ID
in (select ENTERPRISE_ID||CUST_ID
from G_A_01007_DAY where  time_id = 20110531
group by ENTERPRISE_ID||CUST_ID
having count(0) > 1
) 
and  time_id = 20110531
order by 1,2



CREATE TABLE "BASS1   "."G_A_01007_DAY_T0601"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(9) , 
                  "CUST_ID" CHAR(20) , 
                  "RELA_STATE" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_A_01007_DAY_T0601
select * from G_A_01007_DAY
where  time_id = 20110531

insert into 


CREATE TABLE "BASS1   "."G_A_01007_DAY_T0601_2"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(9) , 
                  "CUST_ID" CHAR(20) , 
                  "RELA_STATE" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_A_01007_DAY_T0601_2
select distinct  * from G_A_01007_DAY_T0601
where  time_id = 20110531


select count(0),count(distinct ENTERPRISE_ID||CUST_ID) from    G_A_01007_DAY_T0601_2
where time_id = 20110531
	


delete from G_A_01007_DAY where time_id = 20110531
 9163 row(s) affected.
INSERT INTO G_A_01007_DAY
select * from G_A_01007_DAY_T0601_2
7863 row(s) affected.
select count(0),count(distinct ENTERPRISE_ID||CUST_ID) from    G_A_01007_DAY
where time_id = 20110531
	
    
    
    select * from   G_A_01007_DAY
    where time_id = 20110531



alter table bass1.MON_ALL_INTERFACE add column sts smallint

select * from   bass1.MON_ALL_INTERFACE where interface_code = '04007'

   
update  bass1.MON_ALL_INTERFACE
set sts = -1 
where interface_code = '04007'
select * from    bass1.MON_ALL_INTERFACE
where interface_code = '04007'


 select  'xxxxx',count(0)
						from 
						( 
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
						from APP.G_FILE_REPORT a 
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00' 
						) t where rn = 1 with ur



CREATE FUNCTION bass1.get_flret_cnt(p_control_code varchar(128))
RETURNS
TABLE (dim_xxxxx varchar(8),cnt    int)
RETURN
 select  'xxxxx',count(0)
						from 
						( 
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
						from APP.G_FILE_REPORT a 
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00' 
						) t where rn = 1 with ur





CREATE FUNCTION bass1.get_flret_cnt()
RETURNS
TABLE (dim_xxxxx varchar(8),cnt  integer)
RETURN
select  'xxxxx' a,count(0) b
from 
( 
select  a.* ,row_number()over(partition by  substr(filename,18,5) 
							order by deal_time desc ) rn 
from APP.G_FILE_REPORT a 
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
and err_code='00' 
) t where rn = 1 with ur


select  'xxxxx' dummy,count(0) cnt
from 
( 
select  a.* ,row_number()over(partition by  substr(filename,18,5) 
							order by deal_time desc ) rn 
from APP.G_FILE_REPORT a 
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
and err_code='00' 
) t where rn = 1 with ur

                        
                        


CREATE FUNCTION bass1.get_flret_cnt
RETURNS TABLE ( dummy varchar(8),cnt    int )
RETURN
select  'xxxxx' dummy,count(0) cnt
from 
( 
select  a.* ,row_number()over(partition by  substr(filename,18,5) 
							order by deal_time desc ) rn 
from APP.G_FILE_REPORT a 
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
and err_code='00' 
) t where rn = 1 with ur


CREATE FUNCTION bass1.get_flret_cnt()
RETURNS 
TABLE ( dummy varchar(8),cnt    integer )
RETURN
select  'xxxxx' dummy,count(0) cnt from ( select  a.* ,row_number()over(partition by  substr(filename,18,5) 							order by deal_time desc ) rn 
from APP.G_FILE_REPORT a 
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
and err_code='00' 
) t where rn = 1 

with ur


select * from table(bass1.get_flret_cnt()) a;
select * from app.sch_control_task a 
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 1


select  'xxxxx',count(0)
						from 
						( 
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
						from APP.G_FILE_REPORT a 
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
						and err_code='00' 
						and substr(filename,18,5) 
						in (  select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
								   where deadline = 9 and sts = 1 
								) 
						) t where rn = 1 
                        



CREATE FUNCTION bass1.fn_dn_flret_cnt(p_deadline int)
RETURNS 
TABLE ( dummy varchar(8),cnt    integer )
RETURN
select  'xxxxx',count(0)
						from 
						( 
						select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
						from APP.G_FILE_REPORT a 
						where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
						and err_code='00' 
						and substr(filename,18,5) 
						in (  select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
								   where deadline = p_deadline and sts = 1 
								) 
						) t where rn = 1 


select * from table(bass1.fn_dn_flret_cnt(13)) a;
select * from app.sch_control_task a 
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 2


update app.sch_control_task a 
set cc_flag = 2
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 1


update app.sch_control_task a 
set FUNCTION_DESC = '[作废]'||FUNCTION_DESC
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 2



update app.sch_control_task a 
set FUNCTION_DESC = '[作废]'||FUNCTION_DESC
where control_code like  '%BASS1_G_A_06001_DAY.tcl%'
and cc_flag = 1

update app.sch_control_task a 
set cc_flag = 2
where control_code like  '%BASS1_G_A_06001_DAY.tcl%'
and cc_flag = 1



alter table BASS1.G_A_02004_DAY ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_A_01002_DAY ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_A_01004_DAY ALTER column CRT_CHNL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_A_02013_DAY ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_I_06021_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_I_06022_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_I_06023_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_S_22061_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_S_22063_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_S_22062_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)
alter table BASS1.G_S_22064_MONTH ALTER column CHANNEL_ID  SET DATA TYPE CHARACTER(40)


select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)

select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY 
where CHANNEL_ID
not in (select CHANNEL_ID  from G_A_06030_DAY )                        
and time_id <= 20101026
                        
                        G_A_06030_DAY
                        
                        
select time_id,count(0)
from G_A_06030_DAY
group by time_id
order by 1


select * from    bass2.dw_product_ord_cust_201104



                        
                        
select * from     bass2.dim_cfg_static_data a
where   CODE_TYPE_ALIAS = 'CHANNEL'
  and a.code_value in ('Q','L','I','e','D','B','6','4')                      
  
                        
select * from      bass2.dim_pub_channel 

select * from     bass2.dim_cfg_static_data a 
select * from     bass2.dim_cfg_static_data a where code_name like '%si%'



				select distinct a.channel_type, channel_type_class,e.channel_id,h.channel_name,e.CHANNEL_NAME
				  from bass2.dw_product_ord_cust_201104 a,
				       bass2.dim_pub_channel e,
				       bass2.dw_channel_info_201104 h
				 where 
				       a.org_id = e.channel_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
            --and a.channel_type in ('Q','L','I','e','D','B','6','4')
            and a.channel_type = '4'
      


				select distinct a.channel_type, channel_type_class,e.channel_id,h.channel_name,e.CHANNEL_NAME
				  from bass2.dw_product_ord_cust_201104 a,
				       bass2.dim_pub_channel e,
				       bass2.dw_channel_info_201104 h
				 where 
				       a.org_id = e.channel_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
            --and a.channel_type in ('Q','L','I','e','D','B','6','4')
            and a.channel_type = '4'




				select distinct a.channel_type
				  from bass2.dw_product_ord_cust_201104 a,
				       bass2.dim_pub_channel e,
				       bass2.dw_channel_info_201104 h
				 where 
				       a.org_id = e.channel_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
            and a.channel_type in ('Q','L','I','e','D','B','6','4')



				select distinct a.channel_type
				  from bass2.dw_product_ord_cust_201104 a,
				       bass2.dim_pub_channel e,
				       bass2.dw_channel_info_201104 h
				 where 
				       a.org_id = e.channel_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
            and a.channel_type in ('Q','L','I','e','D','B','6','4')



   bass2.dw_channel_info_201104
   select distinct 
   CHANNEL_TYPE
   from    bass2.dw_channel_info_201104
   
   
   select * from    bass2.dw_channel_info_201104
   

select distinct a.channel_type
  from bass2.dw_product_ord_cust_201105 a
 union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201104 a
 union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201103 a
  union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201103 a
  union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201103 a
  union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201103 a
  union all 
select distinct a.channel_type
  from bass2.dw_product_ord_cust_201103 a 

select tabname from syscat.tables where tabname like '%PRODUCT_ORD_CUST%'   


drop table BASS1.g_a_02004_day_chnl;
CREATE TABLE BASS1.g_a_02004_day_chnl(
   channel_id VARCHAR(40),
   channel_type VARCHAR(8) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    channel_id 
 )USING HASHING;
select * from    BASS1.g_a_02004_day_chnl
   
   delete from  BASS1.g_a_02004_day_chnl
   
   
   BASS1.g_a_02004_day_chnl 
   
   select distinct *
  from    BASS1.g_a_02004_day_chnl  a 
  
  select count(0),count(distinct channel_id ),count(distinct channel_id||channel_type)
  from   BASS1.g_a_02004_day_chnl  a 
  
  
  select a,b,count(0) from table
  (
select 'Y' a, '移动QQ聊天业务			' b from bass2.dual union all 
select 'W' a, 'PIM-号簿管家       ' b from bass2.dual union all 
select 'S' a, '客户端             ' b from bass2.dual union all 
select 'Q' a, '12580IVR           ' b from bass2.dual union all 
select 'L' a, 'WEB                ' b from bass2.dual union all 
select 'J' a, 'SP                 ' b from bass2.dual union all 
select 'I' a, '短信营业厅(MMS)    ' b from bass2.dual union all 
select 'H' a, '中央音乐平台       ' b from bass2.dual union all 
select 'e' a, '客服               ' b from bass2.dual union all 
select 'D' a, '12530.IVR          ' b from bass2.dual union all 
select 'c' a, 'CMMB客户端         ' b from bass2.dual union all 
select 'b' a, '营业前台（受理）   ' b from bass2.dual union all 
select 'B' a, '网上营业厅         ' b from bass2.dual union all 
select '9' a, '自助终端缴费       ' b from bass2.dual union all 
select '6' a, 'WAP营业厅          ' b from bass2.dual union all 
select '5' a, 'USSD               ' b from bass2.dual union all 
select '4' a, '短信营业厅         ' b from bass2.dual ) a
,
 BASS1.g_a_02004_day_chnl  b
 ,G_A_02004_DAY C 
 where a.a= b.channel_type
 and b.channel_id = c.CHANNEL_ID 
 and c.time_id = 20110531
 group by a,b
 
 case 
when a.a in ('B','L') then 'BASS1_WB'
when a.a in ('Q','D') then 'BASS1_HL'
when a.a in ('I','4') then 'BASS1_SM'
when a.a in ('6','L') then 'BASS1_WP'
when a.a in ('9') then 'BASS1_ST'
end 

select a.*, case 
when a.a in ('B','L') then 'BASS1_WB'
when a.a in ('Q','D') then 'BASS1_HL'
when a.a in ('I','4') then 'BASS1_SM'
when a.a in ('6','L') then 'BASS1_WP'
when a.a in ('9') then 'BASS1_ST'
end c
from table
  (
select 'Y' a, '移动QQ聊天业务			' b from bass2.dual union all 
select 'W' a, 'PIM-号簿管家       ' b from bass2.dual union all 
select 'S' a, '客户端             ' b from bass2.dual union all 
select 'Q' a, '12580IVR           ' b from bass2.dual union all 
select 'L' a, 'WEB                ' b from bass2.dual union all 
select 'J' a, 'SP                 ' b from bass2.dual union all 
select 'I' a, '短信营业厅(MMS)    ' b from bass2.dual union all 
select 'H' a, '中央音乐平台       ' b from bass2.dual union all 
select 'e' a, '客服               ' b from bass2.dual union all 
select 'D' a, '12530.IVR          ' b from bass2.dual union all 
select 'c' a, 'CMMB客户端         ' b from bass2.dual union all 
select 'b' a, '营业前台（受理）   ' b from bass2.dual union all 
select 'B' a, '网上营业厅         ' b from bass2.dual union all 
select '9' a, '自助终端缴费       ' b from bass2.dual union all 
select '6' a, 'WAP营业厅          ' b from bass2.dual union all 
select '5' a, 'USSD               ' b from bass2.dual union all 
select '4' a, '短信营业厅         ' b from bass2.dual ) a



select tabname from syscat.tables where tabname like '%CHANNEL%' 
select * from   bass2.DWD_CHANNEL_20110519

select * from   bass2.DIM_PUB_CHANNELTYPE
select * from   bass2.DIM_PUB_CHANNEl a
,bass2.DIM_PUB_CHANNELTYPE b 
where a.CHANNELTYPE_ID = b.CHANNELTYPE_ID
AND b.CHANNELTYPE_NAME like '%电子%'


select * from   g_a_02004_day 
where channel_id = '10000001'





select * from   bass2.DIM_PUB_CHANNEl a
where channel_id 
in
(
10000001
,10000001
,91000063
,20000001
,11111111
,91000063
,91000717
,11111142
,91000065
)






CREATE TABLE "BASS1   "."G_A_02004_DAY_LASTEST"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
--抓取用户资料入表
insert into G_A_02004_DAY_LASTEST 
select 
         e.TIME_ID
        ,e.USER_ID
        ,CUST_ID
        ,e.USERTYPE_ID
        ,CREATE_DATE
        ,USER_BUS_TYP_ID
        ,PRODUCT_NO
        ,IMSI
        ,CMCC_ID
        ,CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
        ,BRAND_ID
        ,SIM_CODE  
from (select a.*
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day a
where time_id<=20110531 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110531 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1



select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.G_A_02004_DAY_LASTEST 
group by  time_id 
order by 1 



select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY_LASTEST
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)



select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY_LASTEST a
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)
and a.time_id/100 = 201105




select * from  bass2.DIM_PUB_CHANNEl a
where  channel_id 
in
(
select distinct  bigint(CHANNEL_ID)
from BASS1.G_A_02004_DAY_LASTEST
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)
)


db2 RUNSTATS ON table  BASS1.G_A_02004_DAY_LASTEST 	with distribution and detailed indexes all   




select * from  bass2.DIM_PUB_CHANNEl a
where  channel_id 
in
(
select distinct  bigint(CHANNEL_ID)
from BASS1.G_A_02004_DAY_LASTEST
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)
)

select * from  bass2.DIM_PUB_CHANNEl a
where  channel_id = 40400101


select * from  bass2.DIM_PUB_CHANNEl a
where  channel_id 
in
(
select distinct  bigint(CHANNEL_ID)
from g_a_02004_day_illegal_chnl
)

           g_a_02004_day_illegal_chnl                        
                                




drop table BASS1.g_a_02004_day_illegal_chnl;
CREATE TABLE BASS1.g_a_02004_day_illegal_chnl(
   channel_id VARCHAR(40) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    channel_id 
 )USING HASHING;
insert into    g_a_02004_day_illegal_chnl
select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY_LASTEST
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH)

   
   


select length(trim(channel_id)) , count(0) 
--,  count(distinct length(trim(channel_id)) ) 
from G_I_06021_MONTH 
group by  length(trim(channel_id)) 
order by 1 


select *  from   BASS1.MON_ALL_INTERFACE 
where interface_code= '22302'





  select a.*,b.channel_id from table
  (
select 'Y' a, '移动QQ聊天业务			' b from bass2.dual union all 
select 'W' a, 'PIM-号簿管家       ' b from bass2.dual union all 
select 'S' a, '客户端             ' b from bass2.dual union all 
select 'Q' a, '12580IVR           ' b from bass2.dual union all 
select 'L' a, 'WEB                ' b from bass2.dual union all 
select 'J' a, 'SP                 ' b from bass2.dual union all 
select 'I' a, '短信营业厅(MMS)    ' b from bass2.dual union all 
select 'H' a, '中央音乐平台       ' b from bass2.dual union all 
select 'e' a, '客服               ' b from bass2.dual union all 
select 'D' a, '12530.IVR          ' b from bass2.dual union all 
select 'c' a, 'CMMB客户端         ' b from bass2.dual union all 
select 'b' a, '营业前台（受理）   ' b from bass2.dual union all 
select 'B' a, '网上营业厅         ' b from bass2.dual union all 
select '9' a, '自助终端缴费       ' b from bass2.dual union all 
select '6' a, 'WAP营业厅          ' b from bass2.dual union all 
select '5' a, 'USSD               ' b from bass2.dual union all 
select '4' a, '短信营业厅         ' b from bass2.dual ) a
,
 BASS1.g_a_02004_day_chnl  b
 ,G_A_02004_DAY C 
 where a.a= b.channel_type
 and b.channel_id = c.CHANNEL_ID 
 and c.time_id = 20110531
 group by a,b
 
 
             
 select * from  bass2.DIM_PUB_CHANNEl a
where  channel_id = 60600101
select * 
	from bass2.dw_channel_info_201104 a
 where a.channel_type_class in (90105,90102)
 select * from syscat.tables where tabname like '%%'    
 select * from  bass2.ODS_CHANNEL_TYPE_20110525
 select * from  report.DIM_CHANNEL_TYPE
 select * from  bass2.DIM_CHANNEL_TYPE_ST
 select * from  bass2.DIM_BBOSS_CHANNEL_TYPE
 
 
 
 
 
 SELECT * 
 from BASS1.g_a_02004_day_illegal_chnl a
 left join  bass2.dw_channel_info_201104  b on a.channel_id = char(value(value(b.CHANNEL_ID,b.ORGANIZE_ID),))
 
  select * from syscat.tables where tabname like '%CHANNEL_TY%'    \
  
  select * from bass2.DIM_BBOSS_CHANNEL_TYPE
select *
from 
(select distinct CHANNELTYPE_ID from   bass2.DIM_PUB_CHANNEl) a 
left join  bass2.DIM_BBOSS_CHANNEL_TYPE b on a.CHANNELTYPE_ID = b.CODE_ID

select * from   bass2.Dim_pub_channeltype



 SELECT * 
 from BASS1.g_a_02004_day_illegal_chnl a
 --left join  bass2.dw_channel_info_201104  b on a.channel_id = char(value(value(b.CHANNEL_ID,b.ORGANIZE_ID),))
 left join  bass2.DIM_PUB_CHANNEl b on a.channel_id = char(b.CHANNEL_ID)
 left join  bass2.DIM_BBOSS_CHANNEL_TYPE c on b.CHANNELTYPE_ID = c.CODE_ID
left join  bass2.DIM_BBOSS_CHANNEL_TYPE_SUB d on c.CODE_TYPE = d.CODE_ID

 select * from  bass2.DIM_BBOSS_CHANNEL_TYPE_SUB
 
 
 
  SELECT c.code_name,count(0)
 from BASS1.g_a_02004_day_illegal_chnl a
 --left join  bass2.dw_channel_info_201104  b on a.channel_id = char(value(value(b.CHANNEL_ID,b.ORGANIZE_ID),))
 left join  bass2.DIM_PUB_CHANNEl b on a.channel_id = char(b.CHANNEL_ID)
 left join  bass2.DIM_BBOSS_CHANNEL_TYPE c on b.CHANNELTYPE_ID = c.CODE_ID
left join  bass2.DIM_BBOSS_CHANNEL_TYPE_SUB d on c.CODE_TYPE = d.CODE_ID
group by c.code_name




CREATE TABLE "BASS1   "."G_A_02004_DAY_CHNL_MID"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
SELECT c.code_name,count(0)
 from BASS1.g_a_02004_day_illegal_chnl a
 --left join  bass2.dw_channel_info_201104  b on a.channel_id = char(value(value(b.CHANNEL_ID,b.ORGANIZE_ID),))
 left join  bass2.DIM_PUB_CHANNEl b on a.channel_id = char(b.CHANNEL_ID)
 left join  bass2.DIM_BBOSS_CHANNEL_TYPE c on b.CHANNELTYPE_ID = c.CODE_ID
left join  bass2.DIM_BBOSS_CHANNEL_TYPE_SUB d on c.CODE_TYPE = d.CODE_ID
group by c.code_name



update G_A_02004_DAY_CHNL_MID a 
set CHANNEL_ID = (select case when then end from  bass2.DIM_PUB_CHANNEl b 

where a.channel_id = char(b.CHANNEL_ID)
where a.channel_id not in (
select distinct CHANNEL_ID  from  G_I_06021_MONTH where time_id = $last_month
)




drop table BASS1.g_a_02004_day_illegal_chnl;
CREATE TABLE BASS1.g_a_02004_day_illegal_chnl(
   channel_id VARCHAR(40),
   bass2_chnl_type	 	 	 	 	  VARCHAR(40),
   bass1_chnl_type	 	 	 	 	  VARCHAR(40) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    channel_id 
 )USING HASHING;
insert into    g_a_02004_day_illegal_chnl(channel_id)
select distinct CHANNEL_ID
from BASS1.G_A_02004_DAY_LASTEST
where CHANNEL_ID
not in (select CHANNEL_ID  from G_I_06021_MONTH where time_id = 201104)




  SELECT c.code_name,d.CODE_NAME,count(0)
 from BASS1.g_a_02004_day_illegal_chnl a
 --left join  bass2.dw_channel_info_201104  b on a.channel_id = char(value(value(b.CHANNEL_ID,b.ORGANIZE_ID),))
 left join  bass2.DIM_PUB_CHANNEl b on a.channel_id = char(b.CHANNEL_ID)
 left join  bass2.DIM_BBOSS_CHANNEL_TYPE c on b.CHANNELTYPE_ID = c.CODE_ID
left join  bass2.DIM_BBOSS_CHANNEL_TYPE_SUB d on c.CODE_TYPE = d.CODE_ID
group by c.code_name,d.CODE_NAME

update BASS1.g_a_02004_day_illegal_chnl a
set bass2_chnl_type = (select char(CHANNELTYPE_ID) from  bass2.DIM_PUB_CHANNEl b where a.channel_id = char(b.CHANNEL_ID)
)


select * from  bass2.dw_channel_info_201104
where char(ORGANIZE_ID) in (
select channel_id from   BASS1.g_a_02004_day_illegal_chnl where channel_id is null
)


select * from   bass2.ODS_DIM_SYS_ORGANIZE_20110531


select * from syscat.tables where tabname like '%ORGANI%' 


select * from   bass2.ODS_DIM_SYS_ORGANIZE_20110531
where char(OLD_PARENT_CODE) in (
select channel_id from   BASS1.g_a_02004_day_illegal_chnl where channel_id is null
)

select * from   G_S_22065_MONTH
where time_id = 201105



select * from    bass2.dw_custsvc_agent_tele_dm_201104


select CHANNEL_TYPE, c.b,count(0) from    BASS1.g_a_02004_day_chnl a
,  BASS1.g_a_02004_day_illegal_chnl  b 
,table
  (
select 'Y' a, '移动QQ聊天业务			' b from bass2.dual union all 
select 'W' a, 'PIM-号簿管家       ' b from bass2.dual union all 
select 'S' a, '客户端             ' b from bass2.dual union all 
select 'Q' a, '12580IVR           ' b from bass2.dual union all 
select 'L' a, 'WEB                ' b from bass2.dual union all 
select 'J' a, 'SP                 ' b from bass2.dual union all 
select 'I' a, '短信营业厅(MMS)    ' b from bass2.dual union all 
select 'H' a, '中央音乐平台       ' b from bass2.dual union all 
select 'e' a, '客服               ' b from bass2.dual union all 
select 'D' a, '12530.IVR          ' b from bass2.dual union all 
select 'c' a, 'CMMB客户端         ' b from bass2.dual union all 
select 'b' a, '营业前台（受理）   ' b from bass2.dual union all 
select 'B' a, '网上营业厅         ' b from bass2.dual union all 
select '9' a, '自助终端缴费       ' b from bass2.dual union all 
select '6' a, 'WAP营业厅          ' b from bass2.dual union all 
select '5' a, 'USSD               ' b from bass2.dual union all 
select '4' a, '短信营业厅         ' b from bass2.dual ) c
where  a.channel_id = b.channel_id 
and a.CHANNEL_TYPE = c.a
and b.bass2_chnl_type is null 
GROUP BY CHANNEL_TYPE,c.b




for dt in 201007	201008	201009	201010	201011	201012	201101	201102	201103	201104
do 
db2 -c "insert into BASS1.g_a_02004_day_chnl select distinct char(ORG_ID),CHANNEL_TYPE from bass2.dw_product_ord_cust_$dt"
done


select tabname from syscat.tables where tabname like '%ORGAN%'   

select * from   bass2.DIM_SYS_ORG_ROLE_TYPE

select * from   bass2.DIM_STL_ORG

select * from   bass2.ODS_DIM_SYS_ORGANIZE_20110531




select distinct  * from    BASS1.g_a_02004_day_chnl a
,  BASS1.g_a_02004_day_illegal_chnl  b 
,table
  (
select 'Y' a, '移动QQ聊天业务			' b from bass2.dual union all 
select 'W' a, 'PIM-号簿管家       ' b from bass2.dual union all 
select 'S' a, '客户端             ' b from bass2.dual union all 
select 'Q' a, '12580IVR           ' b from bass2.dual union all 
select 'L' a, 'WEB                ' b from bass2.dual union all 
select 'J' a, 'SP                 ' b from bass2.dual union all 
select 'I' a, '短信营业厅(MMS)    ' b from bass2.dual union all 
select 'H' a, '中央音乐平台       ' b from bass2.dual union all 
select 'e' a, '客服               ' b from bass2.dual union all 
select 'D' a, '12530.IVR          ' b from bass2.dual union all 
select 'c' a, 'CMMB客户端         ' b from bass2.dual union all 
select 'b' a, '营业前台（受理）   ' b from bass2.dual union all 
select 'B' a, '网上营业厅         ' b from bass2.dual union all 
select '9' a, '自助终端缴费       ' b from bass2.dual union all 
select '6' a, 'WAP营业厅          ' b from bass2.dual union all 
select '5' a, 'USSD               ' b from bass2.dual union all 
select '4' a, '短信营业厅         ' b from bass2.dual ) c
where  a.channel_id = b.channel_id 
and a.CHANNEL_TYPE = c.a

select count(0) from     bass2.ODS_DIM_SYS_ORGANIZE_20110531 a 
,  BASS1.g_a_02004_day_illegal_chnl  b 
where a.ORG_ID = bigint(b.channel_id)
and b.BASS2_CHNL_TYPE is null 


select BASS2_CHNL_TYPE , count(0) 
--,  count(distinct BASS2_CHNL_TYPE ) 
from BASS1.g_a_02004_day_illegal_chnl 
group by  BASS2_CHNL_TYPE 
order by 1 



select count(0) from    g_a_02004_day where time_id = 20110531
2044
db2 reorg table BASS1.G_A_02004_DAY 
db2 reorg table BASS1.G_A_01002_DAY 
db2 reorg table BASS1.G_A_01004_DAY 
db2 reorg table BASS1.G_A_02013_DAY 
db2 reorg table BASS1.G_I_06021_MONTH 
db2 reorg table BASS1.G_I_06022_MONTH 
db2 reorg table BASS1.G_I_06023_MONTH 
db2 reorg table BASS1.G_S_22061_MONTH 
db2 reorg table BASS1.G_S_22063_MONTH 
db2 reorg table BASS1.G_S_22062_MONTH 
db2 reorg table BASS1.G_S_22064_MONTH 


select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from g_a_02004_day 
where  time_id = 20110531
group by  CHANNEL_ID 
order by 1 


select count(0) from    G_A_02004_DAY_CHNL_MID

select 
         TIME_ID
        ,USER_ID
        ,CUST_ID
        ,USERTYPE_ID
        ,CREATE_DATE
        ,USER_BUS_TYP_ID
        ,PRODUCT_NO
        ,IMSI
        ,CMCC_ID
        ,case when b.CHANNEL_ID is null then 'BASS1_DS' 
                        else a.channel_id end CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
        ,BRAND_ID
        ,SIM_CODE
from G_A_02004_DAY_CHNL_MID a
left join (select distinct CHANNEL_ID  from G_I_06021_MONTH where time_id = 201104)  b on a.CHANNEL_ID = b.CHANNEL_ID
where b.CHANNEL_ID is null 

select count(0) from    G_A_02004_DAY_CHNL_MID


select count(0) from    G_A_02004_DAY_CHNL_MID

select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from G_A_02004_DAY
where  time_id = 20110531
group by  CHANNEL_ID 
order by 1 



select tabname from syscat.tables where tabname like '%02004%'   


CREATE TABLE "BASS1   "."G_A_02004_DAY_B0601"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_A_02004_DAY_B0601
SELECT * FROM G_A_02004_DAY

delete from G_A_02004_DAY where  time_id = 20110531
insert into G_A_02004_DAY 
select * from  G_A_02004_DAY_B0601 where  time_id = 20110531


select count(0) from   G_A_01002_DAY
where  time_id = 20110901

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01002_DAY 
group by  time_id 
order by 1 

select * from   G_A_01002_DAY
where  time_id = 20110902

select count(0),count(distinct xx ) from     G_A_01002_DAY
where  time_id = 20110902


select count(0),count(distinct cust_id) from    G_A_02004_DAY
where  time_id = 20110222

select * from   G_A_02004_DAY
where  time_id = 20110222




select * from    
G_A_01004_DAY 
where  time_id = 20110531
and  CRT_CHNL_ID not in 
(select channel_id from G_A_02004_DAY
where   time_id = 20110531 )

select channel_id , count(0) 
--,  count(distinct channel_id ) 
from G_A_01002_DAY 
where  time_id = 20110901
group by  channel_id 
order by 1 



select * from    
G_A_01004_DAY 
where  time_id = 20110531
and  CUST_ID not in 
(select user_id from G_A_02004_DAY
where   time_id = 20110531 )





CREATE TABLE "BASS1   "."G_A_01002_DAY_B0601"  (
                  "TIME_ID" INTEGER , 
                  "CUST_ID" CHAR(20) , 
                  "CUST_NAME" CHAR(20) , 
                  "BIRTHDAY" CHAR(8) , 
                  "MARRY" CHAR(1) , 
                  "OCCUPATION_ID" CHAR(2) , 
                  "FOLK_ID" CHAR(2) , 
                  "EDUCATION_ID" CHAR(2) , 
                  "INCM_RNG_ID" CHAR(2) , 
                  "SEX_ID" CHAR(1) , 
                  "NATION_ID" CHAR(3) , 
                  "VIP_MARK" CHAR(1) , 
                  "CMCC_ID" CHAR(5) , 
                  "CREATE_DATE" CHAR(8) , 
                  "ADDRESS" CHAR(70) , 
                  "POST_CODE" CHAR(6) , 
                  "CARD_TYPE" CHAR(3) , 
                  "CARD_CODE" CHAR(20) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "CUSTSTATUS_ID" CHAR(2) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "CUST_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_A_01002_DAY_B0601
SELECT * FROM G_A_01002_DAY


alter table bass1.G_A_01002_DAY_CHNL_MID activate not logged initially with empty table

select 
         a.TIME_ID
        ,a.CUST_ID
        ,a.CUST_NAME
        ,a.BIRTHDAY
        ,a.MARRY
        ,a.OCCUPATION_ID
        ,a.FOLK_ID
        ,a.EDUCATION_ID
        ,a.INCM_RNG_ID
        ,a.SEX_ID
        ,a.NATION_ID
        ,a.VIP_MARK
        ,a.CMCC_ID
        ,a.CREATE_DATE
        ,a.ADDRESS
        ,a.POST_CODE
        ,a.CARD_TYPE
        ,a.CARD_CODE
        ,case when b.CHANNEL_ID is null then 'BASS1_DS' 
        		else a.channel_id end CHANNEL_ID
        ,a.CUSTSTATUS_ID
from G_A_01002_DAY a
left join (select distinct CHANNEL_ID  from G_I_06021_MONTH where time_id = 201104)  b on a.CHANNEL_ID = b.CHANNEL_ID
where a.time_id = 20110531


insert into G_A_01002_DAY_CHNL_MID
select 
         a.TIME_ID
        ,a.CUST_ID
        ,a.CUST_NAME
        ,a.BIRTHDAY
        ,a.MARRY
        ,a.OCCUPATION_ID
        ,a.FOLK_ID
        ,a.EDUCATION_ID
        ,a.INCM_RNG_ID
        ,a.SEX_ID
        ,a.NATION_ID
        ,a.VIP_MARK
        ,a.CMCC_ID
        ,a.CREATE_DATE
        ,a.ADDRESS
        ,a.POST_CODE
        ,a.CARD_TYPE
        ,a.CARD_CODE
        ,case when b.CHANNEL_ID is null then 'BASS1_DS' 
        		else a.channel_id end CHANNEL_ID
        ,a.CUSTSTATUS_ID
from bass1.G_A_01002_DAY a
left join (select distinct CHANNEL_ID  from bass1.G_I_06021_MONTH )  b on a.CHANNEL_ID = b.CHANNEL_ID
where a.time_id = 20110531

		DELETE FROM bass1.G_A_01002_DAY where time_id=20110531
        

	insert into  bass1.G_A_01002_DAY 
	select * from G_A_01002_DAY_B0601 a
    where  a.time_id = 20110531
    
    
    
    select count(0),count(distinct CRT_CHNL_ID ) from    bass1.G_A_01004_DAY a
        where  a.time_id = 20110531
        
        
        select count(0) from    bass2.dwd_enterprise_manager_rela_20110531
        
        
        select count(0) from     bass2.dwd_enterprise_msg_20110531 a
        join  (select distinct CHANNEL_ID  from bass1.G_I_06021_MONTH )  b
        on char(org_id) = b.channel_id
        
        
        
select count(0),count(distinct a.enterprise_id ) from    G_A_01004_DAY a
,bass2.dwd_enterprise_manager_rela_20110531 b
where time_id = 20110531
and a.enterprise_id = b.enterprise_id

select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from bass2.dwd_enterprise_manager_rela_20110531 
group by  CHANNEL_ID 
order by 1 

select count(0),count(distinct ENTERPRISE_ID ) from     bass2.dwd_enterprise_manager_rela_20110531
                
        select count(0) from   (select distinct channel_id from  bass2.dwd_enterprise_manager_rela_20110531 ) a 
        join  (select distinct CHANNEL_ID  from bass1.G_I_06021_MONTH )  b
        on char(a.CHANNEL_ID) = b.channel_id
        
        

        
        
CREATE TABLE "BASS1   "."G_A_01004_DAY_CHNL_MID"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENT_DEF_MODE" CHAR(1) , 
                  "PRT_GRP_CUST_ID" CHAR(20) , 
                  "ENTERPRISE_NAME" CHAR(60) , 
                  "OWNER_NAME" CHAR(20) , 
                  "NET_ADDRESS" CHAR(250) , 
                  "FAX_NO" CHAR(20) , 
                  "ENT_SCALE_ID" CHAR(1) , 
                  "MEMBER_NUMS" CHAR(8) , 
                  "ENT_REGION_TYPE" CHAR(2) , 
                  "ENT_INDUSTRY_ID" CHAR(2) , 
                  "GRP_AREA_SPEC_ID" CHAR(2) , 
                  "ENT_MANAGER_ID" CHAR(20) , 
                  "CMCC_ID" CHAR(5) , 
                  "CREATE_DATE" CHAR(8) , 
                  "LINKMAN_NAME" CHAR(20) , 
                  "TELEPHONE_NUM" CHAR(20) , 
                  "MOBILE_NUM" CHAR(15) , 
                  "LINKMAN_TITLE" CHAR(20) , 
                  "LINKMAN_FAX" CHAR(20) , 
                  "LINKMAN_MAIL" CHAR(50) , 
                  "LINKMAN_ADDR" CHAR(70) , 
                  "POST_CODE" CHAR(6) , 
                  "CUST_STATU_TYP_ID" CHAR(2) , 
                  "UNITE_PAY_FLAG" CHAR(1) , 
                  "IND_RES_SCHEMA" CHAR(100) , 
                  "CRT_CHNL_ID" CHAR(40) , 
                  "ENTER_TYPE_ID" CHAR(2) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select count(0) from     bass1.g_a_01004_tmp3
select count(0) from    G_A_01004_DAY_CHNL_MID


alter table bass1.G_A_01004_DAY_CHNL_MID activate not logged initially with empty table

insert into G_A_01004_DAY_CHNL_MID
select 
         a.TIME_ID
        ,a.ENTERPRISE_ID
        ,a.ENT_DEF_MODE
        ,a.PRT_GRP_CUST_ID
        ,a.ENTERPRISE_NAME
        ,a.OWNER_NAME
        ,a.NET_ADDRESS
        ,a.FAX_NO
        ,a.ENT_SCALE_ID
        ,a.MEMBER_NUMS
        ,a.ENT_REGION_TYPE
        ,a.ENT_INDUSTRY_ID
        ,a.GRP_AREA_SPEC_ID
        ,a.ENT_MANAGER_ID
        ,a.CMCC_ID
        ,a.CREATE_DATE
        ,a.LINKMAN_NAME
        ,a.TELEPHONE_NUM
        ,a.MOBILE_NUM
        ,a.LINKMAN_TITLE
        ,a.LINKMAN_FAX
        ,a.LINKMAN_MAIL
        ,a.LINKMAN_ADDR
        ,a.POST_CODE
        ,a.CUST_STATU_TYP_ID
        ,a.UNITE_PAY_FLAG
        ,a.IND_RES_SCHEMA
        ,case when b.CHANNEL_ID is null then 'BASS1_DS' 
        		else char(c.channel_id) end CHANNEL_ID 
        ,a.ENTER_TYPE_ID
from bass1.g_a_01004_tmp3 a
left join  bass2.dwd_enterprise_manager_rela_20110531 c on a.ENTERPRISE_ID = c.ENTERPRISE_ID
left join (select distinct CHANNEL_ID  from bass1.G_I_06021_MONTH )  b on char(c.CHANNEL_ID) = b.CHANNEL_ID
where a.time_id = 20110531

select CRT_CHNL_ID , count(0) 
--,  count(distinct CRT_CHNL_ID ) 
from G_A_01004_DAY_CHNL_MID 
group by  CRT_CHNL_ID 
order by 1 




select * from   bass1.g_a_01004_tmp4 

select  *  from bass1.G_I_06021_MONTH
where CHANNEL_ID = '1002                                    '

order by 1 desc 




        
CREATE TABLE "BASS1   "."G_A_01004_DAY_B0601"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENT_DEF_MODE" CHAR(1) , 
                  "PRT_GRP_CUST_ID" CHAR(20) , 
                  "ENTERPRISE_NAME" CHAR(60) , 
                  "OWNER_NAME" CHAR(20) , 
                  "NET_ADDRESS" CHAR(250) , 
                  "FAX_NO" CHAR(20) , 
                  "ENT_SCALE_ID" CHAR(1) , 
                  "MEMBER_NUMS" CHAR(8) , 
                  "ENT_REGION_TYPE" CHAR(2) , 
                  "ENT_INDUSTRY_ID" CHAR(2) , 
                  "GRP_AREA_SPEC_ID" CHAR(2) , 
                  "ENT_MANAGER_ID" CHAR(20) , 
                  "CMCC_ID" CHAR(5) , 
                  "CREATE_DATE" CHAR(8) , 
                  "LINKMAN_NAME" CHAR(20) , 
                  "TELEPHONE_NUM" CHAR(20) , 
                  "MOBILE_NUM" CHAR(15) , 
                  "LINKMAN_TITLE" CHAR(20) , 
                  "LINKMAN_FAX" CHAR(20) , 
                  "LINKMAN_MAIL" CHAR(50) , 
                  "LINKMAN_ADDR" CHAR(70) , 
                  "POST_CODE" CHAR(6) , 
                  "CUST_STATU_TYP_ID" CHAR(2) , 
                  "UNITE_PAY_FLAG" CHAR(1) , 
                  "IND_RES_SCHEMA" CHAR(100) , 
                  "CRT_CHNL_ID" CHAR(40) , 
                  "ENTER_TYPE_ID" CHAR(2) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_A_01004_DAY_B0601
SELECT * FROM G_A_01004_DAY
select count(0)     
from G_A_01004_DAY  a
where a.time_id = 20110531

select CRT_CHNL_ID , count(0) 
--,  count(distinct time_id ) 
from G_A_01004_DAY  a
where a.time_id = 20110531
group by  CRT_CHNL_ID 
order by 1 

select count(0) from     bass1.g_a_01004_tmp12         
                   
delete from        G_A_01004_DAY a
where a.time_id = 20110531

            
insert into G_A_01004_DAY
select * from G_A_01004_DAY_B0601 a
where a.time_id = 20110531
 

CREATE TABLE "BASS1   ".g_a_01004_tmp11_CHNL_MID (
                  "ENTERPRISE_ID" VARCHAR(20) , 
                  "GROUP_NAME" VARCHAR(200) , 
                  "PASSWORD" VARCHAR(30) , 
                  "GROUP_LEVEL" SMALLINT , 
                  "GROUP_TYPE" SMALLINT , 
                  "REGION_SPECIA" SMALLINT , 
                  "GROUP_STATUS" SMALLINT , 
                  "LEVEL_DEF_MODE" SMALLINT , 
                  "REC_STATUS" SMALLINT , 
                  "VOCATION" INTEGER , 
                  "VOCATION2" INTEGER , 
                  "VOCATION3" INTEGER , 
                  "GROUP_COUNTRY" VARCHAR(7) , 
                  "GROUP_PROVINCE" VARCHAR(7) , 
                  "GROUP_CITY" VARCHAR(7) , 
                  "REGION_TYPE" INTEGER , 
                  "REGION_DETAIL" INTEGER , 
                  "GROUP_ADDRESS" VARCHAR(200) , 
                  "GROUP_POSTCODE" INTEGER , 
                  "POST_PROVINCE" VARCHAR(7) , 
                  "POST_CITY" VARCHAR(7) , 
                  "POST_ADDRESS" VARCHAR(200) , 
                  "POST_POSTCODE" INTEGER , 
                  "PHONE_ID" VARCHAR(30) , 
                  "FAX_ID" VARCHAR(30) , 
                  "IDEN_ID" SMALLINT , 
                  "IDEN_NBR" VARCHAR(32) , 
                  "OWNER_NAME" VARCHAR(100) , 
                  "TAX_ID" VARCHAR(40) , 
                  "NET_ADDRESS" VARCHAR(80) , 
                  "PAY_TYPE" SMALLINT , 
                  "EMAIL" VARCHAR(60) , 
                  "CREATE_DATE" TIMESTAMP , 
                  "DONE_DATE" TIMESTAMP , 
                  "VALID_DATE" TIMESTAMP , 
                  "EXPIRE_DATE" TIMESTAMP , 
                  "OP_ID" BIGINT , 
                  "ORG_ID" BIGINT , 
                  "SO_NBR" VARCHAR(100) , 
                  "CUST_ID" VARCHAR(20) , 
                  "NOTES" VARCHAR(255) , 
                  "VPMN_ID" VARCHAR(64) , 
                  "EXT_FIELD1" VARCHAR(128) , 
                  "EXT_FIELD2" VARCHAR(128) , 
                  "EXT_FIELD3" VARCHAR(128) , 
                  "EXT_FIELD4" VARCHAR(128) , 
                  "EXT_FIELD5" VARCHAR(128) , 
                  "EXT_FIELD6" VARCHAR(128) , 
                  "EXT_FIELD7" VARCHAR(128) , 
                  "EXT_FIELD8" VARCHAR(128) , 
                  "EXT_FIELD9" VARCHAR(128) , 
                  "EXT_FIELD10" VARCHAR(128) )   
                 DISTRIBUTE BY HASH("CUST_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select count(0) from    G_A_02013_DAY
                   
                   
select * from      G_S_22080_DAY
                   
select * from   G_S_22083_MONTH

select sum(bigint(cancel_cnt)) from   G_S_22080_DAY
                   
                   
select * from   
G_S_22080_DAY
select sum(bigint(cancel_cnt))  from   G_S_22081_MONTH

select tabname from syscat.tables where tabname like '%INS_OFF_INS_PROD%'   

select count(0) from    bass2.dw_product_ds

                       select  sum(a.order_cnt) order_cnt
                                  from (
                                                select OFFER_ID,count(0)  order_cnt
                                                from bass2.ODS_PRODUCT_INS_OFF_INS_PROD_20110530 p ,
                                                (select distinct user_id from bass2.dw_product_20110530
                                                        where userstatus_id in (1,2,3,6,8)
                                                and usertype_id in (1,2,9) 
                                        ) u
                                                where  date(expire_date) =  '2011-05-30'
                                                and p.PRODUCT_INSTANCE_ID = u.user_id
                                                group by OFFER_ID
                                        ) a ,
                                        (
                                                SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name 
                                                FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                                WHERE ITEM_TYPE='OFFER_PLAN'
                                                  AND DEL_FLAG='1'
                                                  AND SUPPLIER_ID IS NOT NULL
                                        ) b 
                                where a.OFFER_ID = b.PRODUCT_ITEM_ID


select count(0) from    BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201105
where date(CREATE_DATE) = '2011-05-30'


 select count(0) from   bass2.Dwd_kf_sms_cmd_receive_20110529
where cmd_id =405003 and sts=4 



select * from app.sch_control_runlog 
where control_code = 'BASS1_EXP_G_S_22080_DAY'





select * from   G_S_22080_DAY


select * from bass1.g_rule_check where rule_code in ('R169') order by time_id desc
select * from bass1.g_rule_check where rule_code in ('R170') order by time_id desc
select * from bass1.g_rule_check where rule_code in ('R171') order by time_id desc
select * from bass1.g_rule_check where rule_code in ('R172') order by time_id desc



select CRT_CHNL_ID , count(0) 
--,  count(distinct CRT_CHNL_ID ) 
from G_A_01004_DAY 
where time_id = 20110901
group by  CRT_CHNL_ID 
order by 1 

select count(0) from    
select count(0),count(distinct enterprise_id) from    
G_A_01004_DAY 
where time_id = 20110901


11800
select count(0) from    

G_A_01004_DAY 
where time_id = 20110531




			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where 
			 time_id <= 20110531 and ENTERPRISE_BUSI_TYPE = '1520'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
            
            
select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1520'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1520'
) t

            
            
            			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02064_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			 and MANAGE_MODE = '3'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'


select * from    BASS1.G_A_02064_DAY
            
            
            

select distinct
				A.ENTERPRISE_ID,
				C.BASS1_VALUE as ENTERPRISE_BUSI_TYPE,
				case
					when C.BASS1_VALUE='1290' then '2'
					when upper(B.CONFIG_VALUE)='MAS' then '1'
					when upper(B.CONFIG_VALUE)='ADC' then '2'
					else '3'
				end as MANAGE_MODE,
				replace(char(date(min(A.done_date))),'-','') as ORDER_DATE,
				case
					when a.REC_STATUS=1 then '1'
					when a.REC_STATUS=0 then '2'
		        else '2'
				end as STATUS_ID
			from
				bass2.DW_ENTERPRISE_SUB_DS a,
				(select * from BASS2.DIM_SERVICE_CONFIG where CONFIG_ID=1000027)  b,
				(select * from BASS1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0108') c
			where DATE(A.done_date)='2011-05-17'
			  and A.SERVICE_ID = B.SERVICE_ID
			  and a.SERVICE_ID = c.XZBAS_VALUE
				and c.BASS1_VALUE ='1230'
				and a.enterprise_id not in ('89100000000683','89103000041929','89103000161144','89103000498290')
		 group by A.ENTERPRISE_ID,C.BASS1_VALUE,
		 		case
					when C.BASS1_VALUE='1290' then '2'
					when upper(B.CONFIG_VALUE)='MAS' then '1'
					when upper(B.CONFIG_VALUE)='ADC' then '2'
					else '3'
				end,
				case
					when REC_STATUS=1 then '1'
					when REC_STATUS=0 then '2'
				else '2'
				end 

                
select count(0) from    bass2.DW_ENTERPRISE_SUB_DS
                
                


select date(CREATE_DATE) , count(0) 
--,  count(distinct date(CREATE_DATE) ) 
from bass2.DW_ENTERPRISE_SUB_DS 
group by  date(CREATE_DATE) 
order by 1 


select * from bass2.DW_ENTERPRISE_SUB_DS  a
,(select * from BASS2.DIM_SERVICE_CONFIG where CONFIG_ID=1000027)  b
where a.SERVICE_ID = '931'
			  and A.SERVICE_ID = B.SERVICE_ID


931                

select * from   bass2.dim_enterprise_product 



select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from G_A_02004_DAY 
where time_id = 20110901
group by  CHANNEL_ID 
order by 1 


select * from   app.sch_control_runlog_his
where control_code like '%INT_CHECK_L34_MONTH%'
and date(endtime) = '2011-03-02'
select
        (select count(distinct user_id) cnt from bass1.g_i_02023_day a where time_id/100 = 201105)                     
         - (select count(0) cnt from bass1.g_i_02021_month a where time_id = 201105 and  OVER_PROD_ID like 'QW_QQT_DJ%')
         from bass2.dual

select * from   bass2.dw_product_201104


select * from   app.sch_control_runlog where control_code = 'BASS2_Dw_product_ms.tcl'
select * from  app.sch_control_alarm where control_code = 'BASS2_Dw_product_ms.tcl'


select time_id , count(0) 
--,  count(distinct time_id ) 
from g_a_02004_day 
group by  time_id 
order by 1 desc
select count(0),count(distinct user_id ) from    bass1.g_i_02021_month
where time_id = 201104



select time_id , count(0) 
--,  count(distinct time_id ) 
from g_a_02008_day 
group by  time_id 
order by 1 desc

select count(0),count(distinct user_id) from    g_a_02004_day
where time_id = 20110901

select count(0),count(distinct user_id) from    g_a_02008_day
where time_id = 20110901




select a.cnt*1.00 ,value(b.income,0) income
from
(select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			 and MANAGE_MODE = '3'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
) a,(
select sum(income)*1.00/100 income
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
) t 
) b 



                select count(0) from   G_S_22303_MONTH where ENT_BUSI_ID = '1380'
                and time_id = 201105
                and bigint(BILL_CUST_NUMS) >  bigint(USE_CUST_NUMS)
        with ur


select * from    bass1.td_check_06_2010
        

select TD_TERMINAL_MARK , count(0) 
--,  count(distinct TD_TERMINAL_MARK ) 
from bass1.td_check_06_2010 
group by  TD_TERMINAL_MARK 
order by 1 



select NOTNET_TERMINAL_MARK , count(0) 
--,  count(distinct NOTNET_TERMINAL_MARK ) 
from bass1.td_check_06_2010 
group by  NOTNET_TERMINAL_MARK 
order by 1 


        

select TD_CDR_NET_MARK , count(0) 
--,  count(distinct TD_CDR_NET_MARK ) 
from bass1.td_check_06_2010 
group by  TD_CDR_NET_MARK 
order by 1 


select TD_GPRS_NET_MARK , count(0) 
--,  count(distinct TD_GPRS_NET_MARK ) 
from bass1.td_check_06_2010 
group by  TD_GPRS_NET_MARK 
order by 1 



select  count(0) 
--,  count(distinct SHANGWANGBEN_MARK ) 
from bass1.td_check_06_2010 
group by  SHANGWANGBEN_MARK 
order by 1 


	select count(0) from  bass1.td_check_06_2010 
		where product_no in (select distinct product_no  from bass1.g_s_04002_day_tmp)
		  and td_net_mark='1'

         
	select a.TD_CUST*1.0 ,b.cnt*1.0
				from 
				(
			select  bigint(TD_CUST) TD_CUST from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'							
			 )a,
				(
					select count(distinct PRODUCT_NO) cnt 
					from bass1.td_check_06_2010 a 
				) b
			with ur         
            

	select a.TD_NET_CUST*1.0000 , b.cnt*1.0000
				from 
				(
					select  bigint(TD_NET_CUST) TD_NET_CUST from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'			
			 )a,
				(
					select count(distinct PRODUCT_NO) cnt 
					from bass1.td_check_06_2010 a 
					where ( TD_CDR_NET_MARK = '1' or  TD_GPRS_NET_MARK = '1' or  SHANGWANGBEN_MARK = '1' )
				) b
			with ur


select 'xxxxx',count(0) from app.g_runlog 
					 where time_id=int(replace(char(current date - 1 days),'-','')) 
					 and return_flag=1 with ur 


 select * from table(bass1.fn_dn_flret_cnt(9)) a

select * from   mon_all_interface
where type= 'm' and deadline = 5



select sum(bigint(BILL_DURATION)) from bass1.g_s_21003_month_td 


select a.TD_CUST_DUR*1.0000 , b.dur*1.0000
				from 
				(
					select  bigint(TD_CUST_DUR) TD_CUST_DUR from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'
			 )a,
				(
					select sum(bigint(BILL_DURATION)) dur from bass1.g_s_21003_month_td 

				) b
			with ur


        select a.TD_CUST*1.0000 , b.cnt*1.0000
                                from 
                                (
                        select  bigint(TD_CUST) TD_CUST from   G_S_22204_MONTH
                                        where time_id = 201105
                                        and CYCLE_ID = '3'                                                      
                         )a,
                                (
                                        select count(distinct PRODUCT_NO) cnt 
                                        from bass1.td_check_06_2010 a 
                                ) b
                        with ur


select * from    bass1.int_program_data
where program_name like '%R006%'
                        
                        


select * from g_i_02053_month
  where time_id = 201105
 and 
 VALID_DATE> EXPIRE_DATE



decimal(1.0*($RESULT_VAL4+$RESULT_VAL5-$RESULT_VAL6)/1024/1024,20,2)

select (val4 + val5 - val6)/1024/1024 flows
from 
(
		select 
		sum(bigint(a.flows))*1.00 val6
		from bass1.g_s_04002_day_flows a,
		bass1.td_check_user_flow b
		where a.product_no=b.product_no
		  and a.mns_type='1'
) a ,
(
		select 
		sum(bigint(flows))*1.00 val5
		from bass1.g_s_04018_day_flows
	   where mns_type='1'
) b ,
(
		select 
		sum(bigint(flows))*1.00 val4
		from bass1.g_s_04002_day_flows
	   where mns_type='1'                        
) c        




select a.TD_CUST_T_FLOWS*1.0000 , b.flows*1.0000
				from 
				(
					select  bigint(TD_CUST_T_FLOWS) TD_CUST_T_FLOWS from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'
			 )a,
				(
												select (val1 + val2 - val3)/1024/1024 flows
												from 
												(												
														select (val4 + val5 - val6)/1024/1024 flows
														from 
														(
																select 
																sum(bigint(a.flows))*1.00 val6
																from bass1.g_s_04002_day_flows a,
																bass1.td_check_user_flow b
																where a.product_no=b.product_no
																  and a.mns_type='1'
														) a ,
														(
																select 
																sum(bigint(flows))*1.00 val5
																from bass1.g_s_04018_day_flows
															   where mns_type='1'
														) b ,
														(
																select 
																sum(bigint(flows))*1.00 val4
																from bass1.g_s_04002_day_flows
															   where mns_type='1'                        
														) c        
				) b
			with ur
            



select a.TD_CUST_T_FLOWS*1.0000 , b.flows*1.0000
				from 
				(
					select  bigint(TD_CUST_T_FLOWS)  TD_CUST_T_FLOWS from   G_S_22204_MONTH
					where time_id = $op_month
					and CYCLE_ID = '3'
			 )a,
				(
												select (val1 + val2 - val3)/1024/1024 flows
												from 
												(												
														select (val4 + val5 - val6)/1024/1024 flows
														from 
														(
																select 
																sum(bigint(a.flows))*1.00 val6
																from bass1.g_s_04002_day_flows a,
																bass1.td_check_user_flow b
																where a.product_no=b.product_no
																  and a.mns_type='1'
														) a ,
														(
																select 
																sum(bigint(flows))*1.00 val5
																from bass1.g_s_04018_day_flows
															   where mns_type='1'
														) b ,
														(
																select 
																sum(bigint(flows))*1.00 val4
																from bass1.g_s_04002_day_flows
															   where mns_type='1'                        
														) c        
				) b



select a.TD_CUST_T_FLOWS*1.0000 , b.flows*1.0000
				from 
				(
					select  bigint(TD_CUST_T_FLOWS)  TD_CUST_T_FLOWS from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'
			 ) a,
				(
                                                    select (val4 + val5 - val6)/1024/1024 flows
														from 
														(
																select 
																sum(bigint(a.flows))*1.00 val6
																from bass1.g_s_04002_day_flows a,
																bass1.td_check_user_flow b
																where a.product_no=b.product_no
																  and a.mns_type='1'
														) a ,
														(
																select 
																sum(bigint(flows))*1.00 val5
																from bass1.g_s_04018_day_flows
															   where mns_type='1'
														) b ,
														(
																select 
																sum(bigint(flows))*1.00 val4
																from bass1.g_s_04002_day_flows
															   where mns_type='1'                        
														) c     
													 
				) b
			with ur            
            


decimal(1.0*($RESULT_VAL11+$RESULT_VAL12+$RESULT_VAL13)/100,20,2)\

					select  bigint(TD_CUST_FEE) TD_CUST_FEE  from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'
             5156459
             5141334.010000000
values        5156459*1.00/5141334 -1     
select (val1 + val2 - val3 )/100  fee
from 
(
	select value(sum(a.book_fee),0)*1.00 val1
	  from g_s_03004_month_td a,bass1.td_check_user_fee1 b
	where a.product_no=b.product_no
)  a,          

(
	select value(sum(a.all_fee-a.book_fee),0)*1.00 val2 
	  from g_s_03004_month_td a,bass1.td_check_user_fee2 b
	where a.product_no=b.product_no
)  b,          
(
	select value(sum(a.all_fee),0)*1.00 VAL3
	  from g_s_03004_month_td a,bass1.td_check_user_fee3 b
	where a.product_no=b.product_no
)  C          



	select a.TD_CUST_FEE*1.0000 , b.fee*1.0000
				from 
				(
					select  bigint(TD_CUST_FEE) TD_CUST_FEE  from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'

			 ) a,
				(
                  select (val1 + val2 - val3 )/100  fee
												from 
												(
													select value(sum(a.book_fee),0)*1.00 val1
													  from g_s_03004_month_td a,bass1.td_check_user_fee1 b
													where a.product_no=b.product_no
												)  a,          
												
												(
													select value(sum(a.all_fee-a.book_fee),0)*1.00 val2 
													  from g_s_03004_month_td a,bass1.td_check_user_fee2 b
													where a.product_no=b.product_no
												)  b,          
												(
													select value(sum(a.all_fee),0)*1.00 VAL3
													  from g_s_03004_month_td a,bass1.td_check_user_fee3 b
													where a.product_no=b.product_no
												)  C               
													 
				) b
			with ur  




		select count(distinct product_no ) from     bass1.G_S_02047_MONTH
where time_id = 201104

			 ) a,
				(
                    select count(0)  from  
											(
											select   distinct product_no from        G_S_21003_MONTH where time_id = 201104
											union 
											select   distinct product_no from        G_S_21006_MONTH where time_id = 201104
											union 
											select   distinct product_no from        G_S_21009_DAY where time_id/100 = 201104
											) a
													 
				) b
			with ur  




	select a.val1*1.0000 , b.val2*1.0000
				from 
				(
				select count(distinct product_no ) val1 from     bass1.G_S_02047_MONTH
where time_id = 201104

			 ) a,
				(
                    select count(0) val2 from  
											(
											select   distinct product_no from        G_S_21003_MONTH where time_id = 201104
											union 
											select   distinct product_no from        G_S_21006_MONTH where time_id = 201104
											union 
											select   distinct product_no from        G_S_21009_DAY where time_id/100 = 201104
											) a
													 
				) b
with ur  





select count(0) from   G_I_21020_MONTH
where
COMP_BRAND_ID = '021000' and 
 substr(COMP_PRODUCT_NO,1,3) not 
in ('130','131','132','155','156','185','186','145')   
and time_id = 201104




CREATE TABLE BASS1.G_S_21003_MONTH_mobile
 (
 product_no                char(20)         
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (product_no
   ) USING HASHING;
select * from   G_I_02020_MONTH
where time_id = 201105


select * from   

select count(0),count(distinct user_id ) from    G_I_02020_MONTH
where base_prod_id like 'QW_QQT%'





insert into app.sch_control_map
values
 (2,'INT_CHECK_R229_MONTH.tcl','BASS1_INT_CHECK_R229_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R229_MONTH.tcl' PROGRAM_NAME
,'R229.bass' SOURCE_DATA
,'R229._e' OBJECTIVE_DATA
,'R229._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R229_MONTH.tcl','BASS1_G_S_21003_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R229_MONTH.tcl','BASS1_G_S_02047_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R229_MONTH.tcl','BASS1_G_S_21009_DAY.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_S_21003_MONTH','BASS1_INT_CHECK_R229_MONTH.tcl' from bass2.dual



delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R229_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R229_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R229_MONTH.tcl',
   - 1,
   310,
   'R229 02047校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
SELECT * 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_INT_CHECK_R229_MONTH.tcl');
insert into app.sch_control_map
values
 (2,'INT_CHECK_R238_MONTH.tcl','BASS1_INT_CHECK_R238_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R238_MONTH.tcl' PROGRAM_NAME
,'R238.bass' SOURCE_DATA
,'R238._e' OBJECTIVE_DATA
,'R238._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R238_MONTH.tcl','BASS1_G_I_06022_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R238_MONTH.tcl','BASS1_G_I_06021_MONTH.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_I_06022_MONTH','BASS1_INT_CHECK_R238_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_EXP_G_I_06021_MONTH','BASS1_INT_CHECK_R238_MONTH.tcl' from bass2.dual


delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R238_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R238_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R238_MONTH.tcl',
   - 1,
   310,
   'R238 06021|06022等渠道接口校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select * from
                (select * from 
                (
                select user_id,chg_vip_time,row_number()over(partition by user_id order by time_id desc) row_id from BASS1.G_I_02005_MONTH
                where time_id=201105
                ) k
                where k.row_id =1) a
                left outer join 
                (
                select * from
                (
                select user_id,create_date,row_number()over(partition by user_id order by time_id desc) row_id 
                from BASS1.G_A_02004_DAY
                where time_id<=20110531
                ) k
                where k.row_id=1) b
                on a.user_id=b.user_id
                where bigint(chg_vip_time)<bigint(create_date)
                with ur
                




update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20100917'
where user_id = '89160000265019'
and time_id = 201105




update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110321'
where user_id = '89460000740915'
and time_id = 201105



select * from g_i_02053_month
  where time_id = 201105
 and 
 VALID_DATE> EXPIRE_DATE
 
 
 BASS1_G_S_21003_MONTH.tcl
select * from   
app.sch_control_task where control_code in ('BASS1_EXP_G_S_22063_MONTH');
UPDATE app.sch_control_task SET time_value = 310 
WHERE control_code 
IN ('BASS1_G_S_22063_MONTH.tcl');
select * from   
app.sch_control_task where control_code LIKE '%BASS%EXP%MONTH%'

select * from     table( bass1.get_before('BASS1_G_S_22063_MONTH.tcl')) a 


select * from    app.sch_control_runlog where control_code in (
select before_control_code from  table( bass1.get_before('BASS1_G_S_22062_MONTH.tcl')) a 
)


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R238_MONTH.tcl','BASS1_G_I_06023_MONTH.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R238_MONTH.tcl','BASS1_G_S_22061_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R238_MONTH.tcl','BASS1_G_S_22063_MONTH.tcl' from bass2.dual


insert into app.sch_control_before 
select 'BASS1_EXP_G_I_06023_MONTH','BASS1_INT_CHECK_R238_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_EXP_G_S_22061_MONTH','BASS1_INT_CHECK_R238_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_EXP_G_S_22063_MONTH','BASS1_INT_CHECK_R238_MONTH.tcl' from bass2.dual


CONTROL_CODE
BASS1_INT_CHECK_TD_MONTH.tcl
BASS1_INT_CHECK_SAMPLE_MONTH.tcl
BASS1_INT_CHECK_VOICE_MONTH.tcl
BASS1_G_S_21003_MONTH.tcl
BASS1_INT_CHECK_R229_MONTH.tcl


update app.sch_control_task 
set time_value = 310 
where control_code in ('BASS1_INT_CHECK_VOICE_MONTH.tcl');
select * from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22061_month where time_id <=201105)
  and time_id =201105
  and channel_type<>'3'
  and channel_status='1'
 

select * from     bass1.g_i_06021_month 
where channel_id
in (  
 '100002418'
,'100002391'                              
,'100002467'
)                              

select count(0) from    BASS1.G_S_22061_MONTH where time_id = 201105


select * from     bass1.g_s_22061_month 
where channel_id
in (  
 '100002418'
,'100002391'                              
,'100002467'
)                            

select * from 
BASS2.DW_CHANNEL_INFO_201105
   where char(channel_id)
in (  
 '100002418'
,'100002391'                              
,'100002467'
)                            


  
  select *  
  	FROM BASS2.DW_CHANNEL_INFO_201105 A
where CHANNEL_ID = 30300105                                

  select count(0),count(distinct channel_id ) from  g_s_22061_month

select CHANNEL_STATE , count(0) 
--,  count(distinct CHANNEL_STATE ) 
from BASS2.DW_CHANNEL_INFO_201105 
group by  CHANNEL_STATE 
order by 1 


CHANNEL_ID
100002418                               
100002391                               
100002467                               


  select *  
  	FROM BASS2.DW_CHANNEL_INFO_201105 A
where CHANNEL_ID = 100002418       




  select *  
  	FROM BASS2.DW_CHANNEL_INFO_201105 A
where CHANNEL_ID = 100002418       


  select *  
  	FROM BASS2.DW_CHANNEL_INFO_201105 A
where CHANNEL_ID = 30300105                                

  
  select * from  bass2.dw_channel_info_201105
  where CHANNEL_ID = 30300105                                



SELECT  ( val1 - val2 ) val 
from 
(
select count(0)  val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in ('1','2','3')
)  a
,(
select count(0) val2 from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and   channel_type in ('1','2')
) b 


select * from G_I_06021_MONTH
where 
channel_id in (
select channel_id  from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and   channel_type in ('1','2')
except
select channel_id  val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in ('1','2','3')

)
and time_id = 201105


CHANNEL_ID
100000844                               
100000845                               
100000930                               
10320010                                

select  * from BASS1.G_I_06021_MONTH 
where CHANNEL_ID in 
(
'100000844'                               
,'100000845'                               
,'100000930'                               
,'10320010'   
)
and time_id = 201102


select * from   bass2.DW_CHANNEL_INFO_201104
where CHANNEL_ID in 
(
100000844                               
,100000845                               
,100000930                               
,10320010   
)

select * from   
 bass2.ODS_DIM_SYS_ORGANIZE_20110531
 where organize_id in 
(
100000844                               
,100000845                               
,100000930                               
,10320010   
) 

select * from   bass2.DIM_BBOSS_CHANNEL_TYPE

105001	10500101			1	0	1

select tabname from syscat.tables where tabname like '%CHANNEL_TYPE%'   


select * from   BASS1.MON_ALL_INTERFACE a
where interface_code = '22085'





SELECT  ( val1 - val2 ) val 
from 
(

select count(0) val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in  ('5','6')

)  a
,(

select count(0) val2 from    
BASS1.G_I_06021_MONTH 
where time_id = 201105 and CHANNEL_STATUS = '1' 
and   channel_type in ('3')
) b 



update BASS1.G_I_06021_MONTH  
set CHANNEL_B_TYPE = '1'
where time_id = 201105 
and CHANNEL_ID in 
(
'100000844'
,'100000845'
,'100000930'
,'10320010'   
)


select count(0) from    G_S_03017_MONTH where time_id = 201105
1
16186

16170

20110501
	and eff_dt<=ADD_MONTHS(CAST($Tx_Date||'01' AS DATE FORMAT 'YYYYMMDD'),1)-1


values DATE(DATE('2010-07-19') - 1 MONTHS)

values DATE(TIMESTAMP_FORMAT('2010-07-19','YYYY-MM-DD') - 1 MONTH)




        select * from bass1.G_S_03017_MONTH a 
        where 
                time_id = 201105
                and not exists (select 1 from (select distinct enterprise_id from bass1.G_A_01004_DAY where time_id / 100 <= 201105 ) t where a.enterprise_id = t.enterprise_id )
        with ur
        
       select * from     bass1.G_A_01004_DAY
where enterprise_id = '89103001238528      '       



select * from   G_I_77780_DAY_DOWN20110429


select * from   BASS1.G_A_01005_MONTH


insert into  BASS1.G_A_01005_MONTH
select distinct 
         201105 TIME_ID
        ,ID
        ,ENTERPRISE_ID
from     BASS1.G_I_77780_DAY_DOWN20110429 a

     
     select count(0),count(distinct user_id) from   bass1.G_I_02022_DAY
where time_id /100 <= 201105


1	2
20229	2288

select count(0),count(distinct user_id ) from    G_I_02020_MONTH
where base_prod_id like 'QW_QQT%'

2172	2172



select count(0),count(distinct user_id ) from    G_I_02021_MONTH
where OVER_PROD_ID like 'QW_QQT%'
1	2
4412	678


     
     select count(0),count(distinct user_id) from   bass1.G_I_02023_DAY
where time_id /100 <= 201105

1	2
6681	678


select time_id , PROD_VALID_DATE , count(0) 
--,  count(distinct time_id , valid_date ) 
from bass1.g_i_02020_month 
where time_id = 201105
group by  time_id , PROD_VALID_DATE
order by 2 desc 



select distinct user_id from G_I_02022_DAY
where time_id /100 <= 201105
except 

select distinct user_id  from    G_I_02020_MONTH
where base_prod_id like 'QW_QQT%'
89160000914721      
89160000919777      

select plan_id from bass2.dw_product_20110902
where user_id = '89160000919777'
PLAN_ID
89140007

select * from   bass2.dim_pub_plan where 
PLAN_ID =
89110017

select * from   g_i_02022_day 
where user_id = '89160000918412'

select *    
 from bass2.dw_product_ins_prod_201105 a
 where   char(a.product_instance_id) = '89160000918412            '
 
 select * from   bass1.g_i_02022_day 
 select * from  g_i_02020_month
 where user_id = '89160000918412'
 
select * from 
BASS2.Dw_product_ins_off_ins_prod_201105 a,                                        (
                                                SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name 
                                                FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                                WHERE ITEM_TYPE='OFFER_PLAN'

                                        ) b 
                                where a.OFFER_ID = b.PRODUCT_ITEM_ID
and product_instance_id = '89160000918412'
order by valid_date asc,expire_date desc 

select * from   
G_I_02020_MONTH
where  user_id = '89160000919777'


select count(0) from     g_i_06002_month

select * from      bass2.DIM_PROD_UP_PRODUCT_ITEM
where PRODUCT_ITEM_ID =111089110012
111089140007
111089110017



 select count(0) dup_cnt
        from (
                select count(0)  cnt
                from bass1.G_A_01005_MONTH
                where time_id =201105
                group by ID||ENTERPRISE_ID having count(0) > 1
                ) t 
                
                select count(0) dup_cnt
        from (
                select count(0)  cnt
                from bass1.G_A_01005_MONTH
                where time_id =201105
                group by ID||ENTERPRISE_ID having count(0) > 1
                ) t 
                
0
select *    
 from bass2.dw_product_ins_prod_201105 a
 where   char(a.product_instance_id) = '89160000918412            '
 
OFFER_ID
111089110017
111089140008
111089110012
                select 
                     201104,
                     char(a.product_instance_id),
                     value(d.BASE_PKG_ID,char(a.offer_id)),
                     value(d.VALID_DT,replace(char(date(a.create_date)),'-',''))
                from bass2.dw_product_ins_prod_201105 a
          left join (select * from bass1.g_i_02022_day where time_id = 20110430 ) d on a.product_instance_id = d.user_id 
                where  a.state in ('1','4','6','8','M','7','C','9')
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                                                                        where a.product_instance_id
                                                                                                                                        = b.user_id and  b.sts=1
                                )     
and                                  char(a.product_instance_id) = '89160000919777'





    select 
        (select count(distinct user_id) cnt from bass1.g_i_02022_day a where time_id/100 = 201105 )                     
         - (select count(distinct user_id) cnt from bass1.g_i_02020_month a where time_id = 201105 and  BASE_PROD_ID like 'QW_QQT_JC%')
         from bass2.dual
         
                              select count(0) from bass1.g_i_02020_month
                      where time_id =201105
                      
                      
                      
                      
                      select * from bass1.g_i_02019_month
                      where  time_id =201105
                      

    select 
        (select count(distinct user_id||ADD_PKG_ID) cnt from bass1.g_i_02023_day a where time_id/100 = 201105)                     
         - (select count(distinct user_id||OVER_PROD_ID) cnt from bass1.g_i_02021_month a where time_id = 201105 and  OVER_PROD_ID like 'QW_QQT_DJ%')
         from bass2.dual
        with ur                       
        
        
        
        select count(0),count(distinct user_id ) from    bass1.g_i_02021_month a where time_id = 201104
        
        1	2
4542241	1518878

1	2
4586896	4586896
1	2
4586896	1539011
select count(0) from     bass1.g_i_02021_month_temp2 

1
4598255

1	2
4586896	1539011
80.35694  	30.96353  	100002393                               

select LONGITUDE,LATITUDE,channel_id
from G_I_06021_MONTH where time_id = 201105 and channel_id= '100002393                               '
except 
select LONGITUDE,LATITUDE,channel_id
from G_I_06021_MONTH where time_id = 201104 and channel_id= '100002393 '      
except
select LONGITUDE,LATITUDE,channel_id
from G_I_06021_MONTH where time_id = 201105

select count(0) from G_I_06021_MONTH where time_id = 201104
select count(0) from G_I_06021_MONTH where time_id = 201105
select count(0),count(distinct channel_id ) from    G_I_06021_MONTH where time_id = 201105

    
    update BASS1.G_I_06021_MONTH  
set CHANNEL_B_TYPE = '1'
where time_id = 201105 
and CHANNEL_ID in 
(
'100000844'
,'100000845'
,'100000930'
,'10320010'   
)

select * from   BASS1.G_I_06021_MONTH  
where time_id = 201105 
and CHANNEL_ID in 
(
'100000844'
,'100000845'
,'100000930'
,'10320010'   
)



select tabname from syscat.tables where tabname like 'G%_01005%'   


select * from syscat.tables where tabname like 'G%777%'   

select count(0) from   G_I_77780_DAY


1035

select * from   G_I_77777_MONTH



select * from   G_A_01005_MONTH_MID


select * from   G_A_01005_MONTH_MID2


select * from   G_A_01005_MONTH



select * from   G_A_01005_MONTH_MID2

select count(0) from   G_A_01005_MONTH
where trim(enterprise_id) in 
(select enterprise_id from G_A_01005_MONTH_MID2)


select count(0) from   G_A_01005_MONTH_MID2
where trim(enterprise_id)
in 
('89303001207999'
,'89703001246943'
,'89203001064986'
,'89102999091343'
,'89503000055773'
)


delete from G_A_01005_MONTH 
where enterprise_id in 
(select enterprise_id from G_A_01005_MONTH_MID2)


select count(0) from    G_A_01005_MONTH

G_A_01005_MONTH
1
395


select count(0),count(distinct ID) from  G_A_01005_MONTH  
1	2
395	395


select * from   G_A_01005_MONTH

select count(0) from    G_A_01005_MONTH a
,G_A_01005_MONTH_MID2 b 
where a.id = b.id


select count(0) from    G_A_01005_MONTH_MID

select count(0) , count(distinct a.ENTERPRISE_ID||A.ID)
from 
G_A_01005_MONTH a
,G_A_01005_MONTH_MID b 
where a.ENTERPRISE_ID = b.ENTERPRISE_ID 
and a.ID = b.ID



select a.*
from 
G_A_01005_MONTH a
,G_A_01005_MONTH_MID b 
where a.ENTERPRISE_ID = b.ENTERPRISE_ID 
and a.ID = b.ID


select count(0) from    G_A_01005_MONTH_MID

select count(0) from    G_A_01005_MONTH
where id not in (select id from G_I_77780_DAY_DOWN20110429)
 
select count(0) from    G_A_01005_MONTH_MID
where ENTERPRISE_ID not in (select ENTERPRISE_ID from G_A_01005_MONTH_MID2)
 and id in (select id from G_I_77780_DAY_DOWN20110429)



select * from    G_A_01005_MONTH
where trim(ENTERPRISE_ID) not in (select trim(ENTERPRISE_ID) from G_A_01005_MONTH_MID2)
 and id in (select id from G_I_77780_DAY_DOWN20110429)
 
 
 
 select count(0) from   app.g_runlog
 where unit_code = '01005'
 and time_id = 201105
  and return_flag=1 

 
 
 
 select count(0) from   G_A_01005_MONTH
 
 select * from  BASS1.mon_interface_not_empty
 where interface_code = '01005'
 delete from G_A_01005_MONTH 
 
 
 select 'xxxxx',count(0) from app.g_runlog where unit_code = 01005 time_id = 201105 and return_flag=1 with ur  
 
 select * from   bass1.mon_all_interface where interface_code = '02017'
 
 except


 select * from bass1.mon_all_interface

 where interface_code = '21007'
 

 select * from bass1.mon_all_interface where deadline = 15  and type = 'm'
 except
 select a from 
(
select '22049' a from bass2.dual union all
select '22050' a from bass2.dual union all
select '22052' a from bass2.dual union all
select '22055' a from bass2.dual union all
select '22056' a from bass2.dual union all
select '22061' a from bass2.dual union all
select '22063' a from bass2.dual  ) 
 a 

and sts = 1
 


 
 select count(0) from    bass2.STAT_ZD_VILLAGE_USERS_201109
 
 
 



insert into app.sch_control_map
values
 (2,'INT_CHECK_R235_MONTH.tcl','BASS1_INT_CHECK_R235_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R235_MONTH.tcl' PROGRAM_NAME
,'R235.bass' SOURCE_DATA
,'R235._e' OBJECTIVE_DATA
,'R235._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R235_MONTH.tcl','BASS1_G_A_02004_DAY.tcl' from bass2.dual;
INSERT INTO app.sch_control_before 
SELECT 'BASS1_INT_CHECK_R235_MONTH.tcl',
   'BASS1_G_A_02008_DAY.tcl'
FROM bass2.dual;
INSERT INTO app.sch_control_before 
SELECT 'BASS1_INT_CHECK_R235_MONTH.tcl',
   'BASS1_G_S_21003_MONTH.tcl'
FROM bass2.dual;
INSERT INTO app.sch_control_before 
SELECT 'BASS1_INT_CHECK_R235_MONTH.tcl',
   'BASS1_G_S_03004_MONTH.tcl'
FROM bass2.dual;
INSERT INTO app.sch_control_before 
SELECT 'BASS1_EXP_G_S_21003_MONTH',
   'BASS1_INT_CHECK_R235_MONTH.tcl'
FROM bass2.dual;
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_INT_CHECK_R235_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R235_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R235_MONTH.tcl',
   - 1,
   310,
   'R235 03004 校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select count(0) from  G_S_22083_MONTH where time_id = 201105
 select * from   BASS1.G_S_22083_MONTH_1
 
 
 select * from   bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105
 
 
                          select 
                                ext1 sp_id
                                ,ext4 sp_busi_code
                                ,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) cancel_cnt
                                ,0 complaint_cnt
                                from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105  a 
                                where  ext4 is not null 
                                group by 
                                ext1
                                ,ext4
                                having sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) > 0
                         with ur 
        
        

 select count(0) from   bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531

select count(0) from      bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105         

select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105 
group by  OP_TIME 
order by 1 


select count(0) from     bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531 where  date(create_date)='2011-05-31'

select count(0) from     bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531 
1463204
select count(0) from      bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105         
240512


select date(CREATE_DATE) , count(0) 
--,  count(distinct date(CREATE_DATE) ) 
from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105 
group by  date(CREATE_DATE) 
order by 1 


select  date(CREATE_DATE) , count(0) 
--,  count(distinct  date(CREATE_DATE) ) 
from bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531 
where  date(create_date) between  '2011-05-01' and '2011-05-31'
group by   date(CREATE_DATE) 
order by 1 


                SELECT 
                 date('$p_optime') OP_TIME,
                DONE_CODE,
                BILL_ID,
                RSP_SEQ,
                MESSAGE_TYPE,
                SRCTYPE,
                OPTCODE,
                CREATE_DATE,
                FLAG,
                SEND_DATE,
                MSP_END_DATE,
                DONE_DATE,
                CONFIRM_TYPE,
                CONFIRM_CODE,
                RETURN_MESSAGE,
                RETURN_DATE,
                EXTEND_SEQ,
                EXT1,
                EXT2,
                EXT3,
                EXT4
select count(0)                     
        FROM  bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110530
        where  date(create_date)='2011-05-30'
        

select count(0)                     
        FROM  bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531
        where  date(create_date)='2011-05-30'
        
        

                         select 
                                ext1 sp_id
                                ,ext4 sp_busi_code
                                ,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) cancel_cnt
                                ,0 complaint_cnt
                                from  bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531  a 
                                where  RSP_SEQ LIKE '10086901%' 
                                and ext4 is not null 
                                group by 
                                ext1
                                ,ext4
                                having sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) > 0        
                                        
                                        
                                        



drop table  "BASS2   "."DW_HIS_DSMP_SMS_SEND_MESSAGE_YYYYMM" 
CREATE TABLE "BASS2   "."DW_HIS_DSMP_SMS_SEND_MESSAGE_YYYYMM"  (
                  "DONE_CODE" BIGINT NOT NULL , 
                  "BILL_ID" VARCHAR(15) NOT NULL , 
                  "RSP_SEQ" VARCHAR(32) NOT NULL , 
                  "MESSAGE_TYPE" VARCHAR(1) NOT NULL , 
                  "SRCTYPE" VARCHAR(1) , 
                  "OPTCODE" VARCHAR(20) , 
                  "CREATE_DATE" TIMESTAMP , 
                  "FLAG" VARCHAR(2) , 
                  "SEND_DATE" TIMESTAMP , 
                  "MSP_END_DATE" TIMESTAMP , 
                  "DONE_DATE" TIMESTAMP , 
                  "CONFIRM_TYPE" VARCHAR(32) , 
                  "CONFIRM_CODE" VARCHAR(32) , 
                  "RETURN_MESSAGE" VARCHAR(1024) , 
                  "RETURN_DATE" TIMESTAMP , 
                  "EXTEND_SEQ" VARCHAR(48) , 
                  "EXT1" VARCHAR(32) , 
                  "EXT2" TIMESTAMP , 
                  "EXT3" VARCHAR(32) , 
                  "EXT4" VARCHAR(500) )   
                 DISTRIBUTE BY HASH("DONE_CODE")   
                   IN "TBS_ODS_OTHER" INDEX IN "TBS_INDEX" ;
ALTER TABLE "BASS2   "."DW_HIS_DSMP_SMS_SEND_MESSAGE_YYYYMM"
   LOCKSIZE TABLE;
DELETE 
FROM bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105 
WHERE OP_TIME = DATE('2011-05-31');
INSERT INTO bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105(
   OP_TIME,
   DONE_CODE,
   BILL_ID,
   RSP_SEQ,
   MESSAGE_TYPE,
   SRCTYPE,
   OPTCODE,
   CREATE_DATE,
   FLAG,
   SEND_DATE,
   MSP_END_DATE,
   DONE_DATE,
   CONFIRM_TYPE,
   CONFIRM_CODE,
   RETURN_MESSAGE,
   RETURN_DATE,
   EXTEND_SEQ,
   EXT1,
   EXT2,
   EXT3,
   EXT4 
) 
                SELECT DATE('2011-05-31') OP_TIME,
                   DONE_CODE,
                   BILL_ID,
                   RSP_SEQ,
                   MESSAGE_TYPE,
                   SRCTYPE,
                   OPTCODE,
                   CREATE_DATE,
                   FLAG,
                   SEND_DATE,
                   MSP_END_DATE,
                   DONE_DATE,
                   CONFIRM_TYPE,
                   CONFIRM_CODE,
                   RETURN_MESSAGE,
                   RETURN_DATE,
                   EXTEND_SEQ,
                   EXT1,
                   EXT2,
                   EXT3,
                   EXT4 
        FROM bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531 
        WHERE DATE(create_date) = '2011-05-31' ;
drop table  bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105 
        create table bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105 like bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_YYYYMM
                 in tbs_ods_other
                 index in tbs_index partitioning key (done_code) using hashing not logged initially;
insert into bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105
                                select
         DONE_CODE
        ,BILL_ID
        ,RSP_SEQ
        ,MESSAGE_TYPE
        ,SRCTYPE
        ,OPTCODE
        ,CREATE_DATE
        ,FLAG
        ,SEND_DATE
        ,MSP_END_DATE
        ,DONE_DATE
        ,CONFIRM_TYPE
        ,CONFIRM_CODE
        ,RETURN_MESSAGE
        ,RETURN_DATE
        ,EXTEND_SEQ
        ,EXT1
        ,EXT2
        ,EXT3
        ,EXT4
 from bass2.ODS_HIS_DSMP_SMS_SEND_MESSAGE_20110531 

select count(0) from     bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201105


select count(0) from     BASS1.G_S_22083_MONTH_1
                                        
                                        

select count(0) from      BASS1.G_S_22083_MONTH_3
                                       
                                       
select count(0) from     BASS1.G_S_22083_MONTH_4
                                       
                                       
select count(0) from    bass1.G_S_22083_MONTH where time_id = 201104

select * from    bass1.G_S_22083_MONTH
where BUSI_NAME like '%Thatsmysh%'

select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
,sum(bigint(CANCEL_CNT))
,sum(bigint(COMPLAINT_CNT))

,sum(bigint(ORDER_CNT))

from bass1.G_S_22083_MONTH 
group by  TIME_ID 
order by 1 
                                       
                                       



insert into app.sch_control_map
values
 (2,'INT_CHECK_R230_MONTH.tcl','BASS1_INT_CHECK_R230_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R230_MONTH.tcl' PROGRAM_NAME
,'R230.bass' SOURCE_DATA
,'R230._e' OBJECTIVE_DATA
,'R230._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R230_MONTH.tcl','BASS1_G_I_21020_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R230_MONTH.tcl','BASS1_G_S_22073_DAY.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_I_21020_MONTH','BASS1_INT_CHECK_R230_MONTH.tcl' from bass2.dual


delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R230_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R230_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R230_MONTH.tcl',
   - 1,
   310,
   'R230 - R234 21020 校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
select * from   bass2.dw_comp_cust_20110501 union all 
select * from   bass2.dw_comp_cust_20110501 union all 






                                select  a.COMP_PRODUCT_NO from    
                                table (
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201104
                                except 
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201105
                                ) a , BASS1.G_I_21020_MONTH_calendar b 
                                where 
                                (days(date(date2))-
                                 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                                   and b.date_seq like '201105%'

union 
                         
                         select a.COMP_PRODUCT_NO from   
                        ( 
                         select COMP_PRODUCT_NO,COMP_LAST_DATE
                         from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '031000' 
                        ) a 
                        ,
                        (
                         select COMP_PRODUCT_NO,COMP_BEGIN_DATE
                         from G_I_21020_MONTH where time_id = 201105 and  COMP_BRAND_ID = '031000' 
                        ) b 
                        ,BASS1.G_I_21020_MONTH_calendar c
                        where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
                        and 
                        (days(date(date2))-
                         days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                         and  char(COMP_BEGIN_DATE  ) > char(date_seq)
                          and c.date_seq like '201105%'
except                          
select distinct COMP_PRODUCT_NO
from
(
select * from   bass2.dw_comp_cust_20110501 union all
select * from   bass2.dw_comp_cust_20110502 union all
select * from   bass2.dw_comp_cust_20110503 union all
select * from   bass2.dw_comp_cust_20110504 union all
select * from   bass2.dw_comp_cust_20110505 union all
select * from   bass2.dw_comp_cust_20110506 union all
select * from   bass2.dw_comp_cust_20110507 union all
select * from   bass2.dw_comp_cust_20110508 union all
select * from   bass2.dw_comp_cust_20110509 union all
select * from   bass2.dw_comp_cust_20110510 union all
select * from   bass2.dw_comp_cust_20110511 union all
select * from   bass2.dw_comp_cust_20110512 union all
select * from   bass2.dw_comp_cust_20110513 union all
select * from   bass2.dw_comp_cust_20110514 union all
select * from   bass2.dw_comp_cust_20110515 union all
select * from   bass2.dw_comp_cust_20110516 union all
select * from   bass2.dw_comp_cust_20110517 union all
select * from   bass2.dw_comp_cust_20110518 union all
select * from   bass2.dw_comp_cust_20110519 union all
select * from   bass2.dw_comp_cust_20110520 union all
select * from   bass2.dw_comp_cust_20110521 union all
select * from   bass2.dw_comp_cust_20110522 union all
select * from   bass2.dw_comp_cust_20110523 union all
select * from   bass2.dw_comp_cust_20110524 union all
select * from   bass2.dw_comp_cust_20110525 union all
select * from   bass2.dw_comp_cust_20110526 union all
select * from   bass2.dw_comp_cust_20110527 union all
select * from   bass2.dw_comp_cust_20110528 union all
select * from   bass2.dw_comp_cust_20110529 union all
select * from   bass2.dw_comp_cust_20110530 union all
select * from   bass2.dw_comp_cust_20110531 
) t 
where comp_day_off_mark=1
 and comp_brand_id in (9,10,11)
 
 
 
 select * from  G_I_21020_MONTH where COMP_PRODUCT_NO =  '13308911955    '
 
     
 
 
 
 select  *
from
(
select * from   bass2.dw_comp_cust_20110501 union all
select * from   bass2.dw_comp_cust_20110502 union all
select * from   bass2.dw_comp_cust_20110503 union all
select * from   bass2.dw_comp_cust_20110504 union all
select * from   bass2.dw_comp_cust_20110505 union all
select * from   bass2.dw_comp_cust_20110506 union all
select * from   bass2.dw_comp_cust_20110507 union all
select * from   bass2.dw_comp_cust_20110508 union all
select * from   bass2.dw_comp_cust_20110509 union all
select * from   bass2.dw_comp_cust_20110510 union all
select * from   bass2.dw_comp_cust_20110511 union all
select * from   bass2.dw_comp_cust_20110512 union all
select * from   bass2.dw_comp_cust_20110513 union all
select * from   bass2.dw_comp_cust_20110514 union all
select * from   bass2.dw_comp_cust_20110515 union all
select * from   bass2.dw_comp_cust_20110516 union all
select * from   bass2.dw_comp_cust_20110517 union all
select * from   bass2.dw_comp_cust_20110518 union all
select * from   bass2.dw_comp_cust_20110519 union all
select * from   bass2.dw_comp_cust_20110520 union all
select * from   bass2.dw_comp_cust_20110521 union all
select * from   bass2.dw_comp_cust_20110522 union all
select * from   bass2.dw_comp_cust_20110523 union all
select * from   bass2.dw_comp_cust_20110524 union all
select * from   bass2.dw_comp_cust_20110525 union all
select * from   bass2.dw_comp_cust_20110526 union all
select * from   bass2.dw_comp_cust_20110527 union all
select * from   bass2.dw_comp_cust_20110528 union all
select * from   bass2.dw_comp_cust_20110529 union all
select * from   bass2.dw_comp_cust_20110530 union all
select * from   bass2.dw_comp_cust_20110531 
) t 
where  COMP_PRODUCT_NO =  '13308910257    '

select * from   bass2.dw_comp_cust_201105
where  COMP_PRODUCT_NO =  '13308910257    '

select * from    bass1.g_i_21020_month
where time_id = 201105 and COMP_PRODUCT_NO =  '13308910257    '




                                select  * from    
                                table (
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201104
                                except 
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201105
                                ) a , BASS1.G_I_21020_MONTH_calendar b 
                                where 
                                (days(date(date2))-
                                 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                                   and b.date_seq like '201105%'

and  COMP_PRODUCT_NO =  '13308910257        '


13308910257



 				select count(distinct COMP_PRODUCT_NO)  from    
				table (
				select COMP_PRODUCT_NO,COMP_LAST_DATE
				from         G_I_21020_MONTH
				where COMP_BRAND_ID = '031000' 
				and time_id = 201104
				and  COMP_PRODUCT_NO not in (
				select COMP_PRODUCT_NO
				from         G_I_21020_MONTH
				where COMP_BRAND_ID = '031000' 
				and time_id = 201105
				)
				) a , (select * from  BASS1.G_I_21020_MONTH_calendar where date_seq like '201105%') b 
				where 
				(days(date(date2))-
				 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
				   
                   
values ((9479+510)*1.000/9989 - 1)





insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201105


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201105

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 





insert into app.sch_control_map
values
 (2,'INT_CHECK_R208_MONTH.tcl','BASS1_INT_CHECK_R208_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R208_MONTH.tcl' PROGRAM_NAME
,'R208.bass' SOURCE_DATA
,'R208._e' OBJECTIVE_DATA
,'R208._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R208_MONTH.tcl','BASS1_G_S_22303_MONTH.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_S_22303_MONTH','BASS1_INT_CHECK_R208_MONTH.tcl' from bass2.dual


delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R208_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R208_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R208_MONTH.tcl',
   - 1,
   310,
   'R208 - R214 22303 校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
delete from  app.sch_control_map
where PROGRAM_NAME = 'INT_CHECK_R211_MONTH.tcl'

insert into app.sch_control_map
values
 (2,'INT_CHECK_R211_MONTH.tcl','BASS1_INT_CHECK_R211_MONTH.tcl')

delete from  bass1.int_program_data where PROGRAM_NAME = 'INT_CHECK_R211_MONTH.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R211_MONTH.tcl' PROGRAM_NAME
,'R211.bass' SOURCE_DATA
,'R211._e' OBJECTIVE_DATA
,'R211._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'
delete from app.sch_control_before  where control_code = 'BASS1_INT_CHECK_R211_MONTH.tcl'
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R211_MONTH.tcl','BASS1_G_S_22204_MONTH.tcl' from bass2.dual

delete from app.sch_control_before  where before_control_code = 'BASS1_INT_CHECK_R211_MONTH.tcl'
insert into app.sch_control_before 
select 'BASS1_EXP_G_S_22204_MONTH','BASS1_INT_CHECK_R211_MONTH.tcl' from bass2.dual


delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R211_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R211_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R211_MONTH.tcl',
   - 1,
   310,
   'R211 - R228 22204 校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
insert into app.sch_control_map
values
 (2,'INT_CHECK_R221_MONTH.tcl','BASS1_INT_CHECK_R221_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R221_MONTH.tcl' PROGRAM_NAME
,'R221.bass' SOURCE_DATA
,'R221._e' OBJECTIVE_DATA
,'R221._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R221_MONTH.tcl','BASS1_G_S_22204_MONTH.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_S_22204_MONTH','BASS1_INT_CHECK_R221_MONTH.tcl' from bass2.dual



delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R221_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_INT_CHECK_R221_MONTH.tcl',
   2,
   2,
   'int -s INT_CHECK_R221_MONTH.tcl',
   - 1,
   310,
   'R221 - R228 22204 校验',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
delete from app.sch_control_alarm where control_code = 'BASS1_INT_CHECK_R221_MONTH.tcl'




select tabschema,tabname from syscat.tables where tabname like '%DWD_PRODUCT_SPROM_ACTIVE%'                      

select tabschema,tabname from syscat.tables where tabname like '%DWD_PRODUCT_SPROM_%HIS%'                      

select tabschema,tabname from syscat.tables where tabname like '%DWD_I_USER_RADIUS_ORDER%'                      

select tabschema,tabname from syscat.tables where tabname like '%DWD_PRODUCT_FUNC_%'                      


drop table bass2.DW_PRODUCT_BASS1_20110523
drop table bass2.DW_PRODUCT_BASS1_20110524
drop table bass2.DW_PRODUCT_BASS1_20110525
drop table bass2.DW_PRODUCT_BASS1_20110526
drop table bass2.DW_PRODUCT_BASS1_20110527
drop table bass2.DW_PRODUCT_BASS1_20110528
drop table bass2.DW_PRODUCT_BASS1_20110529
drop table bass2.DW_PRODUCT_BASS1_20110530
drop table bass2.DW_PRODUCT_BASS1_20110531



select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'DW_PRODUCT_BASS1_20110901'


dwd_product_sprom_active_




drop table BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110401 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110402 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110403 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110404 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110405 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110406 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110407 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110408 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110409 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110410 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110411 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110412 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110413 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110414 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110415 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110416 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110417 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110418 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110419 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110420 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110421 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110422 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110423 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110424 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110425 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110426 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110427 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110428 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110429 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110501 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110502 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110503 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110504 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110505 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110506 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110507 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110508 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110509 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110510 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110511 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110512 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110513 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110514 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110515 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110516 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110517 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110518 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110519 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110520 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110521 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110522 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110523 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110524 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110525 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110526 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110527 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110528 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110529 ;
DROP TABLE BASS2.DWD_PRODUCT_SPROM_ACTIVE_20110530 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110530 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110529 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110528 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110527 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110526 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110525 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110524 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110523 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110522 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110521 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110520 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110519 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110518 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110517 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110516 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110515 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110514 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110513 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110512 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110511 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110510 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110509 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110508 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110507 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110506 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110505 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110504 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110503 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110502 ;
DROP TABLE bass2.dwd_PRODUCT_SPROM_HISTORY_20110501 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110501 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110502 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110503 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110504 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110505 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110506 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110507 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110508 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110509 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110510 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110511 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110512 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110513 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110514 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110515 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110516 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110517 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110518 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110519 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110520 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110521 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110522 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110523 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110524 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110525 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110526 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110527 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110528 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110529 ;
DROP TABLE bass2.dwd_I_USER_RADIUS_ORDER_20110530 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110501 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110502 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110503 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110504 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110505 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110506 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110507 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110508 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110509 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110510 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110511 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110512 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110513 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110514 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110515 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110516 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110517 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110518 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110519 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110520 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110521 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110522 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110523 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110524 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110525 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110526 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110527 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110528 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110529 ;
DROP TABLE bass2.dwd_PRODUCT_FUNC_20110530 ;
select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	

select * from   where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
)



--重运出数代码
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月8日前'
)

                                              
select * from   app.sch_control_task where control_code  

update  app.sch_control_runlog 
set flag = -2 
where control_code 
in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月8日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
		and date(endtime) <= current date
		and month(endtime)  = month(current timestamp)
)


select * from   BASS1.MON_ALL_INTERFACE a
where INTERFACE_CODE in ('02006','21008','03005','03004','21003')                                              



--重运导出程序
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月8日前'
                                and INTERFACE_CODE not in ('02006','21008','03005','03004','21003')
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)

                                              
                                              


#update G_I_21020_MONTH 
#set CALL_COUNTS = char(int(rand(1)*5+1))
#where (
#char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
#and CALL_COUNTS = '0'
#and SMS_COUNTS = '0'
#and MMS_COUNTS = '0'
#and time_id = $op_month )
                                              




update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201109 )

select * from   G_I_02006_MONTH where time_id = 201109






select * from   g_s_22081_month where time_id = 201105




select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
,sum(bigint(CANCEL_CNT))
,sum(bigint(COMPLAINT_CNT))
,sum(bigint(ORDER_CNT))
from g_s_22081_month 
group by  TIME_ID 
order by 1 


select * from   BASS2.DW_THREE_ITEM_STAT_DM_201105


select tabname from syscat.tables where tabname like '%THREE_ITEM%'   


select sum(MW_TUIFEI) from    BASS2.DW_THREE_ITEM_STAT_DM_201105



select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
,sum(bigint(CANCEL_CNT))
,sum(bigint(COMPLAINT_CNT))
,sum(bigint(ORDER_CNT))
from g_s_22083_month 
group by  TIME_ID 
order by 1 




select time_id / 100 , count(0) 
--,  count(distinct time_id / 100 ) 
,sum(bigint(M_OFF_USERS))
from G_S_22012_DAY 
group by  time_id / 100 
order by 1 desc

values (61053*1.000/60747 -1)






declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201105 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201105 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')




                select val1*1.00/val2 val
                from 
                (
                select count(0) val1 from    
                 session.int_check_user_status a
                 where not exists (select 1 from bass1.g_s_03004_month b  where  b.time_id = 201105 AND a.user_id= b.USER_ID )
                 and a.usertype_id  IN ('1010')
                 ) a
                 ,
                 (select count(0) val2 from   session.int_check_user_status a 
                  where a.usertype_id  IN ('1010')
                  ) b 
 
 
 select * from    bass1.MON_ALL_INTERFACE 
where type = 'm'
and deadline = 8
and  interface_code  in 
(select substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1)





select substr(rule_code,6) seq
,case 
    when rule_code = 'R161_1' then '新增客户数'
    when rule_code = 'R161_2' then '客户到达数'
    when rule_code = 'R161_3' then '净增客户数'
    when rule_code = 'R161_4' then '通信客户数'
    when rule_code = 'R161_5' then '当月累计通信客户数'
    when rule_code = 'R161_6' then '使用TD网络的客户数'
    when rule_code = 'R161_7' then '当月累计使用TD网络的手机客户数'
    when rule_code = 'R161_8' then '当月累计使用TD网络的信息机客户数'
    when rule_code = 'R161_9' then '当月累计使用TD网络的数据卡客户数'
    when rule_code = 'R161_10' then '当月累计使用TD网络的上网本客户数'
    when rule_code = 'R161_11' then '联通移动客户总数'
    when rule_code = 'R161_12' then '电信移动客户总数'
    when rule_code = 'R161_13' then '联通移动新增客户数'
    when rule_code = 'R161_14' then '电信移动新增客户数'
    when rule_code = 'R161_15' then '使用TD网络的客户在T网上计费时长'
    when rule_code = 'R161_16' then '使用TD网络的客户在T网上的数据流量'
    when rule_code = 'R161_17' then '离网客户数'
else '0'
end rule_name
,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0'
end IF_OK
 from 
bass1.g_rule_check a 
where rule_code like 'R161_%'
and time_id = 20110905
order by CASE WHEN LENGTH(rule_code) =  7 
THEN 'S'||rule_code 
ELSE rule_code END 
asc 



select 
 time_id,
 case when rule_code='R159_1' then '新增客户数'
      when rule_code='R159_2' then '客户到达数'
      when rule_code='R159_3' then '上网本客户数'
      when rule_code='R159_4' then '离网客户数'
 end,
 target1,
 target2,
 target3
from bass1.g_rule_check
where rule_code in ('R159_1','R159_2','R159_3','R159_4')
  and time_id=20110903
  


select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end rule_name,
         target1,
         target2,
         target3*100
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
    and time_id= 20110906
    
    
select * from   app.sch_control_task where control_code = 'BASS1_INT_CHECK_INDEX_WAVE_DAY.tcl'
    

select tabname from syscat.tables where tabname like 'DIM%OPT%'       

   select * from     bass2.DIM_SO_BUSIOPTCODE_MAPPING
DIM_PUB_CROPTYPE
DIM_OPTYPE

select 
         201105 TIME_ID
        ,201105 OP_MONTH
        ,count(distinct case when opt_code in ('4103') then payment_id end )  COUNTER_REC_CNT
        ,count(distinct case when opt_code in ('4468') then payment_id end ) EBANK_REC_CNT
        ,count( distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144'  OTH_REC_CNT
        ,sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144') then AMOUNT end )  COUNTER_REC_FEE
        ,sum( case when opt_code in ('4468')  then AMOUNT end ) EBANK_REC_FEE
        ,0 OTH_REC_FEE
        , SUM(AMOUNT*0.01) REWARD_FEE
from bass2.dw_acct_payment_dm_201105
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')


       
select  201105 time_id
, 201105 time_id
, count(
count(0),SUM(AMOUNT)
from bass2.dw_acct_payment_dm_201105 b
where                                          
 b.opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')
 group by opt_code
 
 select tabname from syscat.tables where tabname like '%CHANNEL%PAY%'  
 
 
 select * from  bass2.dw_acct_payment_dm_201105 b
 where PAYMENT_Id = '110502161352A738883390895'
 where 
 ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')
 
 SELECT * FROM base.cfg_operation @dbl_ggdb
WHERE opt_code='4468'

select * from   
bass2.dw_channel_rule_mm 


select sum(pre_fee),sum(fee),fee/pre_fee from    bass2.stat_channel_reward_0006 
WHERE OP_TIME = 201005

select distinct fee*1.00/pre_fee from    bass2.stat_channel_reward_0006 
WHERE OP_TIME = 201005
and pre_fee > 0
1
0.010000000000000000000
0.020000000000000000000


select  fee*1.00/pre_fee , count(0) from    bass2.stat_channel_reward_0006 
where pre_fee > 0 and  OP_TIME = 201005
group by  fee*1.00/pre_fee


select * from BASS2.Dw_acct_payitem_201105

select OP_TIME,count(distinct USER_ID)
 from bass1.int_22038_201109
 group by OP_TIME
 
 
 	             select count(distinct
	               user_id)
                from bass2.cdr_call_dtl_20110906
                

                
                
                
                
	             select count( distinct
	               user_id)
                from bass2.cdr_sms_dtl_20110905
               where calltype_id=0
                 and svcitem_id in (200001,200002,200003,200004,200005,200006)
                 
                 
                 
select 
         201105 TIME_ID
        ,201105 OP_MONTH
        ,count(distinct case when opt_code in ('4103') then payment_id end )  COUNTER_REC_CNT
        ,count(distinct case when opt_code in ('4468') then payment_id end ) EBANK_REC_CNT
        ,count( distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then payment_id end )   OTH_REC_CNT
        ,sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144') then AMOUNT end )  COUNTER_REC_FEE
        ,sum( case when opt_code in ('4468')  then AMOUNT end ) EBANK_REC_FEE
        ,sum( distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then AMOUNT end )   OTH_REC_CNT
 OTH_REC_FEE
        , SUM(AMOUNT*0.01) REWARD_FEE
from bass2.dw_acct_payment_dm_201105
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')
                 
                 

select 
         201105 TIME_ID
        ,201105 OP_MONTH
        ,count(distinct case when opt_code in ('4103') then payment_id end )  COUNTER_REC_CNT
        ,count(distinct case when opt_code in ('4468') then payment_id end ) EBANK_REC_CNT
        ,count( distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then payment_id end )   OTH_REC_CNT
        ,sum( case when opt_code in ('4103') then AMOUNT end )  COUNTER_REC_FEE
        ,sum( case when opt_code in ('4468')  then AMOUNT end ) EBANK_REC_FEE
        ,sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then AMOUNT end )   OTH_REC_CNT
 OTH_REC_FEE
        , SUM(AMOUNT*0.01) REWARD_FEE
from bass2.dw_acct_payment_dm_201105
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')


select 
         201105 TIME_ID
        ,201105 OP_MONTH
        ,count(distinct case when opt_code in ('4103') then payment_id end )  COUNTER_REC_CNT
        ,count(distinct case when opt_code in ('4468') then payment_id end ) EBANK_REC_CNT
        ,count(distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then payment_id end ) OTH_REC_CNT
        ,sum( case when opt_code in ('4103') then AMOUNT end )  COUNTER_REC_FEE
        ,sum( case when opt_code in ('4468')  then AMOUNT end ) EBANK_REC_FEE
        ,sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then AMOUNT end ) OTH_REC_FEE
        , SUM(AMOUNT*0.01) REWARD_FEE
from bass2.dw_acct_payment_dm_201105
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')



select 
         201105 TIME_ID
        ,201105 OP_MONTH
        ,count(distinct case when opt_code in ('4103') then payment_id end )  COUNTER_REC_CNT
        ,count(distinct case when opt_code in ('4468') then payment_id end ) EBANK_REC_CNT
        ,count(distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then payment_id end ) OTH_REC_CNT
        ,sum( case when opt_code in ('4103') then AMOUNT else 0 end )  COUNTER_REC_FEE
        ,sum( case when opt_code in ('4468')  then AMOUNT else 0 end ) EBANK_REC_FEE
        ,sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then AMOUNT else 0 end ) OTH_REC_FEE
        , SUM(AMOUNT*0.01) REWARD_FEE
from bass2.dw_acct_payment_dm_201105
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')


select * from   bass2.dw_channel_rule_mm
                 
                 
select * from   bass2.dw_channel_rule_info_mm


				select  a.rule_id
               ,a.cond_expr
               ,a.compute_expr
               ,replace(replace(replace(replace(replace(replace(replace(cond_expr,'EXT1','a.EXT1'),'BRAND','a.BRAND'),'USE_MONTHS','a.USE_MONTHS'),'USER_TYPE','a.USER_TYPE'),'PRE_FEE','a.PRE_FEE'),'CHANNEL_TYPE','a.CHANNEL_TYPE'),'GEOGRAPHY_TYPE','a.GEOGRAPHY_TYPE')
               ,replace(compute_expr,'PRE_FEE','a.PRE_FEE')
        from bass2.dw_channel_rule_mm a,bass2.dw_channel_rule_info_mm  b
        where a.rule_info_id=b.rule_info_id  and  b.rule_type='1' and a.data_status=1 and b.data_status=1
              and a.op_time='2011-05-01'  and b.op_time='2011-05-01'
              
              
              select * from G_S_22083_MONTH where time_id = 201105 and BUSI_BILLING_TYPE = '20'
order by bigint(order_cnt) desc

select TIME_ID , count(0) g
--,  count(distinct TIME_ID ) 
from G_S_22083_MONTH 
group by  TIME_ID 
order by 1 

              
              

                 
201105	201105	30820002            	2                                         	                                	20	16          	0           	0         

                               select * from G_S_22083_MONTH where time_id = 201105
                               and BUSI_CODE = '700002614000        '
                               
                               
                               
select * from    bass1.G_S_22083_MONTH
                               
                               
select * from    bass2.DIM_PM_SP_OPERATOR_CODE
where OPERATOR_NAME like '%福州卓龙天讯信息技术%'
select * from   BASS1.G_S_22083_MONTH_3 where
sp_name like '%福州卓龙天讯信息技术%'                               


SP_CODE
913030
701167

select * from    bass1.G_S_22083_MONTH_1 
WHERE SP_ID IN ('913030','701167')



select 
        201105 TIME_ID
        ,'$op_month' OP_MONTH
        ,'700002614000' BUSI_CODE
        ,'魔戒传说T' BUSI_NAME
        ,'701167' SP_CODE
        ,'福州卓龙天讯信息技术有限公司' BACK_SP_NAME
        ,'20' BILLING_TYPE
        ,'0' BACK_USER_CNT
        ,'0' ORDER_USER_CNT
				from bass2.dual
			 with ur 
             
             
             

select interface_code from bass1.mon_all_interface 
where deadline = 8 
except 

select unit_code
FROM 
(
    select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code              


select * from    app.g_unit_info

select * from   G_S_22086_MONTH


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22086_MONTH.tcl'

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22086_MONTH.tcl' PROGRAM_NAME
,'G_S_22086_MONTH.BASS1' SOURCE_DATA
,'G_S_22086_MONTH_e' OBJECTIVE_DATA
,'G_S_22086_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

delete from app.sch_control_before where control_code = 'BASS1_G_S_22086_MONTH.tcl'

insert into app.sch_control_before values('BASS1_G_S_22086_MONTH.tcl','BASS2_Dw_product_ms.tcl');
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22086';
INSERT INTO app.g_unit_info 
VALUES(
   '22086',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22086_month',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22086_MONTH', 'BASS1_G_S_22086_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22086_MONTH.tcl',
   2,
   2,
   'int -s G_S_22086_MONTH.tcl',
   0,
   - 1,
   '收费争议先退费后查证月汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22086_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22086_MONTH LASTMONTH()',
   0,
   - 1,
   '收费争议先退费后查证月汇总导出',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22086';
INSERT INTO app.g_unit_info 
VALUES(
   '22086',
   1,
   '收费争议先退费后查证月汇总 ',
   'bass1.g_s_22086_month',
   1,
   0,
   0
   );
COMMIT;
select * from   app.sch_control_map


insert into app.sch_control_map
values
(2,'EXP_G_S_22086_MONTH','BASS1_EXP_G_S_22086_MONTH')





insert into app.sch_control_map
values
 (2,'G_S_22086_MONTH.tcl','BASS1_G_S_22086_MONTH.tcl')

insert into app.sch_control_map
values
(2,'EXP_G_S_22086_MONTH','BASS1_EXP_G_S_22086_MONTH')



insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22086_MONTH.tcl' PROGRAM_NAME
,'G_S_22086_MONTH.BASS1' SOURCE_DATA
,'G_S_22086_MONTH_e' OBJECTIVE_DATA
,'G_S_22086_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'



--调度配置
--BASS2_Dw_product_ms.tcl
insert into app.sch_control_before values('BASS1_G_S_22086_MONTH.tcl','BASS2_Dw_product_ms.tcl');
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22086_MONTH.tcl',
   'BASS2_Dw_product_ms.tcl'
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_EXP_G_S_22086_MONTH',
   'BASS1_G_S_22086_MONTH.tcl'
   );
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22086_MONTH', 'BASS1_G_S_22086_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22086_MONTH.tcl',
   2,
   2,
   'int -s G_S_22086_MONTH.tcl',
   0,
   - 1,
   '收费争议先退费后查证月汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22086_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22086_MONTH LASTMONTH()',
   0,
   - 1,
   '收费争议先退费后查证月汇总导出',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22086';
INSERT INTO app.g_unit_info 
VALUES(
   '22086',
   1,
   '收费争议先退费后查证月汇总 ',
   'bass1.g_s_22086_month',
   1,
   0,
   0
   );
COMMIT;
select * from   G_S_22086_MONTH


select * from   bass2.dim_prod_up_product_item 
WHERE supplier_id = '701167'



select * from    BASS1.G_S_22083_MONTH_4


select time_id , count(0) 
--,  count(distinct time_id ) 
,sum(bigint(ORDER_CNT))
from bass1.G_S_22081_MONTH 
group by  time_id 
order by 1 

select * from    bass1.G_S_22081_MONTH 


                        select 
                           b.SUPPLIER_ID sp_id
                          ,b.EXTEND_ID2 BUSI_CODE
                                ,max(a.order_cnt) order_cnt
                                  from (
                                                select OFFER_ID,count(0)  order_cnt
                                                from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201105 p ,
                                                (select distinct user_id from bass2.dw_product_201105 
                                                        where userstatus_id in (1,2,3,6,8)
                                                and usertype_id in (1,2,9) 
                                        ) u
                                                where substr(replace(char(date(VALID_DATE)),'-',''),1,6) <= '201105'
                                                and expire_date >  '2011-05-01'
                                                and p.PRODUCT_INSTANCE_ID = u.user_id
                                                group by OFFER_ID
                                        ) a ,
                                        (
                                                SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name 
                                                 FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                                WHERE ITEM_TYPE='OFFER_PLAN'
                                                  AND DEL_FLAG='1'
                                                  AND SUPPLIER_ID IS NOT NULL
                                        ) b 
                                where a.OFFER_ID = b.PRODUCT_ITEM_ID
                                group by 
                                 b.SUPPLIER_ID 
                          ,b.EXTEND_ID2 
                         with ur 
                         


                                                select substr(replace(char(date(VALID_DATE)),'-',''),1,6)
                                                from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201105 p ,
                                                (select distinct user_id from bass2.dw_product_201105 
                                                        where userstatus_id in (1,2,3,6,8)
                                                and usertype_id in (1,2,9) 
                                        ) u
                                                where substr(replace(char(date(VALID_DATE)),'-',''),1,6) <= '201105'
                                                and expire_date >  '2011-05-01'
                                                and p.PRODUCT_INSTANCE_ID = u.user_id
                                                
                                                

select time_id , count(0) 
--,  count(distinct time_id ) 
,sum(bigint(ORDER_CNT))
from bass1.G_S_22081_MONTH 
group by  time_id 
order by 1 



select INTERFACE_CODE from bass1.mon_all_interface where deadline <=8 and type = 'm'
                                              
except                                                
select substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1


                                                
select * from bass1.mon_all_interface where deadline =15 and type = 'm'


select * from bass1.mon_all_interface where  type = 'm' AND interface_code = '22068'

                                                

select count(*) from bass1.g_i_06022_month
where  time_id =201105
 channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201105 )
  and time_id =201105

                                                
                                                

select count(*) from bass1.g_i_06022_month where  time_id =201105
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201105 )
  and time_id =201105

                                                

select * from                                                   
                                               
select count(*) from bass1.g_i_06021_month  where  time_id =201105
where channel_id not in
(select distinct channel_id from bass1.g_i_06022_month where time_id =201105)
  and time_id =201105
  and channel_type <>'3'
  and channel_status='1'
  
  
select count(*) from bass1.g_i_06023_month  where  time_id =201105
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201105 )
  and time_id =201105




select count(*) from bass1.g_i_06021_month  where  time_id =201105
where channel_id not in
(select distinct channel_id from bass1.g_i_06023_month where time_id =201105)
  and time_id =201105
  and channel_status='1'


select count(*) from bass1.g_s_22061_month  where  time_id =201105
where channel_id not in 
(select distinct channel_id from bass1.g_i_06021_month where time_id =201105 )
  and time_id =201105
  
  
  
  
  CONTROL_CODE
BASS1_EXP_G_S_22063_MONTH
BASS1_EXP_G_S_22061_MONTH
BASS1_EXP_G_I_06023_MONTH
BASS1_EXP_G_I_06022_MONTH
BASS1_EXP_G_I_06021_MONTH



G_S_22063_MONTH
G_S_22061_MONTH
G_I_06023_MONTH
G_I_06022_MONTH
G_I_06021_MONTH



select count(0) from G_S_22063_MONTH where time_id = 201105
select count(0) from G_S_22061_MONTH where time_id = 201105
select count(0) from G_I_06023_MONTH where time_id = 201105
select count(0) from G_I_06022_MONTH where time_id = 201105
select count(0) from G_I_06021_MONTH where time_id = 201105








	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月15日前'
	union all
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月15日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)	
	union all 
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月15日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)	
	






update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
	select b.CONTROL_CODE 
	from    
	BASS1.MON_ALL_INTERFACE a
	, app.sch_control_task b 
	where a.INTERFACE_CODE = substr(control_code , 11,5)
		and a.TYPE = 'm'
		and b.control_code like '%MONTH%'
		and upload_time = '每月15日前'
)
and  flag = 0 






--重运校验代码
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
		(
				select distinct control_code from   app.sch_control_before 
				where  before_control_code in 
				   (
						select b.CONTROL_CODE from    
						BASS1.MON_ALL_INTERFACE a
						, app.sch_control_task b 
							where a.INTERFACE_CODE = substr(control_code , 11,5)
							and a.TYPE = 'm'
							and b.control_code like '%MONTH%'
							and upload_time = '每月15日前'
						)
				and control_code like '%CHECK%'
				and  control_code in (select control_code from app.sch_control_task where cc_flag = 1)
		)
		and flag = 0
)




--重运导出程序
update  app.sch_control_runlog 
set flag = -2 
where control_code in 
(
		select control_code from app.sch_control_runlog 
		where control_code in 
						(
						select distinct control_code from   app.sch_control_before 
						where  before_control_code in 
							 (
							    select b.CONTROL_CODE from    
							    BASS1.MON_ALL_INTERFACE a
							    , app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
							    and a.TYPE = 'm'
							    and b.control_code like '%MONTH%'
							    and upload_time = '每月15日前'
						    )
						    and control_code like 'BASS1%EXP%'
						)
		and flag = 0
		and date(endtime) <= current date 
		and month(endtime)  = month(current timestamp)
)
and control_code not in ('BASS1_EXP_G_S_05001_MONTH','BASS1_EXP_G_S_05002_MONTH')




select * from   G_S_22073_DAY where time_id = 20110905
select 
bigint(TEL_133_LOST_CNT) +	bigint(TEL_189_LOST_CNT)	+ bigint(TEL_NET_LOST_CNT) +	
bigint(TEL_FIX_LOST_CNT)
from   G_S_22073_DAY where time_id = 20110905


151       	201       	109       	215       


select 
 bigint(TEL_NET_LOST_CNT) +	
bigint(TEL_FIX_LOST_CNT)+ bigint(TEL_MOBILE_LOST_CNT)
from   G_S_22073_DAY where time_id = 20110906



select time_id,
 bigint(TEL_NET_LOST_CNT) +	
bigint(TEL_FIX_LOST_CNT)+ bigint(TEL_MOBILE_LOST_CNT)
from   G_S_22073_DAY 
where time_id in (20110905,20110906)
order by time_id desc 
TIME_ID	2
20110906	1165
20110905	713



select date('2011-06-06') - 90 days from bass2.dual

1
2011-03-08 



select time_id,
 bigint(TEL_NET_LOST_CNT) +	
bigint(TEL_FIX_LOST_CNT)+ bigint(TEL_MOBILE_LOST_CNT)
from   G_S_22073_DAY 
order by 2 desc 



select char(count(distinct comp_product_no)) c51
from bass2.Dw_comp_cust_dt
where comp_day_off_mark=1
 and comp_brand_id in (9,10,11,1,2,8)
 
 
select char(count(distinct comp_product_no)) c51
from bass2.Dw_comp_cust_20110905
where comp_day_off_mark=1
 and comp_brand_id in (9,10,11,1,2,8)
 
 
 select *
from 
TEL_MOBILE_NEW_ADD_CNT 
TEL_NET_NEW_ADD_CNT        
TEL_FIX_NEW_ADD_CNT 
G_S_22073_DAY




select time_id,
 bigint(TEL_NET_LOST_CNT) + 
bigint(TEL_FIX_LOST_CNT)+ bigint(TEL_MOBILE_LOST_CNT)
from   G_S_22073_DAY 
where time_id between 20110901 and 20110906
order by time_id desc 


select time_id , sum(bigint(D_COMM_USERS)) 
from G_S_22038_DAY 
where time_id between 20110901 and 20110906
group by time_id
order by 1 desc 

values round((1165*1.00/713 -1) * 100,2)




select time_id,
 bigint(TEL_NET_LOST_CNT) + 
bigint(TEL_FIX_LOST_CNT)+ bigint(TEL_MOBILE_LOST_CNT)
from   G_S_22073_DAY 
where time_id between 20110901 and 20110906
order by time_id desc 



select char(count(distinct comp_product_no)) c51
from bass2.Dw_comp_cust_20110905
where comp_day_off_mark=1
 and comp_brand_id in (9,10,11,1,2,8)
 
 
 
 select * from  G_S_22068_MONTH
 
 
 select * from   app.sch_control_map where program_name like '%22068%'
 
 
 
 
 
insert into app.sch_control_map
values
 (2,'G_S_22068_MONTH.tcl','BASS1_G_S_22068_MONTH.tcl')

insert into app.sch_control_map
values
(2,'EXP_G_S_22068_MONTH','BASS1_EXP_G_S_22068_MONTH')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22068_MONTH.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22068_MONTH.tcl' PROGRAM_NAME
,'G_S_22068_MONTH.BASS1' SOURCE_DATA
,'G_S_22068_MONTH_e' OBJECTIVE_DATA
,'G_S_22068_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

delete from app.g_unit_info where unit_code='22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
select * from   BASS1.G_S_22068_MONTH



			select  a.rule_id
             ,a.cond_expr
             ,a.compute_expr
       from bass2.dw_channel_rule_mm a,bass2.dw_channel_rule_info_mm  b
       where a.rule_info_id=b.rule_info_id  and  b.rule_type='4' and a.data_status=1 and b.data_status=1
             and a.op_time='2011-05-01'  and b.op_time='2011-05-01' 
             

select * from        bass2.dw_channel_rule_rlt_mm
select * from       bass2.dw_channel_rule_info_mm 
select * from    bass2.dw_channel_rule_mm 
select * from    bass2.dwd_channel_dept_20110531

 insert into   session.dw_channel_rule_tmp
	                 select   b.channel_id
                           ,e.channel_name
                           ,c.rule_type
                           ,d.rule_info_id
                           ,c.rule_desc
                           ,d.rule_id
                           ,d.cond_expr
                   from
                        bass2.dw_channel_rule_rlt_mm b,
                        bass2.dw_channel_rule_info_mm c,
                        bass2.dw_channel_rule_mm d,
                        bass2.dwd_channel_dept_20110531 e
                   where b.op_time='2011-05-01' 
                         and c.op_time='2011-05-01' 
                         and d.op_time='2011-05-01' 
                         and b.channel_id=e.channel_id
                         and b.rule_info_id=c.rule_info_id
                         and c.data_status=1
                         and c.rule_info_id=d.rule_info_id
                         and d.data_status=1


select distinct staff_org_id from   bass2.dw_acct_payment_dm_201105

                         

CREATE TABLE BASS1.G_S_22068_MONTH_1
(channel_id           bigint,
channel_name         varchar(128),
rule_type            varchar(4),
rule_info_id         integer,
rule_desc            varchar(1000),
rule_id              bigint,
cond_expr            varchar(200)
)DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (channel_id,rule_id) USING HASHING;
CREATE TABLE BASS1.G_S_22068_MONTH_2(
   unique_id INTEGER,
   city_id VARCHAR(7),
   county_id VARCHAR(7),
   geography_type INTEGER,
   channel_id BIGINT,
   channel_name VARCHAR(128),
   phone_id VARCHAR(40),
   rule_type VARCHAR(4),
   rule_info_id INTEGER,
   rule_desc VARCHAR(1000),
   rule_id BIGINT,
   fee DECIMAL(12, 5) 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    unique_id,
    rule_type
 )USING HASHING;
select * from    G_S_22068_MONTH_1
                         
                         
                        select  a.rule_id
             ,a.cond_expr
             ,a.compute_expr
       from bass2.dw_channel_rule_mm        a,bass2.dw_channel_rule_info_mm    b
       where a.rule_info_id=b.rule_info_id  and  b.rule_type='4' 
                        and a.data_status=1 and b.data_status=1
             and a.op_time='2011-05-01'  and b.op_time='2011-05-01'
                         
                         
select * from    G_S_22068_MONTH_1

                         


                        select  a.rule_id
             ,a.cond_expr
             ,a.compute_expr
       from bass2.dw_channel_rule_mm        a,bass2.dw_channel_rule_info_mm    b
       where a.rule_info_id=b.rule_info_id  and  b.rule_type='4' 
                        and a.data_status=1 and b.data_status=1
             and a.op_time='2011-05-01'  and b.op_time='2011-05-01'


                        select  a.rule_id
             ,a.cond_expr
             ,a.compute_expr
       from bass2.dw_channel_rule_mm        a,bass2.dw_channel_rule_info_mm    b
       where a.rule_info_id=b.rule_info_id  and  b.rule_type='4' 
                        and a.data_status=1 and b.data_status=1
             and a.op_time='2011-05-01'  and b.op_time='2011-05-01'
             order by 1


select * from   G_S_22068_MONTH_2

select 
         201105 TIME_ID
        ,'201105' OP_MONTH
        ,char(count(distinct case when opt_code in ('4103') then payment_id end ))  COUNTER_REC_CNT
        ,char(count(distinct case when opt_code in ('4468') then payment_id end )) EBANK_REC_CNT
        ,char(count(distinct case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then payment_id end )) OTH_REC_CNT
        ,char(int(sum( case when opt_code in ('4103') then AMOUNT else 0 end )))  COUNTER_REC_FEE
        ,char(int(sum( case when opt_code in ('4468')  then AMOUNT else 0 end ))) EBANK_REC_FEE
        ,char(int(sum( case when opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4144') then AMOUNT else 0 end ))) OTH_REC_FEE
         ,char(sum(b.fee)) REWARD_FEE
        --,char(int(SUM(AMOUNT*0.01))) REWARD_FEE
from bass2.dw_acct_payment_dm_201105 a 
left join (select CHANNEL_ID,sum(FEE) FEE from G_S_22068_MONTH_2 group by CHANNEL_ID) b on a.STAFF_ORG_ID = b.channel_id
where opt_code in ('4286','4287','4179','4180','4181','4182','4310','4311','4103','4144','4468')
                         with ur 


select count(0),sum(fee) from   G_S_22068_MONTH_2
                         
                         
select * from    bass1.G_S_22068_MONTH

select * from   bass2.channel_bank_reward_201105


select  
                         ,a.channel_id  
                         ,a.channel_name
                         ,b.channel_type  
                         ,b.channel_type_dtl    
                         ,b.phone_id  
                         ,b.pre_fee     
                         ,a.fee 
                  from G_S_22068_MONTH_2 a
                       left join bass2.channel_bank_reward_201105 b  on a.phone_id=b.phone_id
                  where a.unique_id=b.unique_id and a.rule_type='4'



drop table "BASS2   "."G_S_22068_MONTH_3" 
CREATE TABLE "BASS1   "."G_S_22068_MONTH_3"  (
                  "OP_TIME" DATE , 
                  "OBJECT_ID" BIGINT , 
                  "ENTITY_TYPE" SMALLINT , 
                  "UNIQUE_ID" INTEGER , 
                  "PHONE_ID" VARCHAR(15) , 
                  "REGION_CODE" INTEGER , 
                  "COUNTY_CODE" INTEGER , 
                  "GEOGRAPHY_TYPE" INTEGER , 
                  "CHANNEL_TYPE" INTEGER , 
                  "CHANNEL_TYPE_DTL" INTEGER , 
                  "CHANNEL_TYPE_DTL3" INTEGER , 
                  "PRE_FEE" DECIMAL(12,2) , 
                  "EXT1" INTEGER , 
                  "EXT2" INTEGER , 
                  "EXT3" INTEGER , 
                  "EXT4" INTEGER , 
                  "EXT5" INTEGER , 
                  "EXT6" INTEGER , 
                  "EXT7" INTEGER , 
                  "EXT8" INTEGER , 
                  "EXT9" INTEGER , 
                  "EXT10" INTEGER )
DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,OBJECT_ID) USING HASHING;
DISTRIBUTE BY HASH("OP_TIME",  
                 "OBJECT_ID")   
                   IN "TBS_REPORT" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
select UNIQUE_ID , count(0) 
--,  count(distinct UNIQUE_ID ) 
from G_S_22068_MONTH_2 
group by  UNIQUE_ID 
order by 1 



select UNIQUE_ID , count(0) 
--,  count(distinct UNIQUE_ID ) 
from G_S_22068_MONTH_3 
group by  UNIQUE_ID 
order by 1 


select  sum(a.fee)
                  from G_S_22068_MONTH_2 a
                       join G_S_22068_MONTH_3 b  on a.phone_id=b.phone_id
                  where a.unique_id=b.unique_id

select * from   G_S_22068_MONTH_3
                         
select * from   G_S_22068_MONTH

select  int(sum(a.fee))
          from G_S_22068_MONTH_2 a
          left join G_S_22068_MONTH_3 b  on a.phone_id=b.phone_id
          where a.unique_id=b.unique_id and a.rule_type='4'


select count(0) from    G_S_22068_MONTH_3

select  int(sum(a.fee))
          from G_S_22068_MONTH_2 a
          left join G_S_22068_MONTH_3 b  on a.phone_id=b.phone_id
          where a.unique_id=b.unique_id and a.rule_type='4'


select                          * from G_S_22068_MONTH

select sum(bigint(fee)) from   bass2.stat_channel_reward_0006 


select distinct staff_org_id 
from  bass2.dw_acct_payment_dm_201105
where opt_code = '4468'



delete from app.sch_control_before where control_code = 'BASS1_G_S_22068_MONTH.tcl'
insert into app.sch_control_before values('BASS1_G_S_22068_MONTH.tcl','BASS2_Dwd_acct_payment_dm.tcl.tcl');
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22068_MONTH', 'BASS1_G_S_22068_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   2,
   2,
   'int -s G_S_22068_MONTH.tcl',
   0,
   - 1,
   '银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22068_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22068_MONTH LASTMONTH()',
   0,
   - 1,
   'export银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
BASS2_Dwd_acct_payment_dm.tcl





delete from app.sch_control_before where control_code = 'BASS1_G_S_22068_MONTH.tcl'
insert into app.sch_control_before values('BASS1_G_S_22068_MONTH.tcl','BASS2_Dwd_acct_payment_dm.tcl.tcl');
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22068_MONTH', 'BASS1_G_S_22068_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   2,
   2,
   'int -s G_S_22068_MONTH.tcl',
   0,
   - 1,
   '银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22068_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22068_MONTH LASTMONTH()',
   0,
   - 1,
   'export银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '银行代收代缴及酬金信息',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
////////////////////////////////////////////////////////////////////////

delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22068_MONTH.tcl'
insert into app.sch_control_map
values
 (2,'G_S_22068_MONTH.tcl','BASS1_G_S_22068_MONTH.tcl')

delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22068_MONTH.tcl'
insert into app.sch_control_map
values
(2,'EXP_G_S_22068_MONTH','BASS1_EXP_G_S_22068_MONTH')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22068_MONTH.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22068_MONTH.tcl' PROGRAM_NAME
,'G_S_22068_MONTH.BASS1' SOURCE_DATA
,'G_S_22068_MONTH_e' OBJECTIVE_DATA
,'G_S_22068_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'




delete from app.sch_control_before where control_code = 'BASS1_G_S_22068_MONTH.tcl'
insert into app.sch_control_before values('BASS1_G_S_22068_MONTH.tcl','BASS2_Dwd_acct_payment_dm.tcl');
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   'BASS2_Dw_channel_rule_rlt_ms.tcl'
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   'BASS2_Dw_channel_rule_info_ms.tcl'
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   'BASS2_Dw_channel_rule_ms.tcl'
   );
INSERT INTO app.sch_control_before 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   'BASS2_Dwd_channel_dept_ds.tcl'
   );
delete from app.sch_control_before  where control_code = 'BASS1_EXP_G_S_22068_MONTH'
insert into app.sch_control_before values('BASS1_EXP_G_S_22068_MONTH','BASS1_G_S_22068_MONTH.tcl');
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22068_MONTH', 'BASS1_G_S_22068_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   2,
   2,
   'int -s G_S_22068_MONTH.tcl',
   0,
   - 1,
   '银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22068_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22068_MONTH LASTMONTH()',
   0,
   - 1,
   'export银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '银行代收代缴及酬金信息',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
select * from    BASS2.dw_acct_payment_dm_201105   


select * from    BASS2.dw_channel_local_busi_201105   



--检查：01007 ， 02058 ， 02059， 02054 ， 

select count(0) from    g_a_01007_day
where time_id = 20110531

select count(0) from    g_a_02058_day
where time_id = 20110531

select count(0) from    g_a_02059_day
where time_id = 20110531

select count(0) from    g_a_02054_day
where time_id = 20110531


select * from   g_a_02054_day_t
except
select * from   g_a_02054_day
where time_id = 20110531


select * from   g_a_02059_day_t
except
select * from   g_a_02059_day
where time_id = 20110531



select * from   g_a_02058_day_t
except
select * from   g_a_02058_day
where time_id = 20110531


select * from   g_a_01007_day_t
except
select * from   g_a_01007_day
where time_id = 20110531

select * from 
g_a_01007_day
where enterprise_id = '519155287'



        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02059_DAY  t
                        where time_id >= 20100626
          ) a
        where rn = 1    and     STATUS_ID = '1'
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                with ur
                
                
                        select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                                                                        where time_id >= 20100626
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        AND trim(A.enterprise_id) <> ''
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur

        select * from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02061_DAY  t 
          ) a
        where rn = 1    and     STATUS_ID = '1'
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                with ur 



                        select * from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02061_DAY  t
                                                                                    
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur         
                
                
                
select count(0) from    G_A_02061_DAY
where time_id = 20110531


insert into G_A_02061_DAY
        select 
         20110531 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
        from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02061_DAY  t 
          ) a
        where rn = 1    and     STATUS_ID = '1'
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                with ur 






insert into G_A_02061_DAY
        select 
         20110531 TIME_ID
        ,ENTERPRISE_ID
        ,USER_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,EXPIRE_DATE
        ,PAY_TYPE
        ,ORDER_DATE
        ,'2' STATUS_ID
 from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02061_DAY  t
                                                                                    
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur         
                
                

                

        select count(0) from 
        (
                        select t.*
                        ,row_number()over(partition by t.user_id order by time_id desc ) rn 
                        from  G_A_02062_DAY  t
          ) a
        where rn = 1    and     STATUS_ID = '1'
                and not exists (select 1 from (select distinct user_id from bass1.g_a_02004_day where time_id >= 20100626 ) t where a.user_id = t.user_id )
                with ur 

                
                
                

                        select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02062_DAY  t
                                                                                     
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur   

                
                
                
                      select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id ,ENTERPRISE_BUSI_TYPE order by time_id desc ) rn 
                                        from 
                                        G_A_02054_DAY  t
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur


                

select * from   G_A_02058_DAY_T                      

select * from   G_A_02054_DAY_T        

select * from   G_A_02059_DAY_T         


 
 
 
select * from app.sch_control_task a 
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 1

update app.sch_control_task a 
set cc_flag = 2
where control_code like  '%G_S_04007_DAY%'
and cc_flag = 1

update app.sch_control_task a 
set FUNCTION_DESC = '[作废]'||FUNCTION_DESC
where control_code like  '%%'
and cc_flag = 2



select * from   G_S_04007_DAY

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04007_DAY 
group by  time_id 
order by 1 desc 





select      20110901 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
             ,char(b.CANCEL_BUSI_CNT) 	 CANCEL_BUSI_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201105 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time
              					,count(0) CANCEL_BUSI_CNT
                       from   
                       	BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201109 a
                        where replace(char(date(a.create_date)),'-','') =  '20110901'  
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20110901' 
				and    replace(char(date(a.create_date)),'-','') = b.op_time
                

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
) t

                
                

			select count(0) cnt
			from 
			(
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day where 
			 time_id <= 20110430 and ENTERPRISE_BUSI_TYPE = '1520'
			 and MANAGE_MODE = '2'
			) t 
			) t2 where rn = 1 and STATUS_ID ='1'
                
                

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '2'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
) t

                
select *
	from bass2.dw_channel_info_201105 a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
and a.CHANNEL_ID = 1002               


select * from   G_A_02054_DAY
where time_id = 20110901

select count(0) from    bass1.mon_all_interface 
where sts= 1 and type = 'd'



except 
select code from 
(
select '01002'  code from bass2.dual union all
select '01004'  code from bass2.dual union all
select '01006'  code from bass2.dual union all
select '01007'  code from bass2.dual union all
select '02004'  code from bass2.dual union all
select '02008'  code from bass2.dual union all
select '02011'  code from bass2.dual union all
select '02013'  code from bass2.dual union all
select '02022'  code from bass2.dual union all
select '02023'  code from bass2.dual union all
select '02053'  code from bass2.dual union all
select '02054'  code from bass2.dual union all
select '02055'  code from bass2.dual union all
select '02056'  code from bass2.dual union all
select '02057'  code from bass2.dual union all
select '02058'  code from bass2.dual union all
select '02059'  code from bass2.dual union all
select '02060'  code from bass2.dual union all
select '02061'  code from bass2.dual union all
select '02062'  code from bass2.dual union all
select '02063'  code from bass2.dual union all
select '02064'  code from bass2.dual union all
select '04002'  code from bass2.dual union all
select '04003'  code from bass2.dual union all
select '04004'  code from bass2.dual union all
select '04005'  code from bass2.dual union all
select '04006'  code from bass2.dual union all
select '04014'  code from bass2.dual union all
select '04015'  code from bass2.dual union all
select '04016'  code from bass2.dual union all
select '04017'  code from bass2.dual union all
select '04018'  code from bass2.dual union all
select '06031'  code from bass2.dual union all
select '06032'  code from bass2.dual union all
select '21001'  code from bass2.dual union all
select '21002'  code from bass2.dual union all
select '21004'  code from bass2.dual union all
select '21005'  code from bass2.dual union all
select '21007'  code from bass2.dual union all
select '21009'  code from bass2.dual union all
select '21016'  code from bass2.dual union all
select '22012'  code from bass2.dual union all
select '22038'  code from bass2.dual union all
select '22073'  code from bass2.dual union all
select '22066'  code from bass2.dual union all
select '22091'  code from bass2.dual union all
select '22092'  code from bass2.dual union all
select '22102'  code from bass2.dual union all
select '22104'  code from bass2.dual union all
select '22201'  code from bass2.dual union all
select '22202'  code from bass2.dual union all
select '22203'  code from bass2.dual union all
select '22301'  code from bass2.dual union all
select '22302'  code from bass2.dual union all
select '22080'  code from bass2.dual union all
select '22082'  code from bass2.dual union all
select '22084'  code from bass2.dual union all
select '04008'  code from bass2.dual union all
select '04009'  code from bass2.dual union all
select '04010'  code from bass2.dual union all
select '04011'  code from bass2.dual union all
select '04012'  code from bass2.dual 
) a
except
select interface_code  from bass1.mon_all_interface 
where sts= 1 and type = 'd'

1
22066
22091
22092



CREATE TABLE BASS1.G_S_22086_MONTH(
        TIME_ID                INTEGER             ---- 记录行号      
        ,OP_MONTH               CHAR(6)             ---- 月份 主键      
        ,BUSI_CODE              CHAR(2)            ---- 业务代码 主键  
        ,BUSI_NAME              CHAR(6)            ---- 业务名称 主键  
        ,SP_CODE                CHAR(12)            ---- SP企业代码    
        ,BACK_SP_NAME           CHAR(5)            ---- 退费SP企业名称 
        ,BILLING_TYPE           CHAR(2)             ---- 业务计费类型  
        ,BACK_USER_CNT          CHAR(1)            ---- 业务退费客户数 
        ,ORDER_USER_CNT         CHAR(1)            ---- 订购用户数    
 )DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_MONTH,BUSI_CODE,BUSI_NAME
   ) USING HASHING;
ALTER TABLE BASS1.G_S_22086_MONTH
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
CREATE TABLE BASS1.G_S_22091_DAY(
   TIME_ID INTEGER ---- 记录行号     
   ,
   DEAL_DATE CHAR(8) ---- 办理日期 主键 
   ,
   CHANNEL_ID CHAR(4) ---- 实体渠道标识 主键
   ,
   DEAL_TYPE CHAR(1) ---- 办理类型 主键 
   ,
   NEW_USER_CNT CHAR(8) ---- 新增客户数   
   ,
   PAYMENT_REC_CNT CHAR(1) ---- 缴费笔数     
   ,
   PAYMENT_REC_FEE CHAR(1) ---- 缴费金额     
   ,
   CARD_SALE_CNT CHAR(8) ---- 充值卡销售笔数
   ,
   VAL_BUSI_REC_CNT CHAR(1) ---- 增值业务办理笔数
   ,
   VAL_BUSI_OPEN_CNT CHAR(1) ---- 增值业务开通量
   ,
   IMP_VAL_OPEN_CNT ---- 重点增值业务开通量
   ,
   TERM_SALE_CNT CHAR(1) ---- 定制终端销售量
   ,
   MOBILE_SALE_CNT CHAR(1) ---- 其中定制手机销售量
   ,
   BASE_REC_CNT CHAR(1) ---- 办理类基础服务笔数
   ,
   QRY_REC_CNT CHAR(1) ---- 查询类基础服务笔数 
)DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    DEAL_DATE,
    CHANNEL_ID,
    DEAL_TYPE 
 )USING HASHING;
ALTER TABLE BASS1.G_S_22091_DAY
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110901 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110901 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1


  
  
  

select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110903                   
except
select user_id 
from bass2.dw_product_20110903
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
USER_ID
89760000957793 
89460000959594 
89460000960059 
89160000957168 


select * from   session.int_check_user_status  
where user_id in 
(
 '89760000957793'
,'89460000959594'
)
 
 
select user_id, usertype_id,day_off_mark,userstatus_id,test_mark from   bass2.dw_product_20110902
where user_id in 
(
 '89760000957793'
,'89460000960059'
,'89460000959594'
,'89160000957168'
)
 
select * from   bass1.g_a_02004_day
where user_id in 
(
 '89760000957793'
,'89460000960059'
,'89460000959594'
,'89160000957168'
)
 

 
 select count(user_id) 
                    from bass2.dw_product_20110901  
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1


select count(0) from   G_S_22303_MONTH where ENT_BUSI_ID = '1370'
and time_id = 201105
and bigint(BILL_CUST_NUMS) >  bigint(USE_CUST_NUMS)
                     
                     


                     

			select a.cnt*1.00 ,value(b.income,0) income
				from
				(select count(0) cnt
							from 
							(
							select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
							from (
							select *
							from g_a_02054_day where 
							 time_id/100 <= 201105 and ENTERPRISE_BUSI_TYPE = '1520'
							 and MANAGE_MODE = '3'
							) t 
							) t2 where rn = 1 and STATUS_ID ='1'
				) a,(
				select sum(income)*1.00/100 income
				from (
				select sum(bigint(income)) income from   g_s_03017_month
				where time_id = 201105
				and ent_busi_id = '1520'
				and MANAGE_MOD = '3'
				union all 
				select sum(bigint(income)) income from   g_s_03018_month
				where time_id = 201105
				and ent_busi_id = '1520'
				and MANAGE_MOD = '3'
				) t 
				) b 
					with ur                     
                    
                    
                    select * from table(bass1.fn_dn_flret_cnt(15)) a
select * from table(bass1.fn_dn_flret_cnt(15)) a



select a.td_cust_t_dur*1.0000 , b.dur*1.0000
				from 
				(
					select  bigint(td_cust_t_dur) td_cust_t_dur from   G_S_22204_MONTH
					where time_id = 201104					and CYCLE_ID = '3'
			 )a,
				(
					select sum(bill_duration)  dur
					from bass1.g_s_21003_month_td
				   where mns_type='1'
				) b
			with ur


(
		sel sum(case when td_book_flg=1 
        and td_infophone_flg=0 
        and td_mobile_flg=0 
        and td_crd_flg=0 
        then g_up_strm_book+t_up_strm_book+g_down_strm_book+t_down_strm_book 
									else g_up_strm_book+t_up_strm_book+g_down_strm_book+t_down_strm_book+g_up_strm_nonbook+t_up_strm_nonbook+g_down_strm_nonbook+t_down_strm_nonbook
						 end)/1024/1024 as val2
		from dwbview.dm_sum_td_user_new
		where statis_mon=$Tx_Date and cmcc_prov_prvd_id=$Branch_ID		
) t2


select * from   decimal(1.0*($RESULT_VAL1+$RESULT_VAL2-$RESULT_VAL3)/1024/1024,20,2)


select (val1 + val2 - val3)/1024/1024
from 
(
select 
		sum(bigint(a.flows))*1.00 val3 
		from bass1.g_s_04002_day_flows a,
		bass1.td_check_user_flow b
		where a.product_no=b.product_no
) a
,(

		select 
		sum(bigint(flows))*1.00 val2 
		from bass1.g_s_04018_day_flows
) b
,(
		select 
		sum(bigint(flows))*1.00 val1 
		from bass1.g_s_04002_day_flows
) c
                    
                    


select a.TD_CUST_FLOWS*1.0000 , b.flows*1.0000
				from 
				(
					select  bigint(TD_CUST_FLOWS) TD_CUST_FLOWS from   G_S_22204_MONTH
					where time_id = 201104
					and CYCLE_ID = '3'
			 )a,
				(
												select (val1 + val2 - val3)/1024/1024 flows
												from 
												(
												select 
														sum(bigint(a.flows))*1.00 val3 
														from bass1.g_s_04002_day_flows a,
														bass1.td_check_user_flow b
														where a.product_no=b.product_no
												) a
												,(
												
														select 
														sum(bigint(flows))*1.00 val2 
														from bass1.g_s_04018_day_flows
												) b
												,(
														select 
														sum(bigint(flows))*1.00 val1 
														from bass1.g_s_04002_day_flows
												) c
				) b
			with ur                    





select * from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22061_month where time_id =201105)
  and time_id =201105
  and channel_type<>'3'
  and channel_status='1'
  

            
            
            
             select count(*) from bass1.g_i_06021_month
where channel_id not in
(select distinct channel_id from bass1.g_s_22061_month where time_id =201105)
  and time_id =201105
  and channel_type<>'3'
  and channel_status='1'
  
  
  select count(user_id) 
                    from bass2.dw_product_20110903  
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1
                     
                     
                     
                     
                     
        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110903 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110903 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1


            select sum(bigint(m_off_users)) from bass1.g_s_22012_day where time_id=20110903

                        select count(distinct user_id) from session.int_check_user_status
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110903


select * from    G_I_21020_MONTH 
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201105 )


update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201105 )


                          
values ((10733+510)*1.000/9989 - 1)
                         

                 select sum(bigint(TEL_MOBILE_LOST_CNT))
from bass1.G_S_22073_DAY
where time_id/100 = 201105                         



			 select * from   
			( 
			 select COMP_PRODUCT_NO,COMP_LAST_DATE
			 from G_I_21020_MONTH where time_id = $last_month and  COMP_BRAND_ID = '031000' 
			) a 
			,
			(
			 select COMP_PRODUCT_NO,COMP_BEGIN_DATE
			 from G_I_21020_MONTH where time_id = $op_month and  COMP_BRAND_ID = '031000' 
			) b 
			,BASS1.G_I_21020_MONTH_calendar c
			where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
			and 
			(days(date(date2))-
			 		days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))
			 =90
			 and  char(COMP_BEGIN_DATE  ) > char(date_seq)
			  and c.date_seq like '$op_month%'
             

                         select * from   
                        ( 
                         select COMP_PRODUCT_NO,COMP_LAST_DATE
                         from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '031000' 
                        ) a 
                        ,
                        (
                         select COMP_PRODUCT_NO,COMP_BEGIN_DATE
                         from G_I_21020_MONTH where time_id = 201105 and  COMP_BRAND_ID = '031000' 
                        ) b 
                        ,BASS1.G_I_21020_MONTH_calendar c
                        where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
                        and 
                        (days(date(date2))-
                         days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                         and  char(COMP_BEGIN_DATE  ) > char(date_seq)
                          and c.date_seq like '201105%'             
                          
                          
                          


                         select * from   
                        ( 
                         select COMP_PRODUCT_NO,COMP_LAST_DATE
                         from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '031000' 
                        ) a 
                        ,
                        (
                         select COMP_PRODUCT_NO,COMP_BEGIN_DATE
                         from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '031000' 
                        ) b 
                        ,BASS1.G_I_21020_MONTH_calendar c
                        where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
                        and 
                        (days(date(date2))-
                         days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                         and  char(COMP_BEGIN_DATE  ) > char(date_seq)
                          and c.date_seq like '201103%'                                 
                          



                         select * from   
                        ( 
                         select COMP_PRODUCT_NO,COMP_LAST_DATE
                         from G_I_21020_MONTH where time_id = 201103 and  COMP_BRAND_ID = '031000' 
                        ) a 
                        ,
                        (
                         select COMP_PRODUCT_NO,COMP_BEGIN_DATE
                         from G_I_21020_MONTH where time_id = 201104 and  COMP_BRAND_ID = '031000' 
                        ) b 
                        ,BASS1.G_I_21020_MONTH_calendar c
                        where a.COMP_PRODUCT_NO  = b.COMP_PRODUCT_NO 
                        and 
                        (days(date(date2))-
                         days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                         and  char(COMP_BEGIN_DATE  ) > char(date_seq)
                          and c.date_seq like '201104%'                                 
                          
                          

                                select * from    
                                table (
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201104
                                except 
                                select COMP_PRODUCT_NO,COMP_LAST_DATE
                                from         G_I_21020_MONTH
                                where COMP_BRAND_ID = '031000' 
                                and time_id = 201105
                                ) a , BASS1.G_I_21020_MONTH_calendar b 
                                where 
                                (days(date(date2))-
                                 days(date(substr(COMP_LAST_DATE,1,4)||'-'||substr(COMP_LAST_DATE,5,2)||'-'||substr(COMP_LAST_DATE,7,2))))=90
                                   and b.date_seq like '201105%'

                                   

select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.Dw_comp_cust_dt 
group by  OP_TIME 
order by 1 




select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.Dw_comp_cust_201105 
group by  op_time 
order by 1 

select * from   bass2.Dw_comp_cust_201105 




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22061_MONTH 
group by  time_id 
order by 1 






delete from app.sch_control_before where control_code = 'BASS1_G_S_22068_MONTH.tcl'
insert into app.sch_control_before values('BASS1_G_S_22068_MONTH.tcl','BASS2_Dwd_acct_payment_dm.tcl.tcl');
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22068_MONTH', 'BASS1_G_S_22068_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22068_MONTH.tcl',
   2,
   2,
   'int -s G_S_22068_MONTH.tcl',
   0,
   - 1,
   '银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22068_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22068_MONTH LASTMONTH()',
   0,
   - 1,
   'export银行代收代缴及酬金信息',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   1,
   '收费争议先退费后查证业务级月汇总',
   'bass1.g_s_22068_month',
   1,
   0,
   0
   );
COMMIT;
select * from  BASS1.MON_ALL_INTERFACE 
where interface_code = '22066'







 select b.org_id
           ,case when b.so_mode='5' then 2 else 1 end accept_type
                       ,case when b.busi_type in ('115','730') then '06'
                             when b.busi_type='117' then '12'
                             when b.busi_type='118' then '25'
                             when b.busi_type='126' then '10'
                             when b.busi_type='132' then '11'
                             when b.busi_type='137' then '19'
                             when b.busi_type='139' then '16'
                             when b.busi_type='708' then '26'
                             when b.busi_type='709' then '04'
                             when b.busi_type='716' then '27'
                             when b.busi_type='733' then '22'
                             when b.busi_type='726' then '20'
                             when b.busi_type='140' then '28'
                        end imp_accepttype
                       ,count(distinct b.so_nbr) 
                from bass2.dim_channel_info a,
                (
                        select c.org_id,b.busi_type,b.so_nbr,b.so_mode 
                          from bass2.Dw_cm_busi_radius_dm_201109 b,
                               bass2.dw_product_ord_so_log_dm_201109 c 
                         where b.ext_holds2=c.so_log_id
                         and c.CREATE_DATE = '2011-06-06'
                 ) b
                where a.channel_id = b.org_id
                  and a.channel_type_class in (90105,90102)
                  and b.busi_type in ('115','117','118','126','132','137','139','708','709','716','730','733','726','140')
                group by  b.org_id,
                          case when b.so_mode='5' then 2 else 1 end,
                    case when b.busi_type in ('115','730') then '06'
                                     when b.busi_type='117' then '12'
                                     when b.busi_type='118' then '25'
                                     when b.busi_type='126' then '10'
                                     when b.busi_type='132' then '11'
                                     when b.busi_type='137' then '19'
                                     when b.busi_type='139' then '16'
                                     when b.busi_type='708' then '26'
                                     when b.busi_type='709' then '04'
                                     when b.busi_type='716' then '27'
                                     when b.busi_type='733' then '22'
                                     when b.busi_type='726' then '20'
                                     when b.busi_type='140' then '28'
                                end                       
        
        

drop table "BASS1   "."G_S_22091_DAY_P2" 

CREATE TABLE "BASS1   "."G_S_22091_DAY_P2"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "ACCEPT_TYPE" CHAR(1) NOT NULL , 
                  "IMP_ACCEPTTYPE" CHAR(2) NOT NULL , 
                  "CNT" INTEGER )   
                 DISTRIBUTE BY HASH("TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select tabname from syscat.tables where tabname like '%DIM%SERV'

select * from   bass2.ODS_DIM_SYS_ORGANIZE_20110901
where org

select * from   bass2.DIM_SERVICE_ITEM
select * from   
(
select SO_ORG_ID,count(0)
  FROM bass2.dw_product_busi_msc_dm_201109 a, bass2.dw_product_busi_dm_201109 b 
 WHERE A.SO_NBR = B.SO_NBR
   AND B.SO_MODE IN ('0', '1', '2')
   AND B.OP_ID <> 9999
   AND B.OP_ID NOT IN (1, 800)
 GROUP BY B.SO_ORG_ID 
) a ,bass2.ODS_DIM_SYS_ORGANIZE_20110901 b 
where a.SO_ORG_ID = b.organize_id 

select * from   bass2.dw_kf_sms_dm_201105
select * from   bass2.dwd_kf_sms_20110901



select tabname from syscat.tables where tabname like '%KF%SMS%'   


select * from   bass2.dw_chl_e_all_user_mt_201105




delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22091_DAY.tcl'
insert into app.sch_control_map
values
 (2,'G_S_22091_DAY.tcl','BASS1_G_S_22091_DAY.tcl')

delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22091_DAY.tcl'
insert into app.sch_control_map
values
(2,'EXP_G_S_22091_DAY','BASS1_EXP_G_S_22091_DAY')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22091_DAY.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22091_DAY.tcl' PROGRAM_NAME
,'G_S_22091_DAY.BASS1' SOURCE_DATA
,'G_S_22091_DAY_e' OBJECTIVE_DATA
,'G_S_22091_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'



select * from    BASS1.G_S_22091_DAY_P2

select * from   bass2.dim_prod_up_product_item  where name like '%信息管家%'


select * from    bass2.dim_cfg_static_data  g
where g.code_type = '911000'


select * from    bass2.dw_product_ord_offer_dm_201105
where offer_id is null

select * from   bass2.dw_product_ord_cust_dm_201105     
where PRODUCT_INSTANCE_ID is null


select * from   bass2.dw_product_20110908 where user_id = '89102999623348'



select sum(bigint(VAL_BUSI_REC_CNT))
, sum(bigint(VAL_BUSI_OPEN_CNT)) 
, sum(bigint(IMP_VAL_OPEN_CNT)) 
from   BASS1.G_S_22091_DAY


select * from   

select sum(cnt) from   BASS1.G_S_22091_DAY_P2

select count(0),count(distinct channel_id ) from     BASS1.G_S_22091_DAY_P2
select * from   bass2.dw_newbusi_flysms_open_dm_201105

select *    
			from (select time_id, channel_id , sum(cnt) cnt from BASS1.G_S_22091_DAY_P2 group by  time_id, channel_id )  t



CREATE TABLE "BASS1   "."G_S_22091_DAY_P1"  (
            CHANNEL_ID      		BIGINT,
            ACCEPT_TYPE         INT,
            IMP_ACCEPTTYPE      CHARACTER(2),
            CNT                 BIGINT
                  )   
                 DISTRIBUTE BY HASH("CHANNEL_ID","ACCEPT_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select optype,op_time , count(0) 
,  count(distinct user_id ) 
from bass2.dw_newbusi_flysms_open_dm_201109
group by  optype,op_time 
order by 1 


select IMP_ACCEPTTYPE, sum(cnt) from   BASS1.G_S_22091_DAY_P2
group by IMP_ACCEPTTYPE



select sum( bigint(ACCEPT_CNT)),
 sum(bigint(IMP_ACCEPT_CNT))
 from G_S_22062_MONTH where time_id = 201105
 



select tabname from syscat.tables where tabname like '%DIM%BUSI%'   
select * from   bass2.DIM_BUSI_TYPE b
where b.busi_type in ('115','117','118','126','132','137','139','708','709','716','730','733','726','140')



select * from   bass2.DIM_BUSI_TYPE b
where b.busi_type in (115,117,118,126,132,137,139,708,709,716,730,733,726,140)

select * from   bass2.DIM_BUSI_TYPE b
where BUSI_TYPE_NAME like '%彩像%'






select * from    bass2.dw_product_ord_so_log_dm_201105
where so_log_id = '36426502'


select * from   bass2.dw_product_ord_offer_dm_201105

where CUSTOMER_ORDER_ID = 7410580



select * from    bass2.dw_product_ord_so_log_dm_201105
where ORD_CUST_ID = 7410580

select count(0),count(distinct ORD_CUST_ID ) from     bass2.dw_product_ord_so_log_dm_201105
select count(0),count(distinct CUSTOMER_ORDER_ID ) from     bass2.dw_product_ord_offer_dm_201105


CREATE TABLE "BASS1   "."G_S_22091_DAY_TMP_1"  (
                 CHANNEL_ID      		BIGINT   ,
              ACCEPT_TYPE         CHAR(1) ,
              NEW_USERS          bigint		,
						  HAND_CNT           bigint		,
						  HAND_FEE           bigint		,
						  CARD_SALE_CNT      bigint		,
						  CARD_SALE_FEE      bigint		,
						  ACCEPT_CNT         bigint		,
						  VAL_OPEN_CNT			 bigint		,
						  IMP_ACCEPT_CNT     bigint		,
						  TERM_SALE_CNT      bigint		,
						  OTHER_SALE_CNT     bigint		,
						  ACCEPT_BAS_CNT     bigint		,
						  QUERY_BAS_CNT      bigint		,
						  OFF_ACCEPT_CNT     bigint )   
                 DISTRIBUTE BY HASH(CHANNEL_ID,ACCEPT_TYPE)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select count(0),count(distinct channel_id ) from    
  G_S_22091_DAY_TMP_1
where IMP_ACCEPT_CNT > 0 

select sum(IMP_ACCEPT_CNT)
        FROM bass2.Dim_channel_info A
        inner join G_S_22091_DAY_TMP_1 b on a.channel_id=b.channel_id
        WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
and IMP_ACCEPT_CNT > 0 


select sum(bigint(VAL_BUSI_REC_CNT))
, sum(bigint(VAL_BUSI_OPEN_CNT)) 
, sum(bigint(IMP_VAL_OPEN_CNT)) 
from   BASS1.G_S_22091_DAY
where time_id = 20110908



select count(0),count(distinct time_id ) from     BASS1.G_S_22091_DAY



select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.G_S_22091_DAY 
group by  time_id 
order by 1 

delete from  BASS1.G_S_22091_DAY
where  time_id = 201105






delete from app.g_unit_info where unit_code='22068';
INSERT INTO app.g_unit_info 
VALUES(
   '22068',
   0,
   '实体渠道业务办理日汇总',
   'bass1.G_S_22091_DAY',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22091';
INSERT INTO app.g_unit_info 
VALUES(
   '22091',
   0,
   '实体渠道业务办理日汇总',
   'bass1.G_S_22091_DAY',
   1,
   0,
   0
   );
COMMIT;
delete from app.sch_control_before where control_code = 'BASS1_G_S_22091_DAY.tcl'
insert into app.sch_control_before
values 
 ('BASS1_G_S_22091_DAY.tcl','BASS1_G_I_06021_MONTH.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_product_ds.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_acct_payment_dm.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_channel_local_busi_ds.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_product_ord_cust_dm.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_product_ord_offer_dm.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_product_ord_so_log_dm.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS1_G_I_06021_MONTH.tcl')
,('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_cm_busi_radius_dm.tcl')


insert into app.sch_control_before
values 
 ('BASS1_EXP_G_S_22091_DAY','BASS1_G_S_22091_DAY.tcl')
 
delete from app.sch_control_task where control_code in ('BASS1_EXP_G_S_22091_DAY','BASS1_G_S_22091_DAY.tcl');
DELETE 
FROM app.sch_control_task 
WHERE control_code 
IN ('BASS1_EXP_G_S_22091_DAY', 'BASS1_G_S_22091_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22091_DAY.tcl',
   1,
   2,
   'int -s G_S_22091_DAY.tcl',
   10000,
   - 1,
   '实体渠道业务办理日汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22091_DAY',
   1,
   2,
   'bass1_export BASS1.G_S_22091_DAY YESTERDAY()',
   10000,
   - 1,
   '实体渠道业务办理日汇总导出',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
CONTROL_CODE
BASS1_EXP_G_I_22091_DAY
BASS1_G_I_22091_DAY.tcl

delete from app.sch_control_task where control_code in ('BASS1_EXP_G_I_22091_DAY','BASS1_G_I_22091_DAY.tcl');
select control_code  from  table( bass1.get_task('acct_payment_dm')) a 


select * from   bass1.G_S_22091_DAY




                        select count(*),count(distinct channel_id) from bass1.g_i_06021_month
                        where channel_id not in
                        (select distinct channel_id from bass1.G_S_22062_month )
                          and time_id =201105
                          and channel_status='1'
                          

select time_id,count(0) from   G_S_04004_DAY
group by time_id
order by 1 desc 

ALTER TABLE BASS1.G_S_22091_DAY_P1 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE
                          
select time_id , sum(bigint(M_BILL_MMS))
from G_S_22012_DAY
where time_id between 20110901 and 20110908
group by time_id 
order by 1 
 
 TIME_ID	2
20110901	492684
20110902	261862
20110903	264431
20110904	289096
20110905	1175488
20110906	310033
20110907	259401
20110908	264628

 values (1175488*1.00/289096-1)
 


                        
                         values (310033*1.00/1175488-1)
                         

select * from  table( bass1.get_before('04008')) a 
                        
delete from app.sch_control_before where control_code = 'BASS1_G_S_22091_DAY.tcl'
and before_control_code = 'BASS1_G_I_06021_MONTH.tcl'
                        
                        
select * from    BASS1.G_S_22091_DAY where time_id = 20110901



select * from app.sch_control_task where control_code like '%BASS1%DAY%'                        


delete from app.g_unit_info where unit_code='22092';
INSERT INTO app.g_unit_info 
VALUES(
   '22092',
   0,
   '实体渠道重点增值业务办理日汇总',
   'bass1.g_s_22092_day',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22091';
INSERT INTO app.g_unit_info 
VALUES(
   '22091',
   0,
   '实体渠道业务办理日汇总',
   'bass1.g_s_22091_day',
   1,
   0,
   0
   );
COMMIT;
select date('2011-05-01'),
           c.city_id,
                       count(distinct a.product_instance_id),
                       count(distinct case when a.valid_type=1 then a.product_instance_id  end),
                       count(distinct a.product_instance_id)-count(distinct case when a.valid_type=1 then a.product_instance_id  end)
                from bass2.dw_product_ins_off_ins_prod_201105 a,
                     bass2.dim_qqt_offer_id b,
                     bass2.dw_product_201105 c
                where a.product_instance_id=c.user_id
                  and a.offer_id=b.offer_id
                  and b.index=1
                  and date(a.create_date) between date('2011-05-01') and date('2011-05-31')
                  and date(a.expire_date)>date('2011-05-01')
                  and 
        group by c.city_id



select date('2011-05-01'),
           a.city_id,
                             count(distinct case when a.op_id = 10000047 then a.product_instance_id end),
                             count(distinct case when a.org_id=11111124 then a.product_instance_id end),
                             count(distinct case when a.op_id not in  (10000047,10000475) and a.org_id<>11111124 then a.product_instance_id end),
                             0,
                             count(distinct case when a.op_id = 10000475 then a.product_instance_id end)
                        from 
                                (
                                select a.product_instance_id,a.customer_order_id,a.op_time,a.state,a.expire_date,a.valid_date,a.op_id,a.org_id,e.city_id
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id 
                from bass2.dw_product_ord_cust_dm_201105 a,
                                       bass2.dw_product_ins_off_ins_prod_201105 b,
                                       bass2.dw_product_ord_offer_dm_201105 c,
                                       bass2.dim_qqt_offer_id d,
                                       bass2.dw_product_201105 e
                                where a.product_instance_id=e.user_id
                                  and a.product_instance_id=b.product_instance_id 
                                  and a.customer_order_id=c.customer_order_id
                                  and b.offer_id=d.offer_id
                                  and d.offer_id=c.offer_id
                                  and date(b.create_date) between date('2011-05-01') and date('2011-05-31')
                                  and a.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and c.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and date(c.valid_date) between date('2011-05-01') and date('2011-05-31')
                                  --and c.state=1
                                  and a.state=1
                                  and d.index=1
                                  ) a
          where a.row_id=1
                group by a.city_id
                
                

select    product_instance_id
from 
                                (
                                select a.product_instance_id,a.customer_order_id,a.op_time,a.state,a.expire_date,a.valid_date,a.op_id,a.org_id,e.city_id
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id 
                from bass2.dw_product_ord_cust_dm_201105 a,
                                       bass2.dw_product_ins_off_ins_prod_201105 b,
                                       bass2.dw_product_ord_offer_dm_201105 c,
                                       bass2.dim_qqt_offer_id d,
                                       bass2.dw_product_201105 e
                                where a.product_instance_id=e.user_id
                                  and a.product_instance_id=b.product_instance_id 
                                  and a.customer_order_id=c.customer_order_id
                                  and b.offer_id=d.offer_id
                                  and d.offer_id=c.offer_id
                                  and date(b.create_date) between date('2011-05-01') and date('2011-05-31')
                                  and a.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and c.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and date(c.valid_date) between date('2011-05-01') and date('2011-05-31')
                                  --and c.state=1
                                  and a.state=1
                                  and d.index=1
                                  ) a
          where a.row_id=1              
          
select * from    bass2.dw_product_ins_off_ins_prod_201105 
89157332711870
          
          

    select *
                from bass2.dw_product_ins_off_ins_prod_201105 a,
                     bass2.dim_qqt_offer_id b,
                     bass2.dw_product_201105 c
                where a.product_instance_id=c.user_id
                  and a.offer_id=b.offer_id
                  and b.index=1
                  and date(a.create_date) between date('2011-05-01') and date('2011-05-31')
                  and date(a.expire_date)>date('2011-05-01')
and c.user_id = '89157332711870'

   OFFER_INST_PROD_INST_ID	OFFER_INSTANCE_ID	PRODUCT_INSTANCE_ID	PRODUCT_SPEC_ID	OFFER_ID	PRODUCT_INST_ROLE_ID	IS_MAIN_OFFER	VALID_TYPE	OPER_STATE	STATE	DONE_CODE	CREATE_DATE	DONE_DATE	VALID_DATE	EXPIRE_DATE	OP_ID	ORG_ID	EXT1	EXT2	EXT3	EXT4	GROUP_REGION_ID	CUST_PARTY_ROLE_ID	USER_REGION_ID	REGION_ID	INDEX	OFFER_ID	USER_ID	CUST_ID	ACCT_ID	AGE	AGE_ID	SEX_ID	EDUCATION_ID	CUSTTYPE_ID	CUSTCLASS_ID	CREDIT	CREDIT_ID	PRODUCT_NO	IMSI	SIM_ID	SIM_TYPE	CITY_ID	CITY_ID1	COUNTY_ID	REGION_ID	CHANNEL_ID	CHANNELTYPE_ID	WARN_FEE	SO_NBR	ACCTTYPE_ID	USER_ONLINE	USER_ONLINE_ID	BRAND_ID	CRM_BRAND_ID1	CRM_BRAND_ID2	CRM_BRAND_ID3	PLAN_ID	USERSTATUS_ID	STOPSTATUS_ID	USERTYPE_ID	MONTH_NEW_MARK	MONTH_OFF_MARK	MONTH_RECREATE_MARK	MONTH_NEW_COUNT	MONTH_OFF_COUNT	MONTH_RECREATE_COUNT	YEAR_NEW_MARK	MONTH_CALL_MARK	MONTH_NEWBUSI_MARK	ACTIVE_MARK	ZERO_MARK	VIP_MARK	SINGLE_MARK	VPMN_MARK	ENTERPRISE_MARK	IMPORT_ENT_MARK	FREE_MARK	TEST_MARK	BILL_MARK	SNAPSHOT_MARK	RECREATE_MARK	OWE_MARK	CHGBRAND_MARK	STOP_1MON_MARK	CREATE_DATE	VALID_DATE	STS_DATE	EXPIRE_DATE	TOTAL_SCORE	CHANGE_SCORE	CALL_COUNTS	CALL_DURATION	CALL_DURATION_M	CALL_DURATION_S	FACT_FEE	LOCAL_FEE	TOLL_FEE	ROAM_FEE	MONTH_FEE	INCR_VALUE_FEE	DATA_VOICE_FEE	DATA_INFO_FEE	OTHER_FEE	STAT_FEE	NOT_STAT_FEE	BALANCE_FEE	OWE_FEE	MONTH_SMS_MARK	MONTH_P2P_SMS_MARK
100007048752	100006902379	89157332711870	171000000001	111090001335	181000000001	1	2	38769082	1	300053097548	2011-05-23 	2011-05-23 	2011-06-01 	2030-01-01 	11110218	11111144	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89103000148119	[NULL]	0891	1	111090001335	89157332711870	89103000148119	89101001401775	28	3	1	0	1	0	0	1	13908911922	460008909069479	[NULL]	[NULL]	891	888	1082	10010002	11111115	4	[NULL]	300053693963	0	1085	14	1	1	270	2700	89110013	1	0	1	0	0	0	0	0	0	0	1	1	1	0	0	0	1	1	1	0	0	1	1	0	0	1	0	2008-06-11 	2010-12-01 	2011-05-29 	2011-05-31 	2764	5001	982	284908	5220	889	147.48	78.85	0.00	54.33	0.00	0.00	10.30	4.00	0.00	147.48	0.00	156.45	0.00	1	1
       
          

select * from   bass2.dw_product_20110908
where user_id = '89157332711870'
         
         
         
  select a.product_instance_id,a.customer_order_id,a.op_time,a.state,a.expire_date,a.valid_date,a.op_id,a.org_id,e.city_id
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id 
                from bass2.dw_product_ord_cust_dm_201105 a,
                                       bass2.dw_product_ins_off_ins_prod_201105 b,
                                       bass2.dw_product_ord_offer_dm_201105 c,
                                       bass2.dim_qqt_offer_id d,
                                       bass2.dw_product_201105 e
                                where a.product_instance_id=e.user_id
                                  and a.product_instance_id=b.product_instance_id 
                                  and a.customer_order_id=c.customer_order_id
                                  and b.offer_id=d.offer_id
                                  and d.offer_id=c.offer_id
                                  and date(b.create_date) between date('2011-05-01') and date('2011-05-31')
                                  and a.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and c.op_time between date('2011-05-01') and date('2011-05-31')
                                  --and date(c.valid_date) between date('2011-05-01') and date('2011-05-31')
                                  --and c.state=1
                                  and a.state=1
                                  and d.index=1
                                  and a.prod
                                  
                                  

select a.product_instance_id,a.customer_order_id,a.op_time,a.state,a.expire_date,a.valid_date,a.op_id,a.org_id,e.city_id,b.create_date
,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id 
from bass2.dw_product_ord_cust_dm_201105 a,
       bass2.dw_product_ins_off_ins_prod_201105 b,
       bass2.dw_product_ord_offer_dm_201105 c,
       bass2.dim_qqt_offer_id d,
       bass2.dw_product_201105 e
where a.product_instance_id=e.user_id
  and a.product_instance_id=b.product_instance_id 
  and a.customer_order_id=c.customer_order_id
  and b.offer_id=d.offer_id
  and d.offer_id=c.offer_id
  --and date(b.create_date) between date('2011-05-01') and date('2011-05-31')
  and a.op_time between date('2011-05-01') and date('2011-05-31')
  --and c.op_time between date('2011-05-01') and date('2011-05-31')
  --and date(c.valid_date) between date('2011-05-01') and date('2011-05-31')
  --and c.state=1
  --and a.state=1
  --and d.index=1
  and a.product_instance_id='89157332711870'
                                  
                                  
    select customer_order_id
                from bass2.dw_product_ins_off_ins_prod_201105 a,
                     bass2.dim_qqt_offer_id b,
                     bass2.dw_product_201105 c
                where a.product_instance_id=c.user_id
                  and a.offer_id=b.offer_id
                  and b.index=1
                  and date(a.create_date) between date('2011-05-01') and date('2011-05-31')
                  and date(a.expire_date)>date('2011-05-01')
                  and  a.product_instance_id='89157332711870'

100007048752
                                  
                                  

                   OFFER_INST_PROD_INST_ID
100007048752
      

select a.product_instance_id,a.customer_order_id,a.op_time,a.state,a.expire_date,a.valid_date,a.op_id,a.org_id,e.city_id,b.create_date
,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id 
from bass2.dw_product_ord_cust_dm_201105 a,
       bass2.dw_product_ins_off_ins_prod_201105 b,
       bass2.dw_product_ord_offer_dm_201105 c,
       bass2.dim_qqt_offer_id d,
       bass2.dw_product_201105 e
where a.product_instance_id=e.user_id
  and a.product_instance_id=b.product_instance_id 
  and a.customer_order_id=c.customer_order_id
  and b.offer_id=d.offer_id
  and d.offer_id=c.offer_id
  --and date(b.create_date) between date('2011-05-01') and date('2011-05-31')
  and a.op_time between date('2011-05-01') and date('2011-05-31')
  --and c.op_time between date('2011-05-01') and date('2011-05-31')
  --and date(c.valid_date) between date('2011-05-01') and date('2011-05-31')
  --and c.state=1
  --and a.state=1
  --and d.index=1
  and  OFFER_INST_PROD_INST_ID =100007048752
                

  select count(0)
from bass1.g_s_22091_day where TIME_ID = 20110908




select date('2011-05-01'),
                               '890',
            count(distinct case when  offer_id in (111090001348,111090001331) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001349,111090001332) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001350,111090001333) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001334,111090001351) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001335,111090001352) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001336,111090001353) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001337,111090001354) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001338,111090001355) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001339,111090001356) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001340,111090001357) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001341,111090001358) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001342,111090001359) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001343,111090001360) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001344,111090001361) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001345,111090001362) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001363) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001364) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001365) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001366) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001367) then  product_instance_id end),
            count(distinct case when  offer_id in (111090001368) then  product_instance_id end)
                         from (
                         select a.product_instance_id,a.offer_id,a.create_date,a.expire_date,a.valid_date
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id
         from bass2.dw_product_ins_off_ins_prod_201105 a,
              bass2.dim_qqt_offer_id b
        where a.offer_id=b.offer_id
            and b.index=1
          and date(a.create_date) between date('2011-05-01') and date('2011-05-31')
                            and date(a.expire_date)>date('2011-05-01')
            ) a
                        where a.row_id=1


select date('2011-05-01'),
           '890',
                       count(distinct a.product_instance_id),
                       count(distinct case when a.valid_type=1 then a.product_instance_id  end),
                       count(distinct a.product_instance_id)-count(distinct case when a.valid_type=1 then a.product_instance_id  end)
                from bass2.dw_product_ins_off_ins_prod_201105 a,
                     bass2.dim_qqt_offer_id b
                where a.offer_id=b.offer_id
                  and b.index=1
                  and date(a.create_date) between date('2011-05-01') and date('2011-05-31')
                  and date(a.expire_date)>date('2011-05-01')







select * from    BASS1.G_S_22091_DAY



select * from    BASS1.G_S_22091_DAY

select count(0) from     BASS1.G_S_22091_DAY_P2

select * from   BASS1.G_S_22091_DAY_P2


select a from 
(
select '01' a from bass2.dual union all
select '02' a from bass2.dual union all
select '03' a from bass2.dual union all
select '04' a from bass2.dual union all
select '05' a from bass2.dual union all
select '06' a from bass2.dual union all
select '07' a from bass2.dual union all
select '08' a from bass2.dual union all
select '09' a from bass2.dual union all
select '10' a from bass2.dual union all
select '11' a from bass2.dual union all
select '12' a from bass2.dual union all
select '13' a from bass2.dual union all
select '14' a from bass2.dual union all
select '15' a from bass2.dual union all
select '16' a from bass2.dual union all
select '17' a from bass2.dual union all
select '18' a from bass2.dual union all
select '19' a from bass2.dual union all
select '20' a from bass2.dual union all
select '21' a from bass2.dual union all
select '22' a from bass2.dual union all
select '23' a from bass2.dual union all
select '24' a from bass2.dual union all
select '25' a from bass2.dual union all
select '26' a from bass2.dual union all
select '27' a from bass2.dual union all
select '28' a from bass2.dual union all
select '29' a from bass2.dual 
) t
except 
select distinct imp_accepttype from  BASS1.G_S_22091_DAY_P2


select * from    bass1.G_S_22091_DAY



select sum(bigint(VAL_BUSI_REC_CNT))
, sum(bigint(VAL_BUSI_OPEN_CNT)) 
, sum(bigint(IMP_VAL_OPEN_CNT)) 
from   BASS1.G_S_22091_DAY
where time_id = 20110908

25269	13670	3046

25269	13670	3046

delete from bass1.G_S_22091_DAY where time_id=20110908





delete from app.sch_control_task where control_code in ('BASS1_EXP_G_S_22091_DAY','BASS1_G_S_22091_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22091_DAY.tcl',
   1,
   2,
   'int -s G_S_22091_DAY.tcl',
   10000,
   - 1,
   '实体渠道业务办理日汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22091_DAY',
   1,
   2,
   'bass1_export BASS1.G_S_22091_DAY YESTERDAY()',
   10000,
   - 1,
   '实体渠道业务办理日汇总导出',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22091_DAY.tcl'
insert into app.sch_control_map
values
 (2,'G_S_22091_DAY.tcl','BASS1_G_S_22091_DAY.tcl')

delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22091_DAY.tcl'
delete from  app.sch_control_map where PROGRAM_NAME = 'BASS1_EXP_G_S_22091_DAY'

insert into app.sch_control_map
values
(2,'EXP_G_S_22091_DAY','BASS1_EXP_G_S_22091_DAY')



select * from   app.sch_control_map where program_name like '%220%'


select count(0)
from bass1.g_s_22091_day where TIME_ID = 20110908
and  channel_id not in (select CHANNEL_ID from g_i_06021_month where time_id = 201105)

\
  select count(0)
from bass1.g_s_22091_day where TIME_ID = 20110908
and  channel_id not in 
        (select CHANNEL_ID 
        from g_i_06021_month where time_id = 201105
        )
        

       
       
       
       
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22092_DAY.tcl'
insert into app.sch_control_map
values
 (2,'G_S_22092_DAY.tcl','BASS1_G_S_22092_DAY.tcl')

delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22092_DAY.tcl'
insert into app.sch_control_map
values
(2,'EXP_G_S_22092_DAY','BASS1_EXP_G_S_22092_DAY')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22092_DAY.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22092_DAY.tcl' PROGRAM_NAME
,'G_S_22092_DAY.BASS1' SOURCE_DATA
,'G_S_22092_DAY_e' OBJECTIVE_DATA
,'G_S_22092_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

delete from app.g_unit_info where unit_code='22092';
INSERT INTO app.g_unit_info 
VALUES(
   '22092',
   0,
   '实体渠道业务办理日汇总',
   'bass1.G_S_22092_DAY',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22092';
INSERT INTO app.g_unit_info 
VALUES(
   '22092',
   0,
   '实体渠道重点增值业务办理日汇总',
   'bass1.G_S_22092_DAY',
   1,
   0,
   0
   );
COMMIT;
insert into app.sch_control_before
values 
 ('BASS1_G_S_22092_DAY.tcl','BASS1_G_S_22091_DAY.tcl')
 
 
 
 select * from  G_S_22092_DAY
 


insert into app.sch_control_before
values 
 ('BASS1_EXP_G_S_22092_DAY','BASS1_G_S_22092_DAY.tcl')
 
 



delete from app.sch_control_task where control_code in ('BASS1_EXP_G_S_22092_DAY','BASS1_G_S_22092_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22092_DAY.tcl',
   1,
   2,
   'int -s G_S_22092_DAY.tcl',
   10000,
   - 1,
   '实体渠道重点增值业务办理日汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22092_DAY',
   1,
   2,
   'bass1_export BASS1.G_S_22092_DAY YESTERDAY()',
   10000,
   - 1,
   '实体渠道重点增值业务办理日汇总导出',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
select * from   bass1.G_S_22065_MONTH where time_id = 201105



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22092_DAY 
group by  time_id 
order by 1 


  select *
from bass1.g_s_22091_day where TIME_ID = 20110903
and  channel_id not in 
        (select CHANNEL_ID 
        from g_i_06021_month where time_id = 201105
        )
  
  
                                 
  select * from bass2.dim_channel_info 
  where channel_id = 100002525

select char(a.channel_id),char(date(DONE_DATE))
from bass2.dim_channel_info a
	left join (select * from  G_I_06021_MONTH
							where time_id = 201105) a1 on trim(char(a.channel_id)) = a1.channel_id
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
  and char(date(DONE_DATE)) like '2011-06%'
  
select * from bass2.ods_channel_info_20110908
where  channel_id = 100002571                      






select a.*
from bass2.dim_channel_info a
	left join (select * from  G_I_06021_MONTH
							where time_id = 201105) a1 on trim(char(a.channel_id)) = a1.channel_id
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
  and char(date(DONE_DATE)) like '2011-06%'
  and a.USER_STATE = 1
  
  
  select *
from ( 
 select 
 sum(bigint(IMP_VAL_OPEN_CNT))  a
from   BASS1.G_S_22091_DAY
where time_id = 20110908
) a,
(
 select  sum(bigint(IMP_VAL_OPEN_CNT)) 
from   BASS1.G_S_22092_DAY
where time_id = 20110908
) b 



select time_id , count(0) 
,sum(bigint(IMP_VAL_OPEN_CNT))
--,  count(distinct time_id ) 
from G_S_22091_DAY 
group by  time_id 
order by 1 


select time_id , count(0) 
--,  count(distinct time_id ) 
,sum(bigint(IMP_VAL_OPEN_CNT)) 
from G_S_22092_DAY 
group by  time_id 
order by 1 


					select distinct 
					  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0054',b.opt_region_id),'13101'),
					  b.key_num,
					  '4'
					from BASS2.dw_acct_payment_dm_201105 b,
					     BASS2.Dim_acct_paytype c
					where b.opt_code=c.paytype_id
				   and
				   (  c.paytype_name like '%自助终端%' 
				   or c.paytype_name like '%自助服务终端%'
				   )
				   and b.state='0'
				   and c.sts=1
                   


					select
						  coalesce(bass1.fn_get_all_dim('BASS_STD1_0054',char(CITY_ID)),'13101') 
						  ,product_no
						  ,'5'
						from bass2.stat_channel_reward_0007 
					WHERE channel_type in (90105,90102)
						  and op_time=201105
                          

                         
drop table "BASS1   "."G_S_22067_MONTH_1" 
CREATE TABLE "BASS1   "."G_S_22067_MONTH_1"  (
							e_product_no varchar(20)
							,type char(2)
                  )   
                 DISTRIBUTE BY HASH(e_product_no)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into app.sch_control_map
values
 (2,'G_S_22067_MONTH.tcl','BASS1_G_S_22067_MONTH.tcl')

insert into app.sch_control_map
values
(2,'EXP_G_S_22067_MONTH','BASS1_EXP_G_S_22067_MONTH')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22067_MONTH.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22067_MONTH.tcl' PROGRAM_NAME
,'G_S_22067_MONTH.BASS1' SOURCE_DATA
,'G_S_22067_MONTH_e' OBJECTIVE_DATA
,'G_S_22067_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

delete from app.g_unit_info where unit_code='22067';
INSERT INTO app.g_unit_info 
VALUES(
   '22067',
   1,
   '银行代收代缴及酬金信息',
   'bass1.g_s_22067_month',
   1,
   0,
   0
   );
COMMIT;
DELETE 
FROM app.g_unit_info 
WHERE unit_code = '22086';
INSERT INTO app.g_unit_info 
VALUES(
   '22086',
   1,
   '收费争议先退费后查证月汇总',
   'bass1.g_s_22086_month',
   1,
   0,
   0
   );
COMMIT;
select type , count(0) 
--,  count(distinct type ) 
from G_S_22067_MONTH_1 
group by  type 
order by 1 
                                  
                                  
                                select * from    APP.G_FILE_REPORT 
                                where filename like '%22092%'
                                
                                
                                select * from app.g_runlog  where unit_code = '22091'
                                
                                
                                select * from   bass2.Dw_chl_e_wap_user_mt
                                select * from   bass2.cdr_wap_dtl_20110531
                                
                                
                                select * from   bass2.dw_ow_loading_log_ds
                                
                                
                                
                                select * from   G_S_22067_MONTH
                                

                                
                                
                                
--调度配置
--BASS2_Dw_product_ms.tcl
delete from app.sch_control_before 
where control_code = 'BASS1_G_S_22067_MONTH.tcl'
insert into app.sch_control_before 
values
('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_product_ms.tcl')
,('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_wcc_user_action_ds.tcl')
,('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_kf_sms_cmd_receive_dm.tcl')
,('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_kf_cmd_hint_def_dm.tcl')
,('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_custsvc_agent_tele_dm.tcl')
,('BASS1_G_S_22067_MONTH.tcl','BASS2_Dw_acct_payment_dm.tcl')



insert into app.sch_control_before
values 
 ('BASS1_EXP_G_S_22067_MONTH','BASS1_G_S_22067_MONTH.tcl')
 
 
 
delete from app.sch_control_task where control_code in ('BASS1_EXP_G_S_22067_MONTH','BASS1_G_S_22067_MONTH.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22067_MONTH.tcl',
   2,
   2,
   'int -s G_S_22067_MONTH.tcl',
   0,
   - 1,
   '电子渠道登录信息',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22067_MONTH',
   2,
   2,
   'bass1_export BASS1.G_S_22067_MONTH LASTMONTH()',
   0,
   - 1,
   'EXPORT电子渠道登录信息',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
select * from    app.g_unit_info 


delete from app.g_unit_info where unit_code='22067';
INSERT INTO app.g_unit_info 
VALUES(
   '22067',
   1,
   '电子渠道登录信息',
   'bass1.g_s_22067_month',
   1,
   0,
   0
   );
COMMIT;
select time_id, count(0)
from G_A_02062_DAY
group by time_id 
order by 1 desc 

select * from  app.sch_control_alarm 
where  flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 

update  app.sch_control_alarm 
set flag = 0 
where flag = -1
and  control_code like 'BASS1%'

select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
except 
select interface_code from bass1.mon_all_interface 
where type = 'm'


select * from    bass2.dim_cfg_static_data 
where code_type = '911000'
and code_value in ('Q','L','I','e','D','B','6','4')



select * from    bass2.dim_cfg_static_data 
where code_name like '%自助%'


select * from    G_S_22065_MONTH where time_id = 201105
	

                                select
                                a.*,b.*
                                  from bass2.dw_product_ord_cust_201105 a,
                                       bass2.dw_product_ord_offer_dm_201105 b,
                                       bass2.dim_prod_up_product_item d,
                                       bass2.dim_pub_channel e,
                                       bass2.dim_sys_org_role_type f,
                                       bass2.dim_cfg_static_data g,
                                       bass2.dw_channel_info_201105 h
                                 where a.customer_order_id = b.customer_order_id
                                   and b.offer_id = d.product_item_id
                                   and a.org_id = e.channel_id
                                   and a.channel_type = g.code_value
                                   and g.code_type = '911000'
                                   and e.channeltype_id = f.org_role_type_id
                                   and a.org_id = h.channel_id
                                   and h.channel_type_class in (90105,90102)
                                   and a.channel_type in ('Q','L','I','e','D','B','6','4')
                                 
                                 
select tabname from syscat.tables where tabname like 'DIM%BOSS%STA%'                                    

select * from   bass2.DIM_PM_SP_OPERATOR_CODE


select * from   bass2.DIM_BOSS_STAFF where op_id in (


                                select
                                distinct a.OP_ID
                                  from bass2.dw_product_ord_cust_201105 a,
                                       bass2.dw_product_ord_offer_dm_201105 b,
                                       bass2.dim_prod_up_product_item d,
                                       bass2.dim_pub_channel e,
                                       bass2.dim_sys_org_role_type f,
                                       bass2.dim_cfg_static_data g,
                                       bass2.dw_channel_info_201105 h
                                 where a.customer_order_id = b.customer_order_id
                                   and b.offer_id = d.product_item_id
                                   and a.org_id = e.channel_id
                                   and a.channel_type = g.code_value
                                   and g.code_type = '911000'
                                   and e.channeltype_id = f.org_role_type_id
                                   and a.org_id = h.channel_id
                                   and h.channel_type_class in (90105,90102)
                                   and a.channel_type in ('Q','L','I','e','D','B','6','4')
                                 
                                 
)
order by 1 desc 

select count(0),count(distinct customer_order_id ) from   bass2.dw_product_ord_cust_201105 

select * from    BASS2.dw_product_ord_so_log_dm_201105


select count(0),count(distinct ord_cust_id ) from      BASS2.dw_product_ord_so_log_dm_201105
1	2
3004832	676228




select CHANNEL_TYPE 
--,  count(distinct CHANNEL_TYPE ) 
from BASS2.dw_product_ord_so_log_dm_201105 
group by  CHANNEL_TYPE 
order by 1 
select tabname from syscat.tables where tabname like 'DIM%CHANNEL%TYPE'   

select * from   bass2.DIM_BBOSS_CHANNEL_TYPE




select * from    bass2.dim_cfg_static_data
where code_value 
in (
select CHANNEL_TYPE 
--,  count(distinct CHANNEL_TYPE ) 
from BASS2.dw_product_ord_so_log_dm_201105 
group by  CHANNEL_TYPE 
)
and code_desc like '%渠道%'


select * from   bass1.mon_all_interface
where deadline = 13




				select
a.CHANNEL_TYPE
,count(0)
				  from bass2.dw_product_ord_cust_201105 a,
				       bass2.dw_product_ord_offer_dm_201105 b,
				       bass2.dim_prod_up_product_item d,
				       bass2.dim_pub_channel e,
				       bass2.dim_sys_org_role_type f,
				       bass2.dim_cfg_static_data g,
				       bass2.dw_channel_info_201105 h
				 where a.customer_order_id = b.customer_order_id
				   and b.offer_id = d.product_item_id
				   and a.org_id = e.channel_id
				   and a.channel_type = g.code_value
				   and g.code_type = '911000'
				   and e.channeltype_id = f.org_role_type_id
				   and a.org_id = h.channel_id
				   and h.channel_type_class in (90105,90102)
				 group by 
a.CHANNEL_TYPE
	  



select CHANNEL_TYPE , count(0) 
--,  count(distinct CHANNEL_TYPE ) 
from BASS2.dw_product_ord_so_log_dm_201105 
group by  CHANNEL_TYPE 
order by 1 





select 
         OP_TIME
        ,SO_LOG_ID
        ,ORD_CUST_ID
        ,ORD_CODE
        ,BUSI_ID
        ,OPT_CODE
        ,USER_ID
        ,BILL_ID
        ,BRAND_NAME
        ,NEW_BRAND_NAME
        ,OFFER_ID
        ,OFFER_NAME
        ,NEW_OFFER_ID
        ,NEW_OFFER_NAME
        ,CUST_ID
        ,CUST_NAME
        ,NEW_CUST_ID
        ,NEW_CUST_NAME
        ,OTHER_INFO
        ,NEW_OTHER_INFO
        ,PAY_MANNER
        ,BANK_CODE
        ,PAPER_NO
        ,TOTAL_FEE
        ,STATE
        ,CHANNEL_TYPE
        ,CHANNEL_ID
        ,CREATE_DATE
        ,DONE_DATE
        ,VALID_DATE
        ,EXPIRE_DATE
        ,OP_ID
        ,ORG_ID
        ,REGION_ID
        ,ACCT_ID
        ,USER_TYPE_ID
        ,NOTES
        ,DONE_CODE
        ,BRAND_ID
        ,NEW_BRAND_ID
        ,LOG_TYPE
        ,SYSTEM_ID
        ,OPT_REGION_ID
        ,SRC_OP_ID
        ,SRC_ORG_ID
        ,SRC_CHANNEL_TYPE
        ,VERIFY_TYPE
        ,FORCE_ROLLBACK_ORD_CODE
        ,ROLLBACK_MARK
    from     BASS2.dw_product_ord_so_log_dm_201105 

select  OPT_CODE ,count(0)
    from     BASS2.dw_product_ord_so_log_dm_201105 
group by OPT_CODE


select tabname from syscat.tables where tabname like 'DIM%OPERAT%'            




select count(0) from    
where 





select  a.CHANNEL_TYPE ,CHANNEL_TYPE_CLASS,count(0)
    from     BASS2.dw_product_ord_so_log_dm_201105  a,
    bass2.dw_channel_info_201105 b
    where a.CHANNEL_ID = b.CHANNEL_ID
group by a.CHANNEL_TYPE,CHANNEL_TYPE_CLASS


select * from   bass2.DIM_BBOSS_CHANNEL_TYPE
where  code_type in (90107)





select tabschema, tabname from syscat.tables where tabname like 'DIM%CHANNEL%'   

select 
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from bass2.dw_product_ord_cust_$op_month a,
				       bass2.dw_product_ord_offer_dm_$op_month b,
				       bass2.dim_prod_up_product_item d,
				       bass2.dim_pub_channel e,
				       bass2.dim_sys_org_role_type f,
				       (select * from bass2.dim_cfg_static_data g where g.code_type = '911000' ) g,
				       bass2.dw_channel_info_$op_month h
				 where a.customer_order_id = b.customer_order_id
				   and b.offer_id = d.product_item_id
				   and a.org_id = e.channel_id
				   and a.channel_type = g.code_value
				   and e.channeltype_id = f.org_role_type_id
				   and a.org_id = h.channel_id
group by 				   
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end



select * from   bass2.dw_product_ord_cust_201105


select 
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from bass2.dw_product_ord_cust_201105 a,
				       bass2.dw_product_ord_offer_dm_201105 b,
				       bass2.dim_prod_up_product_item d,
				       bass2.dim_pub_channel e,
				       bass2.dim_sys_org_role_type f,
				       (select * from bass2.dim_cfg_static_data g where g.code_type = '911000' ) g,
				       bass2.dw_channel_info_201105 h
				 where a.customer_order_id = b.customer_order_id
				   and b.offer_id = d.product_item_id
				   and a.org_id = e.channel_id
				   and a.channel_type = g.code_value
				   and e.channeltype_id = f.org_role_type_id
				   and a.org_id = h.channel_id
group by 				   
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end




select * from bass2.dw_product_ord_cust_dm_201105 c,
 bass2.Dw_product_ord_busi_dm_201105 a,
 bass2.Dw_product_ord_busi_other_201105 b 
 where a.customer_order_id =c.customer_order_id 
 and  a.busioper_order_id =b.busioper_order_id 
 and b.ext_6 like '%SRC=206%' 
 
 
 
 
 
select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join bass2.dw_product_ord_offer_dm_201105 b on a.customer_order_id = b.customer_order_id
				        --join bass2.dim_prod_up_product_item d on b.offer_id = d.product_item_id
				        --join bass2.dim_pub_channel e on a.org_id = e.channel_id
				        --join bass2.dim_sys_org_role_type f on  e.channeltype_id = f.org_role_type_id
				        join (select * from bass2.dim_cfg_static_data g where g.code_type = '911000' ) g on a.channel_type = g.code_value
				        --join (select * from bass2.dw_channel_info_201105  h 
                          --  where  h.channel_type_class in (90105,90102)) h on a.org_id = h.channel_id
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end




select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join bass2.dw_product_ord_offer_dm_201105 b on a.customer_order_id = b.customer_order_id
				        --join bass2.dim_prod_up_product_item d on b.offer_id = d.product_item_id
				        --join bass2.dim_pub_channel e on a.org_id = e.channel_id
				        --join bass2.dim_sys_org_role_type f on  e.channeltype_id = f.org_role_type_id
				        --join (select * from bass2.dim_cfg_static_data g where g.code_type = '911000' ) g on a.channel_type = g.code_value
				        --join (select * from bass2.dw_channel_info_201105  h 
                          --  where  h.channel_type_class in (90105,90102)) h on a.org_id = h.channel_id
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end


  

drop table BASS1.dim_ord_cfg_operation;
CREATE TABLE BASS1.dim_ord_cfg_operation(
   OPT_CODE	  VARCHAR(8) ,
   OPT_NAME	 VARCHAR(60) ,
   OPT_CLASS	 VARCHAR(255) ,
   OPT_CLASS_NAME	 VARCHAR(60) ,
   STATE	 	 VARCHAR(1) 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    OPT_CODE 
 )USING HASHING;
ALTER TABLE BASS1.dim_ord_cfg_operation
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
select * from  BASS1.dim_ord_cfg_operation
  
  
  select count(0),count(distinct busioper_order_id ) from   bass2.Dw_product_ord_busi_other_201105
  
  
  
  
  
  
  
select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
,
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join bass2.dw_product_ord_offer_dm_201105 b on a.customer_order_id = b.customer_order_id
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
					    left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
                        left join  BASS1.dim_ord_cfg_operation k on a.
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end





select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end


#


select * from     BASS1.dim_ord_cfg_operation
where OPT_NAME like '%%'






select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
								where b. log_type<>1
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end





select a.product_instance_id,max(a.valid_type) valid_type,a.create_date,a.expire_date
,a.offer_id
from bass2.dw_product_ins_off_ins_prod_201105 a 
group by 
a.product_instance_id,a.create_date,a.expire_date
,a.offer_id




select 
       count(distinct a.product_instance_id),
       count(distinct case when a.valid_type=1 then a.product_instance_id  end),
       count(distinct case when a.valid_type=2 then a.product_instance_id  end),
       count(distinct a.product_instance_id)-count(distinct case when a.valid_type=1 then a.product_instance_id  end)
from  (
select a.product_instance_id,max(a.valid_type) valid_type,a.create_date,a.expire_date
,max(a.offer_id) offer_id
from bass2.dw_product_ins_off_ins_prod_201105 a 
group by 
a.product_instance_id,a.create_date,a.expire_date
) a,
     bass2.dim_qqt_offer_id b
where a.offer_id=b.offer_id
  and b.index=1
  and date(a.create_date) between '2011-05-01' and '2011-05-31'
  and date(a.expire_date)>'2011-05-01'



select 
       count(distinct a.product_instance_id),
       count(distinct case when a.valid_type=1 then a.product_instance_id  end),
       count(distinct case when a.valid_type=2 then a.product_instance_id  end),
       count(distinct a.product_instance_id)-count(distinct case when a.valid_type=1 then a.product_instance_id  end)
from (
select a.*
,row_number()over(partition by a.product_instance_id order by a.offer_id ) rn 
from bass2.dw_product_ins_off_ins_prod_201105 a ,
 bass2.dim_qqt_offer_id b
where a.offer_id=b.offer_id
  and b.index=1
  and date(a.create_date) between '2011-05-01' and '2011-05-31'
  and date(a.expire_date)>'2011-05-01'
  ) a where a.rn = 1 
  
  
  
  
  
  
  
  
select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
,sum(case 
when k.OPT_NAME  like '%%'

 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
								where b.log_type = 1
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end






select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,OPT_NAME
,count(0)
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
								where b.log_type = 1
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end
,OPT_NAME






select sum(bigint(TERM_SALE_CNT)) from   G_S_22062_MONTH
select * from   G_S_22062_MONTH where TERM_SALE_CNT
> '0'



select *    
			from BASS2.dw_product_ord_so_log_dm_201105
            where ( offer_name like '%终端%' or offer_name like '%购机%')
            
            
            
select * from  BASS1.dim_ord_cfg_operation 
where opt_name like '%GSM号码激活%' or 
opt_name like '%普通GSM开户%'




select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,count(0)
,sum(case when   b.OPT_CODE in ('GACT1','GRW1','GRA1') then 1 else 0 end ) ACTIVATE_CNT
,sum(case when  ( offer_name like '%终端%' or offer_name like '%购机%') then 1 else 0 end ) term_cnt
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
								where b.log_type = 1
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end






select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,sum(case when b.log_type = 1 then 1 else 0 end) BUSI_REC_CNT
,sum(case when   b.OPT_CODE in ('GACT1','GRW1','GRA1') then 1 else 0 end ) ACTIVATE_CNT
,sum(case when  ( offer_name like '%终端%' or offer_name like '%购机%') then 1 else 0 end ) term_cnt
,sum(case when c.offer_type = 2 then 1 else 0 end ) VAL_BUSI_REC_CNT
,sum(case when b.log_type = 2 then 1 else 0 end) BUSI_REC_CNT
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.dw_product_ord_offer_dm_201105 c on a.customer_order_id=c.customer_order_id
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end


select count(0),count(distinct customer_order_id) from    bass2.dw_product_ord_cust_dm_201105             

select count(0),count(distinct ORD_CUST_ID ) from     BASS2.dw_product_ord_so_log_dm_201105





select 
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,sum(case when b.log_type = 1 then 1 else 0 end) BUSI_REC_CNT
,sum(case when   b.OPT_CODE in ('GACT1','GRW1','GRA1') then 1 else 0 end ) ACTIVATE_CNT
,sum(case when  ( offer_name like '%终端%' or offer_name like '%购机%') then 1 else 0 end ) term_cnt
,sum(case when c.offer_type = 2 then 1 else 0 end ) VAL_BUSI_REC_CNT
,sum(case when b.log_type = 2 then 1 else 0 end) BUSI_REC_CNT
 from 					bass2.dw_product_ord_cust_dm_201105 a
				        right join  BASS2.dw_product_ord_so_log_dm_201105  b on a.customer_order_id = b.ORD_CUST_ID
				        left join  bass2.dw_product_ord_offer_dm_201105 c on a.customer_order_id=c.customer_order_id
				        left join  bass2.Dw_product_ord_busi_dm_201105 i on a.customer_order_id =i.customer_order_id 
								left join  bass2.Dw_product_ord_busi_other_201105 j on i.busioper_order_id =j.busioper_order_id 
								left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
group by 				   
case 
when j.ext_6 like '%SRC=206%' then '04'
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end



select CHANNEL_ID, channel_type,k.opt_name,count(0) from   bass2.dw_product_ord_so_log_dm_201105 a
 join  BASS1.dim_ord_cfg_operation k on a.opt_code = k.opt_code
 where LOG_TYPE = 2 
 group by CHANNEL_ID,channel_type, k.opt_name
 



select * from       bass2.dw_product_ord_so_log_dm_201105 a
 join  BASS1.dim_ord_cfg_operation k on a.opt_code = k.opt_code
 where LOG_TYPE = 2 
 
 

select case when 
 select opt_code,paytype_name,count(0)
                                  from BASS2.dw_acct_payment_dm_201105 b,BASS2.Dim_acct_paytype c
                                where b.opt_code=c.paytype_id
                                  
                                   and b.state='0'
                                   and c.sts=1
group by opt_code,paytype_name


 
 
 

select case 
when opt_code in ('4468') then '01'
when paytype_name like '%自助%终端%' then '05'
else '00' end CHANNEL_TYPE
,sum(b.amount) amt  from BASS2.dw_acct_payment_dm_201105 b
,BASS2.Dim_acct_paytype c
where b.opt_code=c.paytype_id
   and b.state='0'
   and c.sts=1
group by
case 
when opt_code in ('4468') then '01'
when paytype_name like '%自助%终端%' then '05'
else '00' end




CREATE TABLE "BASS1   "."G_S_22066_DAY_2"  (
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "CHRG_REC_CNT" CHAR(10) 
 )   
                 DISTRIBUTE BY HASH(
                 "E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from /**table**/ fetch first 10 rows only  


select * from    BASS2.dw_product_ord_so_log_dm_201105       
 fetch first 10 rows only  
 
 
 
 
 delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22066_DAY.tcl'
insert into app.sch_control_map
values
 (2,'G_S_22066_DAY.tcl','BASS1_G_S_22066_DAY.tcl')

delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22066_DAY.tcl'
insert into app.sch_control_map
values
(2,'EXP_G_S_22066_DAY','BASS1_EXP_G_S_22066_DAY')


delete from bass1.int_program_data where PROGRAM_NAME = 'G_S_22066_DAY.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'G_S_22066_DAY.tcl' PROGRAM_NAME
,'G_S_22066_DAY.BASS1' SOURCE_DATA
,'G_S_22066_DAY_e' OBJECTIVE_DATA
,'G_S_22066_DAY_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'



select * from    bass2.dw_product_ord_cust_dm_201109

select * from    bass2.Dw_product_ord_busi_other_201105

select * from    BASS2.dw_product_ord_so_log_dm_201109
select * from    bass2.dw_product_ord_offer_dm_201109 


select * from   bass1.G_S_22066_DAY




select 
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end CHANNEL_TYPE
,char(sum(case when b.log_type = 1 then 1 else 0 end)) BUSI_REC_CNT
,char(sum(case when  b.OPT_CODE in ('GACT1','GRW1','GRA1') then 1 else 0 end )) ACTIVATE_CNT
,char(sum(case when  ( offer_name like '%终端%' or offer_name like '%购机%') then 1 else 0 end )) term_cnt
,char(sum(case when c.offer_type = 2 then 1 else 0 end )) VAL_BUSI_REC_CNT
,char(sum(case when b.log_type = 2 then 1 else 0 end)) BUSI_REC_CNT
 from                                   bass2.dw_product_ord_cust_dm_201109 a
                                        right join  BASS2.dw_product_ord_so_log_dm_201109  b on a.customer_order_id = b.ORD_CUST_ID
                                        left join  bass2.dw_product_ord_offer_dm_201109 c on a.customer_order_id=c.customer_order_id
                                                                left join  BASS1.dim_ord_cfg_operation k on b.opt_code = k.opt_code
                                                                where b.op_time = '2011-06-09'
group by                                   
case 
when a.CHANNEL_TYPE = 'B' THEN '01'
when a.CHANNEL_TYPE = 'e' THEN '02'
when a.CHANNEL_TYPE = '4' THEN '03'
when a.CHANNEL_TYPE = '6' THEN '04'
when a.CHANNEL_TYPE = '9' THEN '05'
else '00'
end

select * from   bass2.dw_product_busi_dm_201105



select * from    bass2.Dwd_cx_cdr_log_dm
 where start_time = '20110906'
 
 
 select * from  app.sch_control_task where function_desc like '%电子渠道数据%'
 
select * from    bass2.dw_chl_e_10086_user_dm_201105

 
 
          select a.user_id,a.channel_type,a.busi_kind,a.busi_type,value(sum(a.flow),0)
         from (select user_id,channel_type,busi_kind,busi_type,
                  sum(flow) as flow
               from bass2.dw_chl_e_10086_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
               union all
               select user_id,channel_type,busi_kind,busi_type,
                  sum(case when busi_kind=3 then up_flow+down_flow end) as flow
               from bass2.dw_chl_e_sms_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
               union all
               select user_id,channel_type,busi_kind,busi_type,
                  sum(case when busi_kind=3 then flow end) as flow
               from bass2.dw_chl_e_touch_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
               union all
               select user_id,channel_type,busi_kind,busi_type,
                  sum(case when busi_kind=3 then flow end) as flow
               from bass2.dw_chl_e_ussd_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
               union all
               select user_id,channel_type,busi_kind,busi_type,
                  sum(case when busi_kind=3 then flow end) as flow
               from bass2.dw_chl_e_wap_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
               union all
               select user_id,channel_type,busi_kind,busi_type,
                  sum(case when busi_kind=3 then flow end) as flow
               from bass2.dw_chl_e_web_user_dm_201105
               group by user_id,channel_type,busi_kind,busi_type
              )a
          group by a.user_id,a.channel_type,a.busi_kind,a.busi_type
          
          
         select * from  bass2.dw_chl_e_all_user_mt_201105
         
         
        select * from    bass2.stat_ecustsvc_0038


select * from    bass2.stat_ecustsvc_0038


select tabname from syscat.tables where tabname like '%ECHL%'   

select * from   bass2.Dw_chl_e_10086_user_dm_201109


select tabname from syscat.tables where tabname like '%CHL_E_100%'   
select * from   bass2.DW_CHL_E_10086_USER_DM_201109


select tabname from syscat.tables where tabname like '%BUSI%KIND%'   

select * from   bass2.DIM_E_BUSI_KIND
select tabname from syscat.tables where tabname like '%E%CHANNEL%TYPE%'   
select * from   bass2.DIM_CHANNEL_TYPE
select * from   bass2.DIM_ECHANNEL_TYPE_ST
select * from   bass2.DIM_PUB_CHANNELTYPE

select * from    bass2.dw_chl_e_touch_user_dm_20110

select * from   bass2.stat_market_channel_key_0133
select * from   bass2.dim_s_index_key_lkp
select * from   bass2.dim_t_index_key_lkp

select count(0),op_time from   bass2.dw_kf_cmd_hint_def_dm_201109
group by op_time
bass2.dwd_ow_loading_log_20110910


select count(0) from    bass2.dwd_ow_loading_log_20110531
select count(0) from    bass2.dw_ow_loading_log_201105


select * from   bass2.dwd_ow_loading_log_20110531


select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.dw_kf_cmd_hint_def_dm_201105 
group by  OP_TIME 
order by 1 


select count(0) from    bass2.Dwd_kf_cmd_hint_def_20110901



CREATE TABLE "BASS1   "."G_S_22066_DAY_QRY"  (
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   G_S_22066_DAY_REC

select * from   G_S_22066_DAY_QRY

select * from   G_S_22066_DAY




CREATE TABLE "BASS1   "."G_S_22066_DAY_REC"  (
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "BUSI_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH(
                 "E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.dw_custsvc_ivr_log_dm_201109 
group by  op_time 
order by 1 
select count(0) 
                              from  bass2.dw_custsvc_ivr_log_dm_201109
                              where (operation_code = '1008611' or operation_code = '20102')
                              and op_time = '2011-06-10'
                              
select * from   G_S_22066_DAY_REC
select sum(flow)
from (
                              select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201109
                              where operation_code = '1008611' or operation_code = '20102'
                              and op_time = '2011-06-10'
                              group by brand, calling
)a 


select sum(flow)
from (
 select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
                                    from (
                              select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201109
                              where operation_code = '1008611' or operation_code = '20102'
                              and op_time = '2011-06-10'
                              group by brand, calling
                              union all
                              select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201109
                              where operation_code = '20106'
                              and op_time = '2011-06-10' 
                              group by brand, calling
                              union all
                              select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201109
                              where operation_type <> 6
                              and op_time = '2011-06-10'
                              group by brand, calling
                                       union all
                              select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
                                       when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
                               count(*) as flow, bill_id as product_no
                              from  bass2.dw_product_ord_so_log_dm_201109
                              where length(trim(char(op_id))) = 4
                              and op_time = '2011-06-10'
                              and busi_id in (
                              select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
                              group by case when brand_name like '%全球通%' then 1
                                when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                                         )a
                                    group by busi_code_type,brand_id,product_no
) a

select count(0) 
                              from  bass2.dw_custsvc_ivr_log_dm_201104
                              where ( operation_code = '1008611' or operation_code = '20102' )
                              and op_time = '2011-04-01'

            select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
                                    from (
                              select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201104
                              where ( operation_code = '1008611' or operation_code = '20102' )
                              and op_time = '2011-04-01'
                              group by brand, calling
                              union all
                              select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201104
                              where operation_code = '20106'
                              and op_time = '2011-04-01' 
                              group by brand, calling
                              union all
                              select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
                              from  bass2.dw_custsvc_ivr_log_dm_201104
                              where operation_type <> 6
                              and op_time = '2011-04-01'
                              group by brand, calling
                                       union all
                              select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
                                       when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
                               count(*) as flow, bill_id as product_no
                              from  bass2.dw_product_ord_so_log_dm_201104
                              where length(trim(char(op_id))) = 4
                              and op_time = '2011-04-01'
                              and busi_id in (
                              select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
                              group by case when brand_name like '%全球通%' then 1
                                when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                                         )a
                                    group by busi_code_type,brand_id,product_no

select T_INDEX_ID,sum(value) from   bass2.stat_market_channel_key_0133
where S_INDEX_ID = 101 
and op_time = '2011-04-01'
group by  T_INDEX_ID




select sum(value)
from  bass2.stat_market_channel_key_0133
where   op_time = '2011-04-01' 
and T_INDEX_ID = 201
and S_INDEX_ID = 101
and city_id <> '890'
and region_id <> '999'
                                  
                                  
                                  
select sum(flow)
from (                                  
                select 2 as echl_type,busi_code_type,brand_id,sum(flow) as flow
            from (select b.parent_ob_id as busi_code_type,a.brand_id,
                      count(1) as flow,a.product_no
                   from  bass2.dw_ow_loading_log_201104 a, bass2.dim_sys_object5  b
                   where a.ob_type =1 and b.parent_ob_id in (21,23) and b.check_result = 5 and a.ob_id = b.ob_id
                      and date(a.start_time)>='2011-04-01' and date(a.start_time)<='2011-04-30'
       and (a.is_success in (0,1) or a.err_msg is null
                   or a.err_msg = 'action is null' or a.err_msg = '您当前的营销方案无法变更该促销!'
                   or a.err_msg = '您输入的服务密码校验错误：密码不正确!' or a.err_msg = 'Broken pipe')
                   group by b.parent_ob_id,a.brand_id,a.product_no
                   union all
                   select 22 as busi_code_type,b.brand_id,count(1) as flow,b.product_no
                   from  bass2.dw_product_busi_dm_201104 a, bass2.dw_product_201104 b
                   where a.user_id=b.user_id and a.user_id in (
                      select user_id from  bass2.dw_product_201104
                      where product_no in (select product_no from  bass2.dw_ow_loading_log_201104
                                           where is_success in (0,1) and date(start_time)>='2011-04-01' and date(start_time)<='2011-04-30'
                                           ) and userstatus_id>0
                      ) and a.so_mode ='15' and a.op_id=10000475
                      and date(a.so_date)>='2011-04-01' and date(a.so_date)<='2011-04-30'
                   group by b.brand_id,b.product_no
                   union all
                   select 24 as busi_code_type,b.brand_id,count(1) as flow,b.product_no
                   from  bass2.dw_acct_payitem_dm_201104 a, bass2.dw_product_201104 b
                   where a.user_id=b.user_id and a.paytype_id in ('4468')
                   group by b.brand_id,b.product_no
                  )a
            group by busi_code_type,brand_id
                                  )  t


CREATE TABLE "BASS1   "."G_S_22066_DAY_STAT"  (
              s_index_id  smallint,
              t_index_id  smallint,
              value       decimal(12,2)
)   
                 DISTRIBUTE BY HASH(
                s_index_id,t_index_id)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
bass2.dw_kf_cmd_hint_def_dm_$curr_month

select count(0) from     bass2.dw_kf_cmd_hint_def_dm_201109
                                  
                                  
select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.dw_kf_cmd_hint_def_dm_201109 
group by  OP_TIME 
order by 1 

select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.dw_product_ord_srvpkg_dm_201109
group by  op_time 
order by 1 



                                  
select * from   G_S_22066_DAY_STAT
order by 1 ,2

                   case when a.echl_type = 1 then 202
                                       when a.echl_type = 2 then 201
                                       when a.echl_type = 3 then 203
                                       when a.echl_type = 5 then 204
                                       when a.echl_type = 6 then 205
                                       else 206 end
                                       
select 
case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end E_CHANNEL_TYPE
,sum(case when a.s_index_id = 101 then value else 0 end ) BUSI_REC_CNT
,sum(case when a.s_index_id = 102 then value else 0 end ) ACTIVATE_CNT
,sum(case when a.s_index_id = 103 then value else 0 end ) TERM_SALE_CNT
,sum(case when a.s_index_id = 104 then value else 0 end ) VAL_BUSI_REC_CNT
,sum(case when a.s_index_id = 105 then value else 0 end ) CHRG_REC_CNT
,sum(case when a.s_index_id = 107 then value else 0 end ) QRY_REC_CNT
from G_S_22066_DAY_stat a
group by 
case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end
            


#S_INDEX_ID	S_INDEX_NAME	SEQ
#101	1()	1
#102	&nbsp;
&nbsp;
&nbsp;
&nbsp;
2
#103	&nbsp;
&nbsp;
&nbsp;
&nbsp;
3
#104	&nbsp;
&nbsp;
&nbsp;
&nbsp;
4
#105	2()	5
#106	3	6
#107	4()	7
                      
                      
                      
select * from   G_S_22066_DAY
                      order by 3,2
                      
delete from G_S_22066_DAY where time_id = 20110909


select 
20110910
,'20110910'
,case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end E_CHANNEL_TYPE
,sum(case when a.s_index_id = 101 then value else 0 end ) BUSI_REC_CNT
,sum(case when a.s_index_id = 102 then value else 0 end ) ACTIVATE_CNT
,sum(case when a.s_index_id = 103 then value else 0 end ) TERM_SALE_CNT
,sum(case when a.s_index_id = 104 then value else 0 end ) VAL_BUSI_REC_CNT
,sum(case when a.s_index_id = 105 then value else 0 end ) CHRG_REC_CNT
,sum(case when a.s_index_id = 107 then value else 0 end ) QRY_REC_CNT
from G_S_22066_DAY_stat a
group by 
case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end


select 
20110910
,'20110910'
,case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end E_CHANNEL_TYPE
,char(sum(case when a.s_index_id = 101 then value else 0 end )) BUSI_REC_CNT
,char(sum(case when a.s_index_id = 102 then value else 0 end )) ACTIVATE_CNT
,char(sum(case when a.s_index_id = 103 then value else 0 end )) TERM_SALE_CNT
,char(sum(case when a.s_index_id = 104 then value else 0 end )) VAL_BUSI_REC_CNT
,char(sum(case when a.s_index_id = 105 then value else 0 end )) CHRG_REC_CNT
,char(sum(case when a.s_index_id = 107 then value else 0 end )) QRY_REC_CNT
from G_S_22066_DAY_stat a
group by 
case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end
                      
                      


select 
20110910
,'20110910'
,case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end E_CHANNEL_TYPE
,char(int(sum(case when a.s_index_id = 101 then value else 0 end ))) BUSI_REC_CNT
,char(int(sum(case when a.s_index_id = 102 then value else 0 end ))) ACTIVATE_CNT
,char(int(sum(case when a.s_index_id = 103 then value else 0 end ))) TERM_SALE_CNT
,char(int(sum(case when a.s_index_id = 104 then value else 0 end ))) VAL_BUSI_REC_CNT
,char(int(sum(case when a.s_index_id = 105 then value else 0 end ))) CHRG_REC_CNT
,char(int(sum(case when a.s_index_id = 107 then value else 0 end ))) QRY_REC_CNT
from G_S_22066_DAY_stat a
group by 
case 
when a.T_INDEX_ID = 201 then '01'
when a.T_INDEX_ID = 202 then '02'
when a.T_INDEX_ID = 203 then '03'
when a.T_INDEX_ID = 204 then '04'
when a.T_INDEX_ID = 205 then '05'
else '00'
end                      




select * from   app.sch_control_task where
	 lower(control_code) like '%dwd_ow_loading_log_%'
or lower(control_code) like '%dw_kf_cmd_hint_def_dm%'
or lower(control_code) like '%dw_kf_sms_cmd_receive_dm%'
or lower(control_code) like '%dw_product_ord_so_log_dm%'
or lower(control_code) like '%product_ord_srvpkg_dm%'
or lower(control_code) like '%wcc_user_action%'






delete from app.g_unit_info where unit_code='22066';
INSERT INTO app.g_unit_info 
VALUES(
   '22066',
   0,
   '电子渠道关键数据日汇总',
   'bass1.g_s_22066_day',
   1,
   0,
   0
   );
COMMIT;
insert into app.sch_control_before
values 
 ('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_custsvc_ivr_log_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_kf_sms_cmd_receive_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dwd_ow_loading_log_ds.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_product_busi_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_product_ds.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_product_ord_cust_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_kf_sms_cmd_receive_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_kf_cmd_hint_def_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_product_ord_so_log_dm.tcl')
,('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_product_ord_srvpkg_dm.tcl')
 
insert into app.sch_control_before
values 
 ('BASS1_EXP_G_S_22066_DAY','BASS1_G_S_22066_DAY.tcl')
 
 
delete from app.sch_control_task where control_code in ('BASS1_EXP_G_S_22066_DAY','BASS1_G_S_22066_DAY.tcl');
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_G_S_22066_DAY.tcl',
   1,
   2,
   'int -s G_S_22066_DAY.tcl',
   10000,
   - 1,
   '电子渠道关键数据日汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/bass1/tcl/'
   );
INSERT INTO app.sch_control_task 
VALUES(
   'BASS1_EXP_G_S_22066_DAY',
   1,
   2,
   'bass1_export BASS1.G_S_22066_DAY YESTERDAY()',
   10000,
   - 1,
   'EXPORT电子渠道关键数据日汇总',
   'app',
   'BASS1',
   1,
   '/bassapp/backapp/bin/bass1_export/'
   );
alter table BASS1.G_S_22066_DAY ALTER column ACTIVATE_CNT  SET DATA TYPE CHARACTER(8)

alter table BASS1.G_S_22066_DAY ALTER column ACTIVATE_CNT  SET DATA TYPE CHAR(8)

drop table "BASS1   "."G_S_22066_DAY_B" 
CREATE TABLE "BASS1   "."G_S_22066_DAY"  (
                  "TIME_ID" INTEGER , 
                  "DEAL_DATE" CHAR(8) , 
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "BUSI_REC_CNT" CHAR(10) , 
                  "ACTIVATE_CNT" CHAR(8) , 
                  "TERM_SALE_CNT" CHAR(8) , 
                  "VAL_BUSI_REC_CNT" CHAR(10) , 
                  "CHRG_REC_CNT" CHAR(12) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("DEAL_DATE",  
                 "E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into  "BASS1   "."G_S_22066_DAY" 
select * from  "BASS1   "."G_S_22066_DAY_B"
select * from   G_S_22066_DAY
order by 2,3



select * from   G_S_22091_DAY


select TIME_ID , count(0) 
,sum(bigint(PAYMENT_REC_CNT))
from G_S_22091_DAY 
group by  TIME_ID 
order by 1 


IMP_VAL_OPEN_CNT


select TIME_ID , count(0) 
,sum(bigint(IMP_VAL_OPEN_CNT))
from G_S_22091_DAY 
group by  TIME_ID 
order by 1 


update bass1.mon_all_interface 
set sts = 1
where  sts = 0

select * from    bass1.mon_all_interface 
where   sts = -1 

G_I_02017_MONTH


select * from    bass1.mon_all_interface 
where interface_name like '%校%'

select * from    bass1.G_S_22403_DAY


   DW_XYSC_SCHOOL_REAL_USER_DT_201105
   Dim_xysc_lac_cell_info  
  dw_xysc_school_comp_user_dt_201105
  Dim_xysc_maintenance_info

select * from   bass2.   DW_XYSC_SCHOOL_REAL_USER_DT_201105
select * from   bass2.Dim_xysc_lac_cell_info

select * from   bass2.dw_xysc_school_comp_user_dt_201105

select * from   bass2.dw_xysc_school_new_user_mm

select * from   bass2.dw_xysc_school_new_user_xs_mm

select count(0) from     bass2.dw_xysc_school_comp_user_dt_201105 a ,
 bass2.dw_xysc_school_new_user_mm b
 where a.COMP_NO = b.PRODUCT_NO
 and  b.op_time = '2011-05-01'
 
 select * from  bass2.Dim_xysc_maintenance_info
 
 select  from  bass2.Dim_xysc_maintenance_info 
 
 select * from  g_s_22082_day  where time_id / 100 = 201105
 and BUSI_BILLING_TYPE = '20'
 order by 1




select count(*), to_char(create_time,'yyyymmdd') from (
  select * from so.i_ismp_alarm_his_0891 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0892 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0893 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0894 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0895 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0896 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501' 
union all
  select * from so.i_ismp_alarm_his_0897 where bill_flag =2 and to_char(create_time,'yyyymmdd') >= '20110501'
  )group by to_char(create_time,'yyyymmdd');
select * from   bass2.DW_THREE_ITEM_STAT_DM_201105
 where date(create_date) between '2011-05-01' and '2011-05-31'
 select tabname from syscat.tables where tabname like '%THREE_ITEM_STAT%'

select * from   bass2.ODS_THREE_ITEM_STAT_20110907
   where date(create_date) between '2011-05-01' and '2011-05-31'
select * from   g_s_22083_month where time_id = 201105
and  BUSI_BILLING_TYPE = '20'

select * from   g_s_22081_month where time_id = 201105
order by bigint(cancel_cnt) desc 


select * from   bass2.ODS_SC_SCRD_ORD_INFO_201105

insert into app.sch_control_before 
values 
('BASS1_G_S_02007_MONTH.tcl','TR1_L_11222')


select * from   app.sch_control_task where cmd_line like '%SC_SCRD_ORD%'




select trim(a)
from 
(
select ' 01005' a from bass2.dual union all
select ' 02005' a from bass2.dual union all
select ' 02006' a from bass2.dual union all
select ' 02007' a from bass2.dual union all
select ' 02014' a from bass2.dual union all
select ' 02015' a from bass2.dual union all
select ' 02016' a from bass2.dual union all
select ' 02018' a from bass2.dual union all
select ' 02019' a from bass2.dual union all
select ' 02020' a from bass2.dual union all
select ' 02021' a from bass2.dual union all
select ' 02047' a from bass2.dual union all
select ' 02049' a from bass2.dual union all
select ' 02052' a from bass2.dual union all
select ' 02053' a from bass2.dual union all
select ' 03001' a from bass2.dual union all
select ' 03002' a from bass2.dual union all
select ' 03003' a from bass2.dual union all
select ' 03004' a from bass2.dual union all
select ' 03005' a from bass2.dual union all
select ' 03007' a from bass2.dual union all
select ' 03012' a from bass2.dual union all
select ' 03015' a from bass2.dual union all
select ' 03016' a from bass2.dual union all
select ' 03017' a from bass2.dual union all
select ' 03018' a from bass2.dual union all
select ' 06011' a from bass2.dual union all
select ' 06012' a from bass2.dual union all
select ' 06021' a from bass2.dual union all
select ' 06022' a from bass2.dual union all
select ' 06023' a from bass2.dual union all
select ' 06029' a from bass2.dual union all
select ' 21003' a from bass2.dual union all
select ' 21006' a from bass2.dual union all
select ' 21008' a from bass2.dual union all
select ' 21010' a from bass2.dual union all
select ' 21011' a from bass2.dual union all
select ' 21012' a from bass2.dual union all
select ' 21013' a from bass2.dual union all
select ' 21014' a from bass2.dual union all
select ' 21015' a from bass2.dual union all
select ' 21020' a from bass2.dual union all
select ' 05001' a from bass2.dual union all
select ' 05002' a from bass2.dual union all
select ' 05003' a from bass2.dual union all
select ' 22013' a from bass2.dual union all
select ' 22021' a from bass2.dual union all
select ' 22025' a from bass2.dual union all
select ' 22032' a from bass2.dual union all
select ' 22033' a from bass2.dual union all
select ' 22039' a from bass2.dual union all
select ' 22041' a from bass2.dual union all
select ' 22042' a from bass2.dual union all
select ' 22043' a from bass2.dual union all
select ' 22009' a from bass2.dual union all
select ' 22049' a from bass2.dual union all
select ' 22050' a from bass2.dual union all
select ' 22052' a from bass2.dual union all
select ' 22055' a from bass2.dual union all
select ' 22056' a from bass2.dual union all
select ' 22061' a from bass2.dual union all
select ' 22063' a from bass2.dual union all
select ' 22067' a from bass2.dual union all
select ' 22068' a from bass2.dual union all
select ' 22101' a from bass2.dual union all
select ' 22103' a from bass2.dual union all
select ' 22105' a from bass2.dual union all
select ' 22106' a from bass2.dual union all
select ' 22204' a from bass2.dual union all
select ' 22036' a from bass2.dual union all
select ' 22040' a from bass2.dual union all
select ' 22072' a from bass2.dual union all
select ' 22303' a from bass2.dual union all
select ' 22304' a from bass2.dual union all
select ' 22305' a from bass2.dual union all
select ' 22306' a from bass2.dual union all
select ' 22307' a from bass2.dual union all
select ' 22081' a from bass2.dual union all
select ' 22083' a from bass2.dual union all
select ' 22085' a from bass2.dual union all
select ' 22086' a from bass2.dual 
) a
except 
select unit_code from app.g_runlog where time_id = 201105
and  return_flag=1

select * from    bass1.g_s_21007_Day where time_id = 20110914


                 select      201105 TIME_ID
                             ,'201105' op_time
                             ,a.BUSI_CODE
                             ,substr(c.OPERATOR_NAME,1,60) BUSI_NAME
                             ,substr(d.SP_NAME,1,60) BUSI_PROVIDER_NAME
                             ,case when b.bill_flag = 3 then '10' 
                               else '20' end  BUSI_BILLING_TYPE         
                             ,char(sum(a.CANCEL_CNT))   CANCEL_CNT 
                             ,char(sum(a.COMPLAINT_CNT)) COMPLAINT_CNT   
                             ,char(sum(value(e.ORDER_CNT,0))) ORDER_CNT      
                        from   bass1.G_S_22083_MONTH_1 a 
                               join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
                               join bass2.DIM_PM_SP_OPERATOR_CODE c on  a.SP_ID = char(c.SP_CODE) and a.BUSI_CODE = c.OPERATOR_CODE
                                JOIN BASS1.G_S_22083_MONTH_3 D ON a.sp_id = d.SP_CODE
                                left join BASS1.G_S_22083_MONTH_4 e on a.sp_id = e.SP_ID and a.BUSI_CODE = e.BUSI_CODE
                        group by 
                     a.BUSI_CODE
                     ,substr(c.OPERATOR_NAME,1,60)
                     ,substr(d.SP_NAME,1,60)
                     ,case when b.bill_flag = 3 then '10' 
                               else '20' end
                               


select count(0),count(distinct OP_TIME||BUSI_CODE||BUSI_NAME ) from     BASS1.G_S_22083_MONTH

select * from   BASS1.G_S_22083_MONTH                               
where time_id = 201105


CREATE TABLE "BASS1   "."G_S_22083_MONTH_B0615"  (
                  "TIME_ID" INTEGER , 
                  "OP_TIME" CHAR(6) , 
                  "BUSI_CODE" CHAR(20) , 
                  "BUSI_NAME" CHAR(60) , 
                  "BUSI_PROVIDER_NAME" CHAR(60) , 
                  "BUSI_BILLING_TYPE" CHAR(2) , 
                  "CANCEL_CNT" CHAR(12) , 
                  "COMPLAINT_CNT" CHAR(12) , 
                  "ORDER_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "BUSI_CODE",  
                 "BUSI_NAME")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
INSERT INTO G_S_22083_MONTH_B0615
SELECT * FROM G_S_22083_MONTH
where time_id = 201105



select * from   bass1.G_S_22083_MONTH_1 where busi_code = '100203'


                 select      201105 TIME_ID
                             ,'201105' op_time
                             ,a.BUSI_CODE
                             ,a.sp_id
                             ,substr(c.OPERATOR_NAME,1,60) BUSI_NAME
                             ,substr(d.SP_NAME,1,60) BUSI_PROVIDER_NAME
                             ,case when b.bill_flag = 3 then '10' 
                               else '20' end  BUSI_BILLING_TYPE         
                             ,char(sum(a.CANCEL_CNT))   CANCEL_CNT 
                             ,char(sum(a.COMPLAINT_CNT)) COMPLAINT_CNT   
                             ,char(sum(value(e.ORDER_CNT,0))) ORDER_CNT      
                        from   bass1.G_S_22083_MONTH_1 a 
                               join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
                               join bass2.DIM_PM_SP_OPERATOR_CODE c on  a.SP_ID = char(c.SP_CODE) and a.BUSI_CODE = c.OPERATOR_CODE
                                JOIN BASS1.G_S_22083_MONTH_3 D ON a.sp_id = d.SP_CODE
                                left join BASS1.G_S_22083_MONTH_4 e on a.sp_id = e.SP_ID and a.BUSI_CODE = e.BUSI_CODE
                                where  a.busi_code = '100203'
                        group by 
                     a.BUSI_CODE
                     ,a.sp_id
                     ,substr(c.OPERATOR_NAME,1,60)
                     ,substr(d.SP_NAME,1,60)
                     ,case when b.bill_flag = 3 then '10' 
                               else '20' end

select * from    bass2.DIM_PM_SP_OPERATOR_CODE  c
where   c.OPERATOR_CODE = '100203' and c.
                            
                            
                            BUSI_CODE	SP_ID
100203	698001
100203	698001

select count(0) from    bass2.DIM_PM_SP_OPERATOR_CODE
select count(0) from     BASS1.G_S_22083_MONTH_3


select * from    bass2.DIM_PM_SP_OPERATOR_CODE
select count(0),count(distinct OPERATOR_CODE||SP_CODE )
from 
(
select 
         OPERATOR_CODE
        ,char(SP_CODE) SP_CODE
        ,BILL_FLAG
        ,SP_TYPE
        ,OPERATOR_NAME
        from 
       ( select a.*,row_number()over(partition by OPERATOR_CODE,SP_CODE order by OPERATOR_NAME desc )  rn 
             from bass2.DIM_PM_SP_OPERATOR_CODE a 
       ) c where rn = 1 
) t        

select * from    bass2.DIM_PM_SP_OPERATOR_CODE
where  OPERATOR_CODE = 'FXSJHYDG'




                         select 
                               *
                                from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105  a 
                                where  RSP_SEQ LIKE '10086901%'
                                and char(date(CREATE_DATE)) like  '2011-05%' 
                                and ext4 is not null 
                                and ext4 = '30820002' 
                         with ur 
                         

SELECT 
* FROM DW_NEWBUSI_ISMG_201105 WITH UR;
select * from  bass2.DW_NEWBUSI_ISMG_201105 
where SP_CODE = '600902'
                     
select * from    bass2.DIM_PM_SP_OPERATOR_CODE

                     
select * from   bass2.cdr_ismg_dtl_20110914
where SP_CODE = '600902'


600902002004478155  

201105	201105	600906002000005001  	50                                                	                                                    	10	30          	0           	13888     
201105	201105	600902002004478155  	                                              	                                                	20	3           	0           	0         
201105	201105	600902002002084961  	DJNANANA                                            	                                                	20	3           	0           	0         


  SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
  where EXTEND_ID2 = '600906002000005001'
  
  select * from bass2.DW_PRODUCT_INS_OFF_INS_PROD_201105 
  where ext3 = 600902
  fetch first 10 rows only    
  
  select * from bass2.DIM_PROD_UP_PRODUCT_ITEM 
  where SUPPLIER_ID = '600902'
  
select EXTEND_ID2 , count(0) 
--,  count(distinct EXTEND_ID2 ) 
from bass2.DIM_PROD_UP_PRODUCT_ITEM 
group by  EXTEND_ID2 
order by 1 


select * from   BASS1.G_S_22082_DAY_1

select * from    BASS1.G_S_22082_DAY_2

select tabname from syscat.tables where tabname like '%NEWBUSI%KJ%'   

select * from  bass2.DW_NEWBUSI_KJ_201102  a
where CHARGE4 = 0 
and exists (select 1 from  BASS1.G_S_22082_DAY_2 b  where  a.OPER_CODE = b.BUSI_CODE and a.SP_CODE = b.sp_id 
 and BILL_FLAG = 2 )
 
 select length('600906002000005002') from bass2.dual
 

select * from   VGOP_D_15210

select b.sp_id,b.BUSI_CODE,count(0)
,sum(case when BILL_COUNTS = 0 then COUNTS else 0 end ) tuiding_cnt
,sum(BILL_COUNTS ) tuiding_cnt
from   bass2.DW_NEWBUSI_KJ_201105  a ,
  BASS1.G_S_22082_DAY_1 b 
  where  a.OPER_CODE = b.BUSI_CODE and a.SP_CODE = b.sp_id 
  group by b.sp_id,b.BUSI_CODE
  
  
select * from     BASS1.G_S_22082_DAY_1

select count(0),count(distinct sp_id||busi_code) from     BASS1.G_S_22082_DAY_1
-rw-r--r--+  1 bass2    appdb       6400  4月 21日 21:47 Cdr_kj_ds.tcl
-rw-r--r--+  1 bass2    appdb       4367  4月 29日 21:33 Cdr_kj_dtl_ds.tcl
-rw-r--r--+  1 bass2    appdb       4585  4月 29日 21:35 Dw_newbusi_kj_ds.tcl
-rw-r--r--+  1 bass2    appdb      10899  4月 29日 21:35 Dw_newbusi_kj_dt.tcl


select * from   


600906	600906003000005000	7340	53456	5928
600906	600906002000005001	9339	9111	7021
600906	600906002000005002	4823	4282	3702


select * from    bass2.DIM_PM_SP_OPERATOR_CODE
where OPERATOR_CODE in ('600906003000005000','600906002000005001','600906002000005002')


select * from  bass2.DW_NEWBUSI_KJ_201105  a
where CHARGE4 = 0 
and exists (select 1 from   bass2.DIM_PM_SP_OPERATOR_CODE b  where  a.OPER_CODE = b.OPERATOR_CODE and a.SP_CODE = char(b.SP_CODE) 
 and length(b.OPERATOR_CODE ) = 18
 and BILL_FLAG = 2
 )
 
 
 
 
 OPER_CODE
600902000004380418
600902000004380420
600902000004380420


OPER_CODE
600902000004380418
600902000004365015
600902015000005175


select * from    bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105 where 
ext4 = '600902015000005175'

select * from    BASS1.G_S_22083_MONTH_1 where busi_code = '600902015000005175'

select *    
                                from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105  a 
                                where 
                                --RSP_SEQ LIKE '10086901%'
                                --and char(date(CREATE_DATE)) like  '2011-05%' 
                                --and ext4 is not null 
                                 ext4 = '600902015000005175'
                                 

                         select 
                                ext1 sp_id
                                ,ext4 sp_busi_code
                                ,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) cancel_cnt
                                ,0 complaint_cnt
                                from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_201105  a 
                                where 
                                --RSP_SEQ LIKE '10086901%'
                                --and char(date(CREATE_DATE)) like  '2011-05%' 
                                --and ext4 is not null 
                                 ext4 = '600902015000005175'
                                group by 
                                ext1
                                ,ext4
                         with ur 
                         
                         
select  char(SP_ID) SP_ID
              					,SP_CODE
              					,count(0) CANCEL_BUSI_CNT
                       from   
                       	BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201105 a
                        group by char(SP_ID),SP_CODE



select a.SP_CODE,a.OPER_CODE
,sum(case when BILL_COUNTS = 0 then COUNTS else 0 end ) tuiding_cnt
,sum(BILL_COUNTS ) order_cnt
from   bass2.DW_NEWBUSI_KJ_201105  a 
where exists (select 1 from  G_S_22083_MONTH_1 b  where  a.OPER_CODE = b.BUSI_CODE and a.SP_CODE = char(b.SP_ID) 
  )
  group by a.SP_CODE,a.OPER_CODE
  order by 4 desc 
  
  
  
  CREATE TABLE "BASS1   "."G_S_22083_MONTH_5"  (
                  "SP_ID" VARCHAR(20) , 
                  "BUSI_CODE" VARCHAR(20) , 
                  "CANCEL_CNT" INTEGER , 
                  "ORDER_CNT" INTEGER )   
                 DISTRIBUTE BY HASH("SP_ID",  
                 "BUSI_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from    BASS1.G_S_22083_MONTH_1
                         
                         
select * from   G_S_22083_MONTH
where time_id = 201105

  
 select count(0) dup_cnt
        from (
                select OP_TIME||BUSI_CODE||BUSI_NAME,  count(0)  cnt
                from bass1.G_S_22083_MONTH
                where time_id =201105
                group by OP_TIME||BUSI_CODE||BUSI_NAME having count(0) > 1
                ) t 
                

201105-SHQM                                                                   	2

select count(0),count(distinct SP_CODE ) from    BASS1.G_S_22083_MONTH_3 
select * from    bass1.G_S_22083_MONTH_1
where BUSI_CODE = '-SHQM'


select * from G_S_22083_MONTH 
where BUSI_CODE = '-SHQM'



select * from   BASS1.G_S_22083_MONTH


201104	201104	TQMF                	                                                  	                                            	10	24          	0           	116       
201104	201104	-TQLS               	                                                	                                            	10	12          	0           	116       
201104	201104	-TQSNLZ             	                                                	                                            	10	12          	0           	116       

select * from    bass1.G_S_22083_MONTH
where busi_code = '-TQLS'


select * from   BASS1.G_S_22083_MONTH_4
where busi_code in (
select busi_code from  BASS1.G_S_22083_MONTH
where BUSI_PROVIDER_NAME like '%深圳市创世互动科技有限公司%'
)




 select      201105 TIME_ID
                             ,'201105' op_time
                             ,a.BUSI_CODE
                             ,substr(c.OPERATOR_NAME,1,60) BUSI_NAME
                             ,substr(d.SP_NAME,1,60) BUSI_PROVIDER_NAME
                             ,case when b.bill_flag = 3 then '10' 
                               else '20' end  BUSI_BILLING_TYPE         
                             ,char(sum(value(f.cancel_cnt,a.CANCEL_CNT)))       CANCEL_CNT 
                             ,char(sum(a.COMPLAINT_CNT)) COMPLAINT_CNT   
                             ,char(sum(value(value(f.ORDER_CNT,e.order_cnt),0))) ORDER_CNT           
                        from   bass1.G_S_22083_MONTH_1 a 
                               join  bass1.G_S_22083_MONTH_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE
                               join table(
                                                                                                                        select 
                                                                                                         OPERATOR_CODE
                                                                                                        ,char(SP_CODE) SP_CODE
                                                                                                        ,BILL_FLAG
                                                                                                        ,SP_TYPE
                                                                                                        ,OPERATOR_NAME
                                                                                                        from 
                                                                                                       ( select a.*,row_number()over(partition by OPERATOR_CODE,SP_CODE order by OPERATOR_NAME desc )  rn 
                                                                                                             from bass2.DIM_PM_SP_OPERATOR_CODE a 
                                                                                                       ) c where rn = 1 
                                                                                                        )         c on  a.SP_ID = char(c.SP_CODE) and a.BUSI_CODE = c.OPERATOR_CODE
                                JOIN BASS1.G_S_22083_MONTH_3 D ON a.sp_id = d.SP_CODE
                                left join BASS1.G_S_22083_MONTH_4 e on a.sp_id = e.SP_ID and a.BUSI_CODE = e.BUSI_CODE
                                left join BASS1.G_S_22083_MONTH_5 f on a.sp_id = f.SP_ID and a.BUSI_CODE = f.BUSI_CODE
                                where d.SP_NAME = '手机阅读'
                        group by 
                     a.BUSI_CODE
                     ,substr(c.OPERATOR_NAME,1,60)
                     ,substr(d.SP_NAME,1,60)
                     ,case when b.bill_flag = 3 then '10' 
                               else '20' end
                        having sum(value(f.cancel_cnt,a.CANCEL_CNT)) > 0      
                        
                        




select * from   bass1.G_S_22083_MONTH where time_id = 201105
and bigint(CANCEL_CNT)>bigint(ORDER_CNT)

1
201105-SHQM                                                                   

 select count(0) dup_cnt
        from (
                select OP_TIME||BUSI_CODE||BUSI_NAME, count(0)  cnt
                from bass1.G_S_22083_MONTH
                where time_id =201105
                group by OP_TIME||BUSI_CODE||BUSI_NAME having count(0) > 1
                ) t 

select *                 from bass1.G_S_22083_MONTH
                where time_id =201105
                and BUSI_CODE = '-SHQM'
                
select count(0),count(distinct SP_ID ) from    bass1.G_S_22083_MONTH_1                


select * from   bass2.DW_PRODUCT_SP_INFO_201105      


select * from    bass1.G_S_22083_MONTH where time_id = 201105



                select *
                from bass1.G_S_22083_MONTH
                where time_id =201105
                
                

select * from    BASS1.G_S_22082_DAY


CREATE TABLE "BASS1   "."G_S_22082_DAY"  (
                  "OP_TIME" CHAR(8) , 
                  "BUSI_BILLING_TYPE" CHAR(2) , 
                  "ALERT_SMS_CNT" CHAR(12) , 
                  "REPLY_SMS_CNT" CHAR(12) , 
                  "CANCEL_CNT" CHAR(12) , 
                  "HOTLINE_OUT_CNT" CHAR(12) , 
                  "COMPLAINT_CNT" CHAR(12) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "BUSI_BILLING_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
drop table "BASS1   "."G_S_22082_DAY_3" 

CREATE TABLE "BASS1   "."G_S_22082_DAY_3"  (
                  "SP_CODE" VARCHAR(20) , 
                  "OPER_CODE" VARCHAR(20) , 
                  "CANCEL_CNT" integer )
                 DISTRIBUTE BY HASH("SP_CODE",  
                 "OPER_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select 
				 a.SP_CODE
				,a.OPER_CODE
				,sum(case when BILL_COUNTS = 0 then COUNTS else 0 end ) CANCEL_CNT
	from   bass2.dw_newbusi_kj_20110914  a 
	where exists (select 1 from  G_S_22082_DAY_1 b  where  a.OPER_CODE = b.BUSI_CODE
				 and a.SP_CODE = char(b.SP_ID) 
	  )
	  and not exists (select 1 from G_S_22082_DAY_3 c where a.OPER_CODE = c.OPER_CODE
	  								 and a.sp_code = c.sp_code)
	  group by a.SP_CODE,a.OPER_CODE


select * from    bass1.G_S_22082_DAY
where time_id = 20110914
select * from    bass1.G_S_22082_DAY_B0615
where time_id = 20110914

      



CREATE TABLE "BASS1   "."G_S_22082_DAY_B0615"  (
                  "TIME_ID" INTEGER , 
                  "OP_TIME" CHAR(8) , 
                  "BUSI_BILLING_TYPE" CHAR(2) , 
                  "ALERT_SMS_CNT" CHAR(12) , 
                  "REPLY_SMS_CNT" CHAR(12) , 
                  "CANCEL_CNT" CHAR(12) , 
                  "HOTLINE_OUT_CNT" CHAR(12) , 
                  "COMPLAINT_CNT" CHAR(12) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "BUSI_BILLING_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into G_S_22082_DAY_B0615
select * from   G_S_22082_DAY

      
     select * from  G_S_22082_DAY_3

     
insert into app.sch_control_before 
select 'BASS1_G_S_22082_DAY.tcl','BASS2_Dw_newbusi_kj_ds.tcl' from bass2.dual

delete from G_S_22082_DAY where time_id = 20110914
insert into G_S_22082_DAY
select * from G_S_22082_DAY_B0615
where  time_id = 20110914


select * from   G_S_22082_DAY
where  time_id = 20110915



			select  char(SP_ID) SP_ID
					,SP_CODE
					,count(0) CANCEL_BUSI_CNT
                    ,count(distinct PHONE_ID ) CANCEL_BUSI_CNT
	       from   
	       	BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201109 a
	       	where replace(char(date(a.create_date)),'-','') = '20110915'
	       	and (PHONE_ID,char(SP_ID),SP_CODE) in ( select BILL_ID,EXT1,EXT4
									       	from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201109  b
												where  RSP_SEQ LIKE '10086901%' 
												and  b.OP_TIME  = '2011-06-15'
												and  replace(char(date(b.create_date)),'-','') = '20110915' 
												and ext4 is not null 
                                                and replace(char(date(a.create_date)),'-','') 
                                                <= replace(char(date(b.create_date)),'-','')
									     )
	        group by char(SP_ID),SP_CODE
            



                         select 
                                replace(char(date(a.create_date)),'-','')
                                ,ext1 sp_id
                                ,ext4 sp_busi_code
                                ,count(0) alert_sms_cnt
                                ,count(distinct case when trim(confirm_code) <>'是' 
                                        and return_message is not null 
                                      then bill_id||RSP_SEQ||ext1||ext4 end ) reply_sms_cnt
                                ,sum(case when trim(confirm_code) <>'是' and  trim(confirm_code) = trim(return_message)  
                                        then 1 else 0 end ) cancel_cnt
                                ,0 hotline_out_cnt
                                ,0 complaint_cnt
select a.*                                 
                                from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201109  a 
                                where  RSP_SEQ LIKE '10086901%' 
                                and  a.OP_TIME  = '2011-06-15'
                                and  replace(char(date(a.create_date)),'-','') = '20110915' 
                                and ext4 is not null 
                                AND return_message is not null
                                group by 
                                 replace(char(date(a.create_date)),'-','')
                                ,ext1
                                ,ext4
                         with ur 


select * from   	BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201104


select * from   g_s_22083_month 
where time_id = 201105
                         
                         
select type,deadline,count(0)
from mon_all_interface
where sts <> -1
group by type,deadline
order by 1,2


select * from    mon_all_interface     
where type = 'm'                    





select count(user_id) 
                    from bass2.dw_product_20110913
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1



        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110913 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110913 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1




                        select count(distinct user_id) from session.int_check_user_status
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110913



select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110913                       
except
select user_id 
from bass2.dw_product_20110913  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1


                          
89157331553471 



select * from   session.int_check_user_status  
where user_id in 
(
 '89157331553471'
)
 
 
 USER_ID
89660000839916 
89660000845386 

select usertype_id,day_off_mark,userstatus_id,test_mark from   bass2.dw_product_20110913
where user_id in 
(
 '89157331553471'
)
 



select user_id, usertype_id,day_off_mark,userstatus_id,test_mark from   bass2.dw_product_20110913
where user_id in 
(
 '89157331553471'
)
 


select * from    bass2.dw_product_bass1_20110913
where user_id in 
(
 '89157331553471'
)


select * from   bass2.dw_product_bass1_20110913
where user_id in 
(
 '89157331553471'
)


select * from   bass1.g_a_02004_day
where USER_ID = '89660000839916'

select * from   bass1.g_a_02008_day
where USER_ID = '89660000839916'

                          
select * from   bass2.dw_product_20110912
where user_id in (
select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110913                       
except
select user_id 
from bass2.dw_product_20110913  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
)


select day_off_mark,count(0) from    bass2.dw_product_20110913 where  
userstatus_id = 5
group by day_off_mark

select * from   bass1.mon_all_interface where interface_code = '22201'

select * from   g_s_22012_day where time_id = 20110913



select * from    session.int_check_user_status    
where user_id = '89157331553471'                         
select * from   bass1.g_a_02008_day
where user_id = '89157331553471'   
select * from  so.his_dsmp_sms_send_message 


select * from    bass1.G_S_22083_MONTH

select * from   BASS1.G_S_22083_MONTH_4 
select * from     BASS1.G_S_22083_MONTH_3
select count(0),count(distinct sp_code ) from     BASS1.G_S_22083_MONTH_3
select count(0),count(distinct SP_ID||BUSI_CODE ) from     BASS1.G_S_22083_MONTH_4 
select * from   G_S_22082_DAY where time_id = 20110915

select * from   BASS1.G_S_22082_DAY


select a.*
				from bass2.DW_HIS_DSMP_SMS_SEND_MESSAGE_DM_201109  a 
				where  RSP_SEQ LIKE '10086901%' 
				and  a.OP_TIME  = '2011-06-15'
				and  replace(char(date(a.create_date)),'-','') = '20110915' 
				and ext4 is not null 
                and ( trim(confirm_code) = trim(return_message))
                select * from   BASS1.MON_ALL_INTERFACE 
where interface_code = '22082'



select time_id , sum(bigint(D_COMM_USERS)) 
from G_S_22038_DAY 
where time_id between 20110901 and 20110916
group by time_id
order by 1 desc 



select tabname from syscat.tables where tabname like '%XYSC_NEW_USER%'   


select * from   bass1.mon_all_interface where interface_code = '22402'

--暂缓
select * from   bass1.int_program_data
where program_name like '%22402%'



select * from bass2.



 select   distinct    20110901 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
        from  bass2.DW_THREE_ITEM_STAT_DM_201105 a 
        where replace(char(date(a.create_date)),'-','') like  '201105%' 
              and    replace(char(date(a.create_date)),'-','') between '20110501' and '20110531'
              
                                

 select   distinct   replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
        from  bass2.DW_THREE_ITEM_STAT_DM_201105 a 
        where replace(char(date(a.create_date)),'-','') =  '20110501' 
              and    replace(char(date(a.create_date)),'-','') between '20110501' and '20110531'
                                             

select * from   G_A_02056_DAY

                                             
                                             

select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201104
and ent_busi_id = '1210'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201104
and ent_busi_id = '1210'
) t
 

select count(0),count(distinct sp_code ) from    BASS1.G_S_22081_MONTH_2



                select   substr(replace(char(date(a.create_date)),'-',''),1,6) op_time
                         ,a.sp_code BUSI_CODE
                         ,a.name BUSI_NAME
                         ,char(a.sp_id) sp_id
                         ,b.sp_name BUSI_PROVIDER_NAME
                         ,count(distinct case when a.sts = 1 then a.phone_id||char(a.sp_id)||a.sp_code  end ) CANCEL_CNT
                         ,count(0) cancel_cnt2
                         ,'0' ORDER_CNT
                         from  bass2.dw_product_unite_cancel_order_201105 a ,
                                BASS1.G_S_22081_MONTH_2 b 
                         where char(a.sp_id) = b.sp_code
                          and substr(replace(char(date(a.create_date)),'-',''),1,6) = '201105'
                         group by substr(replace(char(date(a.create_date)),'-',''),1,6)
                          ,a.sp_code
                         ,a.name
                         ,char(a.sp_id)
                         ,b.sp_name
order by 7 desc 

select * from   g_a_06001_day                                             

select * from   BASS1.MON_ALL_INTERFACE 
where interface_code = '06001'




select distinct 
         SCHOOL_ID
        ,SCHOOL_NAME
        ,case when city_id = '891' then '13101'
                              when city_id = '892' then '13102'
                              when city_id = '893' then '13103'
                              when city_id = '894' then '13104'
                              when city_id = '895' then '13105'
                              when city_id = '896' then '13106'
                              when city_id = '897' then '13107'
                        end
        ,case when school_type in ('4','5') then '1' else '2' end 
        ,char(SCH_SIZE_STUS)
        ,'0' SCH_SIZE_NEW
from      bass2.Dim_xysc_maintenance_info
except
select 
         SCHOOL_ID
        ,SCHOOL_NAME
        ,CMCC_BRANCH_ID
        ,SCHOOL_TYPE
        ,STUD_CNT
        ,NEWSTUD_CNT
from ( 
			select a.*
			,row_number()over(partition by SCHOOL_ID order by time_id desc ) rn 
		  from G_A_06001_DAY a 
		  where time_id < 20110916
     ) o where o.rn = 1
     
     
     

select count(0) from    G_A_06001_DAY




CREATE TABLE "BASS1   "."G_A_06001_DAY"  (
                  "TIME_ID" INTEGER , 
                  "SCHOOL_ID" CHAR(20) , 
                  "SCHOOL_NAME" CHAR(60) , 
                  "CMCC_BRANCH_ID" CHAR(5) , 
                  "SCHOOL_TYPE" CHAR(1) , 
                  "STUD_CNT" CHAR(6) , 
                  "NEWSTUD_CNT" CHAR(6) , 
                  "STATE" CHAR(1) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "SCHOOL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
DROP TABLE "BASS1   "."G_A_06001_DAY" 
CREATE TABLE "BASS1   "."G_A_06001_DAY"  (
                  "TIME_ID" INTEGER , 
                  "SCHOOL_ID" CHAR(20) , 
                  "SCHOOL_NAME" CHAR(60) , 
                  "CMCC_BRANCH_ID" CHAR(5) , 
                  "SCHOOL_TYPE" CHAR(1) , 
                  "STUD_CNT" CHAR(6) , 
                  "NEWSTUD_CNT" CHAR(6) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "SCHOOL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   bass1.G_A_06001_DAY


select tabname from syscat.tables where tabname like '%XYSC%'                      

select * from   bass2.DW_XYSC_SCHOOL_NEW_USER_MM
select * from bass2.DW_XYSC_SCHOOL_NEW_USER_XS_MM

select * from    bass1.G_I_06002_MONTH
   
 select * from   
(
select * from   APP.SMS_SEND_INFO
order by message_id desc 
) a
fetch first 100 rows only 

select * from bass2.Cdr_call_dtl_20110917 fetch first 10 rows only
select count(0) from bass2.Cdr_call_dtl_20110916
10578566
10794060


6025316
6301355

BASS2_Cdr_sms_dtl_ds.tcl

select * from /**table**/ fetch first 10 rows only 

select count(0) from    bass2.dw_product_bass1_20110917
select count(0) from    bass2.dw_product_20110917


select 'xxxxx', count(0) from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 with ur
                                    


select control_code from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 with ur
                                    




select trim(a) from 
(
select '01002' a from bass2.dual union all 
select '01004' a from bass2.dual union all 
select '01006' a from bass2.dual union all 
select '01007' a from bass2.dual union all 
select '02011' a from bass2.dual union all 
select '02053' a from bass2.dual union all 
select '02054' a from bass2.dual union all 
select '02055' a from bass2.dual union all 
select '02056' a from bass2.dual union all 
select '02057' a from bass2.dual union all 
select '02058' a from bass2.dual union all 
select '02059' a from bass2.dual union all 
select '02061' a from bass2.dual union all 
select '02062' a from bass2.dual union all 
select '02064' a from bass2.dual union all 
select '06001' a from bass2.dual union all 
select '02022' a from bass2.dual union all 
select '02023' a from bass2.dual union all 
select '02063' a from bass2.dual union all 
select '06031' a from bass2.dual union all 
select '06032' a from bass2.dual union all 
select '04003' a from bass2.dual union all 
select '04005' a from bass2.dual union all 
select '04014' a from bass2.dual union all 
select '04016' a from bass2.dual union all 
select '04017' a from bass2.dual union all 
select '21007' a from bass2.dual union all 
select '22066' a from bass2.dual union all 
select '22073' a from bass2.dual union all 
select '22080' a from bass2.dual union all 
select '22082' a from bass2.dual union all 
select '22084' a from bass2.dual union all 
select '22091' a from bass2.dual union all 
select '22092'  a from bass2.dual union all
select '22102'  a from bass2.dual union all
select '22104'  a from bass2.dual union all
select '22202'  a from bass2.dual union all
select '22203'  a from bass2.dual union all
select '22301'  a from bass2.dual union all
select '22302'  a from bass2.dual ) t 
except 
select substr(control_code , 15,5)
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 with ur


select *
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%01004%DAY%' 
									and date(a.begintime) =  date(current date) 
									 with ur                                    
                                     
                                     

select *
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%' 
									and date(a.begintime) =  date(current date) 

update app.sch_control_runlog  a
set flag = -2 
where control_code = 'BASS1_INT_CHECK_Z345_DAY.tcl'
and date(a.begintime) =  date(current date) 
                                     
                                     
BASS1_INT_CHECK_Z345_DAY.tcl

select  
count(0)
,count(distinct a.unit_code)
,count(distinct b.unit_code)
from 
table(
select unit_code from  app.g_runlog
where time_id = int(replace(char(current date - 1 days),'-',''))
) a
full join 
table(
select substr(control_code , 15,5) unit_code
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 )b
on  a.unit_code = b.unit_code 
                                    

select count(distinct unit_code) from  app.g_runlog
where time_id = 20110917





select  
count(0) common_cnt
,count(distinct a.unit_code) a_cnt
,count(distinct b.unit_code) b_cnt
from 
table(
select unit_code from  app.g_runlog
where time_id = int(replace(char(current date - 1 days),'-',''))
) a
full join 
table(
select substr(control_code , 15,5) unit_code
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 )b
on  a.unit_code = b.unit_code 
                                    


        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110917 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110917 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1


            select sum(bigint(m_off_users)) from bass1.g_s_22012_day where time_id=20110917

                        select count(distinct user_id) from session.int_check_user_status
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110917


select count(user_id) 
                    from bass2.dw_product_20110917
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1


select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110917                       
except
select user_id 
from bass2.dw_product_20110917  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1


USER_ID
89160000237533 
89160001006901 
89160001001563 


select user_id,usertype_id,day_off_mark,userstatus_id,test_mark from   bass2.dw_product_20110917
where user_id in 
(
 '89160000237533'
,'89160001006901'
,'89160001001563'
)


89160000237533

select * from   g_a_02004_day
where user_id = '89160001001563'

select * from     session.int_check_user_status    
where user_id = '89160001001563'


select * from   bass2.dw_product_20110916
where user_id in 
(
'89160001001563'
)

select * from   bass2.dw_cust_20110917
where cust_id = '89160000849382'
                                     
                                     
select * from   bass2.dw_product_20110916
where product_no = '15289083522'


select time_id,count(0)
from g_s_22066_day
group by time_id







declare global temporary table session.int_check_user_status
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


--抓取用户资料入表
insert into session.int_check_user_status (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110431 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110431 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')


select * from   session.int_check_user_status 

select count(0)
from 
table(
select * from  session.int_check_user_status 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id between 20110101 and 20110431
) a 
where substr(create_date,1,6) <= '200806'


12171
select count(0) from    session.int_check_user_status 

2237465

values 12171*1.00/2237465

0.0054396381619377286



select count(0)
from 
table(
select * from  session.int_check_user_status 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id  >= 20080401
) a 
where substr(create_date,1,6) < '200804'

57168
select count(0) from    
table(
select * from  session.int_check_user_status 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id  >= 20080401
) a 

612541

values 57168*1.00/612541


0.0511765002691065662


--是这样的08年4月之前入网的用户
select count(0) from    
table(
select * from  session.int_check_user_status 
where  substr(create_date,1,6) < '200804'
) a 

409119

--在08年4月之后离网的用户

select count(0) from    
table(
select * from  session.int_check_user_status 
where  substr(create_date,1,6) < '200804'
) a 
where usertype_id  IN ('2010','2020','2030','9000')
57168

values 57168*1.00/409119*100

13.9734404904196578500




select count(0) from    
table(
select * from  session.int_check_user_status 
where  substr(create_date,1,6) < '200804'
) a 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id  >= 20080401

57168



select test_flag , count(0)
from  BASS1.g_a_02004_02008_stage
group by test_flag

select count(0) from     bass1.g_a_02004_02008_stage 




declare global temporary table bass1.g_a_02004_02008_stage
    (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
    )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp


drop table BASS1.g_a_02004_02008_stage;

CREATE TABLE BASS1.g_a_02004_02008_stage(
   user_id CHARACTER(15),
   product_no CHARACTER(15),
   test_flag CHARACTER(1),
   sim_code CHARACTER(15),
   usertype_id CHARACTER(4),
   create_date CHARACTER(15),
   brand_id CHARACTER(4),
   time_id INT 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.g_a_02004_02008_stage
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
--抓取用户资料入表

 
 ALTER TABLE  bass1.g_a_02004_02008_stage ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

insert into bass1.g_a_02004_02008_stage (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110831 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110831 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1


('2010','2020','2030','9000')

db2 runstats on table bass1.g_a_02004_02008_stage with distribution and detailed indexes all            


--08年4月之前入网的用户

select count(0) from    
table(
select * from  bass1.g_a_02004_02008_stage 
where  substr(create_date,1,6) < '200804'
and test_flag = '0'
) a 

408732

--409119

--在08年4月之后离网的用户

select count(0) from    
table(
select * from  bass1.g_a_02004_02008_stage 
where  substr(create_date,1,6) < '200804'
and test_flag = '0'
) a 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id >= 20080401 
and time_id <= 20110431


--57168

57090

values 57168*1.00/409119*100
--13.9734404904196578500

values 57090*1.00/408732*100



create view bass1.gview_a_02004_02008_stage
as
select a.user_id,b.CUST_ID,b.ACCT_ID,c.CUST_NAME
from table(
select user_id from    
table(
select * from  bass1.g_a_02004_02008_stage 
where  substr(create_date,1,6) < '200804'
) a 
where usertype_id  IN ('2010','2020','2030','9000')
and time_id >= 20080401 
and time_id <= 20110431
) a 
left join bass2.dw_product_201104 b on a.user_id = b.user_id 
left join bass2.dw_cust_201104 c on b.cust_id = c.cust_id 


select count(0) from     bass1.gview_a_02004_02008_stage
select count(0) from    G_I_02017_MONTH

delete from G_I_02017_MONTH


select * from   bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201105


select * from   BASS1.mon_interface_not_empty
except
select distinct trim(code)
from 
table (
select '01002' code from bass2.dual union all
select '02004' code from bass2.dual union all
select '02008' code from bass2.dual union all
select '02011' code from bass2.dual union all
select '02014' code from bass2.dual union all
select '02015' code from bass2.dual union all
select '02016' code from bass2.dual union all
select '02018' code from bass2.dual union all
select '02019' code from bass2.dual union all
select '02020' code from bass2.dual union all
select '02021' code from bass2.dual union all
select '02047' code from bass2.dual union all
select '02049' code from bass2.dual union all
select '02050' code from bass2.dual union all
select '02052' code from bass2.dual union all
select '02053' code from bass2.dual union all
select '02063' code from bass2.dual union all
select '03001' code from bass2.dual union all
select '03002' code from bass2.dual union all
select '03004' code from bass2.dual union all
select '03005' code from bass2.dual union all
select '03013' code from bass2.dual union all
select '04002' code from bass2.dual union all
select '04004' code from bass2.dual union all
select '04005' code from bass2.dual union all
select '04006' code from bass2.dual union all
select '04008' code from bass2.dual union all
select '04011' code from bass2.dual union all
select '05001' code from bass2.dual union all
select '05002' code from bass2.dual union all
select '05003' code from bass2.dual union all
select '06021' code from bass2.dual union all
select '06022' code from bass2.dual union all
select '06023' code from bass2.dual union all
select '06011' code from bass2.dual union all
select '06012' code from bass2.dual union all
select '06029' code from bass2.dual union all
select '06031' code from bass2.dual union all
select '06032' code from bass2.dual union all
select '21001' code from bass2.dual union all
select '21002' code from bass2.dual union all
select '21007' code from bass2.dual union all
select '21003' code from bass2.dual union all
select '21008' code from bass2.dual union all
select '21011' code from bass2.dual union all
select '21012' code from bass2.dual union all
select '21013' code from bass2.dual union all
select '21014' code from bass2.dual union all
select '21015' code from bass2.dual union all
select '21020' code from bass2.dual union all
select '22012' code from bass2.dual union all
select '22013' code from bass2.dual union all
select '22038' code from bass2.dual union all
select '22039' code from bass2.dual union all
select '22032' code from bass2.dual union all
select '22033' code from bass2.dual union all
select '22035' code from bass2.dual union all
select '22052' code from bass2.dual union all
select '22070' code from bass2.dual union all
select '22073' code from bass2.dual union all
select '22061' code from bass2.dual union all
select '22063' code from bass2.dual union all
select '22091' code from bass2.dual union all
select '22092' code from bass2.dual union all
select '22066' code from bass2.dual union all
select '22067' code from bass2.dual union all
select '22068' code from bass2.dual union all
select '22049' code from bass2.dual union all
select '22050' code from bass2.dual union all
select '22055' code from bass2.dual union all
select '22056' code from bass2.dual union all
select '22101' code from bass2.dual union all
select '22102' code from bass2.dual union all
select '22103' code from bass2.dual union all
select '22104' code from bass2.dual union all
select '22105' code from bass2.dual union all
select '22201' code from bass2.dual union all
select '22202' code from bass2.dual union all
select '22203' code from bass2.dual union all
select '22080' code from bass2.dual union all
select '22081' code from bass2.dual union all
select '22082' code from bass2.dual union all
select '22083' code from bass2.dual union all
select '22084' code from bass2.dual union all
select '22085' code from bass2.dual union all
select '22086' code from bass2.dual) t



drop table  "BASS1   "."MON_ALL_INTERFACE" 
CREATE TABLE "BASS1   "."MON_ALL_INTERFACE"  (
                  "TYPE" CHAR(1) , 
                  "INTERFACE_CODE" CHAR(5) , 
                  "INTERFACE_NAME" VARCHAR(100) , 
                  "COARSE_TYPE" VARCHAR(30) , 
                  "UPLOAD_TIME" VARCHAR(20) , 
                  "DEADLINE" SMALLINT , 
                  "IF_EMPTY" SMALLINT,                  
                  "STS" SMALLINT,
                  "REMARKS" VARCHAR(1000)  
)   
                 DISTRIBUTE BY HASH("INTERFACE_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into MON_ALL_INTERFACE
(
         TYPE
        ,INTERFACE_CODE
        ,INTERFACE_NAME
        ,COARSE_TYPE
        ,UPLOAD_TIME
        ,DEADLINE
        ,STS
        ,REMARKS
)
select 
         TYPE
        ,INTERFACE_CODE
        ,INTERFACE_NAME
        ,COARSE_TYPE
        ,UPLOAD_TIME
        ,DEADLINE
        ,STS
        ,REMARKS
 from MON_ALL_INTERFACE_b


drop  FUNCTION bass1.fn_dn_flret_cnt

CREATE FUNCTION bass1.fn_dn_flret_cnt(p_deadline int)
RETURNS 
TABLE ( dummy varchar(8),cnt    integer )
RETURN
select  'xxxxx',count(0)
                                                from 
                                                ( 
                                                select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
                                                from APP.G_FILE_REPORT a 
                                                where substr(filename,9,8) = replace(char(current date - 1 days),'-','') 
                                                and err_code='00' 
                                                and substr(filename,18,5) 
                                                in (  select INTERFACE_CODE from   BASS1.MON_ALL_INTERFACE 
                                                                   where deadline = p_deadline and sts = 1 
                                                                ) 
                                                ) t where rn = 1 
;
select * from   MON_ALL_INTERFACE
where if_empty is null 
order by 2



update MON_ALL_INTERFACE a
set IF_EMPTY = value(1 ,0)
where exists (select 1 from mon_interface_not_empty b where a.INTERFACE_CODE = b.INTERFACE_CODE)

update MON_ALL_INTERFACE a
set IF_EMPTY = 0
where IF_EMPTY = 1

update MON_ALL_INTERFACE a
set IF_EMPTY = 1
where IF_EMPTY is null




select distinct trim(code)
from 
table (
select '01002' code from bass2.dual union all
select '02004' code from bass2.dual union all
select '02008' code from bass2.dual union all
select '02011' code from bass2.dual union all
select '02014' code from bass2.dual union all
select '02015' code from bass2.dual union all
select '02016' code from bass2.dual union all
select '02018' code from bass2.dual union all
select '02019' code from bass2.dual union all
select '02020' code from bass2.dual union all
select '02021' code from bass2.dual union all
select '02047' code from bass2.dual union all
select '02049' code from bass2.dual union all
select '02050' code from bass2.dual union all
select '02052' code from bass2.dual union all
select '02053' code from bass2.dual union all
select '02063' code from bass2.dual union all
select '03001' code from bass2.dual union all
select '03002' code from bass2.dual union all
select '03004' code from bass2.dual union all
select '03005' code from bass2.dual union all
select '03013' code from bass2.dual union all
select '04002' code from bass2.dual union all
select '04004' code from bass2.dual union all
select '04005' code from bass2.dual union all
select '04006' code from bass2.dual union all
select '04008' code from bass2.dual union all
select '04011' code from bass2.dual union all
select '05001' code from bass2.dual union all
select '05002' code from bass2.dual union all
select '05003' code from bass2.dual union all
select '06021' code from bass2.dual union all
select '06022' code from bass2.dual union all
select '06023' code from bass2.dual union all
select '06011' code from bass2.dual union all
select '06012' code from bass2.dual union all
select '06029' code from bass2.dual union all
select '06031' code from bass2.dual union all
select '06032' code from bass2.dual union all
select '21001' code from bass2.dual union all
select '21002' code from bass2.dual union all
select '21007' code from bass2.dual union all
select '21003' code from bass2.dual union all
select '21008' code from bass2.dual union all
select '21011' code from bass2.dual union all
select '21012' code from bass2.dual union all
select '21013' code from bass2.dual union all
select '21014' code from bass2.dual union all
select '21015' code from bass2.dual union all
select '21020' code from bass2.dual union all
select '22012' code from bass2.dual union all
select '22013' code from bass2.dual union all
select '22038' code from bass2.dual union all
select '22039' code from bass2.dual union all
select '22032' code from bass2.dual union all
select '22033' code from bass2.dual union all
select '22035' code from bass2.dual union all
select '22052' code from bass2.dual union all
select '22070' code from bass2.dual union all
select '22073' code from bass2.dual union all
select '22061' code from bass2.dual union all
select '22063' code from bass2.dual union all
select '22091' code from bass2.dual union all
select '22092' code from bass2.dual union all
select '22066' code from bass2.dual union all
select '22067' code from bass2.dual union all
select '22068' code from bass2.dual union all
select '22049' code from bass2.dual union all
select '22050' code from bass2.dual union all
select '22055' code from bass2.dual union all
select '22056' code from bass2.dual union all
select '22101' code from bass2.dual union all
select '22102' code from bass2.dual union all
select '22103' code from bass2.dual union all
select '22104' code from bass2.dual union all
select '22105' code from bass2.dual union all
select '22201' code from bass2.dual union all
select '22202' code from bass2.dual union all
select '22203' code from bass2.dual union all
select '22080' code from bass2.dual union all
select '22081' code from bass2.dual union all
select '22082' code from bass2.dual union all
select '22083' code from bass2.dual union all
select '22084' code from bass2.dual union all
select '22085' code from bass2.dual union all
select '22086' code from bass2.dual) t
except 
select interface_code 
from mon_all_interface 
where if_empty = 0


select * from   mon_all_interface where interface_code = '02050'

02050
03013
22035
22070

select * from   BASS1.boss_interface 

select * from    bass1.G_A_01005_MONTH

select * from    bass1.G_A_06001_DAY

G_S_22066_DAY.tcl
G_S_22067_MONTH.tcl
G_S_22068_MONTH.tcl
G_S_22086_MONTH.tcl
G_S_22091_DAY.tcl
G_S_22092_DAY.tcl


select * from   app.sch_control_before where 
    control_code like '%G_S_22066_DAY%' 
or  control_code like '%G_S_22067_MONTH%' 
or  control_code like '%G_S_22068_MONTH%' 
or  control_code like '%G_S_22086_MONTH%' 
or  control_code like '%G_S_22091_DAY%' 
or  control_code like '%G_S_22092_DAY%' 

>

select * from   g_s_22082_day
where bigint(ALERT_SMS_CNT) < bigint(CANCEL_CNT)


select * from   BASS1.G_S_22082_DAY_1




 select      a.*,b.* ,c.*                  
        from   bass1.G_S_22082_DAY_1 a 
               join  bass1.G_S_22082_DAY_2 b  on a.SP_ID = b.SP_ID and a.BUSI_CODE = b.BUSI_CODE        
               left join  bass1.G_S_22082_DAY_3 c  on a.SP_ID = c.SP_CODE and a.BUSI_CODE = c.OPER_CODE 
where bigint(ALERT_SMS_CNT) < bigint(c.CANCEL_CNT)


OPER_CODE
600906002000005001
600906002000005002

select * from   bass2.Dim_pm_sp_operator_code 
where OPERATOR_CODE in ('600906002000005001','600906002000005002')



select * from bass2.dw_enterprise_sub_201105
where enterprise_id='89201560000785'

933

select * from   BASS1.ALL_DIM_LKP



TIME_ID	OP_TIME	BUSI_BILLING_TYPE	ALERT_SMS_CNT	REPLY_SMS_CNT	CANCEL_CNT	HOTLINE_OUT_CNT	COMPLAINT_CNT
20110921	20110921	12	371         	3           	396         	0           	0           
20110919	20110919	12	293         	3           	1865        	0           	0           
20110918	20110918	12	295         	2           	490         	0           	0           

drop table "BASS1   "."G_S_22082_DAY_3"  
CREATE TABLE "BASS1   "."G_S_22082_DAY_3"  (
                  "SRC" VARCHAR(1) , 
                  "SP_CODE" VARCHAR(20) , 
                  "OPER_CODE" VARCHAR(20) , 
                  "CANCEL_CNT" INTEGER )   
                 DISTRIBUTE BY HASH("SP_CODE",  
                 "OPER_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select * from   G_S_22083_MONTH
where time_id = 201105



drop table "BASS1   "."G_S_22083_MONTH_5"  
CREATE TABLE "BASS1   "."G_S_22083_MONTH_5"  (
                  "SRC" VARCHAR(1) , 
                  "SP_ID" VARCHAR(20) , 
                  "BUSI_CODE" VARCHAR(20) , 
                  "CANCEL_CNT" INTEGER , 
                  "ORDER_CNT" INTEGER )   
                 DISTRIBUTE BY HASH("SP_ID",  
                 "BUSI_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
select tabname from syscat.tables where tabname like '%G_S_22083_MONTH%'   
(22083)		

<=0	

select * from   G_S_22083_MONTH_B0615
where bigint(ORDER_CNT) <= 0
and time_id = 201105

--"点播类:订购用户数<业务退订量"
select * from   G_S_22083_MONTH_B0615
where bigint(ORDER_CNT) < bigint(CANCEL_CNT)
and time_id = 201105

select sum(bigint(CANCEL_CNT)) from G_S_22083_MONTH_B0615 where time_id = 201105
55731

select sum(bigint(CANCEL_CNT)) from G_S_22083_MONTH where time_id = 201105
2671
select sum(bigint(CANCEL_CNT)) from G_S_22083_MONTH where time_id = 201105
2671

select * from   mon_all_interface where interface_code = '22085'
select count(0) from   G_S_22086_MONTH
where bigint(ORDER_USER_CNT) <= 0


select count(0),count(distinct user_id) from    bass1.g_i_02022_day
where time_id = 20110531

select count(0),count(distinct user_id) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'


select count(0) from    bass1.g_i_02022_day
where time_id = 20110430

select count(0) from    bass1.g_i_02020_month where time_id = 201104
and base_prod_id like '%QQT%'


select count(0),count(distinct user_id) from    bass1.g_i_02022_day
where time_id = 20110531
2172	2172

select VALID_DT,count(distinct user_id)  from    bass1.g_i_02022_day
where time_id = 20110531
group by VALID_DT


select count(0),count(distinct user_id) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'
2288	2288


select count(0) from  bass1.g_i_02022_day a ,bass1.g_a_02004_02008_stage b
where a.time_id = 20110531  
and usertype_id  IN ('2010','2020','2030','9000')
and a.USER_ID = b.USER_ID


select count(0) from  bass1.g_i_02022_day a ,bass1.g_a_02004_02008_stage b
where a.time_id = 20110531  
and usertype_id  IN ('2010','2020','2030','9000')
and a.USER_ID = b.USER_ID



select count(0) from  bass1.g_i_02020_month a ,bass1.g_a_02004_02008_stage b
where a.time_id = 201105
and  a.base_prod_id like '%QQT%'
and usertype_id  IN ('2010','2020','2030','9000')
and a.USER_ID = b.USER_ID

select user_id from     bass1.g_i_02020_month  a where time_id = 201105
and base_prod_id like '%QQT%'
except 
select user_id from     bass1.g_i_02022_day a  where a.time_id = 20110531  

      

select a.*
from bass2.dw_product_ins_prod_201105 a 
where a.product_instance_id = '89157332065354'

OFFER_ID
111089110007
111089110017

select * from   bass2.dim_prod_up_product_item where PRODUCT_ITEM_ID = 111089110017

89157333894595      


select TIME_ID,count(0),count(distinct user_id)
from g_i_02022_day
group by TIME_ID
order by 1 desc 



    select 'xx',
					b.user_id
		  from
					(
					select 
					      distinct a.product_instance_id
					 from (
					      select product_instance_id,offer_id from bass2.dw_product_ins_off_ins_prod_201105
					      union all
					      select product_instance_id,offer_id from bass2.dw_product_ins_off_ins_prod_his_201105
					      ) a,
					      bass2.dim_qqt_offer_id b
					where a.offer_id=b.offer_id
					  and b.index=1
					) a,
					bass2.dw_product_201105 b
		where a.product_instance_id=b.user_id
			and b.usertype_id in (1,2,9) 
			and b.month_off_mark = 1 
			and b.userstatus_id not in (1,2,3,6,8)
			and b.test_mark<>1



USER_ID
89101110033276
89360000872155
89160000735737
select * from   
bass1.g_i_02020_month
where user_id in (
'89101110033276','89360000872155','89160000735737'
)

select * from   bass2.dw_product_201105 
where user_id in (
'89101110033276','89360000872155','89160000735737'
)


select * from   
bass1.g_i_02022_day
where user_id in (
'89101110033276','89360000872155','89160000735737'
)

select * from    bass2.dw_product_ins_prod_201105
where product_instance_id
(
'89101110033276','89360000872155','89160000735737'
)

select time_id, count(0)
from bass1.g_i_02020_month
group by time_id 
order by 1


select count(0) from  (select * from bass1.g_i_02020_month a where a.time_id = 201105) a ,bass1.g_a_02004_02008_stage b
where  usertype_id  IN ('2010','2020','2030','9000')
and a.USER_ID = b.USER_ID

select tabname from syscat.tables where tabname like '%G_I_02020%'   



CREATE TABLE "BASS1   "."G_I_02020_MONTH_B0623"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "BASE_PROD_ID" CHAR(30) NOT NULL , 
                  "PROD_VALID_DATE" CHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "BASE_PROD_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ;
insert into G_I_02020_MONTH_B0623
select a.*
from G_I_02020_MONTH a
where time_id = 201105


1641970 row(s) affected.


1707152
1707152

select count(0) from       BASS1.g_a_02004_02008_stage


select b.time_id, count(0)
from 
(
select 
                     product_instance_id user_id
                from bass2.dw_product_ins_prod_201105 a
          left join 
                                (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where  a.state  <> '0' 
                  and a.EXPIRE_DATE >= '2011-05-01'
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )
) a  ,                                 BASS1.g_a_02004_02008_stage
b where a.user_id = b.USER_ID
and  b.usertype_id  IN ('2010','2020','2030','9000')                                
group by b.time_id


select *
from 
(
select 
                     product_instance_id user_id
                from bass2.dw_product_ins_prod_201105 a
          left join 
                                (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where  a.state  <> '0' 
                  and ( a.state in ('1','4','6','8','M','7','C','9') 
                      or (
                          a.state not in ('1','4','6','8','M','7','C','9') and date(a.STATE_DATE) >= '2011-05-01'
                         )
                      )
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )
) a  ,                                 BASS1.g_a_02004_02008_stage
b where a.user_id = b.USER_ID
and  b.usertype_id  IN ('2010','2020','2030','9000')        
and 
time_id = 20100823



select * from    bass2.dw_product_ins_prod_201105
where product_instance_id = '89557331597548'

select * from   bass2.dw_product_201105 
where user_id = '89157331533984'
1644124
select count(0)
from 
(
select product_instance_id user_id
                from bass2.dw_product_ins_prod_201105 a
          left join 
                                (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where  a.state  <> '0' 
                  and ( a.state in ('1','4','6','8','M','7','C','9') 
                      or (
                          a.state not in ('1','4','6','8','M','7','C','9') and date(a.STATE_DATE) >= '2011-05-01'
                         )
                      )
                  and a.user_type_id =1
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )
) a  ,                                 BASS1.g_a_02004_02008_stage
b where a.user_id = b.USER_ID
and  b.usertype_id  IN ('2010','2020','2030','9000')    



--由于有些expire_date 没有更新,所以要用state_date 抓
--有一部分state_date 也没有更新,要用
select b.*
from 
(
select 
                     product_instance_id user_id
                from bass2.dw_product_ins_prod_201105 a
                     join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
          left join (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where   a.user_type_id =1
                  and (b.userstatus_id  in (1,2,3,6,8) or MONTH_OFF_MARK = 1)
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )
) a  full join    BASS1.g_a_02004_02008_stage b 
on  a.user_id = b.USER_ID
where   b.usertype_id  IN ('2010','2020','2030','9000')                                
and a.user_id is null 
and b.TIME_ID/100 = 201105


select * from    bass2.dw_product_ins_prod_201105
where product_instance_id = '89101110031712'


select count(0),count(distinct product_instance_id ) from    bass2.dw_product_ins_prod_201105 

select count(0),count(distinct a.user_id) from    bass2.dw_product_201105 a 
,bass2.dw_product_ins_prod_201105  b 
,BASS1.g_a_02004_02008_stage  c 
where a.user_id = b.product_instance_id
 and a.user_id=c.user_id 
 
 
select count(0),count(distinct user_id ) from      BASS1.g_a_02004_02008_stage 




select count(0) from     bass2.dw_product_201105 
where MONTH_OFF_MARK = 1


select count(0),count(distinct a.user_id) from    bass2.dw_product_201105 a 
,bass2.dw_product_ins_prod_201105  b 
,BASS1.g_a_02004_02008_stage  c 
where a.user_id = b.product_instance_id
 and a.user_id=c.user_id 
 and MONTH_OFF_MARK = 1

 
 

select 
                    count(0)
                from bass2.dw_product_ins_prod_201105 a
                     join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
          left join (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where   a.user_type_id =1
                  and (b.userstatus_id  in (1,2,3,6,8) or MONTH_OFF_MARK = 1)
                  and a.valid_type = 1
                  and a.bill_id not in ('D15289014474','D15289014454')
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )

1702695


select b.time_id,count(distinct a.user_id)
from 
(
select 
                     product_instance_id user_id
                from bass2.dw_product_ins_prod_201105 a
                     join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
          left join (select user_id , BASE_PKG_ID ,VALID_DT
                                        from
                                        (select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
                                        from bass1.g_i_02022_day  a
                                        where time_id / 100 = 201105
                                        ) t where  t.rn = 1 
                                ) d on a.product_instance_id = d.user_id 
                where   a.user_type_id =1
                  and (b.userstatus_id  in (1,2,3,6,8) or MONTH_OFF_MARK = 1)
                  and a.valid_type = 1
                  and not exists 
                                  (select 1 from  bass2.dw_product_test_phone_201105 b 
                                                        where a.product_instance_id     = b.user_id and  b.sts=1
                                )
) a   join    BASS1.g_a_02004_02008_stage b 
on  a.user_id = b.USER_ID
where   b.usertype_id  IN ('2010','2020','2030','9000')                                
and b.TIME_ID/100 = 201105
group by b.TIME_ID


select * from   bass1.g_rule_check where rule_code = 'R159_4'
and time_id / 100 = 201105


select count(0),count(distinct product_instance_id ) from    bass2.dw_product_ins_prod_201105  a
where  a.valid_type = 1 



select  c.TIME_ID, count(0),count(distinct b.USER_ID)
 from bass2.dw_product_ins_prod_201105  a
 join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
 join  BASS1.g_a_02004_02008_stage c on  a.product_instance_id = c.USER_ID
where  c.TIME_ID/100 = 201105
and  a.valid_type = 1 
and (b.userstatus_id  in (1,2,3,6,8) or b.MONTH_OFF_MARK = 1)
group by c.TIME_ID
order by 1



select   count(0),count(distinct b.USER_ID)
 from bass2.dw_product_ins_prod_201105  a
 join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
 join BASS1.g_a_02004_02008_stage c on  a.product_instance_id = c.USER_ID
where   a.valid_type = 1 
and (b.userstatus_id  in (1,2,3,6,8) or b.MONTH_OFF_MARK = 1)
order by 1

1704238	1704238






select  b.user_id
        ,value(d.BASE_PKG_ID,char(a.offer_id))
        ,value(d.VALID_DT,replace(char(date(a.create_date)),'-','')) VALID_DT
 from bass2.dw_product_ins_prod_201105  a
 join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
 join BASS1.g_a_02004_02008_stage c on  a.product_instance_id = c.USER_ID
 left join (select user_id , BASE_PKG_ID ,VALID_DT
					from
					(select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
					from bass1.g_i_02022_day  a
					where time_id  = 20110531
					) t where  t.rn = 1 
				) d on a.product_instance_id = d.user_id
where   a.valid_type = 1 
and (b.userstatus_id  in (1,2,3,6,8) or b.MONTH_OFF_MARK = 1)
order by 1



select  count(0),count(distinct case when d.user_id is not null then b.user_id end )
 from bass2.dw_product_ins_prod_201105  a
 join bass2.dw_product_201105 b on a.product_instance_id = b.user_id
 join BASS1.g_a_02004_02008_stage c on  a.product_instance_id = c.USER_ID
 left join (select user_id , BASE_PKG_ID ,VALID_DT
					from
					(select a.*,row_number()over(partition by user_id order by VALID_DT desc ) rn
					from bass1.g_i_02022_day  a
					where time_id  = 20110531
					) t where  t.rn = 1 
				) d on a.product_instance_id = d.user_id
where   a.valid_type = 1 
and (b.userstatus_id  in (1,2,3,6,8) or b.MONTH_OFF_MARK = 1)
order by 1






drop table BASS1.g_i_02020_month_1;
CREATE TABLE BASS1.g_i_02020_month_1(
   user_id CHARACTER(15),
   product_no CHARACTER(15),
   test_flag CHARACTER(1),
   sim_code CHARACTER(15),
   usertype_id CHARACTER(4),
   create_date CHARACTER(15),
   brand_id CHARACTER(4),
   time_id INT 
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
ALTER TABLE BASS1.g_i_02020_month_1
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
--抓取用户资料入表
insert into bass1.g_i_02020_month_1 (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110531 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110531 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1



select count(*) from 
                    (
                 select distinct  BASE_PROD_ID from bass1.g_i_02020_month
                      where time_id =201105
               except
                 select  BASE_PROD_ID from bass1.g_i_02018_month 
                                where time_id =201105            
                    ) as a
                    with ur
                    
                    
select count(*) from 
                    (
                     select user_id from bass1.g_i_02020_month
                      where time_id =201105
               except
                                                         select user_id from bass2.dw_product_201105
                                                         where usertype_id in (1,2,9) 
                                                           and test_mark<>1               
                    ) as a


89101110286560      

select * from                        bass2.dw_product_201105
where user_id = '89101110286560'


select a.item_id,b.item_name from bass2.item_lihongliang a,bass2.dim_acct_item b
where a.item_id = b.item_id 
order by a.seq

bass1.G_I_02020_MONTH_1 

select tabname from syscat.tables where tabname like '%G_I_02020_MONTH%'   

TABNAME
G_I_02020_MONTH
G_I_02020_MONTH_1
G_I_02020_MONTH_B0623


select count(0) from    G_I_02020_MONTH_B0623
1641970
select count(0) from    G_I_02020_MONTH where time_id = 201105

1702695


select count(0) from     BASS1.g_a_02004_02008_stage

select b.time_id, count(0) from  (select * from bass1.G_I_02020_MONTH where time_id = 201105) a ,
 BASS1.g_a_02004_02008_stage b 
 where a.user_id = b.user_id 
 group by  b.time_id
 
 
 RUNSTATS ON table BASS1.g_a_02004_02008_stage  	with distribution and detailed indexes all  
 db2 RUNSTATS ON table BASS1.G_I_02020_MONTH  	with distribution and detailed indexes all  
 
 
 select * from  bass1.G_I_02020_MONTH


select b.time_id, count(0) from  (select * from bass1.G_I_02020_MONTH where time_id = 201105) a ,
 BASS1.g_a_02004_02008_stage b 
 where a.user_id = b.user_id 
 and  b.usertype_id  IN ('2010','2020','2030','9000')               
 group by  b.time_id
 

select * from   bass1.g_rule_check where rule_code = 'R159_4'
and time_id / 100 = 201105


 select count(0)
from 
(
select  user_id from    bass1.G_I_02020_MONTH_B0623 where time_id = 201105
and base_prod_id like '%QQT%'
) a , BASS1.g_a_02004_02008_stage b 
where a.user_id = b.user_id 
 and  b.usertype_id  IN ('2010','2020','2030','9000')               


select count(0),count(distinct user_id) from    bass1.g_i_02022_day
where time_id = 20110531


select count(0),count(distinct user_id) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'
--2172	2172


select * from  table( bass1.get_before('BASS1_G_S_22066_DAY')) a 

BASS1_G_I_02020_MONTH.tcl	BASS1_G_I_02018_MONTH.tcl

select * from  table( bass1.get_task('xysc_school_comp_user')) a 


insert into app.sch_control_before values ('BASS1_G_I_02020_MONTH.tcl','BASS1_G_A_02004_DAY.tcl')
insert into app.sch_control_before values ('BASS1_G_I_02020_MONTH.tcl','BASS1_G_A_02008_DAY.tcl')
insert into app.sch_control_before values ('BASS1_G_I_02020_MONTH.tcl','BASS2_Dw_product_ms.tcl')


select CONTROL_CODE,BEFORE_CONTROL_CODE,count(0) from    app.sch_control_before
where CONTROL_CODE like 'BASS1%'
group by  CONTROL_CODE,BEFORE_CONTROL_CODE
having count(0) > 1


select * from   
where


select count(0),count(distinct user_id) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'

select user_id from  bass1.G_I_02020_MONTH_B0623  where time_id = 201105 and  base_prod_id like '%QQT%' 
except 
select user_id from   bass1.g_i_02022_day
where time_id = 20110531



      

select * from     bass2.dw_product_ins_prod_201105  a
where product_instance_id = '89160000913239'

OFFER_ID
111089110017
111089110012

select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110926
where product_item_id in (111089110017)


update app.g_runlog 
set return_flag = 0
where time_id= 201105
and return_flag=1
and unit_code = '02020'




    select 
        (select count(0)
                from    bass1.g_i_02022_day
                                where time_id = 20110531  
                                )
         , (select count(0)
                 from    bass1.g_i_02020_month 
                                                where time_id = 201105
                                                and base_prod_id like '%QQT%')
         from bass2.dual
        with ur 

        

select * from   g_s_22082_day
where bigint(ALERT_SMS_CNT) < bigint(CANCEL_CNT)

select * from   g_s_22082_day
where time_id = 20110926
order by 2,3

        

select count(0) from   G_S_22083_MONTH_B0615
where bigint(ORDER_CNT) <= 0
and time_id = 201105
       

select count(0) from   G_S_22083_MONTH
where bigint(ORDER_CNT) < bigint(CANCEL_CNT)
and time_id = 201105

      select * from  g_a_06001_day

select * from   BASS1.G_S_22092_DAY




RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110928BAK;
CREATE TABLE BASS2.DIM_TERM_TAC(
   ID INTEGER,
   TAC_NUM VARCHAR(15),
   TERM_ID VARCHAR(10),
   TERM_MODEL VARCHAR(50),
   TERMPROD_ID VARCHAR(10),
   TERMPROD_NAME VARCHAR(200),
   NET_TYPE CHARACTER(1),
   TERM_TYPE CHARACTER(1) 
) DATA CAPTURE NONE 
 IN TBS_DIM PARTITIONING KEY(
    ID 
 )USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
drop table BASS2.DIM_TERM_TAC_MID
CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
   LOCKSIZE ROW 
   APPEND OFF NOT VOLATILE;
delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110928BAK
where net_type <>'2';
COMMIT;
select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110928BAK
group by tac_nuM
having count(*)>1

drop table BASS2.DIM_TERM_TAC_MID


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1
      

select tabname from syscat.tables where tabname like '%DIM_TERM_TAC_2011%'         

TABNAME
DIM_TERM_TAC_20110228BAK
DIM_TERM_TAC_20110331BAK
DIM_TERM_TAC_20110430BAK
DIM_TERM_TAC_20110527BAK
DIM_TERM_TAC_20110928BAK


select * from    bass2.DIM_TERM_TAC_20110331BAK

select * from    bass2.ODS_SC_SCRD_ORD_INFO_201109


select * from  table( bass1.get_before('BASS1_G_S_02007_MONTH.tcl')) a 


select * from  table( bass1.get_task('02007')) a 

BASS2_Dw_sc_scrd_ord_info_ms.tcl	TR1_L_11222

select count(0) from    bass2.DIM_TERM_TAC




select CONTROL_CODE,BEFORE_CONTROL_CODE,count(0) from    app.sch_control_before
where CONTROL_CODE like 'BASS1%'
group by  CONTROL_CODE,BEFORE_CONTROL_CODE
having count(0) > 1

select * from   app.sch_control_before where  CONTROL_CODE = 'BASS1_EXP_G_S_22062_MONTH'
delete from app.sch_control_before where 
BASS1_EXP_G_S_22062_MONTH	BASS1_G_S_22062_MONTH.tcl


delete from (select * from app.sch_control_before 
    where CONTROL_CODE = 'BASS1_EXP_G_S_22062_MONTH'  fetch first 3 rows only ) a 


    
    
delete from (
select 1 from bass2.dual
union all
select 1 from bass2.dual
) a 

   



select * from   bass1.g_rule_check where time_id = 201105 

select * from   bass1.g_rule_check where rule_code = 'R235'
ORDER BY 1 DESC 


                        select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                              where time_id >= 20100625
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        AND trim(A.enterprise_id) <> ''
                        and not exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  ) t where a.enterprise_id = t.enterprise_id )
                with ur




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02059_DAY 
group by  time_id 
order by 1 desc 




                        select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                                              where time_id < 20100706
                          ) a
                        where rn = 1 


                select  bigint(BILL_CUST_NUMS) ,  bigint(USE_CUST_NUMS) from   G_S_22303_MONTH where ENT_BUSI_ID = '1360'
                and time_id = 201105
               
                and  MANAGE_MOD = '3'

                        select count(0) from   G_I_21020_MONTH
                                where
                                COMP_BRAND_ID = '021000' and 
                                 substr(COMP_PRODUCT_NO,1,3) not 
                                in ('130','131','132','155','156','185','186','145')   
                                and time_id  = 201105 




                        select count(0) from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_02059_DAY  t
                          ) a
                        where rn = 1    and STATUS_ID = '1'
                        AND trim(A.enterprise_id) <> ''
                        and enterprise_id NOT  IN  TABLE (
                                                select enterprise_id from 
                        (
                                        select t.*
                                        ,row_number()over(partition by t.enterprise_id order by time_id desc ) rn 
                                        from 
                                        G_A_01004_DAY  t
                          ) a
                        where rn = 1 )


select tabname from syscat.tables where tabname like '%G_A%01005%'                                   

select * from   G_A_01005_MONTH_DOWN0629


select id,enterprise_id from   G_I_77780_DAY_DOWN20110429
except
select * from   G_A_01005_MONTH_DOWN0629

select * from   G_A_01005_MONTH_DOWN0629
except
select id,enterprise_id from   G_I_77780_DAY_DOWN20110429



select * from app.g_runlog 
where time_id=20110928
and return_flag=1


select * from 
bass1.g_rule_check where rule_code = 'R165' 
ORDER BY 1 DESC 

and time_id = 20110322



delete from (select * from app.sch_control_before 
    where CONTROL_CODE = 'BASS1_EXP_G_S_22062_MONTH'  fetch first 4 rows only ) a 

select count(0) from   G_S_22083_MONTH_5


select tabname from syscat.tables where tabname like '%22083%' 

delete from (select * from G_S_22083_MONTH_5 fetch first 3 rows only ) a 


delete from (select * from app.sch_control_before 
    where CONTROL_CODE = 'BASS1_G_S_03004_MONTH.tcl'
        and before_control_code = 'BASS2_Dw_product_ms.tcl'
    fetch first 1 rows only ) a 


select CONTROL_CODE,BEFORE_CONTROL_CODE,count(0) from    app.sch_control_before
where CONTROL_CODE like 'BASS1%'
group by  CONTROL_CODE,BEFORE_CONTROL_CODE
having count(0) > 1

CONTROL_CODE	BEFORE_CONTROL_CODE	3
BASS1_G_S_22037_MONTH.tcl	BASS2_Dw_enterprise_sub_ds.tcl	2
BASS1_INT_CHECK_R036_MONTH.tcl	BASS1_G_S_03005_MONTH.tcl	2
BASS1_G_S_22066_DAY.tcl	BASS2_Dw_kf_sms_cmd_receive_dm.tcl	2
BASS1_G_S_03004_MONTH.tcl	BASS2_Dw_product_ms.tcl	2




//////////////////////////////////////////////////////////////////////////////////

INT_CHECK_R216_MONTH

insert into app.sch_control_map
values
 (2,'INT_CHECK_R216_MONTH.tcl','BASS1_INT_CHECK_R216_MONTH.tcl')

insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_CHECK_R216_MONTH.tcl' PROGRAM_NAME
,'R216.bass' SOURCE_DATA
,'R216._e' OBJECTIVE_DATA
,'R216._f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'INT_CHECK_R062_MONTH.tcl'

insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R216_MONTH.tcl','BASS1_G_A_02054_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R216_MONTH.tcl','BASS1_G_A_02064_DAY.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R216_MONTH.tcl','BASS1_G_S_03017_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_INT_CHECK_R216_MONTH.tcl','BASS1_G_S_03018_MONTH.tcl' from bass2.dual

insert into app.sch_control_before 
select 'BASS1_EXP_G_S_03018_MONTH','BASS1_INT_CHECK_R216_MONTH.tcl' from bass2.dual
insert into app.sch_control_before 
select 'BASS1_EXP_G_S_03017_MONTH','BASS1_INT_CHECK_R216_MONTH.tcl' from bass2.dual
--insert into app.sch_control_before 
--select 'BASS1_EXP_G_A_02054_DAY','BASS1_INT_CHECK_R216_MONTH.tcl' from bass2.dual
--insert into app.sch_control_before 
--select 'BASS1_EXP_G_A_02064_DAY','BASS1_INT_CHECK_R216_MONTH.tcl' from bass2.dual
--

delete from app.sch_control_task where control_code in ('BASS1_INT_CHECK_R216_MONTH.tcl');
insert into app.sch_control_task values ('BASS1_INT_CHECK_R216_MONTH.tcl',2,2,'int -s INT_CHECK_R216_MONTH.tcl',-1,310,'R216 02054|02064|03017|03018 校验','app','BASS1',1,'/bassapp/bass1/tcl/');





                                select a.cnt*1.00 ,value(b.income,0) income
                                from
                                (select count(0) cnt
                                                        from 
                                                        (
                                                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                                                        from (
                                                        select *
                                                        from g_a_02054_day where 
                                                         time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                                                         --and MANAGE_MODE = '3'
                                                        ) t 
                                                        ) t2 where rn = 1 and STATUS_ID ='1'
                                ) a,(
                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201109
                                and ent_busi_id = '1520'
                                --and MANAGE_MOD = '3'
                                union all 
                                select sum(bigint(income)) income from   g_s_03018_month
                                where time_id = 201109
                                and ent_busi_id = '1520'
                                --and MANAGE_MOD = '3'
                                ) t 
                                ) b 
                        with ur
                        
                        


select * from    BASS1.ALL_DIM_LKP_160 
where xzbas_colname like '%400%'
 BASS1.ALL_DIM_LKP_160



select * from   bass2.dim_enterprise_product

select * from   g_a_02054_day
where ENTERPRISE_BUSI_TYPE = '1520'




                        select distinct
                                DATE(A.done_date),
                                A.ENTERPRISE_ID,
                                C.BASS1_VALUE as ENTERPRISE_BUSI_TYPE,
                                case
                                        when C.BASS1_VALUE='1290' then '2'
                                        when C.BASS1_VALUE='1520' then '3'                                               
                                        when upper(B.CONFIG_VALUE)='MAS' then '1'
                                        when upper(B.CONFIG_VALUE)='ADC' then '2'
                                        else '3'
                                end as MANAGE_MODE,
                                replace(char(date(min(A.done_date))),'-','') as ORDER_DATE,
                                case
                                        when a.REC_STATUS=1 then '1'
                                        when a.REC_STATUS=0 then '2'
                        else '2'
                                end as STATUS_ID
                        from
                                bass2.DW_ENTERPRISE_SUB_DS a,
                                (select * from BASS2.DIM_SERVICE_CONFIG where CONFIG_ID=1000027)  b,
                                (select * from BASS1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0108') c
                        where A.SERVICE_ID = B.SERVICE_ID
                          and a.SERVICE_ID = c.XZBAS_VALUE
                                and c.BASS1_VALUE not in ('1310','1320','1430','1440','1450','1340','1210','1170','3000','1230','1220')
                                and c.BASS1_VALUE = '1520'
                 group by  DATE(A.done_date), A.ENTERPRISE_ID,C.BASS1_VALUE,
                                case
                                        when C.BASS1_VALUE='1290' then '2'
                                        when C.BASS1_VALUE='1520' then '3'                                               
                                        when upper(B.CONFIG_VALUE)='MAS' then '1'
                                        when upper(B.CONFIG_VALUE)='ADC' then '2'
                                        else '3'
                                end,
                                case
                                        when REC_STATUS=1 then '1'
                                        when REC_STATUS=0 then '2'
                                else '2'
                                end 
                                



drop table  "BASS1   "."G_A_02054_DAY_TOFIX1520" 

select tabname from syscat.tables where tabname like '%02054%'   
CREATE TABLE "BASS1   "."G_A_02054_DAY_TOFIX1520"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

ALTER TABLE G_A_02054_DAY_TOFIX1520 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

rename bass1.G_A_02054_DAY_VALID1520 to G_A_02054_DAY_FIX1520
insert into G_A_02054_DAY_TOFIX1520
select 
TIME_ID
,ENTERPRISE_ID
,ENTERPRISE_BUSI_TYPE
,MANAGE_MODE
,ORDER_DATE
,STATUS_ID
from (

        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
        from (
        select *
        from g_a_02054_day where 
          ENTERPRISE_BUSI_TYPE = '1520'
         --and MANAGE_MODE = '3'
        ) t 
      ) t2 where rn = 1 and STATUS_ID ='1'
        
ALTER TABLE G_A_02054_DAY_VALID1520 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

select count(0) from    G_A_02054_DAY_VALID1520

ALTER TABLE G_A_02054_DAY_FIX1520 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE


insert into G_A_02054_DAY_FIX1520
select 
20110930 TIME_ID
,ENTERPRISE_ID
,ENTERPRISE_BUSI_TYPE
,MANAGE_MODE
,ORDER_DATE
,'2' STATUS_ID
from G_A_02054_DAY_TOFIX1520


insert into G_A_02054_DAY_FIX1520
select 
20110930 TIME_ID
,ENTERPRISE_ID
,ENTERPRISE_BUSI_TYPE
,'3' MANAGE_MODE
,ORDER_DATE
,'1' STATUS_ID
from G_A_02054_DAY_TOFIX1520


select * from   G_A_02054_DAY_FIX1520


 select distinct
                                20110929,
                                A.ENTERPRISE_ID,
                                C.BASS1_VALUE as ENTERPRISE_BUSI_TYPE,
                                case
                                        when C.BASS1_VALUE='1290' then '2'
                                        when C.BASS1_VALUE='1520' then '3'                                      
                                        when upper(B.CONFIG_VALUE)='MAS' then '1'
                                        when upper(B.CONFIG_VALUE)='ADC' then '2'
                                        else '3'
                                end as MANAGE_MODE,
                                replace(char(date(min(A.done_date))),'-','') as ORDER_DATE,
                                case
                                        when a.REC_STATUS=1 then '1'
                                        when a.REC_STATUS=0 then '2'
                        else '2'
                                end as STATUS_ID
                        from
                                bass2.DW_ENTERPRISE_SUB_DS a,
                                (select * from BASS2.DIM_SERVICE_CONFIG where CONFIG_ID=1000027)  b,
                                (select * from BASS1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0108') c
                        where DATE(A.done_date)='2011-06-29'
                          and A.SERVICE_ID = B.SERVICE_ID
                          and a.SERVICE_ID = c.XZBAS_VALUE
                                and c.BASS1_VALUE not in ('1310','1320','1430','1440','1450','1340','1210','1170','3000','1230','1220')
                 group by A.ENTERPRISE_ID,C.BASS1_VALUE,
                                case
                                        when C.BASS1_VALUE='1290' then '2'
                                        when C.BASS1_VALUE='1520' then '3'                                              
                                        when upper(B.CONFIG_VALUE)='MAS' then '1'
                                        when upper(B.CONFIG_VALUE)='ADC' then '2'
                                        else '3'
                                end,
                                case
                                        when REC_STATUS=1 then '1'
                                        when REC_STATUS=0 then '2'
                                else '2'
                                end 
                                

select * from   G_A_02054_DAY_TOFIX1520
                               
select * from   G_A_02064_DAY

select count(0) from    G_A_02054_DAY_VALID1520 a,G_A_02064_DAY b 
where a.ENTERPRISE_ID =  b.ENTERPRISE_ID


CREATE TABLE "BASS1   "."G_A_02064_DAY_TOFIX"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "CDR_NUM_CNT" CHAR(3) , 
                  "SMS_NUM_CNT" CHAR(3) , 
                  "NUM_ALL_CNT" CHAR(4) , 
                  "NUM_MOBILE_CNT" CHAR(4) , 
                  "NUM_OTHER_CNT" CHAR(4) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select * from   G_A_02064_DAY_TOFIX


INSERT INTO G_A_02064_DAY_TOFIX
select 
         TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,CDR_NUM_CNT
        ,SMS_NUM_CNT
        ,NUM_ALL_CNT
        ,NUM_MOBILE_CNT
        ,NUM_OTHER_CNT
        ,ORDER_DATE
        ,STATUS_ID
from (

        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
        from (
        select *
        from G_A_02064_DAY where 
        ENTERPRISE_BUSI_TYPE = '1520'
         --and MANAGE_MODE = '3'
        ) t 
      ) t2 where rn = 1 and STATUS_ID ='1'
        



select * from   G_A_02064_DAY_FIX


CREATE TABLE "BASS1   "."G_A_02064_DAY_FIX"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "CDR_NUM_CNT" CHAR(3) , 
                  "SMS_NUM_CNT" CHAR(3) , 
                  "NUM_ALL_CNT" CHAR(4) , 
                  "NUM_MOBILE_CNT" CHAR(4) , 
                  "NUM_OTHER_CNT" CHAR(4) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


ALTER TABLE G_A_02064_DAY_FIX ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE


insert into         G_A_02064_DAY_FIX
select 
         20110930 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,CDR_NUM_CNT
        ,SMS_NUM_CNT
        ,NUM_ALL_CNT
        ,NUM_MOBILE_CNT
        ,NUM_OTHER_CNT
        ,ORDER_DATE
        ,'2' STATUS_ID
 from G_A_02064_DAY_TOFIX


insert into         G_A_02064_DAY_FIX
select 
         20110930 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,'3' MANAGE_MODE
        ,CDR_NUM_CNT
        ,SMS_NUM_CNT
        ,NUM_ALL_CNT
        ,NUM_MOBILE_CNT
        ,NUM_OTHER_CNT
        ,ORDER_DATE
        ,'1' STATUS_ID
 from G_A_02064_DAY_TOFIX


select * from   G_A_02064_DAY_FIX



select ENTERPRISE_BUSI_TYPE , count(0) 
--,  count(distinct ENTERPRISE_BUSI_TYPE ) 
from G_A_02064_DAY 
group by  ENTERPRISE_BUSI_TYPE 
order by 1 


select sum(bigint(CANCEL_CNT)),sum(bigint(ALERT_SMS_CNT))
from G_S_22082_DAY
where time_id between 20110921 and 20110928


select * from G_S_22082_DAY
where bigint(CANCEL_CNT) > bigint(ALERT_SMS_CNT)

select * from   g_s_22082_day
where bigint(ALERT_SMS_CNT) < bigint(CANCEL_CNT)

20110921	20110921	12	371         	3           	5           	0           	0           


20110921	20110921	20	4014        	27          	0           	0           	0           
20110921	20110921	11	645         	1           	4           	0           	0           
20110921	20110921	12	371         	3           	5           	0           	0           

select * from G_A_02064_DAY_FIX


drop table "BASS1   "."G_I_21020_MONTH_DOWN0630" 

CREATE TABLE "BASS1   "."G_I_21020_MONTH_DOWN0630"  (
                  "TIME_ID" VARchar(8) , 
                  "COMP_PRODUCT_NO" VARCHAR(15) NOT NULL , 
                  "COMP_BRAND_ID" VARCHAR(6) NOT NULL , 
                  "COMP_BEGIN_DATE" VARCHAR(8) NOT NULL , 
                  "COMP_LAST_DATE" VARCHAR(8) NOT NULL , 
                  "CALL_COUNTS" VARCHAR(8) NOT NULL , 
                  "SMS_COUNTS" VARCHAR(8) NOT NULL , 
                  "MMS_COUNTS" VARCHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "COMP_PRODUCT_NO")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 





 18989902822    31000 201007092011053127      0       0       
 8954909243     33000 200503312011052737      0       0       


len_val="1 1,2 16,17 22,23 30,31 38,39 46,47 54,55 62"
WORK_PATH=/bassapp/bihome/panzw/tmp
datafilename=13100_21020_20110531.txt
table_name=bass1.G_I_21020_MONTH_DOWN0630
DB2_SQLCOMM="db2 \"load client from ${WORK_PATH}/${datafilename} of asc \\
\n
modified by timestampformat=\\\"YYYYMMDDHHMMSS\\\" dateformat=\\\"YYYYMMDD\\\" \\
\n
timeformat=\\\"HHMMSS\\\" \\
\n
method L (${len_val}) \\
\n
messages ${WORK_PATH}/${table_name}.msg \\
\n
replace into ${table_name} nonrecoverable\""

echo ${DB2_SQLCOMM}|sed -e 's/ $//g'


select count(0) from    G_I_21020_MONTH_DOWN0630

                        select count(0) from   G_I_21020_MONTH_DOWN0630
                                where
                                COMP_BRAND_ID = '021000' and 
                                 substr(substr(COMP_PRODUCT_NO,length(COMP_PRODUCT_NO)-3,3),1,3) not 
                                in ('130','131','132','155','156','185','186','145')   
                                and time_id  = 201105 
                
       	18989058914    	31000 	20100714	20110328	0       	0       	0       
       	8916512701     	33000 	20050215	20110531	43      	0       	0       

select * from   G_I_21020_MONTH_DOWN0630
where                 
COMP_BRAND_ID = '021000'




                        select  substr(substr(COMP_PRODUCT_NO,length(COMP_PRODUCT_NO)-3,3),1,3) from   G_I_21020_MONTH_DOWN0630
                                where
                                COMP_BRAND_ID = '021000' 
                                and substr(substr(COMP_PRODUCT_NO,length(COMP_PRODUCT_NO)-3,3),1,3) not 
                                in ('130','131','132','155','156','185','186','145')   
                                and time_id  = 201105 
                
                
31345

                
select length(trim(COMP_PRODUCT_NO)) , count(0) 
--,  count(distinct COMP_BRAND_ID ) 
from G_I_21020_MONTH_DOWN0630 
and 
group by length(trim(COMP_PRODUCT_NO)) 
order by 1 



select * from G_I_21020_MONTH_DOWN0630
where length(trim(COMP_PRODUCT_NO)) = 10



select length(trim(COMP_PRODUCT_NO)) , count(0) 
--,  count(distinct COMP_BRAND_ID ) 
from G_I_21020_MONTH_DOWN0630 
where COMP_BRAND_ID = '21000 '
group by length(trim(COMP_PRODUCT_NO)) 
order by 1 
' '                
select * from   G_I_21020_MONTH_DOWN0630
where                 
COMP_BRAND_ID = '21000 '


COMP_BRAND_ID
21000 
22000 
31000 
32000 
33000 

select substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3) ,a.* from G_I_21020_MONTH a
where COMP_BRAND_ID = '021000'
and time_id = 201105
and substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3) 
   in ('130','131','132','155','156','185','186','145')   
and length(trim(COMP_PRODUCT_NO)) <> 11
  
  
  select substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3) ,a.*,substr(COMP_PRODUCT_NO,1,11) from G_I_21020_MONTH a
where COMP_BRAND_ID = '021000'
and time_id = 201105
and length(trim(COMP_PRODUCT_NO)) = 12


			select count(0) from   G_I_21020_MONTH
				where
				COMP_BRAND_ID = '021000'  
                and time_id = 201105
				and length(trim(COMP_PRODUCT_NO)) <> 11
				with ur 
                
			select count(0) from   G_I_21020_MONTH
				where COMP_BRAND_ID = '021000'
				and time_id = 201105
				and length(trim(COMP_PRODUCT_NO)) <> 11
				with ur 
                

			select count(0) from   G_I_21020_MONTH
				where COMP_BRAND_ID = '031000'
				and time_id = 201105
				and length(trim(COMP_PRODUCT_NO)) <> 11
				with ur 
                


select send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num = '15913269062'
order by send_time desc 


select * from   g_a_02064_day
where time_id = 20110930



alter table BASS1.G_S_04011_DAY_LS activate not logged initially with empty table;



insert into BASS1.G_S_04011_DAY_LS 
select * from bass1.g_s_04011_day 
where time_id = 20110930 
  AND CDR_TYPE IN ('00','10','21')
   AND SVC_TYPE IN ('11','12','13')
   AND SMS_STATUS='0';
commit;




delete FROM BASS1.G_S_04011_DAY
WHERE TIME_ID=20110930
   AND CDR_TYPE IN ('00','10','21')
   AND SVC_TYPE IN ('11','12','13')
   AND SMS_STATUS='0';
commit;

21618	2718


select count(*) from BASS1.G_S_04011_DAY_LS
select count(0),count(distinct product_no ) from    G_S_04011_DAY_LS
21618	2718

select count(0),count(distinct product_no ) from    G_S_04011_DAY where time_id = 20110930
54254	6466

select count(0) from    G_S_04011_DAY where time_id = 20110930

53130

select count(*) from 
(
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<9
) bb



insert into BASS1.G_S_04011_DAY
select 
TIME_ID       ,
PRODUCT_NO    ,
IMSI          ,
OPPOSITE_NO   ,
THIRD_NO      ,
CITY_ID       ,
ROAM_LOCN     ,
CDR_TYPE      ,
SMSC_CODE     ,
ISMG_CODE     ,
FORW_ISMG     ,
SVC_TYPE      ,
COMM_FEE      ,
INFO_FEE      ,
ROAM_TYPE_ID  ,
PAYTYPE_ID    ,
INFO_LEN      ,
SMS_STATUS    ,
INPUT_DATE    ,
INPUT_TIME    ,
PROCESS_DATE  ,
PROCESS_TIME
from
(
select a.*
,row_number() over(partition by product_no order by product_no desc) row_id
from BASS1.G_S_04011_DAY_LS a
) aa
where row_id<2;
commit;


20110930	R109	94.32476	88.18000	0.06968	0.05000

20110930	R109	92.92133	88.18000	0.05377	0.05000
20110930	R109	94.46032	88.18000	0.07122	0.05000

20110930	R109	92.81612	88.18000	0.05258	0.05000
20110930	R109	92.41391	88.18000	0.04801	0.05000

20110930	R109	92.41391	88.18000	0.04801	0.05000


insert into  bass1.g_s_04011_day  select * from bass1.G_S_04011_DAY_LS where time_id = 20110930 with ur;




SELECT 
    SUM(T.TXL) AS TXL,
    COUNT(DISTINCT T.PRODUCT_NO) AS RS
   FROM (
     SELECT PRODUCT_NO,COUNT(*) AS TXL  FROM BASS1.G_S_04011_DAY
     WHERE TIME_ID/100=201109
           AND CDR_TYPE IN ('00','10','21')
           AND SVC_TYPE IN ('11','12','13')
           AND SMS_STATUS='0'
     GROUP BY PRODUCT_NO
     UNION 
     SELECT PRODUCT_NO,COUNT(*)AS TXL  FROM BASS1.G_S_04012_DAY
     WHERE TIME_ID/100=201109
           AND COMM_TYPE='0'
     GROUP BY PRODUCT_NO
     )T
     
 
671386	7290
values 671386*1.00/7290


 select time_id,count(0)
 from  BASS1.G_S_04011_DAY
 where time_id / 100 = 201109
 group by time_id
 
 select * from  table( bass1.get_task('04011')) a 
 
BASS1_G_S_04011_DAY.tcl

select * from  table( bass1.get_after('BASS1_G_A_06001_DAY.tcl')) a 

BASS1_INT_CHECK_VOICE_MONTH.tcl	BASS1_G_S_04011_DAY.tcl
BASS1_INT_CHECK_8895_MONTH.tcl	BASS1_G_S_04011_DAY.tcl
BASS1_INT_CHECK_8895_TO_DAY.tcl	BASS1_G_S_04011_DAY.tcl


--RUNSTATS ON table BASS1.ALL_DIM_LKP 	with distribution and detailed indexes all  

select * from  table( bass1.get_after('BASS1_G_S_04011_DAY.tcl')) a 
select * from  table( bass1.get_task('BASS1_INT_CHECK_8895_MONTH')) a 


select * from  table( bass1.get_task('C1')) a 

BASS1_INT_CHECK_C1K844TO46_TO_DAY.tcl	C1K844TO46校验


select * from  table( bass1.get_BEFORE('BASS1_INT_CHECK_C1K844TO46_TO_DAY.tcl')) a 


20110930	R109	92.41391	88.18000	0.04801	0.05000

select * from  table( bass1.get_before('BASS1_G_S_04011_DAY.tcl')) a 

select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.G_I_02022_DAY 
group by  time_id 
order by 1 

select user_id from G_I_02022_DAY where time_id = 20110930
except 
select user_id from G_I_02022_DAY where time_id = 20110929


select user_id from G_I_02022_DAY where time_id = 20110929
except 

select user_id from G_I_02022_DAY where time_id = 20110930

select plan_id from   bass2.dw_product_20110929
where user_id = '89101110154695'

select * from bass2.Dw_product_ins_prod_ds
where PRODUCT_INSTANCE_ID = '89360000886920      '

OFFER_ID
111089110017
111089150010

89157332187027      
OFFER_ID
111089110017

select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110930
where product_item_id in (111089110017)
OFFER_ID
111089110017
111089140008



89101110305641      


select * from G_I_02022_DAY where 
user_id =
'89160000955982      '

bass2.Dw_product_ins_off_ins_prod_ds


select  TIME_ID,USER_ID,BASE_PKG_ID,VALID_DT
from (
        select 
                20110526 TIME_ID
                ,char(a.product_instance_id)  USER_ID
                ,bass1.fn_get_all_dim_ex('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
                ,replace(char(date(a.VALID_DATE)),'-','') VALID_DT
                ,row_number()over(partition by a.product_instance_id order by expire_date desc ,VALID_DATE desc ) rn 
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110526 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         ) 
) t where t.rn = 1
         and t.user_id = '89101110154695'
         with ur
         

select * from 

          bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  char(a.offer_id) = c.offer_id 
        and a.product_instance_id = '89160000955982'

         

select * from 

          bass2.Dw_product_ins_off_ins_prod_ds a        
        where  a.product_instance_id = '89160000955982'
        
        OFFER_ID
111090001337        
111090001338        

OFFER_ID
111090001337        
111090001338        



select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110930
where product_item_id in (111090001337)


select * from  bass2.dw_product_20110930 a
where user_id in (select user_id from g_i_02022_day where time_id = 20110930)
and date(a.VALID_DATE) =  date(a.expire_date)


'89360000886920'      
,'89760000929374'      
,'89160000923355'      
,'89160000948750'      
,'89660000963909'      
,'89160000955982'      
)




USER_ID
89160001054560
89160001053019

select * from bass1.g_a_02004_02008_stage 
where user_id in ('89160001054560','89160001053019')





select count(0),count(distinct user_id) from    bass1.g_i_02022_day
where time_id = 20110930


15216	15216


select count(0) from     bass2.dw_product_201109



select a.TD_CUST_FEE*1.0000 , b.fee*1.0000
from 
(
select  bigint(TD_CUST_FEE) TD_CUST_FEE  from   G_S_22204_MONTH
where time_id = 201105
and CYCLE_ID = '3'

) a,
(
select (val1 + val2 - val3 )/100  fee
        from 
        (
                select value(sum(a.book_fee),0)*1.00 val1
                  from g_s_03004_month_td a,bass1.td_check_user_fee1 b
                where a.product_no=b.product_no
        )  a,          
        
        (
                select value(sum(a.all_fee-a.book_fee),0)*1.00 val2 
                  from g_s_03004_month_td a,bass1.td_check_user_fee2 b
                where a.product_no=b.product_no
        )  b,          
        (
                select value(sum(a.all_fee),0)*1.00 VAL3
                  from g_s_03004_month_td a,bass1.td_check_user_fee3 b
                where a.product_no=b.product_no
        )  C               
                 
) b
with ur  

select count(0) from    g_s_03004_month_td
select sum(ALL_FEE)/count(distinct PRODUCT_NO) from g_s_03004_month_td

602919025


select * from bass1.g_rule_check where rule_code in ('R228') order by time_id desc

TARGET1	TARGET2
6030846.00000	6010430.96000

                INSERT INTO BASS1.G_RULE_CHECK VALUES (201105,'R228',6030846.0000,6010430.9600000000000,0.00340,0) 

select                 (6030846-6010430)*1.00/6010430
from bass2.dual

select * from   g_s_03004_month_td

select * from   bass1.td_check_user_fee2



select * from   g_s_22204_month where time_id = 201105


select * from    bass1.g_s_22204_month_tmp3


select length(trim(user_id))
, count(0)
from  BASS1.g_a_02004_02008_stage
group by length(trim(user_id))



select * from  table( bass1.get_task('02053')) a 



select * from   app.sch_control_task where 
 substr(control_code , 11,5) in (select interface_code from mon_all_interface where type = 'm' and deadline = 3)
 


select * from   mon_all_interface
where type = 'm'
and interface_code = '22403'


select before_control_code  from  app.sch_control_before where control_code = 'BASS1_G_I_02049_MONTH.tcl'
where 
BASS1_G_I_02049_MONTH.tcl	BASS2_Dw_enterprise_member_ds.tcl
BASS1_G_I_02049_MONTH.tcl	BASS2_Dw_product_ms.tcl
BASS1_G_I_02049_MONTH.tcl	BASS2_Dw_enterprise_member_mid_ms.tcl
BASS1_G_I_02049_MONTH.tcl	BASS2_Dw_enterprise_msg_ds.tcl


select * from   app.sch_control_runlog where control_code in 
(select before_control_code  from  app.sch_control_before where control_code = 'BASS1_G_I_02049_MONTH.tcl')




    
update app.sch_control_task 
set time_value = 210
where CONTROL_CODE = 'BASS1_G_I_02049_MONTH.tcl'
and time_value = 112

update app.sch_control_task 
set time_value = 210
where time_value = 112
and CONTROL_CODE in (
 'BASS1_G_I_02049_MONTH.tcl'
,'BASS1_G_I_02053_MONTH.tcl'
,'BASS1_G_I_03001_MONTH.tcl'
,'BASS1_G_I_03002_MONTH.tcl'
,'BASS1_G_I_03003_MONTH.tcl'
,'BASS1_G_I_06011_MONTH.tcl'
,'BASS1_G_I_06012_MONTH.tcl'
,'BASS1_G_I_06029_MONTH.tcl'
)





select * from   app.sch_control_task where 
 time_value = 112
 
 
 BASS1_G_S_22040_MONTH.tcl	2	2	int -s G_S_22040_MONTH.tcl	0	112	行业应用（OTA）SIM卡用户发展情况	app	BASS1	1	/bassapp/bass1/tcl/
BASS1_G_S_21006_MONTH.tcl	2	2	int -s G_S_21006_MONTH.tcl	0	112	智能网业务月使用 	app	BASS1	1	/bassapp/bass1/tcl/
BASS1_G_S_03012_MONTH.tcl	2	2	int -s G_S_03012_MONTH.tcl	0	112	智能网用户明细收入 	app	BASS1	1	/bassapp/bass1/tcl/

select * from mon_all_interface where type = 'm'
and interface_code = '06031'



select * from mon_all_interface where interface_name like '%区域%'


    
update app.sch_control_task 
set time_value = 310
where CONTROL_CODE = 'BASS1_G_S_03012_MONTH.tcl'
and time_value = 112

select * from  app.sch_control_runlog where date(endtime) = '2011-07-01'
and CONTROL_CODE like 'BASS1%MONTH%'




select * from   app.sch_control_task  where control_code = 'BASS1_INT_CHECK_06031_MONTH.tcl'
    
update app.sch_control_task 
set time_value = 512
where CONTROL_CODE = 'BASS1_G_S_22068_MONTH.tcl'
and time_value = -1


BASS1_INT_CHECK_06031_MONTH.tcl

select * from  table( bass1.get_before('BASS1_INT_CHECK_06031_MONTH.tcl')) a 

select * from   bass1.all_dim_lkp_160
where BASS1_VALUE = '1520'


select * from   


select * from   app.sch_control_task  where control_code like '%INT_CH%MONTH%'
AND CC_FLAG = 1



select * from   

select * from  table( bass1.get_after('BASS2_Dw_enterprise_industry_apply.tcl')) a 



select * from  table( bass1.get_task('02004')) a 


BASS1_G_A_02004_DAY.tcl

select * from  table( bass1.get_after('BASS1_G_A_02004_DAY.tcl')) a 



                                select a.cnt*1.00 ,value(b.income,0) income
                                from
                                (select count(0) cnt
                                                        from 
                                                        (
                                                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                                                        from (
                                                        select *
                                                        from g_a_02054_day where 
                                                         time_id/100 <= 201105 and ENTERPRISE_BUSI_TYPE = '1520'
                                                         and MANAGE_MODE = '3'
                                                        ) t 
                                                        ) t2 where rn = 1 and STATUS_ID ='1'
                                ) a,(
                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201105
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                union all 
                                select sum(bigint(income)) income from   g_s_03018_month
                                where time_id = 201105
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                ) t 
                                ) b 
                        with ur

select count(0) from    G_S_03017_MONTH where ENT_BUSI_ID = '1520'
and time_id = 201105

                        
select count(0) from    G_I_02049_MONTH where                         time_id = 201105
and ENTERPRISE_ID in (select ENTERPRISE_ID from  G_S_03017_MONTH where ENT_BUSI_ID = '1520'
and time_id = 201105)

select 



select SP_TYPE , count(0) 
--,  count(distinct SP_TYPE ) 
from g_i_06012_month 
group by  SP_TYPE 
order by 1 


create table bass2.dw_newbuis_flysms_dm_201107 like bass2.dw_newbuis_flysms_dm_yyyymm in tbs_ods_other 
index in tbs_index partitioning key (product_no) using hashing not logged initially;


select channel_id  from    
BASS1.G_I_06021_MONTH 
where time_id = 201107 and CHANNEL_STATUS = '1' 
and   channel_type in ('1','2')
except
select channel_id  val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201107 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in ('1','2','3')

1
100000844                               
10320010                                
100000845                               
100000930                               


update BASS1.G_I_06021_MONTH  
set CHANNEL_B_TYPE = '1'
where time_id = 201107
and CHANNEL_ID in 
(
'100000844'
,'100000845'
,'100000930'
,'10320010'   
)

select * from syscat.tables where tabname like '%INT_02004_02008%'
   7565	1207245


select * from   bass1.g_rule_check where rule_code = 'R237'



select * from    BASS1.ALL_DIM_LKP where bass1_tbid  = 'BASS_STD1_0074'
select * from    BASS1.ALL_DIM_LKP  where lower(xzbas_tbname) like '%dim_acct_item%'
dim_acct_item


select * from   bass1.mon_all_interface where interface_code in ('03002','03007','03004','03005','22038','22207')


select ITEM_ID , count(0) 
--,  count(distinct time_id ) 
from G_I_03002_MONTH 
where time_id = 201109
group by  ITEM_ID 
order by 1 




select * from    BASS1.ALL_DIM_LKP  where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_value
in
('0101'
,'0201'
,'0203'
,'0207'
,'0305'
,'0311'
,'0313'
,'0315'
,'0319'
,'0321'
,'0323'
,'0327'
,'0329'
,'0333'
,'0335'
,'0401'
,'0403'
,'0501'
,'0519'
,'0520'
,'0521'
,'0522'
,'0523'
,'0525'
,'0599'
,'0605'
,'0611'
,'0613'
,'0615'
,'0626'
,'0627'
,'0631'
,'0633'
,'0635'
,'0637'
,'0638'
,'0639'
,'0699'
,'0715'
,'0716'
,'0901')


select distinct xzbas_tbname, bass1_tbid from    BASS1.ALL_DIM_LKP  where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid <> 'BASS_STD1_0074'

select * from   

select * from  table( bass1.get_before('02004')) a 

drop FUNCTION bass1.get_before
CREATE FUNCTION bass1.get_before(p_control_code varchar(128))
RETURNS
TABLE (control_code varchar(128),before_control_code varchar(128))
RETURN
select control_code,before_control_code from app.sch_control_before 
where  locate(upper(p_control_code),upper(control_code)) > 0
---------------------------------------------------------------------------------------------
drop FUNCTION bass1.get_after
CREATE FUNCTION bass1.get_after(p_before_control_code varchar(128))
RETURNS
TABLE (control_code varchar(128),before_control_code varchar(128))
RETURN
select control_code,before_control_code from app.sch_control_before 
where  locate(upper(p_before_control_code),upper(before_control_code)) > 0




select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from G_A_02052_MONTH 
group by  TIME_ID 
order by 1 



  ds App_xysc_school_user_ms.tcl 2011-05-01  ds App_xysc_comp_user_ms.tcl 2011-05-01  ds App_xysc_new_user_ms.tcl 2011-05-01  ds App_xysc_new_user_xs_ms.tcl 2011-05-01
  
  
  select count(0),count(distinct COMP_PRODUCT_NO ) from  G_I_21020_MONTH
  where time_id = 201109
  
  
  678632	678609


select COMP_PRODUCT_NO,count(0)
from G_I_21020_MONTH
  where time_id = 201109
group by COMP_PRODUCT_NO having count(0) > 1


select * from    G_I_21020_MONTH
  where time_id = 201109
and   COMP_PRODUCT_NO = '13228900838       '


select * from   
 bass2.dw_comp_cust_201109
 where  COMP_PRODUCT_NO = '13228986978'
 
 
 select * from   bass2.dw_comp_all_201109
  where  COMP_PRODUCT_NO = '13228986978'


update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201109 )


                                select 
                                                201109,
                                                a.comp_product_no,
                                                case 
                                                  when a.comp_brand_id in (3,4) then '021000'
                                                  when a.comp_brand_id in (7)   then '022000'
                                                  when a.comp_brand_id in (9,10,11) then '031000'
                                                  when a.comp_brand_id in (2) then '032000'
                                                  when a.comp_brand_id in (1,8) then '033000'
                                                  when a.comp_brand_id in (6) then '034000'
                                                end ,
                                                replace(substr(char(a.comp_open_date),1,10),'-',''),
                                                replace(substr(char(a.comp_last_date),1,10),'-',''),
                                                value(char(sum(b.in_call_counts+b.out_call_counts)),'0'),
                                                value(char(sum(b.mo_sms_counts+b.mt_sms_counts)),'0'),
                                          value(char(sum(b.mo_mms_counts+b.mt_mms_counts)),'0')                                                                         
                                from  bass2.dw_comp_cust_201109 a
                                left join bass2.dw_comp_all_201109 b on a.comp_product_no = b.comp_product_no
                                where a.comp_userstatus_id = 1
                                  and a.comp_brand_id in (1,2,3,4,6,7,8,9,10,11)
                                  and a.COMP_PRODUCT_NO like  '%13228986978%'
                        group by a.comp_product_no,
                                                case 
                                                  when a.comp_brand_id in (3,4) then '021000'
                                                  when a.comp_brand_id in (7)   then '022000'
                                                  when a.comp_brand_id in (9,10,11) then '031000'
                                                  when a.comp_brand_id in (2) then '032000'
                                                  when a.comp_brand_id in (1,8) then '033000'
                                                  when a.comp_brand_id in (6) then '034000'
                                                end ,
                                                replace(substr(char(a.comp_open_date),1,10),'-',''),
                                                replace(substr(char(a.comp_last_date),1,10),'-','') 
                                                order by a.comp_product_no desc
                                                



select length(trim(COMP_PRODUCT_NO)) , count(0) 
--,  count(distinct length(COMP_PRODUCT_NO) ) 
from bass2.dw_comp_cust_201109 
group by  length(trim(COMP_PRODUCT_NO)) 
order by 1                                                 

select * from   bass2.dw_comp_cust_201109 
where length(COMP_PRODUCT_NO)  > 11


678632	678609



select * from    bass1.g_rule_check where rule_code  between 'R230' AND 'R234'
order by 1 desc 



select * from     bass2.DIM_ACCT_ITEM 


update app.sch_control_runlog 
set flag = -2 
where control_code in 
(
 'BASS1_EXP_G_I_03007_MONTH'
,'BASS1_INT_CHECK_F7_MONTH.tcl'
,'BASS1_INT_CHECK_R028_MONTH.tcl'
,'BASS1_INT_CHECK_R029_MONTH.tcl'
,'BASS1_G_I_03007_MONTH.tcl'
)
and flag = 0


select  * from APP.G_FILE_REPORT


select count(0),count(distinct filename) from APP.G_FILE_REPORT
where  err_code='00'
and substr(filename,9,8)  between '20110901' and '20110930'
 
 
 select * from APP.G_FILE_REPORT
where  err_code='00'
and substr(filename,9,8)  between '20110901' and '20110930'

63*30


select * from   g_a_01004_day where time_id = 20110706



select IMP_ACCEPTTYPE , count(0) ,sum(bigint(CNT))
--,  count(distinct IMP_ACCEPTTYPE ) 
from G_S_22064_MONTH 
group by  IMP_ACCEPTTYPE 
order by 1 


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22064_MONTH 
group by  time_id 
order by 1 




select time_id, IMP_ACCEPTTYPE , count(0) ,sum(bigint(CNT))
--,  count(distinct IMP_ACCEPTTYPE ) 
from G_S_22064_MONTH 
where IMP_ACCEPTTYPE in ('22','11','28','17')
group by time_id, IMP_ACCEPTTYPE 
order by 1 ,2



select * from   bass2.DW_MOBILEPAY_HISTORY_DM_201105

select tabname from syscat.tables where tabname like '%MOBILEPAY%'   

select * from   bass2.DWD_MOBILEPAY_OPEN_20110707



select * from   BASS2.dw_acct_payment_dm_201109


select * from   bass2.Dim_acct_paytype
where paytype_name like '%手机支付%'



                                select count(distinct user_id),
                                                sum(amount)
                                              
                                  from BASS2.dw_acct_payment_dm_201109 b,BASS2.Dim_acct_paytype c
                                where b.opt_code=c.paytype_id
                                   and
                                   (  c.paytype_name like '%手机支付%'
                                   )
                                   and b.state='0'
                                   and c.sts=1
                                group by COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0054',b.region_id),'13101')
                                
                                
                                
select tabname from syscat.tables where tabname like '%FEETYPE%'                                   


TABNAME
MAP_FEETYPE_ACCOUNT_ITEM

DIM_CUST_VALUE_FEETYPE
DIM_FEETYPE_ITEM
DIM_FEETYPE_ITEM_TMP
DIM_FEETYPE_ITEM_VIEW
DIM_ITEM_FEETYPE_RELA
DIM_KPI_FEETYPE
MAP_ACCT_ITEM_FEETYPE
MAP_KPI_FEETYPE



select * from   bass2.DIM_FEETYPE_ITEM
where feetype_id = 637


select item_id from   bass2.DIM_ACCT_ITEM_FEETYPE
where feetype_id = 717



select * from   bass2.DIM_KPI_FEETYPE

select * from   bass2.MAP_KPI_FEETYPE

select * from   bass2.dim_acct_item 
where item_id in (
select item_id from   bass2.DIM_ACCT_ITEM_FEETYPE
where feetype_id = 717
)

select tabname from syscat.tables where tabname like '%BUSI%TYPE%'   

select * from   bass2.DIM_BUSI_TYPE where busi_type_name like '%手机阅读%'


select tabname from syscat.tables where tabname like '%PAYMENT_DM%'


select count(distinct a.user_id),sum(a.fact_fee)
     from bass2.DW_ACCT_SHOULD_DTL_201109    a,
    bass2.dw_product_201109 b
where a.user_id = b.user_id 
and feetype_id in (717)
and b.userstatus_Id in (1,2,3,6,8) 
and b.test_mark<>1 and
b.usertype_Id in (1,2,9)
with ur 
                          

select tabname from syscat.tables where tabname like '%DW_PRODUCT_____'   

46997	228337.53
values 228337.53/46997


                          group by b.city_id,c.kpi_brand_id
                          
                          
                          
    select count(distinct a.user_id),
                    sum(amount)
      from BASS2.dw_acct_payment_dm_201109 b,BASS2.Dim_acct_paytype c
      ,bass2.dw_product_201109 a
    where  a.user_id = b.user_id
    and a.test_mark<>1
    and  a.userstatus_Id in (1,2,3,6,8) 
    and a.usertype_Id in (1,2,9)
    and b.opt_code=c.paytype_id
       and
       (  c.paytype_name like '%手机支付%'
       )
       and b.state='0'
       and c.sts=1



    select count(distinct a.user_id),
                    sum(amount)
      from BASS2.dw_acct_payment_dm_201105 b,BASS2.Dim_acct_paytype c
      ,bass2.dw_product_201105 a
    where  a.user_id = b.user_id
    and a.test_mark<>1
    and  a.userstatus_Id in (1,2,3,6,8) 
    and a.usertype_Id in (1,2,9)
    and b.opt_code=c.paytype_id
       and
       (  c.paytype_name like '%手机支付%'
       )
       and b.state='0'
       and c.sts=1


无线音乐


                          select count(distinct a.user_id) as kpi_value
                         from bass2.dw_product_sprom_201105 a ,
                              bass2.dw_product_201105 b
                        where a.sprom_id in (50001403) and a.user_id=b.user_id
                              and b.usertype_id in (1,2,9)
                              and a.active_mark = 1
                                        and date(a.valid_date) < '2011-06-01'
                              and date(a.expire_date) >= '2011-06-01'


                          select count(distinct a.user_id),
                                 sum( a.fact_fee)
                          from bass2.dw_acct_should_dtl_201105 a,bass2.dw_product_201105 d
                          where a.user_id = d.user_id 
                          and d.test_mark = 0
                          and feetype_id=637


328678	1634870.00

values        1634870.00/ 328678	


select count(distinct b.USER_ID),sum(b.FACT_FEE)
 from bass2.dw_acct_shoulditem_201105 b,bass2.dw_product_201105 a
               	   where item_id in (80000721,80000720,80000625,80000514,80000515)
                   and a.user_id = b.user_id
    and a.test_mark<>1
    and  a.userstatus_Id in (1,2,3,6,8) 
    and a.usertype_Id in (1,2,9)
    
2711	16224.00

values          16224.00/   2711

1	2
2627	15720.00


select count(distinct b.USER_ID),sum(b.FACT_FEE)
 from bass2.dw_acct_shoulditem_201105 b,bass2.dw_product_201105 a
               	   where item_id in (80000721,80000720,80000625,80000514,80000515)
                   and a.user_id = b.user_id

                   
select * from   g_s_03017_month




select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201105
and manage_mod = '1'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201105
and manage_mod = '1'
) t

                                     




select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and manage_mod = '1'
and  exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id 
from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  
where a.time_id/100 <= 201109
) t 
)
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201109
and manage_mod = '1'
and  exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id 
from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  
where a.time_id/100 <= 201109
) t 
)
) t


                                     

select user_id
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110701
) t
) t2
where rn = 1 


                                     
select count(0) from   BASS1.int_02004_02008_month_stage a ,
(select user_id
from 
(
select t.*,row_number()over(partition by user_id order by time_id ) rn 
from 
(
select * from g_a_02059_day a
where TIME_ID < 20110701 and length(trim(user_id)) = 14
) t
) t2
where rn = 1 
) b 
where a.user_id = b.user_id
and  a.usertype_id  IN ('2010','2020','2030','9000')

321900

select * from   BASS1.int_02004_02008_month_stage a

select count(0),count(distinct user_id) from     BASS1.int_02004_02008_month_stage a
where a.usertype_id  IN ('2010','2020','2030','9000')
and test_flag = '0'
and time_id/100 = 201109

63198

63199
60743.00	61041.00

西藏	R127	|(本月离网用户数 / 上月离网用户数 - 1) x 100%| ≤ 20%	60743.00	61041.00




						select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
						from 
						(
						select * from G_A_02059_DAY
						where 
						 time_id <= 20110930
						and length(trim(user_id)) = 14
						) t


G_I_02049_MONTH

select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from BASS1.int_02004_02008_month_stage 
group by  TIME_ID 
order by 1 

                                     
select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from G_I_02049_MONTH 
group by  TIME_ID 
order by 1 

                                     
                               
select count(0) from   BASS1.int_02004_02008_month_stage a ,
G_I_02049_MONTH b 
where a.user_id = b.user_id
and b.time_id = 201109
and  a.usertype_id  IN ('2010','2020','2030','9000')


select * from   G_I_02049_MONTH

201109	458948
201105	452450

except
select user_id from G_I_02049_MONTH where time_id = 201109

select * from   G_I_02049_MONTH


select count(0) from    
(
select user_id,enterprise_id from G_I_02049_MONTH where time_id = 201105
)a , BASS1.int_02004_02008_month_stage b 
where a.user_id = b.USER_ID
and  b.usertype_id  IN ('2010','2020','2030','9000')
and b.TIME_ID / 100 = 201109
and b.TEST_FLAG = '0'
and  exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id 
from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  
where a.time_id/100 <= 201109
) t 
)


10415


12071

select * from    BASS1.int_02004_02008_month_stage 

and  exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id 
from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  
where a.time_id/100 <= 201109
) t 
)




alter table bass1.int_02004_02008_month_stage activate not logged initially with empty table

insert into bass1.int_02004_02008_month_stage (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1




select count(0) from    
(
select user_id,enterprise_id from G_I_02049_MONTH where time_id = 201103
)a , BASS1.int_02004_02008_month_stage b 
where a.user_id = b.USER_ID
and  b.usertype_id  IN ('2010','2020','2030','9000')
and b.TIME_ID / 100 = 201104
and b.TEST_FLAG = '0'
and  exists (select 1 from (select distinct value(b.NEW_ENTERPRISE_ID,a.enterprise_id) enterprise_id 
from bass1.G_A_01004_DAY a 
LEFT JOIN BASS2.TRANS_ENTERPRISE_ID_20100625 B on  A.enterprise_id = B.ENTERPRISE_ID  
where a.time_id/100 <= 201104
) t 
)


select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc 



select * from   mon_all_interface
where interface_code 
in
(
 '06001'
,'06002'
,'02031'
,'02032'
,'02033'
,'02034'
,'02035'
,'22401'
,'22402'
,'22403'
,'22404'
,'22405'
,'22406'
)


select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
) t


                


select * from   BASS1.G_RULE_CHECK where time_id=201109 and rule_code in ('R216') 


select TIME_ID,ENTERPRISE_ID,ENTERPRISE_BUSI_TYPE, MANAGE_MODE from   G_A_02054_DAY



select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
union 
select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02064_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
                           
 select * from  bass2.dwd_enterprise_msg_20110930
 where ENTERPRISE_ID in (
                                                   
select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02064_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
)                                                        




select sum(income)*1.00/100
from (
select ENTERPRISE_ID, sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
group by ENTERPRISE_ID having  sum(bigint(income))  > 0
union all 
select  USER_ID, sum(bigint(income)) income from   g_s_03018_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
group by USER_ID having  sum(bigint(income))  > 0
) t




89157334336511      

select * from   bass2.dw_product_20110930
where user_id = '89157334336511'
CUST_ID
89160000721406

select * from   bass2.dw_cust_20110930
where cust_id = '89160000721406'
CUST_ID	CUST_NAME
89160000721406	亚信测试



ENTERPRISE_ID
89301560001331      
89100000000749      
89102999394670      
89201560000657      
89103001480744      
89103001632461      
89402999049599      
89103001458113      


 select group_name from  bass2.dwd_enterprise_msg_20110930
 where ENTERPRISE_ID in (                                                   
select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02064_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
)                                                        


except
select group_name from      bass2.dwd_enterprise_msg_20110930
where enterprise_id
in(
 '89301560001331'
,'89100000000749'
,'89102999394670'
,'89201560000657'
,'89103001480744'
,'89103001632461'
,'89402999049599'
,'89103001458113'
)


select * from   BASS1.G_RULE_CHECK where time_id=201109 and rule_code in ('R207') 


                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02060_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110930
                                                and MANAGE_MODE = '3'   
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
                                
                                


                        select count(0) cnt 
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from g_a_02054_day where  time_id <= 20110930
                                        and ENTERPRISE_BUSI_TYPE in ('1230')
                                        and MANAGE_MODE = '3'   
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'


blackberry
                               select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02060_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110703
                                                and MANAGE_MODE = '3'   
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'

                                


select sum(income)*1.00/100
from (
select sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1230'
union all 
select sum(bigint(income)) income from   g_s_03018_month
where time_id = 201109
and ent_busi_id = '1230'
) t


select * from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1230'

select * from   g_s_03018_month
where time_id = 201109
and ent_busi_id = '1230'

                                
                                
                               select *
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02060_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1230')                                              
                                                and time_id <= 20110930
                                                and MANAGE_MODE = '3'   
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'

                                
                                
ENTERPRISE_ID	USER_ID
89103000799409      	89157333415151      
89103000799409      	89157334086019      
89103000799409      	89157334204492      


select group_name from      bass2.dwd_enterprise_msg_20110930
where ENTERPRISE_ID = '89103000799409'

                                
select * from   bass2.dw_cust_20110930 a 
, bass2.dw_product_20110930 b where 
a.cust_id = b.cust_id
and b.user_id 
in (
'89157333415151'
,'89157334086019'
,'89157334204492'
)


80000180 
80000184 
80000598 
80000599 
82000111 




select count(distinct b.USER_ID),sum(b.FACT_FEE)
 from bass2.dw_acct_shoulditem_201105 b,bass2.dw_product_201105 a
               	   where item_id in (80000721,80000720,80000625,80000514,80000515)
                   and a.user_id = b.user_id


select * from   bass2.dim_acct_item
where item_id in (
80000180,80000184,80000598,80000599,80000599,82000111
)
ITEM_ID	ITEM_NAME
80000180	BlackBerry功能费
80000184	BlackBerry通信费
80000598	BlackBerry集团客户扩展业务功能费
80000599	BlackBerry集团客户扩展业务通信费
82000111	Black Berry虚科目


select count(distinct b.USER_ID),sum(b.FACT_FEE)
 from bass2.dw_acct_shoulditem_201105 b,bass2.dw_product_201105 a
               	   where item_id in (
80000180,80000184,80000598,80000599,80000599,82000111
)
                   and a.user_id = b.user_id

1	2
29	9984.35

select b.*,c.*,a.test_mark from    bass2.dw_acct_shoulditem_201105 b,bass2.dw_product_201105 a
, bass2.dim_acct_item c
               	   where b.item_id in (
80000180,80000184,80000598,80000599,80000599,82000111
)
                   and a.user_id = b.user_id
                   and b.ITEM_ID = c.ITEM_ID



select * from    bass1.map_feetype_account_item
where lower(feetype_name) like '%black%'



select
a.ENTERPRISE_ID,
'1040' ent_busi_id,
'3',
'024',
sum(d.fact_fee*100)
from bass2.dw_enterprise_member_mid_201109 a,
bass2.dw_enterprise_msg_201109 b,
bass2.dw_wireless_phone_201109 c ,
bass2.dw_product_201109 d
where a.enterprise_id = b.enterprise_id
and a.dummy_mark = 0
and a.user_id=c.user_id
and c.user_id=d.user_id
and c.user_flag=2
and b.enterprise_id not in ('89100000000682','89100000000659','89100000000656','89100000000651')
group by a.ENTERPRISE_ID



select
count(0)
from
(
select
a.enterprise_id as enterprise_id
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
,case
        when upper(b.config_value)='MAS' then '1'
        when upper(b.config_value)='ADC' then '2'
        else '3'
end as manage_mod
,case when a.item_id=80000618 then '105'
when a.item_id=80000619 then '120'
else  '090' 
end  as account_item
,sum(a.unipay_fee)*100 as income
from  session.t_dw_enterprise_unipay a
left join (select * from bass2.dim_service_config where config_id=1000027)  b on a.service_id = b.service_id
left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on a.service_id = c.xzbas_value
where a.enterprise_id not in ('89102999670396','89103000041929')
and a.service_id  in ('966') and a.enterprise_id is not null
group by
a.
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
,case
        when upper(b.config_value)='MAS' then '1'
        when upper(b.config_value)='ADC' then '2'
        else '3'
end
,case when a.item_id=80000618 then '105'
when a.item_id=80000619 then '120'
else  '090' 
end
)t



select count(0) from    bass1.G_S_03017_MONTH where time_id=201109                                                                  
16804

declare global temporary table session.tmp03017
                (
                  enterprise_id         char(20)   not null,
            ent_busi_id                 char(4)    not null,
            manage_mod                          char(1)    not null,
            account_item          varchar(3) not null,
            income                bigint
            )
            partitioning key (ENTERPRISE_ID) using hashing
            with replace on commit preserve rows not logged in tbs_user_temp


declare global temporary table session.t_dw_enterprise_unipay
                        ( ENTERPRISE_ID  VARCHAR(20),
                          ACCT_ID        VARCHAR(20),
                          ITEM_ID        INTEGER,
                          SPECIAL_MARK   SMALLINT,
                          SERVICE_ID     VARCHAR(20),
                          UNIPAY_FEE     DECIMAL(9, 2),
                          NON_UNIPAY_FEE DECIMAL(9, 2) )
            partitioning key (ENTERPRISE_ID) using hashing
            with replace on commit preserve rows not logged in tbs_user_temp
 insert into session.t_dw_enterprise_unipay
                    ( enterprise_id ,
                        acct_id,
                        ITEM_ID,
                        special_mark,
                        service_id ,
                        unipay_fee,
                        non_unipay_fee)
                         select case
                                        when b.enterprise_id is not null then b.enterprise_id
                                        when c.enterprise_id is not null then c.enterprise_id
                                        when d.enterprise_id is not null then d.enterprise_id
                           else '' end as enterprise_id,
                      a.acct_id,
                      a.item_id,
                      case when c.level_def_mode=1 then 1 when c.enterprise_id=d.enterprise_id and c.level_def_mode=1 then 1 else 0 end as special_mark,
                      '966'    ,
                    sum(case when b.acct_id is not null then a.fact_fee else 0 end) as unipay_fee,
                    sum(case when b.acct_id is null then a.fact_fee else 0 end) as non_unipay_fee
               from (select cust_id,acct_id,item_id,sum(fact_fee) as fact_fee
                   from bass2.dw_acct_shoulditem_201109
                   where item_id in (80000618,80000619)
                   group by cust_id,acct_id,item_id) a left join bass2.dw_enterprise_account_his_201109 b on a.acct_id=b.acct_id
                                                    left join bass2.dw_enterprise_msg_201109 c on a.cust_id=c.cust_id
                                                    left join bass2.dw_enterprise_member_his_201109 d on a.cust_id=d.cust_id
               group by case
                                when b.enterprise_id is not null then b.enterprise_id
                                when c.enterprise_id is not null then c.enterprise_id
                                when d.enterprise_id is not null then d.enterprise_id
                             else '' end,
                        a.acct_id,
                        a.item_id,
                        case when c.level_def_mode=1 then 1 when c.enterprise_id=d.enterprise_id and c.level_def_mode=1 then 1 else 0 end



insert into session.tmp03017
                  select
                  enterprise_id,
                  ent_busi_id,
                  manage_mod,
                  account_item,
                  income
                  from
                  (
                   select
                      c.enterprise_id
                      ,'1000' as ent_busi_id
                      ,'3'    as manage_mod
                      ,e.account_item_id  as account_item
                      ,sum(a.fact_fee)*100 as income
                   from
                      bass2.dw_acct_shoulditem_201109 a,
                      bass2.dw_enterprise_account_201109 b,
                      bass2.dw_enterprise_member_mid_201109 c,
                      bass2.dim_feetype_item d,
                      bass1.map_feetype_account_item e
                   where c.free_mark =0
                     and c.test_mark = 0
                     and a.user_id = c.user_id
                     and a.acct_id = b.acct_id
                     and a.item_id = d.item_id
                     and d.feetype_id = e.feetype_id
                     and b.rec_status = 1
                     and a.item_id not in (80000027,80000032,80000033,80000101)
                   group by
                      c.enterprise_id,e.account_item_id
                   )aa                        


insert into session.tmp03017
                  select
                    enterprise_id,
                    ent_busi_id,
                    manage_mod,
                    account_item,
                    income
                  from
                  (
                   select
                     a.enterprise_id
                     ,'4002' as ent_busi_id
                     ,'3' as manage_mod
                     ,'101' as account_item
                     ,sum(b.pay_fee)*100 as income
                   from
                     bass2.dw_enterprise_msg_201109 a,
                     bass2.dw_enterprise_oneoff_pay_201109 b
                   where
                     a.enterprise_id = b.enterprise_id
                   group by
                     a.enterprise_id
                  )t                   


insert into session.tmp03017
                  select
                    enterprise_id,
                    ent_busi_id,
                    manage_mod,
                    account_item,
                    income
                  from
                  (
                   select
                     a.enterprise_id as enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
                     ,case
                                                                                                when C.BASS1_VALUE='1520' then '3'
                                                                                                when upper(b.config_value)='MAS' then '1'
                                                                                                when upper(b.config_value)='ADC' then '2'
                                                                                                else '3'
                                                                                        end as manage_mod
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090') as account_item
                     ,sum(a.unipay_fee)*100 as income
                   from  bass2.dw_enterprise_unipay_201109 a
                   left join (select * from bass2.dim_service_config where config_id=1000027)  b on a.service_id = b.service_id
                                           left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on a.service_id = c.xzbas_value
                   where a.test_mark = 0
                     and a.service_id not in ('936','966','926') and a.enterprise_id is not null
                      and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'
                   group by
                     a.enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
                     ,case
                                                                                                when C.BASS1_VALUE='1520' then '3'                     
                                                                                                when upper(b.config_value)='MAS' then '1'
                                                                                                when upper(b.config_value)='ADC' then '2'
                                                                                                else '3'
                                                                                        end
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090')
                  )t

                  

insert into session.tmp03017
                  select
                    enterprise_id,
                    ent_busi_id,
                    manage_mod,
                    account_item,
                    income
                  from
                  (
                   select
                     a.enterprise_id as enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
                     ,case
                                                                                                when C.BASS1_VALUE='1520' then '3'
                                                                                                when upper(b.config_value)='MAS' then '1'
                                                                                                when upper(b.config_value)='ADC' then '2'
                                                                                                else '3'
                                                                                        end as manage_mod
                     ,case when a.item_id=80000618 then '105'
                                         when a.item_id=80000619 then '120'
                                         else  '090' 
                        end  as account_item
                     ,sum(a.unipay_fee)*100 as income
                   from  session.t_dw_enterprise_unipay a
                   left join (select * from bass2.dim_service_config where config_id=1000027)  b on a.service_id = b.service_id
                                           left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on a.service_id = c.xzbas_value
                   where a.enterprise_id not in ('89102999670396','89103000041929')
                     and a.service_id  in ('966') and a.enterprise_id is not null
                     and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'
                   group by
                     a.enterprise_id
                     ,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
                     ,case
                                                                                                when C.BASS1_VALUE='1520' then '3'
                                                                                                when upper(b.config_value)='MAS' then '1'
                                                                                                when upper(b.config_value)='ADC' then '2'
                                                                                                else '3'
                                                                                        end
                     ,case when a.item_id=80000618 then '105'
                                         when a.item_id=80000619 then '120'
                                         else  '090' 
                      end
                  )t



insert into session.tmp03017
                  select
                    case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end,
                    '1290' as ent_busi_id,
                    '1'    as manage_mod,
                    '060'  as account_item,
                    sum(a.unipay_fee*100) as fact_fee
            from bass2.DW_ENTERPRISE_UNIPAY_201109 a
                                                           left outer join
                 bass2.DW_ENTERPRISE_MSG_201109 b on a.ENTERPRISE_ID=b.ENTERPRISE_ID
                                                           left join
                                                           bass2.dw_enterprise_account_his_201109 c on a.acct_id=c.acct_id
           where a.enterprise_id not in ('891910006274','891950005002') and
                 a.service_id in ('936') and a.TEST_MARK = 0 and
                 case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end is not null
        group by case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end
集团统付收入
insert into session.tmp03017
                    select
                    c.enterprise_id,
                    '1360' as ent_busi_id,
                    '3'    as manage_mod,
                    '010'  as account_item,
                    sum(bigint(b.fee*100)) as income
               from bass2.dw_enterprise_industry_apply b
               left outer join (select distinct enterprise_id,user_id
                                                    from bass2.dw_enterprise_membersub_201109 ) c
                                      on b.user_id = c.user_id
              where  b.op_time = '2011-06-01' and b.apptype_id in (5) and b.user_id is not null and b.enterprise_id is not null
            group by c.enterprise_id 



insert into session.tmp03017
                  select
                    case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end,
                    '1290' as ent_busi_id,
                    '1'    as manage_mod,
                    '060'  as account_item,
                    sum(a.unipay_fee*100) as fact_fee
            from bass2.DW_ENTERPRISE_UNIPAY_201109 a
                                                           left outer join
                 bass2.DW_ENTERPRISE_MSG_201109 b on a.ENTERPRISE_ID=b.ENTERPRISE_ID
                                                           left join
                                                           bass2.dw_enterprise_account_his_201109 c on a.acct_id=c.acct_id
           where a.enterprise_id not in ('891910006274','891950005002') and
                 a.service_id in ('936') and a.TEST_MARK = 0 and
                 case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end is not null
        group by case when b.enterprise_id is null then c.enterprise_id else b.enterprise_id end

                  


insert into session.tmp03017
                    select
                    c.enterprise_id,
                    '1360' as ent_busi_id,
                    '3'    as manage_mod,
                    '010'  as account_item,
                    sum(bigint(b.fee*100)) as income
               from bass2.dw_enterprise_industry_apply b
               left outer join (select distinct enterprise_id,user_id
                                                    from bass2.dw_enterprise_membersub_201109 ) c
                                      on b.user_id = c.user_id
              where  b.op_time = '2011-06-01' and b.apptype_id in (5) and b.user_id is not null and b.enterprise_id is not null
            group by c.enterprise_id 


insert into session.tmp03017
                 select
                                                                          a.ENTERPRISE_ID,
                                                                          '1040' ent_busi_id,
                                                                          '3',
                                                                          '024',
                                                                          sum(d.fact_fee*100)
                                                                        from bass2.dw_enterprise_member_mid_201109 a,
                                                                             bass2.dw_enterprise_msg_201109 b,
                                                                             bass2.dw_wireless_phone_201109 c ,
                                                                             bass2.dw_product_201109 d
                                                                        where a.enterprise_id = b.enterprise_id
                                                                          and a.dummy_mark = 0
                                                                          and a.user_id=c.user_id
                                                                          and c.user_id=d.user_id
                                                                          and c.user_flag=2
                                                                          and b.enterprise_id not in ('89100000000682','89100000000659','89100000000656','89100000000651')
                                                                        group by a.ENTERPRISE_ID


select * from   session.tmp03017
where ent_busi_id = '1230'                                                                        

select * from    bass2.dw_enterprise_unipay_201109

bass2.dw_enterprise_unipay_201109






select
enterprise_id,
ent_busi_id,
manage_mod,
account_item,
income
from
(
select
a.enterprise_id as enterprise_id
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002') as ent_busi_id
,case
            when C.BASS1_VALUE='1520' then '3'
            when upper(b.config_value)='MAS' then '1'
            when upper(b.config_value)='ADC' then '2'
            else '3'
    end as manage_mod
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090') as account_item
,sum(a.unipay_fee)*100 as income
from  bass2.dw_enterprise_new_unipay_201109 a
left join (select * from bass2.dim_service_config where config_id=1000027)  b on char(a.service_id) = b.service_id
left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on char(a.service_id) = c.xzbas_value
where a.test_mark = 0
and char(a.service_id) not in ('936','966','926') and a.enterprise_id is not null
and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'
group by
a.enterprise_id
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
,case
            when C.BASS1_VALUE='1520' then '3'                     
            when upper(b.config_value)='MAS' then '1'
            when upper(b.config_value)='ADC' then '2'
            else '3'
    end
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0109',char(a.service_id)),'090')
)t


select a.*    
from  bass2.dw_enterprise_new_unipay_201109 a
left join (select * from bass2.dim_service_config where config_id=1000027)  b on char(a.service_id) = b.service_id
left join (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') c on char(a.service_id) = c.xzbas_value
where a.test_mark = 0
and char(a.service_id) not in ('936','966','926') and a.enterprise_id is not null
and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'

select count(0) from    G_S_03018_MONTH where time_id = 201109
1
165522



select a.*
                  from bass2.dw_enterprise_unipay_201109 a,
                       (select acct_id,min(user_id) as user_id from  bass2.dw_product_201109 where userstatus_id<>0 and usertype_id in (1,2,9) group by acct_id) b,
                       (select * from bass2.dim_service_config where config_id=1000027)  c,
                                               (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') d
                 where a.acct_id = b.acct_id 
                   and char(a.service_id) =c.service_id
                   and char(a.service_id) = d.xzbas_value
                   and a.test_mark = 0 
                   and char(a.service_id) <> '926'
                   and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'
                 
                 

select a.*
                  from bass2.dw_enterprise_new_unipay_201109 a,
                       (select acct_id,min(user_id) as user_id from  bass2.dw_product_201109 where userstatus_id<>0 and usertype_id in (1,2,9) group by acct_id) b,
                       (select * from bass2.dim_service_config where config_id=1000027)  c,
                                               (select * from bass1.all_dim_lkp_160 where bass1_tbid='BASS_STD1_0108') d
                 where a.acct_id = b.acct_id 
                   and char(a.service_id) =c.service_id
                   and char(a.service_id) = d.xzbas_value
                   and a.test_mark = 0 
                   and char(a.service_id) <> '926'
                   and coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')  = '1230'
                 select * from bass2.dim_service_config where config_id=1000027 and service_id = 912


             select
                  '1033' as kpi_id,
                  case when b.enterprise_id is null then a.city_id||'99xxxxxxx'
                         else b.enterprise_id end ,
                  sum(a.unipay_fee) as current_month_value
         from bass2.dw_enterprise_new_unipay_201109 a
         left outer join bass2.dw_enterprise_msg_201109 b
         on a.enterprise_id = b.enterprise_id
         where a.test_mark = 0
               and char(a.service_id) = '912001'
               and b.enterprise_id not in ('89103000041929')
               and (b.level_def_mode <> 1 or b.level_def_mode is  null)
         group by
               case when b.enterprise_id is null then a.city_id||'99xxxxxxx'
               else b.enterprise_id end 

select * from         bass2.dw_enterprise_new_unipay_201109 a where   char(a.service_id) = '912001'


        set sqlbuf "
                    insert into session.t_kpi_values_1
                           select 2983 as kpi_id,aa.city_id,count(distinct aa.user_id) as kpi_value,aa.brand_id
                           from (select b.user_id,b.city_id,c.kpi_brand_id as brand_id
                                 from dw_product_ins_off_ins_prod_$pot_month a,dw_product_$pot_month b,map_kpi_brand c
                                 where a.product_instance_id = b.user_id and b.crm_brand_id3 = c.crm_brand_id3
                                       and a.offer_id in (select product_item_id from dim_prod_up_product_item
                                                          where name like '%Black%erry%' and item_type = 'OFFER_PLAN' and del_flag =
 '1')
                                       and date(a.valid_date) < '$v_nextmonth'
                                       and date(a.expire_date) >= '$v_nextmonth'
                                       and b.usertype_id in (1,2,9) and b.userstatus_id in (1,2,3,6,8) and b.test_mark <> 1
                                ) aa
                           group by aa.city_id,aa.brand_id"
                           
                           
        set sqlbuf "
                    insert into session.t_kpi_values_1
                           select 2982 as kpi_id,b.city_id,count(distinct a.user_id) as kpi_value,c.kpi_brand_id as brand_id
                           from (select user_id
                                 from dw_acct_shoulditem_$pot_month
                                 where item_id in (80000180,80000184,80000598,80000599)
                                 group by user_id
                                 having sum(fact_fee) >0) a,
                                dw_product_$pot_month b,
                                map_kpi_brand c
                          where a.user_id = b.user_id and b.crm_brand_id3 = c.crm_brand_id3
                                                                    and b.userstatus_Id in (1,2,3,6,8) and b.test_mark<>1 and b.user
type_Id in (1,2,9)
                          group by b.city_id,c.kpi_brand_id"
                           

select * from   bass2.Dim_enterprise_product



in
(
 'R001'
,'R002'
,'R003'
,'R004'
,'R006'
,'R007'
,'R008'
,'R009'
,'R011'
,'R016'
,'R019'
,'R020'
,'R021'
,'R022'
,'R023'
,'R024'
,'R025'
,'R026'
,'R027'
,'R030'
,'R031'
,'R037'
,'R038'
,'R039'
,'R040'
,'R054'
,'R055'
,'R056'
,'R060'
,'R061'
,'R062'
,'R088'
,'R089'
,'R090'
,'R091'
,'R092'
,'R094'
,'R095'
,'R096'
,'R097'
,'R107'
,'R108'
,'R109'
,'R111'
,'R112'
,'R113'
,'R114'
,'R115'
,'R116'
,'R127'
,'R130'
,'R133'
,'R134'
,'R135'
,'R136'
,'R137'
,'R138'
,'R139'
,'R140'
,'R141'
,'R142'
,'R143'
,'R144'
,'R145'
,'R146'
,'R159'
,'R160'
,'R161'
,'R162'
,'R163'
,'R164'
,'R165'
,'R166'
,'R167'
,'R168'
,'R169'
,'R170'
,'R171'
,'R172'
,'R173'
,'R174'
,'R177'
,'R178'
,'R179'
,'R180'
,'R181'
,'R182'
,'R183'
,'R184'
,'R185'
,'R186'
,'R187'
,'R188'
,'R189'
,'R190'
,'R191'
,'R192'
,'R193'
,'R194'
,'R196'
,'R198'
,'R200'
,'R203'
,'R204'
,'R205'
,'R207'
,'R208'
,'R210'
,'R212'
,'R214'
,'R216'
,'R221'
,'R222'
,'R223'
,'R224'
,'R225'
,'R226'
,'R227'
,'R228'
,'R229'
,'R230'
,'R231'
,'R232'
,'R233'
,'R234'
,'R235'
,'R237'
,'R238'
,'R239'
,'R240'
,'R241'
,'R242'
,'R243'
,'R246'
,'R247'
,'R250'
,'R251'
,'R252'
,'R253'
,'R254'
,'R260'
,'R261'
)



select r from 
table (
select 'R001' r from bass2.dual union all
select 'R002' r from bass2.dual union all
select 'R003' r from bass2.dual union all
select 'R004' r from bass2.dual union all
select 'R006' r from bass2.dual union all
select 'R007' r from bass2.dual union all
select 'R008' r from bass2.dual union all
select 'R009' r from bass2.dual union all
select 'R011' r from bass2.dual union all
select 'R016' r from bass2.dual union all
select 'R019' r from bass2.dual union all
select 'R020' r from bass2.dual union all
select 'R021' r from bass2.dual union all
select 'R022' r from bass2.dual union all
select 'R023' r from bass2.dual union all
select 'R024' r from bass2.dual union all
select 'R025' r from bass2.dual union all
select 'R026' r from bass2.dual union all
select 'R027' r from bass2.dual union all
select 'R030' r from bass2.dual union all
select 'R031' r from bass2.dual union all
select 'R037' r from bass2.dual union all
select 'R038' r from bass2.dual union all
select 'R039' r from bass2.dual union all
select 'R040' r from bass2.dual union all
select 'R054' r from bass2.dual union all
select 'R055' r from bass2.dual union all
select 'R056' r from bass2.dual union all
select 'R060' r from bass2.dual union all
select 'R061' r from bass2.dual union all
select 'R062' r from bass2.dual union all
select 'R088' r from bass2.dual union all
select 'R089' r from bass2.dual union all
select 'R090' r from bass2.dual union all
select 'R091' r from bass2.dual union all
select 'R092' r from bass2.dual union all
select 'R094' r from bass2.dual union all
select 'R095' r from bass2.dual union all
select 'R096' r from bass2.dual union all
select 'R097' r from bass2.dual union all
select 'R107' r from bass2.dual union all
select 'R108' r from bass2.dual union all
select 'R109' r from bass2.dual union all
select 'R111' r from bass2.dual union all
select 'R112' r from bass2.dual union all
select 'R113' r from bass2.dual union all
select 'R114' r from bass2.dual union all
select 'R115' r from bass2.dual union all
select 'R116' r from bass2.dual union all
select 'R127' r from bass2.dual union all
select 'R130' r from bass2.dual union all
select 'R133' r from bass2.dual union all
select 'R134' r from bass2.dual union all
select 'R135' r from bass2.dual union all
select 'R136' r from bass2.dual union all
select 'R137' r from bass2.dual union all
select 'R138' r from bass2.dual union all
select 'R139' r from bass2.dual union all
select 'R140' r from bass2.dual union all
select 'R141' r from bass2.dual union all
select 'R142' r from bass2.dual union all
select 'R143' r from bass2.dual union all
select 'R144' r from bass2.dual union all
select 'R145' r from bass2.dual union all
select 'R146' r from bass2.dual union all
select 'R159' r from bass2.dual union all
select 'R160' r from bass2.dual union all
select 'R161' r from bass2.dual union all
select 'R162' r from bass2.dual union all
select 'R163' r from bass2.dual union all
select 'R164' r from bass2.dual union all
select 'R165' r from bass2.dual union all
select 'R166' r from bass2.dual union all
select 'R167' r from bass2.dual union all
select 'R168' r from bass2.dual union all
select 'R169' r from bass2.dual union all
select 'R170' r from bass2.dual union all
select 'R171' r from bass2.dual union all
select 'R172' r from bass2.dual union all
select 'R173' r from bass2.dual union all
select 'R174' r from bass2.dual union all
select 'R177' r from bass2.dual union all
select 'R178' r from bass2.dual union all
select 'R179' r from bass2.dual union all
select 'R180' r from bass2.dual union all
select 'R181' r from bass2.dual union all
select 'R182' r from bass2.dual union all
select 'R183' r from bass2.dual union all
select 'R184' r from bass2.dual union all
select 'R185' r from bass2.dual union all
select 'R186' r from bass2.dual union all
select 'R187' r from bass2.dual union all
select 'R188' r from bass2.dual union all
select 'R189' r from bass2.dual union all
select 'R190' r from bass2.dual union all
select 'R191' r from bass2.dual union all
select 'R192' r from bass2.dual union all
select 'R193' r from bass2.dual union all
select 'R194' r from bass2.dual union all
select 'R196' r from bass2.dual union all
select 'R198' r from bass2.dual union all
select 'R200' r from bass2.dual union all
select 'R203' r from bass2.dual union all
select 'R204' r from bass2.dual union all
select 'R205' r from bass2.dual union all
select 'R207' r from bass2.dual union all
select 'R208' r from bass2.dual union all
select 'R210' r from bass2.dual union all
select 'R212' r from bass2.dual union all
select 'R214' r from bass2.dual union all
select 'R216' r from bass2.dual union all
select 'R221' r from bass2.dual union all
select 'R222' r from bass2.dual union all
select 'R223' r from bass2.dual union all
select 'R224' r from bass2.dual union all
select 'R225' r from bass2.dual union all
select 'R226' r from bass2.dual union all
select 'R227' r from bass2.dual union all
select 'R228' r from bass2.dual union all
select 'R229' r from bass2.dual union all
select 'R230' r from bass2.dual union all
select 'R231' r from bass2.dual union all
select 'R232' r from bass2.dual union all
select 'R233' r from bass2.dual union all
select 'R234' r from bass2.dual union all
select 'R235' r from bass2.dual union all
select 'R237' r from bass2.dual union all
select 'R238' r from bass2.dual union all
select 'R239' r from bass2.dual union all
select 'R240' r from bass2.dual union all
select 'R241' r from bass2.dual union all
select 'R242' r from bass2.dual union all
select 'R243' r from bass2.dual union all
select 'R246' r from bass2.dual union all
select 'R247' r from bass2.dual union all
select 'R250' r from bass2.dual union all
select 'R251' r from bass2.dual union all
select 'R252' r from bass2.dual union all
select 'R253' r from bass2.dual union all
select 'R254' r from bass2.dual union all
select 'R260' r from bass2.dual union all
select 'R261' r from bass2.dual ) a
except
select rule_code from bass1.g_rule_check where char(time_id) like '201109%'
and 

select sum(bigint(M_OFF_USERS)) from G_S_22012_DAY
where time_id / 100 = 201105
63211

60747

西藏	R127	|(本月离网用户数 / 上月离网用户数 - 1) x 100%| ≤ 20%	60743.00	61041.00



select sum(income)*1.00/100
from (
select ENTERPRISE_ID, sum(bigint(income)) income from   g_s_03017_month
where time_id = 201109
and ent_busi_id = '1520'
and MANAGE_MOD = '3'
group by ENTERPRISE_ID having  sum(bigint(income))  > 0
) a




select b.*, lower( '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,13)||' '||char(current date - 1 days) ) exp_cmdfrom   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE bwhere a.control_code like 'BASS1%EXP%DAY%'and date(a.begintime) =  date(current date)and substr(a.control_code,15,5) = b.interface_code 





select b.*
,a.CONTROL_CODE
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and substr(a.control_code,15,5) = b.interface_code 
AND B.INTERFACE_CODE in
(
 '02004'
,'02008'
,'02047'
,'02052'
,'03004'
,'03005'
,'03012'
,'04002'
,'04004'
,'04005'
,'04014'
,'04017'
,'04018'
,'21001'
,'21003'
,'21004'
,'21006'
,'21007'
,'21009'
,'22038'
,'22073'
,'22201'
,'22202'
,'22203'
)







select distinct  b.*
,a.CONTROL_CODE
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
AND B.INTERFACE_CODE in
(
 '02004'
,'02008'
,'02047'
,'02052'
,'03004'
,'03005'
,'03012'
,'04002'
,'04004'
,'04005'
,'04014'
,'04017'
,'04018'
,'21001'
,'21003'
,'21004'
,'21006'
,'21007'
,'21009'
,'22038'
,'22073'
,'22201'
,'22202'
,'22203'
)
union 


select distinct b.*
,a.CONTROL_CODE
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and substr(a.control_code,15,5) = b.interface_code 
AND B.INTERFACE_CODE in
(
 '02004'
,'02008'
,'02047'
,'02052'
,'03004'
,'03005'
,'03012'
,'04002'
,'04004'
,'04005'
,'04014'
,'04017'
,'04018'
,'21001'
,'21003'
,'21004'
,'21006'
,'21007'
,'21009'
,'22038'
,'22073'
,'22201'
,'22202'
,'22203'
)


select * from    bass2.dw_product_mobilefunc_201109
select * from  bass2.dw_product_mobilefunc_201109 fetch first 10 rows only  

select * from bass1.g_rule_check where char(time_id) like '201109%'
and rule_code between 'R177' AND 'R300'
ORDER BY 1,2




select * from bass1.g_rule_check where char(time_id) like '201109%'
and rule_code between 'R223' AND 'R228'
ORDER BY 1,2



select * from    bass1.td_check_ls_02


select count(0) ,count(distinct product_no) from    bass1.td_check_ls_02



select CYCLE_ID, bigint(TD_TERM_CUST) from   G_S_22204_MONTH
where time_id = 201109
and CYCLE_ID = '1'



select  bigint(TD_CUST_DUR) from   G_S_22204_MONTH
where time_id = 201109
and CYCLE_ID = '3'



		select 
		   sum(bigint(a.base_bill_duration))
		 from bass1.g_s_21003_month_tmp a,
		 		(
		select product_no from bass1.td_check_ls_02
		union 
		select product_no from bass1.td_check_03
		union 
		select product_no from bass1.td_check_04
		union
		select product_no from bass1.td_check_05
		)  b
		where a.product_no=b.product_no
	
    
    values (48030824*1.000/47971554 - 1)*100

    48030824
    47971554
    
    

select * from    



table(
select path||'/'||name,b.name,b.code
from 
table(
select '01一经接口/01服务主题' path,'用户' name ,'02004' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户状态' name ,'02008' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户使用终端通话情况' name ,'02047' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户区域归属' name ,'02052' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'明细帐单' name ,'03004' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'综合帐单' name ,'03005' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'智能网用户明细收入' name ,'03012' code from bass2.dual union all
select '01一经接口/03服务使用' path,'GPRS话单' name ,'04002' code from bass2.dual union all
select '01一经接口/03服务使用' path,'彩信话单' name ,'04004' code from bass2.dual union all
select '01一经接口/03服务使用' path,'梦网短信话单' name ,'04005' code from bass2.dual union all
select '01一经接口/03服务使用' path,'语音杂志短信话单' name ,'04014' code from bass2.dual union all
select '01一经接口/03服务使用' path,'TD普通语音业务话单' name ,'04017' code from bass2.dual union all
select '01一经接口/03服务使用' path,'上网本GPRS话单' name ,'04018' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'GSM_TD普通语音业务日使用' name ,'21001' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'GSM_TD普通语音业务月使用' name ,'21003' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网语音业务日使用' name ,'21004' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网语音业务月使用' name ,'21006' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'普通短信业务日使用' name ,'21007' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网VPMN业务使用' name ,'21009' code from bass2.dual union all
select '01一经接口/05其它数据' path,'各品牌用户日KPI' name ,'22038' code from bass2.dual union all
select '01一经接口/05其它数据' path,'竞争对手日KPI' name ,'22073' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户日汇总' name ,'22201' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户通话情况日汇总' name ,'22202' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户数据流量日汇总' name ,'22203' code from bass2.dual ) b
) b


select time_id,M_BILL_MMS from G_S_22012_DAY
where time_id > 20110716
order by time_id desc 




select time_id,count(0) 
from G_S_04004_DAY 
where time_id between 20110716 and 20110721
and bigint(CALL_FEE)+bigint(INFO_FEE) > 0
group by time_id 
order by 1 desc 


fetch first 10 rows only  

select sum(cnts) from 
            (
             select sum(counts) cnts from bass2.dw_newbusi_mms_$timestamp a,bass2.dw_product_$timestamp b 
							where  a.user_id  = b.user_id
							  and b.usertype_id in (1,2,9)
							  and b.test_mark <>1 
							  and b.userstatus_id not in (4,5,7,9)
							  and a.mm_type=0
							  and a.app_type in (0)
							  and a.send_status in (0,1,2,3)
						union all
						select sum(counts) cnts from bass2.dw_newbusi_mms_$timestamp a,bass2.dw_product_$timestamp b 
							where  a.user_id  = b.user_id
							  and b.usertype_id in (1,2,9)
							  and b.test_mark <>1 
							  and b.userstatus_id not in (4,5,7,9)
							  and a.app_type in (1,2,3,4)
						) as aa

select count(0)
from 
table (select * from   G_S_04004_DAY where time_id = 20110720 ) a 
where a.MM_BILL_TYPE = '00'
and a.applcn_type in ('0')
and a.MM_SEND_STATUS in ('00','01','02','03')
46314

a.app_type in (1,2,3,4)

select count(0)
from 
table (select * from   G_S_04004_DAY where time_id = 20110720 ) a 
where a.applcn_type in ('01','02','03','04')


select * from   BASS1.ALL_DIM_LKP 
where bass1_tbid = 'BASS_STD2_0037'


select * from   bass2.dim_channel_info

select * from bass2.DIM_BBOSS_BASE_TYPE 
where code_type in (90105,90102) 


select a.code_type lvl1,a.code_id lvl2 ,a.CODE_NAME lvl2_name,b.code_id lvl3,b.code_name lvl3_name
from 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
where code_type in (90105,90102) 
) a
left join 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
) b on a.code_id = b.code_type




select * from   bass2.DIM_TERM_TAC_MID



drop table BASS2.DIM_TERM_TAC_MID
CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  

select * from    BASS2.DIM_TERM_TAC_MID
  
  
  
select a.code_type lvl1,a.code_id lvl2 ,a.CODE_NAME lvl2_name,b.code_id lvl3,b.code_name lvl3_name
from 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
where code_type in (90105,90102) 
) a
left join 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
) b on a.code_id = b.code_type




select a.channel_id,a.channel_name,b.*
from bass2.dim_channel_info a ,
table(
select a.code_type lvl1
,case when a.code_type = 90102 then '社会代办渠道' else '实体(自有)渠道' end lvl1_name
,a.code_id lvl2 ,a.CODE_NAME lvl2_name,b.code_id lvl3,b.code_name lvl3_name
from 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
where code_type in (90105,90102) 
) a
left join 
 table (
select a.code_type,a.code_id,a.code_name from bass2.DIM_BBOSS_BASE_TYPE  a
) b on a.code_id = b.code_type
) b 
where 
 CHANNEL_TYPE_CLASS = lvl1
and CHANNEL_TYPE = lvl2
and CHANNEL_CHILD_TYPE = lvl3

select CHANNEL_ID,CHANNEL_TYPE_CLASS,CHANNEL_TYPE,CHANNEL_CHILD_TYPE from   bass2.dim_channel_info




create table g_s_22204_month_down_20110721(
subs_id 											char(20)  --用户标识 
,td_infophone_flg             char(1)  --TD信息机客户标志 
,td_mobile_flg                char(1)  --TD手机客户标志 
,td_crd_flg                   char(1)  --TD数据卡客户标志 
,td_book_flg                  char(1)  --TD上网本客户标志 
,TD_trmnl_cust_flg            char(1)  --TD终端客户标志 
,usdTD_ntwk_cust_flg          char(1)  --使用TD网络客户标志 
,usd_voicTD_ntwk_cust_flg     char(1)  --使用语音TD网络客户标志 
,usd_GPRSTD_ntwk_cust_flg     char(1)  --使用GPRSTD网络客户标志 
,usd_ntbkTD_ntwk_cust_flg     char(1)  --使用上网本TD网络客户标志 
) 
 IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ;
db2 "load client from /bassapp/bihome/panzw/tmp/13100_TD_user_3mon.txt.bak of del modified by 
coldel$  fastparse anyorder warningcount 1000  messages /bassapp/bihome/panzw/tmp/g_s_22204_month_down_20110721.msg replace into g_s_22204_month_down_20110721"




select sum(bigint(TD_TRMNL_CUST_FLG)) from   g_s_22204_month_down_20110721

64578

g_s_22204_month_down_20110530

select sum(bigint(TD_TRMNL_CUST_FLG)) from   g_s_22204_month_down_20110530

47370




select * from   bass2.dw_ent_group_relation_201109

select * from   bass2.dw_ent_cm_group_customer_ext_20110721

select * from   bass2.Dw_ent_cm_individual_info_ext_20110721

select * from   Ods.ent_group_relation_yyyymmdd

select * from   bass2.ods_ent_group_relation_20110721

select tabname from syscat.tables where lower(tabname) like '%ent_group_relation%'   

select * from   G_I_02014_MONTH where time_id = 201107


select * from G_S_22049_MONTH fetch first 10 rows only  

select * from BASS2.ODS_CHANNEL_INFO_20110324 b


select * from BASS2.ODS_CHANNEL_INFO_20110724 fetch first 10 rows only  


DROP TABLE G_S_02024_DAY ;

ALTER TABLE BASS1.G_S_22068_MONTH LOCKSIZE ROW APPEND OFF NOT VOLATILE;
  

select * from   G_S_02024_DAY

DROP TABLE BASS1.G_S_02024_DAY ;


delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22058_MONTH.tcl';

select * from   app.sch_control_map where PROGRAM_NAME = 'G_S_22058_MONTH.tcl';

select * from   app.sch_control_map 


insert into app.sch_control_map values (2,'G_S_22066_DAY.tcl','BASS1_G_S_22066_DAY.tcl')


delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_02024_DAY.tcl';	
insert into app.sch_control_map values (2,'G_S_02024_DAY.tcl' , 'BASS1_G_S_02024_DAY.tcl') ;


select * from   app.sch_control_map where PROGRAM_NAME like '%EXP%'

select * from   app.sch_control_map where control_code like '%EXP%'

select * from   bass1.int_program_data 




delete from  bass1.int_program_data where PROGRAM_NAME = 'G_S_02024_DAY.tcl';

insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_S_02024_DAY.tcl' , 'G_S_02024_DAY.BASS1' , 'G_S_02024_DAY_e' , 'G_S_02024_DAY_f' 
from bass1.int_program_data 
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';


select * from   app.g_unit_info where unit_code = '22048';

delete from  app.g_unit_info where unit_code = '22048';


select * from   app.g_unit_info


              app.sch_control_task where control_code in ( 'BASS1_G_S_02024_DAY.tcl','BASS1_EXP_G_S_02024_DAY');


delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_02024_DAY.tcl','BASS1_EXP_G_S_02024_DAY');


select * from   app.sch_control_task
where control_code like 'BASS1%02004%'



insert into app.sch_control_task values('BASS1_G_I_02032_MONTH.tcl' , 1 , 2 , 'int -s G_I_02032_MONTH.tcl' ,10000,-1,'xxxxxxxxxxx' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');
\
insert into app.sch_control_task values ('BASS1_G_S_22066_DAY.tcl',1,2,'int -s G_S_22066_DAY.tcl',10000,-1,'电子渠道关键数据日汇总','app','BASS1',1,'/bassapp/bass1/tcl/');
insert into app.sch_control_task values ('BASS1_EXP_G_S_22066_DAY',1,2,'bass1_export BASS1.G_S_22066_DAY YESTERDAY()',10000,-1,'EXPORT电子渠道关键数据日汇总','app','BASS1',1,'/bassapp/backapp/bin/bass1_export/');


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06001_DAY 
group by  time_id 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06002_DAY 
group by  time_id 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_06002_MONTH 
group by  time_id 
order by 1 


select * from   G_I_06021_MONTH
where time_id = 201109
and channel_name like '%赛达%'

201109	100000318                               	1	                         	13101	南区                          	未知                                              	赛达手机城专营店                                                                                    	北京中路                                                                                            	1	2	1	1	0	 	1	0930	1830	00010101	00010101	    	85.97772  	33.17246  	          	          	          	          

select * from   bass2.dw_channel_info_201109
where channel_name like '%林周县旁多乡营业厅%'

100001963


select * from   bass2.ods_channel_info_20110725
where channel_name like '%赛达%'



select * from   G_S_22062_MONTH
where time_id = 201109
and CHANNEL_ID = '100001963'

CHANNEL_ID	ORGANIZE_ID	SCHEME_CHANNEL_ID	CHANNEL_NAME
100001963	381834	[NULL]	林周县旁多乡营业厅

CHANNEL_ID
100001963                               


select * from   bass2.stat_market_0120
where CHANNEL_ID = 100001963


select * from   BASS2.DIM_TACNUM_DEVID



select dummy,cnt from table(bass1.fn_dn_flret_cnt(11)) a

select * from   G_S_22081_MONTH

select * from   BASS1.G_S_22081_MONTH_1
select * from   BASS1.G_S_22081_MONTH_2

931067	+MAILVIP	826	931067              	[NULL]	+MAILVIP	[NULL]	[NULL]	1

select * from   bass2.Dim_pm_sp_operator_code a
where a.OPERATOR_CODE = 'KSCF'

select * from    BASS1.G_S_22081_MONTH_1 where busi_code = '+MAILVIP'

and 

a.OPERATOR_CODE = 'KSCF'

+MAILVIP	918429	3	1102	邮箱VIP版

select * from    bass2.DW_PRODUCT_SP_INFO_201109
where SP_CODE = '918429'

901848	-HYJSZDXDY	885	901848              	金手掌	-HYJSZDXDY	72	1	1

select count(0) from    bass2.Dim_pm_sp_operator_code
6442249
select count(0) from    bass2.Dim_pm_sp_operator_code
5019804
select * from   bass2.dim_prod_up_product_item
where supplier_id = '918429'



select * from   bass2.Dim_pm_sp_operator_code a
where a.OPERATOR_CODE = '-HYJSZDXDY'


    select * from bass2.dim_sp_service_provider where SP_ID='918429'

    select count(0),count(distinct SP_ID||OPERATOR_CODE ) from    bass2.dim_sp_service_provider
    
1	2
1091474	501804


select * from   bass2.Ods_pm_sp_operator_code_201109
    

                 select *
                from (
                         select distinct c.* ,char(c.SP_ID) SP_CODE,OPERATOR_NAME,c.BUSI_CODE,delay_time,a.bill_flag
                         ,row_number()over(partition by c.SP_ID,c.BUSI_CODE 
                                order by  value(b.SP_CODE,0) asc) rn 
                         from   bass1.G_S_22081_MONTH_1 c 
                         left join   bass2.Dim_pm_sp_operator_code a 
                                on  char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
                         left join bass2.Dim_pm_serv_type_vs_expr b 
                                on  a.sp_type = b.serv_type 
                    ) a where a.rn = 1 
                         with ur 
                         
                         

select bill_flag,count(0)
from (

                 select  SP_CODE
                         ,BUSI_CODE
                         ,delay_time
                         ,bill_flag
                from (
                         select distinct char(c.SP_ID) SP_CODE,c.BUSI_CODE,delay_time,a.bill_flag
                         ,row_number()over(partition by c.SP_ID,c.BUSI_CODE 
                                order by  value(b.SP_CODE,0) asc) rn 
                         from   bass1.G_S_22081_MONTH_1 c 
                         left join   bass2.Dim_pm_sp_operator_code a 
                                on  char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
                         left join bass2.Dim_pm_serv_type_vs_expr b 
                                on  a.sp_type = b.serv_type 
                    ) a where a.rn = 1 
                         
) a                         
group by bill_flag



                 select distinct  SP_CODE,BUSI_CODE
                from (
                         select char(c.SP_ID) SP_CODE ,c.BUSI_CODE, BILL_FLAG
                         ,row_number()over(partition by c.SP_ID,c.BUSI_CODE 
                                order by  value(a.SP_CODE,0) asc) rn 
                         from   bass1.G_S_22081_MONTH_1 c 
                          join   bass2.Dim_pm_sp_operator_code a 
                                on  char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
                    ) a where a.rn = 1 and a.BILL_FLAG = 3 
                         

select * from   bass2.Dim_pm_sp_operator_code a
where a.OPERATOR_CODE = 'YXIF'                         


select BILL_FLAG,DELAY_TIME, count(0) from    
 bass2.Dim_pm_sp_operator_code a 
                          join bass2.Dim_pm_serv_type_vs_expr b 
                                on  a.sp_type = b.serv_type 
group by BILL_FLAG,DELAY_TIME
                                

    select * from bass2.dim_sp_service_provider where SP_ID='900510'
900510	05101012	2725	900510              	梦网家园(免费)	05101012	72	1	1


+MAILMFIIC50001403
select * from   G_S_22081_MONTH where busi_code = '+MAILMF'
                              
                              

CREATE TABLE "BASS1   "."G_S_22081_MONTH_3"  (
                  "SP_ID" VARCHAR(20) , 
                  "BUSI_CODE" VARCHAR(20) )
                 DISTRIBUTE BY HASH("BUSI_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select count(0) from    G_S_22081_MONTH


select * from   G_S_22081_MONTH where time_id = 201109

        insert into G_S_22081_MONTH_3
            select distinct  SP_CODE,BUSI_CODE
                from (
                         select char(c.SP_ID) SP_CODE ,c.BUSI_CODE, BILL_FLAG
                         ,row_number()over(partition by c.SP_ID,c.BUSI_CODE 
                                order by  value(a.SP_CODE,0) asc) rn 
                         from   bass1.G_S_22081_MONTH_1 c 
                          join   bass2.Dim_pm_sp_operator_code a 
                                on  char(a.SP_CODE) = c.SP_ID and a.OPERATOR_CODE = c.BUSI_CODE
                    ) a where a.rn = 1 and a.BILL_FLAG = 3 
        

select * from    bass2.Dim_pm_sp_operator_code a
,(select * from   G_S_22081_MONTH where time_id = 201109) b
where a.OPERATOR_CODE = b.BUSI_CODE 

select * from   bass2.Dim_pm_sp_operator_code a where a.OPERATOR_CODE='13000023'
select * from    bass2.Dim_pm_sp_operator_code


select * from    bass2.Dim_pm_sp_operator_code a
,(select * from   G_S_22081_MONTH where time_id = 201109) b
where a.OPERATOR_CODE = b.BUSI_CODE 
and a.OPERATOR_CODE='13000023'

13000023

select * from   G_S_22081_MONTH where time_id = 201109 and BUSI_CODE = '13000023'


update app.g_runlog 
set return_flag = 0
where time_id= 201109
and return_flag=1
and unit_code = '22081'



select * from   G_I_02018_MONTH where time_id = 201109

select * from   bass2.dw_product_ins_prod_ds


select  TIME_ID,USER_ID,BASE_PKG_ID,VALID_DT
from (
        select 
                20110930 TIME_ID
                ,char(a.product_instance_id)  USER_ID
                ,bass1.fn_get_all_dim_ex('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
                ,replace(char(date(a.VALID_DATE)),'-','') VALID_DT
                ,row_number()over(partition by a.product_instance_id order by expire_date desc ,VALID_DATE desc ) rn 
        from  bass2.Dw_product_ins_off_ins_prod_ds a
        ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0114'
                                              and bass1_value like 'QW_QQT_JC%'
                                              and XZBAS_COLNAME not like '套餐减半%'
                                      ) c
        where  char(a.offer_id) = c.offer_id 
          and a.state =1
          and a.valid_type = 1
          and a.OP_TIME = '2011-06-30'    
          and date(a.VALID_DATE)<='2011-06-30'  
    and date(a.expire_date) >= '2011-06-30'
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110930 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         ) 
) t where t.rn = 1
         with ur
  
  
  

select *
from  bass2.Dw_product_ins_off_ins_prod_ds a , bass2.dw_product_20110726 b 
where  a.state =1 
and a.PRODUCT_INSTANCE_ID=b.user_id 
and a.valid_type in (1,2)
and a.OP_TIME = '2011-07-26'
and date(a.CREATE_DATE) = '2011-07-26'
and date(a.VALID_DATE)>= '2011-07-26'
and date(a.expire_date) >= '2011-07-26'
    and date(a.expire_date) >= '2011-07-26'
          and not exists (      select 1 from bass2.dwd_product_test_phone_20110726 b 
                                where a.product_instance_id = b.USER_ID  and b.sts = 1
                         )   
and IS_MAIN_OFFER = 1
                   
and char(a.offer_id) in (
SELECT char(offer_id) FROM BASS2.dim_prod_up_offer WHERE OFFER_TYPE='OFFER_PLAN'
and TRADEMARK = 161000000001
union 
select char(xzbas_value)  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'
)



select * from    bass2.dim_prod_up_product_item


select * from   G_I_02018_MONTH where time_id = 201109
and BASE_PROD_ID not in (
SELECT char(offer_id) FROM BASS2.dim_prod_up_offer WHERE OFFER_TYPE='OFFER_PLAN'
and TRADEMARK = 161000000001
)


select count(0),count(distinct offer_id ) from   BASS2.dim_prod_up_offer   
where TRADEMARK = 161000000001



                        select * from   bass2.MAP_BOSS_BRAND
                        select * from   bass2.dim_BOSS_BRAND
                        
                        
                        

select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'
				     


select * from   
04010
04012
04009
02013
21004
21009
21005
21002
21016
06001
22104
22102
01006
04008                        

select * from   app.sch_control_before where control_code  = 'BASS1_G_A_06001_DAY.tcl'
xysc_maintenance_info
App_xysc_school_user_ms.tcl


insert into app.sch_control_before 
values ('BASS1_G_A_06001_DAY.tcl','REP_App_xysc_school_user_ms.tcl')


select * from  table( bass1.get_task('App_xysc_school_user_ms')) a;

select * from  table( bass1.get_before('02032')) a;
select * from  table( bass1.get_before('0400810')) a;

select * from  table( bass1.get_before('04012')) a;
select * from  table( bass1.get_before('04011')) a;

select * from  table( bass1.get_before('04009')) a;

select * from  table( bass1.get_before('02013')) a;
select * from  table( bass1.get_before('21004')) a;
select * from  table( bass1.get_before('INT_CHECK_C034')) a;


select * from  table( bass1.get_before('21009')) a;
select * from  table( bass1.get_before('21005')) a;
select * from  table( bass1.get_before('21002')) a;
select * from  table( bass1.get_before('21016')) a;
select * from  table( bass1.get_before('06001')) a;
select * from  table( bass1.get_before('22104')) a;
select * from  table( bass1.get_before('22102')) a;
select * from  table( bass1.get_before('01006')) a;
select * from  table( bass1.get_before('04008')) a;

select * from   bass2.ODS_DIM_SYS_ORGANIZE_20110726

select a.op_id,b.org_id,count(0) from    bass2.Dw_product_ins_off_ins_prod_ds a
,bass2.dim_boss_staff b 

where a.OP_ID = b.OP_ID 
group by  a.op_id,b.org_id

select count(0) from     bass2.Dim_channel_info a 

select count(0) from    
(
select distinct b.org_id from    bass2.Dw_product_ins_off_ins_prod_ds a
,bass2.dim_boss_staff b 
where a.OP_ID = b.OP_ID ) a , bass2.Dim_channel_info b where a.ORG_ID = b.CHANNEL_ID



select  from   bass2.dim_boss_staff a


select count(0) from    
(
select distinct b.org_id from    bass2.Dw_product_ins_off_ins_prod_ds a
,bass2.dim_boss_staff b 
where a.OP_ID = b.OP_ID ) a , bass2.Dim_channel_info b where a.ORG_ID = b.ORGANIZE_ID



CREATE TABLE "BASS1   "."G_S_02024_DAY_1"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "BASE_PKG_ID" CHAR(30) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "REC_DT" CHAR(8) , 
                  "VALID_DT" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "BASE_PKG_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select * from    bass1.G_S_02024_DAY_1
select count(0) from     bass2.Dw_product_ins_off_ins_prod_ds

select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.Dw_product_ins_off_ins_prod_ds 
group by  OP_TIME 
order by 1 



select 
        20110726 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110726 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-07-26'
        and date(a.VALID_DATE)>= '2011-07-26'
        and date(a.expire_date) >= '2011-07-26'
        
        select count(0) from    (
        select channel_id from  G_S_02024_DAY_1 where channel_id  not in ( 
select char(ORGANIZE_ID) from  bass2.dim_channel_info a   where a.channel_type_class in (90105,90102)        
)) a , bass2.dw_channel_info_201109 b where a.channel_id = char(b.ORGANIZE_ID)





        select count(0) from    (
        select channel_id from  G_S_02024_DAY_1 where channel_id  not in ( 
select char(channel_id) from  bass2.dim_channel_info a   where a.channel_type_class in (90105,90102)        
)) a , bass2.dw_channel_info_201109 b where a.channel_id = char(b.ORGANIZE_ID)




select * from   bass1.G_S_02024_DAY_1


		SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%'



CREATE FUNCTION BASS1.FN_GET_ALL_DIM_EX(
GID VARCHAR(20)
,DID VARCHAR(20)
) RETURNS 
VARCHAR(32) 
DETERMINISTIC 
NO EXTERNAL 
ACTION LANGUAGE SQL 
BEGIN ATOMIC 
		RETURN 
		SELECT 
			BASS1_VALUE 
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = GID 
			AND XZBAS_VALUE = DID 
END


        select * from    bass1.G_S_02024_DAY_1 where BASE_PKG_ID in 
        
        ('111089510017'        	
,'111089610017'        	
,'111089110017'        	
,'111089510018'        	
,'111089710017'        	
,'111089410018'        	
,'111089710016'        	
,'111089110018'        	
,'111089310017'        	
,'111089210018'        	
,'111089410017'        	
,'111089610018'        	
,'111089710018'        	
,'111089210017'        	
,'111089210016'        	
,'111089310016'        	
,'111089310018'        	
,'111089410016'        	
,'111089510016'        	
,'111089610016'        	
,'111089110016'
)


111089510017        

111089610017                  

20110726	89460001148552      	111089410017                  	40400119                                	20110726	20110726


 bass2.dim_prod_up_product_item 
 
 
 select * from  bass2.Dw_product_ins_off_ins_prod_ds a,
 bass2.dim_prod_up_product_item  b
 where product_instance_id = '89460001148552'
 and a.OFFER_ID = b.PRODUCT_ITEM_ID
 
 2011-07-27 	100008569795	100008376504	89460001148552	171000000001	111089410017	181000000001	1	1	46351190	1	300060794131	2011-07-26 15:01:49.000000	2011-07-26 15:01:49.000000	2011-07-26 15:01:49.000000	2099-12-31 23:59:59.000000	10000395	40400119	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89460000962130	[NULL]	0894	111089410017	89410017	全球通商旅套餐(林芝)	OFFER_PLAN	1	2011-04-28 21:10:53.000000	2011-04-22 0:00:00.000000	2030-01-01 0:00:00.000000	[NULL]	[NULL]	0894	1	[NULL]
2011-07-27 	100008569798	100008376507	89460001148552	171000000001	111090001334	181000000001	1	1	46351193	1	300060794131	2011-07-26 15:01:49.000000	2011-07-26 15:01:49.000000	2011-07-26 15:01:50.000000	2030-01-01 0:00:00.000000	10000395	40400119	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89460000962130	[NULL]	0894	111090001334	90001334	全球通商旅套餐58元	OFFER_PLAN	1	2011-04-28 21:33:35.000000	2011-04-22 0:00:00.000000	2030-01-01 0:00:00.000000	[NULL]	[NULL]	Y	1	[NULL]



        select * from    bass1.G_S_02024_DAY_1  where user_id = '89460001148552'


select count(0),count(distinct USER_ID ) from     bass1.G_S_02024_DAY

SELECT 
                     *
                FROM BASS1.ALL_DIM_LKP 
                WHERE BASS1_TBID = 'BASS_STD1_0115'
                
 
select * from   bass1.G_S_02024_DAY_1 a
where a.base_pkg_id  in (SELECT 
                        distinct XZBAS_VALUE
                FROM BASS1.ALL_DIM_LKP 
                WHERE BASS1_TBID = 'BASS_STD1_0115'
and BASS1_VALUE   like '%QW%')

478 
1157


679	675

gb 

select user_id , count(0) 
,  count(distinct user_id ) 
from bass1.G_S_02024_DAY  
where time_id = 20110802
group by  user_id 
order by 1 


select   count(0) 
,  count(distinct user_id ) 
from bass1.G_S_02024_DAY  
where time_id = 20110802


89560001148079      	2
89660001147257      	2
89160001149475      	2
89560001149054      	2

select * from   G_S_02024_DAY_1 a,bass2.dim_prod_up_product_item  b
where user_id = '89560001148079'
and a.BASE_PKG_ID = char(b.PRODUCT_ITEM_ID)




 select * from  bass2.Dw_product_ins_off_ins_prod_ds a,
 bass2.dim_prod_up_product_item  b
 where product_instance_id = '89560001148079'
 and a.OFFER_ID = b.PRODUCT_ITEM_ID
 
 
 select * from  G_S_02025_DAY_1
 
 
 CREATE TABLE "BASS1   "."G_S_02025_DAY_1"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "ADD_PKG_ID" CHAR(30) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "REC_DT" CHAR(8) , 
                  "VALID_DT" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "ADD_PKG_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select * from   bass1.G_S_02025_DAY

                     select user_id from bass1.G_S_02025_DAY
                      where time_id =20110726
                       except
                  select user_id from bass2.dw_product_20110726
                    where usertype_id in (1,2,9) 
                    and userstatus_id in (1,2,3,6,8)
                    and test_mark<>1
                    and brand_id = 1
                    
                    
89157333567307      

select * from    bass2.dw_product_20110726
where user_id = '89157333567307'


            

 select * from  bass2.Dw_product_ins_off_ins_prod_ds a,
 bass2.dim_prod_up_product_item  b
 where product_instance_id = '89157333567307'
 and a.OFFER_ID = b.PRODUCT_ITEM_ID
 

select * from   bass2.dim_call_tolltype

select * from   BASS1.ALL_DIM_LKP

select calltype_id,opp_home_areacode from           bass2.cdr_call_20110727
where tolltype_id in (

select * from   bass2.dim_call_calltype

select char(time(START_TIME)) from   bass2.Cdr_call_20110727


select replace(char(time(START_TIME)),'.','') from   bass2.Cdr_call_20110727

select replace(char(date(START_TIME)),'-','') from   bass2.Cdr_call_20110727

select * from   bass2.dim_call_roamtype


select * from   bass2.Cdr_call_dtl_20110727


select * from   G_S_04019_DAY


drop table BASS1.dim_country_city_code;
CREATE TABLE BASS1.dim_country_city_code
 (
country_code varchar(16)
,country_name_zh varchar(64)
,country_name_en varchar(64)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (country_code
   ) USING HASHING;

ALTER TABLE BASS1.dim_country_city_code
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  
  
db2 "load client from /bassapp/bihome/panzw/tmp/country.txt of del 
modified by coldel$  fastparse anyorder warningcount 1000 messages /bassapp/bihome/panzw/tmp/dim_country_city_code.log 
replace into dim_country_city_code 
"

select b.* from    G_S_04019_DAY a,bass1.dim_country_city_code b
where B_AREA_CD = country_code



select distinct B_AREA_CD
from G_S_04019_DAY
except 
select country_code from  dim_country_city_code 


select * from   bass2.dw_agent_acc_info_20110727



select * from   G_S_22049_MONTH

select call_duration,call_duration_m,call_duration_s,bill_duration from   bass2.Cdr_call_dtl_20110726


select * from   bass2.stat_channel_reward_0007


select * from     bass2.dim_cfg_static_data a
 where code_name like '%空中%'
 
 select * from  BASS1.dim_ord_cfg_operation
 where opt_name like '%空中充值%'
 
 select * from  BASS1.dim_ord_cfg_operation
 where opt_code = '4187'
 
 
 
 select * from  bass1.g_s_22049_month 
 
 
 
 select opt_code,count(0)
 from bass2.dw_acct_payment_dm_201107 a ,
 (select * from bass2.dim_acct_paytype where paytype_name like '%空中充值%') b 
 where b.paytype_id = a.opt_code 
 group by opt_code

select * from    bass2.dw_agent_acc_info_20110725

select *  from bass2.dw_acct_payment_dm_201109 
where    balance>0 and opt_code='GTFG'


SELECT * FROM bass2.DIM_ACCT_PAYTYPEWHERE PAYTYPE_ID IN ('GTFK','GTFG')WITH UR;select "NEW_PAYTYPE", "OLD_PAYTYPE"  from "BASS2"."MAP_PAYTYPE";
  
  GTFG	4208

select * from   bass2.stat_channel_reward_detail_201109

select * from   bass2.dw_agent_acc_info_20110725
select * from   bass2.dwd_channel_dept_20110725


select 
        20110728 TIME_ID
        ,'20110728' OP_TIME
        ,a.mobile_id CHRG_NBR
        ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0054',char(b.CHANNEL_CITY)),'13101')   CMCC_BRANCH_ID
        ,char(a.channel_id) CHANNEL_ID
        ,case when b.channel_type=90102 
                 and b.dept_type_dtl in (90176,90886,90741,90885,90178,90177,90880,90883,90175,90884,90179) then '2'
        else '1' end CHRG_WAY_TYPE
        ,char(sum(case when c.opt_code = 'GJFK' then 1 else 0 end )) CHRG_CNT
        ,char(sum(case when c.opt_code = 'GJFK' then c.balance+c.amount else 0 end )) CHRG_AMT
        ,char(sum(case when c.opt_code = 'GTFG' then 1 else 0 end )) CHRG_CNT
        ,char(sum(case when c.opt_code = 'GTFG' then c.balance+c.amount else 0 end )) CHRG_AMT
from bass2.dw_agent_acc_info_20110728 a
,bass2.dwd_channel_dept_20110728  b
,bass2.dw_acct_payment_dm_201107 c
where a.channel_id = b.organize_id
      and a.mobile_id=c.key_num
      and c.opt_code in ('GJFK','GTFG')
group by 
        a.mobile_id 
        ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0054',char(b.CHANNEL_CITY)),'13101')   
        ,char(a.channel_id) 
        ,case when b.channel_type=90102 
        and b.dept_type_dtl in (90176,90886,90741,90885,90178,90177,90880,90883,90175,90884,90179) then '2'
        else '1'
        end       
  
  select a.*,bigint(chrg_amt)/bigint(chrg_cnt) from G_S_22048_DAY a 
  
  
  
  select *  from bass2.dw_acct_payment_dm_201109 
where    opt_code='GTFG'


select *  from bass2.dw_acct_payment_dm_201109    
where payment_id = '110628122103A781315280891'


select bass2.dw_acct_payment_dm_201109 , count(0) 
--,  count(distinct bass2.dw_acct_payment_dm_201109 ) 
from  
group by  bass2.dw_acct_payment_dm_201109 
order by 1 



select opt_seq , count(0) 
--,  count(distinct opt_seq ) 
from bass2.dw_acct_payment_dm_201109 
group by  opt_seq 
order by 1 


select count(0),count(distinct payment_id) from bass2.dw_acct_payment_dm_201107 a 
		where  opt_code = 'GTFK' and AMOUNT = BALANCE 
       

       
      select * from G_S_22048_DAY
      

select PAYMENT_ID,OPT_CODE,AMOUNT,BALANCE 
                from bass2.dw_acct_payment_dm_201107
                where  opt_code = 'GTFG' 
                and AMOUNT = BALANCE 
                
110704182515A789002640891
                
                
select *  from bass2.dw_acct_payment_dm_201107
where payment_id = '110704182515A789002640891'
OPT_CODE
GTFK
GTFG

                
select * from  bass2.dw_agent_acc_info_20110728 a where a.MOBILE_ID = '13659517898'
CHANNEL_ID	ACC_NAME	ACC_ID	MOBILE_ID	DEPOSIT_ACCOUNT	PAYMENT_ACCOUNT	RECRUIT_ACCOUNT	TRADE_TYPE	VALID_TRADE_DEPOSIT	TRADE_DEPOSIT	VALID_TRADE_PAYMENT	TRADE_PAYMENT	RECRUIT_PAYMENT	REC_STATUS	ORG_ID	OP_ID	DONE_DATE	DONE_CODE	NOTES	DEPOSIT_EXP_DATE	PAYMENT_EXP_DATE	RECRUIT_EXP_DATE	WHOLESALE_ACCOUNT	WHOLESALE_EXP_DATE	TO_ACTIVATE_PAYMENT	VALID_WHOLESALE_DEPOSIT	WHOLESALE_DEPOSIT	PAYMENT_ALERT_LIMIT	PAYMENT_STOP_LIMIT	WHOLESALE_PAY_ACCOUNT	WHOLESALE_PAY_EXP_DATE	VALID_WHOLESALE_PAYMENT	WHOLESALE_PAYMENT	TO_ACTIVATE_WHOLESALE_PAYMENT	WHOLESALE_ALERT_LIMIT	WHOLESALE_STOP_LIMIT	PAYMENT_CREDIT	DEPOSIT_CREDIT	WHOLESALE_PAY_CREDIT	WHOLESALE_DEPOSIT_CREDIT	PAYMENT_CREDIT_USED	DEPOSIT_CREDIT_USED	WHOLESALE_PAY_CREDIT_USED	WHOLESALE_DEP_CREDIT_USED	RECRUIT_OVERDRAW_AMT	RECRUIT_STATUS	RECRUIT_ST_DATE	RECRUIT_COMMISION	ACC_PASSWORD	COUNTER_PWD_FAIL	MSISDN_ACCOUNT	MSISDN_STATUS	MSISDN_ST_DATE	MSISDN_VALID	MSISDN_CREDIT	MSISDN_OP_ID	ACC_LEVEL	RECRUIT_REMIND_AMT	LOCK_LIMIT
10850079	拉萨市南城区代理店	89102000001321	13659517898	-1	-1	1	-1	-1	-1	-1	-1	-1	-1	10000001	10000536	2010-05-18 12:29:52.000000	-1	[NULL]	2000-01-01 0:00:00.000000	2000-01-01 0:00:00.000000	2000-01-01 0:00:00.000000	-1	2000-01-01 0:00:00.000000	-1	-1	-1	-1	-1	-1	2000-01-01 0:00:00.000000	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	-1	1	2000-01-01 0:00:00.000000	-1	cc20e27acce46215	-1	-1	-1	2000-01-01 0:00:00.000000	-1	-1	-1	-1	-1	-1


select * from    bass2.dwd_channel_dept_20110728 where channel_id = 10850079



select 
c.*
from bass2.dw_agent_acc_info_20110728 a
join bass2.dwd_channel_dept_20110728  b on a.channel_id = b.organize_id
join bass2.dw_acct_payment_dm_201107 c on  a.mobile_id=c.key_num
where              c.payment_id = '110704182515A789002640891'

OPT_CODE
GTFK

select * from   G_S_22048_DAY


OPT_CODE
GTFK
GTFG

select c.* from    
 bass2.dw_acct_payment_dm_201107 c 
left join (select PAYMENT_ID,OPT_CODE,AMOUNT,BALANCE 
                from bass2.dw_acct_payment_dm_201107 where  opt_code = 'GTFK' 
          ) d  on c.PAYMENT_ID=d.PAYMENT_ID 
where c.opt_code in ('GJFK','GTFG')
and d.PAYMENT_ID is not null



select count(0)     
from bass2.dw_agent_acc_info_20110728 a
join bass2.dwd_channel_dept_20110728  b on a.channel_id = b.organize_id
join bass2.dw_acct_payment_dm_201107 c on  a.mobile_id=c.key_num
left join (select PAYMENT_ID,OPT_CODE,AMOUNT,BALANCE 
                from bass2.dw_acct_payment_dm_201107 where  opt_code = 'GTFK' 
          ) d  on c.PAYMENT_ID=d.PAYMENT_ID 
where c.opt_code in ('GJFK','GTFK')
and d.PAYMENT_ID is not null



select PAYMENT_ID,OPT_CODE,AMOUNT,BALANCE 
                from bass2.dw_acct_payment_dm_201107
                where  opt_code = 'GTFG' 
                

select d.*
from bass2.dw_agent_acc_info_20110728 a
join bass2.dwd_channel_dept_20110728  b on a.channel_id = b.organize_id
join bass2.dw_acct_payment_dm_201107 c on  a.mobile_id=c.key_num
left join (select PAYMENT_ID,OPT_CODE,AMOUNT,BALANCE 
                from bass2.dw_acct_payment_dm_201107
                where  opt_code = 'GTFG' 
          ) d  on c.PAYMENT_ID=d.PAYMENT_ID 
where c.opt_code in ('GJFK','GTFK')
and d.PAYMENT_ID is not null



select * from   bass2.dw_acct_payment_dm_201107
where payment_id in (
select payment_id 
                from bass2.dw_acct_payment_dm_201107
                where  opt_code = 'GTFK' 
                and key_num = '15889075440'

)

select sum(bigint(chrg_amt))                
from G_S_22048_DAY 
3979896
4202725
133976

select * from   g_s_22049_month

select tabname from syscat.tables where tabname like '%22049%'   
G_S_22049_MONTH_OLD20110729

CHONGZHIMONEY

select sum(bigint(CHONGZHIMONEY))                
from G_S_22049_MONTH_OLD20110729 
where time_id = 201109


select replace(char(OP_TIME),'-','')
from  bass2.dw_acct_payment_dm_201107



select * from   G_S_22048_DAY



select * from  table( bass1.get_before('04003')) a 

select * from  table( bass1.get_task('04005')) a 

select * from   app.sch_control_task where control_code like '%cdr_wlan_%'


select * from   G_S_02024_DAY where time_id = 20110802
select * from   G_S_02025_DAY where time_id = 20110802
select * from   G_S_04019_DAY where time_id = 20110802
select * from   G_S_22048_DAY where time_id = 20110802


SELECT 
         XZBAS_TBNAME
        ,XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,'BASS_STD1_0116' BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0007' 



BASS_STD1_0007


SELECT * FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0116'


select * from    BASS1.ALL_DIM_LKP 
where BASS1_TBN_DESC = '帐目科目'
and xzbas_tbname = 'dim_acct_item'


db2 "load client from /bassapp/bihome/panzw/tmp/nation.txt of del 
modified by coldel$  fastparse anyorder warningcount 1000 messages  /bassapp/bihome/panzw/tmp/nation.log 
replace into bass1.dim_nations 
"

drop table BASS1.dim_nations;
CREATE TABLE BASS1.dim_nations
 (
 n_id                varchar(8)         
 ,n_name                varchar(128)         
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (n_id
   ) USING HASHING;

ALTER TABLE BASS1.dim_nations
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  select * from dim_nations
  
  
  select 
         '未知' XZBAS_TBNAME
        ,'未知' XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,'BASS_STD1_0116' BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
  from dim_nations a 
  full join table(
  SELECT 
         XZBAS_TBNAME
        ,XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,'BASS_STD1_0116' BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0007' 
) b  on b.BASS1_VALUE = a.n_id
where n_id is not null 
and n_name is not null 
order by 3,1


insert into  BASS1.ALL_DIM_LKP 
  select b.*
  from dim_nations a 
   join table(
  SELECT 
         XZBAS_TBNAME
        ,XZBAS_COLNAME
        ,XZBAS_VALUE
        ,BASS1_TBN_DESC
        ,'BASS_STD1_0116' BASS1_TBID
        ,BASS1_VALUE
        ,BASS1_VALUE_DESC
FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0007' 
) b  on b.BASS1_VALUE = a.n_id
union 
select *
from table (
select '未知' a , '未知' b , 'undef1' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '100' f , '亚洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef2' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '143' f , '东帝汶民主共和国' g from bass2.dual union all
select '未知' a , '未知' b , 'undef3' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '200' f , '欧洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef4' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '220' f , '哈萨克斯坦共和国' g from bass2.dual union all
select '未知' a , '未知' b , 'undef5' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '253' f , '维尔京群岛（英）' g from bass2.dual union all
select '未知' a , '未知' b , 'undef6' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '254' f , '塞尔维亚共和国' g from bass2.dual union all
select '未知' a , '未知' b , 'undef7' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '255' f , '黑山' g from bass2.dual union all
select '未知' a , '未知' b , 'undef8' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '300' f , '非洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef9' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '339' f , '马约特岛' g from bass2.dual union all
select '未知' a , '未知' b , 'undef10' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '353' f , '圣多美' g from bass2.dual union all
select '未知' a , '未知' b , 'undef11' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '361' f , '西撒哈拉民主共和国' g from bass2.dual union all
select '未知' a , '未知' b , 'undef12' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '400' f , '北美洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef13' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '409' f , '多米尼加共和国' g from bass2.dual union all
select '未知' a , '未知' b , 'undef14' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '415' f , '加拿大' g from bass2.dual union all
select '未知' a , '未知' b , 'undef15' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '425' f , '威克岛' g from bass2.dual union all
select '未知' a , '未知' b , 'undef16' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '429' f , '中途岛' g from bass2.dual union all
select '未知' a , '未知' b , 'undef17' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '500' f , '南美洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef18' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '600' f , '大洋洲' g from bass2.dual union all
select '未知' a , '未知' b , 'undef19' c , '长途局划分（国际）' d , 'BASS_STD1_0116' e , '900' f , '其它' g from bass2.dual
) c 





  SELECT *
FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0116' 



select * from    bass2.cdr_sms_dtl_20110728

select * from   bass2.ods_cdr_sms_20110728



RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110730BAK;
CREATE TABLE BASS2.DIM_TERM_TAC
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;



drop table BASS2.DIM_TERM_TAC_MID
CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  
  
delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110730BAK
where net_type <>'2';


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1

select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110730BAK
group by tac_nuM
having count(*)>1
RUNSTATS ON table BASS2.DIM_TERM_TAC 	with distribution and detailed indexes all  

select count(0) from    
 BASS2.DIM_TERM_TAC
 
 
 
 
 
 
 drop table BASS1.dim_SUPPLIER_ID;
CREATE TABLE BASS1.dim_SUPPLIER_ID
 (
 SUPPLIER_ID                varchar(16)         
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (SUPPLIER_ID
   ) USING HASHING;

ALTER TABLE BASS1.dim_SUPPLIER_ID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  
  
  select distinct SUPPLIER_ID from  dim_SUPPLIER_ID
  
  
  select * from bass2.dw_wcc_user_action_ds
  
  
  select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.dw_wcc_user_action_ds 
group by  op_time 
order by 1 




select date(login_time) , count(0) 
--,  count(distinct date(login_time) ) 
from bass2.dw_wcc_user_action_ds 
group by  date(login_time) 
order by 1 




select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.dw_custsvc_cps_log_call_dm_201107 
group by  OP_TIME 
order by 1 


select date(TIME_INCALL) , count(0) 
--,  count(distinct date(TIME_INCALL) ) 
from bass2.dw_custsvc_cps_log_call_dm_201107 
group by  date(TIME_INCALL) 
order by 1 


select * from   bass2.dw_PRODUCT_ORD_BUSI_OTHER_201107




CREATE TABLE "BASS2   "."ODS_PRODUCT_ORD_BUSI_OTHER_20110814"  (
                  "ORDER_BUSI_INFO_ID" BIGINT , 
                  "BUSIOPER_ORDER_ID" BIGINT , 
                  "INFO_ID" VARCHAR(100) , 
                  "INFO_NAME" VARCHAR(200) , 
                  "REGION_ID" VARCHAR(6) , 
                  "EXT_1" VARCHAR(2000) , 
                  "EXT_2" VARCHAR(2000) , 
                  "EXT_3" VARCHAR(2000) , 
                  "EXT_4" VARCHAR(2000) , 
                  "EXT_5" VARCHAR(2000) , 
                  "EXT_6" VARCHAR(2000) , 
                  "DONE_CODE" BIGINT , 
                  "OP_ID" BIGINT , 
                  "ORG_ID" BIGINT , 
                  "DONE_DATE" TIMESTAMP , 
                  "VALID_DATE" TIMESTAMP , 
                  "EXPIRE_DATE" TIMESTAMP , 
                  "CREATE_DATE" TIMESTAMP , 
                  "NOTES" VARCHAR(255) , 
                  "ORDER_STATE" SMALLINT )   
                 DISTRIBUTE BY HASH("ORDER_BUSI_INFO_ID")   
                   IN "TBS_3H" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 


A11060
insert into bass2.etl_load_table_map values('A11060','ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD','其它业务操作表',0,'so.ORD_BUSI_OTH_F_X_YYMM');
insert into bass2.USYS_TABLE_MAINTAIN values(11047,'其它业务操作表','ODS_PRODUCT_ORD_BUSI','1','day',255,'0','','','BASS2','ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD','TBS_3H','TBS_INDEX','ORDER_BUSI_INFO_ID',1);
insert into app.sch_control_task values ('TR1_L_11060',1,2,'ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD',0,-1,'其它业务操作表','-','TR1_BOSS',1,'-');

                   
                  
select	*	from	bass2.etl_task_log		
where	task_id	in	('A11060')		
and	error_sheet_cnt	is	null		
order	by	stime	desc		
					
select	*	from	BASS2.ETL_TASK_RUNNING		
where	task_id	in	('A11060')		
					
					
					
select 　count(0),count(distinct ORDER_BUSI_INFO_ID) from bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729
					

                   select d.region_id,106,204,count(distinct a.product_instance_id)
         from bass2.dw_product_ord_cust_dm_201107 a,
                      bass2.dw_product_ord_busi_dm_201107 b,
                      bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729  c,
                                                   bass2.dw_product_20110729 d
          where a.customer_order_id = b.customer_order_id
                      and b.busioper_order_id =c.busioper_order_id 
                      and c.ext_6 like '%SRC=206%'   
                                                   and a.product_instance_id = d.user_id    
                                                   and  date(c.create_date) = '2011-07-29'
                                  group by d.region_id 


                       select a.region_id,106,201,count(distinct login_product_no) as count
             from  bass2.dw_product_20110729 a,bass2.dw_wcc_user_action_ds  b
             where b.login_product_no=a.product_no and b.login_type=1 and b.is_success=1
                   and a.userstatus_id>0
                   and date(b.login_time) = '2011-07-29'
             group by a.region_id
                                  

                       select b.region_id,106,202,count(distinct a.tel_calling)
                       from bass2.dw_custsvc_cps_log_call_dm_201107 a,
                             bass2.dw_product_20110729 b
                        where a.tel_calling = b.product_no 
                        and a.OP_TIME = '2011-07-29'
                       group by b.region_id
        

                       select b.region_id,106,203,count(distinct a.phone_id)
                       from  bass2.dw_kf_sms_cmd_receive_dm_201107 a,
                            bass2.dw_product_20110729 b
                        where  a.phone_id = b.product_no 
                                                and b.userstatus_id in (1,2,3,6,8)
                                                and date(a.CREATE_DATE) = '2011-07-29'
                       group by b.region_id



                   select d.region_id,106,204,count(distinct a.product_instance_id)
         from bass2.dw_product_ord_cust_dm_201107 a,
                      bass2.dw_product_ord_busi_dm_201107 b,
                      bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729  c,
                                                   bass2.dw_product_20110729 d
          where a.customer_order_id = b.customer_order_id
                      and b.busioper_order_id =c.busioper_order_id 
                      and c.ext_6 like '%SRC=206%'   
                                                   and a.product_instance_id = d.user_id    
                                                   and  date(c.create_date) = '2011-07-29'
                                  group by d.region_id 

select d.region_id, count(0),count(distinct a.product_instance_id) from    bass2.dw_product_ord_busi_dm_201107 b,  bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729  c
,bass2.dw_product_ord_cust_dm_201107 a
,  bass2.dw_product_20110729 d
where c.ext_6 like '%SRC=206%'                                     
 and b.busioper_order_id =c.busioper_order_id 
 and a.customer_order_id = b.customer_order_id
 and a.product_instance_id = d.user_id    
 and  date(c.create_date) = '2011-07-29'
 group by d.region_id
 
 
 select distinct d.region_id, a.product_instance_id from    bass2.dw_product_ord_busi_dm_201107 b,  bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729  c
,bass2.dw_product_ord_cust_dm_201107 a
,  bass2.dw_product_20110729 d
where c.ext_6 like '%SRC=206%'                                     
 and b.busioper_order_id =c.busioper_order_id 
 and a.customer_order_id = b.customer_order_id
 and a.product_instance_id = d.user_id    
 and  date(c.create_date) = '2011-07-29'
 
 
 select * from  g_s_22066_day
 
 select * from  bass2.dim_svc_item
 
 
 
 
select SVC_TYPE_ID , count(0) 
--,  count(distinct SVC_TYPE_ID ) 
from bass1.int_21007_201107 
group by  SVC_TYPE_ID 
order by 1 


select * from    bass2.ods_cdr_wlan_20110726


select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from g_s_04003_day 
group by  TIME_ID 
order by 1 

select count(0),count(distinct a.user_id ) from     bass1.G_A_02062_DAY  a ,

BASS1.g_a_02004_02008_stage b
where a.user_id = b.USER_ID





select SIM_CODE , count(0), count(distinct a.user_id )
--,  count(distinct SIM_CODE ) 
from G_A_02004_DAY  a,table(
select t2.*
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc) rn 
from G_A_02062_DAY t 
) t2 where rn = 1 and STATUS_ID = '1'
) b
where a.user_id = b.USER_ID
group by  SIM_CODE 
order by 1 

STATUS_ID

select count(0) from    
table(
select t2.*
from 
(
select t.*,row_number()over(partition by enterprise_id,user_id order by time_id desc) rn 
from G_A_02062_DAY t 
) t2 where rn = 1 and STATUS_ID = '1'
) b


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02062_DAY 
group by  time_id 
order by 1 desc


select * from bass1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0108'
and bass1_value in ('1241','1249')

select * from   bass2.map_pub_brand



CREATE TABLE "BASS1   "."G_A_02062_DAY_STAGE"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "USER_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "INDUSTRY_ID" CHAR(2) , 
                  "GPRS_TYPE" CHAR(1) , 
                  "DATA_SOURCE" CHAR(60) , 
                  "CREATE_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 









select count(0),count(distinct user_id ) from    G_A_02062_DAY_STAGE

select count(0) from    
bass1.g_a_02004_02008_stage  a 
,G_A_02062_DAY_STAGE b 
where a.user_id = b.user_id 



USERTYPE_ID

select USERTYPE_ID, count(0) from    
bass1.g_a_02004_02008_stage  a 
,G_A_02062_DAY_STAGE b 
where a.user_id = b.user_id 
group by USERTYPE_ID




select  value(a.user_id , b.user_id)
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
where b.user_id is null



select  count(0)
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
where b.user_id is null


select  value(a.user_id , b.user_id)
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
where  a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
)

89660000066399      	0              	1

select * from   g_a_02004_02008_stage
where user_id = '89660000066399      '

select * from   
(select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u
        where  user_id = '89660000066399      '

BASS1_G_A_02062_DAY.tcl	BASS2_Dw_enterprise_sub_ds.tcl
BASS1_G_A_02062_DAY.tcl	BASS2_Dw_enterprise_membersub_ds.tcl
BASS1_G_A_02062_DAY.tcl	BASS2_Dw_product_ds.tcl
        
        
select * from  table( bass1.get_before('02062')) a 
        BASS2_Dw_product_bass1_ds.tcl
        BASS2_Dw_product_ds.tcl
        
select * from   app.sch_control_runlog where control_code in ('BASS2_Dw_product_bass1_ds.tcl','BASS2_Dw_product_ds.tcl'
,'BASS2_Dw_enterprise_sub_ds.tcl'
,'BASS2_Dw_enterprise_membersub_ds.tcl'
,'BASS2_Dw_product_ds.tcl'
)        




        --add 
select new_sim_code,count(0),count(distinct  user_id ) 
from (
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where  a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
)
        ) t 
        group by new_sim_code
        



        
select new_sim_code,count(0),count(distinct  user_id ) 
from (
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     

        ) t 
        group by new_sim_code
        

-- sim_code 增量 
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
where  a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
)


drop table BASS1.g_a_02004_02062_simcode;
CREATE TABLE BASS1.g_a_02004_02062_simcode
 (
 user_id                varchar(20)         
 ,old_sim_code		char(1)
 ,new_sim_code		char(1)
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING;

ALTER TABLE BASS1.g_a_02004_02062_simcode
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
ALTER TABLE g_a_02004_02062_simcode ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

        
insert into bass1.g_a_02004_02062_simcode
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    left join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
where  a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
)



select * from   bass1.g_a_02004_02062_simcode

89360000580841      	1	0

select user_id,count(0)
from (
select user_id,sim_code from        g_a_02004_day
group by user_id,sim_code
) a 
group by user_id having count(0) > 1

select * from    bass2.dw_product_bass1_20110730 
where user_id = '89360000580841'



select * from    bass1.g_a_02004_02008_stage 
where user_id = '89360000580841'



select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where ( a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
) ) 

89657334398014      	0              	1



select * from    bass2.dw_product_bass1_20110725
where user_id = '89657334398014'


select user_id,sim_code from        g_a_02004_day
where user_id = '89657334398014'

select user_id,crm_brand_id2 from    bass2.dw_product_201006
where user_id = '89657334398014'
USER_ID	CRM_BRAND_ID2
89657334398014	50


drop  TABLE BASS1.g_a_02004_02008_stage


CREATE TABLE BASS1.g_a_02004_02008_stage(
   user_id CHARACTER(15),
   product_no CHARACTER(15),
   test_flag CHARACTER(1),
   sim_code CHARACTER(15),
   usertype_id CHARACTER(4),
   create_date CHARACTER(15),
   brand_id CHARACTER(4)
   ,time_id INT 
        ,CUST_ID                 CHARACTER(20)       
        ,USER_BUS_TYP_ID         CHARACTER(2)        
        ,IMSI                    CHARACTER(15)       
        ,CMCC_ID                 CHARACTER(5)        
        ,CHANNEL_ID              CHARACTER(40)       
        ,MCV_TYP_ID              CHARACTER(1)        
        ,PROMPT_TYPE             CHARACTER(1)        
        ,SUBS_STYLE_ID           CHARACTER(2)        
   
) DATA CAPTURE NONE 
 IN TBS_APP_BASS1 INDEX 
 IN TBS_INDEX PARTITIONING KEY(
    user_id 
 )USING HASHING;
 
 
 select 
         TIME_ID
        ,USER_ID
        ,CUST_ID
        ,USERTYPE_ID
        ,CREATE_DATE
        ,USER_BUS_TYP_ID
        ,PRODUCT_NO
        ,IMSI
        ,CMCC_ID
        ,CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
        ,BRAND_ID
        ,SIM_CODE
 from  
 BASS1.g_a_02004_02008_stage
 
 
 
 
insert into bass1.g_a_02004_02008_stage 
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id  
        ,CUST_ID
        ,USER_BUS_TYP_ID
        ,IMSI
        ,CMCC_ID
        ,CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
from (select user_id,CUST_ID,USERTYPE_ID,create_date,USER_BUS_TYP_ID,product_no,IMSI
    ,CMCC_ID
    ,CHANNEL_ID
    ,MCV_TYP_ID
    ,PROMPT_TYPE
    ,SUBS_STYLE_ID
    ,brand_id
    ,sim_code
    ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110731 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110731 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1






ALTER TABLE g_a_02004_02062_simcode ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE



# 获取 sim_code 增量数据 
# 忽略离网用户的变化
insert into bass1.g_a_02004_02062_simcode
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where ( 
a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
 )
)
and ( a.usertype_id NOT IN ('2010','2020','2030','9000') )




insert into bass1.g_a_02004_02062_simcode
select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where ( a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
) ) 
--and ( a.usertype_id NOT IN ('2010','2020','2030','9000') )


bass1.g_a_02004_02062_simcode


select usertype_id ,count(0) from    
 bass1.g_a_02004_02008_stage  a 
 ,bass1.g_a_02004_02062_simcode b 
 where a.user_id = b.user_id 
 group by usertype_id
 
 
 
select count(0) from 
(select * from g_a_02004_day where time_id = 20110730 ) a 
,bass1.g_a_02004_02062_simcode b 
where a.user_id = b.user_id 

select * from   g_a_02004_02062_simcode
where new_sim_code is null

select new_SIM_CODE , count(0) 
--,  count(distinct new_SIM_CODE ) 
from g_a_02004_02062_simcode 
group by  new_SIM_CODE 
order by 1 

select count(0),count(distinct user_id) from    g_a_02004_02062_simcode




select count(0) from    (select * from g_a_02004_day where time_id = 20110722        ) a 
where exists (select 1 from g_a_02004_02062_simcode b where a.user_id = b.user_id )


select * from   g_a_02004_02062_simcode a,
g_a_02004_02008_stage b 
where a.USER_ID = b.USER_ID


select count(0) from    (select * from g_a_02004_day where time_id = 20110722        ) a 
where exists (select 1 from g_a_02004_02062_simcode b where a.user_id = b.user_id )




CREATE TABLE "BASS1   "."G_A_02004_DAY_T20110731"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



INSERT INTO G_A_02004_DAY_T20110731
select * from g_a_02004_day where time_id = 20110722


select SIM_CODE , count(0) 
--,  count(distinct SIM_CODE ) 
from G_A_02004_DAY_T20110731 
group by  SIM_CODE 
order by 1 

update  G_A_02004_DAY_T20110731 a 
set a.sim_code = (select new_sim_code from g_a_02004_02062_simcode b where a.user_id = b.user_id )
where exists (select 1 from g_a_02004_02062_simcode b where a.user_id = b.user_id )



select count(0) from    (select * from G_A_02004_DAY_T20110731 where time_id = 20110722        ) a 
where exists (select 1 from g_a_02004_02062_simcode b where a.user_id = b.user_id )

update 

以防关联不到的被更新为null,比较完整的写法为：
update a set a.a1=(select b1 from b where b.b2=a.a2)where exists
(select 1 from b where b.b2=a.a2);

drop table G_A_02004_DAY_T20110731



update  (select * from g_a_02004_day where time_id = 20110730 ) a 
set a.sim_code =  (select new_sim_code from g_a_02004_02062_simcode b where a.user_id = b.user_id )
where exists (select 1 from g_a_02004_02062_simcode b where a.user_id = b.user_id )



select count(0) from    (
select 
         20110730 TIME_ID
        ,a.USER_ID
        ,a.CUST_ID
        ,a.USERTYPE_ID
        ,a.CREATE_DATE
        ,a.USER_BUS_TYP_ID
        ,a.PRODUCT_NO
        ,a.IMSI
        ,a.CMCC_ID
        ,a.CHANNEL_ID
        ,a.MCV_TYP_ID
        ,a.PROMPT_TYPE
        ,a.SUBS_STYLE_ID
        ,a.BRAND_ID
        ,b.new_sim_code SIM_CODE
from g_a_02004_02008_stage a 
,g_a_02004_02062_simcode b 
where a.user_id = b.user_id 
and b.user_id not in 
(
select b.user_id from 
(select * from g_a_02004_day where time_id = 20110730 ) a 
,bass1.g_a_02004_02062_simcode b 
where a.user_id = b.user_id 
)
and ( a.usertype_id NOT IN ('2010','2020','2030','9000') )
) t


select count(distinct user_id), count(0) from    (
select * from g_a_02004_day where time_id = 20110730
union all
select 
         20110730 TIME_ID
        ,a.USER_ID
        ,a.CUST_ID
        ,a.USERTYPE_ID
        ,a.CREATE_DATE
        ,a.USER_BUS_TYP_ID
        ,a.PRODUCT_NO
        ,a.IMSI
        ,a.CMCC_ID
        ,a.CHANNEL_ID
        ,a.MCV_TYP_ID
        ,a.PROMPT_TYPE
        ,a.SUBS_STYLE_ID
        ,a.BRAND_ID
        ,b.new_sim_code SIM_CODE
from g_a_02004_02008_stage a 
,g_a_02004_02062_simcode b 
where a.user_id = b.user_id 
and b.user_id not in 
(
select b.user_id from 
(select * from g_a_02004_day where time_id = 20110730 ) a 
,bass1.g_a_02004_02062_simcode b 
where a.user_id = b.user_id 
)
and ( a.usertype_id NOT IN ('2010','2020','2030','9000') )
) t



select  value(a.user_id , b.user_id) user_id ,a.user_id a,b.user_id b
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where (a.user_id is null and b.user_id is not null)



select  value(a.user_id , b.user_id) user_id ,a.user_id a,b.user_id b
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
	  when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
		from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where ( a.user_id is not null and b.user_id is null )


select count(0)
,sum( case when a.user_id is null and b.user_id is null then 1 else 0 end   )  a 
,sum( case when a.user_id is null and b.user_id is not null then 1 else 0 end   )  b
,sum( case when b.user_id is not null then 1 else 0 end   )  b1
,sum( case when a.user_id is not null and b.user_id is  null then 1 else 0 end   )  c
,sum( case when a.user_id is not null and b.user_id is  not null then 1 else 0 end   )  d
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    where a.user_id = '89101110010266 '
    
    
   select *     
    from bass1.g_a_02004_02008_stage a 
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
    where value(a.user_id , b.user_id) = '89157332939218       '
    
       select * from    G_A_02062_DAY_STAGE
       
select * from app.sch_control_runlog where control_code in (
select control_code from  table( bass1.get_after('BASS1_G_A_02004_DAY.tcl')) a 
       )
       and control_code like '%DAY%'
      or 
control_code in ('BASS2_Dw_product_bass1_ds.tcl','BASS2_Dw_product_ds.tcl'
,'BASS2_Dw_enterprise_sub_ds.tcl'
,'BASS2_Dw_enterprise_membersub_ds.tcl'
,'BASS2_Dw_product_ds.tcl'
)        
     or control_code = 'BASS1_G_A_02004_DAY.tcl' 
     or control_code = 'BASS1_G_A_02062_DAY.tcl' 
     
insert into app.sch_control_before
values('BASS1_G_A_02004_DAY.tcl','BASS1_G_A_02062_DAY.tcl')

select count(0) from    g_a_02004_02062_simcode
select count(0) from    g_a_02004_02008_stage



CREATE TABLE "BASS1   "."G_A_02004_DAY_20110730"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


insert into G_A_02004_DAY_20110730
select * from G_A_02004_DAY
where time_id = 20110730


select * from    g_a_02004_02008_stage


select count(0) from g_a_02004_day where time_id = 20110730 


ALTER TABLE g_a_02004_02008_stage ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE



insert into bass1.g_a_02004_02008_stage 
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,e.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id  
        ,CUST_ID
        ,USER_BUS_TYP_ID
        ,IMSI
        ,CMCC_ID
        ,CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
from (select user_id,CUST_ID,USERTYPE_ID,create_date,USER_BUS_TYP_ID,product_no,IMSI
    ,CMCC_ID
    ,CHANNEL_ID
    ,MCV_TYP_ID
    ,PROMPT_TYPE
    ,SUBS_STYLE_ID
    ,brand_id
    ,sim_code
    ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110730 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110730 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1


select  value(a.user_id , b.user_id) user_id
    , a.sim_code old_sim_code 
    ,case when a.user_id is null and b.user_id is not null then '2' 
          when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
                from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    full join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id and a.sim_code = b.sim_code
where ( a.sim_code is null 
or (
 a.sim_code <> case when a.user_id is null and b.user_id is not null then '2' 
          when a.user_id is not null and b.user_id is null then value(u.sim_code,'0')
    end
) ) 


select SIM_CODE , count(0) 
--,  count(distinct SIM_CODE ) 
from bass1.g_a_02004_02008_stage 
group by  SIM_CODE 
order by 1 

select count(0) from    BASS1.G_A_02004_DAY where time_id=20110730
select count(0) from    G_A_02004_DAY_20110730

insert into app.sch_control_before
values('BASS1_G_A_02004_DAY.tcl','BASS1_G_A_02062_DAY.tcl')




select * from    BASS1.ALL_DIM_LKP 	
where bass1_tbid = 'BASS_STD2_0010'

集团行业网关短信业务量之和。

select * from   bass2.dim_svc_item




                    select sum(cnts) from 
                    (
                                                select value(sum(counts),0) cnts from bass2.dw_newbusi_ismg_20110730  a,bass2.dw_product_20110730 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1 
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and a.calltype_id in (0,1,10,11)
                                                  and a.send_state='0'
                                                  and a.drtype_id<>61102 
                                                  and substr(a.sp_code,1,12) is not null
              and a.svcitem_id in (300001,300002,300003,300004)
          union all
                                                select value(sum(counts),0) cnts from bass2.dw_newbusi_ismg_20110730  a,bass2.dw_product_20110730 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1 
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and a.calltype_id in (0,1,10,11)
                                                  and a.send_state='0'
              and substr(a.ser_code,1,5) in ('12590')       
                                        union all
                                                select value(sum(counts),0) cnts from bass2.dw_newbusi_ismg_20110730  a,bass2.dw_product_20110730 b 
                                                where a.user_id=b.user_id  
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1 
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and a.calltype_id=0
                                                  and a.send_state='0'
                                                  and a.svcitem_id in (300009) 
                                        union all
                                                select value(sum(counts),0) cnts from  bass2.dw_newbusi_call_20110730 a,bass2.dw_product_20110730 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1 
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and a.calltype_id=0
                                                  and a.svcitem_id in  (100003,100021,100025,100027)
                                        union all               
                                         select value(sum(counts),0) cnts from bass2.dw_newbusi_sms_20110730  a,bass2.dw_product_20110730 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and  a.calltype_id in (0)
                                                  and  a.final_state=1
                                        ) as aa
                                        
                                        

select time_id , count(0) ,sum(bigint(SMS_COUNTS))
--,  count(distinct time_id ) 
from G_S_21007_DAY 
where SVC_TYPE_ID in  ('11','12','13','70')
group by  time_id 
order by 1 desc 
                                        
                                        select * from   G_S_21007_DAY

select * from   G_S_22012_DAY order by time_id desc

select * from  table( bass1.get_before('G_S_22012_DAY')) a 


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04016_DAY 
group by  time_id 
order by 1 desc
select * from app.sch_control_runlog 
where control_code in (
select before_control_code from  table( bass1.get_before('BASS1_G_S_04016_DAY.tcl')) a 
)

select count(0) from    G_S_04016_DAY where time_id = 20110730 
and RECORD_TYPE in ('00','01','10','11')
and SEND_STATUS = '0'


select RECORD_TYPE , count(0) 
--,  count(distinct RECORD_TYPE ) 
from G_S_04016_DAY 
group by  RECORD_TYPE 
order by 1 


insert into app.sch_control_before
values('BASS1_G_S_22012_DAY.tcl','BASS1_G_S_04016_DAY.tcl')

select * from   bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110729

                                        select * from  table( bass1.get_task('TR1_L_11060')) a 

select * from   app.sch_control_task where 
CONTROL_CODE in ('TR1_L_11060','TR1_L_01219')

update  app.sch_control_task
set cc_flag = 2
where cc_flag = 1
and CONTROL_CODE in ('TR1_L_11060')



select * from    bass2.dim_product_item 

SELECT 
			distinct *
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  like '%QW%'

select char(xzbas_value)  as offer_id 
		from  BASS1.ALL_DIM_LKP 
		where BASS1_TBID = 'BASS_STD1_0114'
		and bass1_value like 'QW_QQT_JC%'
		and XZBAS_COLNAME not like '套餐减半%'

select * from    bass2.dim_product_item b
where (b.prod_id in (90001311,90001312,90001313,90001314,90001315,90001316,90001317,90001318,90001344)
			or char(b.prod_id) 
			    in (select xzbas_value from  BASS1.ALL_DIM_LKP 
				where BASS1_TBID = 'BASS_STD1_0114'
				and bass1_value like 'QW_QQT_JC%'
				and XZBAS_COLNAME not like '套餐减半%'
				)
		  )
          

select extend_id from   bass2.dim_prod_up_product_item
where char(product_item_id  )
in (select xzbas_value from  BASS1.ALL_DIM_LKP 
				where BASS1_TBID = 'BASS_STD1_0114'
				and bass1_value like 'QW_QQT_JC%'
				and XZBAS_COLNAME not like '套餐减半%'
				)
                

select * from    bass2.dim_product_item b
where (b.prod_id =     90001344 )
                                                                  
          
          select * from    bass2.dim_product_item b
where b.prod_id in 
(90001311,90001312,90001313,90001314,90001315,90001316,90001317,90001318,90001344
,90001331 ,90001332 ,90001333 ,90001334 ,90001335 ,90001336 ,90001337 ,90001338 ,90001339 ,90001340 ,90001341 ,90001342 ,90001343 ,90001344 ,90001345 )

          
          

select * from bass2.ODS_ENT_GROUP_RELATION_20110730


          

update  app.sch_control_task 
set cc_flag = 1
where cc_flag = 2
and control_code in (
'BASS1_EXP_G_S_02024_DAY'
,'BASS1_EXP_G_S_02025_DAY'
,'BASS1_EXP_G_S_04019_DAY'
,'BASS1_EXP_G_S_22048_DAY'
)


          


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22048_DAY 
group by  time_id 
order by 1 
          
rename g_s_22066_day to g_s_22066_day_old



CREATE TABLE "BASS1   "."G_S_22066_DAY"  (
                  "TIME_ID" INTEGER , 
                  "DEAL_DATE" CHAR(8) , 
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "BUSI_REC_CNT" CHAR(10) , 
                  "ACTIVATE_CNT" CHAR(8) , 
                  "TERM_SALE_CNT" CHAR(8) , 
                  "VAL_BUSI_REC_CNT" CHAR(10) , 
                  "VAL_BUSI_CANCEL_CNT" CHAR(10) , 
                  "CHRG_REC_CNT" CHAR(10) , 
                  "CHRG_REC_FEE" CHAR(12) , 
                  "ACCESS_CNT" CHAR(8) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("DEAL_DATE",  
                 "E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




insert into app.sch_control_before 
values ('BASS1_G_S_22066_DAY.tcl','TR1_L_11060')


          
          select * from  table( bass1.get_before('BASS1_G_S_22066_DAY.tcl')) a 


select * from   G_S_22066_DAY


select date(TIME_INCALL) , count(0) 
--,  count(distinct date(TIME_INCALL) ) 
from bass2.dw_custsvc_cps_log_call_dm_201107 
group by  date(TIME_INCALL) 
order by 1 

select sum(bigint(PAYMENT_REC_CNT)),sum(bigint(PAYMENT_REC_FEE)) from   g_s_22091_day where time_id = 20110731

1	2
56434	2940109

select sum(bigint(PAYMENT_REC_CNT)),sum(bigint(PAYMENT_REC_FEE)) from   g_s_22091_day where time_id = 20110731


	select * from G_A_01002_DAY a
    where  a.time_id = 20110531


select NATION_ID , count(0) 
--,  count(distinct NATION_ID ) 
from G_A_01002_DAY a
  where  a.time_id = 20110731
group by  NATION_ID 
order by 1 
   
   
   select * from    BASS1.ALL_DIM_LKP 
   where BASS1_TBID = 'BASS_STD1_0116'
   

alter table BASS1.G_S_04018_DAY ALTER column UP_FLOWS    SET DATA TYPE CHARACTER(14)
alter table BASS1.G_S_04018_DAY ALTER column DOWN_FLOWS  SET DATA TYPE CHARACTER(14)

   
   select count(0) from     G_A_01002_DAY_CHNL_MID



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01002_DAY 
group by  time_id 
order by 1 


select * from   G_S_22012_DAY
where time_id = 20110731



CREATE TABLE "BASS1   "."G_S_22012_DAY_T20110801"  (
                  "TIME_ID" INTEGER , 
                  "BILL_DATE" CHAR(8) NOT NULL , 
                  "M_NEW_USERS" CHAR(10) NOT NULL , 
                  "M_DAO_USERS" CHAR(12) NOT NULL , 
                  "M_BILL_DURATION" CHAR(12) NOT NULL , 
                  "M_DATA_FLOWS" CHAR(12) NOT NULL , 
                  "M_BILL_SMS" CHAR(12) NOT NULL , 
                  "M_OFF_USERS" CHAR(10) NOT NULL , 
                  "M_BILL_MMS" CHAR(12) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID")   
                   IN "TBS_APP_BASS1" ; 


drop table G_S_22012_DAY_T20110801



INSERT INTO G_S_22012_DAY_T20110801
select * from   G_S_22012_DAY
where time_id = 20110731

delete from G_S_22012_DAY
where time_id = 20110731


INSERT INTO G_S_22012_DAY
select * from   G_S_22012_DAY_T20110801
where time_id = 20110731


select count(0) from     bass1.G_S_04005_DAY where time_id = 20110731
845774

845774


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04014_DAY 
group by  time_id 
order by 1 


update app.sch_control_task 
set cc_flag = 2
where control_code = 'BASS1_G_S_04014_DAY.tcl'
and cc_flag = 1




select * from   G_S_21007_DAY
where time_id = 20110731




select sum(bigint(SMS_COUNTS)),sum(bigint(SMS_BASE_FEE)) from   G_S_21007_DAY where time_id = 20110731



select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 





select  count(distinct case when a.op_id = 10000047 then a.product_instance_id end)
        ,count(distinct case when a.org_id=11111124 then a.product_instance_id end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.product_instance_id end)
   from bass2.dw_product_ord_cust_dm_201107 a,
        bass2.dw_product_ins_off_ins_prod_ds b,
        bass2.dw_product_ord_offer_dm_201107 c,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d,
        bass2.dw_product_20110731 e
   where a.product_instance_id=e.user_id
     and a.product_instance_id=b.product_instance_id
     and a.customer_order_id=c.customer_order_id
     and b.offer_id=d.PRODUCT_ITEM_ID
     and d.PRODUCT_ITEM_ID =c.offer_id
     and date(b.done_date)='2011-07-31'
     and a.op_time='2011-07-31'
     and c.op_time='2011-07-31'
     and c.offer_type=2 
     and c.state=3




select  count(distinct case when a.op_id = 10000047 then a.product_instance_id end)
        ,count(distinct case when a.org_id=11111124 then a.product_instance_id end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.product_instance_id end)
   from bass2.dw_product_ord_cust_dm_20110731 a,
        bass2.dw_product_ins_off_ins_prod_ds b,
        bass2.dw_product_ord_offer_dm_20110731 c,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d,
        bass2.dw_product_20110731 e
   where a.product_instance_id=e.user_id
     and a.product_instance_id=b.product_instance_id
     and a.customer_order_id=c.customer_order_id
     and b.offer_id=d.PRODUCT_ITEM_ID
     and d.d.PRODUCT_ITEM_ID =c.offer_id
     and date(b.done_date)='2011-07-31'
     and a.op_time='2011-07-31'
     and c.op_time='2011-07-31'
     and c.offer_type=2 
     and c.state=3




select  count(distinct case when a.op_id = 10000047 then a.product_instance_id end)
        ,count(distinct case when a.org_id=11111124 then a.product_instance_id end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.product_instance_id end)
   from
        bass2.dw_product_ord_offer_dm_201107 a,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d
   where 
       d.PRODUCT_ITEM_ID =a.offer_id
     and date(a.done_date)='2011-07-31'
     and a.op_time='2011-07-31'
     and a.offer_type=2 
     and a.state=3




select  count(distinct case when a.op_id = 10000047 then a.CUSTOMER_ORDER_ID end)
        ,count(distinct case when a.org_id=11111124 then a.CUSTOMER_ORDER_ID end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.CUSTOMER_ORDER_ID end)
   from
        bass2.dw_product_ord_offer_dm_201107 a,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d
   where 
       d.PRODUCT_ITEM_ID =a.offer_id
     and date(a.done_date)='2011-07-31'
     and a.op_time='2011-07-31'
     and a.offer_type=2 
     and a.state=3



select OP_TIME , count(0) 
--,  count(distinct OP_TIME ) 
from bass2.dw_product_ord_offer_dm_201107 
group by  OP_TIME 
order by 1 





select  count(distinct case when a.op_id = 10000047 then a.CUSTOMER_ORDER_ID end)
        ,count(distinct case when a.org_id=11111124 then a.CUSTOMER_ORDER_ID end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.CUSTOMER_ORDER_ID end)
   from
        bass2.dw_product_ord_offer_dm_201107 a,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d
   where 
       d.PRODUCT_ITEM_ID =a.offer_id
       
       
       
select  count(distinct case when a.op_id = 10000047 then a.CUSTOMER_ORDER_ID end)
        ,count(distinct case when a.org_id=11111124 then a.CUSTOMER_ORDER_ID end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.CUSTOMER_ORDER_ID end)
   from
        bass2.dw_product_ord_offer_dm_201107 a,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d
   where 
       d.PRODUCT_ITEM_ID =a.offer_id
     and a.offer_type=2 
     and a.state=3
     --and date(a.CANCEL_DATE)='2011-07-31'
     --and a.op_time='2011-07-31'





       
select  count(distinct case when a.op_id = 10000047 then a.CUSTOMER_ORDER_ID end)
        ,count(distinct case when a.org_id=11111124 then a.CUSTOMER_ORDER_ID end)
        ,0
        ,count(distinct case when a.op_id = 10000475 then a.CUSTOMER_ORDER_ID end)
   from
        bass2.dw_product_ord_offer_dm_201107 a,
        (
	SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
			WHERE ITEM_TYPE='OFFER_PLAN'
	  AND DEL_FLAG='1'
	  AND SUPPLIER_ID IS NOT NULL
	)  d
   where 
       d.PRODUCT_ITEM_ID =a.offer_id
     and a.state=3
     and date(a.DONE_DATE)='2011-07-31'
and a.offer_id in (113110176435,113110178916,113110179337,113110179338,113110179339,113110181288,113110198228,113110198230, 113090000003, 113090003319,113090003320,113090003321,111090033319, 111090002601,111090002603,111090009284,111090009286,111090009289,111090009317,111099001631, 111090002901, 113110166406, 113110203699, 111090003215,113110180134, 111090001223,111090009160,111090009188,111090009244,111090009282,111090009299,111093301007,111098000030,112093301001,112093301002, 111000000705, 113110175125,113110195329, 111098000044,113110180139,113110197954, 113110156821,113110166390,113110168281,113110178283,113110208633,113110208635, 111090009253,111090009287,111099900633,111099900635,113110174469,113110174473,113110174479,113110174481,113110174482,113110174483,113110174488,113110174643,113110211995,113110212290)


     --and a.op_time='2011-07-31'
     and a.offer_type=2 



select state , count(0) 
--,  count(distinct state ) 
from bass2.dw_product_ord_offer_dm_201107 
group by  state 
order by 1 




select REGION_ID , count(0) 
--,  count(distinct REGION_ID ) 
from bass2.dw_product_20110731 
group by  REGION_ID 
order by 1 



select REGION_ID , count(0) 
--,  count(distinct REGION_ID ) 
from bass2.dw_product_ord_offer_dm_201107 
group by  REGION_ID 
order by 1 



select REGION_ID , count(0) 
--,  count(distinct REGION_ID ) 
from bass2.dw_product_ord_cust_dm_201107 
group by  REGION_ID 
order by 1 





                                select 'NotFetch' region_id,109,201
                                ,count(distinct case when a.op_id = 10000475 then a.CUSTOMER_ORDER_ID end)  as count                            
                                from
                                bass2.dw_product_ord_offer_dm_201107 a,
                                bass2.dw_product_20110731 b,
                                (
                                        SELECT PRODUCT_ITEM_ID,SUPPLIER_ID,EXTEND_ID2 ,name FROM bass2.DIM_PROD_UP_PRODUCT_ITEM
                                                WHERE ITEM_TYPE='OFFER_PLAN'
                                        AND DEL_FLAG='1'
                                        AND SUPPLIER_ID IS NOT NULL
                                )  d
                                where 
                                d.PRODUCT_ITEM_ID =a.offer_id
                                and a.state=3
                                and date(a.DONE_DATE)='2011-07-31'
                                and a.offer_id in (113110176435,113110178916,113110179337,113110179338,113110179339,113110181288,113110198228,113110198230, 113090000003, 113090003319,113090003320,113090003321,111090033319, 111090002601,111090002603,111090009284,111090009286,111090009289,111090009317,111099001631, 111090002901, 113110166406, 113110203699, 111090003215,113110180134, 111090001223,111090009160,111090009188,111090009244,111090009282,111090009299,111093301007,111098000030,112093301001,112093301002, 111000000705, 113110175125,113110195329, 111098000044,113110180139,113110197954, 113110156821,113110166390,113110168281,113110178283,113110208633,113110208635, 111090009253,111090009287,111099900633,111099900635,113110174469,113110174473,113110174479,113110174481,113110174482,113110174483,113110174488,113110174643,113110211995,113110212290)
                                group by a.region_id
                                
                                
                                
                                select count(0) from     bass2.dw_product_ord_offer_dm_201107
                                
                                

select * from   G_S_22066_DAY
                                
                                
select count(0) from    G_A_02004_DAY_20110730
2276

ALTER TABLE g_a_02004_02062_simcode ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE
G_A_02004_DAY_20110730
ALTER TABLE G_A_02004_DAY_20110730 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

insert into G_A_02004_DAY_20110730
select * from G_A_02004_DAY where  time_id >= 20110730


delete from G_A_02004_DAY
where  time_id >= 20110730

insert into G_A_02004_DAY
select * from G_A_02004_DAY_20110730 where  time_id >= 20110730


[/SQL]
[SQL]

insert into bass1.g_a_02004_02062_simcode
select  value(a.user_id , b.user_id) user_id
    ,a.sim_code old_sim_code
    ,case when a.sim_code = '1' then a.sim_code 
          when b.user_id is not null then '2' 
          when b.user_id is null then value(u.sim_code,'0')
    end new_sim_code
    from bass1.g_a_02004_02008_stage a 
     join (select user_id ,case when a.crm_brand_id2=70 then '1'  else '0' end sim_code 
                from  bass2.dw_product_bass1_20110730 a ) u on  a.user_id = u.user_id     
    left join (select user_id , '2' sim_code from  G_A_02062_DAY_STAGE ) b on a.user_id = b.user_id 
where a.SIM_CODE <> (case when a.sim_code = '1' then a.sim_code 
          when b.user_id is not null then '2' 
          when b.user_id is null then value(u.sim_code,'0')
    end )


select a.SIM_CODE,count(0) count(0) from    
bass1.g_a_02004_02008_stage  a
,G_A_02062_DAY_STAGE b 
where a.user_id = b.user_id 
group by a.SIM_CODE


select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.g_a_02004_day 
group by  time_id 
order by 1 

select count(0) from    G_A_02062_DAY_STAGE


select NEW_SIM_CODE , count(0) 
--,  count(distinct NEW_SIM_CODE ) 
from bass1.g_a_02004_02062_simcode 
group by  NEW_SIM_CODE 
order by 1 

                                
                                

select a.SIM_CODE,count(0) from    
bass1.g_a_02004_02008_stage  a
,G_A_02062_DAY_STAGE b 
where a.user_id = b.user_id 
group by a.SIM_CODE

          select count(0),count(distinct user_id) from   g_a_02004_02062_simcode                     

select tabname from syscat.tables where tabname like '%02004%'             


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02004_DAY_20110730 
group by  time_id 
order by 1 

select count(0) from   G_A_02004_DAY where time_id = 20110730
select count(0) from   G_A_02004_DAY where time_id = 20110731


5374

select count(0) from    bass1.g_a_02004_02062_simcode




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_02004_DAY 
group by  time_id 
order by 1 desc


alter table BASS1.G_S_04002_DAY ALTER column UP_FLOWS    SET DATA TYPE CHARACTER(14)
alter table BASS1.G_S_04002_DAY ALTER column DOWN_FLOWS  SET DATA TYPE CHARACTER(14)



select * from BASS1.dim_bass1_std_map 
where interface_code = '77780' and dim_table_id ='BASS_STD1_0007'


  SELECT 
         *
FROM BASS1.ALL_DIM_LKP 
WHERE BASS1_TBID = 'BASS_STD1_0007' 

select * from    bass1.dim_country_city_code 

                select distinct B_AREA_CD
                from G_S_04019_DAY where time_id = 20110801
                except 
                select country_code from  bass1.dim_country_city_code 


select * from   app.sch_control_task where control_code like 'BASS1%04005%'                


select * from  table( bass1.get_before('BASS1_G_S_04005_DAY.tcl')) a 


select * from   bass1.mon_all_interface where deadline = 9


CONTROL_CODE
BASS1_G_S_04005_DAY.tcl
BASS1_EXP_G_S_04005_DAY

select * from   

select count(0) from    bass1.G_S_04005_DAY where time_id = 20110801

/bassapp/backapp/bin/bass1_export/bass1_export bass1.G_S_04005_DAY 2011-08-01 &

select * from   g_s_22091_day
where time_id = 20110801

select * from   g_s_22012_day where time_id > 20110730
select count(0),count(distinct user_id ) from   g_a_02004_day  where time_id = 20110801


select * from   app.sch_control_runlog where control_code like '%04005%'
BASS1_EXP_G_S_04005_DAY
update app.sch_control_runlog  set flag = -2 
where control_code = 'BASS1_EXP_G_S_04005_DAY'


select * from  table( bass1.get_before('BASS1_EXP_G_S_04005_DAY')) a 



BASS1_INT_CHECK_L1K9_TO_DAY.tcl


select * from  table( bass1.get_before('04014')) a 


update 

update app.sch_control_task 
set cc_flag = 1
where control_code = 'BASS1_G_S_04014_DAY.tcl'
and cc_flag = 2




BASS1_EXP_G_S_04014_DAY

update app.sch_control_task 
set cc_flag = 2
where control_code = 'BASS1_EXP_G_S_04014_DAY'
and cc_flag = 1




select count(0) from    bass1.G_S_04005_DAY where time_id = 20110801

select * from   mon_all_interface where interface_code = '22204'



select * from   mon_all_interface where deadline = 3



select count(0) from    bass2.dw_ent_group_relation_20110731
870

SELECT *     FROM bass2.DIM_ACCT_PAYTYPE WHERE PAYTYPE_NAME LIKE '%托收%'
    
    
    select count(0),count(distinct enterprise_id ) from  G_I_77780_DAY_DOWN20110429
    

GTS1	托收	1
4115	托收缴费	1

    
    select  a.opt_code , paytype_name,count(0)
   from  bass2.dw_acct_payment_dm_201109 a,
   (SELECT *     FROM bass2.DIM_ACCT_PAYTYPE WHERE PAYTYPE_NAME LIKE '%托收%') b 
    where a.opt_code = b.paytype_id 
    group by a.opt_code , paytype_name
    


   4115
   

rename G_S_22068_MONTH to G_S_22068_MONTH_old


CREATE TABLE "BASS1   "."G_S_22068_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "OP_MONTH" CHAR(6) , 
                  "COUNTER_REC_CNT" CHAR(8) , 
                  "EBANK_REC_CNT" CHAR(8) , 
                  "OTH_REC_CNT" CHAR(8) , 
                  "COUNTER_REC_FEE" CHAR(10) , 
                  "EBANK_REC_FEE" CHAR(10) , 
                  "OTH_REC_FEE" CHAR(10) , 
                  "BNK_TS_CNT" CHAR(8) , 
		   "BNK_TS_FEE" CHAR(10) , 		  
                  "REWARD_FEE" CHAR(10) )   
                 DISTRIBUTE BY HASH("OP_MONTH")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


   
   
   CREATE TABLE "BASS1   "."G_S_22068_MONTH_4"  (
                  "OP_MONTH" CHAR(6) , 
                  "BNK_TS_CNT" CHAR(8) , 
                  "BNK_TS_FEE" CHAR(10)  
                 )   
                 DISTRIBUTE BY HASH("OP_MONTH")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select 
time_id
,int(substr(rule_code,6)) seq
,rule_code
,case 
    when rule_code = 'R161_1' then '新增客户数'
    when rule_code = 'R161_2' then '客户到达数'
    when rule_code = 'R161_3' then '净增客户数'
    when rule_code = 'R161_4' then '通信客户数'
    when rule_code = 'R161_5' then '当月累计通信客户数'
    when rule_code = 'R161_6' then '使用TD网络的客户数'
    when rule_code = 'R161_7' then '当月累计使用TD网络的手机客户数'
    when rule_code = 'R161_8' then '当月累计使用TD网络的信息机客户数'
    when rule_code = 'R161_9' then '当月累计使用TD网络的数据卡客户数'
    when rule_code = 'R161_10' then '当月累计使用TD网络的上网本客户数'
    when rule_code = 'R161_11' then '联通移动客户总数'
    when rule_code = 'R161_12' then '电信移动客户总数'
    when rule_code = 'R161_13' then '联通移动新增客户数'
    when rule_code = 'R161_14' then '电信移动新增客户数'
    when rule_code = 'R161_15' then '使用TD网络的客户在T网上计费时长'
    when rule_code = 'R161_16' then '使用TD网络的客户在T网上的数据流量'
    when rule_code = 'R161_17' then '离网客户数' else '0' end rule_name 
,case 
    when rule_code = 'R161_1' then 15
    when rule_code = 'R161_2' then 2
    when rule_code = 'R161_3' then 100
    when rule_code = 'R161_4' then 5
    when rule_code = 'R161_5' then 5
    when rule_code = 'R161_6' then 5
    when rule_code = 'R161_7' then 5
    when rule_code = 'R161_8' then 5
    when rule_code = 'R161_9' then 5
    when rule_code = 'R161_10' then 5
    when rule_code = 'R161_11' then 2
    when rule_code = 'R161_12' then 2
    when rule_code = 'R161_13' then 8
    when rule_code = 'R161_14' then 8
    when rule_code = 'R161_15' then 20
    when rule_code = 'R161_16' then 20
    when rule_code = 'R161_17' then 70 else 0 end threshold 
    , target3*100 wave_rate
    ,case 
    when rule_code = 'R161_1' and abs(target3*100) > 15 then '超标'
    when rule_code = 'R161_2' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_3' and abs(target3*100) > 100 then '超标'
    when rule_code = 'R161_4' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_5' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_6' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_7' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_8' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_9' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_10' and abs(target3*100) > 5 then '超标'
    when rule_code = 'R161_11' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_12' and abs(target3*100) > 2 then '超标'
    when rule_code = 'R161_13' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_14' and abs(target3*100) > 8 then '超标'
    when rule_code = 'R161_15' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_16' and abs(target3*100) > 20 then '超标'
    when rule_code = 'R161_17' and abs(target3*100) > 70 then '超标'
else '0' end if_ok
from 
bass1.g_rule_check a 
where rule_code like 'R161_%'
and time_id =20110801;


select *
   from  bass2.dw_acct_payment_dm_201109 a,
   (SELECT *     FROM bass2.DIM_ACCT_PAYTYPE WHERE PAYTYPE_NAME LIKE '%托收%') b 
    where a.opt_code = '4115'
        and a.opt_code = b.paytype_id 






select  
count(0) common_cnt
,count(distinct a.unit_code) a_cnt
,count(distinct b.unit_code) b_cnt
from 
table(
select unit_code from  app.g_runlog
where time_id = int(replace(char(current date - 1 days),'-',''))
) a
full join 
table(
select substr(control_code , 15,5) unit_code
from   app.sch_control_runlog  a 
									where a.control_code like 'BASS1%EXP%DAY%' 
									and date(a.begintime) =  date(current date) 
									and flag = 0 )b
on  a.unit_code = b.unit_code 
                                    

select * from bass1.g_rule_check where rule_code in ('R170','R172','R161_14') order by time_id desc
 select * from  bass1.G_RULE_CHECK where rule_code = 'R159_3' order by 1 desc 

select * from   g_a_06001_day
select * from   bass1.g_rule_check where rule_code = 'R161_1'


select * from   bass1.g_rule_check where rule_code = 'R159_4'
and time_id / 100 = 201105


select PRODUCT_NO||IMSI||CITY_ID||OTHER_MSISDN||SMS_BILL_TYPE||CDR_USER_TYPE||SERV_CODE||SMS_FEE_TYPE||SMS_SEND_STATE||BASECALL_FEE||INFO_FEE||MONTH_FEE||INFO_LEN||SMS_CENTER_CODE||SMS_GATE_CODE||FRNT_GATE_CODE||APPLY_DATE||APPLY_TIME||GATE_DEAL_DATE||GATE_DEAL_TIME||BILL_DEAL_DATE||BILL_DEAL_TIME from bass1.g_s_04014_day where time_id=20110929


  select count(0)
                from bass1.g_s_22091_day where TIME_ID = 20110930
                and  channel_id not in
                        (select char(CHANNEL_ID)
                        from bass2.ods_channel_info_20110930 a where a.channel_type_class in (90105,90102)
                        union
                        select char(a.channel_id)
                from bass2.dim_channel_info a
                 where a.channel_type_class in (90105,90102)
                  and replace(char(date(DONE_DATE)),'-','') like '201109%'
                  and a.USER_STATE = 1
                        )


select * from    bass1.g_s_22091_day     where TIME_ID = 20110930

table(select a.*
from g_a_02064_day a 
join g_a_02054_day b on a.enterprise_id = b.enterprise_id)



                                select a.cnt*1.00 ,value(b.income,0) income
                                from
                                (select count(0) cnt
                                                        from 
                                                        (
                                                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                                                        from (
                                                        select *
                                                        from table(select a.*
from g_a_02064_day a 
join g_a_02054_day b on a.enterprise_id = b.enterprise_id) a
 where 
                                                         time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1520'
                                                         and MANAGE_MODE = '3'
                                                        ) t 
                                                        ) t2 where rn = 1 and STATUS_ID ='1'
                                ) a,(
                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201105
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                union all 
                                select sum(bigint(income)) income from   g_s_03018_month
                                where time_id = 201105
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                ) t 
                                ) b 
                        with ur                     


  select count(0)
from bass1.g_s_22092_day where TIME_ID = 20110930
and  channel_id not in 
                        (select char(a.channel_id)
                        from bass2.ods_channel_info_20110930 a where a.channel_type_class in (90105,90102)
                        union 
                        select char(a.channel_id)
                from bass2.dim_channel_info a
                 where a.channel_type_class in (90105,90102)
                  and replace(char(date(DONE_DATE)),'-','') like '201109%'
                  and a.USER_STATE = 1
                        )




select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (8)
and type = 'm'


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 
                        
select * from  table( bass1.get_task('market_0135')) a 
                        
                        INT_02004_02008_YYYYMM.tcl

BASS1_INT_02004_02008_YYYYMM.tcl	生成02004,02008的增量数据

select * from                      app.sch_control_task 
where control_code = 'BASS1_INT_02004_02008_YYYYMM.tcl'
  select * from app.sch_control_runlog where control_code in (
select before_control_code from                      app.sch_control_before
where control_code = 'BASS1_G_S_21007_DAY.tcl'
)

  CONTROL_CODE	BEGINTIME	ENDTIME	RUNTIME	FLAG
BASS2_Dw_product_bass1_ds.tcl	2011-07-02 2:56:45.658511	2011-07-02 2:58:26.985008	101	0

select * from   bass2.etl_load_table_map
where TABLE_NAME_TEMPLET  like '%INT%'

select * from INT_02004_02008_201109 fetch first 10 rows only  

select * from syscat.tables where tabname like '%INT_02004_02008%'
   
   

CREATE TABLE "BASS1   "."INT_02004_02008_201107"  (
                  "OP_TIME" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "USERTYPE_ID" CHAR(4) NOT NULL , 
                  "BRAND_FLAG" INTEGER NOT NULL , 
                  "USERTYPE_FLAG" INTEGER NOT NULL )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



BASS1 INT_21007_201107   

 

CREATE TABLE "BASS1   "."INT_21007_201107"  (
                  "OP_TIME" INTEGER , 
                  "PRODUCT_NO" VARCHAR(13) , 
                  "BRAND_ID" CHAR(1) , 
                  "SVC_TYPE_ID" CHAR(2) , 
                  "CDR_TYPE_ID" CHAR(2) , 
                  "END_STATUS" CHAR(1) , 
                  "ADVERSARY_ID" CHAR(6) , 
                  "SMS_COUNTS" DECIMAL(14,2) , 
                  "SMS_BASE_FEE" DECIMAL(14,2) , 
                  "SMS_INFO_FEE" DECIMAL(14,2) , 
                  "SMS_MONTH_FEE" DECIMAL(14,2) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "PRODUCT_NO",  
                 "BRAND_ID",  
                 "SVC_TYPE_ID",  
                 "CDR_TYPE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


"BASS1.INT_22038_201107" 



CREATE TABLE "BASS1   "."INT_22038_201107"  (
                  "OP_TIME" INTEGER NOT NULL , 
                  "BRAND_ID" INTEGER NOT NULL , 
                  "USER_ID" VARCHAR(20) NOT NULL )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


ALTER TABLE BASS1.INT_02004_02008_201107
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
select * from    bass1.int_21007_201107






  select count(0)
                from bass1.g_s_22091_day where TIME_ID = 20110701
                and  channel_id not in 
                        (select CHANNEL_ID 
                        from g_i_06021_month where time_id = 201107
                        union 
                        select char(a.channel_id)
                from bass2.dim_channel_info a
                 where a.channel_type_class in (90105,90102)
                  and replace(char(date(DONE_DATE)),'-','') like '201107%'
                  and a.USER_STATE = 1
                        )


  select count(0)
                from bass1.g_s_22091_day where TIME_ID = 20110701
                and  channel_id not in
                        (select char(CHANNEL_ID)
                        from bass2.ods_channel_info_20110701 a where a.channel_type_class in (90105,90102)
                        union
                        select char(a.channel_id)
                from bass2.dim_channel_info a
                 where a.channel_type_class in (90105,90102)
                  and replace(char(date(DONE_DATE)),'-','') like '201109%'
                  and a.USER_STATE = 1
                        )



  select count(0)
from bass1.g_s_22092_day where TIME_ID = 20110701
and  channel_id not in 
                        (select char(a.channel_id)
                        from bass2.ods_channel_info_20110701 a where a.channel_type_class in (90105,90102)
                        union 
                        select char(a.channel_id)
                from bass2.dim_channel_info a
                 where a.channel_type_class in (90105,90102)
                  and replace(char(date(DONE_DATE)),'-','') like '201109%'
                  and a.USER_STATE = 1
                        )
                        
update app.sch_control_alarm 
set flag = 0
where control_code = 'BASS1.INT_21007_YYYYMM.tcl'
and date (alarmtime ) = '2011-07-02'
and flag = -1
                        
                        
                        select count(0) from   BASS1.INT_21007_201107
                        1096923
                                                select count(0) from   BASS1.INT_21007_201109 where op_time = 20110901
                                                
1035313



select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
 type = 'd'
 and sts = 1
 and 


select time_id , count(0) from   BASS1.G_USER_LST
group by time_id 



select * from    bass1.MON_ALL_INTERFACE where interface_code = '04002'

BASS1_G_S_04002_DAY.tcl

select * from  table( bass1.get_before('BASS1_INT_CHECK_R028_MONTH.tcl')) a 




select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num = '15913269062'
and send_time >=  current timestamp - 1 days
order by send_time desc 


select op_time,count(0) from   BASS2.Dw_enterprise_industry_apply
group by op_time

select * from bass2.Dw_enterprise_industry_apply fetch first 10 rows only  

select * from  table( bass1.get_after('03018')) a 



select * from     bass2.ods_cust_cm_vip_info_20110731 where PRODUCT_INSTANCE_ID = '89460000740915'


BASS1_G_S_03013_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_03014_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_03017_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_03018_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_22013_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_22037_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_22302_DAY.tcl	BASS2_Dw_enterprise_industry_apply.tcl
BASS1_G_S_22303_MONTH.tcl	BASS2_Dw_enterprise_industry_apply.tcl


select * from   G_S_22302_DAY where time_id = 20110930

select * from   G_S_22302_DAY where time_id = 20110901




select 
 b.* 
 , lower(
 '*'||b.interface_code||'*.dat \' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (15)
and type = 'm'
and sts = 1



select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (10)
and type = 'm'
and sts = 1




select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (15)
and type = 'm'
and sts = 1


select * from   bass1.mon_all_interface where interface_code = '22059'
select count(0) from    g_i_03001_month where time_id = 201109

select count(0) from    g_i_03001_month where time_id = 201105
4688229
select count(0) from    bass2.dw_acct_msg_201105
4688229
select count(0) from    bass2.dw_acct_msg_201109

4786605
 4786605 i_13100_201109_03001_00_001.dat
 



select * from   mon_all_interface where interface_code = '03005'

ods_channel_info_$timpstamp


  select count(0)
                from bass1.g_s_22091_day where TIME_ID = 20110702
                and  channel_id not in
                        (select CHANNEL_ID
                        from g_i_06021_month where time_id = 201109
                        union
                        select char(a.channel_id)
                from bass2.ods_channel_info_20110702 a
                 where a.channel_type_class in (90105,90102)
                  and a.USER_STATE = 1
                        )

select * from   G_A_06001_DAY where time_id = 20110702


select value(city_id,substr(SCHOOL_ID,4,3)) from    bass2.Dim_xysc_maintenance_info

                        

       select 
               20110702  TIME_ID
        ,SCHOOL_ID
        ,SCHOOL_NAME
        ,CMCC_BRANCH_ID
        ,SCHOOL_TYPE
        ,STUD_CNT
        ,NEWSTUD_CNT
        ,'1' STATE 
from table(        
        select distinct 
         SCHOOL_ID
        ,SCHOOL_NAME
        ,case when value(city_id,substr(SCHOOL_ID,4,3)) = '891' then '13101'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '892' then '13102'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '893' then '13103'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '894' then '13104'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '895' then '13105'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '896' then '13106'
                              when value(city_id,substr(SCHOOL_ID,4,3)) = '897' then '13107'
                        end CMCC_BRANCH_ID
        ,case when school_type in ('4','5') then '1' else '2' end SCHOOL_TYPE
        ,char(SCH_SIZE_STUS) STUD_CNT
        ,'0' NEWSTUD_CNT 
from      bass2.Dim_xysc_maintenance_info
except
select 
         SCHOOL_ID
        ,SCHOOL_NAME
        ,CMCC_BRANCH_ID
        ,SCHOOL_TYPE
        ,STUD_CNT
        ,NEWSTUD_CNT
from ( 
                        select a.*
                        ,row_number()over(partition by SCHOOL_ID order by time_id desc ) rn 
                  from G_A_06001_DAY a 
                  where time_id < 20110702
     ) o where o.rn = 1
) t     

                        

INT_02004_02008_201107
INT_21007_201107
INT_22038_201107


select tabname from syscat.tables where tabname like '%INT_02004_02008%'                           





CREATE TABLE "BASS1   "."INT_02004_02008_YYYYMM"  (
                  "OP_TIME" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "USERTYPE_ID" CHAR(4) NOT NULL , 
                  "BRAND_FLAG" INTEGER NOT NULL , 
                  "USERTYPE_FLAG" INTEGER NOT NULL )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



BASS1 INT_21007_201107   

 

CREATE TABLE "BASS1   "."INT_21007_YYYYMM"  (
                  "OP_TIME" INTEGER , 
                  "PRODUCT_NO" VARCHAR(13) , 
                  "BRAND_ID" CHAR(1) , 
                  "SVC_TYPE_ID" CHAR(2) , 
                  "CDR_TYPE_ID" CHAR(2) , 
                  "END_STATUS" CHAR(1) , 
                  "ADVERSARY_ID" CHAR(6) , 
                  "SMS_COUNTS" DECIMAL(14,2) , 
                  "SMS_BASE_FEE" DECIMAL(14,2) , 
                  "SMS_INFO_FEE" DECIMAL(14,2) , 
                  "SMS_MONTH_FEE" DECIMAL(14,2) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "PRODUCT_NO",  
                 "BRAND_ID",  
                 "SVC_TYPE_ID",  
                 "CDR_TYPE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


"BASS1.INT_22038_201107" 



CREATE TABLE "BASS1   "."INT_22038_YYYYMM"  (
                  "OP_TIME" INTEGER NOT NULL , 
                  "BRAND_ID" INTEGER NOT NULL , 
                  "USER_ID" VARCHAR(20) NOT NULL )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

select * from   INT_21007_201108

select * from   
INT_02004_02008_201108





    select 
        (select  count(distinct user_id||ADD_PKG_ID) cnt from bass1.g_i_02023_day a where time_id = 20110930 )                     
         - (select  count(distinct user_id||OVER_PROD_ID) cnt from bass1.g_i_02021_month a where time_id = 201109 and  OVER_PROD_ID like 'QW_QQT_DJ%')
         from bass2.dual
        with ur 
        
        

select  distinct user_id||ADD_PKG_ID   from bass1.g_i_02023_day a where time_id = 20110930 
except
select  distinct user_id||OVER_PROD_ID from bass1.g_i_02021_month a where time_id = 201109 and  OVER_PROD_ID like 'QW_QQT_DJ%'
        

89160000920148 

        
select * from    bass1.g_i_02021_month a where time_id = 201109        
and user_id = '89160000920148'

OVER_PROD_ID
111090004095                  
111089140007                  
111090002601                  
111090009610                  


select * from bass2.ODS_PROD_UP_PRODUCT_ITEM_20110930
where product_item_id in (111090004095,111089140007,111090002601,111090009610)


select  a.*,b.NAME from bass2.Dw_product_ins_off_ins_prod_ds a, bass2.ODS_PROD_UP_PRODUCT_ITEM_20110930 b
where a.offer_id = b.product_item_id
and a.PRODUCT_INSTANCE_ID = '89160000920148'



                        select 
                        distinct 
                                USER_ID
                                ,ADD_PKG_ID
                                ,VALID_DT
                        FROM (
                                SELECT
                                 a.PRODUCT_INSTANCE_ID as USER_ID
                                ,bass1.fn_get_all_dim_ex('BASS_STD1_0115',char(a.offer_id)) as ADD_PKG_ID
                                ,replace(char(date(a.VALID_DATE)),'-','') as VALID_DT 
                                ,row_number()over(partition by a.PRODUCT_INSTANCE_ID,a.offer_id 
                                        order by EXPIRE_DATE desc ,VALID_DATE desc  ) rn 
                                from  bass2.Dw_product_ins_off_ins_prod_ds a 
                                     ,(select xzbas_value  as offer_id 
                                        from  BASS1.ALL_DIM_LKP 
                                        where BASS1_TBID = 'BASS_STD1_0115'
                                              and bass1_value like 'QW_QQT_DJ%'
                                      ) b 
                                where char(a.offer_id) = b.offer_id 
                                and a.state=1
                                and a.valid_type = 1 
                                 and a.OP_TIME = '2011-07-02'
                                 and date(a.VALID_DATE)<='2011-07-02'
                                 and date(a.expire_date)>='2011-07-02'
                            ) AS T where t.rn = 1 
                         with ur 
                         
select count(0) from    G_I_02023_DAY where time_id = 20110702
                         



  select * from
                (select * from 
                (
                select user_id,chg_vip_time,row_number()over(partition by user_id order by time_id desc) row_id from BASS1.G_I_02005_MONTH
                where time_id=201109
                ) k
                where k.row_id =1) a
                left outer join 
                (
                select * from
                (
                select user_id,create_date,row_number()over(partition by user_id order by time_id desc) row_id 
                from BASS1.G_A_02004_DAY
                where time_id<=20110930
                ) k
                where k.row_id=1) b
                on a.user_id=b.user_id
                where bigint(chg_vip_time)<bigint(create_date)
                with ur
                


USER_ID	CHG_VIP_TIME	ROW_ID	USER_ID	CREATE_DATE	ROW_ID
89460000740915      	20110320	1	89460000740915      	20110321	1



update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20100917'
where user_id = '89160000265019'
and time_id = 201109


update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110321'
where user_id = '89460000740915'
and time_id = 201109


                         
                         

select a.tabname,decimal(float(a.npages)/(1024/(b.pagesize/1024)),9,2) as used_mb
from syscat.tables a,syscat.tablespaces b where a.tbspace = b.tbspace
and a.tabname = 'G_S_04002_DAY'
                         
select * from   G_S_04002_DAY where time_id = 20110702



    rename BASS1.G_S_04002_DAY to G_S_04002_DAY_BAK
    create table BASS1.G_S_04002_DAY like BASS1.G_S_04002_DAY_BAK 
     DISTRIBUTE BY HASH(TIME_ID,  
                 PRODUCT_NO,  
                 ROAM_LOCN,  
                 ROAM_TYPE_ID,  
                 APNNI,  
                 START_TIME)   
     IN TBS_APP_BASS1 INDEX IN TBS_INDEX 
                   
	  insert into BASS1.G_S_04002_DAY 
	  select * from  BASS1.G_S_04002_DAY_BAK
	  where time_id >= 20110401
	  --about 15min
	 db2 RUNSTATS ON TABLE BASS1.G_S_04002_DAY	with distribution and detailed indexes all  
	  drop table BASS1.G_S_04002_DAY_BAK



delete from BASS1.G_S_04005_DAY where time_id < 20110401
89178017 row(s) affected.
db2 RUNSTATS ON TABLE BASS1.G_S_04005_DAY	with distribution and detailed indexes all  


delete from BASS1.G_S_21003_MONTH where time_id < 201104

db2 RUNSTATS ON TABLE BASS1.G_S_21003_MONTH	with distribution and detailed indexes all  

G_S_21008_MONTH


delete from BASS1.G_S_21008_MONTH where time_id < 201104

db2 RUNSTATS ON TABLE BASS1.G_S_21008_MONTH	with distribution and detailed indexes all  

    BASS1_INT_02004_02008_YYYYMM.tcl
    BASS1_INT_22038_YYYYMM.tcl
    BASS1.INT_21007_YYYYMM.tcl
    BASS1_INT_0400810_YYYYMM.tcl
    BASS1_INT_210012916_YYYYMM.tcl


select tabname from syscat.tables where tabname like '%INT_02004_02008%'   

delete from BASS1.G_S_21008_MONTH where time_id < 201104

db2 RUNSTATS ON TABLE BASS1.G_S_21008_MONTH	with distribution and detailed indexes all  

select * from    BASS1.MON_ALL_INTERFACE  where interface_code = '22063'                         


三、定期清理固定中间表
    G_S_21003_TO_DAY  保持1+1的数据
    G_S_21008_TO_DAY  保持1+1的数据
  
select * from G_S_21003_TO_DAY fetch first 10 rows only    
  
delete from BASS1.G_S_21003_TO_DAY where time_id < 20110401
db2 RUNSTATS ON TABLE BASS1.G_S_21003_TO_DAY	with distribution and detailed indexes all  

delete from BASS1.G_S_21008_TO_DAY where time_id < 20110401
db2 RUNSTATS ON TABLE BASS1.G_S_21008_TO_DAY	with distribution and detailed indexes all  

  
  select * from   
BASS1.MON_ALL_INTERFACE
 where type = 'm'
 and deadline = 5
 
 
 select * from  G_I_06002_MONTH where time_id = 201109
 
   select distinct 
  			 201109
        ,SCHOOL_ID
        ,value(CELL_ID,'0') CELL_ID
        ,value(LAC_ID,'0') LAC_ID        
	from bass2.Dim_xysc_maintenance_info

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22063_MONTH 
group by  time_id 
order by 1 

select count(0) from    bass2.stat_channel_reward_0002

                  SELECT
                           201109
                                ,'201109'
                                ,trim(char(a.CHANNEL_ID))
                                ,char(bigint( sum(case when t_index_id in (1,4,14) then result else 0 end )                 ))
                                ,char(bigint( sum(case when t_index_id in (10,11,12,13,19,20,21) then result else 0 end )   ))
                                ,char(bigint( sum(case when t_index_id in (7) then result else 0 end )                      ))
                                ,'0'
                                ,'0'
                                ,'0'
                        FROM BASS2.DW_CHANNEL_INFO_201109 A
                        inner join bass2.stat_channel_reward_0002 b on a.channel_id=b.channel_id
                        WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102) 
                                                and b.op_time=201109
                                                AND B.result>0
                        group by trim(char(a.CHANNEL_ID))
                        
    
select * from   bass2.stat_channel_reward_0002
                    
    
    select count(0) from    BASS2.DW_CHANNEL_INFO_201109 
        select * from    BASS2.DW_CHANNEL_INFO_201109 



select CHANNEL_TYPE_CLASS , count(0) 
--,  count(distinct CHANNEL_TYPE_CLASS ) 
from BASS2.DW_CHANNEL_INFO_201109 
group by  CHANNEL_TYPE_CLASS 
order by 1 

CHANNEL_TYPE_CLASS	2
90106	4
90109	8
90110	10
90108	15
1	54
90107	118
90105	146
90102	7333


select * from   app.sch_control_runlog_his
where control_code like '%REP_stat_channel_reward_0002.tcl%'

select control_code  from  table( bass1.get_task('21020')) a 

REP_stat_channel_reward_0002.tcl


update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201108
)



--月接口
select count(0),count(distinct user_id) from    bass1.g_i_02020_month 
	where time_id = 201109
and base_prod_id like '%QQT%'
1	2
15216	15216

--月接口离网客户数
select count(0),count(distinct user_id) from    bass1.g_i_02020_month where time_id = 201105
and base_prod_id like '%QQT%'



--日接口
select count(0),count(distinct user_id) from    bass1.g_i_02022_day
where time_id = 20110930

--2172	2172

1	2
15216	15216


select count(0)
from 
(
select  user_id from    bass1.g_i_02020_month where time_id = 201109
and base_prod_id like '%QQT%'
) a , BASS1.g_a_02004_02008_stage b 
where a.user_id = b.user_id 
 and  b.usertype_id NOT IN ('2010','2020','2030','9000')




--生成5月月末一经用户数据
drop table BASS1.g_a_02004_02008_stage;
CREATE TABLE BASS1.g_a_02004_02008_stage
 (
    user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
)
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING;

ALTER TABLE BASS1.g_a_02004_02008_stage
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  



--抓取用户资料入表
insert into bass1.g_a_02004_02008_stage (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110531 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110531 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1


  
  
  select * 
                        from g_i_06021_month where time_id = 201109
                        

                        values 1.000 * 1648305 / 1672966

insert into app.sch_control_before 
values('BASS1_EXP_G_S_02047_MONTH',	'BASS1_INT_CHECK_R229_MONTH.tcl')

select * from   
                         app.sch_control_before 
                         where control_code = 'BASS1_EXP_G_S_02047_MONTH'

                         
select * from   bass1.g_rule_check 
where 
rule_code in (
'R240'
,'R241'
,'R242'
,'R243'
,'R246'
,'R247'
,'R250'
,'R251'
,'R252'
,'R253'
,'R254'
)                      
order by 1 desc ,2

   
   
   select * from   bass1.g_rule_check 
where  rule_code between 'R238' and 'R254'
order by 1 desc ,2


select rule_code,count(0)
from  bass1.g_rule_check 
where time_id /100 = 201109
group by rule_code
having count(0) > 30


RULE_CODE	2
R010	32
R198	31
R200	31
R203	31
R204	31
R205	31
R207	31


-rwxrwxrwx+  1 bass1    appdb       5725  6月  2日 03:10 INT_CHECK_R025_MONTH.tcl
-rwxrwxrwx+  1 bass1    appdb       5347  6月  2日 03:10 INT_CHECK_0205202008_MONTH.tcl
-rw-r--r--   1 bass1    appdb       2171  6月  2日 03:10 INT_CHECK_R181_MONTH.tcl
-rw-r--r--   1 bass1    appdb       2180  6月  3日 17:35 INT_CHECK_R192_MONTH.tcl
-rw-r--r--   1 bass1    appdb       4847  6月  5日 19:54 INT_CHECK_R208_MONTH.tcl
-rw-r--r--   1 bass1    appdb       5452  6月  6日 22:49 INT_CHECK_R235_MONTH.tcl
-rw-r--r--   1 bass1    appdb       2671  6月 16日 15:22 INT_CHECK_R229_MONTH.tcl
-rw-r--r--   1 bass1    appdb       3206  7月  1日 11:59 INT_CHECK_R216_MONTH.tcl
-rw-r--r--   1 bass1    appdb       9327  7月  1日 11:59 INT_CHECK_R230_MONTH.tcl
-rwxrwxrwx+  1 bass1    appdb      12158  7月  3日 16:15 INT_CHECK_06031_MONTH.tcl
-rw-r--r--   1 bass1    appdb      13265  7月  3日 16:22 INT_CHECK_R221_MONTH.tcl
-rw-r--r--   1 bass1    appdb      10513  7月  3日 17:27 INT_CHECK_R238_MONTH.tcl
   select * from   bass1.g_rule_check 
where rule_code = 'R235'
AND TIME_ID = 201109


   select * from   bass1.g_rule_check 
where rule_code = 'R234'

values ((16894+132)*1.000/17026 - 1)



                        select count(0) cnt
                        from 
                        (
                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                        from (
                        select *
                        from g_a_02054_day where  time_id <= 20110702 
                                        and ENTERPRISE_BUSI_TYPE in ('1040')
                                                and MANAGE_MODE = '3'
                        ) t 
                        ) t2 where rn = 1 and STATUS_ID ='1'
                        
                        

                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02059_DAY
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1000','1010')                               
                                                and time_id <= 20110531
                                                and MANAGE_MODE = '3'
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
                                
select tabname from syscat.tables where tabname like '%02059%'                                   



select count(0),count(distinct control_code) from   app.sch_control_runlog_his 
where control_code like 'BASS1%'
and date(begintime) >= '2011-07-01'
and flag = 0

select * 
from (
select a.*,row_number()over(partition by control_code order by runtime desc ) rn 
from  app.sch_control_runlog_his a
where control_code like 'BASS1%'
and date(begintime) >= '2011-07-01'
and flag = 0
) t 
where t.rn=1



select  *
from (
select a.*,row_number()over(partition by control_code order by runtime desc ) rn 
from  app.sch_control_runlog_his a
where control_code like 'BASS1%'
and date(begintime) < '2011-07-01'
and date(begintime) >= '2011-06-01'
and flag = 0
) t 
where t.rn=1


select a.CONTROL_CODE , a.RUNTIME , b.runtime,a.RUNTIME-b.runtime
from table(select * 
from (
select a.*,row_number()over(partition by control_code order by runtime desc ) rn 
from  app.sch_control_runlog_his a
where control_code like 'BASS1%'
and date(begintime) >= '2011-07-01'
and flag = 0
) t 
where t.rn=1) a
,
table(select  *
from (
select a.*,row_number()over(partition by control_code order by runtime desc ) rn 
from  app.sch_control_runlog_his a
where control_code like 'BASS1%'
and date(begintime) < '2011-07-01'
and date(begintime) >= '2011-06-01'
and flag = 0
) t 
where t.rn=1) b where a.control_code = b.control_code 
and a.CONTROL_CODE like '%MONTH%'




   select * from   bass1.g_rule_check 
where rule_code = 'R055'
AND TIME_ID  >= 201101

 select count(distinct a.user_id)
                                                                 from BASS1.G_I_02049_MONTH a
                                                                 left join (select distinct user_id from bass1.G_A_02004_DAY where time_id<=20110930) b  on a.user_id = b.user_id
                                                                 where a.time_id=201109
                                                                       and b.user_id is null
                                                                       
                                                                       
                                                                       
                                                                       

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02016_MONTH 
group by  time_id 
order by 1 

                                                                       select * from    G_I_02016_MONTH
                                                                       where time_id = 201109
                                                                       
                                                                       

select time_id , count(0) 
--,  count(distinct time_id ) 
from g_i_02019_month 
group by  time_id 
order by 1 
                                                                       



CREATE TABLE "BASS1   "."INT_0400810_YYYYMM"  (
                  "OP_TIME" INTEGER NOT NULL , 
                  "BRAND_ID" SMALLINT NOT NULL , 
                  "DRTYPE_ID" INTEGER NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "MSRN" CHAR(11) NOT NULL , 
                  "IMEI" CHAR(17) NOT NULL , 
                  "OPPOSITE_NO" CHAR(24) NOT NULL , 
                  "THIRD_NO" CHAR(24) NOT NULL , 
                  "CITY_ID" CHAR(6) NOT NULL , 
                  "ROAM_LOCN" CHAR(6) NOT NULL , 
                  "OPP_CITY_ID" CHAR(6) NOT NULL , 
                  "OPP_ROAM_LOCN" CHAR(6) NOT NULL , 
                  "ADVERSARY_ID" CHAR(6) NOT NULL , 
                  "ADVERSARY_NET_TYPE" CHAR(2) NOT NULL , 
                  "MSC_CODE" CHAR(11) NOT NULL , 
                  "CELL_ID" CHAR(10) NOT NULL , 
                  "LAC_ID" CHAR(10) NOT NULL , 
                  "OPP_CELL_ID" CHAR(10) NOT NULL , 
                  "OPP_LAC_ID" CHAR(10) NOT NULL , 
                  "OUTGO_TRNK" CHAR(15) NOT NULL , 
                  "INCOMING_TRNK" CHAR(15) NOT NULL , 
                  "START_DATE" CHAR(8) NOT NULL , 
                  "START_TIME" CHAR(6) NOT NULL , 
                  "CALL_DURATION" CHAR(6) NOT NULL , 
                  "BASE_BILL_DURATION" CHAR(6) NOT NULL , 
                  "TOLL_BILL_DURATION" CHAR(6) NOT NULL , 
                  "BILLING_ID" CHAR(1) NOT NULL , 
                  "BASE_CALL_FEE" CHAR(8) NOT NULL , 
                  "TOLL_CALL_FEE" CHAR(8) NOT NULL , 
                  "CALLFW_TOLL_FEE" CHAR(8) , 
                  "INFO_FEE" CHAR(8) NOT NULL , 
                  "BALANCE_FEE" CHAR(8) NOT NULL , 
                  "FAV_BASE_CALL_FEE" CHAR(8) NOT NULL , 
                  "FAV_TOLL_CALL_FEE" CHAR(8) NOT NULL , 
                  "FAV_CALLFW_TOLL_FEE" CHAR(8) , 
                  "FAV_INFO_FEE" CHAR(8) NOT NULL , 
                  "ROAM_TYPE_ID" CHAR(3) NOT NULL , 
                  "TOLL_TYPE_ID" CHAR(3) NOT NULL , 
                  "SVCITEM_ID" CHAR(3) NOT NULL , 
                  "CALL_TYPE_ID" CHAR(2) NOT NULL , 
                  "SERVICE_CODE" CHAR(4) NOT NULL , 
                  "USER_TYPE" CHAR(1) NOT NULL , 
                  "FEE_TYPE" CHAR(1) NOT NULL , 
                  "INNER_ID" CHAR(24) NOT NULL , 
                  "OPER_INNER_ID" CHAR(24) NOT NULL , 
                  "VPMN_GRP_ID" CHAR(20) NOT NULL , 
                  "SCP_ID" CHAR(3) NOT NULL , 
                  "END_CALL_TYPE" CHAR(1) NOT NULL , 
                  "VIDEO_TYPE" CHAR(1) , 
                  "MNS_TYPE" CHAR(1) )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "PRODUCT_NO")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


    BASS1.INT_21007_YYYYMM.tcl
    BASS1_INT_0400810_YYYYMM.tcl
    BASS1_INT_210012916_YYYYMM.tcl
    
    
                                                                       

CREATE TABLE "BASS1   "."INT_210012916_YYYYMM"  (
                  "OP_TIME" INTEGER , 
                  "USER_ID" VARCHAR(20) , 
                  "PRODUCT_NO" VARCHAR(15) , 
                  "BRAND_ID" BIGINT , 
                  "SVC_TYPE_ID" VARCHAR(5) , 
                  "TOLL_TYPE_ID" CHAR(3) , 
                  "IP_TYPE_ID" VARCHAR(16) , 
                  "ADVERSARY_ID" VARCHAR(6) , 
                  "ROAM_TYPE_ID" CHAR(3) , 
                  "CALL_TYPE_ID" CHAR(2) , 
                  "CALL_COUNTS" BIGINT , 
                  "BASE_BILL_DURATION" BIGINT , 
                  "TOLL_BILL_DURATION" BIGINT , 
                  "CALL_DURATION" BIGINT , 
                  "BASE_CALL_FEE" BIGINT , 
                  "TOLL_CALL_FEE" BIGINT , 
                  "CALLFW_TOLL_FEE" BIGINT , 
                  "CALL_FEE" BIGINT , 
                  "FAVOURED_BASECALL_FEE" BIGINT , 
                  "FAVOURED_TOLLCALL_FEE" BIGINT , 
                  "FAVOURED_CALLFW_TOLLFEE" BIGINT , 
                  "FAVOURED_CALL_FEE" BIGINT , 
                  "FREE_DURATION" BIGINT , 
                  "FAVOUR_DURATION" BIGINT , 
                  "CALLMOMENT_ID" CHAR(3) , 
                  "SVCITEM_ID" VARCHAR(16) , 
                  "MNS_TYPE" INTEGER , 
                  "OPP_PROPERTY" INTEGER )   
                 DISTRIBUTE BY HASH("OP_TIME",  
                 "USER_ID",  
                 "PRODUCT_NO")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select * from   mon_all_interface where interface_code = '02016'                                                                       
select count(0),count(distinct user_id ) from   g_i_02016_month where time_id = 201109
 
select user_id,count(0) from    g_i_02016_month where time_id = 201109
group by user_id 
having count(0) > 1
89157334068705      	2

89157334068705      	2

89157334068705      	2
89157334068705      	2


select count(0),count(distinct user_id ) from     g_i_02016_month where time_id = 201109

select * from   g_i_02016_month where time_id = 201109
and user_id = '89157334068705'

TIME_ID	PROD_ID	USER_ID	VALID_DATE
201109	108	89157334068705      	20110901
201109	107	89157334068705      	20110901

delete from g_i_02016_month
where user_id = '89157334068705'
and PROD_ID = '107'
and time_id = 201109



                select
                    201109,
                        case when b.prod_id in(90030036,90008120) then '106'
                             when b.prod_id in(90030031,90008121) then '107'
                             when b.prod_id in(90030024,90008122) then '108'
                             when b.prod_id in(90005000,90005001,90005002,90005003,90005004,90005005) then '300'
                         end prod_id,
                         a.user_id,
                         replace(char(date(a.valid_date)),'-','') valid_date
                from bass2.dwd_product_sprom_active_20110930 a,
                         bass2.dim_product_item b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)
                  and replace(char(date(a.valid_date)),'-','')<='20110930'
                  and replace(char(date(a.expire_date)),'-','')>'20110930'
                  
                  
select *    
                from bass2.dwd_product_sprom_active_20110930 a,
                         bass2.dim_product_item b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)     
                  and a.user_id = '89157334068705'                  
                  

USER_ID
89157334068705
89157334068705


                  
select * from    bass2.Dw_product_ins_off_ins_prod_ds 
where product_instance_id = '89157334068705'


	107：50元/月包40小时
	108：100元/月包200小时

                  
	107：50元/月包40小时
	108：100元/月包200小时

\                  
select  a.*,b.NAME from bass2.Dw_product_ins_off_ins_prod_ds a, bass2.ODS_PROD_UP_PRODUCT_ITEM_20110930 b
where a.offer_id = b.product_item_id
and a.PRODUCT_INSTANCE_ID = '89157334068705'



delete from 

TR1_L_11042

select * from   app.sch_control_task where control_code = 'TR1_L_11042'

select count(0) from   bass2.ODS_PM_SP_OPERATOR_CODE_201109

6442249

select count(0) from   bass2.ODS_PM_SP_OPERATOR_CODE_201105

6374985



select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 3 days
and control_code = 'TR1_L_11042'
order by alarmtime desc 



select tabname from syscat.tables where tabname like '%02059%'   

CREATE TABLE "BASS1   "."G_A_02059_DAY_DOWN20110531"  (
                  "TIME_ID" VARCHAR(1) , 
                  "ENTERPRISE_ID" VARCHAR(20) , 
                  "USER_ID" VARCHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" VARCHAR(4) , 
                  "MANAGE_MODE" VARCHAR(1) , 
                  "ORDER_DATE" VARCHAR(8) , 
                  "STATUS_ID" VARCHAR(1) )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 




                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by enterprise_id,user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02059_DAY_DOWN20110531
                                                where 
                                                                 ENTERPRISE_BUSI_TYPE  in ('1000','1010')                               
                                                and time_id <= '20110531'
                                                and MANAGE_MODE = '3'
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
79021                                

                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02059_DAY
                                                where 
                                                                time_id <= 20110531
                                                and MANAGE_MODE = '3'
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'
79021

                                
378395
                                


                                select count(0)
                                from 
                                (
                                                select t.*,row_number()over(partition by user_id order by time_id desc ) rn 
                                                from 
                                                (
                                                select * from G_A_02059_DAY_DOWN20110531
                                                where 
                                                                 time_id <= '20110531'
                                                and MANAGE_MODE = '3'
                                                ) t
                                ) t2
                                where rn = 1 and STATUS_ID ='1'

213338


select * from   G_A_02059_DAY
where 
   ENTERPRISE_BUSI_TYPE  in ('1000','1010')
order by 1 desc 


                                

SELECT name,npages,fpages FROM SYSIBM.SYSTABLES --where tbspace='TBS_CDR_DATA'where tbspace='TBS_APP_BASS1'--and name like '%_BAKNGGJ'--order by nameorder by npages desc,fpages desc


INT_210012916_201105	1775730	1775730
INT_210012916_201104	1756875	1756875
INT_210012916_201103	1708305	1708305
INT_210012916_201101	1526400	1526400
drop table INT_210012916_201101




values 7502*1.00/1245749                                


drop table BASS1.int_02004_02008_month_stage;
CREATE TABLE BASS1.int_02004_02008_month_stage
 (
   user_id        CHARACTER(15),
   product_no     CHARACTER(15),
   test_flag      CHARACTER(1),
   sim_code       CHARACTER(15),
   usertype_id    CHARACTER(4),
   create_date    CHARACTER(15),
   brand_id       CHARACTER(4),
   time_id        int
 )
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (user_id
   ) USING HASHING;

ALTER TABLE BASS1.int_02004_02008_month_stage
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  
  


insert into app.sch_control_map
values
 (2,'INT_COMMON_ROUTINE_MONTH.tcl','BASS1_INT_COMMON_ROUTINE_MONTH.tcl')

  

delete from bass1.int_program_data where PROGRAM_NAME = 'INT_COMMON_ROUTINE_MONTH.tcl'
insert into bass1.int_program_data
select
SEQUENCE_ID
,PROGRAM_TYPE
,'INT_COMMON_ROUTINE_MONTH.tcl' PROGRAM_NAME
,'INT_COMMON_ROUTINE_MONTH.BASS1' SOURCE_DATA
,'INT_COMMON_ROUTINE_MONTH_e' OBJECTIVE_DATA
,'INT_COMMON_ROUTINE_MONTH_f' FINAL_DATA
from bass1.int_program_data
where PROGRAM_NAME = 'G_S_22204_MONTH.tcl'

  
  select count(0) from  BASS1.g_a_02004_02008_stage
  select count(0) from  int_02004_02008_month_stage
  
  
  
  insert into app.sch_control_before 
values
('BASS1_INT_COMMON_ROUTINE_MONTH.tcl','BASS1_G_A_02004_DAY.tcl')
,('BASS1_INT_COMMON_ROUTINE_MONTH.tcl','BASS1_G_A_02008_DAY.tcl')



insert into app.sch_control_before
values 
 ('BASS1_INT_CHECK_R235_MONTH.tcl','BASS1_INT_COMMON_ROUTINE_MONTH.tcl')
 
 
 
 
 
delete from app.sch_control_task where control_code in ('BASS1_EXP_INT_COMMON_ROUTINE_MONTH','BASS1_INT_COMMON_ROUTINE_MONTH.tcl');
insert into app.sch_control_task values ('BASS1_INT_COMMON_ROUTINE_MONTH.tcl',2,2,'int -s INT_COMMON_ROUTINE_MONTH.tcl',0,108,'月通用过程处理','app','BASS1',1,'/bassapp/bass1/tcl/');

insert into app.sch_control_task values ('BASS1_EXP_INT_COMMON_ROUTINE_MONTH',2,2,'bass1_export BASS1.INT_COMMON_ROUTINE_MONTH LASTMONTH()',0,-1,'EXPORT电子渠道登录信息','app','BASS1',1,'/bassapp/backapp/bin/bass1_export/');




select * from   bass1.G_RULE_CHECK where rule_code = 'R237'      
order by time_id desc 

select int(substr(ACCT_ITEM_ID,2))/100 from bass1.g_s_03004_month 



select * from   bass1.mon_all_interface where interface_name like '%渠道%'

select * from   G_S_21003_MONTH_mobile


select * from  table( bass1.get_task('INT_COMMON_ROUTINE_MONTH')) a 


select * from app.sch_control_task where control_code like '%INT_COMMON_ROUTINE_MONTH.tcl'

update  app.sch_control_task a
set time_value = 410
where control_code =  'BASS1_G_S_22085_MONTH.tcl'


select usertype_id , count(0) 
--,  count(distinct usertype_id ) 
from int_02004_02008_month_stage 
group by  usertype_id 
order by 1 


select count(0) from  BASS1.G_S_21003_MONTH_mobile 	 a 
,int_02004_02008_month_stage b 
where a.product_no = b.product_no
and  b.usertype_id NOT IN ('2010','2020','2030','9000')
 and not exists (select 1 from bass1.g_s_03004_month c  where c.time_id = $op_month
 and b.user_id= c.USER_ID and 
 ( int(substr(ACCT_ITEM_ID,2))/100 in (1,2,3)
 		or ACCT_ITEM_ID in ('0401','0403','0407')
 )
 )
 
 select count(0)
 from
 (
 select distinct user_id from 
  BASS1.G_S_21003_MONTH_mobile 	 a 
,int_02004_02008_month_stage b 
where a.product_no = b.product_no
and  b.usertype_id NOT IN ('2010','2020','2030','9000')
) a 
left join 
(select user_id
from g_s_03004_month
where time_id = 201105 
and 
 ( int(substr(ACCT_ITEM_ID,2))/100 in (1,2,3)
 		or ACCT_ITEM_ID in ('0401','0403','0407')
 )
 group by user_id having sum(bigint(FEE_RECEIVABLE)) > 0
 ) b 
 on  a.user_id = b.user_id 
 where b.user_id is  null 
 

select count(0) from    int_02004_02008_month_stage
where usertype_id  IN ('1010')


		select count(0) val1 
		from   int_02004_02008_month_stage a
		left join 
		(		select user_id
				from g_s_03004_month
				where time_id = 201105 
				and 
				 ( int(substr(ACCT_ITEM_ID,2))/100 in (1,2,3)
				 		or ACCT_ITEM_ID in ('0401','0403','0407')
				 )
				 group by user_id 
				 having sum(bigint(FEE_RECEIVABLE)) > 0
		) b  on  a.user_id = b.user_id
 where b.user_id is  null 
		 and a.usertype_id  IN ('1010')
         

select * from   g_s_03004_month
         

                select count(0) val1 
                from  (select user_id from  int_02004_02008_month_stage 
                            where usertype_id  IN ('1010') and  TEST_FLAG = '0'
                    ) a
                left join 
                (               select user_id
                                from g_s_03004_month
                                where time_id = 201105 
                                 group by user_id                                  
                ) b  on  a.user_id = b.user_id
 where b.user_id is  null 

select * from   int_02004_02008_month_stage



                select distinct char(time_id ),substr(char(time_id ),1,4)||'-'||substr(char(time_id ),5,2)||'-'||substr(char(time_id ),7,2)
                from G_S_22073_DAY
                where char(time_id)
                not in (select date_seq from 
                                G_I_21020_MONTH_calendar
                                )
                                


select * from   bass1.G_RULE_CHECK where rule_code between 'R231'   and 'R254'   
AND TIME_ID in (201109,201105)
order by 2 ,1 

                         
                         




SELECT  ( val1 - val2 ) val ,val1,val2
from 
(
select count(0)  val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201109 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in ('1','2','3')
)  a
,(
select count(0) val2 from    
BASS1.G_I_06021_MONTH 
where time_id = 201109 and CHANNEL_STATUS = '1' 
and   channel_type in ('1','2')
) b 



SELECT  ( val1 - val2 ) val ,val1,val2
from 
(

select count(0) val1 from    
BASS1.G_I_06021_MONTH 
where time_id = 201109 and CHANNEL_STATUS = '1' 
and CHANNEL_B_TYPE in  ('5','6')

)  a
,(

select count(0) val2 from    
BASS1.G_I_06021_MONTH 
where time_id = 201109 and CHANNEL_STATUS = '1' 
and   channel_type in ('3')
) b 



201109	R235	1313242.00000	35826.00000	0.02728	0.00000
201109	R235	1313242.00000	35384.00000	0.02694	0.00000


select * from app.sch_control_runlog 
where control_code = 'REP_App_xysc_comp_user_ms.tcl'


insert into app.sch_control_before
values ('BASS1_G_I_02017_MONTH.tcl','REP_App_xysc_school_user_ms.tcl')

insert into app.sch_control_before
values ('BASS1_G_S_22401_MONTH.tcl','REP_App_xysc_comp_user_ms.tcl')

REP_App_xysc_comp_user_ms.tcl
REP_App_xysc_new_user_ms.tcl

insert into app.sch_control_before
values ('BASS1_G_S_22401_MONTH.tcl','REP_App_xysc_new_user_ms.tcl')


insert into app.sch_control_before
values ('BASS1_G_S_22401_MONTH.tcl','BASS2_Dw_comp_cust_dt.tcl')

BASS2_Dw_comp_cust_dt.tcl

select * from  table( bass1.get_before('G_S_22063_MONTH')) a 



select * from  bass1.g_s_05001_month where time_id = 201107
select * from  bass1.g_s_05002_month where time_id = 201107


insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201107


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201107

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 

select * from    app.sch_control_task 

int -s G_S_02047_MONTH.tcl>/bassapp/bass1/tcl/log/G_S_02047_MONTH.tcl.out.r`date +%Y%m`

update app.sch_control_task 
set cmd_line = trim(cmd_line) ||'>/bassapp/bass1/tcl/log/'||replace(control_code,'BASS1_','')||'.out.r`date +%Y%m`'
where control_code in (
select control_code  from   app.sch_control_runlog
where control_code like 'BASS1%INT%MONTH.tcl'
AND DATE(BEGINTIME) >= '2011-07-01'
) 



select  a.* from   app.sch_control_task a 
where control_code in (
select control_code  from   app.sch_control_runlog
where control_code like 'BASS1%INT%MONTH.tcl'
AND DATE(BEGINTIME) >= '2011-07-01'
) 


select time_id,POINT_FEEDBACK_ID,count(0) from G_S_02007_MONTH
group by time_id,POINT_FEEDBACK_ID

select count(0),count(distinct USER_ID ) from    G_I_02017_MONTH where time_id = 201109


select * from   G_I_02017_MONTH



select * from app.sch_control_runlog where control_code in(
select control_code  from  table( bass1.get_task('cdr_gprs_local'))  a
)


select sum(bigint(income)*1.00/100) from   G_S_22307_MONTH where time_id = 201109

1115.50000000000


select count(0),count(distinct SCHOOL_ID||COMP_BRAND_ID ) from    G_S_22401_MONTH where time_id = 201109


select * from   G_S_22401_MONTH where time_id = 201109



select * from   G_S_22086_MONTH
select * from   G_S_22085_MONTH


select count(0) from   G_S_22083_MONTH
where bigint(ORDER_CNT) <= 0
and time_id = 201109


select count(0) from   G_S_22083_MONTH
where bigint(ORDER_CNT) < bigint(CANCEL_CNT)
and time_id = 201109

select * from   G_S_22086_MONTH
where bigint(ORDER_USER_CNT) <= 0



roup by PRODUCT_NO
having sum(bigint(BASE_BILL_DURATION)) > 0


select count(distinct b.user_id) from     BASS1.G_S_21003_MONTH_mobile a 
,g_a_02004_02008_stage b 
where a.product_no = b.product_no
and  b.usertype_id NOT IN ('2010','2020','2030','2040','9000')
and b.test_flag = '0'



          
ALTER TABLE G_S_21003_MONTH_mobile ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

insert into  BASS1.G_S_21003_MONTH_mobile
select  PRODUCT_NO from G_S_21003_MONTH 
where time_id = 201105  
group by PRODUCT_NO
having sum(bigint(BASE_BILL_DURATION)) > 0

db2 runstats on table bass2.ODS_SYS_CMD_DEF_20110731 with distribution and detailed indexes all 

select count(distinct b.user_id) from     BASS1.G_S_21003_MONTH_mobile a 
,int_02004_02008_month_stage b 
where a.product_no = b.product_no
and  b.usertype_id NOT IN ('2010','2020','2030','2040','9000')

1279643

 select count(0)
 from
 (
                 select distinct user_id from 
                  BASS1.G_S_21003_MONTH_mobile   a 
                        ,g_a_02004_02008_stage b 
                where a.product_no = b.product_no
                and  b.usertype_id NOT IN ('2010','2020','2030','9000')
                and b.test_flag = '0'
) a 
left join 
(               select user_id
                from g_s_03004_month
                where time_id = 201105 
                and 
                 ( int(substr(ACCT_ITEM_ID,2))/100 in (1,2,3)
                                or ACCT_ITEM_ID in ('0401','0403','0407')
                 )
                 group by user_id 
                 having sum(bigint(FEE_RECEIVABLE)) > 0
) b  on  a.user_id = b.user_id 
 where b.user_id is  null 
 
 select * from   G_S_22039_MONTH
order by 2 desc ,3


select distinct ACCT_ITEM_ID
from G_S_03004_MONTH where time_id = 201109




select a from 
(
select '0101' a from bass2.dual union all
select '0201' a from bass2.dual union all
select '0203' a from bass2.dual union all
select '0207' a from bass2.dual union all
select '0305' a from bass2.dual union all
select '0307' a from bass2.dual union all
select '0309' a from bass2.dual union all
select '0311' a from bass2.dual union all
select '0313' a from bass2.dual union all
select '0315' a from bass2.dual union all
select '0319' a from bass2.dual union all
select '0321' a from bass2.dual union all
select '0323' a from bass2.dual union all
select '0327' a from bass2.dual union all
select '0329' a from bass2.dual union all
select '0333' a from bass2.dual union all
select '0335' a from bass2.dual union all
select '0401' a from bass2.dual union all
select '0403' a from bass2.dual union all
select '0501' a from bass2.dual union all
select '0519' a from bass2.dual union all
select '0520' a from bass2.dual union all
select '0521' a from bass2.dual union all
select '0522' a from bass2.dual union all
select '0523' a from bass2.dual union all
select '0525' a from bass2.dual union all
select '0599' a from bass2.dual union all
select '0605' a from bass2.dual union all
select '0611' a from bass2.dual union all
select '0613' a from bass2.dual union all
select '0615' a from bass2.dual union all
select '0626' a from bass2.dual union all
select '0627' a from bass2.dual union all
select '0631' a from bass2.dual union all
select '0633' a from bass2.dual union all
select '0635' a from bass2.dual union all
select '0637' a from bass2.dual union all
select '0638' a from bass2.dual union all
select '0639' a from bass2.dual union all
select '0699' a from bass2.dual union all
select '0715' a from bass2.dual union all
select '0716' a from bass2.dual union all
select '0901' a from bass2.dual ) a
except 

 BASS1.ALL_DIM_LKP  
 set bass1_tbid = 'BASS_STD1_0074'
 where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid <> 'BASS_STD1_0074'
and bass1_tbn_desc  like '%帐目科目%'

select bass1_value from BASS1.ALL_DIM_LKP  
where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid = 'BASS_STD1_0074'
except
select a
from 
(
select '0100' a from bass2.dual union all
select '0101' a from bass2.dual union all
select '0200' a from bass2.dual union all
select '0201' a from bass2.dual union all
select '0203' a from bass2.dual union all
select '0205' a from bass2.dual union all
select '0207' a from bass2.dual union all
select '0300' a from bass2.dual union all
select '0301' a from bass2.dual union all
select '0305' a from bass2.dual union all
select '0311' a from bass2.dual union all
select '0313' a from bass2.dual union all
select '0315' a from bass2.dual union all
select '0317' a from bass2.dual union all
select '0319' a from bass2.dual union all
select '0321' a from bass2.dual union all
select '0323' a from bass2.dual union all
select '0325' a from bass2.dual union all
select '0327' a from bass2.dual union all
select '0329' a from bass2.dual union all
select '0331' a from bass2.dual union all
select '0333' a from bass2.dual union all
select '0335' a from bass2.dual union all
select '0400' a from bass2.dual union all
select '0401' a from bass2.dual union all
select '0403' a from bass2.dual union all
select '0405' a from bass2.dual union all
select '0407' a from bass2.dual union all
select '0409' a from bass2.dual union all
select '0500' a from bass2.dual union all
select '0501' a from bass2.dual union all
select '0507' a from bass2.dual union all
select '0516' a from bass2.dual union all
select '0519' a from bass2.dual union all
select '0520' a from bass2.dual union all
select '0521' a from bass2.dual union all
select '0522' a from bass2.dual union all
select '0523' a from bass2.dual union all
select '0524' a from bass2.dual union all
select '0525' a from bass2.dual union all
select '0526' a from bass2.dual union all
select '0599' a from bass2.dual union all
select '0600' a from bass2.dual union all
select '0602' a from bass2.dual union all
select '0605' a from bass2.dual union all
select '0609' a from bass2.dual union all
select '0611' a from bass2.dual union all
select '0613' a from bass2.dual union all
select '0615' a from bass2.dual union all
select '0619' a from bass2.dual union all
select '0620' a from bass2.dual union all
select '0625' a from bass2.dual union all
select '0626' a from bass2.dual union all
select '0627' a from bass2.dual union all
select '0628' a from bass2.dual union all
select '0631' a from bass2.dual union all
select '0632' a from bass2.dual union all
select '0633' a from bass2.dual union all
select '0635' a from bass2.dual union all
select '0637' a from bass2.dual union all
select '0638' a from bass2.dual union all
select '0639' a from bass2.dual union all
select '0640' a from bass2.dual union all
select '0642' a from bass2.dual union all
select '0643' a from bass2.dual union all
select '0699' a from bass2.dual union all
select '0700' a from bass2.dual union all
select '0701' a from bass2.dual union all
select '0702' a from bass2.dual union all
select '0715' a from bass2.dual union all
select '0716' a from bass2.dual union all
select '0800' a from bass2.dual union all
select '0900' a from bass2.dual union all
select '0901' a from bass2.dual 
) a


select * from BASS1.ALL_DIM_LKP  
where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid = 'BASS_STD1_0074'
and bass1_value in ('0303','0307','0309')


select * from   bass2.dim_acct_item
where char(item_id) in (
 '80000209'
,'80000210'
,'80000222'
,'80000221'
,'80000212'
,'80000213'
)


select  ACCT_ITEM_ID,count(0)
from G_S_03004_MONTH where time_id = 201109
group by ACCT_ITEM_ID

select  ITEM_ID,count(0)
from G_S_03005_MONTH where time_id = 201109
group by ITEM_ID








select distinct  a
from 
(
select '0100' a from bass2.dual union all
select '0101' a from bass2.dual union all
select '0200' a from bass2.dual union all
select '0201' a from bass2.dual union all
select '0203' a from bass2.dual union all
select '0205' a from bass2.dual union all
select '0207' a from bass2.dual union all
select '0300' a from bass2.dual union all
select '0301' a from bass2.dual union all
select '0305' a from bass2.dual union all
select '0311' a from bass2.dual union all
select '0313' a from bass2.dual union all
select '0315' a from bass2.dual union all
select '0317' a from bass2.dual union all
select '0319' a from bass2.dual union all
select '0321' a from bass2.dual union all
select '0323' a from bass2.dual union all
select '0325' a from bass2.dual union all
select '0327' a from bass2.dual union all
select '0329' a from bass2.dual union all
select '0331' a from bass2.dual union all
select '0333' a from bass2.dual union all
select '0335' a from bass2.dual union all
select '0400' a from bass2.dual union all
select '0401' a from bass2.dual union all
select '0403' a from bass2.dual union all
select '0405' a from bass2.dual union all
select '0407' a from bass2.dual union all
select '0409' a from bass2.dual union all
select '0500' a from bass2.dual union all
select '0501' a from bass2.dual union all
select '0507' a from bass2.dual union all
select '0516' a from bass2.dual union all
select '0519' a from bass2.dual union all
select '0520' a from bass2.dual union all
select '0521' a from bass2.dual union all
select '0522' a from bass2.dual union all
select '0523' a from bass2.dual union all
select '0524' a from bass2.dual union all
select '0525' a from bass2.dual union all
select '0526' a from bass2.dual union all
select '0599' a from bass2.dual union all
select '0600' a from bass2.dual union all
select '0602' a from bass2.dual union all
select '0605' a from bass2.dual union all
select '0609' a from bass2.dual union all
select '0611' a from bass2.dual union all
select '0613' a from bass2.dual union all
select '0615' a from bass2.dual union all
select '0619' a from bass2.dual union all
select '0620' a from bass2.dual union all
select '0625' a from bass2.dual union all
select '0626' a from bass2.dual union all
select '0627' a from bass2.dual union all
select '0628' a from bass2.dual union all
select '0631' a from bass2.dual union all
select '0632' a from bass2.dual union all
select '0633' a from bass2.dual union all
select '0635' a from bass2.dual union all
select '0637' a from bass2.dual union all
select '0638' a from bass2.dual union all
select '0639' a from bass2.dual union all
select '0640' a from bass2.dual union all
select '0642' a from bass2.dual union all
select '0643' a from bass2.dual union all
select '0699' a from bass2.dual union all
select '0700' a from bass2.dual union all
select '0701' a from bass2.dual union all
select '0702' a from bass2.dual union all
select '0715' a from bass2.dual union all
select '0716' a from bass2.dual union all
select '0800' a from bass2.dual union all
select '0900' a from bass2.dual union all
select '0901' a from bass2.dual 
) a where a not like '%00'
except
select distinct bass1_value from BASS1.ALL_DIM_LKP  
where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid = 'BASS_STD1_0074'


1
0205
0317!
0325
0405
0407
0409
0516
0524
0602
0609
0619
0628
0640
0642
0643
0701
0702

港澳台漫游通话费


select * from   bass2.dim_acct_item where item_name like '%话音业务套餐%'


select * from BASS1.ALL_DIM_LKP  
where lower(xzbas_tbname) like '%dim_acct_item%'
and bass1_tbid = 'BASS_STD1_0074'
and bass1_value_desc like '%港澳台%'

select * from  BASS1.ALL_DIM_LKP  
where xzbas_value in (
'80000275'
,'80000340'
,'80000404'
)


80000275	长途费_国际漫出_港澳台_直拨(中国移动TD)
80000340	长途费_国际漫出_港澳台_直拨(中国电信TD)
80000404	长途费_国际漫出_港澳台_直拨(中国网通TD)



80000629	港澳台漫游主叫基本通话费
80000630	港澳台漫游被叫基本通话费
XZBAS_TBNAME	XZBAS_COLNAME	XZBAS_VALUE	BASS1_TBN_DESC	BASS1_TBID	BASS1_VALUE	BASS1_VALUE_DESC
dim_acct_item	省内漫游港澳台长话费	80000056	帐目科目	BASS_STD1_0074	0313	省内漫游港澳台长途费


insert into  BASS1.ALL_DIM_LKP  
values ('dim_acct_item','港澳台漫游被叫基本通话费','80000630','帐目科目','BASS_STD1_0074','0205','港澳台漫游通话费')


话音业务套餐

select * from  BASS1.ALL_DIM_LKP  
where xzbas_value in (
'80000629'
,'80000630'
,'80000404'
)


XZBAS_VALUE
80000629
80000630
80000404

select count(0),count(distinct PRODUCT_NO) from     bass2.dw_acct_shoulditem_201109
where item_id in (80000629,80000630)

   select * from   bass1.g_rule_check 
where  rule_code between 'R230' and 'R235'
order by 1 desc ,2

45868.00 1350122.00 
201107	R235	1350122.00000	29215.00000	0.02163	0.00000


201109	R235	1312839.00000	35770.00000	0.02724	0.00000

values (35770 - 49)*1.00/1312839

values (45868 - 9200 )*1.00/1350122


                INSERT INTO BASS1.G_RULE_CHECK VALUES (201109,'R235',1312839,35343,0.0269210466782293944,0) 
                

select * from    bass1.G_RULE_CHECK where rule_code = 'L4'                

select * from   G_S_22061_MONTH
where time_id = 201103



select count(user_id) 
                    from bass2.dw_product_20110711
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1



        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110711 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110711 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1

select tabname from syscat.tables where tabname like '%02004%'                        


select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110711     


select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110711                       
except
select user_id 
from bass2.dw_product_20110711  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1


USER_ID
89660001100031 
89660001100043 
89660001099912 
89660001099953 
89660001099916 
89660001099930 
89660001100010 
89660001099931 
89660001100100 
89660001100107 
89660001100168 
89660001099896 
89660001099933 
89660001099983 
89660001100057 
89660001099917 
89660001100088 
89660001100112 


select * from   session.int_check_user_status  
where user_id in 
(
 '89660001100112'
,'89660001100088'
)


select * from   bass2.dw_product_20110711
where user_id in 
(
 '89660001100112'
,'89660001100088'
)


                           
                           

select count(0) from    bass2.dw_channel_info_201109 
                           
select count(0) from    bass2.dim_channel_info





select count(user_id) 
                    from bass2.dw_product_20110711
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1


select count(user_id) 
                    from bass2.dw_product_20110712
                   where usertype_id in (1,2,9) 
                     and day_off_mark = 1 
                     and userstatus_id not in (1,2,3,6,8)
                     and test_mark<>1



        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20110712 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20110712 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1


            select sum(bigint(m_off_users)) from bass1.g_s_22012_day where time_id=20110712

                        select count(distinct user_id) from session.int_check_user_status
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712



select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712                       
except
select user_id 
from bass2.dw_product_20110712  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1

-- 测试机离网。二经把这批离网的测试机在离网当天，测试标志置为了0(非测试）。
select user_id 
from bass2.dw_product_20110712  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
      except                
select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712                       

select * from   session.int_check_user_status  
where user_id in 
(
select user_id 
from bass2.dw_product_20110712  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
      except                
select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712 
)


select usertype_id,day_off_mark,userstatus_id,test_mark, a.* from   bass2.dw_product_20110711 a
where user_id in 
(
select user_id 
from bass2.dw_product_20110712  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
      except                
select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712 
)


select * from g_a_02004_day  where user_id = '89557332762034'     



select usertype_id,userstatus_id,test_mark, a.* from   bass2.dw_product_bass1_20110711 a
where user_id in 
(
select user_id 
from bass2.dw_product_20110712  
where usertype_id in (1,2,9) 
 and day_off_mark = 1 
 and userstatus_id not in (1,2,3,6,8)
 and test_mark<>1
      except                
select user_id from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id=20110712 
)



select *    
        from
                bass2.ODS_PRODUCT_INS_PROD_20110712 a
                ,bass2.ODS_PRODUCT_INS_PROD_RED_20110712 b
        where
                a.product_instance_id = b.product_instance_id 
                --and a.notice_flag = 4
                --and b.user_red_type = 2 
                --and  a.valid_type = 1
                and a.product_instance_id = '89557332762057'

                
89557332762057

select * from   bass2.ODS_PRODUCT_INS_PROD_20110712
where product_instance_id = '89557332762057'


select * from   bass2.ODS_PRODUCT_INS_PROD_RED_20110711
where product_instance_id = '89557332762057'

select * from   bass1.INT_02004_02008_201107 where op_time = 20110712 
and user_id = '89557332762057'


select op_time , brand_flag,count(0) 
--,  count(distinct op_time ) 
from INT_02004_02008_201107 
group by  op_time ,brand_flag
order by 1 

select * from   INT_02004_02008_201107


select * from   session.int_02004_02008
where user_id = '89557332762057'


                       select
                         user_id
                         ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(brand_id)),'2') as brand_id
                         ,case
                            when test_mark=1 then '3'
                            when free_mark=1 then '2'
                            else '1'
                          end
                       from 
                         bass2.dw_product_bass1_20110712 
                         where user_id = '89557332762057'


declare global temporary table session.int_02004_02008
                     (
                      user_id     varchar(20) not null , 
                      brand_id    varchar(1) not null ,
                      usertype_id varchar(4) not null, 
                      brand_flag int not null,
                      usertype_flag int not null                                
                      )
                      partitioning key 
                      (user_id)
                      using hashing
                     with replace on commit preserve rows not logged in tbs_user_temp
建临时表结束
Insert into session.int_02004_02008
                   select
                     user_id
                     ,brand_id
                     ,'0000'
                     ,1
                     ,0
                   from
                     (
                       select
                         user_id
                         ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(brand_id)),'2') as brand_id
                         ,case
                            when test_mark=1 then '3'
                            when free_mark=1 then '2'
                            else '1'
                          end
                       from 
                         bass2.dw_product_bass1_20110712 
                       where 
                         userstatus_id in (1,2,3,6,8)
                         and usertype_id in (1,2,9)
                       except
                       select a.user_id,a.brand_id,usertype_id from BASS1.g_a_02004_day a,
                           (
                             select max(time_id) as time_id,user_id from BASS1.g_a_02004_day 
                             where time_id<20110712 
                             group by user_id
                            )b
                            where a.user_id = b.user_id and a.time_id=b.time_id
                     )aa
插入02004结束
Insert into session.int_02004_02008
                    select
                     user_id
                     ,'0'
                     ,usertype_id
                     ,0
                     ,1
                     from
                     (
                       select
                         user_id
                         ,case 
                            when userstatus_id=1 and stopstatus_id=0 then '1010'
                            when userstatus_id=1 and stopstatus_id between 11 and 16 then '1031'
                            when userstatus_id=1 and stopstatus_id in (28,29) then '1032'
                            when userstatus_id=9 then '2030'
                            when userstatus_id=1 and stopstatus_id not in (0,11,12,13,14,15,16,28,29) then '1039' 
                            when userstatus_id in (3,6) then '1022'
                            when userstatus_id in (2)   then '1021'
                            when userstatus_id=4 then '2010'
                            when userstatus_id=8 then '1040'
                            when userstatus_id in (5,7) then '2020' 
                            else '1039' 
                           end as usertype_id
                         from 
                           bass2.dw_product_bass1_20110712 
                         where 
                           userstatus_id<>0
                           and usertype_id in (1,2,9)
                       except
                        select a.user_id,a.usertype_id from BASS1.G_A_02008_DAY a,
                           (select max(time_id) as time_id,user_id from BASS1.G_A_02008_DAY 
                            where time_id<20110712 
                            group by user_id
                            )b
                           where a.user_id = b.user_id and a.time_id=b.time_id
                       )aa


select USERTYPE_ID , count(0) 
--,  count(distinct USERTYPE_ID ) 
from BASS1.g_a_02004_day 
group by  USERTYPE_ID 
order by 1 




select CHANNEL_ID,CHANNEL_TYPE_CLASS,CHANNEL_TYPE,CHANNEL_CHILD_TYPE from   bass2.dim_channel_info


select distinct VALUE_DESC from   BASS2.DIM_DEVICE_PROFILE   where   PROPERTY_ID =  '003001'


select * from BASS2.DIM_CONTROL_INFO        
select * from BASS2.DIM_DEVICE_INFO         
select * from BASS2.DIM_DEVICE_PROFILE      
select * from BASS2.DIM_PROPERTY_INFO       
select * from BASS2.DIM_PROPERTY_VALUE_RANGE

select distinct  a.TAC_NUM,a.DEV_ID ,b.DEVICE_NAME,c.VALUE_DESC
from   BASS2.DIM_TACNUM_DEVID a
,BASS2.DIM_DEVICE_INFO    b 
,(select * from  BASS2.DIM_DEVICE_PROFILE   where PROPERTY_ID =  '003001' ) c 
where a.DEV_ID = b.DEVICE_ID
and a.dev_id = c.DEVICE_ID
and upper(b.device_name) like '%N9%'





select * from   app.sch_control_task where control_code like '%INT_COMMON_ROUTINE_MONTH.tcl'

select substr(replace(char(current date),'-',''),1,6) from bass2.dual
select day(current timestamp) from bass2.dual

select sim_code , count(0) 
--,  count(distinct sim_code ) 
from G_A_02004_DAY 
group by  sim_code 
order by 1 


SELECT time_id,SIM_CODE, COUNT(0)
FROM G_A_02004_DAY
WHERE TIME_ID  >= 20110701
GROUP BY time_id,SIM_CODE


select * from   G_S_04019_DAY where time_id = 20110801



BASS1_G_A_06001_DAY.tcl

select * from   app.sch_control_task where control_code like '%BASS1_G_A_06001_DAY.tcl'

select * from  table( bass1.get_before('BASS1_G_A_06001_DAY')) a 

delete from app.sch_control_before where control_code = 'BASS1_G_A_06001_DAY.tcl'

BASS1_G_A_06001_DAY.tcl	REP_App_xysc_school_user_ms.tcl


select * from   G_S_22049_MONTH

select * from   bass1.mon_all_interface  where interface_code = '02005'
where deadline = 3




select * from g_i_02053_month
  where time_id = 201107
 and 
 VALID_DATE> EXPIRE_DATE
 
 
 
 
 
        ------22057                     :                   --     
CREATE TABLE G_S_22057_MONTH (
             
         TIME_ID                INTEGER             ----:记录行号:      
        ,OP_TIME                CHAR(6)             ----:月份:主键      
        ,CHANNEL_ID             CHAR(40)            ----:实体渠道标识:主键 
        ,ALARM_TYPE             CHAR(2)             ----:预警方式:主键  
        ,ALARM_LVL              CHAR(2)             ----:预警级别:主键  
        ,YK_CNT                 CHAR(12)            ----:疑似养卡用户数: 
        ,YK_AMT                 CHAR(12)            ----:疑似套利金额:  
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( TIME_ID,OP_TIME,CHANNEL_ID,ALARM_TYPE,ALARM_LVL ) USING HASHING;
        
        ------ 22058                    :                   --                  
        CREATE TABLE G_S_22058_MONTH (
         TIME_ID                INTEGER             ----:记录行号:      
        ,OP_TIME                CHAR(6)             ----:月份:主键      
        ,CHANNEL_ID             CHAR(40)            ----:实体渠道标识:主键 
        ,YK_CNT                 CHAR(12)            ----:确认养卡用户数: 
        ,YK_AMT                 CHAR(12)            ----:确认套利金额:  
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( TIME_ID,OP_TIME,CHANNEL_ID ) USING HASHING;        
        ------22059                     :                   --      
CREATE TABLE G_S_22059_MONTH (            
         TIME_ID                INTEGER             ----:记录行号:      
        ,OP_TIME                CHAR(6)             ----:月份:主键      
        ,CHANNEL_ID             CHAR(40)            ----:实体渠道标识:主键 
        ,BRAND                  CHAR(1)             ----:疑似窜卡客户品牌:主键 
        ,CK_CNT                 CHAR(8)             ----:疑似窜卡数量:  
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( TIME_ID,OP_TIME,CHANNEL_ID,BRAND ) USING HASHING;         
        ------22060                     :                   --                  
CREATE TABLE G_S_22060_MONTH (
         TIME_ID                INTEGER             ----:记录行号:      
        ,OP_TIME                CHAR(6)             ----:月份:主键      
        ,CHANNEL_ID             CHAR(40)            ----:实体渠道标识:主键 
        ,BRAND                  CHAR(1)             ----:窜卡客户品牌:主键 
        ,CK_CNT                 CHAR(8)             ----:确认窜卡数量:  
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( TIME_ID,OP_TIME,CHANNEL_ID,BRAND ) USING HASHING;
 




select   count(0) 
,  count(distinct user_id ) 
from bass1.G_A_02004_DAY  
where time_id = 20110802

select  time_id, count(0) 
,  count(distinct user_id ) 
from bass1.G_A_02004_DAY  
group by time_id


select * from    g_i_02016_month where time_id = 201107



                                select a.cnt*1.00 ,value(b.income,0) income
                                from
                                (select count(0) cnt
                                                        from 
                                                        (
                                                        select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                                                        from (
                                                        select *
                                                        from g_a_02054_day where 
                                                         time_id/100 <= 201107 and ENTERPRISE_BUSI_TYPE = '1520'
                                                         and MANAGE_MODE = '3'
                                                        ) t 
                                                        ) t2 where rn = 1 and STATUS_ID ='1'
                                ) a,(
                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201107
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                union all 
                                select sum(bigint(income)) income from   g_s_03018_month
                                where time_id = 201107
                                and ent_busi_id = '1520'
                                and MANAGE_MOD = '3'
                                ) t 
                                ) b 
                        with ur
                        

select * from                           



select PROD_ID , count(0) 
--,  count(distinct PROD_ID ) 
from G_I_02014_MONTH 
group by  PROD_ID 
order by 1 
select count(0),count(distinct user_id) from  G_I_02014_MONTH where time_id = 201107
  
  select PROD_ID,BASE_PKG_ID, count(0) from  
   (select * from  bass1.G_I_02014_MONTH where time_id = 201107 ) a,
   (select * from  bass1.g_i_02022_day where time_id = 20110731 ) b
   where a.user_id = b.user_id 
   group by PROD_ID,BASE_PKG_ID
   

select time_id , count(0) 
--,  count(distinct time_id ) 
from bass1.G_I_02014_MONTH 
group by  time_id 
order by 1 


   select * from    G_S_22068_MONTH 
   
   select * from    G_S_22049_MONTH

select * from   bass2.stat_market_0135_a

drop table BASS1.G_S_22059_MONTH_MRKT_0135A;
CREATE TABLE BASS1.G_S_22059_MONTH_MRKT_0135A
 (
         OP_TIME                 INTEGER       
         ,CHANNEL_ID              BIGINT
         ,user_cnt        INTEGER
	)
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,CHANNEL_ID
   ) USING HASHING;

ALTER TABLE BASS1.G_S_22059_MONTH_MRKT_0135A
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
   
   
  BASS_STD1_0055
  
  select * from BASS1.ALL_DIM_LKP  
where  bass1_tbid = 'BASS_STD1_0055'


XZBAS_TBNAME	XZBAS_COLNAME	XZBAS_VALUE	BASS1_TBN_DESC	BASS1_TBID	BASS1_VALUE	BASS1_VALUE_DESC
dim_boss_brand	全球通	1	客户品牌	BASS_STD1_0055	1	全球通
dim_boss_brand	无品牌	0	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	神州行	3	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	神州行本地卡	5	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	标准短信资费	6	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	标准神州行	7	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	一经中间表对应标神	9999	客户品牌	BASS_STD1_0055	2	神州行
dim_boss_brand	动感地带	4	客户品牌	BASS_STD1_0055	3	动感地带


case 
    when brand_id in (1) then '1'
    when brand_id in (0,3,5,6,7,9999) then '2'
    when brand_id in (4) then '3'
    else '2' end 



drop table BASS1.G_S_22059_MONTH_MRKT_0135A;
CREATE TABLE BASS1.G_S_22059_MONTH_MRKT_0135A
 (
         OP_TIME                 INTEGER      
         ,CHANNEL_ID              BIGINT
	     ,brand_id 		  char(1)
         ,user_cnt        INTEGER
	)
  DATA CAPTURE NONE
 IN TBS_APP_BASS1
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   (OP_TIME,CHANNEL_ID
   ) USING HASHING;

ALTER TABLE BASS1.G_S_22059_MONTH_MRKT_0135A
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  
  
  
  select * from BASS1.G_S_22059_MONTH
  
  select * from  time_id=$op_month
  select * from bass2.stat_channel_reward_0004


select * from   BASS1.G_RULE_CHECK where rule_code = 'R235'



select sum(bigint(FEE_RECEIVABLE)) from G_S_03004_MONTH where time_id = 201107
12614037141

13447880389

select sum(bigint(SHOULD_FEE)) from G_S_03005_MONTH where time_id = 201107

12614037141

13447880389

select sum(



 select count(0)
 from
 (
                 select distinct user_id from 
                  BASS1.G_S_21003_MONTH_mobile   a 
                        ,int_02004_02008_month_stage b 
                where a.product_no = b.product_no
                and  b.usertype_id NOT IN ('2010','2020','2030','9000')
                and b.test_flag = '0'
) a 
left join 
(               select user_id
                from g_s_03004_month
                where time_id = 201107
                and 
                 ( int(substr(ACCT_ITEM_ID,2))/100 in (1,2,3)
                                or ACCT_ITEM_ID in ('0401','0403','0407')
                 )
                 group by user_id 
                 having sum(bigint(FEE_RECEIVABLE)) > 0
) b  on  a.user_id = b.user_id 
 where b.user_id is  null 
 
 
 45868
 
 
 
 
 select * from    app.g_unit_info  where unit_code = '2206'
 
 select * from  bass2.dim_acct_item where item_name like '%M2M%'


 
 select * from  BASS1.G_S_22057_MONTH
 
 
 
 select a.city_id,a.county_id,value(c.county_name,'未知'),count(a.product_no),sum(a.fact_fee) from (select a.product_no,a.city_id,a.county_id,a.fact_fee from bass2.dw_product_201006 a,(select product_no from bass2.dw_product_201006where userstatus_id in (1,2,3,6,8)   and test_mark<>1   and usertype_Id in (1,2,9)exceptselect a.product_no from bass2.dw_td_check_user_201006 a,bass2.dw_product_201006 bwhere a.product_no = b.product_no  and b.userstatus_id in (1,2,3,6,8)   and b.test_mark<>1   and b.usertype_id in (1,2,9)) bwhere a.product_no=b.product_no) aleft join bassweb.dim_pub_county c  on a.city_id= c.CITY_ID and  a.county_id=c.county_id and c.city_id in ('893')where a.city_id in ('893')group by a.city_id,a.county_id,value(c.county_name,'未知')order by city_idselect county_id,count( distinct product_no) from bass2.dw_product_201006where userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9) and test_mark<>1 and city_id in ('893')group by county_id



 select a.city_id,a.county_id,count(distinct a.product_no),sum(a.fact_fee) from (select a.product_no,a.city_id,a.county_id,a.fact_fee from bass2.dw_product_201006 a,(select product_no from bass2.dw_product_201006where userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9) and test_mark<>1 and city_id in ('893')exceptselect a.product_no from bass2.dw_td_check_user_201006 a,bass2.dw_product_201006 bwhere a.product_no = b.product_no  and b.userstatus_id in (1,2,3,6,8)   and b.test_mark<>1   and b.usertype_id in (1,2,9)) bwhere a.product_no=b.product_no) a

group by a.city_id,a.county_id


select count(0) from    
(select product_no from bass2.dw_product_201006where userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9) and test_mark<>1 and city_id in ('893')exceptselect a.product_no from bass2.dw_td_check_user_201006 a,bass2.dw_product_201006 bwhere a.product_no = b.product_no  and b.userstatus_id in (1,2,3,6,8)   and b.test_mark<>1   and b.usertype_id in (1,2,9)) b


select count(0) from bass2.dw_product_201006where userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9) and test_mark<>1 and city_id in ('893')




select city_id,county_id , count(0) 
--,  count(distinct city_id||county_id ) 
from bass2.dw_product_201006 
where userstatus_id in (1,2,3,6,8) and usertype_id in (1,2,9) and test_mark<>1 and city_id in ('893')
group by  city_id,county_id 
order by 1 


select * from    bassweb.dim_pub_county 






select a.city_id,a.county_id,value(c.county_name,'未知'),count(a.product_no),sum(a.fact_fee) 
from bass2.dw_product_201006 a
left join bassweb.dim_pub_county c  on a.city_id= c.CITY_ID and  a.county_id=c.county_id and c.city_id in ('893')
where userstatus_id in (1,2,3,6,8) 
and test_mark<>1 
and usertype_Id in (1,2,9)
and not exists (select 1 from bass2.dw_td_check_user_201006  b where a.product_no = b.product_no) 
and  a.city_id in ('893')
group by a.city_id,a.county_id,value(c.county_name,'未知')
order by city_id






select * from   g_s_22084_day


select * from   G_S_22081_MONTH

select bigint(CANCEL_CNT)*1.00/(bigint(ORDER_CNT)+bigint(CANCEL_CNT))*100 from G_S_22081_MONTH where time_id = 201109

select * from   APP.G_FILE_REPORT
select * from   app.g_runlog 

select * from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
union 
select * from app.g_runlog 
where time_id=201109
and return_flag=1

select * from   mon_all_interface


select interface_code,type,COARSE_TYPE,REPLACE(replace(control_code,'BASS1_',''),'.tcl',''),verf_file,data_file 
,deadline,replace(replace(coarse_type,'每日',''),'每月',''),interface_name
,upload_time
,case when type = 'd' then '日' else '月' end t
from   mon_all_interface a
, app.sch_control_task b 
,(select * from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
union 
select * from app.g_runlog 
where time_id=201109
and return_flag=1) c
where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.interface_code = c.unit_code
and interface_code 
in
('02047'
,'02004'
,'02052'
,'02008'
,'03004'
,'03012'
,'03005'
,'04018'
,'04002'
,'04017'
,'04004'
,'04005'
,'04014'
,'21007'
,'21009'
,'21006'
,'21004'
,'21001'
,'21003'
,'22038'
,'22073'
,'22201'
,'22203'
,'22202'
)
and control_code like 'BASS1_G%'
and control_code not like 'BASS1_%TO%'


select * from syscat.columns fetch first 10 rows only  

select colno,length(trim(char(colno))) from   syscat.columns
where tabname in( 'G_A_02004_DAY','G_A_02004_DAY') and tabschema = 'BASS1'
order by tabname , colno




select interface_code,COARSE_TYPE,REPLACE(replace(control_code,'BASS1_',''),'.tcl','') table_name
from   mon_all_interface a
, app.sch_control_task b 
,syscat.columns c
where a.INTERFACE_CODE = substr(control_code , 11,5)
and REPLACE(replace(control_code,'BASS1_',''),'.tcl','') = c.colname
and interface_code 
in
('02047'
,'02004'
,'02052'
,'02008'
,'03004'
,'03012'
,'03005'
,'04018'
,'04002'
,'04017'
,'04004'
,'04005'
,'04014'
,'21007'
,'21009'
,'21006'
,'21004'
,'21001'
,'21003'
,'22038'
,'22073'
,'22201'
,'22203'
,'22202'
)
and control_code like 'BASS1_G%'
and control_code not like 'BASS1_%TO%'
and c.tabschema = 'BASS1'



select * from   table (
select '01一经接口/01服务主题/用户' name,'02004' code from bass2.dual union all
select '01一经接口/01服务主题/用户状态' name,'02008' code from bass2.dual union all
select '01一经接口/01服务主题/用户使用终端通话情况' name,'02047' code from bass2.dual union all
select '01一经接口/01服务主题/用户区域归属' name,'02052' code from bass2.dual union all
select '01一经接口/02帐务主题/明细帐单' name,'03004' code from bass2.dual union all
select '01一经接口/02帐务主题/综合帐单' name,'03005' code from bass2.dual union all
select '01一经接口/02帐务主题/智能网用户明细收入' name,'03012' code from bass2.dual union all
select '01一经接口/03服务使用/GPRS话单' name,'04002' code from bass2.dual union all
select '01一经接口/03服务使用/彩信话单' name,'04004' code from bass2.dual union all
select '01一经接口/03服务使用/梦网短信话单' name,'04005' code from bass2.dual union all
select '01一经接口/03服务使用/语音杂志短信话单' name,'04014' code from bass2.dual union all
select '01一经接口/03服务使用/TD普通语音业务话单' name,'04017' code from bass2.dual union all
select '01一经接口/03服务使用/上网本GPRS话单' name,'04018' code from bass2.dual union all
select '01一经接口/04详单汇总数据/GSM_TD普通语音业务日使用' name,'21001' code from bass2.dual union all
select '01一经接口/04详单汇总数据/GSM_TD普通语音业务月使用' name,'21003' code from bass2.dual union all
select '01一经接口/04详单汇总数据/智能网语音业务日使用' name,'21004' code from bass2.dual union all
select '01一经接口/04详单汇总数据/智能网语音业务月使用' name,'21006' code from bass2.dual union all
select '01一经接口/04详单汇总数据/普通短信业务日使用' name,'21007' code from bass2.dual union all
select '01一经接口/04详单汇总数据/智能网VPMN业务使用' name,'21009' code from bass2.dual union all
select '01一经接口/05其它数据/各品牌用户日KPI' name,'22038' code from bass2.dual union all
select '01一经接口/05其它数据/竞争对手日KPI' name,'22073' code from bass2.dual union all
select '01一经接口/06TD汇总数据/使用TD网络的客户日汇总' name,'22201' code from bass2.dual union all
select '01一经接口/06TD汇总数据/使用TD网络的客户通话情况日汇总' name,'22202' code from bass2.dual union all
select '01一经接口/06TD汇总数据/使用TD网络的客户数据流量日汇总' name,'22203' code from bass2.dual ) t



select b.*,COLNAME,
INTERFACE_CODE	
,TAB	
,case when length(trim(char(COLNO))) = 1 then '0'||trim(char(COLNO)) else trim(char(COLNO)) end colno
,	TYPENAME	,LENGTH,	NULLS	,AVGCOLLEN
from 
table( 
select interface_code,REPLACE(replace(control_code,'BASS1_',''),'.tcl','') tab
from   mon_all_interface a
, app.sch_control_task b 
,(select * from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
union 
select * from app.g_runlog 
where time_id=201109
and return_flag=1) c
where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.interface_code = c.unit_code
and interface_code 
in
('02047'
,'02004'
,'02052'
,'02008'
,'03004'
,'03012'
,'03005'
,'04018'
,'04002'
,'04017'
,'04004'
,'04005'
,'04014'
,'21007'
,'21009'
,'21006'
,'21004'
,'21001'
,'21003'
,'22038'
,'22073'
,'22201'
,'22203'
,'22202'
)
and control_code like 'BASS1_G%'
and control_code not like 'BASS1_%TO%'
)t,syscat.columns c
,
table(
select path||'/'||name,b.name,b.code
from 
table(
select '01一经接口/01服务主题' path,'用户' name ,'02004' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户状态' name ,'02008' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户使用终端通话情况' name ,'02047' code from bass2.dual union all
select '01一经接口/01服务主题' path,'用户区域归属' name ,'02052' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'明细帐单' name ,'03004' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'综合帐单' name ,'03005' code from bass2.dual union all
select '01一经接口/02帐务主题' path,'智能网用户明细收入' name ,'03012' code from bass2.dual union all
select '01一经接口/03服务使用' path,'GPRS话单' name ,'04002' code from bass2.dual union all
select '01一经接口/03服务使用' path,'彩信话单' name ,'04004' code from bass2.dual union all
select '01一经接口/03服务使用' path,'梦网短信话单' name ,'04005' code from bass2.dual union all
select '01一经接口/03服务使用' path,'语音杂志短信话单' name ,'04014' code from bass2.dual union all
select '01一经接口/03服务使用' path,'TD普通语音业务话单' name ,'04017' code from bass2.dual union all
select '01一经接口/03服务使用' path,'上网本GPRS话单' name ,'04018' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'GSM_TD普通语音业务日使用' name ,'21001' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'GSM_TD普通语音业务月使用' name ,'21003' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网语音业务日使用' name ,'21004' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网语音业务月使用' name ,'21006' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'普通短信业务日使用' name ,'21007' code from bass2.dual union all
select '01一经接口/04详单汇总数据' path,'智能网VPMN业务使用' name ,'21009' code from bass2.dual union all
select '01一经接口/05其它数据' path,'各品牌用户日KPI' name ,'22038' code from bass2.dual union all
select '01一经接口/05其它数据' path,'竞争对手日KPI' name ,'22073' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户日汇总' name ,'22201' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户通话情况日汇总' name ,'22202' code from bass2.dual union all
select '01一经接口/06TD汇总数据' path,'使用TD网络的客户数据流量日汇总' name ,'22203' code from bass2.dual ) b
) b
where t.tab= c.TABNAME
and  c.tabschema = 'BASS1'
and char(t.INTERFACE_CODE) = char(b.code)
order by code,colno






select IFFEEZERO , count(0) 
--,  count(distinct IFFEEZERO ) 
from g_s_03004_03005_R235_adj 
group by  IFFEEZERO 
order by 1 


select count(0) from    G_S_03004_MONTH_ADJ_BAK



ITEM_ID	ITEM_NAME
80000180	BlackBerry功能费
80000184	BlackBerry通信费
80000598	BlackBerry集团客户扩展业务功能费
80000599	BlackBerry集团客户扩展业务通信费
82000111	Black Berry虚科目



select
a.enterprise_id as enterprise_id
,'1520' ent_busi_id
,'3' manage_mod
,case 
  when a.ITEM_ID in (80000180,80000598) then  '060' 
  when a.ITEM_ID in (80000184,80000599) then  '024' 
  else '090' end
  account_item
,sum(a.unipay_fee)*100 as income
from  bass2.dw_enterprise_new_unipay_201107 a
where a.test_mark = 0
and a.ITEM_ID in  (
80000180,80000184,80000598,80000599,80000599,82000111
)
group by
a.enterprise_id
,coalesce(bass1.fn_get_all_dim_160('BASS_STD1_0108',char(a.service_id)),'4002')
,case 
  when a.ITEM_ID in (80000180,80000598) then  '060' 
  when a.ITEM_ID in (80000184,80000599) then  '024' 
  else '090' end




select * 
from  bass2.dw_enterprise_new_unipay_201107 a
where a.test_mark = 0
and a.ITEM_ID in  (
80000180,80000184,80000598,80000599,80000599,82000111
)


select * 
from  bass2.dw_enterprise_new_unipay_201107 a
where a.test_mark = 0
and a.ITEM_ID in  (
80000180,80000184,80000598,80000599,80000599,82000111
)


update  app.sch_control_runlog 
set flag = -2
where  control_code like 'BASS1%INT%MONTH.tcl'
AND DATE(BEGINTIME) >= '2011-08-01'
and runtime < 600
and flag = 0


where control_code in ( 
select control_code  from   app.sch_control_runlog
where control_code like 'BASS1%INT%MONTH.tcl'
AND DATE(BEGINTIME) >= '2011-08-01'
)





 SELECT 
                        SUM(T.JB+T.CT+T.CF) AS FY,
                        COUNT(DISTINCT T.PRODUCT_NO) AS RS
                      FROM (
                             SELECT 
                               PRODUCT_NO,
                               SUM(BIGINT(BASE_CALL_FEE)) AS JB,
                               SUM(BIGINT(TOLL_CALL_FEE)) AS CT,  
                               SUM(BIGINT(callfw_toll_fee)) AS CF
                             FROM 
                               BASS1.G_S_04008_DAY
                             WHERE TIME_ID/100=201107 and roam_type_id not in ('122','202','302','401')
                             GROUP BY PRODUCT_NO
                             UNION ALL
                             SELECT 
                               PRODUCT_NO,
                               SUM(BIGINT(BASE_CALL_FEE)) AS JB,
                               SUM(BIGINT(TOLL_CALL_FEE)) AS CT,  
                               SUM(BIGINT(0)) AS CF
                             FROM 
                               BASS1.G_S_04009_DAY
                             WHERE TIME_ID/100=201107
                             GROUP BY PRODUCT_NO
                           )T
                           

select * from   G_S_22403_MONTH
                           
                           
insert into app.sch_control_before values 
 ('BASS1_G_S_22058_MONTH.tcl' , 'BASS1_G_S_22057_MONTH.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_G_S_22059_MONTH.tcl' , 'REP_stat_market_0135_a.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_G_S_22060_MONTH.tcl' , 'BASS1_G_S_22059_MONTH.tcl')
;


                           
                           
insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_22058_MONTH' , 'BASS1_G_S_22058_MONTH.tcl')
;

insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_22060_MONTH' , 'BASS1_G_S_22060_MONTH.tcl')
;


                           
delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_22058_MONTH.tcl','BASS1_EXP_G_S_22058_MONTH');
delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_22060_MONTH.tcl','BASS1_EXP_G_S_22060_MONTH');

                           

insert into app.sch_control_task values('BASS1_G_S_22058_MONTH.tcl' , 2 , 2 , 'int -s G_S_22058_MONTH.tcl' ,-1,-1,'已确认养卡渠道名单' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');

insert into app.sch_control_task values('BASS1_G_S_22060_MONTH.tcl' , 2 , 2 , 'int -s G_S_22060_MONTH.tcl' ,-1,-1,'已确认窜卡渠道名单' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');

insert into app.sch_control_task values('BASS1_EXP_G_S_22058_MONTH' , 2 , 2 , 'bass1_export bass1.g_s_22058_month LASTMONTH()' ,-1,-1,'EXPORT_of 已确认养卡渠道名单' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');

insert into app.sch_control_task values('BASS1_EXP_G_S_22060_MONTH' , 2 , 2 , 'bass1_export bass1.g_s_22060_month LASTMONTH()' ,-1,-1,'EXPORT_of 已确认窜卡渠道名单' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');




                           
                           select unit_code from app.g_runlog 
where time_id= 201107




except
select substr(a.filename,16,5)
FROM 
(
    select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 




update app.sch_control_task 
set cc_flag = 2
where control_code = 'BASS1_EXP_G_S_22065_MONTH'
and cc_flag = 1


BASS1_EXP_G_S_22062_MONTH
BASS1_EXP_G_S_22064_MONTH
BASS1_EXP_G_S_22065_MONTH



update app.sch_control_task a 
set FUNCTION_DESC = '[暂缓]'||FUNCTION_DESC
where control_code =  'BASS1_EXP_G_S_22065_MONTH'
and cc_flag = 2

select * from   app.sch_control_task a  where control_code in ('BASS1_EXP_G_S_22062_MONTH','BASS1_EXP_G_S_22064_MONTH','BASS1_EXP_G_S_22065_MONTH')


select * from    bass1.g_a_02011_day 

select * from G_S_21003_MONTH fetch first 10 rows only  

select time_id / 100 from G_S_04002_DAY  fetch first 10 rows only  


select * from   G_S_21003_TO_DAY


 drop table INT_0400810_201109
 
 select tabname from syscat.tables where tabname like '%INT_210012916%'
  
 select * from INT_02004_02008_201105 fetch first 10 rows only 
 
 
 drop table INT_22401_yyyymm
 
 
CREATE TABLE "BASS1   "."INT_22401_201110"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "CELL_ID" CHAR(10) , 
                  "LAC_ID" CHAR(10) , 
                  "CALL_CNT" bigint )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "CELL_ID",  
                 "LAC_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select * from    bass1.int_22401_201108



select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from bass1.int_22401_201108 
group by  TIME_ID 
order by 1 



$ gb G_I_06021_MONTH CHANNEL_TYPE


select time_id,CHANNEL_TYPE , count(0) 
--,  count(distinct CHANNEL_TYPE ) 
from G_I_06021_MONTH 
group by time_id, CHANNEL_TYPE 
order by 1 




select * from   bass2.Cdr_call_dtl_20110808
where product_no = '13989007120'


select TIME_ID,BASE_PKG_ID , count(0) 
--,  count(distinct TIME_ID||BASE_PKG_ID ) 
from G_S_02024_DAY 
where BASE_PKG_ID  like 'QW%'
group by  TIME_ID,BASE_PKG_ID 
order by 1 

select * from   G_S_02024_DAY
where user_id = '89160001196765'


select * from   bass2.dw_product_20110808 where product_no = '13989007120'
89160001196765	89160000999178	89160001263836	26	3	1	0	1	0	[NULL]	[NULL]	13989007120	[NULL]	[NULL]	[NULL]	891	891	1082	10010002	11111144	4	[NULL]	300062850665	0	1	1	1	1	10	101	89110016	1	0	1	1	0	0	1	0	0	1	0	0	1	1	1	1	1	0	1	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	2011-08-08 	2011-08-08 	2011-08-08 	2099-12-31 	1	1	1	0	0.00	0.00	0.00	0.00	1	1	1	0	0.00	0.00	0.00	0.00	100.00	0.00


select time_id,RESULT1 from   bass2.stat_market_0137
where city_id = '890'
order by 1 desc 



select TIME_ID 
 ,count(0) 
 ,count(distinct user_id)
--,  count(distinct TIME_ID||BASE_PKG_ID ) 
from G_S_02024_DAY 
where BASE_PKG_ID  like 'QW%'
group by  TIME_ID 
order by 1 desc 

select distinct user_id 
from G_S_02024_DAY where time_id = 20110805
and BASE_PKG_ID  like 'QW%'
except
select distinct product_instance_id
    from 
       (
select a.*
                            ,row_number()over(partition by a.product_instance_id order by a.offer_id ) rn 
                            from bass2.dw_product_ins_off_ins_prod_ds a,            
               bass2.dim_qqt_offer_id b
                            where a.offer_id=b.offer_id
                              and b.index=1
                              and date(a.create_date)= '2011-08-05'
                              and date(a.expire_date)> '2011-08-05'
              ) a,
              bass2.dw_product_20110805 c
    where a.product_instance_id=c.user_id
      and a.rn=1
      
      
      

select distinct user_id 
from G_S_02024_DAY where time_id = 20110726
and BASE_PKG_ID  like 'QW%'
except
select distinct product_instance_id
    from 
       (
select a.*
                            ,row_number()over(partition by a.product_instance_id order by a.offer_id ) rn 
                            from bass2.dw_product_ins_off_ins_prod_ds a,            
               bass2.dim_qqt_offer_id b
                            where a.offer_id=b.offer_id
                              and b.index=1
                              and date(a.create_date)= '2011-07-26'
                              and date(a.expire_date)> '2011-07-26'
              ) a,
              bass2.dw_product_20110726 c
    where a.product_instance_id=c.user_id
      and a.rn=1
      
      
      

89160001149937      
89160001149952      


      
select * from   G_S_02024_DAY
where user_id in( '89160001149937'     ,'89160001149952' )

select TIME_ID , count(0) ,count(distinct user_id)
--,  count(distinct TIME_ID||BASE_PKG_ID ) 
from G_S_02024_DAY 
where BASE_PKG_ID not  like 'QW%'
group by  TIME_ID 
order by 1 



select tabname from syscat.tables where lower(tabname) like '%product_ins_off_ins_prod%'   





select user_id  ,count(0) 
from G_S_02024_DAY where time_id = 20110805
and BASE_PKG_ID  like 'QW%'
group by user_id having count(0) > 1



USER_ID
89560001183255      
89560001183298      
89560001186473      


    
select * from   G_S_02024_DAY
where user_id in( '89560001183255'     ,'89560001183298', '89560001186473')
and  time_id = 20110805
select 
(
select * from 
 bass2.dim_qqt_offer_id  where INDEX = 2
 ) a
 
 
 SELECT * FROM BASS2.dim_prod_up_offer 
		WHERE OFFER_TYPE='OFFER_PLAN'
		and TRADEMARK = 161000000001
        
        
 
 
 select offer_id from 
 bass2.dim_qqt_offer_id  where INDEX = 2
 except
  SELECT offer_id FROM BASS2.dim_prod_up_offer 
		WHERE OFFER_TYPE='OFFER_PLAN'
		and TRADEMARK = 161000000001
        
        

 
 

 
  SELECT offer_id FROM BASS2.dim_prod_up_offer 
		WHERE OFFER_TYPE='OFFER_PLAN'
		and TRADEMARK = 161000000001
        except
 select offer_id from 
 bass2.dim_qqt_offer_id  where INDEX = 2        
        
        
        
select * from 
bass2.dim_prod_up_product_item
where product_item_id in (

 select offer_id from 
 bass2.dim_qqt_offer_id  where INDEX = 2
 except
  SELECT offer_id FROM BASS2.dim_prod_up_offer 
		WHERE OFFER_TYPE='OFFER_PLAN'
		and TRADEMARK = 161000000001
)        
        
        
        
        
select * from 
bass2.dim_prod_up_product_item
where product_item_id in (

 select offer_id from 
 bass2.dim_qqt_offer_id  where INDEX = 1     
)





select * from   BASS2.dim_prod_up_offer 
where offer_id in (

 select offer_id from 
 bass2.dim_qqt_offer_id  where INDEX = 2
 except
  SELECT offer_id FROM BASS2.dim_prod_up_offer 
		WHERE OFFER_TYPE='OFFER_PLAN'
		and TRADEMARK = 161000000001
)        


111090001312


select * from   
bass2.Dw_product_ins_off_ins_prod_ds a
where offer_id = 111090001312
	and date(a.CREATE_DATE) > '2011-06-01'
	and date(a.VALID_DATE)>= '2011-06-01'
	and date(a.expire_date) >=  '2011-06-01'
    
    
    select * from   bass2.dw_product_20110808 where user_id = '89160000971111'
    
    
    
    
    
    89560001183255      
    
    
    
    select *
    from 
       (
select a.*
                            ,row_number()over(partition by a.product_instance_id order by a.offer_id ) rn 
                            from bass2.dw_product_ins_off_ins_prod_ds a,            
               bass2.dim_qqt_offer_id b
                            where a.offer_id=b.offer_id
                              and b.index=1
                              and date(a.create_date)= '2011-08-05'
                              and date(a.expire_date)> '2011-08-05'
              ) a,
              bass2.dw_product_20110805 c
    where a.product_instance_id=c.user_id
      and a.product_instance_id = '89560001183255'
      
      
      
      
      OFFER_ID
111090001334

select * 
		from  BASS1.ALL_DIM_LKP 
		where BASS1_TBID = 'BASS_STD1_0114'
        and xzbas_value in( '111090001334','111090001335' )
        



select TIME_ID 
, count(distinct case when  BASE_PKG_ID  like 'QW%' then user_id end ) 
, count(distinct case when  BASE_PKG_ID not like 'QW%' then user_id end ) 
--,  count(distinct TIME_ID||BASE_PKG_ID ) 
from G_S_02024_DAY
group by  TIME_ID 
order by 1 desc
        
        

select count(*) from 
                    (
                     select distinct BASE_PKG_ID from bass1.G_S_02024_DAY
                      where time_id =20110727
                       except
                  select distinct BASE_PROD_ID from G_I_02018_MONTH where time_id = 201109
                    ) as a


1
111090001311                  
111099001686                  
111099001685                  
111090001312                  


        
select * from 
bass2.dim_prod_up_product_item
where product_item_id in (
111090001311,111099001686,111099001685,111090001312
)



                     select distinct BASE_PKG_ID from bass1.G_S_02024_DAY
                      where time_id =20110727
                       except
                  select distinct BASE_PROD_ID from G_I_02018_MONTH where time_id = 201105


SELECT char(offer_id) from bass2.dim_qqt_offer_id  where INDEX = 2      
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'

                       except
                  select distinct BASE_PROD_ID from G_I_02018_MONTH where time_id = 201107




select index , count(0) 
--,  count(distinct index ) 
from bass2.dim_qqt_offer_id 
group by  index 
order by 1 
                    
                    

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_02025_DAY 
group by  time_id 
order by 1 

                    
                    
select * from   G_A_02060_DAY
                    
                    
                   
select * from    bass2.dim_prod_up_product_item  where name like '%JT138%'                   


select tabname from syscat.tables where tabname like '%BLACK%'   
select * from   bass2.ST_BLACKBERRY_GROW_MM

select * from   bass2.ODS_PRODUCT_INS_PROD_BLACK_201108



select TIME_ID,BASE_PKG_ID , count(0) 
--,  count(distinct TIME_ID||BASE_PKG_ID ) 
from G_S_02024_DAY 
where BASE_PKG_ID  like 'QW%'
group by  TIME_ID,BASE_PKG_ID 
order by 1 



ALTER TABLE BASS1.G_S_02024_DAY_1 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

insert into bass1.G_S_02024_DAY_1
select 
        20110727 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201107 a 
        , bass2.dw_product_20110727 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-07-27'
        and date(a.VALID_DATE)>= '2011-07-27'
        and date(a.expire_date) >= '2011-07-27'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110727 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) from bass2.dim_qqt_offer_id  where INDEX = 2      
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )

select count(0) from 
table(
select time_id
        ,a.user_id
        , value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID),a.BASE_PKG_ID) BASE_PKG_ID
        , value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
        , a.REC_DT
        , a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
where a.base_pkg_id not in (SELECT 
                        distinct XZBAS_VALUE
                FROM BASS1.ALL_DIM_LKP 
                WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
) a
where BASE_PKG_ID  like 'QW%'




 
rename G_S_02024_DAY to G_S_02024_DAY_20110810

CREATE TABLE "BASS1   "."G_S_02024_DAY"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "BASE_PKG_ID" CHAR(30) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "REC_DT" CHAR(8) , 
                  "VALID_DT" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "BASE_PKG_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select * from   G_S_02024_DAY



 select count(0) dup_cnt
        from (
                select time_id,user_id,BASE_PKG_ID, count(0)  cnt
                from bass1.G_S_02024_DAY
                group by time_id,user_id,BASE_PKG_ID having count(0) > 1
                ) t 
                

select time_id , count(0) 
,  count(distinct user_id ) 
from G_S_02024_DAY 
where BASE_PKG_ID  like 'QW%'
group by  time_id 
order by 1 
                
                

TIME_ID	USER_ID	BASE_PKG_ID	CNT
20110928	89160000975173      	QW_QQT_JC_SL128               	2
20110725	89160001144022      	QW_QQT_JC_SL128               	2

select * from   G_S_02024_DAY where  user_id = '89160000975173'

20110928	89160000975173      	QW_QQT_JC_SL128               	10100103                                	20110928	20110701
20110928	89160000975173      	QW_QQT_JC_SL128               	10100103                                	20110928	20110928


select * from                bass2.Dw_product_ins_off_ins_prod_201109 where product_instance_id = '89160000975173'

USER_ID
89160000975173      
89160001144022      

select * from                bass2.Dw_product_ins_off_ins_prod_201109 where product_instance_id = '89160000975173'


select count(0) from    G_S_02024_DAY_1

select * from    bass1.G_S_02024_DAY_1



select distinct  user_id 
from G_S_02024_DAY where time_id = 20110711
and BASE_PKG_ID  like 'QW%'
except
select distinct product_instance_id
    from 
       (
select a.*
                            ,row_number()over(partition by a.product_instance_id order by a.offer_id ) rn 
                            from bass2.dw_product_ins_off_ins_prod_201107 a,            
               bass2.dim_qqt_offer_id b
                            where a.offer_id=b.offer_id
                              and b.index=1
                              and date(a.create_date)= '2011-07-11'
                              and date(a.expire_date)>  '2011-07-11'
              ) a,
              bass2.dw_product_20110711 c
    where a.product_instance_id=c.user_id
      and a.rn=1
      except
select distinct user_id 
from G_S_02024_DAY where time_id = 20110711
and BASE_PKG_ID  like 'QW%'


select  * 
from G_S_02024_DAY where time_id = 20110517
and user_id = '89160000912283'

      
select * from   bass2.dw_product_ins_off_ins_prod_201105 where product_instance_id = '89160000912283'

select * from   bass2.dw_product_


select 
        20110928 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_20110517 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-17'
        and date(a.VALID_DATE)>= '2011-05-17'
        and date(a.expire_date) > '2011-05-17'
        and  product_instance_id = '89160000912283'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110517 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )





select 
        20110517 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_20110517 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-17'
        and date(a.VALID_DATE)>= '2011-05-17'
        and date(a.expire_date) >= '2011-05-17'
                        and  product_instance_id = '89160000912283'

        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110517 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )


        
        
        BASE_PKG_ID
        

select * from    bass2.dim_prod_up_product_item  where product_item_id = 111090001351
       OFFER_ID
111090001351


select * from   bass2.dw_product_ins_off_ins_prod_201107 where product_instance_id = '89160000912283'

select * from   bass2.dw_product_20110808 where user_id = '89160000912283'



                     select distinct BASE_PKG_ID from bass1.G_S_02024_DAY
                       except
                  select distinct BASE_PROD_ID from G_I_02018_MONTH where time_id = 201105
                  


select TIME_ID , count(0) 
--,  count(distinct TIME_ID ) 
from G_S_02025_DAY 
group by  TIME_ID 
order by 1 

                  
select * from   G_S_02025_DAY
                  
                  
                 
select a.OFFER_ID,count(distinct product_instance_id)
from table(
			select product_instance_id,a.offer_id
			 from (
			 select a.product_instance_id,c.city_id,a.offer_id,a.create_date,a.expire_date,a.valid_date
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id
         from bass2.dw_product_ins_off_ins_prod_ds a,
              bass2.dw_product_20110808 c
        where a.product_instance_id=c.user_id
          and c.test_mark<>1
          and date(a.create_date)= '2011-08-08'
			    and date(a.expire_date)>='2011-08-08'
                        and char(a.offer_id) in (
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0115'
        )
            ) a
			where a.row_id=1
) a 
group by  a.OFFER_ID


select 
            count(distinct case when  a.offer_id in (111090001363) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001364) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001365) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001366) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001367) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001368) then  a.product_instance_id end)
from table(
			select product_instance_id,a.offer_id
			 from (
			 select a.product_instance_id,c.city_id,a.offer_id,a.create_date,a.expire_date,a.valid_date
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id
         from bass2.dw_product_ins_off_ins_prod_ds a,
              bass2.dw_product_20110808 c
        where a.product_instance_id=c.user_id
          and c.test_mark<>1
          and date(a.create_date)= '2011-08-08'
			    and date(a.expire_date)>='2011-08-08'
                        and char(a.offer_id) in (
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0115'
        )
            ) a
			where a.row_id=1
) a

select 
        201108 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) ADD_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110726 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-07-26'
        and date(a.VALID_DATE)>= '2011-07-26'
        and date(a.expire_date) >= '2011-07-26'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110726 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0115'
        )




select * from   bass2.stat_market_0137
where city_id = '890'
order by 1 desc 

select ADD_PKG_ID,count(distinct user_id)  from   G_S_02025_DAY where time_id = 20110808
group by ADD_PKG_ID

                 
                 


			select 20110808,
			       '890',
            count(distinct case when  a.offer_id in (111090001363) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001364) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001365) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001366) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001367) then  a.product_instance_id end),
            count(distinct case when  a.offer_id in (111090001368) then  a.product_instance_id end)
			 from (
			 select a.product_instance_id,c.city_id,a.offer_id,a.create_date,a.expire_date,a.valid_date
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id
         from bass2.dw_product_ins_off_ins_prod_ds a,
              bass2.dw_product_20110808 c
        where a.product_instance_id=c.user_id
          and c.test_mark<>1
          and date(a.create_date)='2011-08-08'
			    and date(a.expire_date)> '2011-08-08'
            ) a
			where a.row_id=1
                 
                 

select count(0)     
			 from (
			 select a.product_instance_id,c.city_id,a.offer_id,a.create_date,a.expire_date,a.valid_date
             ,row_number() over(partition by a.product_instance_id order by a.create_date desc) row_id
         from bass2.dw_product_ins_off_ins_prod_ds a,
              bass2.dw_product_20110808 c
        where a.product_instance_id=c.user_id
          and c.test_mark<>1
          and date(a.create_date)='2011-08-08'
and                  a.offer_id in (111090001363,111090001364,111090001365,111090001366,111090001367,111090001368)

			    and date(a.expire_date)> '2011-08-08'
            ) a
			where a.row_id=1
        
        
        
    20110808 time_id
	,a.PRODUCT_INSTANCE_ID USER_ID
	,char(a.offer_id) ADD_PKG_ID
	,char(a.ORG_ID) CHANNEL_ID
	,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
	,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT    

select distinct PRODUCT_INSTANCE_ID
	
from  bass2.Dw_product_ins_off_ins_prod_ds a 
	, bass2.dw_product_20110808 b 
where  a.state =1 
	and a.PRODUCT_INSTANCE_ID=b.user_id 
	and b.usertype_id in (1,2,9) 
	and b.userstatus_id in (1,2,3,6,8)
	and a.valid_type in (1,2)
	and date(a.CREATE_DATE) = '2011-08-08'
	and date(a.VALID_DATE)>= '2011-08-08'
	and date(a.expire_date) >= '2011-08-08'
        and a.offer_id in (111090001363,111090001364,111090001365,111090001366,111090001367,111090001368)

rename G_S_02025_DAY to G_S_02025_DAY_20110811

CREATE TABLE "BASS1   "."G_S_02025_DAY"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "ADD_PKG_ID" CHAR(30) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "REC_DT" CHAR(8) , 
                  "VALID_DT" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "ADD_PKG_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 





                select time_id,user_id,BASE_PKG_ID,count(0)  cnt
                from bass1.G_S_02024_DAY
                group by time_id,user_id,BASE_PKG_ID having count(0) > 1


      


select 
        a.*
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_20110517 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-17'
        and date(a.VALID_DATE)>= '2011-05-17'
        and date(a.expire_date) >= '2011-05-17'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110517 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0115'
        )
  and      a.PRODUCT_INSTANCE_ID = '89160000911319'

select * from   G_S_02025_DAY where user_id = '89160000911319'           

20110517	89160000911319      	QW_QQT_DJ_ZX0001              	91000853                                	20110517	20110517

delete from G_S_02025_DAY where time_id = 20110517
and user_id = '89160000911319'
and valid_dt = '20110517'

select count(0) from    G_S_02024_DAY where time_id <= 20110731


select tabname from syscat.tables where tabname like '%02024%'   

G_S_02024_DAY
G_S_02024_DAY_20110810


insert into G_S_02024_DAY 
select * from G_S_02024_DAY_20110810 where time_id >= 20110801


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_02025_DAY
group by  time_id 
order by 1 



insert into G_S_02025_DAY 
select * from G_S_02025_DAY_20110811 where time_id >= 20110801



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_02025_DAY
group by  time_id 
order by 1 

drop table G_S_02025_DAY_20110811
drop table G_S_02024_DAY_20110810


bass2.ODS_MISC_JUNK_SMS_YYYYMM

select tabname from syscat.tables where tabname like '%JUNK_SMS%'   

select * from   bass2.ODS_MISC_JUNK_SMS_201107


select * from   bass2.ODS_MISC_JUNK_SMS_20110810



select * from app.g_runlog 
where unit_code = '02024'
and return_flag=1

select * from   G_A_02054_DAY_FIX20110812


insert into G_A_02054_DAY_FIX20110812
select 
         20110812 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201108 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
and    ENTERPRISE_ID  in (select ENTERPRISE_ID from bass2.DIM_TEST_ENTERPRISE)             




CREATE TABLE "BASS1   "."G_A_02054_DAY_FIX20110812"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




CREATE TABLE "BASS1   "."G_A_02064_DAY_FIX20110812"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENTERPRISE_BUSI_TYPE" CHAR(4) , 
                  "MANAGE_MODE" CHAR(1) , 
                  "CDR_NUM_CNT" CHAR(3) , 
                  "SMS_NUM_CNT" CHAR(3) , 
                  "NUM_ALL_CNT" CHAR(4) , 
                  "NUM_MOBILE_CNT" CHAR(4) , 
                  "NUM_OTHER_CNT" CHAR(4) , 
                  "ORDER_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("ENTERPRISE_ID",  
                 "TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select 
        ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from (SELECT * FROM g_a_02054_day
UNION ALL 
SELECT * FROM G_A_02054_DAY_FIX20110812 )  A              where 
                 time_id/100 <= 201108 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
and   ENTERPRISE_ID  in (select ENTERPRISE_ID from bass2.DIM_TEST_ENTERPRISE)   
                
                


select * from    bass2.dw_enterprise_msg_201101
where   ENTERPRISE_ID  in (select ENTERPRISE_ID from bass2.DIM_TEST_ENTERPRISE)   


select * from BASS2.DWD_49001_201107_bakexceptselect * from bass2.DWD_49001_201107

select count(0) from     bass2.DWD_49001_201107_bak



select   distinct tac_num                   from   BASS2.DIM_TACNUM_DEVID a                         ,BASS2.DIM_DEVICE_INFO    b                           ,(select * from  BASS2.DIM_DEVICE_PROFILE   where PROPERTY_ID =  '003001' 
                          
select * from    BASS2.DIM_TACNUM_DEVID 

select * from   BASS2.DIM_DEVICE_INFO

select * from    BASS2.DIM_DEVICE_PROFILE 

select count(0),count(distinct DEVICE_ID ) from    BASS2.DIM_DEVICE_PROFILE 
                          
select time_id , count(0) 
--,  count(distinct time_id ) 
from   BASS2.DIM_DEVICE_PROFILE 
group by  time_id 
order by 1 


                          



select interface_code from bass1.mon_all_interface where type = 'd'
except
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1
                          
select *
from  bass1.mon_all_interface
where type = 'd'
and sts <> 1

select deadline,count(0)
from  bass1.mon_all_interface
where type = 'd'
and sts = 1
group by deadline




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22066_DAY 
group by  time_id 
order by 1 

select tabname from syscat.tables where tabname like '%22066%'   
                         
                         
select sum(bigint(ACTIVATE_CNT)) from G_S_22066_DAY

select * from   G_S_22066_DAY



select tabname from syscat.tables where lower(tabname) like '%wcc_user_action%'                             


select count(0),count(distinct product_no ) from    BASS2.VGOP_11210_201109



select * from   bass1.mon_all_interface where type = 'd' and deadline = 15


select * from   bass1.mon_all_interface 
where type = 'm' and deadline = 8
and sts = 1
order by 1


select type , deadline ,count(0) 
from bass1.mon_all_interface 
where sts = 1
and interface_name not like '%校园%'
group by  type , deadline




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22065_MONTH 
group by  time_id 
order by 1 



select time_id,sum(bigint(ZZHI_CNT))
from G_S_22065_MONTH
group by time_id



select * from bass2.DIM_PROD_UP_PRODUCT_ITEM where product_item_id in (191000000007,191000000008);

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22067_MONTH 
group by  time_id 
order by 1 



select count(0),count(distinct OPERATOR_CODE||char(SP_CODE) ) from     bass2.Dim_pm_sp_operator_code


select tabname from syscat.tables where tabname like '%DIM%PAYTYPE%'   
select * from   bass2.DIM_ACCT_PAYTYPE
 where paytype_id in ('4101','4801','4132','GJFFZ','GJFKH','4103','GJFY1',
                                         'gJFG','GJFg','4158','GJFG')
                                         

where  paytype_id in ('4162','4864')




                     select a.region_id,105,
                            case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end ,sum( cnt)
                                 from
                                    ( select a.region_id,
                                            case when b.PAYTYPE_ID in ('4464','4864') then 4 
                                                 when b.PAYTYPE_ID in ('4468') then 5 
                                                 else 6 end as class
                                                 ,count(0) as cnt
                            from  bass2.dw_product_20110817 a,  (select * from bass2.dw_acct_payitem_dm_201108 where op_time = '2011-08-17') b
                            where a.user_id=b.user_id and b.PAYTYPE_ID in ('4464','4864','4468','SJJF2','4115')
                            group by  a.region_id,
                                      case when b.PAYTYPE_ID in ('4464','4864') then 4 
                                                 when b.PAYTYPE_ID in ('4468') then 5 
                                                 else 6 end
                          )  a
                                    group by a.region_id,105,
                                             case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end
                            
                            
                            

  select b.region_id,106,205,count(distinct a.product_instance_id)
         from 
         (select distinct product_instance_id
         from bass2.dw_product_ord_cust_dm_201108 a
         where channel_type='9'
         and  date(a.OP_TIME) = '2011-08-17'
         union
         select distinct user_id as product_instance_id
               from bass2.dw_acct_payitem_dm_201108 a
               where paytype_id in ('4162','4864')
                and  date(a.OP_TIME) = '2011-08-17'
         ) a
         , bass2.dw_product_20110817 b
         where a.product_instance_id = b.user_id
         group by  b.region_id 
         with ur 

                            

select * from   G_S_22066_DAY
order by 3
                            
                            


                     select a.region_id,105,
                            case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end , sum(cnt)
                                 from
                                    ( select a.region_id,
                                            case when b.PAYTYPE_ID in ('4464','4864') then 4 
                                                 when b.PAYTYPE_ID in ('4468') then 5 
                                                 else 6 end as class
                                                 ,count(0) cnt
                            from  bass2.dw_product_20110817 a
                            ,  (select * from bass2.dw_acct_payitem_dm_201108 where op_time = '2011-08-17') b
                            where a.user_id=b.user_id 
                                        and b.PAYTYPE_ID in ('4464','4864','4468','SJJF2','4115')
                            group by  a.region_id,
                                      case when b.PAYTYPE_ID in ('4464','4864') then 4 
                                                 when b.PAYTYPE_ID in ('4468') then 5 
                                                 else 6 end
                          )  a
                                    group by a.region_id,105,
                                             case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end

                            
                            


select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1


select                             


select user_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107



select user_id
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107 
           ) f 
where    f.row_id=1 
           
except
select user_id
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
where e.row_id=1

           
           
           
45868.00	1350122.00

values              45868.00/     1350122.00

    
    
    
select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num = '15913269062'
and message_content like '%003%'
order by send_time desc 




select * from 


---------------------------------------------------------------------------------
select * from  app.sch_control_alarm 
where control_code like '%INT_CHECK_02004_02008_DAY%'
order by alarmtime desc 



select * from   app.sch_control_runlog_his
where control_code like '%INT_CHECK_02004_02008_DAY%'


select tabname from syscat.tables where tabname like '%02004%'   

select * from  table( bass1.get_before('02004')) a 



select * from   g_a_02008_day
where user_id = '89660001124444'
20110718	89660001124444      	2010
20110725	89160001144569      	2010


89160001144569      
89660001124444      89160001144569      


select * from   g_a_02008_day
where user_id = '89160001144569'


20110725	89160001144569      	2010




select * from bass2.dw_product_20110808
where user_id in ('89660001124444','89160001144569')




CUST_ID
89603000305818
89160000959765


select * from   



select * from 
bass1.g_rule_check where rule_code = 'R235'
and time_id >20110902





select count(0),count(distinct USER_ID ) from    CHECK_0200402008_DAY_1
2560536	2560536

select count(0),count(distinct USER_ID ) from    CHECK_0200402008_DAY_2
2560551	2560551


select distinct user_id  from CHECK_0200402008_DAY_2
except 
select distinct user_id  from CHECK_0200402008_DAY_1



                    select
                         20110818
                        ,user_id
                        ,usertype_id
                        from
                        (
                          select
                           user_id
                           ,usertype_id
                          from 
                           BASS1.INT_02004_02008_201108
                          where
                           op_time=20110818
                           and usertype_flag=1
                        )a
                        
                        
                        


                    select
                     user_id
                     ,'0'
                     ,usertype_id
                     ,0
                     ,1
                     from
                     (
                       select
                         user_id
                         ,case 
                            when userstatus_id=1 and stopstatus_id=0 then '1010'
                            when userstatus_id=1 and stopstatus_id between 11 and 16 then '1031'
                            when userstatus_id=1 and stopstatus_id in (28,29) then '1032'
                            when userstatus_id=9 then '2030'
                            when userstatus_id=1 and stopstatus_id not in (0,11,12,13,14,15,16,28,29) then '1039' 
                            when userstatus_id in (3,6) then '1022'
                            when userstatus_id in (2)   then '1021'
                            when userstatus_id=4 then '2010'
                            when userstatus_id=8 then '1040'
                            when userstatus_id in (5,7) then '2020' 
                            else '1039' 
                           end as usertype_id
                         from 
                           bass2.dw_product_bass1_20110818 
                         where 
                           userstatus_id<>0
                           and usertype_id in (1,2,9)
                       except
                        select a.user_id,a.usertype_id from BASS1.G_A_02008_DAY a,
                           (select max(time_id) as time_id,user_id from BASS1.G_A_02008_DAY 
                            where time_id<20110818 
                            group by user_id
                            )b
                           where a.user_id = b.user_id and a.time_id=b.time_id
                       )aa
where user_id = '89157332677864'

select *
                         from 
                           bass2.dw_product_bass1_20110818 
                           where user_id = '89157332677864'

select *
                         from 
                           bass2.dw_product_bass1_20110817
                           where user_id = '89157332677864'
                           
                           

select a.user_id,a.usertype_id from BASS1.G_A_02008_DAY a,
                           (select max(time_id) as time_id,user_id from BASS1.G_A_02008_DAY 
                            where time_id<20110818 
                            group by user_id
                            )b
                           where a.user_id = b.user_id and a.time_id=b.time_id
and   a.user_id = '89157332677864'                          

select * from 
 BASS1.INT_02004_02008_201108
 where user_id = '89157332677864'

select * from 
BASS1.TEMP_CHECK_02008_D
where user_id = '89157332677864'

product_xhx4

select * from 
BASS1.CHECK_0200402008_DAY_4
where user_id = '89157332677864'

select * from   CHECK_0200402008_DAY_4
  select product_no
   from  CHECK_0200402008_DAY_4
   group by product_no
   having count(*) >=2 
   
   13618902345    
 
 select * from 
BASS1.product_xhx4
where user_id = '89157332677864'

select * from 
bass1.g_a_02004_02008_stage
where user_id = '89157332677864'


select * from 
bass1.g_a_02004_02008_stage
where product_no = '13618902345'

select * from 
CHECK_0200402008_DAY_2
where user_id = '89157332677864'
89157332677864      	2020



select * from 
G_A_02008_DAY
where user_id = '89157332677864'


   select user_id,usertype_id from
   (
   select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id from G_A_02008_DAY
   where time_id<=20110818
   ) k
   where k.row_id=1 
   and k.usertype_id not in ('2010','2020','2030','9000')
   and user_id = '89157332677864'
   
   
     select product_no,count(*)
   from  CHECK_0200402008_DAY_4
   group by product_no
   having count(*) >=2 
   
   CHECK_0200402008_DAY_2
   
   BASS1.TEMP_CHECK_02008_D 
   
   select * from 
 BASS1.TEMP_CHECK_02008_D 
where user_id = '89157332677864'

                    select
                         20110818
                        ,user_id
                        ,usertype_id
                        from
                        (
                          select
                           user_id
                           ,usertype_id
                          from 
                           BASS1.INT_02004_02008_201108
                          where
                           op_time=20110818
                           and usertype_flag=1
                        )a
                        where user_id = '89157332677864'

   select user_id,usertype_id from
   (
   select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id from G_A_02008_DAY
   where time_id<=20110818
   ) k
   where k.row_id=1 
   and k.usertype_id not in ('2010','2020','2030','9000')
and  user_id = '89157332677864'   with ur
   
   
   select distinct 20110818,user_id,'2020' from G_A_02004_DAY where user_id in(select user_id from product_xhx4) with ur
   
   
   select distinct 20110818,user_id,'2020' from G_A_02004_DAY where user_id in(select user_id from product_xhx4) with ur
   
    DELETE FROM BASS1.G_A_02008_DAY where time_id=20110818
    
   
   ALTER TABLE PRODUCT_XHX3 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE
   ALTER TABLE CHECK_0200402008_DAY_1 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE
   
   insert into CHECK_0200402008_DAY_1
select user_id,product_no,usertype_id,sim_code from
 (
 select user_id,product_no,usertype_id,sim_code,row_number()over(partition by user_id order by time_id desc) row_id from G_A_02004_DAY
 where time_id<=20110818
 ) k
 where k.row_id=1 
 and k.usertype_id <> '3'
 with ur
 
 ALTER TABLE CHECK_0200402008_DAY_2 ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE
 
 select * from  CHECK_0200402008_DAY_2
 
 
 	select a.product_no from CHECK_0200402008_DAY_1 a,
         CHECK_0200402008_DAY_2 b
         where a.user_id=b.user_id
 and b.user_id = '89157332677864'

 insert into CHECK_0200402008_DAY_2
   select user_id,usertype_id from
   (
   select user_id,usertype_id,row_number()over(partition by user_id order by time_id desc) row_id from G_A_02008_DAY
   where time_id<=20110818
   ) k
   where k.row_id=1 
   and k.usertype_id not in ('2010','2020','2030','9000') with ur
   
    select distinct 20110818,user_id,'2020' from G_A_02004_DAY where user_id in(select user_id from product_xhx4) with ur
    
 
select * from   PRODUCT_XHX3
  
 
 select * from 
CHECK_0200402008_DAY_2
where user_id = '89157332677864'


CHECK_0200402008_DAY_4

select * from   CHECK_0200402008_DAY_4
where product_no = '13618902345    '


	select a.product_no from CHECK_0200402008_DAY_1 a,
         CHECK_0200402008_DAY_2 b
         where a.user_id=b.user_id
         and a. product_no = '13618902345'
         
         
         CHECK_0200402008_DAY_1
         
         
select user_id,product_no,usertype_id,sim_code from
 (
 select user_id,product_no,usertype_id,sim_code,row_number()over(partition by user_id order by time_id desc) row_id from G_A_02004_DAY
 where time_id<=20110818
 ) k
 where k.row_id=1 
 and k.usertype_id <> '3'
 and  product_no = '13618902345'
 with ur

select * from   G_A_02004_DAY
where     product_no = '13618902345'
      
      
USER_ID
89157332677864      
89160001230429      
89160001234641      

select * from G_A_02008_DAY       where user_id = '89157332677864'

select * from bass2.dw_product_20110818 where user_id = '89160001234641'

select count(0),count(distinct user_id ) from  G_A_02008_DAY where time_id = 20110818

  select user_id , count(0)
  from G_A_02008_DAY
   where time_id = 20110818
   group by user_id having count(0) > 1
   
   
   select * from bass2.dw_product_20110818 where     product_no = '13618902345'


select * from  table( bass1.get_after('R235')) a 
where control_code like '%DAY%'

BASS1_EXP_G_S_21003_MONTH	BASS1_INT_CHECK_R235_MONTH.tcl

insert into app.sch_control_before
values ('BASS1_EXP_G_S_03004_MONTH','BASS1_INT_CHECK_R235_MONTH.tcl')
,('BASS1_EXP_G_S_03005_MONTH','BASS1_INT_CHECK_R235_MONTH.tcl')

select time_id,user_id,usertype_id from BASS1.TEMP_CHECK_02008_D where time_id=20110818

89160001094903      

select * from  G_A_02008_DAY where user_id =  '89160001094903'
select * from  G_A_02004_DAY where user_id =  '89160001094903'

select * from    bass2.dw_product_20110718 where user_id =  '89160001094903'

select count(0),count(distinct user_id ) from  G_A_02004_DAY where time_id = 20110818

select count(0),count(distinct user_id ) from  G_A_02008_DAY where time_id = 20110818
40825	40825



select * from    bass2.dw_product_20110718 where user_id =  '89160001094903'

14789001631

select * from    bass2.dw_product_20110818 where product_no =  '14789001631'




select * from   G_A_02004_DAY
where user_id in 
(
 '89160001230429'
,'89157332677864'
,'89160001094903'
)



select * from   bass2.dw_product_20110818 where userstatus_id = 4 and create_date = expire_date

val99-98/98

values 1.00/98




WITH n(control_code, before_control_code) AS 
          (SELECT control_code, before_control_code 
             FROM app.sch_control_before
             WHERE before_control_code = 'BASS1_G_A_02008_DAY.tcl'
           UNION ALL
           SELECT b.control_code,b.before_control_code 
             FROM app.sch_control_before as b, n
             WHERE b.before_control_code = n.control_code)
SELECT distinct c.control_code FROM n,app.sch_control_task c
where n.control_code = c.control_code
and c.deal_time = 1
and c.control_code not like 'OLAP_%'





update app.g_runlog 
set return_flag = 0
where time_id= 20110818
and return_flag=1
and unit_code = '02008'

update app.sch_control_runlog a 
set flag = -2
where control_code in 
('BASS1_INT_CHECK_02004_02008_DAY.tcl'
,'BASS1_INT_CHECK_33TO40_DAY.tcl'
,'BASS1_INT_CHECK_63EO_TO_DAY.tcl'
,'BASS1_INT_CHECK_E1_DAY.tcl'
,'BASS1_INT_CHECK_GPRS_FLOW_DAY.tcl'
,'BASS1_INT_CHECK_INDEX_SAME_DAY.tcl'
,'BASS1_INT_CHECK_INDEX_WAVE_DAY.tcl'
,'BASS1_INT_CHECK_K0_7I2_5D0_6_TO_DAY.tcl'
,'BASS1_INT_CHECK_R177182_DAY.tcl'
,'BASS1_INT_CHECK_R178183_DAY.tcl'
,'BASS1_INT_CHECK_R179184_DAY.tcl'
,'BASS1_INT_CHECK_R180185_DAY.tcl'
,'BASS1_INT_CHECK_TD_DAY.tcl'
,'BASS1_INT_CHECK_Z345_DAY.tcl'
)
and date(a.begintime) =  date(current date) 



update app.sch_control_runlog a 
set flag = 0
where control_code in 
(

'BASS1_INT_CHECK_GPRS_FLOW_DAY.tcl'
,'BASS1_INT_CHECK_Z345_DAY.tcl'
,'BASS1_INT_CHECK_TD_DAY.tcl'
)
and date(a.begintime) =  date(current date) 


select count(0) from    G_S_03004_MONTH_ADJ_BAK

select 
userstatus_id ,substr(char(STS_DATE),1,7)
,count(0)
from g_s_03004_03005_R235_adj a 
, bass2.dw_product_201107 b
where a.user_id = b.user_id 
group by userstatus_id
,substr(char(STS_DATE),1,7)




select * from   G_S_22066_DAY
where time_id = 20110818



select length(trim(product_no)) , count(0)
from g_a_02004_day
group by 
length(trim(product_no))



select * from   bass2.dw_product_20110818 where userstatus_id = 4 and create_date = expire_date
and user_id = '89660001100088'


select * from g_a_02004_day
where user_id = '89660001100088'


select * from g_a_02008_day
where user_id = '89660001100088'



20110711	89660001100088      	2010

89660001124444

select * from bass1.INT_02004_02008_201107
where user_id = '89660001124444'

OP_TIME	USER_ID	BRAND_ID	USERTYPE_ID	BRAND_FLAG	USERTYPE_FLAG
20110718	89660001124444      	0	2010	0	1


select * from bass1.INT_02004_02008_201107
where user_id = '89660001100088'

select * from g_a_02004_day
where user_id = '89660001124444'

select * from    bass2.dw_product_bass1_20110711 where user_id = '89660001100088'

select * from g_a_02004_day
where user_id = '89660001100088'

select * from INT_02004_02008_201107
where user_id = '89660001124444'

select * from   BASS1.temp_check_02004 where time_id = 20110817


select time_id , count(0) 
--,  count(distinct time_id ) 
from BASS1.temp_check_02004 
group by  time_id 
order by 1 




                     select
                       20110718
                       ,a.user_id
                       ,a.cust_id
                       ,case 
                         when a.test_mark=1 then '3' 
                         when a.free_mark=1 then '2'
                         else '1' 
                        end
                       ,replace(char(create_date),'-','')
                       ,'01'
                       ,a.product_no
                       ,'0' as imsi
                       ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0054',char(a.city_id)),'13101')
                       ,char(a.channel_id)
                       ,'1'
                                       ,case
                                         when a.accttype_id=0 then '1'
                                         else '2'
                                        end
                       ,'04'
                       ,b.brand_id
                       ,case 
                         when a.crm_brand_id2=70 then '1' 
                         else '0' 
                        end
                     from 
                       bass2.dw_product_bass1_20110718 a,
                       (
                        select 
                          * 
                        from 
                          BASS1.INT_02004_02008_201107
                        where
                          op_time=20110718
                          and brand_flag=1
                       )b              
                     where 
                       a.user_id = b.user_id 
                       and b.user_id = '89660001124444'

select * from   bass2.dw_product_bass1_20110718 b
 where b.user_id = '89660001124444'           

select * from     BASS1.INT_02004_02008_201107 b
 where b.user_id = '89660001124444'           
            
            


SELECT CNT1 - CNT2 
FROM 
(
select COUNT(0) CNT1
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201108
           ) f 
where    f.row_id=1 
    ) A        
, (
select COUNT(0) CNT2
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201108 ) e
where e.row_id=1
) B 



            
            


CREATE TABLE "BASS1   "."G_A_02004_DAY_B20110818"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

            
INSERT INTO G_A_02004_DAY_B20110818
SELECT * FROM G_A_02004_DAY
WHERE TIME_ID = 20110818
            
            
SELECT count(0) ,count(distinct user_id) FROM G_A_02008_DAY
WHERE TIME_ID = 20110819


SELECT count(0) FROM G_A_02004_DAY
WHERE TIME_ID = 20110818

SELECT count(0) FROM G_A_02004_DAY_B20110818
WHERE TIME_ID = 20110818


delete from    G_A_02004_DAY
WHERE TIME_ID = 20110818

insert into G_A_02004_DAY
select * from  G_A_02004_DAY_B20110818
where     TIME_ID = 20110818      




select * from   g_s_22066_day 
order by 1,3 
                            

select sum(bigint(CHRG_REC_FEE)) from   g_s_22066_day where time_id / 100 = 201107
order by 1,3                             
                            
                     select a.region_id,105,
                            case when a.class = 4 then 205
                                 when a.class = 5 then 201
                            else 206 end ,sum(amount)
                                 from
                                    ( select a.region_id,
                                            case when b.PAYTYPE_ID in ('4464','4864') then 4
                                                 when b.PAYTYPE_ID in ('4468') then 5
                                                 else 6 end as class,sum(recv_cash) as amount
                            from  bass2.dw_product_20110717 a,  (select * from bass2.dw_acct_payitem_dm_201107 where op_time = '2011
-07-17') b
                            where a.user_id=b.user_id and b.PAYTYPE_ID in ('4464','4864','4468','SJJF2','4115')
                            group by  a.region_id,
                                      case when b.PAYTYPE_ID in ('4464','4864') then 4
                                                 when b.PAYTYPE_ID in ('4468') then 5
                                                 else 6 end
                          )  a
                                    group by a.region_id,105,
                                             case when a.class = 4 then 205
                                 when a.class = 5 then 201
                            else 206 end
                            
select sum(amount) from (

                    select 105,
                            case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end ,sum(a.amount) amount
		                 from
		                    ( select a.region_id,
		                            case when b.opt_code in ('4464','4864') then 4 
		                                 when b.opt_code in ('4468') then 5 
		                                 else 6 end as class,sum(amount) as amount
                            from  bass2.dw_product_201107 a, bass2.dw_acct_payment_dm_201107 b
                            where a.user_id=b.user_id and b.opt_code in ('4464','4864','4468','SJJF2','4115')
                            group by  a.region_id,
                                      case when b.opt_code in ('4464','4864') then 4 
		                                 when b.opt_code in ('4468') then 5 
		                                 else 6 end
                          )  a
		                    group by 105,
		                             case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end
                            ) a 
                            

37416511.41
                            
                        select sum(amount) from (
    
                     select a.region_id,105,
                            case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end ,sum(amount) amount
		                 from
		                    ( select a.region_id,
		                            case when b.opt_code in ('4464','4864') then 4 
		                                 when b.opt_code in ('4468') then 5 
		                                 else 6 end as class,sum(amount) as amount
                            from  bass2.dw_product_201107 a,  (select * from bass2.dw_acct_payment_dm_201107 ) b
                            where a.user_id=b.user_id and b.opt_code in ('4464','4864','4468','SJJF2','4115')
                            group by  a.region_id,
                                      case when b.opt_code in ('4464','4864') then 4 
		                                 when b.opt_code in ('4468') then 5 
		                                 else 6 end
                          )  a
		                    group by a.region_id,105,
		                             case when a.class = 4 then 205 
                                 when a.class = 5 then 201
                            else 206 end
                                         ) a 
                                         
                                         37416511.41
                                         
                                        

                                       
                                       
           





--bass1

select sum(cnt) from table(
                  select 104,
                   case when a.echl_type = 1 then 202
                                       when a.echl_type = 2 then 201
                                       when a.echl_type = 3 then 203
                                       when a.echl_type = 5 then 204
                                       when a.echl_type = 6 then 205
                                       else 206 end ,
                                                                           count(a.product_no) cnt
 from (
select echl_type,busi_code_type,case brand_id when 1 then 1 when 4 then 2 else 3 end,
         sum(flow) flows,product_no
      from (
            
            select 2 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
            from (select b.parent_ob_id as busi_code_type,a.brand_id,
                      count(1) as flow,a.product_no
                   from  bass2.dw_ow_loading_log_201107 a, bass2.dim_sys_object5  b
                   where a.ob_type =1 and b.parent_ob_id in (21,23) and b.check_result = 5 and a.ob_id = b.ob_id
                     
       and (a.is_success in (0,1) or a.err_msg is null
                   or a.err_msg = 'action is null' or a.err_msg = '您当前的营销方案无法变更该促销!'
                   or a.err_msg = '您输入的服务密码校验错误：密码不正确!' or a.err_msg = 'Broken pipe')
                   group by b.parent_ob_id,a.brand_id,a.product_no
                   union all
                   select 22 as busi_code_type,b.brand_id,count(1) as flow,b.product_no
                   from  (select * from bass2.dw_product_busi_dm_201107 ) a
                   , bass2.dw_product_201107 b
                   where a.user_id=b.user_id and a.user_id in (
                      select user_id from  bass2.dw_product_201107
                      where product_no in (select product_no from  bass2.dw_ow_loading_log_201107
                                           where is_success in (0,1)
                                           ) and userstatus_id>0
                      ) and a.so_mode ='15' and a.op_id=10000475
                   group by b.brand_id,b.product_no
                   union all
                   select 24 as busi_code_type,b.brand_id,count(1) as flow,b.product_no
                   from  (select * from bass2.dw_acct_payitem_dm_201107 ) a, bass2.dw_product_201107 b
                   where a.user_id=b.user_id and a.paytype_id in ('4468')
                   group by b.brand_id,b.product_no
                  )a
            group by busi_code_type,brand_id,product_no
           
           )a
      group by echl_type,busi_code_type,case brand_id when 1 then 1 when 4 then 2 else 3 end,product_no ) a,
          (
select b.product_instance_id from (select * from bass2.dw_product_ord_srvpkg_dm_201107 ) a,(select * from bass2.dw_product_ord_cust_dm_201107 ) b
where 1=1 and a.customer_order_id=b.customer_order_id
   and a.servicepkg_id in (
select PRODUCT_ITEM_ID from bass2.DIM_PROD_UP_PRODUCT_ITEM a where a.SUPPLIER_ID in ('400000','400001','701001','80001','801110','801114','801132','801137','801151','801157','801163','801164','801166','801168','801173','801185','801187','801191','801233','801236',
'801237','801241','801242','801244','801248','900013','900103','900104','900105','900106','900107','900109','900110','900112','900113','900114','900115','900116','900117','900118','900119','900120','900121','900122','900123','900128','900129','900130','900132','900138','900139','900140','900141','900143','900144','900145','900148','900520','900652','901500','901585','901876','901899','901908',
'901922','931067','931078','931106','931805','98555') and item_type='SERVICE_PRICE')


) b,bass2.dw_product_201107 c
where a.product_no=c.PRODUCT_NO and c.USER_ID=b.PRODUCT_INSTANCE_ID and a.busi_code_type     in (22)
     and c.userstatus_id in (1,2,3,6,8)
                     and c.usertype_id in (1,2,9)
          group by  104,
                   case when a.echl_type = 1 then 202
                                       when a.echl_type = 2 then 201
                                       when a.echl_type = 3 then 203
                                       when a.echl_type = 5 then 204
                                       when a.echl_type = 6 then 205
                                       else 206 end
)  a


                    
                    



select * from bass2.dw_kf_cmd_hint_def_dm_201108 where op_time = '2011-08-19'




                       select count(distinct login_product_no) as count
             from  bass2.dw_product_201107 a,bass2.dw_wcc_user_action_201107  b
             where b.login_product_no=a.product_no and b.login_type=1 and b.is_success=1
                   and a.userstatus_id>0
                                      and date(b.login_time)>='2011-07-01' and date(b.login_time)<='2011-07-31'

                       select  region_id,count(distinct login_product_no) as count
             from  bass2.dw_product_201107 a,bass2.dw_wcc_user_action_201107 b
             where b.login_product_no=a.product_no and b.login_type=1 and b.is_success=1
                   and a.userstatus_id>0
                   and date(b.login_time)>='2011-07-01' and date(b.login_time)<='2011-07-31'
    group by region_id
    
select sum( count) from (
                       select count(distinct login_product_no) as count
             from  bass2.dw_product_201107 a,bass2.dw_wcc_user_action_201107 b
             where b.login_product_no=a.product_no and b.login_type=1 and b.is_success=1
                   and a.userstatus_id>0
                   and date(b.login_time)>='2011-07-01' and date(b.login_time)<='2011-07-31'
             
             
             ) a 
             
             
             
                       select count(distinct a.phone_id)
                       from  bass2.dw_kf_sms_cmd_receive_dm_201107 a,
                            bass2.dw_product_201107 b
                        where  a.phone_id = b.product_no
                                                and b.userstatus_id in (1,2,3,6,8)
                       

                       select count(distinct a.tel_calling)
                       from bass2.dw_custsvc_cps_log_call_dm_201107 a,
                             bass2.dw_product_201107 b
                        where a.tel_calling = b.product_no
                        and a.tel_called = '10086'
                        and b.userstatus_id in (1,2,3,6,8)
                        
                        

                   select count(distinct a.product_instance_id)
         from
         (select distinct product_instance_id
         from bass2.dw_product_ord_cust_dm_201107 a
         where channel_type='9'
         union
         select distinct user_id as product_instance_id
               from bass2.dw_acct_payitem_dm_201107 a
               where paytype_id in ('4162','4864')
         ) a
         , bass2.dw_product_20110716 b
         where a.product_instance_id = b.user_id
                        
                        

except
                   select d.region_id
         from bass2.dw_product_ord_cust_dm_201107 a,
                      bass2.dw_product_ord_busi_dm_201107 b,
                      bass2.DW_PRODUCT_ORD_BUSI_OTHER_201107  c,
                                                   bass2.dw_product_201107 d
          where a.customer_order_id = b.customer_order_id
                      and b.busioper_order_id =c.busioper_order_id 
                      and c.ext_6 like '%SRC=206%'   
                                                   and a.product_instance_id = d.user_id     
                                  group by d.region_id 
                                  
                        except
                        select region_id from  bass2.stat_market_channel_key_0133 where op_time = '2011-07-01'



select  b.region_id,101,202, count(  product_no)
                        from bass2.dw_custsvc_ivr_log_dm_201107 a,
                             bass2.dw_product_201107 b
                        where a.calling = b.product_no 
                         and b.userstatus_id in (1,2,3,6,8)
                         and a.operation_type<>6
                          group by b.region_id
                         
                         
                         select b.region_id,101,202,count(*)
                        from dw_custsvc_ivr_log_dm_$year$month a,
                             dw_product_$year$month b
                        where a.calling = b.product_no 
                         and b.userstatus_id in (1,2,3,6,8)
                         and a.operation_type<>6
                         
                         

                        select count(*)
                        from bass2.dw_custsvc_ivr_log_dm_201107 a,
                             bass2.dw_product_201107 b
                        where a.calling = b.product_no 
                         and b.userstatus_id in (1,2,3,6,8)
                         and a.operation_type<>6
                         
                         
                         
                         select count(distinct a.tel_calling)
	  	       from bass2.dw_custsvc_cps_log_call_dm_201107 a,
	  	            bass2.dw_product_201107 b
	  	        where a.tel_calling = b.product_no 
	  	                and a.tel_called = '10086'
				             and b.userstatus_id in (1,2,3,6)
                             
                             
                             




select sum(flow) from 
(
  select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
            from (
      select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_code = '1008611' or operation_code = '20102'
      group by brand, calling
      union all
      select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_code = '20106'
      group by brand, calling
      union all
      select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_type <> 6
      group by brand, calling
               union all
      select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
               when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
       count(*) as flow, bill_id as product_no
      from  bass2.dw_product_ord_so_log_dm_201107
      where length(trim(char(op_id))) = 4
      and busi_id in (
      select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
      group by case when brand_name like '%全球通%' then 1
        when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                 )a
            group by busi_code_type,brand_id,product_no
            
)  a                             



select sum(flow) from    (
select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
            from (
      select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107  ) a
      where operation_code = '1008611' or operation_code = '20102'
      group by brand, calling
      union all
      select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107  ) a
      where operation_code = '20106'
      group by brand, calling
      union all
      select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107  ) a
      where operation_type <> 6
      group by brand, calling
               union all
      select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
               when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
       count(*) as flow, bill_id as product_no
      from  (select * from bass2.dw_product_ord_so_log_dm_201107  ) a
      where length(trim(char(op_id))) = 4
      and busi_id in (
      select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
      group by case when brand_name like '%全球通%' then 1
        when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                 )a
            group by busi_code_type,brand_id,product_no
            ) a
            
            

select * from   g_s_22066_day where time_id = 20110819

select * from   g_s_22066_day where time_id = 20110818

select tabname from syscat.tables where tabname like '%SYS_CMD_DEF%'
   
   
   ODS_SYS_CMD_DEF_20110813
   


            
            
            CREATE TABLE "BASS2   "."ODS_SYS_CMD_DEF_20110731"  (
                  "CMD_ID" BIGINT NOT NULL , 
                  "CMD_STR" VARCHAR(200) , 
                  "CMD_TYPE" INTEGER , 
                  "CMD_GROUP" INTEGER , 
                  "ALTERNATE_CMD" INTEGER , 
                  "BRAND" BIGINT , 
                  "REGION_CODE" INTEGER , 
                  "STS" INTEGER , 
                  "STS_DATE" TIMESTAMP , 
                  "PROCES_NUM" INTEGER , 
                  "PARA_NUM" INTEGER , 
                  "PARA_SEQ_TYPE" INTEGER , 
                  "PARA_SPLIT" VARCHAR(2) , 
                  "SERVICE_CODE" VARCHAR(32) , 
                  "MAIN_CALL_NO" VARCHAR(32) , 
                  "LIMIT_ID" INTEGER , 
                  "FUN_ID" INTEGER , 
                  "CMD_DESC" VARCHAR(256) , 
                  "MENU_ID" INTEGER )   
                 DISTRIBUTE BY HASH("CMD_ID")   
                   IN "TBS_ODS_OTHER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 
                   
                   
                  insert into bass2.ODS_SYS_CMD_DEF_20110731
                  select * from bass2.ODS_SYS_CMD_DEF_20110813
                  
                  

select tabname from syscat.tables where tabname like '%PRODUCT_ORD_BUSI_OTHER%'

                     
select date(CREATE_DATE) , count(0) 
--,  count(distinct date(CREATE_DATE) ) 
from bass2.dw_res_ctms_exchg_20110820 
group by  date(CREATE_DATE) 
order by 1 

select * from   bass2.dw_res_ctms_exchg_20110820

                     
                     
select * from    bass2.dim_channel_info 
                     
select tabname from syscat.tables where tabname like '%DIM%CHANNEL%'                        

select * from   bass2.DIM_PUB_CHANNEL

100001963
select count(0) from bass2.dw_product_201107 b
	  	        where b.userstatus_id in (1,2,3,6,8)
                and channel_id = 100001963
                

select * from   bass2.dim_channel_info where channel_id =  100001963
                            
                            
select * from   G_S_22066_DAY
where                   E_CHANNEL_TYPE in ('01','04')

          
          
select tabname from syscat.tables where tabname like '%PRODUCT_INS_PROD%'


bass2.ODS_PRODUCT_INS_PROD_${timestamp}

select count(0) from    bass2.ODS_PRODUCT_INS_PROD_20110820
    
   
select * from   app.sch_control_task where control_code = 'DMK_drop_mart_table_ds.tcl'
 select * from   app.sch_control_task  where cc_group_code = 'dmk'
 
 
 select * from  bass2.ODS_SYS_CMD_DEF_20110815
 
 select tabname from syscat.tables where tabname like '%PRODUCT_ORD_BUSI_OTHER%'
  
  select * from bass2.ODS_SYS_CMD_DEF_20110731
  
  
  select * from g_s_22066_day 
  where e_channel_type = '04'
  order by 1 desc 
  
  
  select count(0) from  bass2.ODS_PRODUCT_ORD_BUSI_OTHER_20110720
  
  
  
create table   bass2.Dwd_sys_cmd_def_20110821 like  bass2.Dwd_sys_cmd_def_yyyymmdd DISTRIBUTE BY HASH("CMD_ID")   IN "TBS_ODS_OTHER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY

  select count(0) from  bass2.ODS_SYS_CMD_DEF_20110815
  
  
  SELECT * FROM DW_PRODUCT_ORD_CUST_201107 where org_id=10100101 ;
  
  
  
  select * from syscat.tables where tabname like '%SYS_CMD_DEF%' 
  
  select count(0) from  bass2.Dwd_sys_cmd_def_20110815
  
  
  
  
  
sys



select count(0) from  bass2.Dwd_sys_cmd_def_20110820 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110819 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110818 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110817 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110816 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110815 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110814 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110813 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110812 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110811 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110810 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110809 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110808 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110807 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110806 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110805 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110804 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110803 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110802 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110801 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110731 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110730 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110729 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110728 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110727 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110726 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110725 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110724 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110723 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110722 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110721 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110720 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110719 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110718 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110717 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110716 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110715 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110714 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110713 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110712 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110711 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110710 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110709 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110708 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110707 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110706 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110705 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110704 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110703 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110702 ;
select count(0) from  bass2.Dwd_sys_cmd_def_20110701 ;




select count(0) from    bass2.ODS_DIM_SYS_STAFF_20110822


  SELECT count(0),count(distinct org_id )  FROM bass2.DW_PRODUCT_ORD_CUST_201107 where org_id
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')

  SELECT distinct org_id  FROM bass2.DW_PRODUCT_ORD_CUST_201107 where org_id
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  

  
  SELECT count(0),count(distinct org_id )  FROM bass2.DW_PRODUCT_ORD_CUST_201107 where OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  
  select * from bass2.dim_channel_info where organize_id in (
    SELECT distinct org_id  FROM bass2.DW_PRODUCT_ORD_CUST_201107 where OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  
)

    SELECT distinct org_id,OP_ID FROM bass2.DW_PRODUCT_ORD_CUST_201107 where OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  

SELECT count(0),count(distinct BUSINESS_ID) FROM bass2.DW_PRODUCT_ORD_CUST_DM_201107 where
OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
and char(BUSINESS_ID) in 
 (
'191000000001'
,'191000000004'
,'191000000011'
,'191000000012'
,'191000000013'
,'191000000014'
,'191000000015'
,'191000000016'
,'191000000017'
,'191000000065'
,'191000000068'
,'191000000069'
,'191000000105'
,'191000001017'
,'191000001021'
,'191000001024'
,'191000001027'
)



SELECT distinct BUSINESS_ID FROM bass2.DW_PRODUCT_ORD_CUST_DM_201107 where
OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  
  
  select * from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and char(product_item_id ) in 
(
SELECT distinct char(BUSINESS_ID) FROM bass2.DW_PRODUCT_ORD_CUST_DM_201107 where
OP_ID
  in (select staff_id from  bass2.ODS_DIM_SYS_STAFF_20110822  where staff_name like '%自助终端%')
  
)



  select * from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and char(product_item_id ) in 
('191000001019')
  select * from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and name like '%查询%'

select count(0) from    
bass2.dw_product_ord_so_log_dm_201107
where BUSI_ID in (
  select product_item_id from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and name like '%查询%'
)
and  OP_ID in ( select OP_ID from  bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%' )


select * from   bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%'

                        select   a.org_id
                              ,'2'
                              ,0
                              ,0
                              ,0
                              ,0
                              ,0
                              ,0
                              ,0
                              ,0
                                ,0
                                ,0
                                ,count(0)
                                ,0
                                ,0
                        FROM bass2.DW_PRODUCT_ORD_CUST_DM_201109  a
                        where OP_ID in ( select OP_ID from  bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%' )
                        group by a.org_id
                         with ur
                         

select tabname from syscat.tables where tabname like '%22091%'   



select b.name,a.* from    
bass2.dw_product_ord_so_log_dm_201107 a, (
  select product_item_id ,name from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and name like '%查询%'
) b
where BUSI_ID  = product_item_id
and  OP_ID in ( select OP_ID from  bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%' )





select * from   ODS_DIM_SYS_ORGANIZE_20110411

select * from   bass2.dim_channel_info



select * from  (select * from G_S_22091_DAY  ) a 
where a.CHANNEL_ID not in ( select char(CHANNEL_ID) from bass2.dim_channel_info )



select * from   
 bass2.dim_channel_info 
 where channel_id = 100002255
 
100002329
100002391
100000318
100001963
100002418
100000323
100000845
100000930
100000844
100002255
100002467
10320010
100001666
100001683




select distinct channel_type from   bass2.DW_CHANNEL_INFO_201109
where CHANNEL_ID in 
(100002329
,100002391
,100000318
,100001963
,100002418
,100000323
,100000845
,100000930
,100000844
,100002255
,100002467
,10320010
,100001666
,100001683)

select * from   bass2.DIM_BBOSS_BASE_TYPE
where code_id in (
90155
,90196
,90940
,90941
,105001
)

select * from   bass2.DIM_BBOSS_BASE_TYPE
where code_type in (
90105
,90102
)


select * from   bass2.DW_CHANNEL_INFO_201109 a
where CHANNEL_ID in 
(100002329
,100002391
,100000318
,100001963
,100002418
,100000323
,100000845
,100000930
,100000844
,100002255
,100002467
,10320010
,100001666
,100001683)
and a.channel_type_class in (90105,90102)
and a.channel_type in (90105,90102)




select * from   bass2.DIM_BBOSS_BASE_TYPE
where code_type in (
90105
,90102
)

select count(0) from  bass2.DIM_BBOSS_BASE_TYPE 



    select * from    
   bass2.Dim_channel_info
    
    where char(channel_id) in (select  channel_id from BASS1.G_S_22091_DAY)
    
    except
    
    select code_id from   bass2.DIM_BBOSS_BASE_TYPE
where code_type in (
90105
,90102
)

90886
 select * from   bass2.DIM_BBOSS_BASE_TYPE
 where code_type = 90886
 
     select * from    
   bass2.Dim_channel_info  where channel_type = 90886
   
   
   
   
       select distinct channel_type from    
   bass2.Dim_channel_info
    
    where char(channel_id) in (select  distinct  channel_id from BASS1.G_S_22091_DAY)
    
       
       select  * from    
   bass2.Dim_channel_info
    
    where char(channel_id) in (select  distinct  channel_id from BASS1.G_S_22091_DAY)
    
    
    
        select * from   bass2.DIM_BBOSS_BASE_TYPE
where code_id in (
1
,2
,3
,5
,8
,9
,14
,20
,26
,31
,90944
,90945

)
and code_type  in (
90153
,90154
,90176
,90881
,90884
,90885
,90886
,90940

)

        select * from   bass2.DIM_BBOSS_BASE_TYPE
where code_name like '%24%'

90145




       select distinct channel_type from    
   bass2.Dim_channel_info
   where channel_type_class = 90145
   
   
   
       
                     
select tabname from syscat.tables where tabname like '%RES_CTMS_EXCHG%'                        


select * from bass2.dim_prod_up_product_item where item_type='BUSINESS'and name like '%销户%'
or name like '%过户%'


在统计周期内，客户通过该渠道办理的销户、过户、补换卡、品牌转换、套餐变更（非品牌转换的套餐变更）、停机、复机、客户资料变更、备卡激活、智能网神州行挂失/补卡、租机/退机、服务密码管理、帐户余额提醒服务定制、账务变更、账单寄送、EMAIL详单寄送、高尔夫俱乐部、VIP服务(名家讲堂、健康服务等)、跨区服务、积分兑换、其他等，



不含咨询、查询等服务，不含新增客户、缴费、增值业务办理、定制终端销售、有价卡销售等业务。单位：笔




SELECT count(0),count(distinct BUSINESS_ID) FROM bass2.DW_PRODUCT_ORD_CUST_201107 where org_id=10100101 and char(BUSINESS_ID) in 
(
'191000000001'
,'191000000002'
,'191000000003'
,'191000000004'
,'191000000005'
,'191000000006'
,'191000000007'
,'191000000008'
,'191000000009'
,'191000000010'
,'191000000011'
,'191000000012'
,'191000000013'
,'191000000014'
,'191000000015'
,'191000000016'
,'191000000017'
,'191000000018'
,'191000000019'
,'191000000020'
,'191000000021'
,'191000000022'
,'191000000023'
,'191000000024'
,'191000000025'
,'191000000031'
,'191000000032'
,'191000000033'
,'191000000034'
,'191000000035'
,'191000000036'
,'191000000037'
,'191000000038'
,'191000000039'
,'191000000040'
,'191000000041'
,'191000000042'
,'191000000043'
,'191000000055'
,'191000000056'
,'191000000057'
,'191000000058'
,'191000000059'
,'191000000060'
,'191000000061'
,'191000000062'
,'191000000063'
,'191000000064'
,'191000000065'
,'191000000066'
,'191000000067'
,'191000000068'
,'191000000069'
,'191000000070'
,'191000000071'
,'191000000072'
,'191000000074'
,'191000000075'
,'191000000076'
,'191000000077'
,'191000000079'
,'191000000080'
,'191000000081'
,'191000000082'
,'191000000083'
,'191000000084'
,'191000000085'
,'191000000086'
,'191000000087'
,'191000000088'
,'191000000089'
,'191000000090'
,'191000000091'
,'191000000092'
,'191000000093'
,'191000000094'
,'191000000095'
,'191000000096'
,'191000000097'
,'191000000098'
,'191000000099'
,'191000000100'
,'191000000101'
,'191000000102'
,'191000000103'
,'191000000104'
,'191000000105'
,'191000000106'
,'191000000107'
,'191000000108'
,'191000000109'
,'191000000110'
,'191000000111'
,'191000000112'
,'191000000113'
,'191000000114'
,'191000000115'
,'191000000116'
,'191000000117'
,'191000000118'
,'191000000119'
,'191000000120'
,'191000000121'
,'191000000124'
,'191000000126'
,'191000000128'
,'191000000129'
,'191000000130'
,'191000000132'
,'191000000133'
,'191000000134'
,'191000000135'
,'191000000140'
,'191000000141'
,'191000000142'
,'191000000143'
,'191000000144'
,'191000000145'
,'191000001001'
,'191000001015'
,'191000001017'
,'191000001018'
,'191000001019'
,'191000001020'
,'191000001021'
,'191000001022'
,'191000001023'
,'191000001024'
,'191000001025'
,'191000001026'
,'191000001027'
,'191000001028'
,'191000001029'
,'191000001030'
,'191000001031'
,'191000001032'
)




SELECT distinct BUSINESS_ID FROM bass2.DW_PRODUCT_ORD_CUST_201107 where org_id=10100101 and char(BUSINESS_ID) in 
(
'191000000001'
,'191000000002'
,'191000000003'
,'191000000004'
,'191000000005'
,'191000000006'
,'191000000007'
,'191000000008'
,'191000000009'
,'191000000010'
,'191000000011'
,'191000000012'
,'191000000013'
,'191000000014'
,'191000000015'
,'191000000016'
,'191000000017'
,'191000000018'
,'191000000019'
,'191000000020'
,'191000000021'
,'191000000022'
,'191000000023'
,'191000000024'
,'191000000025'
,'191000000031'
,'191000000032'
,'191000000033'
,'191000000034'
,'191000000035'
,'191000000036'
,'191000000037'
,'191000000038'
,'191000000039'
,'191000000040'
,'191000000041'
,'191000000042'
,'191000000043'
,'191000000055'
,'191000000056'
,'191000000057'
,'191000000058'
,'191000000059'
,'191000000060'
,'191000000061'
,'191000000062'
,'191000000063'
,'191000000064'
,'191000000065'
,'191000000066'
,'191000000067'
,'191000000068'
,'191000000069'
,'191000000070'
,'191000000071'
,'191000000072'
,'191000000074'
,'191000000075'
,'191000000076'
,'191000000077'
,'191000000079'
,'191000000080'
,'191000000081'
,'191000000082'
,'191000000083'
,'191000000084'
,'191000000085'
,'191000000086'
,'191000000087'
,'191000000088'
,'191000000089'
,'191000000090'
,'191000000091'
,'191000000092'
,'191000000093'
,'191000000094'
,'191000000095'
,'191000000096'
,'191000000097'
,'191000000098'
,'191000000099'
,'191000000100'
,'191000000101'
,'191000000102'
,'191000000103'
,'191000000104'
,'191000000105'
,'191000000106'
,'191000000107'
,'191000000108'
,'191000000109'
,'191000000110'
,'191000000111'
,'191000000112'
,'191000000113'
,'191000000114'
,'191000000115'
,'191000000116'
,'191000000117'
,'191000000118'
,'191000000119'
,'191000000120'
,'191000000121'
,'191000000124'
,'191000000126'
,'191000000128'
,'191000000129'
,'191000000130'
,'191000000132'
,'191000000133'
,'191000000134'
,'191000000135'
,'191000000140'
,'191000000141'
,'191000000142'
,'191000000143'
,'191000000144'
,'191000000145'
,'191000001001'
,'191000001015'
,'191000001017'
,'191000001018'
,'191000001019'
,'191000001020'
,'191000001021'
,'191000001022'
,'191000001023'
,'191000001024'
,'191000001025'
,'191000001026'
,'191000001027'
,'191000001028'
,'191000001029'
,'191000001030'
,'191000001031'
,'191000001032'
)

select * from bass2.dim_prod_up_product_item where item_type='BUSINESS'
and char(product_item_id ) in (
'191000000001'
,'191000000004'
,'191000000011'
,'191000000012'
,'191000000013'
,'191000000014'
,'191000000015'
,'191000000016'
,'191000000017'
,'191000000065'
,'191000000068'
,'191000000069'
,'191000000105'
,'191000001017'
,'191000001021'
,'191000001024'
,'191000001027'
)


select tabname from syscat.tables where tabname like '%PRODUCT_ORD_CUST%'


select * from bass2.dim_pub_channel a where char(a.CHANNEL_ID )
in 
(
 '100002329'
,'100002391'
,'100000318'
,'100001963'
,'100002418'
,'100000323'
,'100000845'
,'100000930'
,'100000844'
,'100002255'
,'100002467'
,'10320010'
,'100001666'
,'100001683'
)

10320010

select * from   bass2.dim_channel_info where channel_id = 10320010

   
   select * from   bass2.dim_channel_info a where 
     char(a.CHANNEL_ID )
in 
(
 '100002329'
,'100002391'
,'100000318'
,'100001963'
,'100002418'
,'100000323'
,'100000845'
,'100000930'
,'100000844'
,'100002255'
,'100002467'
,'10320010'
,'100001666'
,'100001683'
)


CHANNEL_ID
100002265                               
100000324                               
100000899                               
100002454                               
100002425                               
100000913                               
100002368                               
100000386                               


in 
(
100000318                               
,100000323                               
,100001666                               
,100001683                               
,100001963                               
,100002255                               
,100002329                               
,100002391                               
,100002418                               
,100002467          
)
select * from   

 select count(0) dup_cnt
        from (
                select  DEAL_DATE,CHANNEL_ID,DEAL_TYPE, count(0)  cnt
                from bass1.G_S_22091_DAY
                where time_id =20110930
                group by   DEAL_DATE,CHANNEL_ID,DEAL_TYPE having count(0) > 1
                ) t 

select * from    G_S_22091_DAY where     time_id =20110930
and      bigint( CHANNEL_ID )
in (
100002265                               
,100000324                               
,100000913                               
,100002368                               
,100000899                               
,100002454                               
,100000386                               
,100002425                               
)


select tabname from syscat.tables where tabname like '%22091%'
   
   
   
   CREATE TABLE "BASS1   "."G_S_22091_DAY_1"  (
                  "TIME_ID" INTEGER , 
                  "DEAL_DATE" CHAR(8) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "DEAL_TYPE" CHAR(1) , 
                  "NEW_USER_CNT" CHAR(8) , 
                  "PAYMENT_REC_CNT" CHAR(10) , 
                  "PAYMENT_REC_FEE" CHAR(10) , 
                  "CARD_SALE_CNT" CHAR(8) , 
                  "VAL_BUSI_REC_CNT" CHAR(10) , 
                  "VAL_BUSI_OPEN_CNT" CHAR(10) , 
                  "IMP_VAL_OPEN_CNT" CHAR(10) , 
                  "TERM_SALE_CNT" CHAR(10) , 
                  "MOBILE_SALE_CNT" CHAR(10) , 
                  "BASE_REC_CNT" CHAR(10) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("DEAL_DATE",  
                 "CHANNEL_ID",  
                 "DEAL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


\



select char(current date - (1+2) days) from bass2.dual


select * from   G_S_22091_DAY


select tabname from syscat.tables where lower(tabname) like '%sprom_active%'
DWD_PRODUCT_SPROM_ACTIVE

select * from app.sch_control_task where control_code like '%Dwd_product_sprom_ds.tcl%'

CONTROL_CODE
BASS2_Dwd_product_sprom_ds.tcl


select * from  table( bass1.get_before('BASS2_Dw_product_bass1_ds')) a 



select count(0) from    
(
            select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
            from (
      select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_code = '1008611' or operation_code = '20102'
      group by brand, calling
      union all
      select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_code = '20106'
      group by brand, calling
      union all
      select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  bass2.dw_custsvc_ivr_log_dm_201107
      where operation_type <> 6
      group by brand, calling
               union all
      select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
               when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
       count(*) as flow, bill_id as product_no
      from  bass2.dw_product_ord_so_log_dm_201107
      where length(trim(char(op_id))) = 4
      and busi_id in (
      select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
      group by case when brand_name like '%全球通%' then 1
        when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                 )a
            group by busi_code_type,brand_id,product_no
            ) a
            
            
            746502
            
            
           


select count(0) from    
(
 select 1 as echl_type,busi_code_type,brand_id,product_no,sum(flow) as flow
            from (
      select 21 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107) a
      where operation_code = '1008611' or operation_code = '20102'
      group by brand, calling
      union all
      select 23 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107) a
      where operation_code = '20106'
      group by brand, calling
      union all
      select 24 as busi_code_type, brand as brand_id, count(*) as flow, calling as product_no
      from  (select * from bass2.dw_custsvc_ivr_log_dm_201107) a
      where operation_type <> 6
      group by brand, calling
               union all
      select 22 as busi_code_type, case when brand_name like '%全球通%' then 1
               when brand_name like '%动感地带%' then 4 else 5 end as brand_id,
       count(*) as flow, bill_id as product_no
      from  (select * from bass2.dw_product_ord_so_log_dm_201107 ) a
      where length(trim(char(op_id))) = 4
      and busi_id in (
      select business_id from  bass2.DIM_SO_BUSIOPTCODE_MAPPING where opt_name not like '%查询%')
      group by case when brand_name like '%全球通%' then 1
        when brand_name like '%动感地带%' then 4 else 5 end, bill_id
                 )a
            group by busi_code_type,brand_id,product_no
) a

746502
            
            

select * from   app.sch_control_task where control_code like '%product%other%ds%.tcl'            


select * from   app.sch_control_before where control_code = 'BASS2_Dwd_product_ord_busi_other_ds.tcl'

select * from app.sch_control_runlog
where control_code = 'TR1_L_11060'




update app.g_runlog 
set return_flag = 0
where time_id between 20110701 and 20110824
and return_flag=1
and unit_code = '22091'


select sum(flow) from    (

	    select 6 as echl_type,22 as busi_code_type , a.brand_id ,a.product_no,count(1) as flow
            from  bass2.dw_product_20110824 a
            , (select * from bass2.dw_product_ord_so_log_dm_201108 where op_time = '2011-08-24' ) c
	, (
	  select product_item_id ,name from bass2.dim_prod_up_product_item where item_type='BUSINESS'
	and name like '%查询%'
	) b
	where
		a.user_id = c.USER_ID
		and c.BUSI_ID  = b.product_item_id
		and  c.OP_ID in ( select OP_ID from  bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%' )
            group by a.brand_id,a.product_no
            
            ) a 
            
            
            select distinct 
         201107
        ,a.USER_ID
        ,b.school_id
        ,'1' MARK_TYPE
        ,'0' IFSEED
from    bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201107 a
left join (select distinct  school_id,SCHOOL_NAME 
                from  bass2.Dim_xysc_maintenance_info ) b on a.SCHOOL_NAME = b.SCHOOL_NAME
where   b.school_id = '89189100000003'  



select distinct SCHOOL_NAME from     bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201107
SCHOOL_NAME
拉萨市警察高等专科学校
拉萨市师范高等专科学校
林芝地区职业中学
西藏大学农牧学院
西藏山南地区第二高级中学
西藏山南地区第一高级中学
西藏山南职业技术学校
西藏职业技术学院

select count(0) from    
bass2.dw_product_ord_so_log_dm_201108 a
	, (
	  select product_item_id ,name from bass2.dim_prod_up_product_item where item_type='BUSINESS'
	and name like '%查询%'
	) b
	where BUSI_ID  = product_item_id
	and  OP_ID in ( select OP_ID from  bass2.DIM_BOSS_STAFF  where op_name like '%自助终端%' )
	and date(a.op_time) = '2011-08-24'
    
    
    select count(0) from    bass2.Dwd_product_ord_busi_other_20110814
    
        select count(0) from    bass2.ods_product_ord_busi_other_20110814
        


select substr('xxx_yyyymmdd',length('xxx_yyyymmdd') - 7 ,8) from bass2.dual

999999
201108

select substr('xxx_yyyymm',length('xxx_yyyymm') - 5 ,6) from bass2.dual

select  bigint('201108') from bass2.dual


select REVERSE('abc') from bass2.dual


select substr('DWD_KF_SMS_CMD_RECEIVE_20110924',locate('_','DWD_KF_SMS_CMD_RECEIVE_20110924')) from sysibm.sysdummy1
select substr('DWD_KF_SMS_CMD_RECEIVE_20110924',locate('_','DWD_KF_SMS_CMD_RECEIVE_20110924')) from sysibm.sysdummy1



20110811
20991231

bigint(sustr(tbname , 5,6)) < 991231

DWD_KF_SMS_CMD_RECEIVE_20110924
DWD_KF_SMS_CMD_RECEIVE_201109





RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20110827BAK;
CREATE TABLE BASS2.DIM_TERM_TAC
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;



ALTER TABLE BASS2.DIM_TERM_TAC_MID ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
  


select count(0) from    BASS2.DIM_TERM_TAC



delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20110827BAK
where net_type <>'2';

select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1

select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20110827BAK
group by tac_nuM
having count(*)>1
0


select count(0) from    BASS2.DIM_TERM_TAC_20110827BAK


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 

db2 reorg table bass1.g_user_lst


db2 "load from /dev/null of del terminate into  bass1.g_user_lst"  



select *
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1




select count(0) from    G_S_04008_DAY where time_id = 20110828

BASS2_Dw_acct_payitem_dm.tcl	帐务缴费记录表

insert into app.sch_control_before 
values ('BASS1_G_S_22066_DAY.tcl','BASS2_Dw_acct_payitem_dm.tcl');
BASS1_G_S_22091_DAY.tcl	int -s G_S_22091_DAY.tcl	2	 Error info:[IBM][CLI Driver][DB2/SUN64] SQL0204N  "BASS2.DW_PRODUCT_BUSI_DM_201109" is an undefined name.  SQLSTATE=42704 	2011-09-02 4:09:22.758450	[NULL]	-1	[NULL]


BASS2_Dw_product_busi_dm.tcl	工单流水表



insert into app.sch_control_before 
values ('BASS1_G_S_22091_DAY.tcl','BASS2_Dw_product_busi_dm.tcl');


select * from   app.sch_control_task where control_code like '%03003%'

BASS1_G_I_03001_MONTH.tcl

select * from   app.sch_control_before 
where control_code = 'BASS1_G_I_03003_MONTH.tcl'


select * from app.sch_control_runlog 
where control_code = 'BASS1_G_I_03003_MONTH.tcl'



  select * from
                (select * from 
                (
                select user_id,chg_vip_time,row_number()over(partition by user_id order by time_id desc) row_id from BASS1.G_I_02005_MONTH
                where time_id=201108
                ) k
                where k.row_id =1) a
                left outer join 
                (
                select * from
                (
                select user_id,create_date,row_number()over(partition by user_id order by time_id desc) row_id 
                from BASS1.G_A_02004_DAY
                where time_id<=20110831
                ) k
                where k.row_id=1) b
                on a.user_id=b.user_id
                where bigint(chg_vip_time)<bigint(create_date)
                with ur
                
89160001048760      	20110924	1	89160001048760      	20110929	1

update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110929'
where user_id = '89160001048760'
and time_id = 201108




select * from 
bass1.g_rule_check where rule_code = 'R146'
ORDER BY 1 DESC 






select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201108 and mns_type='1'
and (product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID) not in (
		select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
		from bass1.g_s_04017_day
		where time_id/100=201108 and mns_type='1'
		group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID )
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 



select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201108 and mns_type='1'
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
except
		select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
		from bass1.g_s_04017_day
		where time_id/100=201108 and mns_type='1'
		group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 


PRODUCT_NO	ROAM_TYPE_ID	TOLL_TYPE_ID	CALL_TYPE_ID
15089054074    	500	010	02


		select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
		from bass1.g_s_04017_day
		where time_id/100=201108 and mns_type='1'
		group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID   
except        
select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201108 and mns_type='1'
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 

select * from   bass1.g_s_04017_day
where   PRODUCT_NO = '15089054074'   
and time_id=201108 
and ROAM_TYPE_ID = '500'
and TOLL_TYPE_ID = '010'
and mns_type='1' 


select *
from bass1.g_s_21003_month
where time_id=201108 and mns_type='1'
and PRODUCT_NO = '15089054074'   



select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201108 and mns_type='1' and PRODUCT_NO = '15089054074'  
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
except
		select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
		from bass1.g_s_04017_day
		where time_id/100=201108 and mns_type='1' and PRODUCT_NO = '15089054074'  
		group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 



delete from  g_s_21003_month 
where time_id=201108 and mns_type='1' and PRODUCT_NO = '15089054074'  
and ROAM_TYPE_ID = '500'
and TOLL_TYPE_ID = '010'
and CALL_TYPE_ID = '02'


select * from    bass1.g_s_21003_to_day
where time_id / 100 = 201108
and PRODUCT_NO = '15089054074'  
20110823	15089054074    	2	009	010	1000	010000	500	02	1             	2             	0             	94            	0             	0             	0             	0             	0             	0             	0             	0             	94            	0             	1	0


select * from   bass1.g_s_04017_day
where time_id = 20110823
and PRODUCT_NO = '15089054074'  

select *
               from  bass2.cdr_call_dtl_20110823 a
               where MNS_TYPE=1
                 and PRODUCT_NO = '15089054074'  
                 
                 

delete from  g_s_21003_month 
where time_id=201108 and mns_type='1' and PRODUCT_NO = '15089054074'  
and ROAM_TYPE_ID = '500'
and TOLL_TYPE_ID = '010'
and CALL_TYPE_ID = '02'


select * from   G_S_22021_MONTH where 
show_id = '00030028'




 select interface_code from   bass1.MON_ALL_INTERFACE b where 
deadline  in (3,5)
and type = 'm'
except
select a from table (
select '01005' a from bass2.dual union all
select '02005' a from bass2.dual union all
select '02014' a from bass2.dual union all
select '02015' a from bass2.dual union all
select '02016' a from bass2.dual union all
select '02018' a from bass2.dual union all
select '02019' a from bass2.dual union all
select '02020' a from bass2.dual union all
select '02021' a from bass2.dual union all
select '02047' a from bass2.dual union all
select '02049' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '03001' a from bass2.dual union all
select '03002' a from bass2.dual union all
select '03003' a from bass2.dual union all
select '06011' a from bass2.dual union all
select '06012' a from bass2.dual union all
select '06021' a from bass2.dual union all
select '06022' a from bass2.dual union all
select '06023' a from bass2.dual union all
select '06029' a from bass2.dual union all
select '22009' a from bass2.dual union all
select '22101' a from bass2.dual union all
select '22103' a from bass2.dual union all
select '22105' a from bass2.dual union all
select '22106' a from bass2.dual union ) a 
except


 select * from   bass1.MON_ALL_INTERFACE b where 
 interface_code = '03004'
 
 insert into app.sch_control_before 
 values ('BASS1_G_S_22404_MONTH.tcl','REP_App_xysc_school_user_ms.tcl')
 
 select count(0),count(distinct product_no ) from    bass2.dw_xysc_school_real_user_dt_201108


select replace(char(current date - ( 1+22 ) days),'-','') from bass2.dual

select count(0) from    bass2.dw_xysc_school_real_user_dt_201108

select count(0) from    bass2.dw_xysc_school_real_user_dt_201108



insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201108


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201108

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 


select tabname from syscat.tables where tabname like '%SCH_CONTROL_TASK%'   

select cnt,rn from (
select time_id,round(20+rand(1)*10,0) cnt , row_number()over() rn from bass1.g_s_22021_month
where show_id = '00030028'
) a 
where time_id = 201108






select * from    bass1.g_s_22021_month
where time_id = 201108
order by 1,3


select count(0) from    G_S_22401_MONTH


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22401_MONTH 
group by  time_id 
order by 1 

select * from  bass1.mon_all_interface where type = 'm'
and interface_code in (
select interface_code from bass1.mon_all_interface where type = 'm'
except
select a from (
select '01005' a from bass2.dual union all
select '02005' a from bass2.dual union all
select '02006' a from bass2.dual union all
select '02007' a from bass2.dual union all
select '02014' a from bass2.dual union all
select '02015' a from bass2.dual union all
select '02016' a from bass2.dual union all
select '02018' a from bass2.dual union all
select '02019' a from bass2.dual union all
select '02020' a from bass2.dual union all
select '02021' a from bass2.dual union all
select '02047' a from bass2.dual union all
select '02049' a from bass2.dual union all
select '02052' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '03001' a from bass2.dual union all
select '03002' a from bass2.dual union all
select '03003' a from bass2.dual union all
select '03004' a from bass2.dual union all
select '03005' a from bass2.dual union all
select '03007' a from bass2.dual union all
select '03012' a from bass2.dual union all
select '03015' a from bass2.dual union all
select '03016' a from bass2.dual union all
select '03017' a from bass2.dual union all
select '03018' a from bass2.dual union all
select '06011' a from bass2.dual union all
select '06012' a from bass2.dual union all
select '06021' a from bass2.dual union all
select '06022' a from bass2.dual union all
select '06023' a from bass2.dual union all
select '06029' a from bass2.dual union all
select '21003' a from bass2.dual union all
select '21006' a from bass2.dual union all
select '21008' a from bass2.dual union all
select '21010' a from bass2.dual union all
select '21011' a from bass2.dual union all
select '21012' a from bass2.dual union all
select '21013' a from bass2.dual union all
select '21014' a from bass2.dual union all
select '21015' a from bass2.dual union all
select '21020' a from bass2.dual union all
select '05001' a from bass2.dual union all
select '05002' a from bass2.dual union all
select '05003' a from bass2.dual union all
select '22013' a from bass2.dual union all
select '22021' a from bass2.dual union all
select '22025' a from bass2.dual union all
select '22032' a from bass2.dual union all
select '22033' a from bass2.dual union all
select '22039' a from bass2.dual union all
select '22041' a from bass2.dual union all
select '22042' a from bass2.dual union all
select '22043' a from bass2.dual union all
select '22009' a from bass2.dual union all
select '22049' a from bass2.dual union all
select '22050' a from bass2.dual union all
select '22052' a from bass2.dual union all
select '22055' a from bass2.dual union all
select '22056' a from bass2.dual union all
select '22057' a from bass2.dual union all
select '22058' a from bass2.dual union all
select '22059' a from bass2.dual union all
select '22060' a from bass2.dual union all
select '22061' a from bass2.dual union all
select '22063' a from bass2.dual union all
select '22067' a from bass2.dual union all
select '22068' a from bass2.dual union all
select '22101' a from bass2.dual union all
select '22103' a from bass2.dual union all
select '22105' a from bass2.dual union all
select '22106' a from bass2.dual union all
select '22204' a from bass2.dual union all
select '22036' a from bass2.dual union all
select '22040' a from bass2.dual union all
select '22072' a from bass2.dual union all
select '22303' a from bass2.dual union all
select '22304' a from bass2.dual union all
select '22305' a from bass2.dual union all
select '22306' a from bass2.dual union all
select '22307' a from bass2.dual union all
select '22081' a from bass2.dual union all
select '22083' a from bass2.dual union all
select '22085' a from bass2.dual union all
select '22086' a from bass2.dual ) a


)



select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
)

select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
except
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108



select USER_ID,OPP_NBR , count(0) 
--,  count(distinct USER_ID,OPP_NBR ) 
from G_S_22404_MONTH 
group by  USER_ID,OPP_NBR 
order by 1 


select * from   g_s_22404_month where time_id = 201108

select * from   g_s_22404_month_1

select * from   g_s_22403_month where time_id = 201108
select USER_ID,OPP_NBR , count(0) 
--,  count(distinct USER_ID,OPP_NBR ) 
from G_S_22403_MONTH 
group by  USER_ID,OPP_NBR 
order by 1 

alter table bass1.int_02004_02008_month_stage activate not logged initially with empty table

insert into bass1.int_02004_02008_month_stage (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1

select  length(trim(PRODUCT_NO)) ,count(0) from   bass1.int_02004_02008_month_stage 
group by length(trim(PRODUCT_NO))

select * from   bass1.int_02004_02008_month_stage where length(trim(PRODUCT_NO)) = 7
select * from   bass1.int_02004_02008_month_stage where length(trim(PRODUCT_NO)) = 12
 
 
 
 select distinct SCHOOL_ID from G_I_06003_MONTH where TIME_ID = 201108
and SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
) 


select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)



select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)

select time_id,count(0) from    G_I_02032_MONTH 
group by time_id
select time_id,count(0) from    G_I_02031_MONTH 
group by time_id


select count(0) from    G_I_02033_MONTH where TIME_ID = 201108


select distinct SCHOOL_ID from G_I_02033_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)

select count(0) from    G_I_02034_MONTH where TIME_ID = 201108

select count(0) from    G_S_22404_MONTH where TIME_ID = 201108

select count(0) from    G_S_22403_MONTH where TIME_ID = 201108

select time_id,count(0) from    G_S_22403_MONTH 
group by time_id

select time_id,count(0) from    G_S_22404_MONTH 
group by time_id


select count(0) from     bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108
20623
select count(0) from     bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201107
11345

select count(0) from    G_I_22405_MONTH

drop table G_I_22405_MONTH

CREATE TABLE "BASS1   "."G_I_22405_MONTH"  (
                  "TIME_ID" INTEGER , 
                  PRODUCT_NO char(20),
                  "USER_ID" CHAR(20) , 
                  "SCHOOL_ID" CHAR(20) , 
                  "RUN_MONTH" CHAR(6) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select distinct 
	 201108
        ,a.USER_ID
        ,b.school_id
        ,'1' MARK_TYPE
	,'0' IFSEED
from    bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108 a
left join (select distinct  school_id,SCHOOL_NAME 
		from  bass2.Dim_xysc_maintenance_info ) b on a.SCHOOL_NAME = b.SCHOOL_NAME
where 	b.school_id = '89189100000003'	
with ur


select count(0) from bass2.dw_call_cell_201108  where lac_id='35136' and cell_id in ('10221','10232','10222','10231','10233')

select count(0) from bass2.dw_call_cell_201108  where lac_id='35084' and cell_id in ('7DF0','7DFA','7DE6')

35084	32240
35084	32250
35084	32230

select lac_id,cell_id from bass2.dw_call_cell_201108 




select count(0) from bass2.dw_call_cell_201108  where lac_id='35136' and cell_id in ('27ED','27F8','27EE','27F7','27F9')



select  length(trim(PRODUCT_NO)) ,count(0) from   bass1.int_02004_02008_month_stage 
group by length(trim(PRODUCT_NO))


select distinct school_name from bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108
where school_name like '%西藏大学%'
except 
select school_name from bass2.Dim_xysc_maintenance_info


select * from  bass2.Dim_xysc_maintenance_info where  school_name like '%西藏大学%'



select school_name , count(0) 
--,  count(distinct school_name ) 
from bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108 
group by  school_name 
order by 1 

select count(0) from    
bass2.dw_xysc_school_comp_user_dt_201108
 


select  school_name ,count(0) from bass2.dw_xysc_school_comp_user_dt_201108
where school_name like '%西藏大学%'
group by school_name

select count(0) from    G_I_02034_MONTH
select count(0) from    G_I_02035_MONTH





select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (8)
and type = 'm'
and sts = 1
and interface_code  in 
('06001'
,'06002'
,'06003'
,'02031'
,'02032'
,'02033'
,'02034'
,'02035'
,'22403'
,'22404'
,'22405'
,'22406'
)


select count(0) from    G_S_03004_MONTH where time_id = 201108
9718699
select count(0) from    G_S_03005_MONTH where time_id = 201108

6408283

   select * from   bass1.g_rule_check 
where rule_code = 'R021'

201108	R235	1304217.00000	43727.00000	0.03352	0.00000



alter table bass1.int_02004_02008_month_stage activate not logged initially with empty table


insert into bass1.int_02004_02008_month_stage (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201108 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201108 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1






select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (9)
and type = 'd'
and sts = 1




select USER_ID||SCHOOL_ID||STUD_MARK||MARK_TYPE from bass1.G_I_02017_MONTH where time_id=201108
select 
         TIME_ID
        ,USER_ID
        ,SCHOOL_ID
        ,STUD_MARK
        ,MARK_TYPE from bass1.G_I_02017_MONTH where time_id=201108


select distinct school_name from bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108
where school_name like '%西藏大学%'
except 
select school_name from bass2.Dim_xysc_maintenance_info


select distinct school_name from bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201108
where school_name like '%西藏大学%'
except 
select school_name from bass1.G_I_06001_MONTH where time_id = 201108


--1.找出 tac码和操作系统对应关系

select distinct  a.TAC_NUM,a.DEV_ID ,b.DEVICE_NAME,c.VALUE_DESC
from   BASS2.DIM_TACNUM_DEVID a
,BASS2.DIM_DEVICE_INFO    b 
,(select * from  BASS2.DIM_DEVICE_PROFILE   where PROPERTY_ID =  '003001' ) c 
where a.DEV_ID = b.DEVICE_ID
and a.dev_id = c.DEVICE_ID
and (
lower(c.VALUE_DESC) like '%android%'
or lower(c.VALUE_DESC) like '%ios%'
)

--2. 然后根据 imei 和 tac码的关系取用户



select a.user_id, b.*
from  bass2.dw_product_mobilefunc_201108  a , 
    table (
    select distinct  a.TAC_NUM,a.DEV_ID ,b.DEVICE_NAME,c.VALUE_DESC
    from   BASS2.DIM_TACNUM_DEVID a
        ,BASS2.DIM_DEVICE_INFO    b 
        ,(select * from  BASS2.DIM_DEVICE_PROFILE   where PROPERTY_ID =  '003001' ) c 
    where a.DEV_ID = b.DEVICE_ID
    and a.dev_id = c.DEVICE_ID
    and (
        lower(c.VALUE_DESC) like '%android%'
        or lower(c.VALUE_DESC) like '%ios%'
        )
        )       b 
where  substr(a.imei,1,8) = b.tac_num 
and usertype_id in (1,2,9) 
 and userstatus_id in (1,2,3,6,8)
 --and test_mark<>1


select count(0),count(distinct tac_num) from 
 table (
    select distinct  a.TAC_NUM,a.DEV_ID ,b.DEVICE_NAME,c.VALUE_DESC
    from   BASS2.DIM_TACNUM_DEVID a
        ,BASS2.DIM_DEVICE_INFO    b 
        ,(select * from  BASS2.DIM_DEVICE_PROFILE   where PROPERTY_ID =  '003001' ) c 
    where a.DEV_ID = b.DEVICE_ID
    and a.dev_id = c.DEVICE_ID
    and (
        lower(c.VALUE_DESC) like '%android%'
        or lower(c.VALUE_DESC) like '%ios%'
        )
        )       b 
       
      select * from bass1.mon_all_interface where interface_code = '02017' 

      
      
select count(0) from    G_I_02034_MONTH where TIME_ID = 201108

select SCHOOL_NAME,count(0) from bass2.dw_xysc_school_comp_user_dt_201108    
group by SCHOOL_NAME



select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (15)
and type = 'm'
and sts = 1



select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (3)
and type = 'm'
and sts = 1
and interface_code  in 
('06001'
,'06002'
,'06003'
,'02031'
,'02032'
,'02033'
,'02034'
,'02035'
,'22403'
,'22404'
,'22405'
,'22406'
)


select * from   G_I_06001_MONTH where  TIME_ID = 201108
and SCHOOL_ID in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
)

)

insert into app.sch_control_before
values('BASS1_G_I_06003_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')


select * from  table( bass1.get_task('G_A_02004_DAY')) a 

BASS2_Dw_call_roamin_dm.tcl	漫入话单多日表


"select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
)
"
" select distinct SCHOOL_ID from G_I_06003_MONTH where TIME_ID = 201108
and SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
) 
"
"select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)"
"select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)
"
"select distinct SCHOOL_ID from G_I_02033_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)"


select * from BASS2.ETL_SEND_MESSAGE 


select  school_name ,count(0) from bass2.dw_xysc_school_comp_user_dt_201108
where school_name like '%西藏大学%'
group by school_name

select * from BASS2.TRIGGER_SEND_LIST
insert into BASS2.TRIGGER_SEND_LIST
select 'BASS1' , '15089051890','刘青锋' from bass2.dual



select  school_name ,count(0) from bass2.dw_xysc_school_comp_user_dt_201108
group by school_name

select count(0) from    bass1.G_I_02035_MONTH where time_id=201108



select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1
except
select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1

select * from   G_I_06002_MONTH where time_id = 201108

select distinct SCHOOL_ID from G_I_02034_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)

select distinct SCHOOL_ID from G_I_02035_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
)



select count(0) from    bass2.dw_xysc_school_comp_user_dt_201108
1356
select count(0) from    bass2.dw_xysc_school_comp_user_dt_201107
1356

select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and unit_code = '02017'



select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1
except
select substr(filename,16,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1


select * from   bass1.mon_all_interface where interface_code = '02017'


select count(0) from     bass1.G_I_02033_MONTH where time_id=201108
select count(0) from bass1.G_I_02035_MONTH where time_id=201108


select 
         201108 TIME_ID
        ,a.COMP_NO USER_ID
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end COMP_BRAND_ID
from bass2.dw_xysc_school_comp_user_dt_201108 a
left join bass2.Dim_xysc_maintenance_info b  on ( case when a.SCHOOL_NAME like '%西藏大学%' then '西藏大学' else a.SCHOOL_NAME end ) = b.SCHOOL_NAME
join bass2.dw_comp_cust_201108 d on a.comp_no = d.COMP_PRODUCT_NO
where  d.COMP_BRAND_ID  in (1,2,9,10,11,3,4,5,7)
and b.school_id = '89189100000003'
and a.school_name not in (select distinct school_name from bass2.Dim_xysc_maintenance_info 
        where SCHOOL_NAME <> '西藏大学'
        and SCHOOL_NAME <> '西藏大学农牧学院'
        )
group by 
        a.COMP_NO
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end 
with ur



select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
except

select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1


select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1


select * from   app.sch_control_task where control_code = 'BASS1_REPORT_KEY_INDEX_MONTH.tcl'


select tabname from syscat.tables where tabname like '%01004%'   

alter table BASS1.G_S_04003_DAY ALTER column FLOWUP 	SET DATA TYPE CHARACTER(13)
alter table BASS1.G_A_01004_DAY_T20110920 ALTER column FLOWDOWN  SET DATA TYPE CHARACTER(13)

G_A_01004_DAY_T20110920

CREATE TABLE "BASS1   "."G_A_01004_DAY_T20110920"  (
                  "TIME_ID" INTEGER , 
                  "ENTERPRISE_ID" CHAR(20) , 
                  "ENT_DEF_MODE" CHAR(1) , 
                  "PRT_GRP_CUST_ID" CHAR(20) , 
                  "ENTERPRISE_NAME" CHAR(60) , 
                  "OWNER_NAME" CHAR(20) , 
                  "NET_ADDRESS" CHAR(250) , 
                  "FAX_NO" CHAR(20) , 
                  "ENT_SCALE_ID" CHAR(1) , 
                  "MEMBER_NUMS" CHAR(8) , 
                  "ENT_REGION_TYPE" CHAR(2) , 
                  "ENT_INDUSTRY_ID" CHAR(2) , 
                  "GRP_AREA_SPEC_ID" CHAR(2) , 
                  "ENT_MANAGER_ID" CHAR(20) , 
                  "CMCC_ID" CHAR(5) , 
                  "CREATE_DATE" CHAR(8) , 
                  "LINKMAN_NAME" CHAR(20) , 
                  "TELEPHONE_NUM" CHAR(20) , 
                  "MOBILE_NUM" CHAR(15) , 
                  "LINKMAN_TITLE" CHAR(20) , 
                  "LINKMAN_FAX" CHAR(20) , 
                  "LINKMAN_MAIL" CHAR(50) , 
                  "LINKMAN_ADDR" CHAR(70) , 
                  "POST_CODE" CHAR(6) , 
                  "CUST_STATU_TYP_ID" CHAR(2) , 
                  "UNITE_PAY_FLAG" CHAR(1) , 
                  "IND_RES_SCHEMA" CHAR(100) , 
                  "CRT_CHNL_ID" CHAR(40) , 
                  "ENTER_TYPE_ID" CHAR(2) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "ENTERPRISE_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

select * from   G_A_01004_DAY_T20110920


alter table BASS1.G_A_01004_DAY DROP column OWNER_NAME 
alter table BASS1.G_A_01004_DAY DROP column ENT_MANAGER_ID 
alter table BASS1.G_A_01004_DAY DROP column LINKMAN_NAME 
alter table BASS1.G_A_01004_DAY DROP column LINKMAN_TITLE 
alter table BASS1.G_A_01004_DAY DROP column IND_RES_SCHEMA 


drop table G_A_01004_DAY_T20110920

CUST_NAME


alter table BASS1.G_I_22405_MONTH ALTER column PRODUCT_NO 	SET DATA TYPE CHARACTER(15)
alter table BASS1.G_I_22406_MONTH ALTER column PRODUCT_NO 	SET DATA TYPE CHARACTER(15)

db2 reorg table BASS1.G_I_22405_MONTH 
db2 reorg table BASS1.G_I_22406_MONTH

OTHCOVER_INFO


db2 reorg table BASS1.G_I_06003_MONTH 


insert into app.sch_control_before
values('BASS1_G_I_06002_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
BASS1_EXP_G_I_06002_MONTH	BASS1_G_I_06002_MONTH.tcl



alter table BASS1.G_A_01005_MONTH ALTER column ID 	SET DATA TYPE CHARACTER(11)

select b.* from 
(select distinct item_id  from    bass2.dw_acct_shoulditem_201108) a 
, bass2.dim_acct_item b 
where a.item_id = b.ITEM_ID



select * from BASS1.ALL_DIM_LKP
where BASS1_TBID = 'BASS_STD1_0074'
and  xzbas_value in 
('80000180'
,'80000184'
,'80000598'
,'80000599'
,'82000111'
)

insert into BASS1.ALL_DIM_LKP
select 
         'dim_acct_item' XZBAS_TBNAME
        ,'BlackBerry功能费' XZBAS_COLNAME
        ,'80000180' XZBAS_VALUE
        ,'帐目科目' BASS1_TBN_DESC
        ,'BASS_STD1_0074' BASS1_TBID
        ,'0527' BASS1_VALUE
        ,'BlackBerry月功能费' BASS1_VALUE_DESC
from bass2.dual

select count(0) from      bass2.dw_acct_shoulditem_201108
where item_id = 80000180

select * from      bass2.dw_acct_shoulditem_201108
where item_id = 80000180

select * from   G_I_02034_MONTH

select * from   G_I_02033_MONTH

select * from   G_I_02035_MONTH


alter table BASS1.G_I_02033_MONTH ALTER column USER_ID 	SET DATA TYPE CHARACTER(15)
alter table BASS1.G_I_02035_MONTH ALTER column USER_ID 	SET DATA TYPE CHARACTER(15)
db2 reorg table BASS1.G_I_02033_MONTH 
db2 reorg table BASS1.G_I_02035_MONTH
 



select a from 
(
select '02028' a from bass2.dual union all
select '22074' a from bass2.dual union all
select '03019' a from bass2.dual union all
select '02065' a from bass2.dual union all
select '22403' a from bass2.dual union all
select '22404' a from bass2.dual union all
select '06034' a from bass2.dual union all
select '22069' a from bass2.dual union all
select '06035' a from bass2.dual union all
select '06036' a from bass2.dual union all
select '06037' a from bass2.dual union all
select '06038' a from bass2.dual union all
select '06039' a from bass2.dual union all
select '02066' a from bass2.dual union all
select '22075' a from bass2.dual union all
select '22076' a from bass2.dual union all
select '22077' a from bass2.dual
) a 
except
select b from 
(
select '01002' b from bass2.dual union all
select '02004' b from bass2.dual union all
select '02008' b from bass2.dual union all
select '02011' b from bass2.dual union all
select '02014' b from bass2.dual union all
select '02015' b from bass2.dual union all
select '02016' b from bass2.dual union all
select '02018' b from bass2.dual union all
select '02019' b from bass2.dual union all
select '02020' b from bass2.dual union all
select '02021' b from bass2.dual union all
select '02031' b from bass2.dual union all
select '02032' b from bass2.dual union all
select '02033' b from bass2.dual union all
select '02034' b from bass2.dual union all
select '02035' b from bass2.dual union all
select '02047' b from bass2.dual union all
select '02049' b from bass2.dual union all
select '02050' b from bass2.dual union all
select '02052' b from bass2.dual union all
select '02053' b from bass2.dual union all
select '02063' b from bass2.dual union all
select '03001' b from bass2.dual union all
select '03002' b from bass2.dual union all
select '03004' b from bass2.dual union all
select '03005' b from bass2.dual union all
select '03013' b from bass2.dual union all
select '04002' b from bass2.dual union all
select '04004' b from bass2.dual union all
select '04005' b from bass2.dual union all
select '04006' b from bass2.dual union all
select '04008' b from bass2.dual union all
select '04011' b from bass2.dual union all
select '05001' b from bass2.dual union all
select '05002' b from bass2.dual union all
select '05003' b from bass2.dual union all
select '06001' b from bass2.dual union all
select '06003' b from bass2.dual union all
select '06021' b from bass2.dual union all
select '06022' b from bass2.dual union all
select '06023' b from bass2.dual union all
select '06011' b from bass2.dual union all
select '06012' b from bass2.dual union all
select '06029' b from bass2.dual union all
select '06031' b from bass2.dual union all
select '06032' b from bass2.dual union all
select '21001' b from bass2.dual union all
select '21002' b from bass2.dual union all
select '21007' b from bass2.dual union all
select '21003' b from bass2.dual union all
select '21008' b from bass2.dual union all
select '21011' b from bass2.dual union all
select '21012' b from bass2.dual union all
select '21013' b from bass2.dual union all
select '21014' b from bass2.dual union all
select '21015' b from bass2.dual union all
select '21020' b from bass2.dual union all
select '22012' b from bass2.dual union all
select '22013' b from bass2.dual union all
select '22038' b from bass2.dual union all
select '22039' b from bass2.dual union all
select '22032' b from bass2.dual union all
select '22033' b from bass2.dual union all
select '22035' b from bass2.dual union all
select '22052' b from bass2.dual union all
select '22070' b from bass2.dual union all
select '22073' b from bass2.dual union all
select '22075' b from bass2.dual union all
select '22076' b from bass2.dual union all
select '22077' b from bass2.dual union all
select '22061' b from bass2.dual union all
select '22063' b from bass2.dual union all
select '22091' b from bass2.dual union all
select '22092' b from bass2.dual union all
select '22066' b from bass2.dual union all
select '22067' b from bass2.dual union all
select '22068' b from bass2.dual union all
select '22049' b from bass2.dual union all
select '22050' b from bass2.dual union all
select '22055' b from bass2.dual union all
select '22056' b from bass2.dual union all
select '22101' b from bass2.dual union all
select '22102' b from bass2.dual union all
select '22103' b from bass2.dual union all
select '22104' b from bass2.dual union all
select '22105' b from bass2.dual union all
select '22201' b from bass2.dual union all
select '22202' b from bass2.dual union all
select '22203' b from bass2.dual union all
select '22080' b from bass2.dual union all
select '22081' b from bass2.dual union all
select '22082' b from bass2.dual union all
select '22083' b from bass2.dual union all
select '22084' b from bass2.dual union all
select '22085' b from bass2.dual union all
select '22086' b from bass2.dual 
) b


CREATE TABLE "BASS1   "."G_I_22403_MONTH_1"  (
                  "OP_TIME" INTEGER , 
                  "USER_ID" VARCHAR(20) , 
                  "PRODUCT_NO" VARCHAR(15) , 
                  "SCHOOL_NAME" VARCHAR(128) , 
                  "OPPOSITE_NO" VARCHAR(32) , 
                  "CALL_COUNTS" INTEGER , 
                  "CALL_DURATION_S" INTEGER , 
                  "CALL_DURATION_M" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "PRODUCT_NO",  
                 "OPPOSITE_NO")   
                   IN "TBS_BASS_MINER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 



CREATE TABLE "BASS1   "."G_I_22403_MONTH_2"  (
                  "OP_TIME" INTEGER , 
                  "USER_ID" VARCHAR(20) , 
                  "PRODUCT_NO" VARCHAR(15) , 
                  "SCHOOL_NAME" VARCHAR(128) , 
                  "OPPOSITE_NO" VARCHAR(32) , 
                  "CALL_COUNTS" INTEGER , 
                  "CALL_DURATION_S" INTEGER , 
                  "CALL_DURATION_M" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "PRODUCT_NO",  
                 "OPPOSITE_NO")   
                   IN "TBS_BASS_MINER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 



 

CREATE TABLE "BASS1   "."G_I_22404_MONTH_2"  (
                  "OP_TIME" INTEGER , 
                  "USER_ID" VARCHAR(20) , 
                  "PRODUCT_NO" VARCHAR(15) , 
                  "OPPOSITE_NO" VARCHAR(32) , 
                  "SMS_COUNTS" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "PRODUCT_NO",  
                 "OPPOSITE_NO")   
                   IN "TBS_BASS_MINER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 



CREATE TABLE "BASS1   "."G_I_22404_MONTH_1"  (
                  "OP_TIME" INTEGER , 
                  "USER_ID" VARCHAR(20) , 
                  "PRODUCT_NO" VARCHAR(15) , 
                  "OPPOSITE_NO" VARCHAR(32) , 
                  "SMS_COUNTS" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID",  
                 "PRODUCT_NO",  
                 "OPPOSITE_NO")   
                   IN "TBS_BASS_MINER" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 


select count(0) from   G_S_22403_MONTH where time_id = 201108
1030021
1052005
select count(0) from   G_I_22403_MONTH where time_id = 201108
1052005
select count(0) from   G_S_22403_MONTH_CANCEL_OLD where time_id = 201108

select tabname from syscat.tables where tabname like '%22403%' 

select count(0) from   G_I_22404_MONTH where time_id = 201108

select count(0) from    g_s_22404_month_2
817553
select count(0) from    g_i_22404_month_2
713271

select count(0) from    g_s_22404_month_1 where OP_TIME/100 = 201108
2296109
select count(0) from    g_i_22404_month_1 where OP_TIME/100 = 201108
1727415

select count(0) from    bass2.dw_xysc_school_comp_user_dt_201108


select 
         201108 TIME_ID
        ,a.COMP_NO USER_ID
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end COMP_BRAND_ID
        ,'1' MARK_TYPE
from bass2.dw_xysc_school_comp_user_dt_201108 a
left join bass2.Dim_xysc_maintenance_info b on a.SCHOOL_NAME = b.SCHOOL_NAME
join bass2.dw_comp_cust_201108 d on a.comp_no = d.COMP_PRODUCT_NO
where  d.COMP_BRAND_ID  in (1,2,9,10,11,3,4,5,7)
and a.PHONE_TYPE = 'S'
group by 
a.COMP_NO
,b.SCHOOL_ID 
,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end 




CREATE TABLE "BASS1   "."G_S_22404_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "OPP_NBR" CHAR(20) , 
                  "CALL_CNT" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "OPP_NBR")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



 

CREATE TABLE "BASS1   "."G_S_22403_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "OPP_NBR" CHAR(20) , 
                  "CALL_CNT" CHAR(8) , 
                  "CALL_DUR" CHAR(8) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "OPP_NBR")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 







select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_22403_MONTH 
group by  time_id 
order by 1 



select OP_TIME , count(0) 
--,  count(distinct time_id ) 
from G_I_22403_MONTH_1 
group by  OP_TIME 
order by 1 


select OP_TIME , count(0) 
--,  count(distinct time_id ) 
from G_S_22403_MONTH_1 
group by  OP_TIME 
order by 1 


select * from   bass2.dim_prod_up_product_item  where lower(name) like '%农信宝%'

select count(0) from    
bass2.dw_product_ins_off_ins_prod_201108
where OFFER_ID in (133000000014,123000000014,113000000014,123000000013,133000000013,113000000013)


select * from    
bass2.dw_product_ins_off_ins_prod_201108
where OFFER_ID in (133000000014,123000000014,113000000014,123000000013,133000000013,113000000013)

select 
        USER_ID
        ,PKG_ID
        ,ORDER_DT
        ,STS_CD
from (	
	select 
         TIME_ID
        ,USER_ID
        ,PKG_ID
        ,ORDER_DT
        ,STS_CD
	,row_number()over(partition by user_id order by TIME_ID desc ) rn 
	from G_A_02028_DAY a 
) t where rn = 1 


select 
PRODUCT_INSTANCE_ID
,case 
when OFFER_ID = 113000000013 then '9999121202900981011001'
when OFFER_ID = 113000000014 then '9999121202901081011001' end pkg_id
,replace(char(date(VALID_DATE)),'-','') VALID_DATE
,case when STATE = 1 then '1' else '2' end STATE
,CREATE_DATE,VALID_DATE,expire_date
from bass2.dw_product_ins_off_ins_prod_ds a
where OFFER_ID in (113000000013,113000000014)
        and a.valid_type in (1,2)
        and date(a.expire_date) >= '2011-09-22'


select 
PRODUCT_INSTANCE_ID
,case 
when OFFER_ID = 113000000013 then '9999121202900981011001'
when OFFER_ID = 113000000014 then '9999121202901081011001' 
end pkg_id
,replace(char(date(VALID_DATE)),'-','') VALID_DATE
,case when STATE = 1 then '1' else '2' end STATE
from bass2.dw_product_ins_off_ins_prod_ds a
where OFFER_ID in (113000000013,113000000014)
        and a.valid_type in (1,2)
        and date(a.expire_date) >= '2011-09-22'
        and a.VALID_DATE < a.expire_date
except
select 
        USER_ID
        ,PKG_ID
        ,ORDER_DT
        ,STS_CD
from (	
	select 
         TIME_ID
        ,USER_ID
        ,PKG_ID
        ,ORDER_DT
        ,STS_CD
	,row_number()over(partition by user_id order by TIME_ID desc ) rn 
	from G_A_02028_DAY a 
) t where rn = 1 




select count(0),count(distinct school_id) from    G_I_06001_MONTH where time_id = 201108

select count(0),count(distinct school_id) from    G_I_06001_MONTH where time_id = 201107

select count(0),count(distinct USER_ID) from    G_I_02031_MONTH where time_id = 201107

select count(0),count(distinct USER_ID) from    G_I_02032_MONTH where time_id = 201107

select count(0),count(distinct USER_ID) from    G_I_02033_MONTH where time_id = 201107

select count(0),count(distinct USER_ID) from    G_I_02031_MONTH where time_id = 201107
and 
5000	5506

select count(0),count(distinct USER_ID) from    G_I_02032_MONTH where time_id = 201108

select count(0),count(distinct user_id) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
) a where rn = 1

48171	48171

select count(0),count(distinct user_id) from    G_I_02022_DAY where time_id = 20110831
39864


select distinct user_id from  G_I_02022_DAY where time_id = 20110831
except 
select distinct user_id from 
(
select a.* , row_number()over(partition by user_id order by time_id desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
) a where rn = 1

(2010,2020,2030,2040,9000)

select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110930 
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110930
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110930'
) a where rn = 1


89160000917567      	QW_QQT_JC_SL88                
89660000724418      	QW_QQT_JC_BD128


89760000929358      	QW_QQT_JC_SL188


select * from   G_I_02022_DAY where user_id = '89760000929358'
20110930	89760000929358      	QW_QQT_JC_SL188               	20110901


select * from   G_S_02024_DAY where user_id = '89760000929358'
20110919	89160000917567      	QW_QQT_JC_SL128               	91000063                                	20110919	20110701

select * from   bass1.g_a_02004_02008_stage 



(
select a.* , row_number()over(partition by user_id order by time_id desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110731
and REC_DT <= '20110731'
) a

select * from     bass2.dim_cfg_static_data where code_name like '%预占%'

select count(0) from    g_i_06001_month where time_id 




select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1


89157332858179      	QW_QQT_JC_SL58

select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
and user_id = '89157332858179'


select * from   G_I_02022_DAY where  user_id = '89157332858179'

20110831	89157332858179      	QW_QQT_JC_SL58                	20110901

select * from   G_S_02024_DAY where  user_id = '89157332858179'





select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1


select * from   G_S_02024_DAY where 
USER_ID in (
'89157332858179'
,'89160000878109'      
,'89160000878194'      
,'89160001253259'      
,'89257331538332'      
,'89260000405763'      
,'89360000802726'      
,'89360000860968'      
,'89557334274678'      
,'89601160020355'      
,'89601160028204'      
,'89601160037799'      
,'89657332233890'      
,'89660000814390'      
,'89757332891167'      
)


TIME_ID	USER_ID	BASE_PKG_ID	CHANNEL_ID	REC_DT	VALID_DT
20110726	89360000802726      	QW_QQT_JC_SL888               	30300107                                	20110726	20110801
20110824	89160001253259      	QW_QQT_JC_SL58                	91000850                                	20110824	20110824
20110824	89160001253259      	QW_QQT_JC_SL88                	91000850                                	20110824	20110824

89360000802726      	QW_QQT_JC_SL88
89160001253259      	QW_QQT_JC_SL88

select distinct school_id from g_I_06001_month where time_id = 201107
select distinct school_id from g_I_06001_month where time_id = 201108

select *  from g_I_06001_month where time_id = 201107

select *  from g_I_06001_month where time_id = 201108

select * from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89160001253259'
and a.OFFER_ID = b.PRODUCT_ITEM_ID


select count(0),count(distinct user_id) from    G_I_02022_DAY where time_id = 20110831
39864	39864

select count(0),count(distinct user_id) from    G_I_02022_DAY where time_id = 20110831

89260000405763

select * from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89260000405763'
and a.OFFER_ID = b.PRODUCT_ITEM_ID

111089210018
111090001345

 select distinct  
        201107  TIME_ID
        ,SCHOOL_ID
        ,SCHOOL_NAME
        ,case when value (city_id , substr(SCHOOL_ID,4,3))  = '891' then '13101'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '892' then '13102'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '893' then '13103'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '894' then '13104'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '895' then '13105'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '896' then '13106'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '897' then '13107'
                        end CMCC_BRANCH_ID
        ,a.school_address       
        ,char(cast( SCH_LONGITUDE as decimal(6,4))) SCH_LONGITUDE
        ,char(cast( SCH_LATITUDE  as decimal(6,4))) SCH_LATITUDE
        ,'' WEBSITE
        ,case 
                when school_type in ('4') then '1' 
                when school_type in ('5') then '2'      
                else '3' 
        end SCHOOL_LVL
        ,case 
                when school_level in ('1') then '1' 
                when school_level in ('2') then '3'     
                else '4' 
        end ADMIN_TYPE
        ,char(SCH_SIZE_STUS) STUD_CNT
        ,'0' NEWSTUD_CNT 
        ,char(sch_size_teas) STAFF_CNT
        ,'0' CMCC_RATE
from      bass2.Dim_xysc_maintenance_info a
with ur


select * from       G_I_02022_DAY where user_id = '89260000405763'


SELECT *
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%'


select * from   bass1.G_S_02024_DAY_1





select * from   G_I_02022_DAY where 
USER_ID in (
'89157332858179'
,'89160000878109'      
,'89160000878194'      
,'89160001253259'      
,'89257331538332'      
,'89260000405763'      
,'89360000802726'      
,'89360000860968'      
,'89557334274678'      
,'89601160020355'      
,'89601160028204'      
,'89601160037799'      
,'89657332233890'      
,'89660000814390'      
,'89757332891167'      
)
AND TIME_ID = 20110831


89257331538332      

select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89257331538332'
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'

111089210018
111090001344
select * from   bass1.G_S_02024_DAY where user_id = '89257331538332'



select 
        20110725 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_201105 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-11'
        and date(a.VALID_DATE)>= '2011-05-11'
        and date(a.expire_date) > '2011-05-11'
        and  user_id = '89257331538332'
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )

20110725	89257331538332	111090001344        	92000361            	20110511	20110901


        select time_id
                ,a.user_id
                , value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID),a.BASE_PKG_ID) BASE_PKG_ID
                , value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
                , a.REC_DT
                , a.VALID_DT
        from table(
select 
        20110725 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_201105 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-11'
        and date(a.VALID_DATE)>= '2011-05-11'
        and date(a.expire_date) > '2011-05-11'
        and  user_id = '89257331538332'
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )) a 
        left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102)
 ) b on a.CHANNEL_ID = char(b.organize_id )
        where a.base_pkg_id not in (SELECT 
                                distinct XZBAS_VALUE
                        FROM BASS1.ALL_DIM_LKP 
                        WHERE BASS1_TBID = 'BASS_STD1_0114'
        and BASS1_VALUE  not like '%QW%')
        with ur
        
        
select * from   bass1.G_S_02024_DAY where user_id = '89360000802726'

        
        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201107 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89360000802726'
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'

OFFER_ID	NAME
111089310017	全球通商旅套餐(山南)
111090001335	全球通商旅套餐88元

OFFER_INST_PROD_INST_ID	OFFER_INSTANCE_ID
100008568412	100008375135
100008568414	100008375137

        
        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89360000802726'
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'
OFFER_INST_PROD_INST_ID	OFFER_INSTANCE_ID
100008568412	100008375135
100008568414	100008375137


select 
        20110725 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201108 a 
        , bass2.dw_product_201108 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        --and date(a.CREATE_DATE) = '2011-05-11'
        --and date(a.VALID_DATE)>= '2011-05-11'
        --and date(a.expire_date) > '2011-05-11'
        and  user_id = '89360000802726'
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )

BASE_PKG_ID
111089310017        
111090001335        

SELECT *
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
        and xzbas_value in ('111089310017','111090001335')
and BASS1_VALUE  not like '%QW%'
SELECT *
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and bass1_value = 'QW_QQT_JC_SL888'

XZBAS_VALUE
111090001359        
111090001342        


select * from    G_I_02022_DAY where user_id = '89360000802726'


89160001253259

select * from    G_I_02022_DAY where user_id = '89160001253259'

select * from   bass1.G_S_02024_DAY where user_id = '89160001253259'

89160001253259

        
        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id='89160001253259'
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'




select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
and  (a.user_id,trim(BASE_PKG_ID)) not in (
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1
)



select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110731
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110731
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110731'
) a where rn = 1

select * from    G_I_02022_DAY where user_id IN 
(
 '89757332891167'      
,'89660000814390'      
,'89657332233890'      
,'89601160037799'      
,'89601160028204'      
,'89601160020355'      
,'89560000686699'      
,'89557334274678'      
,'89360000860968'      
,'89260000405763'      
,'89257331538332'      
,'89160000878194'      
,'89160000878109'      
,'89157332858179'      
)
AND TIME_ID = 20110731



select * from    G_I_02022_DAY where user_id IN ('89160001253259')

select * from    G_s_02024_DAY where user_id IN ('89160001253259')




select  a.user_id,BASE_PKG_ID from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
and  (a.user_id,BASE_PKG_ID) not in (
select distinct user_id,trim(BASE_PKG_ID) BASE_PKG_ID from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc ,base_pkg_id desc  )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1
)


89160001253259      	QW_QQT_JC_SL88
select * from  table(
SELECT '89160001253259' a ,'QW_QQT_JC_SL88' b from bass2.dual
) a
where (a,b) not in 
(select '89160001253259' a , 'QW_QQT_JC_SL58' b from bass2.dual
union all
select '89160001253259' a , 'QW_QQT_JC_SL88' b from bass2.dual
)


select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc ,base_pkg_id desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1



select * from G_S_02024_DAY where user_id in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)



        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'


select * from G_I_02022_DAY where user_id in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)
and time_id = 20110831



select 
        20110925 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110516 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-16'
        and date(a.VALID_DATE)>= '2011-05-16'
        and date(a.expire_date) >= '2011-05-16'
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )
        and 
PRODUCT_INSTANCE_ID in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'
) and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110901 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   




select * from bass2.dw_product_20110925 where user_id in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)




select * from G_I_02022_DAY where user_id in (
 '89157332858179' )
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)




select 
        20110901 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110901 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        --and date(a.CREATE_DATE) = '2011-06-01'
        and date(a.VALID_DATE)>= '2011-06-01'
        and date(a.expire_date) >= '2011-06-01'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110901 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )
AND PRODUCT_INSTANCE_ID =  '89157332858179'

select * from   bass2.Dw_product_ins_off_ins_prod_ds where 

        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in (
 '89157332858179'
,'89257331538332'
,'89360000860968'
,'89601160020355'
,'89601160037799'
,'89660000814390'
,'89757332891167'

)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'

100006937509	100006793885	89157332858179	171000000001	111089110017	181000000001	1	1	38213193	1	300052452931	2011-05-16 	2011-05-16 	2011-06-01 	2099-12-31 	100005816084	10100103	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89103000270517	[NULL]	0891	全球通商旅套餐(拉萨)
100006937511	100006793887	89157332858179	171000000001	111090001334	181000000001	1	1	38213195	1	300052452931	2011-05-16 	2011-05-16 	2011-06-01 	2030-01-01 	100005816084	10100103	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89103000270517	[NULL]	0891	全球通商旅套餐58元



select * from   bass2.dw_product_20110831 where user_id = '89157332858179'

select  * from g_i_02022_day 
where user_id
in 
('89160000878109'
,'89160000878194'
,'89260000405763'
,'89557334274678'
,'89601160028204'
,'89657332233890')
and time_id = 20110831


        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89160000878109'
,'89160000878194'
,'89260000405763'
,'89557334274678'
,'89601160028204'
,'89657332233890')
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'


        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89160000878109'
,'89160000878194'
)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'



select 
        20110505 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_20110505 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-05'
        and date(a.VALID_DATE)>= '2011-05-05'
        and date(a.expire_date) >= '2011-05-05'
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )
and product_instance_id 
in 
('89160000878109'
,'89160000878194'
)


select 
        20110505 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110505 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
       and product_instance_id 
in 
('89160000878109'
,'89160000878194'
) 


select * from    bass2.dw_product_20110505 
where 
user_id 
in 
('89160000878109'
,'89160000878194'
) 

select 
        20110505 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201108 a 
       where product_instance_id 
in 
('89160000878109'
,'89160000878194'
) 



select * from   G_S_02024_DAY_1

select 
        20110505 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_201105 a 
        , bass2.dw_product_20110505 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-05-05'
        and date(a.VALID_DATE)>= '2011-05-05'
        and date(a.expire_date) >= '2011-05-05'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110505 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )
 and product_instance_id 
in 
('89160000878109'
,'89160000878194'
) 

BASE_PKG_ID
111089110018        
111089110018        
111090001343        
111090001343        


select * from                    BASS1.ALL_DIM_LKP 
                WHERE BASS1_TBID = 'BASS_STD1_0114'
and xzbas_value in ('111089110018','111090001343')                


select * from   G_I_02022_DAY
where user_id in 
('89160000878109')

,'89160000878194'
) 






select * from   G_I_02022_DAY where 
USER_ID in (
'89157332858179'
,'89160000878109'      
,'89160000878194'      
,'89160001253259'      
,'89257331538332'      
,'89260000405763'      
,'89360000802726'      
,'89360000860968'      
,'89557334274678'      
,'89601160020355'      
,'89601160028204'      
,'89601160037799'      
,'89657332233890'      
,'89660000814390'      
,'89757332891167'      
)
AND TIME_ID = 20110831
and user_id in (select user_id from g_s_02024_day )






select distinct a.user_id,trim(BASE_PKG_ID),valid_dt from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID),valid_dt from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1


select a.user_id,a.valid_dt 
from (select distinct a.user_id,trim(BASE_PKG_ID) BASE_PKG_ID,valid_dt from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') ) a 
left join (
select distinct user_id,trim(BASE_PKG_ID) BASE_PKG_ID,valid_dt from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1
) b on a.user_id = b.user_id and a.BASE_PKG_ID = b.BASE_PKG_ID
where a.VALID_DT <> b.valid_dt

89160001135476      	20110801

select * from   G_I_02022_DAY where user_id = '89160001135476'
20110831	89160001135476      	QW_QQT_JC_SL88                	20110801

select * from   G_S_02024_DAY where user_id = '89160001135476'

20110722	89160001135476      	QW_QQT_JC_SL88                	91000847                                	20110722	20110722



        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201107 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89160001135476'
)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'

100008493052	100008302169	89160001135476	171000000001	111089110017	181000000001	1	1	45941051	1	300065244466	2011-07-22 	2011-08-31 	2011-07-22 	2011-08-31 	100005816514	91000847	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89160000952493	[NULL]	0891	全球通商旅套餐(拉萨)
100009245195	100009035068	89160001135476	171000000001	111090001335	181000000001	1	1	50270372	1	300065244466	2011-08-26 	2011-08-31 	2011-08-01 	2011-08-31 	10000475	11111111	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89160000952493	[NULL]	0891	全球通商旅套餐88元


100008493052	100008302169	89160001135476	171000000001	111089110017	181000000001	1	1	45941051	1	300060409379	2011-07-22 	2011-07-22 	2011-07-22 	2099-12-31 	100005816514	91000847	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89160000952493	[NULL]	0891	全球通商旅套餐(拉萨)
100008493054	100008302171	89160001135476	171000000001	111090001335	181000000001	1	1	45941053	1	300060409379	2011-07-22 	2011-07-22 	2011-07-22 	2030-01-01 	100005816514	91000847	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	89160000952493	[NULL]	0891	全球通商旅套餐88元



 select count(0) dup_cnt
        from (
                select user_id,count(0)  cnt
                from bass1.G_S_02024_DAY
                where time_id =20110925
                group by user_id having count(0) > 1
                ) t 
                
                
                89160001361929      
               

select 
        20110925 time_id
        ,a.PRODUCT_INSTANCE_ID USER_ID
        ,char(a.offer_id) BASE_PKG_ID
        ,char(a.ORG_ID) CHANNEL_ID
        ,replace(char(date(a.CREATE_DATE)),'-','') REC_DT
        ,replace(char(date(a.VALID_DATE) ),'-','') VALID_DT
from  bass2.Dw_product_ins_off_ins_prod_ds a 
        , bass2.dw_product_20110925 b 
where  a.state =1 
        and a.PRODUCT_INSTANCE_ID=b.user_id 
        and b.usertype_id in (1,2,9) 
        and b.userstatus_id in (1,2,3,6,8)
        and a.valid_type in (1,2)
        and date(a.CREATE_DATE) = '2011-09-25'
        and date(a.VALID_DATE)>= '2011-09-25'
        and date(a.expire_date) >= '2011-09-25'
        and not exists ( 
                         select 1 from bass2.dwd_product_test_phone_20110925 b 
                         where a.product_instance_id = b.USER_ID  and b.sts = 1
                        )   
        and char(a.offer_id) in (
                SELECT char(offer_id) FROM BASS2.dim_prod_up_offer 
                WHERE OFFER_TYPE='OFFER_PLAN'
                and TRADEMARK = 161000000001
        union 
                select char(xzbas_value)  as offer_id 
                from  BASS1.ALL_DIM_LKP 
                where BASS1_TBID = 'BASS_STD1_0114'
                and bass1_value like 'QW_QQT_JC%'
                and XZBAS_COLNAME not like '套餐减半%'
        )
and    PRODUCT_INSTANCE_ID = '89160001361929'            




        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_ds a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in (
 '89160001361929'

)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'

 and date(a.CREATE_DATE) = '2011-09-25'
 
 
 
 

select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (11)
and type = 'd'






select * from   G_I_02022_DAY where 
USER_ID in (
'89157332858179'
,'89160000878109'      
,'89160000878194'      
,'89160001253259'      
,'89257331538332'      
,'89260000405763'      
,'89360000802726'      
,'89360000860968'      
,'89557334274678'      
,'89601160020355'      
,'89601160028204'      
,'89601160037799'      
,'89657332233890'      
,'89660000814390'      
,'89757332891167'      
)
AND TIME_ID = 20110831

select * from   g_s_02024_day where user_id = '89160001253259'

select * from   

select * from   g_i_02022_day where user_id = '89360000802726'


                select user_id,count(0)  cnt
                from bass1.G_S_02024_DAY
                where time_id =20110926
                group by user_id having count(0) > 1
                
                89660001363751      
                
                
        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_ds a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89660001363751'
)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'


select * from   g_s_02024_day where    user_id = '89660001363751'
             
             

delete from G_S_02024_DAY where time_id = 20110824 
and user_id = '89160001253259'
and base_pkg_id = 'QW_QQT_JC_SL58'
             




select * from g_s_02024_day 
where user_id in 
(
 '89157332858179'
,'89160000878109'
,'89160000878194'
,'89257331538332'
,'89260000405763'
,'89360000860968'
,'89557334274678'
,'89601160020355'
,'89601160028204'
,'89601160037799'
,'89657332233890'
,'89660000814390'
,'89757332891167'
)



select * from g_i_02022_day 
where user_id in 
(
 '89157332858179'
,'89160000878109'
,'89160000878194'
,'89257331538332'
,'89260000405763'
,'89360000860968'
,'89557334274678'
,'89601160020355'
,'89601160028204'
,'89601160037799'
,'89657332233890'
,'89660000814390'
,'89757332891167'
)
and time_id = 20110831


insert into g_s_02024_day
select 
20110517 time_id 
,a.USER_ID
,BASE_PKG_ID
,b.CHANNEL_ID CHANNEL_ID
,case when a.VALID_DT > '20110517' then '20110517' else a.VALID_DT end  REC_DT
,a.VALID_DT
 from g_i_02022_day a
 left join g_a_02004_02008_stage b on a.USER_ID = b.USER_ID
where a.user_id in 
(
 '89157332858179'
,'89160000878109'
,'89160000878194'
,'89257331538332'
,'89260000405763'
,'89360000860968'
,'89557334274678'
,'89601160020355'
,'89601160028204'
,'89601160037799'
,'89657332233890'
,'89660000814390'
,'89757332891167'
)
and a.time_id = 20110831


select * from   g_a_02004_02008_stage
where  user_id in 
(
 '89157332858179'
,'89160000878109'
,'89160000878194'
,'89257331538332'
,'89260000405763'
,'89360000860968'
,'89557334274678'
,'89601160020355'
,'89601160028204'
,'89601160037799'
,'89657332233890'
,'89660000814390'
,'89757332891167'
)

insert into g_s_02024_day 
select 20110801 time_id
        ,'89360000802726' USER_ID
        ,'QW_QQT_JC_SL88' BASE_PKG_ID
        ,'30300107' CHANNEL_ID
        ,'20110801' REC_DT
        ,'20110801' VALID_DT
from bass2.dual

89360000802726
        
        
        select * from   g_a_02004_02008_stage where user_id = '89360000802726'
        
        
        select * from g_i_02022_day 
where user_id in ('89360000802726')


        select * from g_s_02024_day 
where user_id in ('89360000802726')



select distinct a.user_id,trim(BASE_PKG_ID) from  G_I_02022_DAY a,bass1.g_a_02004_02008_stage  b 
where 
 a.time_id = 20110831
and a.user_id = b.user_id 
and TEST_FLAG = '0'
and SIM_CODE <> '3'
and USERTYPE_ID not in  ('2010','2020','2030','2040','9000') 
except 
select distinct user_id,trim(BASE_PKG_ID) from 
(
select a.* , row_number()over(partition by user_id order by time_id desc ,valid_dt desc   )  rn 
from G_S_02024_DAY a 
where base_pkg_id like 'QW_QQT%'
and time_id <= 20110831
--and REC_DT <= '20110930'
and time_id >= 20110517
and valid_dt <= '20110831'
) a where rn = 1






insert into g_s_02024_day
select 
20110517 time_id 
,a.USER_ID
,BASE_PKG_ID
,b.CHANNEL_ID CHANNEL_ID
,case when a.VALID_DT > '20110517' then '20110517' else a.VALID_DT end  REC_DT
,a.VALID_DT
 from g_i_02022_day a
 left join g_a_02004_02008_stage b on a.USER_ID = b.USER_ID
where a.user_id in 
(
 '89157332858179'
,'89160000878109'
,'89160000878194'
,'89257331538332'
,'89260000405763'
,'89360000860968'
,'89557334274678'
,'89601160020355'
,'89601160028204'
,'89601160037799'
,'89657332233890'
,'89660000814390'
,'89757332891167'
)
and a.time_id = 20110831



select  substr(filename,18,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1



select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b where 
 type = 'd'
 and sts = 1
and  interface_code not in (
 select  substr(filename,18,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1
)



update app.g_runlog 
set return_flag = 0
where time_id in ( 20110517,20110801,20110824)
and return_flag=1
and unit_code = '02024'

select count(0) from    g_s_02024_day where time_id = 20110824



select * from   G_A_02028_DAY

select * from   app.sch_control_before
where control_code like 'BASS1%'


select count(0) from    bass2.dw_res_sel_num_cust_log_ds
select count(0),count(distinct ROW_ID ) from     bass2.dw_res_sel_num_cust_log_ds


select * from   bass2.dw_res_sel_num_cust_log_ds
where OPT_CODE is not null
and OPT_NAME like '%预占%'


select OPT_CODE,OPT_NAME,count(0) from   bass2.dw_res_sel_num_cust_log_ds
where OPT_CODE is not null
and OPT_NAME like '%预占%'
group by OPT_CODE,OPT_NAME



select * from   bass2.dw_res_sel_num_cust_log_ds
where OPT_CODE  = 'ZDYZ'
and bill_id =  '13659545256'
order by hold_date desc 



select * from   bass2.dw_product_20110926 where product_no = '13659545256'


and OPT_NAME like '%预占%'

select * from    bass1.G_S_02066_DAY


select 
        20110926 time_id
        ,b.user_id USER_ID
        ,'BASS1_ST' CHANNEL_ID
        ,'1' FETCH_WAY
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date) = '2011-09-26'
        with ur
        
                 and replace(char(date(a.create_date)),'-','') <= replace(char(a.create_date),'-','')




select 
        20110926 time_id
        ,b.user_id USER_ID
        ,'BASS1_ST' CHANNEL_ID
        ,'1' FETCH_WAY
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date) = '2011-08-31'
         and date(a.create_date) <= date(b.create_date)
        with ur


select 
        20110926 time_id
        ,b.user_id USER_ID
        ,'BASS1_ST' CHANNEL_ID
        ,'1' FETCH_WAY
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date) <= date(b.create_date)
         and date(b.create_date) = '2011-09-26'
        with ur
        
        
        select * from   G_S_02066_DAY
        
        select * from   G_S_02066_DAY
        
        G_S_02066_DAY
        
        delete from bass1.G_S_02066_DAY where time_id <= 20111001
        
        
        
        select 
        20110926 time_id
        ,t.user_id USER_ID
        ,'BASS1_ST' CHANNEL_ID
        ,'1' FETCH_WAY
from ( select b.user_id , row_number()over(partition by b.user_id order by a.create_date desc )  rn 
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date) <= date(b.create_date)
         and date(b.create_date) = '2011-09-26'
) t where rn = 1         
        with ur
        
        
        
        select *
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date + 5 days ) >= date(b.create_date)
         and date(b.create_date) = '2011-09-26'
         and b.user_id = '89160001363856'
         
         

        
        
        select *
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date + 5 days ) >= date(b.create_date)
         and date(b.create_date) = '2011-09-26'
         
                 select count(0)
from  bass2.dw_res_sel_num_cust_log_ds a 
        ,bass2.dw_product_20110926 b 
where   a.BILL_ID = b.product_no 
         and b.userstatus_id in (1,2,3,6,8)
         and b.usertype_id in (1,2,9)
         and a.opt_code in ('ZDYZ')
         and date(a.create_date ) <= date(b.create_date)
         
        
select * from   bass2.dim_channel_info

select count(0)     
	from bass2.dim_channel_info a
	left join bass2.dim_pub_county b on a.county_code=b.county_id
	left join bass2.dim_thorpe c on a.thorpe_code=c.thorpe_code
 where a.channel_type_class in (90105,90102)
        
        


CREATE TABLE G_A_06035_DAY_1 (
       CHANNEL_ID             CHAR(40)            ----实体渠道标识:主键 
        ,CHANNEL_TYPE           CHAR(1)             ----实体渠道类型:不允许为空 
        ,SELF_24_IND            CHAR(25)            ----24小时自助营业厅合建营业厅渠道标识:对于实体渠道类型为1、2、3的记录该字段填空，对于4，如是独立设置，该项填空，否则填合建营业厅的渠道标识。 
        ,CMCC_ID                CHAR(5)             ----所属CMCC运营公司标识:不允许为空 
        ,COUNTY                 CHAR(30)            ----区县名称:不允许为空 
        ,REGION                 CHAR(50)            ----乡镇/片区名称:不允许为空 
        ,CHANNEL_NAME           CHAR(100)           ----渠道名称:不允许为空 
        ,CHANNEL_ADDR           CHAR(100)           ----渠道地址:不允许为空 
        ,CHNL_MANAGER_NAME      CHAR(40)            ----渠道经理姓名:不允许为空 
        ,CHNL_MANAGER_PHONE     CHAR(40)            ----渠道经理联系电话:不允许为空 
        ,GEO_ID                 CHAR(1)             ----地理位置类型:不允许为空 
        ,AREA_TYPE              CHAR(1)             ----区域形态:不允许为空 
        ,CHANNEL_BASE_TYPE      CHAR(1)             ----渠道基础类型:不允许为空 
        ,IF_EX                  CHAR(1)             ----是否排他:不允许为空 
        ,IF_MOB_SALEHALL        CHAR(1)             ----是否为手机卖场:不允许为空 
        ,CHNL_STAR              CHAR(1)             ----渠道星级:       
        ,CHNL_STATE             CHAR(1)             ----渠道状态:不允许为空 
        ,OPEN_TIME              CHAR(4)             ----营业起始时间:不允许为空 
        ,CLOSE_TIME             CHAR(4)             ----营业结束时间:不允许为空 
        ,CONTRACT_EFF_DT        CHAR(8)             ----协议签署生效日期:不允许为空 
        ,CONTRACT_END_DT        CHAR(8)             ----协议截止日期:不允许为空 
        ,CO_OP_DUR              CHAR(4)             ----已合作年限:     
        ,LONGTITUDE             CHAR(10)            ----经度:考虑到小数点位，接口中该字段长度为10； 
        ,LATITUDE               CHAR(10)            ----纬度:考虑到小数点位，接口中该字段长度为10； 
        ,ZX_INVEST_FEE          CHAR(10)            ----装修累计投资总额: 
        ,SB_INVEST_FEE          CHAR(10)            ----设备累计投资总额: 
        ,OFFICE_INVEST_FEE      CHAR(10)            ----办公和营业家具累计投资总额: 
        ,SUBSIDY_FEE            CHAR(10)            ----一次性门头补贴: 
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( CHANNEL_ID ) USING HASHING;

        

select count(0) from   G_A_06035_DAY_1
        

	
	SELECT  
	a.*
	from bass1.G_A_06035_DAY_1 a
	except 
	select 
	CHANNEL_ID
        ,CHANNEL_TYPE
        ,SELF_24_IND
        ,CMCC_ID
        ,COUNTY
        ,REGION
        ,CHANNEL_NAME
        ,CHANNEL_ADDR
        ,CHNL_MANAGER_NAME
        ,CHNL_MANAGER_PHONE
        ,GEO_ID
        ,AREA_TYPE
        ,CHANNEL_BASE_TYPE
        ,IF_EX
        ,IF_MOB_SALEHALL
        ,CHNL_STAR
        ,CHNL_STATE
        ,OPEN_TIME
        ,CLOSE_TIME
        ,CONTRACT_EFF_DT
        ,CONTRACT_END_DT
        ,CO_OP_DUR
        ,LONGTITUDE
        ,LATITUDE
        ,ZX_INVEST_FEE
        ,SB_INVEST_FEE
        ,OFFICE_INVEST_FEE
        ,SUBSIDY_FEE
	from 
	( select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
	from G_A_06035_DAY a 
	) o where o.rn = 1 
 with ur
        
        

select * from    BASS1.G_A_06035_DAY
        
        

select 20110926 time_id 
,t.* from table(
        SELECT  
        a.*
        from bass1.G_A_06035_DAY_1 a
        except 
        select 
        CHANNEL_ID
        ,CHANNEL_TYPE
        ,SELF_24_IND
        ,CMCC_ID
        ,COUNTY
        ,REGION
        ,CHANNEL_NAME
        ,CHANNEL_ADDR
        ,CHNL_MANAGER_NAME
        ,CHNL_MANAGER_PHONE
        ,GEO_ID
        ,AREA_TYPE
        ,CHANNEL_BASE_TYPE
        ,IF_EX
        ,IF_MOB_SALEHALL
        ,CHNL_STAR
        ,CHNL_STATE
        ,OPEN_TIME
        ,CLOSE_TIME
        ,CONTRACT_EFF_DT
        ,CONTRACT_END_DT
        ,CO_OP_DUR
        ,LONGTITUDE
        ,LATITUDE
        ,ZX_INVEST_FEE
        ,SB_INVEST_FEE
        ,OFFICE_INVEST_FEE
        ,SUBSIDY_FEE
        from 
        ( select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
        from G_A_06035_DAY a 
        ) o where o.rn = 1 
) t
 with ur
        
        


select *
from 
(			
select channel_id
,LONGTITUDE
,LATITUDE
,row_number()over(partition by channel_id order by time_id desc ) rn 
from g_a_06035_day 
)  t where rn = 1

        

select count(0) from   BASS1.G_A_06035_DAY



CREATE TABLE "BASS1   "."G_A_06036_DAY_1"  (
                  
                  "CHANNEL_ID" CHAR(40) , 
                  "PROPERTY_TYPE" CHAR(1) , 
                  "BUY_MONTH" CHAR(6) , 
                  "PROPERTY_NO" CHAR(50) , 
                  "LAND_NO" CHAR(50) , 
                  "IC_NO" CHAR(50) , 
                  "BUY_PRICE" CHAR(10) , 
                  "RENT_START_DT" CHAR(8) , 
                  "RENT_END_DT" CHAR(8) , 
                  "AVG_REPRISE" CHAR(8) )   
                 DISTRIBUTE BY HASH("CHANNEL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select 
	 CHANNEL_ID
        ,PROPERTY_TYPE
        ,BUY_MONTH
        ,PROPERTY_NO
        ,LAND_NO
        ,IC_NO
        ,BUY_PRICE
        ,RENT_START_DT
        ,RENT_END_DT
        ,AVG_REPRISE
from  (
select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
from G_A_06036_DAY a 
) o where o.rn = 1 
        
select * from   BASS1.G_A_06036_DAY
        
        


CREATE TABLE "BASS1   "."G_A_06037_DAY_1"  (
                  "CHANNEL_ID" CHAR(40) , 
                  "BUILD_AREA" CHAR(5) , 
                  "USE_AREA" CHAR(5) , 
                  "BUSI_AREA" CHAR(5) , 
                  "COUNTER_CNT" CHAR(3) , 
                  "STAFF_CNT" CHAR(3) , 
                  "SECURE_CNT" CHAR(3) , 
                  "CLEANER_CNT" CHAR(3) , 
                  "WAITING_MACHINE" CHAR(1) , 
                  "POS_MACHINE" CHAR(1) , 
                  "VIP_SERVANT" CHAR(1) , 
                  "IF_VIP_SCHOOL" CHAR(1) , 
                  "PRINTER_CNT" CHAR(3) , 
                  "SELFTERM_CNT" CHAR(3) , 
                  "G3_AREA" CHAR(5) , 
                  "SCREEN_CNT" CHAR(3) , 
                  "EXP_PLAT_TERM_CNT" CHAR(3) , 
                  "XINJI_TERM_CNT" CHAR(3) , 
                  "WEB_TERM_CNT" CHAR(3) , 
                  "HALL_AREA" CHAR(5) , 
                  "CMCC_BUSI_AREA" CHAR(5) , 
                  "ACCESS_WAY" CHAR(1) , 
                  "IF_KONGCONG" CHAR(1) )   
                 DISTRIBUTE BY HASH("CHANNEL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select count(0) from    G_A_06037_DAY

-- 日 
select bigint(time_id)/100 ,count(0),count(distinct unit_code ) from   app.g_runlog
where return_flag = 1
and bigint(time_id)/100 between 201101 and 201108 
and length(trim(char(time_id))) = 8
group by  bigint(time_id)/100
        


select bigint(time_id) ,count(0),count(distinct unit_code ) from   app.g_runlog
where return_flag = 1
and bigint(time_id) between 201101 and 201108 
and length(trim(char(time_id))) = 6
group by  bigint(time_id)
        
        
select * from   BASS1.ALL_DIM_LKP 
飞信业务功能费
无线音乐业务功能费
139邮箱功能费
手机游戏功能费
无线音乐业务信息费
手机报信息费
12580信息费
139邮箱信息费
手机阅读信息费
手机游戏信息费
手机视频信息费


select * from   bass2.dim_acct_item
where item_name like '%信息%彩铃%'        
80000470	优惠飞信


select *
 from bass2.dw_acct_shoulditem_201108
 where ITEM_ID = 80000470 
 89101110014017
 select *
 from bass2.dw_acct_shoulditem_201108
 where ITEM_ID = 80000601 
 
 
 select * from   BASS1.ALL_DIM_LKP 
 where BASS1_TBN_DESC = '帐目科目'
 
 update BASS1.ALL_DIM_LKP 
 set bass1_tbid = 'BASS_STD1_0074'
 where bass1_tbid = 'BASS_STD1_0117'
 and  BASS1_TBN_DESC = '帐目科目'
 
 
  select * from   BASS1.ALL_DIM_LKP 
   where bass1_tbid = 'BASS_STD1_0117'

insert into BASS1.ALL_DIM_LKP 
values
 ('dim_acct_item','139邮箱包月费','80000762','重点自有业务帐目科目','BASS_STD1_0117','0530','139邮箱功能费')
,('dim_acct_item','手机游戏按条费','80000654','重点自有业务帐目科目','BASS_STD1_0117','0649','手机游戏信息费')
,('dim_acct_item','手机游戏包月费','80000653','重点自有业务帐目科目','BASS_STD1_0117','0649','手机游戏信息费')
,('dim_acct_item','手机视频按条费','80000204','重点自有业务帐目科目','BASS_STD1_0117','0650','手机视频信息费')
,('dim_acct_item','手机视频包月费','80000203','重点自有业务帐目科目','BASS_STD1_0117','0650','手机视频信息费')
,('dim_acct_item','5元手机阅读新书速递专区','80000683','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','5元手机阅读新书速递专区','80000682','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','5元手机阅读玄幻仙侠专区','80000678','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','5元手机阅读玄幻仙侠专区','80000679','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读3元包月费','80000581','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读5元包月费','80000584','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读按条费','80000652','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读包月费','80000651','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读历史军事包月费','80000779','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读全球通阅读包包月费','80000701','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','手机阅读时尚女频包月费','80000781','重点自有业务帐目科目','BASS_STD1_0117','0648','手机阅读信息费')
,('dim_acct_item','139邮箱彩信收取邮件信息费','80000523','重点自有业务帐目科目','BASS_STD1_0117','0647','139邮箱信息费')
,('dim_acct_item','139邮箱彩信珍藏通信费','80000525','重点自有业务帐目科目','BASS_STD1_0117','0647','139邮箱信息费')
,('dim_acct_item','139邮箱自写彩信信息费','80000524','重点自有业务帐目科目','BASS_STD1_0117','0647','139邮箱信息费')
,('dim_acct_item','12580福彩封顶','80000458','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报-爱家居包月费','80000775','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报-爱健康包月费','80000708','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报包月费','80000724','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报财富经功能费','80000695','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报女人志包月费','80000728','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580生活播报优旅行包月费','80000726','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580体彩封顶','80000457','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','12580信息费','80000427','重点自有业务帐目科目','BASS_STD1_0117','0646','12580信息费')
,('dim_acct_item','奥运手机报包月费','80000205','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','奥运手机报包月费(优惠80000205)','80000423','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','彩信版手机报-芭莎时尚包月费','80000521','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','彩信版手机报-芭莎时尚包月费(收取后优惠彩信版芭莎时尚包月费)','80000522','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','彩信版手机报-青年文摘包月费','80000510','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','彩信版手机报-青年文摘包月费(收取后优惠彩信版青年文摘包月费)','80000511','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','短信版新华新闻手机报包月(收取后优惠短信版新华新闻手机报包月费)','80000196','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','短信版新华新闻手机报包月费','80000195','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','全球通凤凰周刊手机报包月费','80000764','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报全球通凤凰时事周刊包月费','80000586','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报全球通凤凰时事周刊包月费(活动)','80000587','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报生活与健康包月费','80000596','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报生活与健康包月费(活动)','80000597','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报体育新闻包月费','80000436','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','手机报体育新闻包月费(活动)','80000583','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','移动新华体育手机报包月费','80000600','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','移动新华体育手机报包月费(活动)','80000601','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','优惠手机报','80000468','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','中国青年手机报包月费','80000576','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','中国青年手机报包月费(活动)','80000577','重点自有业务帐目科目','BASS_STD1_0117','0645','手机报信息费')
,('dim_acct_item','5元全曲在线包月费(活动用)','80000604','重点自有业务帐目科目','BASS_STD1_0117','0644','无线音乐业务信息费')
,('dim_acct_item','5元全曲在线包月费','80000605','重点自有业务帐目科目','BASS_STD1_0118','0645','无线音乐业务信息费')
,('dim_acct_item','彩铃铃音信息费(活动)','80000578','重点自有业务帐目科目','BASS_STD1_0119','0646','无线音乐业务信息费')
,('dim_acct_item','多媒体彩铃信息费','80000454','重点自有业务帐目科目','BASS_STD1_0120','0647','无线音乐业务信息费')
,('dim_acct_item','彩铃铃音信息费','80000005','重点自有业务帐目科目','BASS_STD1_0121','0648','无线音乐业务信息费')
,('dim_acct_item','无线音乐俱乐部包月(活动用-收取后优惠无线音乐俱乐部包月费)','80000425','重点自有业务帐目科目','BASS_STD1_0117','0644','无线音乐业务信息费')
,('dim_acct_item','优惠无线音乐俱乐部','80000467','重点自有业务帐目科目','BASS_STD1_0117','0644','无线音乐业务信息费')
,('dim_acct_item','无线音乐俱乐部包月费','80000137','重点自有业务帐目科目','BASS_STD1_0117','0644','无线音乐业务信息费')
,('dim_acct_item','手机游戏月功能费(活动)','80000557','重点自有业务帐目科目','BASS_STD1_0117','0531','手机游戏功能费')
,('dim_acct_item','手机游戏月功能费','80000558','重点自有业务帐目科目','BASS_STD1_0117','0531','手机游戏功能费')
,('dim_acct_item','飞信POPO包月费','80000181','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信QQ包月费','80000176','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信会员月功能费','80000495','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信交友包月费(活动用-收取后优惠飞信交友梦网包月费)','80000424','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信交友梦网包月费','80000165','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信泡泡月功能费','80000688','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信泡泡月功能费','80000687','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信位置功能费','80000689','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','飞信位置业务月功能费','80000505','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','优惠飞信','80000470','重点自有业务帐目科目','BASS_STD1_0117','0528','飞信业务功能费')
,('dim_acct_item','无线音乐精彩推荐包月费','80000706','重点自有业务帐目科目','BASS_STD1_0117','0529','无线音乐业务功能费')
,('dim_acct_item','无线音乐精彩推荐功能费','80000705','重点自有业务帐目科目','BASS_STD1_0117','0529','无线音乐业务功能费')
,('dim_acct_item','无线音乐俱乐部包月(活动用-收取后优惠无线音乐俱乐部包月费)','80000425','重点自有业务帐目科目','BASS_STD1_0117','0529','无线音乐业务功能费')
,('dim_acct_item','无线音乐俱乐部包月费','80000137','重点自有业务帐目科目','BASS_STD1_0117','0529','无线音乐业务功能费')
,('dim_acct_item','优惠无线音乐俱乐部','80000467','重点自有业务帐目科目','BASS_STD1_0117','0529','无线音乐业务功能费')
;


bass1.G_S_03019_MONTH

select * from   bass1.G_S_03019_MONTH


select count(0) from    bass2.dw_channel_info_201108 a
, bass2.DIM_BOSS_STAFF b
where a.channel_type_class=90105 and a.channel_type in (90196,90153,90154,90155,90156,90157,90158,90940,90941,90942,90943) 
and a.channel_id = b.ORG_ID


select * from   bass2.DIM_BOSS_STAFF

select * from   app.sch_control_task where control_code like '%03019%'


select b.org_id, count(0) from    bass2.dw_channel_info_201108 a
, bass2.DIM_BOSS_STAFF b
where a.channel_type_class=90105 and a.channel_type in (90196,90153,90154,90155,90156,90157,90158,90940,90941,90942,90943) 
and a.channel_id = b.ORG_ID
group by b.ORG_ID

select 
char(b.OP_ID)
,char(b.org_id)
,b.OP_NAME
,case when date(b.EXPIRE_DATE) > '2011-08-31' then '1' else  '2' end
 from    bass2.dw_channel_info_201108 a
, bass2.DIM_BOSS_STAFF b
where a.channel_type_class=90105 and a.channel_type in (90196,90153,90154,90155,90156,90157,90158,90940,90941,90942,90943) 
and a.channel_id = b.ORG_ID
STATE	2
0	1605
1	4207
[NULL]	1


select STATE,count(0) from    bass2.ods_dim_sys_operator_20110927
group by STATE

select * from    bass2.ods_dim_sys_operator_20110927 where STATE = 0


select * from   
 BASS1.G_I_06034_MONTH
 
 select * from   BASS1.G_I_06034_MONTH
 
 
                    
select * from   bass2.dim_prod_up_product_item
where name like '%农情气象%'
 
 
       

select 
 bass2.dw_product_ins_off_ins_prod_201108
 
 农信通业务分类：
1-百事易
2-百事易体验版
3-务工易
4-务工易体验版
5-务工易点播
6-农情气象
7-农情气象体验版
8-农信宝种植版
9-农信宝养殖版
10-农信宝综合版
11-其他

 
 select name,offer_id,SUPPLIER_ID,EXTEND_ID2,count(0) from bass2.dw_product_ins_off_ins_prod_201107 a, bass2.dim_prod_up_product_item  b
where a.OFFER_ID = b.PRODUCT_ITEM_ID
AND (
B.NAME LIKE '%百事易%'
or B.NAME LIKE '%务工易%'
or B.NAME LIKE '%农情气象%'
or B.NAME LIKE '%农信宝%'
)
group by  name,offer_id,SUPPLIER_ID,EXTEND_ID2

select distinct *  from 
(
select '400000' a , '110301'     b from bass2.dual
select '400089' a , '72260967' b from bass2.dual
select '801084' a , '72260967' b from bass2.dual
select '400089' a , '72260972' b from bass2.dual
select '801084' a , '72260972' b from bass2.dual
select '801084' a , '72260976' b from bass2.dual
select '400089' a , '72260976' b from bass2.dual
select '800089' a , '9915598450' b from bass2.dual
select '901317' a , 'JT40028516' b from bass2.dual
select '901317' a , 'JT65941239' b from bass2.dual
select '901317' a , 'JT67060734' b from bass2.dual
select '901317' a , 'JT82436811' from bass2.dual ) a 



create view t_v_22074
as 
 select product_instance_id , name,offer_id,SUPPLIER_ID,EXTEND_ID2
,case 
when offer_id = 113200000081 then '1'
when offer_id = 113200000071 then '3'
when offer_id in( 113110217758,113110148956) then '8'
when offer_id in( 113110217757,113110148669) then '9'
when offer_id in( 113110148955,113110217759) then '10'
else '11'
end NXT_TYPE
,case when char(a.create_date) like '2011-08%' then 1 else 0 end new_flag
 from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where a.OFFER_ID = b.PRODUCT_ITEM_ID
AND (
B.NAME LIKE '%百事易%'
or B.NAME LIKE '%务工易%'
or B.NAME LIKE '%农情气象%'
or B.NAME LIKE '%农信宝%'
)


89457333630051	12582农信通务工易	113200000071	901317	JT82436811	3	0
89457333906473	12582农信通百事易	113200000081	901317	JT40028516	1	0

select * from   G_S_04005_DAY 
where SP_CODE = '901317'
and OPER_CODE = 'JT82436811'


                   from 
                     bass2.cdr_ismg_dtl_$timestamp 
                   where (drtype_id<>61102 and process_time is not null and substr(sp_code,1,12) is not null
				and svcitem_id in (300001,300002,300003,300004)
			  ) 
			 or substr(ser_code,1,5) in ('12590') 		
             
select count(0)    
  from  
bass2.cdr_mms_20110831
where SP_CODE = '901317'
and OPER_CODE = 'JT82436811'

                           
                           
  table        
(
select '400000' a , '110301'     b from bass2.dual union all
select '400089' a , '72260967' b from bass2.dual union all
select '801084' a , '72260967' b from bass2.dual union all
select '400089' a , '72260972' b from bass2.dual union all
select '801084' a , '72260972' b from bass2.dual union all
select '801084' a , '72260976' b from bass2.dual union all
select '400089' a , '72260976' b from bass2.dual union all
select '800089' a , '9915598450' b from bass2.dual union all
select '901317' a , 'JT40028516' b from bass2.dual union all
select '901317' a , 'JT65941239' b from bass2.dual union all
select '901317' a , 'JT67060734' b from bass2.dual union all
select '901317' a , 'JT82436811' from bass2.dual  ) a 



select count(0)    
  from  
bass2.cdr_mms_20110831 a,  table        
(
select '400000' a , '110301'     b from bass2.dual union all
select '400089' a , '72260967' b from bass2.dual union all
select '801084' a , '72260967' b from bass2.dual union all
select '400089' a , '72260972' b from bass2.dual union all
select '801084' a , '72260972' b from bass2.dual union all
select '801084' a , '72260976' b from bass2.dual union all
select '400089' a , '72260976' b from bass2.dual union all
select '800089' a , '9915598450' b from bass2.dual union all
select '901317' a , 'JT40028516' b from bass2.dual union all
select '901317' a , 'JT65941239' b from bass2.dual union all
select '901317' a , 'JT67060734' b from bass2.dual union all
select '901317' a , 'JT82436811' b from bass2.dual  ) b
where SP_CODE = b.a
and OPER_CODE = b.b


select *
  from  
bass2.cdr_mms_20110831 a,  table        
(
select '400000' a , '110301'     b from bass2.dual union all
select '400089' a , '72260967' b from bass2.dual union all
select '801084' a , '72260967' b from bass2.dual union all
select '400089' a , '72260972' b from bass2.dual union all
select '801084' a , '72260972' b from bass2.dual union all
select '801084' a , '72260976' b from bass2.dual union all
select '400089' a , '72260976' b from bass2.dual union all
select '800089' a , '9915598450' b from bass2.dual union all
select '901317' a , 'JT40028516' b from bass2.dual union all
select '901317' a , 'JT65941239' b from bass2.dual union all
select '901317' a , 'JT67060734' b from bass2.dual union all
select '901317' a , 'JT82436811' b from bass2.dual  ) b
where SP_CODE = b.a
and OPER_CODE = b.b
and  send_status in (0,1,2,3) and send_mmsc_id is not null

select count(0) from    bass2.cdr_mms_20110801



select *
  from  g_s_04004_day a,  table        
(
select '400000' a , '110301'     b from bass2.dual union all
select '400089' a , '72260967' b from bass2.dual union all
select '801084' a , '72260967' b from bass2.dual union all
select '400089' a , '72260972' b from bass2.dual union all
select '801084' a , '72260972' b from bass2.dual union all
select '801084' a , '72260976' b from bass2.dual union all
select '400089' a , '72260976' b from bass2.dual union all
select '800089' a , '9915598450' b from bass2.dual union all
select '901317' a , 'JT40028516' b from bass2.dual union all
select '901317' a , 'JT65941239' b from bass2.dual union all
select '901317' a , 'JT67060734' b from bass2.dual union all
select '901317' a , 'JT82436811' b from bass2.dual  ) b
where SP_ENT_CODE = b.a
and SVC_CODE = b.b
and time_id between 20110801 and 20110831



select * from    bass1.G_S_03019_MONTH
select count(0) from     bass2.dw_acct_shoulditem_201108


                        select
                          201108
                          ,a.user_id
                          ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0117',char(a.item_id)),'0901')
                          ,'201108'
                          ,char(bigint(sum(a.fact_fee)*100))
                          ,substr(char(bigint(sum(case when a.fav_fee >0 then a.fav_fee else 0 end)*-100)),1,8) 
                        from   bass2.dw_acct_shoulditem_201108 a
                        inner join 
                                (
                                 select user_id from bass2.dw_product_201108 where userstatus_id<>0 and usertype_id in (1,2,9)
                                 except
                                 select user_id from bass2.dw_product_201107 where userstatus_id in (0,4,5,7,9)
                                 ) b on a.user_id=b.user_id
                        where
                         char( a.item_id ) in (select bass1_value from BASS1.ALL_DIM_LKP   where  bass1_tbid = 'BASS_STD1_0117')
                        group by
                          a.user_id                       
                          ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0117',char(a.item_id)),'0901') 
                          with ur

select count(0)     
from   bass2.dw_acct_shoulditem_201108 a
                        inner join 
                                (
                                 select user_id from bass2.dw_product_201108 where userstatus_id<>0 and usertype_id in (1,2,9)
                                 except
                                 select user_id from bass2.dw_product_201107 where userstatus_id in (0,4,5,7,9)
                                 ) b on a.user_id=b.user_id
                        where
                         char( a.item_id ) in (select XZBAS_VALUE from BASS1.ALL_DIM_LKP   where  bass1_tbid = 'BASS_STD1_0117')
                         
                         
                         
                        inner join 
                                (
                                 select user_id from bass2.dw_product_201108 
                                 where userstatus_id<>0 and usertype_id in (1,2,9)
                                 except
                                 select user_id from bass2.dw_product_201107 where userstatus_id in (0,4,5,7,9)
                                 ) b on a.user_id=b.user_id
                        where
select count(0)     
from   bass2.dw_acct_shoulditem_201108 a
where 
       a.item_id  in (select bigint(XZBAS_VALUE) from BASS1.ALL_DIM_LKP   where  bass1_tbid = 'BASS_STD1_0117')
                      
                         
                         select count(0),count(distinct XZBAS_VALUE) from BASS1.ALL_DIM_LKP   where  bass1_tbid = 'BASS_STD1_0117'
                         
select XZBAS_VALUE,count(0)
from BASS1.ALL_DIM_LKP   where  bass1_tbid = 'BASS_STD1_0117'
group by    XZBAS_VALUE
having count(0) > 1
                      
                         

XZBAS_VALUE
80000137
80000425
80000467


select * from   BASS1.ALL_DIM_LKP 
where   XZBAS_VALUE in ('80000137','80000425','80000467')                       
and bass1_tbid = 'BASS_STD1_0117'

delete from  BASS1.ALL_DIM_LKP 
where bass1_value_desc = '无线音乐业务信息费'
and  XZBAS_VALUE in ('80000137','80000425','80000467')      



CREATE TABLE "BASS1   "."G_S_22074_MONTH_1"  (
        PRODUCT_INSTANCE_ID     VARCHAR(20)         
        ,NAME                    VARCHAR(200)        
        ,OFFER_ID                BIGINT      
        ,SUPPLIER_ID             VARCHAR(20)         
        ,EXTEND_ID2              VARCHAR(20)         
        ,NXT_TYPE                VARCHAR(2)          
        ,NEW_FLAG                INTEGER)
                 DISTRIBUTE BY HASH(PRODUCT_INSTANCE_ID)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select * from   G_S_22074_MONTH


 select product_instance_id , name,offer_id,SUPPLIER_ID,EXTEND_ID2
,case 
when offer_id = 113200000081 then '1'
when offer_id = 113200000071 then '3'
when offer_id in( 113110217758,113110148956) then '8'
when offer_id in( 113110217757,113110148669) then '9'
when offer_id in( 113110148955,113110217759) then '10'
else '11'
end NXT_TYPE
,case when char(a.create_date) like '2011-08%' then 1 else 0 end new_flag
 from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where a.OFFER_ID = b.PRODUCT_ITEM_ID
AND (
B.NAME LIKE '%百事易%'
or B.NAME LIKE '%务工易%'
or B.NAME LIKE '%农情气象%'
or B.NAME LIKE '%农信宝%'
)
with ur


insert into G_S_22074_MONTH_1
 select product_instance_id , name,offer_id,SUPPLIER_ID,EXTEND_ID2
,case 
when offer_id = 113200000081 then '1'
when offer_id = 113200000071 then '3'
when offer_id in( 113110217758,113110148956) then '8'
when offer_id in( 113110217757,113110148669) then '9'
when offer_id in( 113110148955,113110217759) then '10'
else '11'
end NXT_TYPE
,case when char(a.create_date) like '2011-08%' then 1 else 0 end new_flag
 from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where a.OFFER_ID = b.PRODUCT_ITEM_ID
AND (
B.NAME LIKE '%百事易%'
or B.NAME LIKE '%务工易%'
or B.NAME LIKE '%农情气象%'
or B.NAME LIKE '%农信宝%'
)
with ur


select * from   G_S_22074_MONTH_1


select * from    bass2.cdr_mms_20110831 
where (USER_ID,SP_CODE,OPER_CODE) in 
(select PRODUCT_INSTANCE_ID,SUPPLIER_ID,EXTEND_ID2 from G_S_22074_MONTH_1)



create view t_v_22074_2 as 
		    	  select

		    	  	 A.user_id,
				 a.PRODUCT_NO,
				 a.ACCT_ID,
		    	  	 a.SP_CODE,
		    	  	 a.OPER_CODE,
				 CHARGE1 
		    	  from bass2.cdr_mms_20110801 a 
			  where (USER_ID,SP_CODE,OPER_CODE) in 
				(select PRODUCT_INSTANCE_ID,SUPPLIER_ID,EXTEND_ID2 from G_S_22074_MONTH_1)
with ur


        USER_ID                 VARCHAR(20)         
        PRODUCT_NO              VARCHAR(15)         
        ACCT_ID                 VARCHAR(20)         
        SP_CODE                 VARCHAR(20)         
        OPER_CODE               VARCHAR(20)         
        CHARGE1                 INTEGER(4) 
        
        
        
CREATE TABLE "BASS1   "."G_S_22074_MONTH_3"  (
    time_id     int
        ,USER_ID                 VARCHAR(20)         
        ,PRODUCT_NO              VARCHAR(15)         
        ,ACCT_ID                 VARCHAR(20)         
        ,SP_CODE                 VARCHAR(20)         
        ,OPER_CODE               VARCHAR(20)         
        ,CHARGE1                 INTEGER
        )
                 DISTRIBUTE BY HASH(USER_ID)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select count(0) from    G_S_22074_MONTH_3

select count(0) from    G_S_22074_MONTH_1

select * from   G_S_22074_MONTH_2

select 
                          select
                                 20110801,
                                 A.user_id,
                                 a.PRODUCT_NO,
                                 a.ACCT_ID,
                                 a.SP_CODE,
                                 a.OPER_CODE,
                                 CHARGE1+CHARGE2+CHARGE3+CHARGE4  charge
                   from 
                     bass2.cdr_ismg_dtl_20110831  a
                   where 
                   (
                   (drtype_id<>61102 and process_time is not null and substr(sp_code,1,12) is not null
				and svcitem_id in (300001,300002,300003,300004)
			  ) 
			 or substr(ser_code,1,5) in ('12590') 	
)             
              and (USER_ID,SP_CODE,OPER_CODE) in 
				(select PRODUCT_INSTANCE_ID,SUPPLIER_ID,EXTEND_ID2 from G_S_22074_MONTH_1)
                
                
                
                   select
                                 20110801,
                                 A.user_id,
                                 a.PRODUCT_NO,
                                 a.ACCT_ID,
                                 a.SP_CODE,
                                 a.OPER_CODE,
                                 CHARGE1+CHARGE2+CHARGE3+CHARGE4  charge
                   from 
                     bass2.cdr_ismg_dtl_20110831  a
                   where 
                   (USER_ID,SP_CODE,OPER_CODE) in 
				(select PRODUCT_INSTANCE_ID,SUPPLIER_ID,EXTEND_ID2 from G_S_22074_MONTH_1)
                
                

select * from   bass2.dim_acct_item
where        

(
item_name LIKE '%百事易%'
or item_name LIKE '%务工易%'
or item_name LIKE '%农情气象%'
or item_name LIKE '%农信宝%'
)
                
               
select * from   G_S_22074_MONTH

select user_id , count(0) mms_cnt,sum(CHARGE1) income from G_S_22074_MONTH_2 group by user_id  ) b on a.user_id = b.user_id 


                        select
   *
                          from (select distinct PRODUCT_INSTANCE_ID user_id ,NXT_TYPE,NEW_FLAG from G_S_22074_MONTH_1) a
                          left join (select user_id , count(0) mms_cnt,sum(CHARGE1) income from G_S_22074_MONTH_2 group by user_id  ) b on a.user_id = b.user_id 
                          left join (select user_id , count(0) sms_cnt,sum(CHARGE1) income from G_S_22074_MONTH_3 group by user_id  ) c on a.user_id = c.user_id
                          group by NXT_TYPE
                          with ur
                          
                          

select date(START_TIME),count(0) from bass2.CDR_GPRS_LOCAL_20110928
group by date(START_TIME)

1	2
2011-09-27 	74137
2011-09-28 	3178865

                          
                          
select date(START_TIME),count(0) from bass2.CDR_GPRS_LOCAL_20110927
group by date(START_TIME)

       1	2
2011-09-26 	79267
2011-09-27 	4557120

select date(START_TIME),count(0) from bass2.CDR_GPRS_LOCAL_20110926
group by date(START_TIME)

1	2
2011-09-25 	78217
2011-09-26 	5694872

289510	4178850

                   
                   
select count(distinct product_no),count(0) from bass2.CDR_GPRS_LOCAL_20110927
where drtype_id not in (8307)
and bigint(product_no) not between 14734500000 
and 14734999999 and apn_ni <> 'JF.XZ.IP.MOBILE.LAN.CHINAMOBILE'
and service_code not in ('1010000001','1010000002','2000000000')
              


select b.OP_ID,ORG_ID,count(distinct product_instance_id) from   bass2.dw_product_201108 a,bass2.dw_product_ins_off_ins_prod_201108  b 
where MONTH_NEW_MARK = 1
and char(a.SO_NBR) =b.done_code
and a.user_id = b.PRODUCT_INSTANCE_ID
group by b.OP_ID,ORG_ID


PLAN_ID
89650010

300065023876
89660001268626

PRODUCT_INSTANCE_ID
89660001268626
89660001268626

select * from   bass2.dw_product_ins_off_ins_prod_201108 
where product_instance_id = '89660001268626'

OFFER_ID
111089650010
111099001926


select count(0) from    
bass2.dw_xysc_school_comp_user_dt_201109


select * from   bass2.dw_xysc_school_comp_user_dt_201109



select 
         201108 TIME_ID
        ,a.COMP_NO USER_ID
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end COMP_BRAND_ID
from bass2.dw_xysc_school_comp_user_dt_201109 a
left join bass2.Dim_xysc_maintenance_info b  on ( case when a.SCHOOL_NAME like '%西藏大学%' then '西藏大学' else a.SCHOOL_NAME end ) = b.SCHOOL_NAME
join bass2.dw_comp_cust_201109 d on a.comp_no = d.COMP_PRODUCT_NO
where  d.COMP_BRAND_ID  in (1,2,9,10,11,3,4,5,7)
and b.school_id = '89189100000003'
and a.school_name not in (select distinct school_name from bass2.Dim_xysc_maintenance_info 
        where SCHOOL_NAME <> '西藏大学'
        and SCHOOL_NAME <> '西藏大学农牧学院'
        )
group by 
        a.COMP_NO
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end 
with ur





select 
         201108 TIME_ID
        ,a.COMP_NO USER_ID
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end COMP_BRAND_ID
from bass2.dw_xysc_school_comp_user_dt_201108 a
left join bass2.Dim_xysc_maintenance_info b  on ( case when a.SCHOOL_NAME like '%西藏大学%' then '西藏大学' else a.SCHOOL_NAME end ) = b.SCHOOL_NAME
join bass2.dw_comp_cust_201108 d on a.comp_no = d.COMP_PRODUCT_NO
where  d.COMP_BRAND_ID  in (1,2,9,10,11,3,4,5,7)
and b.school_id = '89189100000003'
and a.school_name not in (select distinct school_name from bass2.Dim_xysc_maintenance_info 
        where SCHOOL_NAME <> '西藏大学'
        and SCHOOL_NAME <> '西藏大学农牧学院'
        )
group by 
        a.COMP_NO
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end 
with ur


select * from   G_I_02035_MONTH



select 
         201107 TIME_ID
        ,a.COMP_NO USER_ID
        ,b.SCHOOL_ID 
        ,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end COMP_BRAND_ID
from bass2.dw_xysc_school_comp_user_dt_201108 a
left join bass2.Dim_xysc_maintenance_info b on a.SCHOOL_NAME = b.SCHOOL_NAME
join bass2.dw_comp_cust_201108 d on a.comp_no = d.COMP_PRODUCT_NO
where  d.COMP_BRAND_ID  in (1,2,9,10,11,3,4,5,7)
and b.school_id = '89189100000003'      
group by 
a.COMP_NO
,b.SCHOOL_ID 
,case when d.COMP_BRAND_ID in (1,2,9,10,11) then '020000' else '030000' end 
  
  
  
  select b.OP_ID,ORG_ID,count(distinct product_instance_id) 
from  (select user_id,so_nbr from  bass2.dw_product_201108 where MONTH_NEW_MARK = 1 ) a,bass2.dw_product_ins_off_ins_prod_201108  b 
where char(a.SO_NBR) =b.done_code
and a.user_id = b.product_instance_id
group by b.OP_ID,ORG_ID


select  STAFF_ID,STAFF_ORG_ID
						,count(distinct payment_id)
						,sum(amount)
			from BASS2.dw_acct_payment_dm_201108 a 
			where  a.opt_code not in (select paytype_id from bass2.dim_acct_paytype where paytype_name like '%空中充值%') 			
group by  STAFF_ID,STAFF_ORG_ID

		
        select count(0) from    BASS1.G_S_22091_DAY_P2
        


drop table G_S_22069_MONTH_1

CREATE TABLE "BASS1   "."G_S_22069_MONTH_1"  (
                  "STAFF_ID" CHAR(40) , 
                  "CHANNEL_ID" CHAR(40) , 
                  ind   int,
                  "VALUE" bigint )   
                 DISTRIBUTE BY HASH(
                 "STAFF_ID",  
                 "CHANNEL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select * from   G_S_22069_MONTH_1



select * from   G_S_22069_MONTH_1


select ind , count(0) 
--,  count(distinct ind ) 
from G_S_22069_MONTH_1 
group by  ind 
order by 1 

select * from  bass2.Dw_cm_busi_radius_dm_201108 fetch first 10 rows only 


CREATE TABLE "BASS1   "."G_S_22069_MONTH_2"  (
                   op_id bigint,
                  "CHANNEL_ID" BIGINT , 
                  "ACCEPT_TYPE" INTEGER , 
                  "IMP_ACCEPTTYPE" CHAR(2) , 
                  "CNT" BIGINT )   
                 DISTRIBUTE BY HASH(op_id,"CHANNEL_ID",  
                 "ACCEPT_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



drop table G_S_22069_MONTH_3
CREATE TABLE "BASS1   "."G_S_22069_MONTH_3"  (
                  op_id bigint NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "ACCEPT_TYPE" CHAR(1) NOT NULL , 
                  "IMP_ACCEPTTYPE" CHAR(2) NOT NULL , 
                  "CNT" INTEGER )   
                 DISTRIBUTE BY HASH("OP_ID",CHANNEL_ID)   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


                select 
                      op_id,trim(char(channel_id))
                                        ,trim(char(accept_type))
                                        ,imp_accepttype
                                        ,sum(cnt)
                        from BASS1.G_S_22069_MONTH_2
        group by op_id,trim(char(channel_id)),
                 trim(char(accept_type)),
                 imp_accepttype
                 
select * from    BASS1.G_S_22069_MONTH_3


select * from   G_S_22069_MONTH

select count(0) from    G_I_06034_MONTH

select count(0),count(distinct staff_id ) from    G_S_22069_MONTH


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


201109	30172
201108	29210

201110	31065



alter table BASS1.G_A_01005_MONTH ALTER column ID  SET DATA TYPE CHARACTER(11)
alter table BASS1.G_A_01006_DAY ALTER column ENTERPRISE_ID  SET DATA TYPE CHARACTER(11)
alter table BASS1.G_A_01007_DAY ALTER column ENTERPRISE_ID  SET DATA TYPE CHARACTER(11)

db2 reorg table BASS1.G_A_01005_MONTH
db2 reorg table BASS1.G_A_01006_DAY
db2 reorg table BASS1.G_A_01007_DAY

alter table BASS1.G_I_06003_MONTH DROP column OTHCOVER_INFO 


db2 reorg table BASS1.G_I_06003_MONTH 

select * from   BASS1.G_I_02033_MONTH


alter table BASS1.G_I_02033_MONTH ALTER column USER_ID  SET DATA TYPE CHAR(15)
alter table BASS1.G_I_02035_MONTH ALTER column USER_ID  SET DATA TYPE CHAR(15)
db2 reorg table BASS1.G_I_02033_MONTH 
db2 reorg table BASS1.G_I_02035_MONTH


rename G_I_02033_MONTH to G_I_02033_MONTH_old

CREATE TABLE "BASS1   "."G_I_02033_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(15) , 
                  "SCHOOL_ID" CHAR(20) , 
                  "CMCC_BRANCH_ID" CHAR(6) , 
                  "MARK_TYPE" CHAR(1) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

insert into G_I_02033_MONTH
select * 
from G_I_02033_MONTH_old


rename G_I_02035_MONTH to G_I_02035_MONTH_old

CREATE TABLE "BASS1   "."G_I_02035_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(15) , 
                  "SCHOOL_ID" CHAR(20) , 
                  "CMCC_BRANCH_ID" CHAR(6) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "CMCC_BRANCH_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


insert into G_I_02035_MONTH
select * from G_I_02035_MONTH_old



alter table BASS1.G_I_22405_MONTH ALTER column PRODUCT_NO  SET DATA TYPE CHARACTER(15)
alter table BASS1.G_I_22406_MONTH ALTER column PRODUCT_NO  SET DATA TYPE CHARACTER(15)

rename G_I_22405_MONTH to G_I_22405_MONTH_old

CREATE TABLE "BASS1   "."G_I_22405_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "PRODUCT_NO" CHAR(15) , 
                  "USER_ID" CHAR(20) , 
                  "SCHOOL_ID" CHAR(20) , 
                  "RUN_MONTH" CHAR(6) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

insert into G_I_22405_MONTH
select * from G_I_22405_MONTH_old

rename G_I_22406_MONTH to G_I_22406_MONTH_old

drop table G_I_22406_MONTH
CREATE TABLE "BASS1   "."G_I_22406_MONTH"  (
                  "TIME_ID" INTEGER , 
                  "PRODUCT_NO" CHAR(15) , 
                  "USER_ID" CHAR(20) , 
                  "SCHOOL_ID" CHAR(20) , 
                  "RUN_MONTH" CHAR(6) )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "PRODUCT_NO",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

insert into G_I_22406_MONTH
select * from G_I_22406_MONTH_old



alter table BASS1.G_A_01002_DAY DROP column CUST_NAME 
alter table BASS1.G_A_01002_DAY DROP column INCM_RNG_ID 
alter table BASS1.G_A_01002_DAY DROP column ADDRESS 
alter table BASS1.G_A_01002_DAY DROP column POST_CODE 
alter table BASS1.G_A_01002_DAY DROP column CARD_TYPE
alter table BASS1.G_A_01002_DAY DROP column CARD_CODE
db2 reorg table BASS1.G_A_01002_DAY 


alter table BASS1.G_A_01004_DAY DROP column OWNER_NAME 
alter table BASS1.G_A_01004_DAY DROP column ENT_MANAGER_ID 
alter table BASS1.G_A_01004_DAY DROP column LINKMAN_NAME 
alter table BASS1.G_A_01004_DAY DROP column LINKMAN_TITLE 
alter table BASS1.G_A_01004_DAY DROP column IND_RES_SCHEMA 

db2 reorg table BASS1.G_A_01004_DAY 

select count(0) from     bass1.g_a_01002_day where time_id = 20110930


select count(0) from     bass1.g_a_01004_day where time_id = 20110930



select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201108
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201108
)




select *    

from  BASS1.G_RULE_CHECK 
                                        where time_id=201108 and rule_code in 
                                        (
                                         'R041'
                                        ,'R042'
                                        ,'R043'
                                        ,'R044'
                                        ,'R045'
                                        ,'R046'
                                        ,'R047'
                                        )
                                        


                  SELECT
                           201109
                                ,'201109'
                                ,trim(char(a.CHANNEL_ID))
                                ,char(bigint( sum(case when t_index_id in (1,4,14) then result else 0 end )                 ))
                                ,char(bigint( sum(case when t_index_id in (10,11,12,13,19,20,21) then result else 0 end )   ))
                                ,char(bigint( sum(case when t_index_id in (7) then result else 0 end )                      ))
                                ,'0'
                                ,'0'
                                ,'0'
                        FROM BASS2.DW_CHANNEL_INFO_201109 A
                        inner join bass2.stat_channel_reward_0002 b on a.channel_id=b.channel_id
                        WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102) 
                                                and b.op_time=201109
                                                AND B.result>0
                        group by trim(char(a.CHANNEL_ID))


select * from   app.sch_control_runlog where control_code = 'REP_stat_channel_reward_0002.tcl'                                        
select op_time,count(0) from   bass2.stat_channel_reward_0002
group by op_time


select * from   app.sch_control_runlog_his where control_code = 'REP_stat_channel_reward_0002.tcl'                                        


  select * from
                (select * from 
                (
                select user_id,chg_vip_time,row_number()over(partition by user_id order by time_id desc) row_id from BASS1.G_I_02005_MONTH
                where time_id=201109
                ) k
                where k.row_id =1) a
                left outer join 
                (
                select * from
                (
                select user_id,create_date,row_number()over(partition by user_id order by time_id desc) row_id 
                from BASS1.G_A_02004_DAY
                where time_id<=20110930
                ) k
                where k.row_id=1) b
                on a.user_id=b.user_id
                where bigint(chg_vip_time)<bigint(create_date)
                with ur
                
89160001048760      	20110624	1	89160001048760      	20110629	1

update BASS1.G_I_02005_MONTH
set CHG_VIP_TIME = '20110629'
where user_id = '89160001048760'
and time_id = 201109
                

select count(0) from     bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201109
select count(0) from    bass2.STAT_ZD_VILLAGE_USERS_201109
                


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02034_MONTH 
group by  time_id 
order by 1 


                
                
select time_id , count(0) 
--,  count(distinct time_id ) 
from G_I_02035_MONTH 
group by  time_id 
order by 1 

                
                
select count(0) from    bass2.dw_xysc_school_comp_user_dt_$op_                

select t.*
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'

select count(0) from    bass2.dim_test_enterprise

select count(0) from    
bass2.dwd_enterprise_sub_20110831
where SERVICE_ID = '942'



select * from    bass2.dw_enterprise_sub_ds



select * from bass1.ALL_DIM_LKP_160 where bass1_tbid='BASS_STD1_0075'
where 

select tabname from syscat.tables where tabname like '%ENTERPRISE_SUB%'   

select count(0) from    bass2.DW_ENTERPRISE_SUB_201108 a
where SERVICE_ID = '942'
and   exists (select 1 from bass2.dim_test_enterprise b where a.enterprise_id = b.enterprise_id)



select t.*
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
and enterprise_id  in (select enterprise_id from  bass2.dim_test_enterprise )


drop table "BASS1   "."G_A_02062_DAY_chk20111008"

CREATE TABLE "BASS1   ".G_A_02062_DAY_chk20111008  (                  
                  "ENTERPRISE_ID" CHAR(20) , 
                  "USER_ID" CHAR(20) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "INDUSTRY_ID" CHAR(2) , 
                  "GPRS_TYPE" CHAR(1) , 
                  "DATA_SOURCE" CHAR(60) , 
                  "CREATE_DATE" CHAR(8) , 
                  "STATUS_ID" CHAR(1) )   
                 DISTRIBUTE BY HASH("USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




8月一经 1129平台 1161

select product_no
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
except
select product_no from  G_A_02062_DAY_chk20111008

61

select product_no from  G_A_02062_DAY_chk20111008
except
select product_no
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
93

except

8月一经1129平台1161
32




insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201109


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201109

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 





select tabname from syscat.tables where tabname like '%ROAMIN%'   




select
 	                             sum(case
 	                                 when OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78) 
					 and  CALLTYPE_ID in (0,2,3) then CALL_COUNTS else 0 end 
					) ROAMIN_CALL_CNT
 	                            ,sum(case
 	                                 when OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78) 
					 and  CALLTYPE_ID in (0,2,3) then call_duration_m else 0 end 
					) ROAMIN_CALL_DUR
				    ,sum(case when OPPOSITE_ID in (3,13,115,2,1,4,116,14) and  CALLTYPE_ID in (0,2,3) then CALL_COUNTS else 0 end ) ROAMIN_OCALL_CNT
				    ,sum(case when OPPOSITE_ID in (3,13,115,2,1,4,116,14) and  CALLTYPE_ID in (0,2,3) then call_duration_m else 0 end ) ROAMIN_OCALL_DUR
				    ,sum(case
 	                                 when  CALLTYPE_ID in (1) then CALL_COUNTS else 0 end 
					) ROAMIN_BYCALL_CNT
 	                            ,sum(case
 	                                 when CALLTYPE_ID in (1) then call_duration_m else 0 end 
					) ROAMIN_BYCALL_DUR
					
                 from bass2.DW_CALL_ROAMIN_DM_201109
                 where  roamtype_id in (2,7)  and TOLLTYPE_ID < 100
                
			      


select
	                      case when a.service_id in (305011) then 1
	                           when a.service_id in (305015) then 2
	                           when a.service_id in (305018) then 3
	                      else 0 end,
				          		  count(distinct a.user_id)
				         from	bass2.DW_PRODUCT_FUNC_201109 a , bass2.dw_product_201109 b
				         where a.valid_date < date('2011-10-01')
				         and a.expire_date >= date('2011-10-01')
				         and b.usertype_id in (1,2,9) and a.user_id=b.user_id
				         and a.SERVICE_ID in (305011,305015,305018)
				         and b.userstatus_id in (1,2,3,6,8) and b.test_mark <> 1 and a.STS in (1)
                         and a.service_id = 305011
				         group by
				                 case when a.service_id in (305011) then 1
	                            when a.service_id in (305015) then 2
	                            when a.service_id in (305018) then 3
	                       else 0 end
                           

select * from    bass2.DW_CALL_ROAMIN_DM_201109
                           
                           
                          

select
 	                             sum(case
 	                                 when OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78) 
					 and  CALLTYPE_ID in (0,2,3) then CALL_COUNTS else 0 end 
					) ROAMIN_CALL_CNT
 	                            ,sum(case
 	                                 when OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78) 
					 and  CALLTYPE_ID in (0,2,3) then call_duration_m else 0 end 
					) ROAMIN_CALL_DUR
 	                            ,sum(case
 	                                 when OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78) 
					 and  CALLTYPE_ID in (0,2,3) and BASECALL_FEE+TOLL_FEE+INFO_FEE > 0 then call_duration_m else 0 end 
					) ROAMIN_BILL_DUR
				    ,sum(case when OPPOSITE_ID in (3,13,115,2,1,4,116,14) and  CALLTYPE_ID in (0,2,3) then CALL_COUNTS else 0 end ) ROAMIN_OCALL_CNT
				    ,sum(case when OPPOSITE_ID in (3,13,115,2,1,4,116,14) and  CALLTYPE_ID in (0,2,3) then call_duration_m else 0 end ) ROAMIN_OCALL_DUR
				    ,sum(case when OPPOSITE_ID in (3,13,115,2,1,4,116,14) and  CALLTYPE_ID in (0,2,3) and BASECALL_FEE+TOLL_FEE+INFO_FEE > 0 then call_duration_m else 0 end ) ROAMIN_OBILL_DUR
				    ,sum(case
 	                                 when  CALLTYPE_ID in (1) then CALL_COUNTS else 0 end 
					) ROAMIN_BYCALL_CNT
 	                            ,sum(case
 	                                 when CALLTYPE_ID in (1) then call_duration_m else 0 end 
					) ROAMIN_BYCALL_DUR
 	                            ,sum(case
 	                                 when CALLTYPE_ID in (1) and BASECALL_FEE+TOLL_FEE+INFO_FEE > 0  then call_duration_m else 0 end 
					) ROAMIN_BYCALL_DUR					
                 from bass2.DW_CALL_ROAMIN_DM_201109
                 where  roamtype_id in (2,7)  and TOLLTYPE_ID < 100

                          
                          

select * from   G_S_22075_MONTH

select * from   bass2.stat_rep_content
where zb_code = 'BT5302'

2011-09-01 	890	663	BT5301	6453140
2011-09-01 	890	663	BT5302	18280115


select * from   

                          
                          
                          select *
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
and product_no = '13658962466'


select * from   bass2.Map_enterprise_product

	942


select * from   bass2.dw_product_ins_prod_201108   
where product_spec_id = 172000000942
--and product_instance_id = '89657333002102'
and bill_id = '13659561914'





CREATE TABLE "BASS1   "."G_S_22076_MONTH_1"  (                 
                  "INDEX_NAME" CHAR(15) , 
                  "INDEX_VALUE" CHAR(15) )   
                 DISTRIBUTE BY HASH("INDEX_NAME")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



select * from   G_S_22076_MONTH_1

       

select 'LDXS'
,(
select char(count(distinct a.user_id))
 from	bass2.DW_PRODUCT_FUNC_201109 a 
 , bass2.dw_product_201109 b
 where replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
 and b.usertype_id in (1,2,9) and a.user_id=b.user_id
 and a.SERVICE_ID in (305011,305015,305018)
 and b.userstatus_id in (1,2,3,6,8) and b.test_mark <> 1 and a.STS in (1)
 and a.service_id = 305011
 ) index_value 
from  bass2.dual

       
LDXS	1731439    

       CU9110
       
       
       select * from   bass2.stat_rep_content
where zb_code = 'CU9110'



select 'P03-WNHZ'
,(
select char(count(distinct a.user_id))
 from	bass2.DW_NEWBUSI_CALL_201109 a , bass2.dw_product_201109 b
 where b.usertype_id in (1,2,9)
   and b.userstatus_id in (1,2,3,6,8) and b.test_mark <> 1
   and a.user_id=b.user_id
   and a.SVCITEM_ID in (100015,100016,100017,100018)
   and a.OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78)
) from bass2.dual



select CHAR(count(distinct a.user_id))
                 from    BASS2.dw_product_func_201109  a , BASS2.dw_product_201109 b
                 where b.usertype_id in (1,2,9) and a.user_id=b.user_id 
			and a.service_id in (305120)
			AND replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
			and b.userstatus_id in (1,2,3,6,8) and b.test_mark <> 1 and a.STS in (1)
            and calltype_id = 1
            
           
select calltype_id , count(0) 
--,  count(distinct calltype_id ) 
from bass2.dw_newbusi_ismg_201109 
group by  calltype_id 
order by 1 


select * from   bass2.dim_svc_item
where svcitem_name like '%网内%'



select  sum(b.counts)
                      from bass2.dw_enterprise_member_mid_201109 a,bass2.dw_newbusi_ismg_201109 b,
                           bass2.dw_product_201109 c
                      where a.user_id = b.user_id and a.user_id = c.user_id
                         and b.sp_code  = '931007' and b.calltype_id in (1)
			 and calltype_id = 1          
             
            
select city_id,count(0) from 
bass2.dw_newbusi_sms_201109
group by city_id

select * from   bass2.dw_newbusi_sms_201109

select tabname from syscat.tables where tabname like '%HLR%'   
            
            
            select * from   bass2.DIM_GSM_HLR_INFO
            where prov_code = '891'
            
select substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7)
from       bass2.dw_newbusi_sms_201109 a
       

		select sum(COUNTS)
                  from
                        bass2.dw_newbusi_sms_201109 a
			,bass2.dw_product_201109 b
			,(select * from   bass2.DIM_GSM_HLR_INFO
                where prov_code = '891'
              ) c
                  where a.user_id = b.user_id 
		        and substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) = c.hlr_code
			and a.calltype_id=0
			and a.svcitem_id in (200004)

                

select user_id, substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) hlr_code  
		       from bass2.dw_newbusi_sms_201109 a where  a.calltype_id=0 and a.svcitem_id in (200004)


		select sum(COUNTS)
                  from
                       (select user_id,counts, substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) hlr_code  
		       from bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=0 and a.svcitem_id in (200004)) a
			,bass2.dw_product_201109 b
			,(select distinct  hlr_code from   bass2.DIM_GSM_HLR_INFO
                where prov_code = '891'
              ) c
                  where a.user_id = b.user_id 
		        and  a.hlr_code = c.hlr_code
                
50038905

select count(0),count(distinct hlr_code) from   bass2.DIM_GSM_HLR_INFO
                where prov_code = '891'

                
                
                select hlr_code,count(0)  from   bass2.DIM_GSM_HLR_INFO
                 where prov_code = '891'
                group by hlr_code
                
                1569267	2
1569263	2
1569265	2
1520801	2
1520800	2

select * from    bass2.DIM_GSM_HLR_INFO where hlr_code = '1520800'


select *
		       from bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=0 and a.svcitem_id in (200003)
               and a.ROAMTYPE_ID = 100


select user_id,counts
       from bass2.dw_newbusi_sms_201109 a
      where   a.calltype_id=0
        and a.svcitem_id in (200003)
        and a.OPPOSITE_ID = 12
        and a.OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78,3,13,115,2,1,4,116,14)
        

select sum(COUNTS)
          from
               (select user_id,counts
       from bass2.dw_newbusi_sms_201109 a
      where   a.calltype_id=0
        and a.svcitem_id in (200003)
        and a.OPPOSITE_ID in (72,12,32,60,61,62,63,64,65,83,91,101,102,103,104,109,122,259000,258600,2586,259010,259200,259150,259100,259090,259080,259070,259060,259050,259040,259030,78,3,13,115,2,1,4,116,14)
        ) a
    ,bass2.dw_product_201109 b
          where a.user_id = b.user_id 
			
OPPOSITE_ID	2
0	12608219
12	73954301
13	2971612
14	1896556
15	3483
16	398614
17	2160828



select OPPOSITE_ID , count(0) 
--,  count(distinct OPPOSITE_ID ) 
from bass2.dw_newbusi_sms_201109 
group by  OPPOSITE_ID 
order by 1 




		select CHAR(sum(COUNTS))
                  from
                       (select user_id,counts, substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) hlr_code  
		       from bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=0 and a.svcitem_id in (200004)) a
			,bass2.dw_product_201109 b
			,(select distinct  hlr_code  from   bass2.DIM_GSM_HLR_INFO
                where prov_code <> '891'
              ) c
                  where a.user_id = b.user_id 
		        and  a.hlr_code = c.hlr_code
                
               

		select CHAR(sum(COUNTS))
		       from bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=1 
		       and a.svcitem_id in (200001,200002,200005)
              
7570676    

select * from   bass2.DIM_GPRS_SERVICE_CODE         where   SERVICE_CODE_NAME like '%彩信%'   
         
         
         SERVICE_CODE
1010000001
1010000002
1030000006
2000000000
SERVICE_CODE	SERVICE_CODE_NAME
1010000001	彩信(发送)
1010000002	彩信(接收)
1030000006	彩信相册WAP访问
2000000000	所有WAP1.X手机收发彩信的信令流量

select sum(UPFLOW1+DOWNFLOW1)/1024 /1024 from   bass2.dw_newbusi_gprs_20110913538764

select sum(UPFLOW1+DOWNFLOW1)/1024 /1024 from   bass2.dw_newbusi_gprs_201109where SERVICE_CODE in( '1010000001','1010000002')
381446
RATING_RES
select sum(RATING_RES)/1024  from   bass2.dw_newbusi_gprs_201109where SERVICE_CODE in( '1010000001','1010000002')
410052

select bigint(sum(RATING_RES/1024))  from   bass2.dw_newbusi_gprs_201109where SERVICE_CODE not in( 
 '999999'	
,'4020000001'	
,'4000000006'	
,'4000000005'	
,'4000000004'	
,'4000000003'	
,'4000000002'	
,'4000000001'	
,'2111000000'	
,'1010000002'	
,'1010000001'	
)
5520330

select SERVICE_CODE , count(0) 
--,  count(distinct SERVICE_CODE ) 
from bass2.dw_newbusi_gprs_201109 
group by  SERVICE_CODE 
order by 1 



select	'$op_month'
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P02')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P03')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P04')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P05')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P06')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P07')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P08')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P09')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P10')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P11')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P12')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P13')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P14')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P15')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P16')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P17')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P18')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P19')
from bass2.dual
with ur


drop table G_S_22076_MONTH

CREATE TABLE "BASS1   "."G_S_22076_MONTH"  (
                  "TIME_ID" INTEGER not null, 
                  "OP_MONTH" CHAR(6) not null, 
                  "LDXS_ARR_CNT" CHAR(12)  not null, 
                  "CMCC_FORWARD_DUR" CHAR(15) not null, 
                  "OTH_FORWARD_DUR" CHAR(15) not null, 
                  "CMCC_P_SMS_UP_CNT" CHAR(15) not null, 
                  "CMCC_OTH_SMS_UP_CNT" CHAR(15) not null, 
                  "I2D_SMS_CNT" CHAR(15) not null, 
                  "GRP_SMS_RCV_CNT" CHAR(15) not null, 
                  "CMCC_P_MMS_UP_CNT" CHAR(15) not null, 
                  "CMCC_OTH_MMS_UP_CNT" CHAR(15) not null, 
                  "CMCC_OTH_MMS_RCV_CNT" CHAR(15) not null, 
                  "C2OTH_MMS_UP_CNT" CHAR(15) not null, 
                  "C2OTH_MMS_RCV_CNT" CHAR(15) not null, 
                  "GRP_MMS_RCV_CNT" CHAR(15) not null, 
                  "OTH_GPRS_FLOW" CHAR(15) not null, 
                  "CRING_ARR_CNT" CHAR(12) not null, 
                  "VPMN_SMS_CNT" CHAR(15) not null, 
                  "MMS_FLOW" CHAR(15) not null, 
                  "P2P_SMS_OTH_DOWN_CNT" CHAR(15) )   
                 DISTRIBUTE BY HASH("OP_MONTH")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 
                   
                   
                   
                  
                          
                          select *
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
and product_no in (



select product_no
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'
except
select product_no from  G_A_02062_DAY_chk20111008
)
                 
                 
                 DRTYPE_ID	2
201	2971879
301	48417
601	4111355
1500	3482
5501	86857728
9801	742
9903	10

                 3100
                 
select DRTYPE_ID , count(0) 
--,  count(distinct DRTYPE_ID ) 
from bass2.dw_newbusi_sms_201109 
group by  DRTYPE_ID 
order by 1 
                 
                 select * from   bass2.ods_cdr_sms_20111009
where DRTYPE_ID = 5502

select * from   bass2.dw_newbusi_sms_201109 where SERVICE_ID = 91001


13638960922

select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20111009
and 

select * from   G_A_02062_DAY
where user_id = '89657334006025'


select * from   bass2.DW_ENTERPRISE_SUB_DS
where bill_id = '13638960922'

select * from   bass2.DW_PRODUCT_INS_PROD_2
where product_instance_id = '89657334006025' and product_spec_id = 942

select tabname from syscat.tables where tabname like upper('%product_ins_prod%'   )

select * from 
bass2.dw_product_ins_off_ins_prod_his_201107
where product_instance_id = '89657334006025'
and offer_id = 112001005701


OFFER_ID
111090009505


select * from   bass2.dim_prod_up_product_item
where product_item_id = 111089640007
select * from   
bass2.dim_ent_unipay_offer

OFFER_ID
111089640007


942	车务通	172000000942	车务通	112001005701	本省车务通	2	3	0	个人付费


select * from   bass2.dw_product_201107 where product_no = '13638960922'
CREATE_DATE	VALID_DATE	STS_DATE	EXPIRE_DATE
2004-12-10 	2006-08-19 	2006-08-19 	2030-01-01 
2006-12-30 	2010-01-12 	2010-01-12 	2030-01-01 
2010-01-18 	2010-04-01 	2011-08-15 	2030-01-01 

USER_ID
89601160021762
89657331889700
89657334006025

89603000653594      	89657334006025      	13638960922    	20110729



select *
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20111009
) t 
where t.rn = 1


and STATUS_ID = '1'




select 'P12'
,(
 select char(sum(counts))
 from 
 table (
 select a.user_id,counts  from bass2.DW_NEWBUSI_MMS_201109 a 
 where a.SEND_STATUS in (0,1,2,3) 
 and a.SVCITEM_ID in  (400002)
 and  a.calltype_id in (0)
 ) a
 ,bass2.dw_product_201109 b
 where 
    a.user_id=b.user_id
  and  b.usertype_id in (1,2,9)
) from bass2.dual  



P12	235616     

235616     

select * from   G_S_22076_MONTH_1

select * from    bass2.DIM_PM_SP_OPERATOR_CODE

select distinct  hlr_code  from   bass2.DIM_GSM_HLR_INFO
                                where prov_code <> '891'
                                
                                
                               
select count(0)
                       from bass2.dw_newbusi_sms_201109 a
                       where  a.calltype_id=0 and a.svcitem_id in (200004)                               
                       
                       
select * from   G_I_02026_MONTH

select * from   bass2.dim_acct_item where item_name like '%托管%'

                       select count(0) from     (
                       select distinct  hlr_code  from   bass2.DIM_GSM_HLR_INFO
                                where prov_code <> '891'
                                ) a

 

CREATE TABLE "BASS1   "."G_S_22076_MONTH_2"  (
                  "HLR_CODE" CHAR(15)  )   
                 DISTRIBUTE BY HASH("HLR_CODE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


                                

select * from   bass2.dw_newbusi_sms_201109
where calltype_id = 0
and length(product_no) = 6

                               
select 'P13'
,(
 select char(sum(counts))
 from bass2.DW_NEWBUSI_MMS_201109 a 
 where a.SEND_STATUS in (0,1,2,3) 
 and a.SVCITEM_ID in  (400002)
 and  a.calltype_id in (1)
 ) a
  from bass2.dual

select * from   bass1.G_S_22076_MONTH_1

                               
select * from    bass2.dw_newbusi_gprs_201109

select BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE from    bass2.dw_newbusi_gprs_201109

select * from   bass2.dim_acct_item
where item_name like '%GPRS%'                               


select sum(value(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE,0)) as decimal(10,2)) from  (select bass2.dw_newbusi_gprs_201109 

where ROAMTYPE_ID in ( 100 )

select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
where ROAMTYPE_ID in ( 4,8 )


select cast( sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE) as decimal(10,2)) from  bass2.dw_newbusi_gprs_201109 
where ROAMTYPE_ID in ( 0,1 )


select value (
(
select cast( sum(value(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE,0)) as decimal(10,2)) from  bass2.dw_newbusi_gprs_201109 
where ROAMTYPE_ID in ( 100 ) ),'0')
from bass2.dual


select case when 
        (
        select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
        where ROAMTYPE_ID in ( 100 )
        ) is null then '0' else 
(
        select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
        where ROAMTYPE_ID in ( 100 )
        ) end  from bass2.dual
    


select  char(cast( sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE) as decimal(15,2))) from  bass2.dw_newbusi_gprs_201109 
where ROAMTYPE_ID in ( 4,8 )
    
    
    
    
    
                    select 201109
                ,'201109'
                ,(select char(BASE_FEE+TOLL_FEE+INFO_FEE)
                        from 
                        bass2.DW_NEWBUSI_CALL_201109 a
                        where roamtype_id in (1,4,6,8)  
                        and TOLLTYPE_ID in ( 0,1,2,101,102)
                        and CALLTYPE_ID = 0
                                )
        ,(
                        select char((BASE_FEE+TOLL_FEE+INFO_FEE)
                from 
                bass2.DW_NEWBUSI_CALL_201109 a
                where roamtype_id in (1,4,6,8)  
                and CALLTYPE_ID = 1
                        )
        ,'0'
        ,'0'
        ,
        (
        select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
        where ROAMTYPE_ID in ( 0,1 )
        )
        ,(
                select  char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
                where ROAMTYPE_ID in ( 4,8 )
                )
        ,case when 
        (
        select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
        where ROAMTYPE_ID in ( 100 )
        ) is null then '0' else 
(
        select char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
        where ROAMTYPE_ID in ( 100 )
        ) end 
        
from bass2.dual


select * from   bass1.G_S_22077_MONTH




select  char(bigint(sum(CHARGE1+CHARGE2+CHARGE3))) 
                from 
                bass2.cdr_CALL_20111001 a
                where roamtype_id in (1,4,6,8)  
                and CALLTYPE_ID = 1
                
                
select  char(bigint(sum(BASE_FEE+TOLL_FEE+INFO_FEE))) 
                        from 
                        bass2.DW_NEWBUSI_CALL_201109 a
                where roamtype_id in (1,4,6,8)  
                and CALLTYPE_ID = 1
    
NEWBUSI_CALL

                
select  char(bigint(sum(BASECALL_FEE+TOLL_FEE+INFO_FEE))) 
                        from 
                        bass2.DW_CALL_201109 a
                where roamtype_id in (1,4,6,8)  
                and CALLTYPE_ID = 1      
               
select tabname from syscat.tables where tabname like '%DW_CALL%'                  


select * from   bass2.dim_call_roamtype

select  char(bigint(sum(BASE_FEE+INFO_FEE+MONTH_FEE+FUNC_FEE))) from  bass2.dw_newbusi_gprs_201109 
		where ROAMTYPE_ID in ( 5,9 )

        
        select ROAMTYPE_ID , count(0) 
--,  count(distinct ROAMTYPE_ID ) 
from bass2.dw_newbusi_gprs_201109 
group by  ROAMTYPE_ID 
order by 1 

select BASECALL_FEE,TOLL_FEE,INFO_FEE from   bass2.DW_CALL_201109



select * from    BASS1.G_S_22077_MONTH

select a.product_no
 from bass2.dw_newbusi_sms_201109 a
 where a.product_no like '6%'

select * from  bass2.dw_vpmn_member_201109
 select count(0),count(distinct product_no) from    bass2.dw_vpmn_member_201109
 
 
  select count(0),count(distinct user_id) from    bass2.dw_vpmn_member_201109
  
 select count(0),count(distinct PRODUCT_NO ) from   (
  select PRODUCT_NO,VPMN_ID
  ,row_number()over(partition by PRODUCT_NO order by EXPIRE_DATE desc , VALID_DATE desc ) rn
  from  bass2.dw_vpmn_member_201109 a
 where replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
 and PRODUCT_NO is not null
 ) a where rn = 1
  
  
   select * from   (
  select PRODUCT_NO,VPMN_ID
  ,row_number()over(partition by PRODUCT_NO order by EXPIRE_DATE desc , VALID_DATE desc ) rn
  from  bass2.dw_vpmn_member_201109 a
 where replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
 and PRODUCT_NO is not null
 ) a where rn = 1
  
  
  
  
          INSERT INTO  BASS1.G_S_22076_MONTH
       
select  201109,'201109'
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P02')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P03')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P04')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P05')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P06')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P07')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P08')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P09')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P10')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P11')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P12')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P13')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P14')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P15')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P16')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P17')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P18')
,(select INDEX_VALUE from G_S_22076_MONTH_1 where INDEX_NAME = 'P19')
from bass2.dual
with ur



select * from   bass2.dim_svc_item where 

select * from    bass1.G_S_22076_MONTH_1


   select PRODUCT_NO,VPMN_ID from   (
  select PRODUCT_NO,VPMN_ID
  ,row_number()over(partition by PRODUCT_NO order by EXPIRE_DATE desc , VALID_DATE desc ) rn
  from  bass2.dw_vpmn_member_201109 a
 where replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
 and PRODUCT_NO is not null
 ) a where rn = 1
 
 
 declare global temporary table session.G_S_22076_MONTH_vpmn
                      (
        PRODUCT_NO              VARCHAR(16)         
        ,VPMN_ID                 VARCHAR(20)     
                      )
                      partitioning key
                      (PRODUCT_NO)
                      using hashing
                      with replace on commit preserve rows not logged in tbs_user_temp
                      
                      select * from bass2.dw_vpmn_member_201109 where vpmn_id = '89108911007801'

insert into session.G_S_22076_MONTH_vpmn
   select PRODUCT_NO,VPMN_ID from   (
  select PRODUCT_NO,VPMN_ID
  ,row_number()over(partition by PRODUCT_NO order by EXPIRE_DATE desc , VALID_DATE desc ) rn
  from  bass2.dw_vpmn_member_201109 a
 where replace(char(a.valid_date),'-','')    < '20111001'
 and   replace(char(a.expire_date),'-','')  >= '20111001'
 and PRODUCT_NO is not null
 ) a where rn = 1
                      

 create index  session.idx_22076_MONTH_vpmn on session.G_S_22076_MONTH_vpmn(PRODUCT_NO) 
 
select count(0) from    session.G_S_22076_MONTH_vpmn
     385873                 

        select *
                       from (select PRODUCT_NO,OPP_NUMBER,counts from  bass2.dw_newbusi_sms_201109 a
                        where  a.calltype_id=0 ) a
                       join session.G_S_22076_MONTH_vpmn b on a.PRODUCT_NO = b.PRODUCT_NO
                       join session.G_S_22076_MONTH_vpmn c on a.OPP_NUMBER = c.PRODUCT_NO
                       where 
                        b.VPMN_ID=c.VPMN_ID
                        
                        and a.svcitem_id in (200004)

PRODUCT_NO	OPP_NUMBER	COUNTS	PRODUCT_NO	VPMN_ID	PRODUCT_NO	VPMN_ID
13908961813	13908961813	1	13908961813	89108911004175	13908961813	89108911004175
13618992050	13989092601	1	13618992050	89108911007801	13989092601	89108911007801


select * from   BASS1.G_S_22076_MONTH
                        CU9260
                        
                        
select * from   bass2.stat_rep_content
where zb_code = 'CU9260'
                        
                        2011-09-01 	890	606	CU9260	1107273

select unit_code  from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
except
select unit_code  from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1

select unit_code  from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1
except
select unit_code  from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1

select unit_code  from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1



drop table ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD



/**	2011-10-12 10:54	added by  panzhiwei		**/		
--DROP TABLE ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD;						
CREATE TABLE bass2.ODS_ENT_PAR_GROUP_CUSTOMER_20111011(						
ECCODE	VARCHAR(32)	--集团客户编码				
,HQPROV	VARCHAR(3)	--总部归属省代码				
,INDUSCODE	VARCHAR(2)	--行业类别				
,SCOPE	VARCHAR(1)	--企业规模				
,EC_NAME	VARCHAR(128)	--集团客户名称				
,OPREFFTIME	VARCHAR(8)	--操作生效时间				
,ISHQ	VARCHAR(1)	--集团客户类型				
,UNIPAY	VARCHAR(50)	--统一付费编号				
,OWNERNAME	VARCHAR(20)	--法人代表				
,ECTYPE	VARCHAR(2)	--企业类型				
,REGCAPITAL	decimal(8,2)	--注册资金				
,MEMBERCOUNT	VARCHAR(32)	--企业员工规模				
,LOCATION	VARCHAR(4)	--地市				
,ADDRESS	VARCHAR(128)	--地址				
,POSTCODE	VARCHAR(8)	--邮编				
,NEWSERVUSE	VARCHAR(512)	--新业务使用情况				
,AVGFEE	decimal(8,2)	--员工月平均话费				
,QUOTA	decimal(8,2)	--话费月报销额度				
,REWARDTYPE	VARCHAR(1)	--话费报销方式				
,SALESNAME	VARCHAR(50)	--客户经理姓名				
,SALESTEL	VARCHAR(15)	--客户经理电话				
,LEADERNAME	VARCHAR(50)	--客户经理上级姓名				
,XIANCHUUSER	VARCHAR(10)	--县处级干部人数				
,TINGJUUSER	VARCHAR(10)	--厅局级干部人数				
,HASITDEPT	VARCHAR(1)	--是否有IT部门				
,ITDEPTNAME	VARCHAR(64)	--IT部门名称				
,CMCCPRD	VARCHAR(200)	--信息化产品				
,FEECASE	VARCHAR(1)	--是否有专属资费方案				
,FEECASEINFO	VARCHAR(256)	--资费套餐内容				
,ARPU	decimal(8,2)	--平均收入				
,DATAARPU	decimal(8,2)	--平均数据业务收入				
,UNICOMTONE	VARCHAR(1)	--是否使用联通话音业务				
,UNICOMDATA	VARCHAR(1)	--是否使用联通数据业务				
,TRENDS	VARCHAR(256)	--未来变化趋势				
,MOBILEUSER	INTEGER	--中国移动手机数				
,MOBILERATE	decimal(4,4)	--中国移动手机用户比例				
,INFORMATIONIZE	VARCHAR(256)	--对信息化的需求程度				
,INTERGRATION	VARCHAR(256)	--对信息化集成的需求程度				
,TERMINAL	VARCHAR(256)	--对行业终端定制需求程度				
,TRANSPROV	VARCHAR(256)	--对跨省一体化实施的需求				
,SINGLEPAY	VARCHAR(256)	--对一点账单结算的需求				
,MAS	VARCHAR(256)	--对MAS的需求程度				
,ORGCUSTID	VARCHAR(30)	--省BOSS内集团客户编码				
,CHECKRESULT	SMALLINT	--审批结果				
,CUSTSTATE	SMALLINT	--客户状态				
,PARENT_ECCODE	BIGINT	--PARENT_ECCODE				
,COUNT	VARCHAR(3)	--计数				
,OPERTYPE	SMALLINT	--操作类型				
,LEADERTEL	VARCHAR(15)	--客户经理上级电话				
,POST_PROVINCE	VARCHAR(6)	--邮寄省份				
,UPDATE_TIME	TIMESTAMP	--更新时间				
,CUSTOMERNUMBER	VARCHAR(30)	--CUSTOMERNUMBER				
 )
  DATA CAPTURE NONE
 IN TBS_3H
 INDEX IN TBS_INDEX
  PARTITIONING KEY
   ( ECCODE )
 USING HASHING;


I11212	
insert into bass2.etl_load_table_map values('I11212','ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD','跨省集团用户表',0,'MARKET.CM_PAR_GROUP_CUSTOMER');	
insert into bass2.USYS_TABLE_MAINTAIN values(11047,'跨省集团用户表','ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD','1','day',255,'0','','','BASS2','ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD','TBS_3H','TBS_INDEX','ECCODE',1);	
insert into app.sch_control_task values ('TR1_L_11212',1,2,'ODS_ENT_PAR_GROUP_CUSTOMER_YYYYMMDD',0,-1,'跨省集团用户表','-','TR1_BOSS',2,'-');	



select * from   bass2.ODS_ENT_PAR_GROUP_CUSTOMER_20111011

select * from   bass2.USYS_TABLE_MAINTAIN 
where table_id = 11047


bass2.USYS_TABLE_MAINTAIN
update bass2.USYS_TABLE_MAINTAIN
set table_id = 11048
where table_id = 11047


update bass2.USYS_TABLE_MAINTAIN
set table_id = 11047
where table_id = 11048
and TABLE_NAME not like '%ODS_ENT_PAR_GROUP_CUSTOMER%'


select * from   g_a_02004_day where imsi <> '' or imsi <> '0'

select distinct imsi from g_a_02004_day

select * from   bass2.dw_product_bass1_20111011

select time_id,count(0) from   g_a_02011_day
group by time_id



    select BUSI_CODE,count(0) from 
    (
    select USER_ID,BUSI_CODE,row_number()over(partition by user_id order by INVALID_DATE desc ,VALID_DATE desc ) rn 
    from   g_a_02011_day
    where VALID_DATE <='20111011'
    and INVALID_DATE > '20111011'
    ) t where rn = 1
    group by BUSI_CODE

select * from   bass1.g_a_02004_02008_stage


select substr(value(a.imsi,'x'),1,3) ,b.USERTYPE_ID, count(0)
from  bass2.dw_product_bass1_20111011 a,bass1.g_a_02004_02008_stage  b where a.user_id = b.user_id
group by  substr(value(a.imsi,'x'),1,3),b.USERTYPE_ID



select substr(value(imsi,'x'),1,3) ,BRAND_ID, count(0)
from  bass2.dw_product_bass1_20111011
where     userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9)
group by  substr(value(imsi,'x'),1,3),BRAND_ID



select substr(value(imsi,'x'),1,3) , count(0)
from  bass2.dw_product_20111011
where     userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9)
group by  substr(value(imsi,'x'),1,3)

select *
from   bass2.dw_product_20111011
where     userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9)
  and imsi is null
  
  
  
   select      20111012 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
             ,char(b.CANCEL_BUSI_CNT)    CANCEL_BUSI_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201110 a ,
              (select  replace(char(date(a.create_date)),'-','') op_time
                                                ,count(0) CANCEL_BUSI_CNT
                       from   
                        BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201110 a
                        where replace(char(date(a.create_date)),'-','') =  '20111012'  
                        group by replace(char(date(a.create_date)),'-','')
                    ) b 
        where replace(char(date(a.create_date)),'-','') = '20111012' 
                                and    replace(char(date(a.create_date)),'-','') = b.op_time
                                
BASS1_G_S_22080_DAY.tcl	BASS2_Dw_three_item_stat_dm.tcl

select tabname from syscat.tables where tabname like '%THREE_ITEM%'   
                                
                                select count(0) from   bass2.ODS_THREE_ITEM_STAT_20111012
                                where op_time = '2011-10-12'
select count(0) from    BASS1.G_S_22080_DAY                                 
where time_id = 2011012


select count(0) from     BASS2.DW_PRODUCT_UNITE_CANCEL_ORDER_DM_201110  a
where  replace(char(date(a.create_date)),'-','') ='20111012' 



   select      20111012 TIME_ID
             ,replace(char(date(a.create_date)),'-','') op_time
             ,char(a.TYCX_QUERY)             qry_cnt
             ,char(a.TYCX_TUIDING)           cancel_cnt
             ,char(a.TYCX_TUIDING_FAIL)      cancel_fail_cnt
             ,char(a.TYCX_TOUSU_LIANG)       complaint_cnt
             --,char(b.CANCEL_BUSI_CNT)    CANCEL_BUSI_CNT
        from  bass2.DW_THREE_ITEM_STAT_DM_201110 a 
        where replace(char(date(a.create_date)),'-','') = '20111012' 
                                and    replace(char(date(a.create_date)),'-','') = '20111012'  
select count(0) from     bass2.DW_THREE_ITEM_STAT_DM_201110 a 
where op_time = '2011-10-12'
select count(0) from     bass2.DW_THREE_ITEM_STAT_DM_201110 a 
where date(create_date)  = '2011-10-12'

where  replace(char(date(a.create_date)),'-','') = '20111012' 


                SELECT 
                 date('2011-10-12') OP_TIME,
                TYCX_QUERY,
                TYCX_TUIDING,
                TYCX_TUIDING_FAIL,
                TYCX_TUIDING_AVG,
                TYCX_FIRST20_BUSI_NAME,
                TYCX_TOUSU_LIANG,
                KOUFEI_TIXING,
                KOUFEI_DXHFL,
                KOUFEI_REXWH,
                KOUFEI_TUIDINGL,
                KOUFEI_TDFIRST20_NAME,
                KOUFEI_TOUSU_LIAN,
                MW_SHOULILIANG,
                MW_TUIFEI,
                MW_ZYFIRST20_NAME,
                CREATE_DATE
        FROM bass2.ODS_THREE_ITEM_STAT_20111012 
              where date(create_date)  = '2011-10-12'


select * from g_s_22080_day
where time_id = 20111012


select deadline,count(0) from   BASS1.MON_ALL_INTERFACE 
where type = 'm' and sts=1
group by deadline


select tabname from syscat.tables where tabname like '%G_A_02004_DAY%'   





CREATE TABLE "BASS1   "."G_A_02004_DAY_1"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

select * from   bass2.dw_product_bass1_20111012


select count(0) from    g_a_02004_day
select * from   bass2.dim_prod_up_product_item
where name like '%车务通%'
and 

select product_item_id,count(0) from 
bass2.dw_product_ins_off_ins_prod_201107 a,(select * from   bass2.dim_prod_up_product_item
where name like '%车务通%') b 
where a.offer_id = b.product_item_id
group by product_item_id

112001005701	1102



where product_instance_id = '89657334006025'
and offer_id = 112001005701

select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701


select * from   bass2.dim_prod_up_product_item
where 
PRODUCT_ITEM_ID in (
111090009395
,111090009396
,111090009400
,111307100850
,111307100851
,111307101274
,111307101328
,111307101334
,111308000180
,112001005701
)

PRODUCT_ITEM_ID	EXTEND_ID	NAME	ITEM_TYPE	DEL_FLAG	CREATE_DATE	EFF_DATE	EXP_DATE	SUPPLIER_ID	PROVIDER_TYPE	BUSINESS_DOMAIN_ID	PLATFORM_ID	EXTEND_ID2
111090009395	90009395	车务通70元语音套餐	OFFER_PLAN	1	2010-01-06 11:15:25.000000	2008-06-15 0:00:00.000000	2099-12-31 23:59:59.000000	[NULL]	[NULL]	Y	1	[NULL]
111090009396	90009396	车务通100元语音套餐	OFFER_PLAN	1	2010-01-06 11:15:25.000000	2008-06-15 0:00:00.000000	2099-12-31 23:59:59.000000	[NULL]	[NULL]	Y	1	[NULL]
111090009400	90009400	车务通40元语音套餐	OFFER_PLAN	1	2010-03-11 11:17:11.000000	2010-01-27 0:00:00.000000	2099-12-31 23:59:59.000000	[NULL]	[NULL]	Y	1	[NULL]
111307100850	[NULL]	预存900元车务通专款,800元购机费送车务通终端	OFFER_PLAN	1	2010-06-13 11:59:11.000000	2009-09-09 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	Y	1	[NULL]
111307100851	[NULL]	预存1956元车务通专款送车务通终端,捆绑70元语音促销	OFFER_PLAN	1	2010-06-13 11:59:11.000000	2009-09-09 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	Y	1	[NULL]
111307101274	[NULL]	预存话费1956元,捆绑车务通40元语音套餐2年	OFFER_PLAN	1	2010-06-13 11:59:11.000000	2009-09-09 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	0895	1	[NULL]
111307101328	[NULL]	预存98元车务通专款,捆绑70元语音促销	OFFER_PLAN	1	2010-06-13 11:59:11.000000	2009-09-09 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	0892	1	[NULL]
111307101334	[NULL]	按月预存128元车务通专款,捆绑100元语音促销	OFFER_PLAN	1	2010-07-16 22:11:40.000000	2009-12-31 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	Y	1	[NULL]
111308000180	[NULL]	林芝车务通-两年活动，每次预存960，免车务通终端	OFFER_PLAN	1	2010-07-31 22:15:51.000000	2009-12-31 0:00:00.000000	2099-12-31 0:00:00.000000	[NULL]	[NULL]	0894	1	[NULL]
112001005701	1005701	本省车务通	OFFER_PLAN	1	2010-01-16 11:25:18.000000	2010-01-16 0:00:00.000000	2099-12-31 23:59:59.000000	[NULL]	[NULL]	Y	2	[NULL]




select product_item_id,count(0) from 
bass2.dw_product_ins_off_ins_prod_his_201107 a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id
group by product_item_id




select a.* from 
bass2.dw_product_ins_off_ins_prod_his_201107 a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id

select tabname from syscat.tables where tabname like '%INS_OFF_INS_PROD_HIS%'   

BASS2_Dw_product_ins_off_ins_prod_his_ms.tcl

select * from   app.sch_control_runlog_his where control_code like '%_ins_prod_res_ds.tcl'                                        
select * from   app.sch_control_runlog_his where control_code like '%bass1%.tcl'
select tabname from syscat.tables where tabname like upper('%product_bass1%'   )
DW_PRODUCT_BASS1_20110915

select a.* from 
bass2.dw_product_ins_off_ins_prod_ds a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id


PRODUCT_INSTANCE_ID	PRODUCT_SPEC_ID	OFFER_ID
89160001177456	172000000942	112001005701





select a.* from 
bass2.dw_product_ins_off_ins_prod_201109 a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id
and PRODUCT_INSTANCE_ID = '89160001177456'
DONE_CODE	CREATE_DATE	DONE_DATE	VALID_DATE	EXPIRE_DATE
300063930487	2011-08-03 	2011-08-19 	2011-08-03 	2099-12-31 

select a.* from 
bass2.dw_product_ins_off_ins_prod_ds a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id
and PRODUCT_INSTANCE_ID = '89160001177456'
DONE_CODE	CREATE_DATE	DONE_DATE	VALID_DATE	EXPIRE_DATE
300071438408	2011-08-03 15:29:23.000000	2011-10-11 11:03:57.000000	2011-08-03 15:26:23.000000	2099-12-31 23:59:59.000000


89160001149844

select a.* from 
bass2.dw_product_ins_off_ins_prod_201107 a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112001005701) b 
where a.offer_id = b.product_item_id
and PRODUCT_INSTANCE_ID = '89260000361561'


select * from   bass2.dw_PRODUCT_20111012 
WHERE PLAN_ID =1005701

1005701


PLAN_ID = 112001005701
AND 


89260000361561

select count(0) from   BASS2.ODS_INS_PROD_RES_20111012 





select 
         20110812 TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,'2' STATUS_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1330'
                 --and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
and    ENTERPRISE_ID  in (select ENTERPRISE_ID from bass2.DIM_TEST_ENTERPRISE)             




                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201109
                                and ent_busi_id = '1330'
) t 
                 

197885.01000000000
                 
                 
                                select sum(income)*1.00/100 income
                                from (
                                select sum(bigint(income)) income from   g_s_03017_month
                                where time_id = 201108
                                and ent_busi_id = '1330'
) t 
                 
253370.81000000000

                 

select 
	count(0)
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201109 and ENTERPRISE_BUSI_TYPE = '1330'
                 --and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'

                 

910	企信通(ADC)	172000000910	企信通(ADC)	112091001001	企信通(ADC)	2	1	0	集团订购，集团付费

                 
select count(0),count(distinct PRODUCT_INSTANCE_ID)  from 
bass2.dw_product_ins_off_ins_prod_201109 a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112091001001) b 
where a.offer_id = b.product_item_id
and PRODUCT_INSTANCE_ID = '89260000361561'
25873	22256

select count(0),count(distinct PRODUCT_INSTANCE_ID)  from 
bass2.dw_product_ins_off_ins_prod_ds a,(select * from   bass2.dim_prod_up_product_item
where product_item_id = 112091001001) b 
where a.offer_id = b.product_item_id
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-10-20'


25766	22149
25508	21975

select * from   bass2.dim_prod_up_product_item
where product_item_id = 112091001001

select a.*  from 
bass2.dw_product_ins_off_ins_prod_201109 a,(select * from   bass2.dim_prod_up_product_item where product_item_id = 112091001001) b 
where a.offer_id = b.product_item_id
and product_spec_id = 172000000910
and expire_date >= '2011-10-01'



select count(0),count(distinct RES_EQU_NO2 ),count(distinct INST_PRODUCT_ID)  from    (                 

select INST_PRODUCT_ID,RES_EQU_NO2 from   BASS2.ODS_INS_PROD_RES_20111012 
where VALID_DATE <EXPIRE_DATE
and  date(EXPIRE_DATE) >= '2011-10-13'  
and RES_EQU_NO2 is not null

) t


select STATE,count(0),count(distinct RES_EQU_NO2 ) from    (                 

select INST_PRODUCT_ID,RES_EQU_NO2,STATE from   BASS2.ODS_INS_PROD_RES_20111012 
where VALID_DATE <EXPIRE_DATE
and  date(EXPIRE_DATE) >= '2011-10-13'  
and RES_EQU_NO2 is not null

) t
group by STATE

STATE	2	3
1	1828621	1827677
3	896287	896286



select count(0),count(distinct RES_EQU_NO2 ),count(distinct INST_PRODUCT_ID)  from    (                 

select INST_PRODUCT_ID,RES_EQU_NO2 from   BASS2.ODS_INS_PROD_RES_20111012 
where VALID_DATE <EXPIRE_DATE
and  date(EXPIRE_DATE) >= '2011-10-13'  
and RES_EQU_NO2 is not null

) t



select count(0) from    g_a_02004_02008_stage a 
, (                 

select INST_PRODUCT_ID,RES_EQU_NO2 from   BASS2.ODS_INS_PROD_RES_20111012 
where VALID_DATE <EXPIRE_DATE
and  date(EXPIRE_DATE) >= '2011-10-13'  
and RES_EQU_NO2 is not null

) t where a.user_id = char(INST_PRODUCT_ID)




 declare global temporary table session.imsi
                      (
        INST_PRODUCT_ID              VARCHAR(20)         
        ,RES_EQU_NO2                 VARCHAR(64)     
                      )
                      partitioning key
                      (INST_PRODUCT_ID)
                      using hashing
                      with replace on commit preserve rows not logged in tbs_user_temp
                      
                      select * from bass2.dw_vpmn_member_201109 where vpmn_id = '89108911007801'

insert into  session.imsi
select char(INST_PRODUCT_ID),RES_EQU_NO2 from   BASS2.ODS_INS_PROD_RES_20111012 
where VALID_DATE <EXPIRE_DATE
and  date(EXPIRE_DATE) >= '2011-10-13'  
and RES_EQU_NO2 is not null

 create index  session.ind_imsi on session.imsi(INST_PRODUCT_ID) 
 
 
 
select count(0) from    g_a_02004_02008_stage a 
, session.imsi t where a.user_id = char(INST_PRODUCT_ID)

2722852

2724807


select * from   G_I_GCIDIM006_DAY

select * from    BASS1.G_I_GCI01_DAY

select INDUSTRY_ID||INDUSTRY_NAME from BASS1.G_I_GCI01_DAY where time_id=20111013

select count(distinct a.user_id),count(distinct b.user_id )
from 
(
select * from   
G_I_02022_DAY  a
where time_id = 20111013 and VALID_DT = '20111013'
) a
left join (
select  * from 
G_S_02024_DAY
where time_id >= 20110901 and time_id <= 20111013 
) b on a.USER_ID = b.USER_ID and a.BASE_PKG_ID= b.BASE_PKG_ID



select * from   G_S_02024_DAY
where char(TIME_ID) <>REC_DT

select (bigint(NEW_USER_CNT))
from G_S_22091_DAY
where time_id / 100 = 201109

select time_id ,DEAL_DATE, sum(bigint(NEW_USER_CNT))
from G_S_22091_DAY
where time_id / 100 = 201110
group by time_id,DEAL_DATE

select sum(bigint(NEW_USER_CNT))
from G_S_22091_DAY
where time_id / 100 = 201110


select sum(bigint(NEW_USER_CNT))
from G_S_22091_DAY
where time_id / 100 = 201110


170126
select count(0) from    int_02004_02008_month_stage
where bigint(CREATE_DATE)/100 = 201109

89285

select count(0)     
			from bass2.dw_product_20110901
			where DAY_NEW_MARK = 1
and USERTYPE_ID in (1,2,9)
and USERSTATUS_ID in (1,2,3,6,8)

1986
            
            3662

select sum(bigint(NEW_USER_CNT)) from   G_S_22091_DAY where time_id = 20110901

9545


       4967     
       

select NEW_USER_CNT from   G_S_22091_DAY where time_id = 20110901

       

select channel_id,count(0)     
			from bass2.dw_product_20110901
			where DAY_NEW_MARK = 1
and USERTYPE_ID in (1,2,9)
and USERSTATUS_ID in (1,2,3,6,8)
group by channel_id

       

			select channel_id
						,count(1)
			from bass2.dw_product_20110901
			where DAY_NEW_MARK = 1
			group by Channel_ID


select * from   G_S_22091_DAY_1
            

select count(0),count(distinct CHANNEL_ID ) from    bass2.Dim_channel_info 

select count(0),count(distinct CHANNEL_ID||DEAL_TYPE ) from    G_S_22091_DAY_1            

select count(0) from    (

        SELECT
           20111013
                ,'20111013'
                ,trim(char(a.CHANNEL_ID)) CHANNEL_ID
                ,b.ACCEPT_TYPE
                ,char( sum( b.NEW_USERS ))
                ,char( sum( b.HAND_CNT        ))
                ,char( sum( b.HAND_FEE        ))
                ,char( sum( b.CARD_SALE_CNT   ))
                ,char( sum( b.ACCEPT_CNT      ))
                ,char( sum( b.VAL_OPEN_CNT    ))
                ,char( sum( b.IMP_ACCEPT_CNT  ))
                ,char( sum( b.TERM_SALE_CNT   ))
                ,char( sum( b.OTHER_SALE_CNT  ))
                ,char( sum( b.ACCEPT_BAS_CNT  ))
                ,char( sum( b.QUERY_BAS_CNT   ))
        FROM bass2.Dim_channel_info A
        inner join G_S_22091_DAY_TMP_1 b on a.organize_id = b.channel_id
        WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
        and a.channel_type <> 90886
        and char(b.channel_id) not in (select CHANNEL_ID from G_S_22091_DAY  where time_id = 20111013 )
        group by trim(char(a.CHANNEL_ID))
                ,b.ACCEPT_TYPE
)  a ,    (
        SELECT
           20111013
                ,'20111013'
                ,trim(char(a.CHANNEL_ID)) CHANNEL_ID
                ,b.ACCEPT_TYPE
                ,char( sum( b.NEW_USERS                         ))
                ,char( sum( b.HAND_CNT        ))
                ,char( sum( b.HAND_FEE        ))
                ,char( sum( b.CARD_SALE_CNT   ))
                ,char( sum( b.ACCEPT_CNT      ))
                ,char( sum( b.VAL_OPEN_CNT    ))
                ,char( sum( b.IMP_ACCEPT_CNT  ))
                ,char( sum( b.TERM_SALE_CNT   ))
                ,char( sum( b.OTHER_SALE_CNT  ))
                ,char( sum( b.ACCEPT_BAS_CNT  ))
                ,char( sum( b.QUERY_BAS_CNT   ))
        FROM bass2.Dim_channel_info A
        inner join G_S_22091_DAY_TMP_1 b on a.channel_id=b.channel_id
        WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
        and a.channel_type <> 90886
        group by trim(char(a.CHANNEL_ID))
                ,b.ACCEPT_TYPE
                ) b where a.CHANNEL_ID = b.CHANNEL_ID
                
                
                select sum(bigint(NEW_USER_cnt)) from G_S_22091_DAY where time_id = 20111016
                
                
select count(0) from    bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110


update (select * from     G_S_22091_DAY where time_id = 20111016) 
set NEW_USER_cnt = '1'
where NEW_USER_cnt > '1'
select sum(bigint(NEW_USER_cnt)) from G_S_22091_DAY where time_id = 20111016




select * from   BASS2.ODS_PRODUCT_INS_OFF_INS_PROD_HIS_20111016


select sum(bigint(NEW_USER_CNT))
from G_S_22091_DAY
where time_id / 100 = 201110

select count(distinct user_id) chnl_new_cnt,count(0) from    bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110


select a.chnl_new_cnt,b.all_cnt
from (
select count(distinct user_id) chnl_new_cnt from    bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110
) a ,
(
select sum(bigint(NEW_USER_CNT)) all_cnt
from G_S_22091_DAY
where time_id / 100 = 201110
) b where 1 = 1



select b.chnl_new_cnt,a.all_cnt , b.chnl_new_cnt*1.00/a.all_cnt
from (
select count(distinct user_id) all_cnt from    bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110
) a ,
(
select sum(bigint(NEW_USER_CNT)) chnl_new_cnt 
from G_S_22091_DAY
where time_id / 100 = 201110
) b where 1 = 1



select CHANNEL_ID , count(0) 
--,  count(distinct CHANNEL_ID ) 
from bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110
group by  CHANNEL_ID 
order by 1 

select CHANNEL_ID from   bass1.G_I_06021_MONTH
where time_id = 201109
and CHANNEL_STATUS ='1'


select no_chnl_cnt,all_cnt,no_chnl_cnt*1.00/all_cnt
from (
select  count(0) no_chnl_cnt
--,  count(distinct CHANNEL_ID ) 
from bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110
and (CHANNEL_ID  in ('BASS1_WB','BASS1_HL','BASS1_SM','BASS1_WP','BASS1_ST','BASS1_DS')
or  CHANNEL_ID  in (
select CHANNEL_ID from   bass1.G_I_06021_MONTH
where time_id = 201109
and CHANNEL_STATUS ='1'
	) )
) a,(
select count(distinct user_id) all_cnt from    bass1.g_a_02004_02008_stage 
where bigint(create_date)/100 = 201110
) b where 1 = 1 





    select fee1+fee2 ,fee3+fee4+fee5,(fee1+fee2)*1.00/(fee3+fee4+fee5)
from 
(
select sum(bigint(CHRG_REC_FEE)) fee1 from G_S_22066_DAY
where time_id / 100 = 201109
) a,
(
select sum(bigint(BNK_TS_FEE)) fee2 from G_S_22068_MONTH
where time_id  = 201109
) b,
(
select sum(bigint(PAYMENT_REC_FEE)) fee3 from G_S_22091_DAY
where time_id/100  = 201109
and DEAL_TYPE = '1'
) c,
(
select sum(bigint(CHRG_AMT))  fee4 from G_S_22048_DAY
where time_id/100  = 201109
) d,
(
select sum(bigint(COUNTER_REC_FEE)+bigint(EBANK_REC_FEE)+bigint(OTH_REC_FEE)) fee5 from G_S_22068_MONTH
where time_id  = 201109
) e






select fee1+fee2 ,fee3+fee4+fee5,(fee1+fee2)*1.00/(fee3+fee4+fee5)
from 
(
select sum(bigint(CHRG_REC_FEE)) fee1 from G_S_22066_DAY
where time_id / 100 = 201110
) a,
(
select sum(bigint(BNK_TS_FEE)) fee2 from G_S_22068_MONTH
where time_id  = 201110
) b,
(
select sum(bigint(PAYMENT_REC_FEE)) fee3 from G_S_22091_DAY
where time_id/100  = 201110
and DEAL_TYPE = '1'
) c,
(
select sum(bigint(CHRG_AMT))  fee4 from G_S_22048_DAY
where time_id/100  = 201110
) d,
(
select sum(bigint(COUNTER_REC_FEE)+bigint(EBANK_REC_FEE)+bigint(OTH_REC_FEE)) fee5 from G_S_22068_MONTH
where time_id  = 201110
) e






select fee1+fee2 ,fee3+fee4+fee5,(fee1+fee2)*1.00/(fee3+fee4+fee5)
from 
(
select sum(bigint(CHRG_REC_FEE)) fee1 from G_S_22066_DAY
where time_id / 100 = 201108
) a,
(
select sum(bigint(BNK_TS_FEE)) fee2 from G_S_22068_MONTH
where time_id  = 201108
) b,
(
select sum(bigint(PAYMENT_REC_FEE)) fee3 from G_S_22091_DAY
where time_id/100  = 201108
and DEAL_TYPE = '1'
) c,
(
select sum(bigint(CHRG_AMT))  fee4 from G_S_22048_DAY
where time_id/100  = 201108
) d,
(
select sum(bigint(COUNTER_REC_FEE)+bigint(EBANK_REC_FEE)+bigint(OTH_REC_FEE)) fee5 from G_S_22068_MONTH
where time_id  = 201108
) e




CREATE TABLE "BASS2   "."DW_INS_PROD_RES_IMSI_DS"  (
                  "USER_ID" VARCHAR(20) 
                  , "IMSI" VARCHAR(64)  
                 
 )   
                 DISTRIBUTE BY HASH("USER_ID")   
                   IN "TBS_3H" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 



select count(0),count(distinct user_id ) from    bass2.DW_PRODUCT_INS_PROD_RES_IMSI_DS

insert into app.sch_control_before
values ('BASS2_Dw_product_bass1_ds.tcl','BASS2_Dw_product_ins_prod_res_ds.tcl')



select count(0),count(distinct imsi ) from     bass2.dw_product_bass1_20111018
4786360	3478349
4786360	4756897
4788969	4759499



select count(0) ,count(distinct user_id) from    g_a_02004_day where time_id = 20111018

2608
2608	2608


 select * from    g_a_02004_day where time_id = 20111018
 
 
                      select
                       20111018
                       ,a.user_id
                       ,a.cust_id
                       ,case 
                         when a.test_mark=1 then '3' 
                         when a.free_mark=1 then '2'
                         else '1' 
                        end
                       ,replace(char(create_date),'-','')
                       ,'01'
                       ,a.product_no
                       ,a.imsi
                       ,coalesce(bass1.fn_get_all_dim('BASS_STD1_0054',char(a.city_id)),'13101')
                       ,char(a.channel_id)
                       ,'1'
                                       ,case
                                         when a.accttype_id=0 then '1'
                                         else '2'
                                        end
                       ,'04'
                       ,b.brand_id
                       ,case 
                         when a.crm_brand_id2=70 then '1' 
                         else '0' 
                        end
                     from 
                       bass2.dw_product_bass1_20111018 a,
                       (
                        select 
                          * 
                        from 
                          BASS1.INT_02004_02008_201110 
                        where
                          op_time=20111018
                          and brand_flag=1
                       )b              
                     where 
                       a.user_id = b.user_id 





select 
         a.TIME_ID
        ,a.USER_ID
        ,a.CUST_ID
        ,a.USERTYPE_ID
        ,a.CREATE_DATE
        ,a.USER_BUS_TYP_ID
        ,a.PRODUCT_NO
        ,b.IMSI
        ,a.CMCC_ID
        ,a.CHANNEL_ID
        ,a.MCV_TYP_ID
        ,a.PROMPT_TYPE
        ,a.SUBS_STYLE_ID
        ,a.BRAND_ID
        ,a.SIM_CODE
from 	
(
select 
        20111019 TIME_ID
        ,USER_ID
        ,CUST_ID
        ,USERTYPE_ID
        ,CREATE_DATE
        ,USER_BUS_TYP_ID
        ,PRODUCT_NO
        ,IMSI
        ,CMCC_ID
        ,CHANNEL_ID
        ,MCV_TYP_ID
        ,PROMPT_TYPE
        ,SUBS_STYLE_ID
        ,BRAND_ID
        ,SIM_CODE
    ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20111018 ) a
, bass2.dw_product_bass1_20111018 b
where a.row_id = 1
and a.user_id = b.user_id
and a.user_id not in (select user_id from g_a_02004_day where time_id = 20111019)

                       

CREATE TABLE "BASS1   "."G_A_02004_DAY_IMSI"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "CUST_ID" CHAR(20) NOT NULL , 
                  "USERTYPE_ID" CHAR(1) NOT NULL , 
                  "CREATE_DATE" CHAR(8) NOT NULL , 
                  "USER_BUS_TYP_ID" CHAR(2) NOT NULL , 
                  "PRODUCT_NO" CHAR(15) NOT NULL , 
                  "IMSI" CHAR(15) NOT NULL , 
                  "CMCC_ID" CHAR(5) NOT NULL , 
                  "CHANNEL_ID" CHAR(40) NOT NULL , 
                  "MCV_TYP_ID" CHAR(1) NOT NULL , 
                  "PROMPT_TYPE" CHAR(1) NOT NULL , 
                  "SUBS_STYLE_ID" CHAR(2) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "SIM_CODE" CHAR(1) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select length(trim(imsi)),count(0)
from G_A_02004_DAY_IMSI
group by length(trim(imsi))



select length(trim(imsi)),count(0)
from G_A_02004_DAY
group by length(trim(imsi))


select * from  table( bass1.get_after('02004')) a 
where control_code like '%DAY%'


select * from app.sch_control_task where control_code in 
(select control_code from   app.sch_control_runlog where flag = 1 )
and cc_flag = 1


select a.*  from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 112091001001
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-10-20'


select a.*  from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 112091001001
and product_spec_id = 172000000910
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-10-20'




select ENTERPRISE_ID from 
table(
select 
	TIME_ID
        ,ENTERPRISE_ID
        ,ENTERPRISE_BUSI_TYPE
        ,MANAGE_MODE
        ,ORDER_DATE
        ,STATUS_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201110 and ENTERPRISE_BUSI_TYPE = '1330'
                 --and MANAGE_MODE = '3'
                ) t 
	) t2 where rn = 1 and STATUS_ID ='1'
) t 
except
select product_instance_id  from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 112091001001
and product_spec_id = 172000000910
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-10-20'


select count(0) from    G_A_02054_DAY
where time_id = 20111019
223

657



select  distinct CUST_PARTY_ROLE_ID
from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 112001005701
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-10-20'
group by PRODUCT_SPEC_ID



171000000001	1063
172000000942	74



select * from   bass2.dim_prod_up_product_item
where
product_item_id  in (171000000001,172000000942,112001005701)


 select * from bass2.ODS_PROD_UP_ITEM_RELAT_20111018 where prod_item_relat_kind_id ='OFFER_PLAN_GENERAL_PRODUCT_SPEC'
 
 
 			select count(0)
                from 
                (
			select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
			from (
			select *
			from g_a_02054_day 
			where  ENTERPRISE_BUSI_TYPE = '1241'
			) t 
		) t2 
		where rn = 1 
			and STATUS_ID ='1'
            


select product_no
from 
(
select a.*,row_number()over(partition by user_id order by time_id desc  ) rn 
 from   G_A_02062_DAY a 
where ENTERPRISE_BUSI_TYPE = '1241'
and time_id <= 20110831
) t 
where t.rn = 1
and STATUS_ID = '1'

            


select length(trim(imsi)) length, count(0)  cnt
--,  count(distinct length(imsi) ) 
from g_a_02004_02008_stage 
group by  length(trim(imsi)) 
order by 1 

1	2
1	1551
15	2753784


select length(trim(imsi)) length, count(0)  cnt
,sum(case when imsi like '460%' then 1 else 0 end ) cnt460 
--,  count(distinct length(imsi) ) 
from g_a_02004_02008_stage 
group by  length(trim(imsi)) 
order by 1 
LENGTH	CNT	CNT460
1	1552	0
15	2756036	2756036



            
LENGTH	CNT
1	1551
15	2753784

            
            select * from  table( bass1.get_after('BASS1_INT_CHECK_Z345_DAY.tcl')) a 

select * from    G_S_22036_MONTH



select * from   bass2.dim_bs_enterprise_customer_code a
where  a.service_code like '10657%' 

SEL  BASS2.DIM_NEWBUSI_SPINFO
select * from    BASS2.DIM_NEWBUSI_SPINFO


select * from   bass2.DW_ENTERPRISE_SUB_ds




 select a.TIME_ID, a.BILL_MONTH, a.CUST_TYPE, a.EC_CODE, a.SINAME, 
                       a.OPERATE_TYPE, a.APP_LENCODE, a.APNCODE ,service_name,open_date,sts
                from
                (       
select distinct 
 20111026   TIME_ID,
'$curr_month'          BILL_MONTH,
'0'                  CUST_TYPE,
b.enterprise_id      EC_CODE,
''                   SINAME,        
case 
when c.oper_code like 'QXZ%' then '1'
when c.oper_code like 'M%' then '1'
else '2'
end as              OPERATE_TYPE,
a.service_code      APP_LENCODE,
'' APNCODE
,e.service_name
,replace(char(date(a.valid_date)),'-','') open_date
,case when replace(char(date(a.expire_date)),'-','') > '20111026' then '1' else '2' end  sts
,row_number()over(partition by a.service_code order by b.enterprise_id desc) row_id
    from bass2.dim_bs_enterprise_customer_code a,
	 bass2.DW_ENTERPRISE_SUB_ds b,
	     bass2.dw_newbusi_ismg_20111026 c,
	     BASS2.DIM_NEWBUSI_SPINFO d ,
		bass2.dim_enterprise_product e 
   where a.user_billing_id = b.bill_id
	 and a.service_code=c.ser_code
	   and c.sp_code = d.sp_code
	    and b.service_id = e.service_id
	 and b.service_id in ('910','142','603','604','606','903','904','906','933') 
	   and a.service_code like '10657%' 
) a
                where a.row_id=1
with ur



select distinct apn_ni from  bass2.CDR_GPRS_LOCAL_20111025

APN_NI
BLACKBERRY.NET
CMCWT
CMDM
CMMM
CMNET
CMSIP
CMTDS
CMWAP
JIANHANG.XZ
NONGHANG.XZ
XZDL.XZ
ZHONGHANG.XZ


select tabname from syscat.tables where tabname like '%DIM%ENT%'   



select * from TABNAME
select * from bass2.DIM_AGENT_CODE
select * from bass2.DIM_APP_DEPARTMENT
select * from bass2.DIM_APP_ENTERPRISE_SCALE
select * from bass2.DIM_APP_NB_CALLMOMENT
select * from bass2.DIM_APP_NB_ENTER_NET_CHNL
select * from bass2.DIM_ARMY_ENTERPRISE
select * from bass2.DIM_BS_ENTERPRISE_CUSTOMER_CODE
select * from bass2.DIM_CALL_MOMENT
select * from bass2.DIM_CALL_MOMENT
select * from bass2.DIM_CLIENT_TYPE
select * from bass2.DIM_CLIENT_TYPE
select * from bass2.DIM_CONTENT_TYPE
select * from bass2.DIM_CS_EVENT_BUSITYPE_REL
select * from bass2.DIM_CS_EVENT_REASON
select * from bass2.DIM_DATAMINING_SEGMENT
select * from bass2.DIM_DEPARTMENT
select * from bass2.DIM_DEPARTMENT_BANK
select * from bass2.DIM_DEPARTMENT_TYPE
select * from bass2.DIM_ENT_ACTIVE_MASADC_LEVEL_ST
select * from bass2.DIM_ENT_ADC_TYPE_ST
select * from bass2.DIM_ENT_BASE_ALLEYWAY_ST
select * from bass2.DIM_ENT_BASE_GATE_TYPE
select * from bass2.DIM_ENT_CALL_COMPHOT_LEVEL
select * from bass2.DIM_ENT_CALL_SWBD_LEVEL_ST
select * from bass2.DIM_ENT_CHARGE_LEVEL
select * from bass2.DIM_ENT_CHURN_SCORE
select * from bass2.DIM_ENT_COMPETE_PAYTYPE
select * from bass2.DIM_ENT_COMPT_CLASS
select * from bass2.DIM_ENT_COMPT_TYPE
select * from bass2.DIM_ENT_CONE_LEVEL
select * from bass2.DIM_ENT_CONSUMELEV
select * from bass2.DIM_ENT_CONTRACT_BUSITYPE
select * from bass2.DIM_ENT_CREDIT_LEVEL
select * from bass2.DIM_ENT_EVALUATE_KPI
select * from bass2.DIM_ENT_EVALUATE_MKTFEE_IMPORT
select * from bass2.DIM_ENT_EVALUATE_PRETSCORE
select * from bass2.DIM_ENT_EVALUATE_RWDSCORE
select * from bass2.DIM_ENT_FAULT_TYPE
select * from bass2.DIM_ENT_FORM_LEVEL
select * from bass2.DIM_ENT_GROUP_PLAN
select * from bass2.DIM_ENT_GROUP_PLAN_20100825
select * from bass2.DIM_ENT_IMP_INDUSTRY_ST
select * from bass2.DIM_ENT_INCOME_ST
select * from bass2.DIM_ENT_INFO_INCOME_ST
select * from bass2.DIM_ENT_KEYMEM_FAV_TYPE
select * from bass2.DIM_ENT_KEYMEM_SALARY_LEVEL
select * from bass2.DIM_ENT_LINKER_LINK
select * from bass2.DIM_ENT_LOST_PREV_LEVEL
select * from bass2.DIM_ENT_MANAGER_ACCOSCHE_MM_S
select * from bass2.DIM_ENT_MANAGER_INDEX_D
select * from bass2.DIM_ENT_MANAGER_INDEX_M
select * from bass2.DIM_ENT_MANAGER_INDEX_S
select * from bass2.DIM_ENT_MANAGER_INDEX_T
select * from bass2.DIM_ENT_MAS_TYPE_ST
select * from bass2.DIM_ENT_MEMBER_INCOME_ST
select * from bass2.DIM_ENT_MEMBER_NUMS
select * from bass2.DIM_ENT_MEMCHURN_SCORE
select * from bass2.DIM_ENT_NUMS_CR_LEVEL_ST
select * from bass2.DIM_ENT_NUMS_LEVEL_ST
select * from bass2.DIM_ENT_PAY_TYPE_ST
select * from bass2.DIM_ENT_PAYTYPE
select * from bass2.DIM_ENT_PLATFORM_TYPE_ST
select * from bass2.DIM_ENT_PROCASE
select * from bass2.DIM_ENT_PROD_ST
select * from bass2.DIM_ENT_PRODTYPE
select * from bass2.DIM_ENT_REFER_TYPE
select * from bass2.DIM_ENT_SCORE_LEVEL
select * from bass2.DIM_ENT_SERVICE_CONFIG
select * from bass2.DIM_ENT_SINENT_MULTI_ANAL_M_T
select * from bass2.DIM_ENT_SINENT_MULTI_ANAL_T
select * from bass2.DIM_ENT_STABILITY_LEVEL
select * from bass2.DIM_ENT_STATUS
select * from bass2.DIM_ENT_SUBPRO_TYPE
select * from bass2.DIM_ENT_UNIPAY_INCOME_ST
select * from bass2.DIM_ENT_UNIPAY_INFO_INCOME_ST
select * from bass2.DIM_ENT_UNIPAY_ITEM
select * from bass2.DIM_ENT_UNIPAY_ITEM_BAK
select * from bass2.DIM_ENT_UNIPAY_OFFER
select * from bass2.DIM_ENT_UNIPAY_OFFER_BAK
select * from bass2.DIM_ENT_USE_DURATION_LEVEL_ST
select * from bass2.DIM_ENT_USE_VPMN_RATE_ST
select * from bass2.DIM_ENT_VALUE_SCORE_ST
select * from bass2.DIM_ENT_VOCATION_APP_ST
select * from bass2.DIM_ENT_VPMN_LATENT_BRAND
select * from bass2.DIM_ENT_VPMN_LATENT_RESULT
select * from bass2.DIM_ENTACCT_ITEM
select * from bass2.DIM_ENTCSTSIG_TYPE_ST
select * from bass2.DIM_ENTEMP_AVERCONSLVL_ST
select * from bass2.DIM_ENTERPRISE_0024_S
select * from bass2.DIM_ENTERPRISE_CONSUMELEV
select * from bass2.DIM_ENTERPRISE_GROUP_LEVEL
select * from bass2.DIM_ENTERPRISE_GROUP_LEVEL
select * from bass2.DIM_ENTERPRISE_KPI
select * from bass2.DIM_ENTERPRISE_KPI_OLD
select * from bass2.DIM_ENTERPRISE_KPI_TEST
select * from bass2.DIM_ENTERPRISE_KPITYPE
select * from bass2.DIM_ENTERPRISE_KPITYPE_OLD
select * from bass2.DIM_ENTERPRISE_LEV
select * from bass2.DIM_ENTERPRISE_LEVEL
select * from bass2.DIM_ENTERPRISE_LEVEL
select * from bass2.DIM_ENTERPRISE_LEVEL
select * from bass2.DIM_ENTERPRISE_MANAGER
select * from bass2.DIM_ENTERPRISE_MANAGER
select * from bass2.DIM_ENTERPRISE_MANAGER_DM
select * from bass2.DIM_ENTERPRISE_MANAGER_DM_MODEL
select * from bass2.DIM_ENTERPRISE_MANAGER_MM
select * from bass2.DIM_ENTERPRISE_PHOLEV
select * from bass2.DIM_ENTERPRISE_PRODUCT
select * from bass2.DIM_ENTERPRISE_PRODUCT_TMP
select * from bass2.DIM_ENTERPRISE_TYPE
select * from bass2.DIM_ENTERPRISE_TYPE_TMP
select * from bass2.DIM_ENTMEMBER_CALL_INDEX
select * from bass2.DIM_ENTPROD_FEEITEM_ST
select * from bass2.DIM_ENTPRODUNCT_ST
select * from bass2.DIM_ENTSTD_ITEM
select * from bass2.DIM_EVENT_CLOSE
select * from bass2.DIM_EVENT_STATE
select * from bass2.DIM_LEAVE_ORIENTATION
select * from bass2.DIM_MAP_ENTERPRISE
select * from bass2.DIM_MTL_CONTENT_ITEM
select * from bass2.DIM_MTL_CONTENT_ITEM
select * from bass2.DIM_NET_EQUIPMENT
select * from bass2.DIM_NEWBUSI_CONTENT
select * from bass2.DIM_NG1_ENT_FLAG
select * from bass2.DIM_NG1_ENT_INDUSTRY
select * from bass2.DIM_NG1_ENT_INDUSTRY1
select * from bass2.DIM_NG1_ENT_INDUSTRY3
select * from bass2.DIM_NG1_ENT_MANAGER
select * from bass2.DIM_NG1_ENT_NUMS_PRODUCT_LEVEL
select * from bass2.DIM_NG1_ENT_ONLINE_LEVEL
select * from bass2.DIM_NG1_ENT_OWN_TYPE
select * from bass2.DIM_NG1_ENT_SCALE
select * from bass2.DIM_NG1_ENT_STATUS
select * from bass2.DIM_NG1_ENT_USE_DURATION_LEVEL
select * from bass2.DIM_NG1_ENTERPRISE
select * from bass2.DIM_NG1_ENTERPRISE_INDUSTRY
select * from bass2.DIM_NG2_ENT_HEALTH_SCORE_CONFIG
select * from bass2.DIM_NG3_ENTERPRISE_MEMBERLEV
select * from bass2.DIM_NG_RENT_PAYTYPE
select * from bass2.DIM_PAYMENT_DTL
select * from bass2.DIM_PAYMENT_RULE
select * from bass2.DIM_PRODUCT_LATENT_TYPE
select * from bass2.DIM_PUB_ENTERPRISE
select * from bass2.DIM_PUB_ENTERPRISE_891
select * from bass2.DIM_PUB_ENTERPRISE_EXT
select * from bass2.DIM_PUB_ENTERPRISE_EXT_20101119
select * from bass2.DIM_PUB_ENTERPRISE_EXT_2010BAK
select * from bass2.DIM_PUB_ENTERPRISE_EXT_2011
select * from bass2.DIM_PUB_ENTERPRISE_EXT_2011BAK
select * from bass2.DIM_PUB_ENTERPRISE_EXT_891
select * from bass2.DIM_PUB_ENTERPRISE_EXT_894
select * from bass2.DIM_PUB_ENTERPRISE_EXT_MODEL
select * from bass2.DIM_PUB_ENTERPRISE_TEMP
select * from bass2.DIM_PUB_ENTERPRISE_TEST892
select * from bass2.DIM_PUB_IDENTYPE
select * from bass2.DIM_PUB_MMSCONTENTTYPE
select * from bass2.DIM_PUB_REGION_PHOTO_ENT_891
select * from bass2.DIM_SERVICE_CONTENT
select * from bass2.DIM_STAT_ENTERPRISE_0023_S
select * from bass2.DIM_STAT_ENTERPRISE_0023_T
select * from bass2.DIM_TEST_ENTERPRISE
select * from bass2.DIM_URGENT_PAYMODE
select * from bass2.DIM_URGENT_PAYMODE_TMP
select * from bass2.DIM_XYSC_STUDENT_INFO
select * from bass2.IRP_DIM_ENT_DEF
select * from bass2.STAT_DIMREP_CONTENT
select * from bass2.STAT_DIMREP_CONTENT2
select * from bass2.V_DIM_ENT_MANAGER_INDEX_DM_MANAGER
select * from bass2.V_DIM_ENT_MANAGER_INDEX_MM_MANAGER
select * from bass2.V_DIM_ENTVPMN_LATENT_ENT
select * from bass2.V_DIM_ENTVPMN_LATENT_MANAGER

select tabname from syscat.tables where tabname like '%APN%' 



select * from   G_A_22036_DAY

select * from   bass2.DIM_ENT_SERVICE_CONFIG


select * from    bass2.dim_bs_enterprise_customer_code
select tabname from syscat.tables where tabname like '%DIM%SERVICE%'   

select * from   bass2.ODS_DIM_UP_SP_SERVICE_20111030
select * from   bass2.DIM_SERVICE_CONFIG

select * from   bass2.Ods_pm_sp_operator_code_20111030



select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 



select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 




select * from bass2.dim_enterprise_product B
WHERE b.service_id in ('910','142','603','604','606','903','904','906','933') 


select * from   BASS2.DIM_NEWBUSI_SPINFO

select * from   bass2.dw_product_ins_off_ins_prod_ds 
where IS_MAIN_OFFER = 1


select SERVICE_INSTANCE_ID,PRODUCT_INSTANCE_ID,service_id,attr_2,VALID_DATE,EXPIRE_DATE from   bass2.Dw_product_ins_srv_ds 
 where service_id=142000000910
 
fetch first 10 rows only  
select * from /**table**/ fetch first 10 rows only  


select * from   bass2.dw_product_ins_off_ins_prod_ds a
where OFFER_INST_PROD_INST_ID = 9109000063
fetch first 10 rows only  

select * from   bass2.dw_product_ins_prod_ds
fetch first 10 rows only  

select count(0),count(distinct char(SERVICE_INSTANCE_ID)||PRODUCT_INSTANCE_ID) from   bass2.Dw_product_ins_srv_ds  
where attr_2 is not null

36637956	26390544


select count(0),count(distinct char(SERVICE_INSTANCE_ID)||PRODUCT_INSTANCE_ID) from   bass2.Dw_product_ins_srv_ds  
where attr_2 is not null
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'

1140873	1140873


select *
from   bass2.Dw_product_ins_srv_ds   a
,bass2.dw_product_ins_off_ins_prod_ds  b 
where a.attr_2 is not null
and a.VALID_DATE <='2011-10-31'
and a.EXPIRE_DATE >='2011-10-31'
and a.SERVICE_INSTANCE_ID = b.OFFER_INST_PROD_INST_ID
and a.PRODUCT_INSTANCE_ID = b.PRODUCT_INSTANCE_ID




select tabname from syscat.tables where tabname like '%DIM%ENT%'   

select new_old_service_id from   bass2.Map_enterprise_product
where old_service_id in ('910','142','603','604','606','903','904','906','933') 



select count(0) from    bass2.dw_product_ins_off_ins_prod_ds  a
where PRODUCT_SPEC_ID in ( select new_service_id from   bass2.Map_enterprise_product
where old_service_id in ('910','142','603','604','606','903','904','906','933') 
)
and is_main_offer = 1
and exists (select 1 from 
(
select SERVICE_INSTANCE_ID from   bass2.Dw_product_ins_srv_ds  
where attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'
) b where a.OFFER_INST_PROD_INST_ID = b.SERVICE_INSTANCE_ID )



select count(0),count(distinct char(SERVICE_INSTANCE_ID)||PRODUCT_INSTANCE_ID) from   bass2.Dw_product_ins_srv_ds  
where service_id in (
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)
and attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'

select * from   bass2.dim_prod_up_product_item
where name like '%企信通%'
哦日


(
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)



select * from   bass2.Dw_product_ins_srv_ds  
where service_id in (
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)
and attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'
and product_instance_id = '89157334232511'

9249000005	89157334232511	142000000924	1	1	[NULL]	1	12971	2010-04-23 	2010-04-23 	2010-04-23 	2099-12-31 	10000329	91000178	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	8900022614	10650331000065	AXZ0010401	1	旺堆	wap.xzgzgs.cn	www.xzgzgs.cn	01	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	[NULL]	2	891	891


select * from bass2.dw_product_20111030
where user_id = '89157334232511'

USER_ID	CUST_ID	ACCT_ID	AGE	AGE_ID	SEX_ID	EDUCATION_ID	CUSTTYPE_ID	CUSTCLASS_ID	CREDIT	CREDIT_ID	PRODUCT_NO	IMSI	SIM_ID	SIM_TYPE	CITY_ID	CITY_ID1	COUNTY_ID	REGION_ID	CHANNEL_ID	CHANNELTYPE_ID	WARN_FEE	SO_NBR	ACCTTYPE_ID	USER_ONLINE	USER_ONLINE_ID	BRAND_ID	CRM_BRAND_ID1	CRM_BRAND_ID2	CRM_BRAND_ID3	PLAN_ID	USERSTATUS_ID	STOPSTATUS_ID	USERTYPE_ID	MONTH_NEW_MARK	MONTH_OFF_MARK	MONTH_RECREATE_MARK	MONTH_NEW_COUNT	MONTH_OFF_COUNT	MONTH_RECREATE_COUNT	DAY_NEW_MARK	DAY_OFF_MARK	DAY_RECREATE_MARK	DAY_CALL_MARK	MONTH_CALL_MARK	DAY_NEWBUSI_MARK	MONTH_NEWBUSI_MARK	ACTIVE_MARK	ZERO_MARK	MONTH_ACTIVE_MARK	MONTH_ZERO_MARK	VIP_MARK	SINGLE_MARK	VPMN_MARK	ENTERPRISE_MARK	IMPORT_ENT_MARK	FREE_MARK	TEST_MARK	BILL_MARK	SNAPSHOT_MARK	RECREATE_MARK	DAY_SMS_MARK	MONTH_SMS_MARK	DAY_P2P_SMS_MARK	MONTH_P2P_SMS_MARK	CREATE_DATE	VALID_DATE	STS_DATE	EXPIRE_DATE	CALL_COUNTS	CALL_DURATION	CALL_DURATION_M	CALL_DURATION_S	BASECALL_FEE	TOLL_FEE	INFO_FEE	OTHER_FEE	MTD_CALL_COUNTS	MTD_CALL_DURATION	MTD_CALL_DURATION_M	MTD_CALL_DURATION_S	MTD_BASECALL_FEE	MTD_TOLL_FEE	MTD_INFO_FEE	MTD_OTHER_FEE	BALANCE_FEE	OWE_FEE
89157334232511	89102999642997	89101003030640	0	1	9	0	2	0	0	0	8900022614	[NULL]	[NULL]	[NULL]	891	891	1089	10010003	91000178	4	[NULL]	-583647108	0	556	13	1	1	10	101	92401001	1	0	8	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	0	2010-04-23 	2010-04-23 	2010-04-23 	2099-12-31 	0	0	0	0	0.00	0.00	0.00	0.00	0	0	0	0	0.00	0.00	0.00	0.00	0.00	0.00

select * from    bass2.dw_product_ins_off_ins_prod_ds  
 where product_instance_id = '89157334232511'
 
 
 OP_TIME	OFFER_INST_PROD_INST_ID	OFFER_INSTANCE_ID	PRODUCT_INSTANCE_ID	PRODUCT_SPEC_ID	OFFER_ID	PRODUCT_INST_ROLE_ID	IS_MAIN_OFFER	VALID_TYPE	OPER_STATE	STATE	DONE_CODE	CREATE_DATE	DONE_DATE	VALID_DATE	EXPIRE_DATE	OP_ID	ORG_ID	EXT1	EXT2	EXT3	EXT4	GROUP_REGION_ID	CUST_PARTY_ROLE_ID	USER_REGION_ID	REGION_ID
2011-10-31 	9249000005	9240000005	89157334232511	172000000924	112092401001	182000000924	1	1	[NULL]	1	12971	2010-04-23 10:25:58.000000	2010-04-23 10:25:58.000000	2010-04-23 10:25:58.000000	2099-12-31 0:00:00.000000	10000329	91000178	[NULL]	[NULL]	[NULL]	891	0891	89102999642997	0891	0891


select count(0),count(distinct char(a.SERVICE_INSTANCE_ID)||a.PRODUCT_INSTANCE_ID) 
from   bass2.Dw_product_ins_srv_ds   a
,bass2.dw_product_ins_off_ins_prod_ds  b 
where a.attr_2 like '106%'
and a.VALID_DATE <='2011-10-31'
and a.EXPIRE_DATE >='2011-10-31'
and a.PRODUCT_INSTANCE_ID = b.PRODUCT_INSTANCE_ID
and a.service_id in (
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)

,
select SERVICE_INSTANCE_ID,PRODUCT_INSTANCE_ID,SERVICE_ID from   bass2.Dw_product_ins_srv_ds  
where service_id in (
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)
and attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'




select SERVICE_INSTANCE_ID,PRODUCT_INSTANCE_ID,SERVICE_ID,STATE,VALID_DATE,EXPIRE_DATE,ATTR_2,ATTR_3 
from   bass2.Dw_product_ins_srv_ds  
where service_id in (
select product_item_id from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
)
and attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'


select SERVICE_INSTANCE_ID,PRODUCT_INSTANCE_ID,SERVICE_ID,STATE,VALID_DATE,EXPIRE_DATE,ATTR_2,ATTR_3 ,name
from   bass2.Dw_product_ins_srv_ds  a
, (
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b
where  attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'
and a.service_id = b.product_item_id

select count(0),count(distinct product_item_id ) from    
(
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b



select SERVICE_INSTANCE_ID,PRODUCT_INSTANCE_ID
,SERVICE_ID,STATE,VALID_DATE,EXPIRE_DATE,ATTR_2,ATTR_3 ,name
,c.cust_id,c.product_no
from   bass2.Dw_product_ins_srv_ds  a
, (
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b
,bass2.dw_product_20111031 c
where  attr_2 like '106%'
and VALID_DATE <='2011-10-31'
and EXPIRE_DATE >='2011-10-31'
and a.service_id = b.product_item_id
and a.product_instance_id = b.user_id 





select a.SERVICE_INSTANCE_ID
,a.PRODUCT_INSTANCE_ID
,a.SERVICE_ID
,a.STATE
,a.VALID_DATE
,a.EXPIRE_DATE
,a.ATTR_2
,a.ATTR_3 
,name
,c.cust_id
,c.product_no
from   bass2.Dw_product_ins_srv_ds  a
, (
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b
,bass2.dw_product_20111031 c
where  a.attr_2 like '106%'
and a.VALID_DATE <='2011-10-31'
and a.EXPIRE_DATE >='2011-10-31'
and a.service_id = b.product_item_id
and a.product_instance_id = c.user_id 




select distinct 

'$curr_month'          BILL_MONTH,
'0'                  CUST_TYPE,
c.cust_id            EC_CODE,
''                   SINAME,        
case 
when a.ATTR_3 like 'QXZ%' then '1'
when a.ATTR_3 like 'M%' then '1'
else '2'
end as              OPERATE_TYPE,
a.ATTR_2      APP_LENCODE,
'' APNCODE
,b.name
,replace(char(date(a.VALID_DATE)),'-','') open_date
,case when replace(char(date(a.EXPIRE_DATE)),'-','') > '$timestamp' then '1' 
	else '2' end  sts
from   bass2.Dw_product_ins_srv_ds  a
, (
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b
,bass2.dw_product_20111031 c
where  a.attr_2 like '106%'
and a.VALID_DATE <='2011-10-31'
and a.EXPIRE_DATE >='2011-10-31'
and a.service_id = b.product_item_id
and a.product_instance_id = c.user_id 





select distinct 
 20111031   TIME_ID,
'201110'          BILL_MONTH,
'0'                  CUST_TYPE,
cust_id            EC_CODE,
''                   SINAME,        
case 
when ATTR_3 like 'QXZ%' then '1'
when ATTR_3 like 'M%' then '1'
else '2'
end as              OPERATE_TYPE,
ATTR_2      APP_LENCODE,
'' APNCODE
,name SERVICE_NAME
,replace(char(date(VALID_DATE)),'-','') open_date
,case when replace(char(date(EXPIRE_DATE)),'-','') > '20111031' then '1' 
        else '2' end  sts
from 
(select a.*,b.name,c.cust_id
,row_number()over(partition by a.ATTR_2 order by a.EXPIRE_DATE desc , a.VALID_DATE desc ) rn 
from bass2.Dw_product_ins_srv_ds  a
, (
select product_item_id ,name from   bass2.dim_prod_up_product_item
where platform_id = 2
and item_type = 'SERVICE'
) b
,bass2.dw_product_20111031 c
where  a.attr_2 like '106%'
and a.VALID_DATE <='2011-10-31'
and a.EXPIRE_DATE >='2011-10-31'
and a.service_id = b.product_item_id
and a.product_instance_id = c.user_id 
) t where t.rn =1 




                select *
                from bass1.G_A_22036_DAY
                where time_id =20111031
                
                 select count(0) dup_cnt
        from (
                select count(0)  cnt
                from bass1.G_S_02024_DAY
                where time_id =20110925
                group by user_id having count(0) > 1
                ) t 
                
                                user_id           varchar(12),       --用户ID
                music_vip_mark    smallint           --是否为无线音乐俱乐部会员(1.普通会员 2.高级会员 0.非会员)
                
                
                select music_vip_mark,count(0) from (
                
                 select b.user_id,
                               case when b.sprom_id in (50001402) then 1
                                    when b.sprom_id in (50001403,99001686,99001687,99001689,99001690
                                    ,99001691,99001692,99001693,90009610,90009135,90003113,90003110,90003013,90003010,90003011,90003014,90003111,90003114,90003012,90003015,90003112,90003115) then 2
                               else 0 end as music_vip_mark
                   from  bass2.dw_product_sprom_201109 b
                   where b.active_mark = 1 and  b.sprom_id in (50001402,50001403,99001686,99001687,99001689,99001690,99001691,99001692,99001693,90009610,90009135,90003113,90003110,90003013,90003010,90003011,90003014,90003111,90003114,90003012,90003015,90003112,90003115)
                         and b.valid_date < '2011-10-01' 
                         and b.expire_date>='2011-10-01' 
                   group by b.user_id,
                                 case when b.sprom_id in (50001402) then 1
                                      when b.sprom_id in (50001403,99001686,99001687,99001689,99001690,99001691,99001692,99001693,90009610,90009135,90003113,90003110,90003013,90003010,90003011,90003014,90003111,90003114,90003012,90003015,90003112,90003115) then 2
                                 else 0 end) t group by music_vip_mark


MUSIC_VIP_MARK	2
1	35834
2	376903



select tabname from syscat.tables where tabname like '%DIM%SPROM%'                                    
TABNAME
DIM_APP_SPROM
select * from bass2.DIM_PUB_SPROM
where sprom_id in (50001402,50001403,99001686,99001687,99001689,99001690,99001691,99001692,99001693,90009610,90009135,90003113,90003110,90003013,90003010,90003011,90003014,90003111,90003114,90003012,90003015,90003112,90003115)

select count(0) from    bass2.VGOP_15205_201110
61648
DIM_SPROM_TYPE

select count(0) from    bass2.VGOP_15204_201110
27220

select count(0) ,count(distinct product_no) from    bass2.VGOP_15204_201109

1	35834
2	67630


                select music_vip_mark,count(0),count(distinct user_id) from (                
                 select b.user_id,
                               case when b.sprom_id in (50001402) then 1
                                    when b.sprom_id in (50001403) then 2
                               else 0 end as music_vip_mark
                   from  bass2.dw_product_sprom_201109 b ,bass2.dw_product_201109 a 
                   where b.ACTIVE_MARK = 1 and  b.sprom_id in (50001402,50001403)
                         and b.valid_date < '2011-10-01' 
                         and b.expire_date>='2011-10-01' 
                         and b.USER_ID = a.USER_ID
                         and a.USERTYPE_ID in (1,2,9)
                         and a.USERSTATUS_ID in (1,2,3,6,8)
                   group by b.user_id,
                                 case when b.sprom_id in (50001402) then 1
                                      when b.sprom_id in (50001403) then 2
                                 else 0 end) t group by music_vip_mark

MUSIC_VIP_MARK	2
1	35834
2	67628
MUSIC_VIP_MARK	2	3
1	35840	35840
2	67631	67631

select count(0) from    bass2.VGOP_15205_201109
where CREATE_TIME like '201109%'

1608	13518951050	20110911000000

select * from   bass2.dw_product_201109 a
   where  a.USERTYPE_ID in (1,2,9)
                         and a.USERSTATUS_ID in (1,2,3,6,8)
                         and product_no = '13518951050'
                         
                         USER_ID


select b.*    
 from  bass2.dw_product_sprom_201109 b ,bass2.dw_product_201109 a 
                   where b.ACTIVE_MARK = 1 and  b.sprom_id in (50001402,50001403)
                         and b.valid_date < '2011-10-01' 
                         and b.expire_date>='2011-10-01' 
                         and b.USER_ID = a.USER_ID
                         and a.USERTYPE_ID in (1,2,9)
                         and a.USERSTATUS_ID in (1,2,3,6,8)
                         and a.user_id = '89557332818122'


select * from                            
 bass2.dim_prod_up_product_item  where name like '%无线音乐%'
 
 select count(0) from   
 
 
 select count(0),count(distinct PRODUCT_INSTANCE_ID)  from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 113050001402
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-11-01'


select count(0),count(distinct PRODUCT_INSTANCE_ID)  from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 113050001403
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-11-01'


CREATE TABLE "BASS1   "."G_A_02011_DAY―"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "BUSI_CODE" CHAR(3) NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "VALID_DATE" CHAR(8) NOT NULL , 
                  "INVALID_DATE" CHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("BUSI_CODE",  
                 "USER_ID",  
                 "VALID_DATE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 



CREATE TABLE "BASS1   "."G_A_02011_DAY_FIX20111102"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "BUSI_CODE" CHAR(3) NOT NULL , 
                  "USER_ID" CHAR(20) NOT NULL , 
                  "VALID_DATE" CHAR(8) NOT NULL , 
                  "INVALID_DATE" CHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("BUSI_CODE",  
                 "USER_ID",  
                 "VALID_DATE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


SELECT DISTINCT 
20111102 time_id
        ,'131' BUSI_CODE
        ,a.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a
where a.offer_id = 113050001402
and date(VALID_DATE) < date(EXPIRE_DATE)
and date(EXPIRE_DATE) > '2011-11-01'


SELECT DISTINCT 
20111102 time_id
        ,'131' BUSI_CODE
        ,b.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a ,bass2.dw_product_20111101 b
where 
a.product_instance_id = b.user_id
and b.usertype_id in (1,2,9)
and b.USERSTATUS_ID in (1,2,3,6,8)
and a.offer_id = 113050001402
and date(a.VALID_DATE) < date(a.EXPIRE_DATE)
and date(a.EXPIRE_DATE) > '2011-11-01'



select count(0) from   G_A_02011_DAY
where busi_code = '132'
and time_id = 20111102


BASS2_Dw_product_ds.tcl	用户资料日表:用户资料月表
BASS1_G_A_02011_DAY.tcl	用户开通业务功能历史

insert into app.sch_control_before 
values ('BASS1_G_A_02011_DAY.tcl','BASS2_Dw_product_ds.tcl');



CREATE TABLE "BASS1   "."INT_02004_02008_MONTH_STAGE_201109"  (
                  "USER_ID" CHAR(15) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "TEST_FLAG" CHAR(1) , 
                  "SIM_CODE" CHAR(15) , 
                  "USERTYPE_ID" CHAR(4) , 
                  "CREATE_DATE" CHAR(15) , 
                  "BRAND_ID" CHAR(4) , 
                  "TIME_ID" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




insert into bass1.INT_02004_02008_MONTH_STAGE_201109 (
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201109 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201109 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
    



select count(0),count(distinct user_id) 
--select t2.*
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc) rn 
from (
select *
from G_A_02011_DAY where busi_code = '132'
and time_id <=20111102 
) t 
) t2 where rn = 1 


66085	66085



select count(0),count(distinct t2.user_id) 
--select t2.*
from 
(
select t.*,row_number()over(partition by user_id order by time_id desc) rn 
from (
select *
from G_A_02011_DAY where busi_code = '132'
and time_id <=20111102 
) t 
) t2 , bass1.INT_02004_02008_MONTH_STAGE_201109 b
where t2.rn = 1 
and t2.user_id = b.user_id 
and test_flag = '0'
and usertype_id NOT IN ('2010','2020','2030','9000')
create index idxt201103 on INT_02004_02008_MONTH_STAGE_201109 (user_id)
65584	65584



---------------------------------------------------------------------------------
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc

select * from   app.sch_control_task  where control_code = 'BASS2_esop_i_kpi001_ds.tcl'


update app.sch_control_runlog 
set flag = -2 
where control_code = 'BASS1_INT_CHECK_INDEX_SAME_DAY.tcl'
and endtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'


update app.sch_control_alarm 
set flag = 1
where alarmtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'
and control_code = 'BASS1_INT_CHECK_INDEX_SAME_DAY.tcl'





select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
--and mobile_num = '15913269062'
and send_time >=  current timestamp - 1 days
and date(send_time) = char(current date )
order by send_time desc



select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num in ('15913269062','13989007120','15889099527')
and send_time >=  current timestamp - 2 days
--and date(send_time) = char(current date )
order by send_time desc


select * from    app.sch_control_runlog 


select * from app.sch_control_alarm  where content like '%准确性指标56%'

---------------------------------------------------------------------------------

select * from   table( bass1.chk_same(0) ) a order by 2
---------------------------------------------------------------------------------

select * from   table( bass1.chk_wave(0) ) a order by 2
---------------------------------------------------------------------------------

---------------------------------------------------------------------------------

select * from app.sch_control_task where control_code in 
(
select control_code from   app.sch_control_runlog where flag = 1 
)
and cc_flag = 1


---------------------------------------------------------------------------------
select * from table(bass1.fn_dn_flret_cnt(9)) a

select * from table(bass1.fn_dn_flret_cnt(11)) a

select * from table(bass1.fn_dn_flret_cnt(13)) a

select * from table(bass1.fn_dn_flret_cnt(15)) a


/*********日**************************************************************************************/

--接口文件级返回检查(正常情况为56条记录) file 
--file lvl
select  * from APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'

select  * from APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code<>'00'

---------------------------------------------------------------------------------
--或者：有接口重传时、记录级重新返回时。
--s_13100_20110301_22303_01_001.dat
--file lvl

select t.*, substr(filename,18,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1

----------------------求未上传（文件级返回）接口！ (当日没返回文件级的接口)
select * from   BASS1.MON_ALL_INTERFACE 
where interface_code 
not in (select substr(filename,18,5) from 
APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) and type='d'
and interface_code <> '04007'

--record 接口记录集返回检查(正常情况为56条记录) record
---------------------------------------------------------------------------------

select * from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1


--record 查询未返回接口 (已完全上报时) record

select * from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0
---------------------------------------------------------------------------------


--求未导出接口 (通过上一天与本日比较)
select * from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and unit_code 
not in (select unit_code  from  app.g_runlog where time_id=int(replace(char(current date - 1 days),'-',''))
 )


-- record 未返回接口的详细信息 (day)  record
select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0
)
and type = 'd'

-- record 已返回接口的详细信息 (day)  record
select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1
)
and type = 'd'


--查询未运行的导出程序
SELECT * FROM bass1.MON_ALL_INTERFACE  t
WHERE t.INTERFACE_CODE not IN (
select substr(a.control_code,15,5) from   app.sch_control_runlog  A
where control_code like 'BASS1_EXP%DAY'
AND date(a.begintime) =  date(current date)
AND FLAG = 0
)
AND TYPE='d'


--查询未导出接口 (未完全出数时)

select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
except
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0


/********月***************************************************************************************/

---月接口文件级返回检查(对于接口重送，相应的进行增加)
--对于重传接口，根据重传次数会增加相应记录数，故做去重处理，防止重复统计
--file 
select *
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1


--文件级返回失败检查
select  * 
from APP.G_FILE_REPORT
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code <> '00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
order by deal_time desc


--查询已返回月接口 记录级

select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1

--已上传未返回 (b表将为NULL)
--mreturn

select distinct c.INTERFACE_NAME,a.*,b.*
FROM 
(select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 
left join bass1.mon_all_interface c on substr(a.filename,16,5) = c.INTERFACE_CODE 


/**
--查询未返回月接口 记录级

select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=0

--未返回接口的详细信息 (month)

select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=0
)
and type = 'm'
**/

--查看deadlineX 的接口有多少已返回。


--分时段接口-查看返回情况
select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月3日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月5日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月8日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月10日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月15日前'

12+15+30+17+10 = 84 







--调度程序耗时:
select A.*,char(a.RUNTIME/60)||'min',char(a.RUNTIME/60/60)||'hr' from   app.sch_control_runlog A
where control_code like 'BASS1%DAY%'
and a.RUNTIME/60 > 5
ORDER BY RUNTIME DESC 



/**
1、22073竞争KPI涉及的校验R163、R164、R165、R166、R167、R168、R169、R170、R171、R172(调度为BASS1_INT_CHECK_COMP_KPI_DAY.tcl)和
21007短信涉及的校验(调度BASS1_INT_CHECK_C1K844TO46_TO_DAY.tcl)超标，数据正常生成的，不要进行任何数据调整，调度直接点击完成后运行后续；

如：
**/
select * from bass1.g_rule_check where rule_code in ('R171','R172','R169') order by time_id desc
20110501	R169	1503.00000	580.00000	1.59130	0.00000
20110501	R171	1499.00000	573.00000	1.61600	0.00000
20110501	R172	633.00000	383.00000	0.65270	0.00000

/**
2、22012日kpi接口涉及的一致性检查，如超标，必须进行调整(调度为BASS1_INT_CHECK_INDEX_SAME_DAY.tcl)，调整22012接口的指标，重跑报错调度，
一定不能点击完成(最频繁的是“离网用户数”这个指标，差一个用户就超标，暂没解决口径不一致情况，二经未改造用户资料表)；

如：
**/
select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end,
         target1,
         target2,
         target3
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
and rule_code='R159_1'
order by 1 desc 


20110418	离网客户数	84.00000	85.00000	-0.01176

20110428	离网客户数	144.00000	134.00000	0.07462

select * from     
bass1.g_s_22012_day 
where time_id=int(replace(char(current date - 1 days),'-',''))

20110517	20110517	2888      	1671364     	23709586    	469322      	3798066     	77        	280936      

20110519	20110519	2306      	1675939     	22918403    	5312      	3834942     	68        	257121      

20110520	20110520	2330      	1678173     	23580986    	476230      	3903368     	80        	284164      
  
 
 20110528	20110528	1888      	1645201     	22985709    	515685      	3774471     	83        	274209      

20110601	20110601	4520      	1646351     	24447434    	520729      	4689422     	120       	492684      --当日离网 ，二经没有打标

20110602	20110602	3423      	1649676     	22326259    	471251      	3738425     	99        	261862      
 
 TIME_ID	BILL_DATE	M_NEW_USERS	M_DAO_USERS	M_BILL_DURATION	M_DATA_FLOWS	M_BILL_SMS	M_OFF_USERS	M_BILL_MMS
20110603	20110603	2900      	1652486     	23148301    	481514      	4124087     	90        	264431      

  --调整脚本，''里更新一定的值就是
--离网客户数
update bass1.g_s_22012_day set m_off_users='97' 
where time_id=int(replace(char(current date - 1 days),'-',''))

 select * from  bass1.G_RULE_CHECK where rule_code = 'C1'
 order by 1 desc 

 select * from  bass1.G_RULE_CHECK where rule_code = 'C1'
 and time_id > 20110825
 order by 1 desc 
 
20110618	C1	2049107.00000	2211895.00000	-0.07360	0.00000
 
 20110607	C1	2059346.00000	4283440.00000	-0.51923	0.00000

 20110605	C1	4405358.00000	2650880.00000	0.66185	0.00000

 20110603	C1	2154443.00000	1826062.00000	0.17983	0.00000

 20110531	C1	2432169.00000	2058116.00000	0.18175	0.00000
20110530	C1	2058116.00000	1980649.00000	0.03911	0.00000


 20110509	C1	2053251.00000	2472205.00000	-0.16947	0.00000

 20110508	C1	2472205.00000	2140554.00000	0.15494	0.00000

20110503	C1	1981494.00000	1819931.00000	0.08877	0.00000

20110502	C1	1819931.00000	2861998.00000	-0.36410	0.00000 
20110501	C1	2861998.00000	3083030.00000	-0.07169	0.00000
20110430	C1	3083030.00000	2551002.00000	0.20856	0.00000
20110429	C1	2551002.00000	2155029.00000	0.18374	0.00000
20110428	C1	2155029.00000	1990225.00000	0.08281	0.00000
20110427	C1	1990225.00000	1987809.00000	0.00122	0.00000


/**

2、月底调度BASS1_INT_CHECK_SAMPLE_TO_DAY.tcl中R107/R108超标，此调度只有在月初1号早上送月底那天的日数据时必须调整，让校验通过，
其它日期调度报错直接点击运行完成；

--调整脚本(数据量大，update有些慢，要几分钟，调了以后如还报错，再调其中“400”和“5”的值，注意微调)
---R107
**/

select * from bass1.g_rule_check where rule_code in ('R107') order by time_id desc
20110531	R107	33.14000	69.10000	-0.52041	0.05000

20110430	R107	67.13000	68.50000	-0.02000	0.05000
select * from bass1.g_rule_check where rule_code in ('R108') order by time_id desc
20110430	R108	544.84000	560.01000	-0.02709	0.05000

---R107
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110929  ) t 
set TOLL_CALL_FEE = char(bigint(TOLL_CALL_FEE)+400) with ur;
109513 row(s) affected.
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110731  ) t 
set TOLL_CALL_FEE = char(bigint(TOLL_CALL_FEE)+10) with ur

--97763 row(s) affected.

--100390 row(s) affected.
--97763 row(s) affected.
--201107 105138 row(s) affected.
---R108
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110929  ) t 
set BASE_BILL_DURATION = char(bigint(BASE_BILL_DURATION)-5) with ur 
20110828
112152 row(s) affected.


--100390 row(s) affected.
--97763 row(s) affected.
--201107 105138 row(s) affected.
select * from   bass1.G_RULE_CHECK where rule_code = 'R109'      
order by time_id desc 


--所有日接口代码：

select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'

--所有月接口代码：

select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'




		   
--每月月初跑
--G_S_21003_STORE_DAY
--每月月初插入上月全月数据
delete from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

insert into G_S_21003_STORE_DAY
select *
from G_S_21003_TO_DAY
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

--统计备份情况()
select count(0) from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

select count(0) from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

--统计备份情况()
select count(0) from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))

select count(0) from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))

--两者一致，则在G_S_21003_TO_DAY删除前两个月前的数据(如现在是5月，保留3，4月，删除2月数据)
--提高程序速度
delete from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))





--生成重导日数据的命令

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,13)||' '||char(current date - 1 days) 
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'

--生成重导月数据的命令

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,15)||' '||substr(char(current date - 1 month) ,1,7)
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'


--单独put 某个接口:day



select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'

--单独put 某个接口:month

select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'


--接口号 -  表名 对应关系
select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,13) from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'
) t where unit_code = ''

select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,15),b.control_code from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
) t where unit_code = ''


select * from   bass1.mon_all_interface where INTERFACE_CODE = '06001'




select * from   bass1.dim_21003_ip_type

select * from    bass1.G_S_22059_MONTH_MRKT_0135A 

select count(0) from    BASS1.G_S_22057_MONTH

select count(0) from     app.sch_control_map where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';

delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22058_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22059_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22060_MONTH.tcl';

select count(0) from     bass1.int_program_data where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';

select count(0) from    bass1.int_program_data where PROGRAM_NAME = 'G_S_22060_MONTH.tcl';

select * from    app.g_unit_info  where unit_code = '22057'
select count(0) from    app.sch_control_task  where control_code = 'BASS1_EXP_G_S_22057_MONTH'


select * from   bass2.stat_market_0135_b_final

select * from   bass2.stat_market_0135_b_final

select * from            bass1.G_S_22057_MONTH

select * from   bass2.stat_market_0135_c 

select * from   bass2.stat_channel_reward_0009 

select * from   bass2. dw_channel_local_busi_201106  





select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201106 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
union 
select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02064_day where 
                 time_id/100 <= 201106 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
                
                

 SELECT 
                    SUM(T.SC),
                    COUNT(DISTINCT T.PRODUCT_NO)
                  FROM (
                          SELECT SUM(BIGINT(CALL_DURATION)) AS SC, PRODUCT_NO     
                          FROM BASS1.G_S_04008_DAY
                          WHERE TIME_ID/100=201107
                               AND ADVERSARY_ID<>'010000'
                          GROUP BY PRODUCT_NO
                          UNION 
                          SELECT SUM(BIGINT(CALL_DURATION)) AS SC,PRODUCT_NO
                          FROM BASS1.G_S_04009_DAY
                          WHERE TIME_ID/100=201107
                                AND ADVERSARY_ID<>'010000'
                          GROUP BY PRODUCT_NO
                        )T
                        
                        
select count(0) from     bass2.STAT_ZD_VILLAGE_USERS_201107
                       

select count(0) from     BASS1.G_S_04009_DAY
select * from   BASS1.MON_ALL_INTERFACE 
 where interface_code = '06002'
 
                       

select SCHOOL_ID , count(0) 
--,  count(distinct SCHOOL_ID ) 
from G_I_02032_MONTH 
group by  SCHOOL_ID 
order by 1 


select * from   bass2.dw_product_20110808 where product_no = '13989007120'
                       
select tabname from syscat.tables where tabname like '%GPRS_LOCAL%'                          

select * from bass2.CDR_GPRS_LOCAL_20110701 fetch first 10 rows only  


                select distinct B_AREA_CD
                from G_S_04019_DAY where time_id = 20110820
                except 
                select country_code from  bass1.dim_country_city_code 
                select * from   bass1.dim_country_city_code  where country_code like '2%'
                
select tabname from syscat.tables where tabname like '%DIM%COU%'                   
select * from   bass2.DIM_PUB_COUNTRY

select *                 from G_S_04019_DAY where time_id = 20110811
and B_AREA_CD = '2'

1209	未知待查

update 
 G_S_04019_DAY 
 set B_AREA_CD = '1209'
 where time_id = 20110820
and B_AREA_CD = '2'


select * from   G_A_02054_DAY_FIX20110812



USER_ID	CUST_ID	ACCT_ID
89101110015456	89101110420499	89101110200773


select * from   bass2.dw_product_20110812
where product_no = '13908911366'

select * from bass2.dw_cust_20110812 
where CUST_ID = '89101110420499'




select * from   



SELECT CNT1 - CNT2 
FROM 
(
select COUNT(0) CNT1
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107
           ) f 
where    f.row_id=1 
    ) A        
, (
select COUNT(0) CNT2
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
where e.row_id=1
) B 
select * from   g_s_22066_day where time_id = 20110820



select * from   app.sch_control_task where CMD_LINE like  '%ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD%'



CREATE TABLE BASS2.ODS_PRODUCT_ORD_BUSI_OTHER_20110701  like bass2.ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD  DISTRIBUTE BY HASH(ORDER_BUSI_INFO_ID)   IN TBS_3H INDEX IN TBS_INDEX ; 
                   

select tabname from syscat.tables where tabname like '%ODS_PRODUCT_ORD_BUSI_OTHER%'                      


  select * from g_s_22066_day 
  where e_channel_type = '04'
  order by 1 desc 
  
  select * 
                  from bass1.G_S_22066_DAY
                where time_id in (20110823,20110822)
                
               
               
               
               select * from    G_S_22066_DAY
               
               
               
                 
  select * 
                  from bass1.G_S_22091_DAY
                where time_id in (20110823,20110822)
                
                
select * from   app.sch_control_task where control_code like '%product%other%ds%.tcl'                
select * from   app.sch_control_task where control_code like '%product%%tcl'                

select * from  table( bass1.get_before('product_ord_busi_')) a 



  select * 
                  from bass1.G_S_22092_DAY
                where time_id in (20110823,20110822)
                
                
                BASS2_Dwd_product_ord_busi_other_ds.tcl	TR1_L_11060

select * from   app.sch_control_task where control_code like 'TR1_L_1106%'                




select count(0) ,count(distinct user_id ) from    G_I_02016_MONTH where time_id = 201107


select prod_id,count(0) from    G_I_02016_MONTH where time_id = 201107
group by prod_id

PROD_ID	2
106	32
107	33
108	78
300	1
    
  33+78 = 111 

  
    106：30元/月包15小时
    107：50元/月包40小时
	108：100元/月包200小时
    300：本地WLAN资费套餐
    
    select count(0) from    
    (
    select user_id from G_S_03004_MONTH where time_id = 201107 group by user_id having  sum(bigint(FEE_RECEIVABLE)) between 5000 and 12000
    ) a
    
values 111*1.00/587040*100

values 111/0.00193327868598914*100

select * from    bass2.dim_product_item b
where b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)



                select
                    201107,
                        b.prod_id,
                         count(distinct a.user_id)
                from bass2.dwd_product_sprom_active_20110730 a,
                         bass2.dim_product_item b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)
                  and replace(char(date(a.valid_date)),'-','')<='20110731'
                  and replace(char(date(a.expire_date)),'-','')>'20110731'
                  group by b.prod_id
                  
                  1	PROD_ID	3
201107	90030036	23
201107	90030031	23
201107	90030024	63
201107	90005001	1


1	PROD_ID	3
201107	90005001	1
201107	90030024	78
201107	90030031	34
201107	90030036	32


values 39/0.00193327868598914*100

select * from    bass2.stat_2011_user_wlan_mm
select * from    bass2.stat_wlan_2011_user_mm


select distinct extend_id prod_id, name  from   bass2.dim_prod_up_product_item 
where UPPER(name) like '%WLAN%'
and extend_id is not null





                select
                    201107,
                        b.prod_id,
                         count(distinct a.user_id)
                from bass2.dwd_product_sprom_active_20110730 a,
                         (select distinct extend_id prod_id, name  from   bass2.dim_prod_up_product_item 
where UPPER(name) like '%WLAN%'
and extend_id is not null) b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)
                  and replace(char(date(a.valid_date)),'-','')<='20110731'
                  and replace(char(date(a.expire_date)),'-','')>'20110731'
                  group by b.prod_id
                  

select * from   bass2.dim_acct_item
                  where UPPER(item_name) like '%GPRS%'
                  
ITEM_ID	ITEM_NAME
80000594	WLAN包时费
80000105	WLAN包月费
80000106	WLAN基本费
82000031	WLAN费虚科目
80000628	Wlan
80000732	WLAN电子卡订购使用费


select * from bass2.dw_acct_shoulditem_201107
where item_id in (80000594,80000105,80000106,82000031,80000628)                  


select * from   BASS1.ALL_DIM_LKP 

where bass1_tbid = 'BASS_STD1_0074'

dim_acct_item	WLAN基本费	80000106	帐目科目	BASS_STD1_0074	0716	无线局域网（WLAN）通信费
dim_acct_item	WLAN包月费	80000105	帐目科目	BASS_STD1_0074	0715	无线局域网（WLAN）月使用费

select sum(bigint(FEE_RECEIVABLE))/count(distinct a.user_id)/100 from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')
70.28

select avg(bigint(FEE_RECEIVABLE)) from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')

7028

4190





select a.* from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')
70.28


0626	GPRS套餐费	包含相应数据流量的GPRS月使用费
0627	GPRS通信费	套餐用户超出部分的GPRS通信费，以及非套餐用户的GPRS通信费



select sum(bigint(FEE_RECEIVABLE))/count(distinct a.user_id)/100 from   g_s_03004_month a
where a.time_id = 201107 
and ACCT_ITEM_ID in ('0626','0627')
6


select * from   G_S_22091_DAY
order by 1 desc 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22091_DAY 
group by  time_id 
order by 1 

select count(0) from    BASS2.DWD_PRODUCT_ORD_BUSI_OTHER_20110824


select count(0) from    BASS2.DWD_PRODUCT_ORD_BUSI_OTHER_20110823

BASS2_Dwd_product_ord_busi_other_ds.tcl



insert into app.sch_control_before 
values ('BASS1_G_S_22066_DAY.tcl','BASS2_Dwd_product_ord_busi_other_ds.tcl')

select * from  table( bass1.get_before('BASS1_G_S_22066_DAY')) a 



select DEAL_DATE||E_CHANNEL_TYPE||BUSI_REC_CNT||ACTIVATE_CNT||TERM_SALE_CNT||VAL_BUSI_REC_CNT||VAL_BUSI_CANCEL_CNT||CHRG_REC_CNT||CHRG_REC_FEE||ACCESS_CNT||QRY_REC_CNT from bass1.g_s_22066_day where time_id=20110710


select * from   g_s_22066_day order by 1 desc,3

select * from   bass2.dim_device_profile




select date(alarmtime),count(0) from  app.sch_control_alarm 
where  
 control_code like 'BASS1%'
 and substr(char(date(alarmtime)),9,2) in ('28','29','30')
group by date(alarmtime)




select * from  app.sch_control_alarm 
where  
 control_code like 'BASS1%'
 and substr(char(date(alarmtime)),9,2) in ('28','29','30')



select * from    bass1.G_S_04019_DAY where time_id=20110827



select * from   


select * from bass1.g_rule_check 
where rule_code in ('R107') 
and time_id = int(replace(char(current date - 1 days),'-',''))
order by time_id desc




SELECT CNT1 - CNT2 
FROM 
(
select COUNT(0) CNT1
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201108
           ) f 
where    f.row_id=1 
    ) A        
, (
select COUNT(0) CNT2
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201108 ) e
where e.row_id=1
) B 



select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


CREATE TABLE "BASS1   "."INT_22401_201109"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "CELL_ID" CHAR(10) , 
                  "LAC_ID" CHAR(10) , 
                  "CALL_CNT" BIGINT )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "CELL_ID",  
                 "LAC_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and control_code like 'BASS1%'
order by alarmtime desc



select * from   bass2.dw_call_opposite_201108
where product_no = '13549083471'


                select USER_ID||CELL_ID||LAC_ID, count(0)  cnt
                from bass1.G_S_22401_MONTH
                where time_id =201108
                group by USER_ID||CELL_ID||LAC_ID having count(0) > 1
                

			select * from   G_I_21020_MONTH
				where
				COMP_BRAND_ID = '021000' and 
				 substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3)  not 
				in ('130','131','132','155','156','185','186','145')   
				and time_id  = 201108 
                


 select * from
(
select distinct  channel_star from bass1.g_i_06021_month
where time_id =201108
  and channel_status='1'
  and channel_type='3'
) aa
where channel_star=''
                
                
                select  * from bass1.g_i_06021_month
where time_id =201108
  and channel_status='1'
  and channel_type='3'
  and channel_star=''
  
  
  
                        select count(0) from   G_I_21020_MONTH
                                where
                                COMP_BRAND_ID = '021000' and 
                                 substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3)  not 
                                in ('130','131','132','155','156','185','186','145')   
                                and time_id  = 201108 
                                
                                

                select cnt,rn from (
                        select time_id,round(20+rand(1)*10,0) cnt , row_number()over() rn from bass1.g_s_22021_month
                        where show_id = '00030028'
                        ) a 
                where time_id = 201108
                                
                                



select cnt,rn from (
select time_id,round(20+rand(1)*10,0) cnt , row_number()over() rn from 
(select * from bass1.g_s_22021_month 
union all
select 201108 TIME_ID,'201108' MONTH_ID, '00030028' SHOW_ID,'' TARGET_VALUE from bass2.dual
) t
where show_id = '00030028'
) a 
where time_id = 201108


select * from syscat.tables where tabname like '%TERM%TAC%'   
                                
                                
                                
---------------------------------------------------------------------------------
select *  from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 5 days
and control_code like 'BASS1%CHECK%MONTH%'
and control_code  not like 'BASS1%CHECK%WAVE%'
and control_code  not like 'BASS1%CHECK%SAME%'
order by alarmtime desc
                                
                            select count(0) from    (    
select BILL_TYPE||PRODUCT_NO||PRTY_CODE||SP_ID||SERV_CODE||CUSTOM_CHNL||MEET_NUM||PREZENT_BEGIN_TIME||PREZENT_END_TIME||FEE_AMT||BUSI_TYPE||DEAL_TIME||CUST_CONTE from bass1.g_s_04015_day where time_id=20110906
) a

                                
                                
select count(0) from     bass1.g_s_04015_day where time_id=20110906
 and   PRTY_CODE is null 
 
update   (select * from  bass1.g_s_04015_day where     time_id=20110906 ) a 
set BILL_TYPE = ''
where  BILL_TYPE is null 

select * from    bass1.g_s_04015_day where     time_id=20110906
and                          BILL_TYPE = ''
delete from (select * from bass1.g_s_04015_day where     time_id=20110906)  a
where  BILL_TYPE = ''


---------------------------------------------------------------------------------
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1
order by alarmtime desc

select * from   bass2.dim_acct_item b 
where UPPER(item_name) like '%BLACK%BERRY%'

ITEM_ID	ITEM_NAME
80000180	BlackBerry功能费
80000184	BlackBerry通信费
80000598	BlackBerry集团客户扩展业务功能费
80000599	BlackBerry集团客户扩展业务通信费
82000111	Black Berry虚科目



select * from   G_I_02022_DAY where user_id = '89160001135476'
20110825	89160001135476      	QW_QQT_JC_SL88                	20110722
20110827	89160001135476      	QW_QQT_JC_SL88                	20110801
20110828	89160001135476      	QW_QQT_JC_SL88                	20110801
20110829	89160001135476      	QW_QQT_JC_SL88                	20110801
20110830	89160001135476      	QW_QQT_JC_SL88                	20110801
20110831	89160001135476      	QW_QQT_JC_SL88                	20110801
20110901	89160001135476      	QW_QQT_JC_SW128               	20110901
20110902	89160001135476      	QW_QQT_JC_SW128               	20110901


20110826	89160001135476      	QW_QQT_JC_SL88                	BASS1_DS                                	20110826	20110901
select * from   G_S_02024_DAY where user_id = '89160001135476'



        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89160001135476'
)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'


select count(0) 
		FROM BASS2.Dim_CHANNEL_INFO A 
		WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
	with ur
    

select count(0),count(distinct PRODUCT_NO) from    g_s_04002_day
where time_id = 20110927

4177858	289510
4177858	289510





                select CHANNEL_ID,count(0)  cnt
                from bass1.G_A_06035_DAY
                where time_id =20111001
                group by CHANNEL_ID having count(0) > 1
                
                select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06035_DAY 
group by  time_id 
order by 1 


insert into app.sch_control_before
values 
 ('BASS1_G_I_02034_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_22403_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_S_22403_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_22404_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02035_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02031_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_S_22404_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02033_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')

BASS1_G_I_02017_MONTH.tcl


insert into app.sch_control_before
values 
 ('BASS1_G_I_02017_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
 
 
 update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201109 )



select * from   bass1.g_rule_check where rule_code = 'R235'
ORDER BY 1 DESC 



select * from   bass1.g_rule_check where rule_code = 'R235'
ORDER BY 1 DESC 
select '06'||trim(char(int(rand(1)*9))) from bass2.dual


select count(0) from table(
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201107
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201107
)
) t 



select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201107
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201107
)


select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201109
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201109
)

select a.stud_cnt
,b.*
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id

G_S_22403_MONTH

update    app.sch_control_task 
set cc_flag = 2
where 
control_code like '%G_S_22403_MONTH%'
or 
control_code like '%G_S_22404_MONTH%'



select a.stud_cnt
,b.*
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt


select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 5 days
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc

select time_id,count(0)
from G_S_22063_MONTH
group by time_id


select * from   g_i_06003_month where time_id = 201108



                select school_id, count(0)  cnt
                from bass1.G_I_06001_MONTH
                where time_id =201109
                group by SCHOOL_ID having count(0) > 1
                
                


        select distinct  
        201109  TIME_ID
        ,SCHOOL_ID
        ,SCHOOL_NAME
        ,case when value (city_id , substr(SCHOOL_ID,4,3))  = '891' then '13101'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '892' then '13102'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '893' then '13103'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '894' then '13104'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '895' then '13105'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '896' then '13106'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '897' then '13107'
                        end CMCC_BRANCH_ID
        ,a.school_address       
        ,value(char(cast( SCH_LONGITUDE as decimal(6,4))),'0') SCH_LONGITUDE
        ,value(char(cast( SCH_LATITUDE  as decimal(6,4))),'0') SCH_LATITUDE
        , case when SCHOOL_ID  = '89189100000003' then 'http://www.utibet.edu.cn/' else ''  end WEBSITE
        ,case 
                when school_type in ('4') then '1' 
                when school_type in ('5') then '2'      
                else '3' 
        end SCHOOL_LVL
        ,case 
                when school_level in ('1') then '1' 
                when school_level in ('2') then '3'     
                else '4' 
        end ADMIN_TYPE
        ,char(SCH_SIZE_STUS) STUD_CNT
        ,'100' NEWSTUD_CNT 
        ,char(sch_size_teas) STAFF_CNT
        ,'06'||trim(char(int(rand(1)*9))) CMCC_RATE
from      bass2.Dim_xysc_maintenance_info a
where a.SCHOOL_ID  in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201109
)
with ur

                
                
                                select *
                from bass1.G_I_06001_MONTH
                where time_id =201109
               

select count(0) from (
select school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) t


select * from   g_i_06001_month
where time_id = 201109


update     (select * from  g_i_06001_month where  time_id = 201109 )  t
set    t.stud_cnt = (select char(cnt)  from 
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) c
where t.school_id = c.school_id )



select time_id, a.school_id,stud_cnt from     g_i_06001_month  a
,
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) b 
where a.school_id = b.school_id 




update     (select * from  g_i_06001_month where  time_id = 201109 )  t
set    t.stud_cnt = (select char(cnt)  from 
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) c
where t.school_id = c.school_id )
where  t.school_id in 
(
select a.school_id
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
)


select * from   bass2.dim_svc_item
where svcitem_name like '%国际%'

select count(0) from    bass2.DW_NEWBUSI_MMS_201109


 select sum(counts)
 from 
 table (
 select a.user_id,counts,substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) hlr_code   from bass2.DW_NEWBUSI_MMS_201109 a 
 where a.SEND_STATUS in (0,1,2,3) 
 and a.SVCITEM_ID in  (400001)
 and  a.calltype_id in (0)
 ) a
 ,bass2.dw_product_201109 b
 ,(select distinct  hlr_code  from   bass2.DIM_GSM_HLR_INFO
                where prov_code = '891'
              ) c
 where 
  a.hlr_code = c.hlr_code
  and  a.user_id=b.user_id
  and  b.usertype_id in (1,2,9)
  
  
  
  select 'P08-JTDX'
,(
select  sum(b.counts)
                      from bass2.dw_enterprise_member_mid_201109 a,bass2.DW_NEWBUSI_MMS_201109 b,
                           bass2.dw_product_201109 c
                      where a.user_id = b.user_id and a.user_id = c.user_id
                         and b.sp_code  = '931007' and b.calltype_id in (1)
			 and calltype_id = 1 
) from bass2.dual



select  sum(b.counts)
                      from bass2.dw_enterprise_member_mid_201109 a,bass2.DW_NEWBUSI_MMS_201109 b
                      where a.user_id = b.user_id 
                         and b.sp_code  = '931007' and b.calltype_id in (1)
			 and calltype_id = 1 

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '931007'


select b.sp_code,b.sp_name from (
select sp_code , count(0) 
--,  count(distinct sp_code ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  sp_code 
) t , bass2.DW_PM_SP_INFO_201109 b 

where char(t.sp_code) = char(b.SP_CODE)


select tabname from syscat.tables where tabname like '%SP_INFO%'   


select * from   bass2.DW_PM_SP_INFO_201109

select * from bass2.dim_up_prod_item

800089
select * from    bass2.dim_prod_up_product_item 
where SUPPLIER_ID = '800089'

801210

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '931007'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '801210'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where SER_CODE = '106540320000'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 a
where SER_CODE = '106540320000'
 and  a.calltype_id in (1)
 
select OPER_CODE , count(0) 
--,  count(distinct OPER_CODE ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  OPER_CODE 
order by 1 



select SER_CODE , count(0) 
--,  count(distinct SER_CODE ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  SER_CODE 
order by 1 

select * from   bass2.dim_svc_item
where svcitem_name like '%点对点%'

select * from   
		        bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=1 
		       and a.svcitem_id in (200001,200002,200005)

select tabname from syscat.tables where tabname like '%DIM%SP%CODE%'   

select count(0) from     bass2.dw_newbusi_sms_201109 

select * from   bass2.dim_call_tolltype

select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
except
select a from 
(
select '01005' a from bass2.dual union all
select '02005' a from bass2.dual union all
select '02006' a from bass2.dual union all
select '02007' a from bass2.dual union all
select '02014' a from bass2.dual union all
select '02015' a from bass2.dual union all
select '02016' a from bass2.dual union all
select '02018' a from bass2.dual union all
select '02019' a from bass2.dual union all
select '02020' a from bass2.dual union all
select '02021' a from bass2.dual union all
select '02031' a from bass2.dual union all
select '02032' a from bass2.dual union all
select '02033' a from bass2.dual union all
select '02034' a from bass2.dual union all
select '02035' a from bass2.dual union all
select '02047' a from bass2.dual union all
select '02049' a from bass2.dual union all
select '02052' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '03001' a from bass2.dual union all
select '03002' a from bass2.dual union all
select '03003' a from bass2.dual union all
select '03004' a from bass2.dual union all
select '03005' a from bass2.dual union all
select '03007' a from bass2.dual union all
select '03012' a from bass2.dual union all
select '03015' a from bass2.dual union all
select '03016' a from bass2.dual union all
select '03017' a from bass2.dual union all
select '03018' a from bass2.dual union all
select '03019' a from bass2.dual union all
select '06001' a from bass2.dual union all
select '06002' a from bass2.dual union all
select '06003' a from bass2.dual union all
select '06011' a from bass2.dual union all
select '06012' a from bass2.dual union all
select '06021' a from bass2.dual union all
select '06022' a from bass2.dual union all
select '06023' a from bass2.dual union all
select '06029' a from bass2.dual union all
select '06034' a from bass2.dual union all
select '21003' a from bass2.dual union all
select '21006' a from bass2.dual union all
select '21008' a from bass2.dual union all
select '21010' a from bass2.dual union all
select '21011' a from bass2.dual union all
select '21012' a from bass2.dual union all
select '21013' a from bass2.dual union all
select '21014' a from bass2.dual union all
select '21015' a from bass2.dual union all
select '21020' a from bass2.dual union all
select '05001' a from bass2.dual union all
select '05002' a from bass2.dual union all
select '05003' a from bass2.dual union all
select '22009' a from bass2.dual union all
select '22013' a from bass2.dual union all
select '22021' a from bass2.dual union all
select '22025' a from bass2.dual union all
select '22032' a from bass2.dual union all
select '22033' a from bass2.dual union all
select '22039' a from bass2.dual union all
select '22041' a from bass2.dual union all
select '22042' a from bass2.dual union all
select '22043' a from bass2.dual union all
select '22074' a from bass2.dual union all
select '22075' a from bass2.dual union all
select '22076' a from bass2.dual union all
select '22077' a from bass2.dual union all
select '22049' a from bass2.dual union all
select '22050' a from bass2.dual union all
select '22052' a from bass2.dual union all
select '22055' a from bass2.dual union all
select '22056' a from bass2.dual union all
select '22057' a from bass2.dual union all
select '22058' a from bass2.dual union all
select '22059' a from bass2.dual union all
select '22060' a from bass2.dual union all
select '22061' a from bass2.dual union all
select '22063' a from bass2.dual union all
select '22067' a from bass2.dual union all
select '22068' a from bass2.dual union all
select '22069' a from bass2.dual union all
select '22101' a from bass2.dual union all
select '22103' a from bass2.dual union all
select '22105' a from bass2.dual union all
select '22106' a from bass2.dual union all
select '22204' a from bass2.dual union all
select '22036' a from bass2.dual union all
select '22040' a from bass2.dual union all
select '22072' a from bass2.dual union all
select '22303' a from bass2.dual union all
select '22304' a from bass2.dual union all
select '22305' a from bass2.dual union all
select '22306' a from bass2.dual union all
select '22307' a from bass2.dual union all
select '22081' a from bass2.dual union all
select '22083' a from bass2.dual union all
select '22085' a from bass2.dual union all
select '22086' a from bass2.dual union all
select '22403' a from bass2.dual union all
select '22404' a from bass2.dual union all
select '22405' a from bass2.dual union all
select '22406' a from bass2.dual ) a 
except
select substr(filename,18,5) 
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1


















select substr(filename,18,5) 
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1
except
select a from 
(select '01002' a from bass2.dual union all
select '01004' a from bass2.dual union all
select '01006' a from bass2.dual union all
select '01007' a from bass2.dual union all
select '02004' a from bass2.dual union all
select '02008' a from bass2.dual union all
select '02011' a from bass2.dual union all
select '02013' a from bass2.dual union all
select '02022' a from bass2.dual union all
select '02023' a from bass2.dual union all 
select '02024' a from bass2.dual union all
select '02025' a from bass2.dual union all
select '02028' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '02054' a from bass2.dual union all
select '02055' a from bass2.dual union all
select '02056' a from bass2.dual union all
select '02057' a from bass2.dual union all
select '02058' a from bass2.dual union all
select '02059' a from bass2.dual union all
select '02060' a from bass2.dual union all
select '02061' a from bass2.dual union all
select '02062' a from bass2.dual union all
select '02063' a from bass2.dual union all
select '02064' a from bass2.dual union all
select '02065' a from bass2.dual union all
select '02066' a from bass2.dual union all
select '04002' a from bass2.dual union all
select '04003' a from bass2.dual union all
select '04004' a from bass2.dual union all
select '04005' a from bass2.dual union all
select '04006' a from bass2.dual union all
select '04015' a from bass2.dual union all
select '04016' a from bass2.dual union all
select '04017' a from bass2.dual union all
select '04018' a from bass2.dual union all
select '04019' a from bass2.dual union all
select '06031' a from bass2.dual union all
select '06032' a from bass2.dual union all
select '06035' a from bass2.dual union all
select '06036' a from bass2.dual union all
select '06037' a from bass2.dual union all
select '06038' a from bass2.dual union all
select '06039' a from bass2.dual union all
select '21001' a from bass2.dual union all
select '21002' a from bass2.dual union all
select '21004' a from bass2.dual union all
select '21005' a from bass2.dual union all
select '21007' a from bass2.dual union all
select '21009' a from bass2.dual union all
select '21016' a from bass2.dual union all
select '22012' a from bass2.dual union all
select '22038' a from bass2.dual union all
select '22073' a from bass2.dual union all
select '22048' a from bass2.dual union all
select '22066' a from bass2.dual union all
select '22091' a from bass2.dual union all
select '22092' a from bass2.dual union all
select '22102' a from bass2.dual union all
select '22104' a from bass2.dual union all
select '22201' a from bass2.dual union all
select '22202' a from bass2.dual union all
select '22203' a from bass2.dual union all
select '22301' a from bass2.dual union all
select '22302' a from bass2.dual union all
select '22080' a from bass2.dual union all
select '22082' a from bass2.dual union all
select '22084' a from bass2.dual union all
select '04008' a from bass2.dual union all
select '04009' a from bass2.dual union all
select '04010' a from bass2.dual union all
select '04011' a from bass2.dual union all
select '04012' a from bass2.dual ) a 





update (select * from     G_S_22091_DAY where time_id = int(replace(char(current date - 1 days),'-',''))
) 
set NEW_USER_cnt = '1'
where NEW_USER_cnt > '1'

select sum(bigint(NEW_USER_cnt)) from G_S_22091_DAY where time_id = int(replace(char(current date - 1 days),'-',''))


select * from   G_A_02054_DAY where time_id = 20111020


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22080_DAY 
group by  time_id 
order by 1 


   select * from   bass1.g_rule_check 
where rule_code = 'R255'
order by 1 desc 


select count(0) from    BASS2.DWD_SYS_CMD_DEF_20111025


                  select user_id from bass1.g_i_02022_day
                      where time_id =20111026
                       except
                  select user_id from bass2.dw_product_20111026
                    where usertype_id in (1,2,9) 
                    and userstatus_id in (1,2,3,6,8)
                    and test_mark<>1
                    
USER_ID
89160000925615      
89160000915003      
89160000927714      
89160000925040      
89160000917846      

                     select user_id from bass1.g_i_02022_day
                      where time_id =20111025
                       except
                  select user_id from bass2.dw_product_20111025
                    where usertype_id in (1,2,9) 
                    and userstatus_id in (1,2,3,6,8)
                    and test_mark<>1
                    
delete from (select * from  bass1.g_i_02022_day  where time_id =20111026)
where user_id in 
(
'89660001015961'

)

89660001015961      

select * from    g_a_02004_day 
where user_id = '89160000925615'
                  select *from bass1.g_i_02022_day
                      where time_id =20111025
and  user_id = '89160000925615'                     
                    
                  select * from bass2.dw_product_20111025
                    where user_id = '89160000925615'

bass1.int_02004_02008_month_stage 
        
select * from    g_a_02004_02008_stage 
where user_id = '89160000925615'
            
            select * from    g_a_02008_day 
where user_id = '89160000925615'
            

            
            

select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end,
         target1,
         target2,
         target3
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
and rule_code='R159_4'
order by 1 desc 

            

                select user_id, count(0)  cnt
                from bass1.G_A_02028_DAY
                where time_id =20111028
                group by user_id having count(0) > 1
                
                      	2

select * from   G_A_02028_DAY
where user_id = '89157334193580'

TIME_ID	USER_ID	PKG_ID	ORDER_DT	STS_CD
20111028	89157334193580      	9999121202901081011001	20111101	1
20111028	89157334193580      	9999121202900981011001	20111028	1

delete from G_A_02028_DAY
where user_id = '89157334193580'
and TIME_ID = 20111028 
and ORDER_DT = '20111101'


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


 select count(0) dup_cnt
        from (
                select user_id, count(0)  cnt
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1
                ) t 
                

from bass1.G_S_02024_DAY
                where time_id =20111101                
                and user_id in (
                                select user_id
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1

                )
                
                
                
                select * from   g_a_22036_day
                
                
                
delete                 
                from bass1.G_S_02024_DAY
                where time_id =20111101                
                and user_id in (
                                select user_id
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1)
               and valid_dt > '20111101'
               
               
               
                


select count(0),count(distinct user_id||busi_code ) from    G_A_02011_DAY 
where time_id = 20111103



delete from (select * from G_A_02011_DAY where time_id = 20111103)


select user_id,busi_code 
from G_A_02011_DAY
where  time_id = 20111103
group by user_id,busi_code having count(0) > 1 

89160000667427      	131


select * from G_A_02011_DAY where time_id = 20111103
and user_id = '89160000667427'
TIME_ID	BUSI_CODE	USER_ID	VALID_DATE	INVALID_DATE
20111103	131	89160000667427      	20000101	20000102
20111103	131	89160000667427      	20111103	20991231

delete from G_A_02011_DAY
where TIME_ID = 20111103
and USER_ID = '89160000667427'
and INVALID_DATE = '20000102'

SELECT DISTINCT 
20111103 time_id
        ,'131' BUSI_CODE
        ,b.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a 
,bass2.dw_product_20111103 b
where 
a.product_instance_id = b.user_id
and b.usertype_id in (1,2,9)
and b.USERSTATUS_ID in (1,2,3,6,8)
and a.offer_id = 113050001402
and date(a.VALID_DATE) < date(a.EXPIRE_DATE)
and date(a.VALID_DATE) <= '2011-11-03'
and date(a.EXPIRE_DATE) > '2011-11-03'
and date(a.VALID_DATE) = '2011-11-03'
and USER_ID = '89160000667427'
with ur


select * from bass1.ALL_DIM_LKP c  where bass1_tbid='BASS_STD1_0075'


SELECT DISTINCT 
20111103 time_id
        ,'132' BUSI_CODE
        ,b.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a 
,bass2.dw_product_20111103 b
where 
a.product_instance_id = b.user_id
and b.usertype_id in (1,2,9)
and b.USERSTATUS_ID in (1,2,3,6,8)
and a.offer_id = 113050001403
and date(a.VALID_DATE) < date(a.EXPIRE_DATE)
and date(a.VALID_DATE) <= '2011-11-03'
and date(a.EXPIRE_DATE) > '2011-11-03'
and date(a.VALID_DATE) = '2011-11-03'
and USER_ID = '89160000667427'
with ur


                           select
                             coalesce(bass1.fn_get_all_dim('BASS_STD1_0075',char(a.prod_id)),'010')
                             ,a.user_id
                             ,replace(char(date(a.valid_date)),'-','') as valid_date
                             ,replace(char(date(a.expire_date)),'-','') as invalid_date
                           from 
                             bass2.dwd_product_func_20111103 a 
                           where
                             a.service_id>0 
                             and USER_ID = '89160000667427'
                             

                           select
                             coalesce(bass1.fn_get_all_dim('BASS_STD1_0075',char(a.prod_id)),'010')
                             ,a.user_id
                             ,replace(char(date(a.valid_date)),'-','') as valid_date
                             ,replace(char(date(a.expire_date)),'-','') as invalid_date
                           from 
                             bass2.dwd_product_func_20111103 a,
                             bass2.dim_product_item b
                           where
                             a.service_id=0 
                             and a.prod_id=b.prod_id 
                             and USER_ID = '89160000667427'
                             
                             select t.busi_code
                                 ,t.user_id
                                 ,t.valid_date
                                 ,t.invalid_date
               from (select  busi_code
                             ,user_id
                             ,valid_date
                             ,invalid_date
                             ,row_number() over(partition by busi_code,user_id order by valid_date desc ) row_id
                     from session.g_a_02011_day_tmp1 ) t
               where t.row_id=1                           
              
               
               
               select
                    a.busi_code
                   ,a.user_id
                   ,'20000101'
                   ,'20000102'
                 from ( select busi_code,user_id  from bass1.int_02011_snapshot where valid_date<>'20000101' and invalid_date<>'20000102'
                  and USER_ID = '89160000667427'
                  )t 
                  
                 
                 
                 
select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO \
where send_time is not null \
and mobile_num = '15913269062' \
and send_time >=  current timestamp - 1 days \
and date(send_time) = char(current date ) \
order by send_time desc


                 
select count(0) from    bass2.dw_product_20111115
           

select count(0) from BASS2_Dwd_product_red_ds           



select 'xxxxxx',count(1) from APP.SCH_CONTROL_RUNLOG where control_code='BASS2_Dw_mr_down_cdr_dm.tcl' and replace(char(date(begintime),iso),'-','')='20111228' and replace(char(date(endtime),iso),'-','')='20111228' and flag=0 and runtime>=0

select OP_TIME,count(0) from bass2.dw_mr_down_cdr_dm_201112
group by OP_TIME



select * from APP.SCH_CONTROL_RUNLOG_his where control_code='BASS2_Dw_mr_down_cdr_dm.tcl'


select * from APP.SCH_CONTROL_RUNLOG where replace(char(date(begintime),iso),'-','')='20111228'


values current timestamp



select * from  app.sch_control_alarm 
where 

replace(char(date(alarmtime),iso),'-','')='20111228'



select * from APP.SCH_CONTROL_RUNLOG_his where replace(char(date(begintime),iso),'-','')='20111228'


西藏	R023	|(月新增用户/∑(日新增用户数）-1) x 100% | ≤ 3%	79217.00	79323.00
西藏	R024	|(月离网用户/∑(日离网用户数）-1) x 100% | ≤ 5%	60743.00	60758.00
1
60743


select 
time_id / 100
,sum(bigint(TARGET1))
,sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
group by time_id / 100
order by 1 desc 


西藏	R127	|(本月离网用户数 / 上月离网用户数 - 1) x 100%| ≤ 20%	60743.00	61041.00

1	2
201105	60747

201105	60747
201104	61053
201105	60747	60758
201104	61053	61060

1
60743


CREATE TABLE "BASS1   "."INT_02004_02008_MONTH_STAGE"  (
                  "USER_ID" CHAR(15) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "TEST_FLAG" CHAR(1) , 
                  "SIM_CODE" CHAR(15) , 
                  "USERTYPE_ID" CHAR(4) , 
                  "CREATE_DATE" CHAR(15) , 
                  "BRAND_ID" CHAR(4) , 
                  "TIME_ID" INTEGER )   
                 DISTRIBUTE BY HASH("USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




declare global temporary table session.int_check_user_status
     (
                  "USER_ID" CHAR(15) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "TEST_FLAG" CHAR(1) , 
                  "SIM_CODE" CHAR(15) , 
                  "USERTYPE_ID" CHAR(4) , 
                  "CREATE_DATE" CHAR(15) , 
                  "BRAND_ID" CHAR(4) , 
                  "TIME_ID" INTEGER )                            
partitioning key           
 (
   user_id    
 ) using hashing           
with replace on commit preserve rows not logged in tbs_user_temp




--抓取用户资料入表
insert into session.int_check_user_status(
     user_id    
    ,product_no 
    ,test_flag  
    ,sim_code   
    ,usertype_id  
    ,create_date
    ,brand_id
    ,time_id )
select e.user_id
    ,e.product_no  
    ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
    ,e.sim_code
    ,f.usertype_id  
    ,e.create_date  
    ,e.brand_id
    ,f.time_id       
from (select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id<=20110531 ) e
inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where time_id<=20110531 ) f on f.user_id=e.user_id
where e.row_id=1 and f.row_id=1
and f.usertype_id NOT IN ('2010','2020','2030','9000')

select count(distinct user_id) from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id/100 = 201105
                          
                          
                          
select * from  bass1.g_a_02004_02008_stage 
fetch first 10 rows only 

bass1.g_a_02004_02008_stage 


select * from bass1.g_a_02004_02008_stage  

select count(distinct user_id) from  bass1.g_a_02004_02008_stage  
                        where USERSTATUS IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id/100 = 201112
                          
        1
58854
                  
                          
select count(0) from  bass1.g_a_02004_02008_stage 
                          
                          
                          

select * from  bass1.g_a_02004_02062_simcode
                          
                          

select count(0) from bass1.g_a_02004_day where time_id = 20111228

4495
1
4495

        declare global temporary table session.int_check_user_status
                                (
                           user_id        CHARACTER(15),
                           product_no     CHARACTER(15),
                           test_flag      CHARACTER(1),
                           sim_code       CHARACTER(15),
                           usertype_id    CHARACTER(4),
                           create_date    CHARACTER(15),
                           time_id        int
                                )                            
                                partitioning key           
                                 (
                                   user_id    
                                 ) using hashing           
                                with replace on commit preserve rows not logged in tbs_user_temp

       insert into session.int_check_user_status (
                                                                 user_id    
                                                                ,product_no 
                                                                ,test_flag  
                                                                ,sim_code   
                                                                ,usertype_id  
                                                                ,create_date
                                                                ,time_id )
                                        select e.user_id
                                                                ,e.product_no  
                                                                ,case when e.usertype_id in ('1','2') then '0' else '1' end  test_flag
                                                                ,e.sim_code
                                                                ,f.usertype_id  
                                                                ,e.create_date  
                                                                ,f.time_id       
                                        from (select user_id,create_date,product_no,sim_code,usertype_id
                                                                                        ,row_number() over(partition by user_id order by time_id desc ) row_id   
                                              from bass1.g_a_02004_day
                                              where time_id<=20111228 ) e
                                        inner join ( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
                                                                       from bass1.g_a_02008_day
                                                                       where time_id<=20111228 ) f on f.user_id=e.user_id
                                        where e.row_id=1 and f.row_id=1
                          
                    select count(0) from   session.int_check_user_status    
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id= 20111228             
                          
                         
drop table "BASS1   "."G_A_02004_02008_STAGE" 
CREATE TABLE "BASS1   "."G_A_02004_02008_STAGE"  (
                  "USER_ID" CHAR(15) , 
                  "PRODUCT_NO" CHAR(15) , 
                  "TEST_FLAG" CHAR(1) , 
                  "SIM_CODE" CHAR(15) , 
                  "USERTYPE_ID" CHAR(1) , 
                  "USERSTATUS" CHAR(4) , 
                  "CREATE_DATE" CHAR(15) , 
                  "BRAND_ID" CHAR(4) , 
                  "TIME_ID" INTEGER , 
                  "CUST_ID" CHAR(20) , 
                  "USER_BUS_TYP_ID" CHAR(2) , 
                  "IMSI" CHAR(15) , 
                  "CMCC_ID" CHAR(5) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "MCV_TYP_ID" CHAR(1) , 
                  "PROMPT_TYPE" CHAR(1) , 
                  "SUBS_STYLE_ID" CHAR(2) )   
                 DISTRIBUTE BY HASH("USER_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

                         select count(0) from bass1.g_a_02004_day where time_id = 20111228
                    select count(0) from   session.int_check_user_status    

 where test_flag='0'
  and create_date= '20111228'
   
  
  
  
  
  select 
time_id / 100
,sum(bigint(TARGET1))
,sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
group by time_id / 100
order by 1 desc 



select sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
and time_id / 100  = 201112
with ur



select ((
select count(distinct user_id) from  bass1.g_a_02004_02008_stage  
                        where USERSTATUS IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id/100 = 201112
			  ) *1.00/(
select sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
and time_id / 100  = 201112
)-1)*100
from bass2.dual




select
(
select count(distinct user_id) from  bass1.g_a_02004_02008_stage  
                        where USERSTATUS IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id/100 = 201112
			  ) MONTH_OFF
,(
select sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
and time_id / 100  = 201112
)  MONTH_ALL_DAY_OFF
, ((
select count(distinct user_id) from  bass1.g_a_02004_02008_stage  
                        where USERSTATUS IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          and time_id/100 = 201112
			  ) *1.00/(
select sum(bigint(TARGET2))
from bass1.g_rule_check
where 
rule_code='R159_4'
and time_id / 100  = 201112
)-1)*100 PERCENT
from bass2.dual



select *
from  BASS1.G_RULE_CHECK 
 	  				where rule_code in ('R023','R024') 
                    
                    
                    
                    
                   
delete from  app.sch_control_map where PROGRAM_NAME = 'INT_CHECK_R023R024_DAY.tcl';
insert into app.sch_control_map values (2,'INT_CHECK_R023R024_DAY.tcl' , 'BASS1_INT_CHECK_R023R024_DAY.tcl') ;

delete from  bass1.int_program_data where PROGRAM_NAME = 'INT_CHECK_R023R024_DAY.tcl';

insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'INT_CHECK_R023R024_DAY.tcl' , 'G_A_02028_DAY.BASS1' , 'G_A_02028_DAY_e' , 'G_A_02028_DAY_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';


                   
                   
                   delete from  bass1.int_program_data where PROGRAM_NAME = 'INT_CHECK_R023R024_DAY.tcl';

insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'INT_CHECK_R023R024_DAY.tcl' , 'G_A_02028_DAY.BASS1' , 'G_A_02028_DAY_e' , 'G_A_02028_DAY_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';



select * from 
 BASS1.G_RULE_CHECK 
                                        where time_id=20111228 and rule_code in ('R023NEW','R024NEW')
                                        
                                        
               22012
                         

select sum(bigint(target1))*1.00/30 from    BASS1.G_RULE_CHECK        
where rule_code = 'R161_4'
AND       time_id / 100 = 201112
and time_id <= 20111228

                       
                       
select sum(bigint(target1))*1.00/28 from    BASS1.G_RULE_CHECK        
where rule_code = 'R161_4'
AND       time_id / 100 = 201112
and time_id <= 20111228


select * from app.sch_control_before 
where before_control_code like '%item%'
and control_code like 'BASS1%DAY%'




CONTROL_CODE	BEFORE_CONTROL_CODE
BASS1_G_S_22066_DAY.tcl	BASS2_Dw_acct_payitem_dm.tcl
BASS1_G_S_03006_DAY.tcl	BASS2_Dw_acct_payitem_dm.tcl
BASS1_G_S_22012_DAY.tcl	BASS2_Dw_acct_shoulditem_ds.tcl
BASS1_G_A_02051_DAY.tcl	BASS2_Dw_acct_shoulditem_ds.tcl
BASS1_G_S_3_DAY.tcl	BASS2_Dw_acct_shoulditem_today_ds.tcl
BASS1_G_S_22080_DAY.tcl	BASS2_Dw_three_item_stat_dm.tcl




R037
R038
R039
R040



select *
from    BASS1.G_RULE_CHECK        
where rule_code in( 'R037','R038','R039','R040')
and time_id = 201111




select *
                 from 
                    bass2.dw_acct_shoulditem_today_20111223 a,
                    bass2.dw_product_20111223  b
                 where
                   a.user_id=b.user_id
                   and b.product_no in ('98910037662','98910037691','98910037653')
                   
                   

select * from syscat.tables where tabname like '%DRTYPE%'

select * from bass2.dim_dr_type
where     drtype_id in (5103,1222,61102)

               
               
               CREATE TABLE "BASS1   "."G_S_22038_DAY_20111231"  (
                  "TIME_ID" INTEGER , 
                  "BILL_DATE" CHAR(8) NOT NULL , 
                  "BRAND_ID" CHAR(1) NOT NULL , 
                  "INCOME" CHAR(15) NOT NULL , 
                  "D_COMM_USERS" CHAR(10) NOT NULL , 
                  "M_COMM_USERS" CHAR(10) NOT NULL , 
                  "D_VOICE_USERS" CHAR(10) NOT NULL , 
                  "M_VOICE_USERS" CHAR(10) NOT NULL , 
                  "D_INCR_USERS" CHAR(10) NOT NULL , 
                  "M_INCR_USERS" CHAR(10) NOT NULL , 
                  "W_COMM_NUMS" CHAR(10) NOT NULL , 
                  "D_INCR_FEE" CHAR(15) NOT NULL , 
                  "D_VOICE_INCR_FEE" CHAR(15) NOT NULL , 
                  "D_SMS_FEE" CHAR(15) NOT NULL , 
                  "D_OTHER_FEE" CHAR(15) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 



--insert into G_S_22038_DAY_20111231
select * from G_S_22038_DAY
where  time_id = 20111223





select b.user_id,b.PRODUCT_NO,a.*
                 from 
                    bass2.dw_acct_shoulditem_today_20111223 a,
                    bass2.dw_product_20111223  b
                 where
                   a.user_id=b.user_id
                   and b.product_no in ('98910037662','98910037691','98910037653')
                   
                   
                   
                   
select
                   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
                   bigint(sum(a.fact_fee)*100),
                   0,0,0,0,0, 0,0,0,0,0, 0
                 from 
                    bass2.dw_acct_shoulditem_today_20111223 a,
                    bass2.dw_product_20111223  b
                 where
                   a.user_id=b.user_id
                   and   b.product_no in ('98910037662','98910037691','98910037653')
                   and a.ITEM_ID in (80000797)
                 group by
                   b.brand_id 

                   
select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0,0,0
                from
                  bass2.dw_acct_shoulditem_today_20111223 a,
                  bass2.dw_product_20111223  b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100 in (4,5,6,7)
                  and a.user_id=b.user_id
                   and   b.product_no in ('98910037662','98910037691','98910037653')
                   and a.ITEM_ID in (80000797)		  
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2') 
		  



select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0,0
                from
                  bass2.dw_acct_shoulditem_today_20111223 a,
                  bass2.dw_product_20111223  b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100=5
                  and a.user_id=b.user_id
		                     and   b.product_no in ('98910037662','98910037691','98910037653')
                   and a.ITEM_ID in (80000797)		
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
		  




 select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0
                from
                  bass2.dw_acct_shoulditem_today_20111223 a,
                  bass2.dw_product_20111223 b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100=6
                  and a.user_id=b.user_id
                  		                     and   b.product_no in ('98910037662','98910037691','98910037653')
                   and a.ITEM_ID in (80000797)		
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')
		  
		  

                   
select
                   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
                   bigint(sum(a.fact_fee)*100),
                   0,0,0,0,0, 0,0,0,0,0, 0
                 from 
                    bass2.dw_acct_shoulditem_today_20111227 a,
                    bass2.dw_product_20111227  b
                 where
                   a.user_id=b.user_id
                   and   b.product_no in ('98910037946','98910037868')
                   and a.ITEM_ID in (80000798)
                 group by
                   b.brand_id 


select
                   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
                   bigint(sum(a.fact_fee)*100),
                   0,0,0,0,0, 0,0,0,0,0, 0
                 from 
                    bass2.dw_acct_shoulditem_today_20111228 a,
                    bass2.dw_product_20111228  b
                 where
                   a.user_id=b.user_id
                   and   b.product_no in ('98910037992')
                   and a.ITEM_ID in (80000797)
                 group by
                   b.brand_id 




                   

select * from G_S_22038_DAY where  time_id = 20111223 
                   
                   
                   select * from G_S_22038_DAY where  time_id = 20111228


select * from G_S_22038_DAY where  time_id = 20111227
                   
                   



select sum(fact_fee),sum(case when b.product_no in ('98910037662','98910037691','98910037653') then fact_fee else 0 end )
                 from 
                    bass2.dw_acct_shoulditem_today_20111223 a,
                    bass2.dw_product_20111223  b
                 where
                   a.user_id=b.user_id
                   
                   
1	2
6259924.83	2016100.00

                   

select distinct item_id 
                 from 
                    bass2.dw_acct_shoulditem_today_20111223 a,
                    bass2.dw_product_20111223  b
                 where
                   a.user_id=b.user_id
                   and a.product_no like '9%'
                   
                   
                   
                   
                   
b.product_no in ('98910037662','98910037691','98910037653')              
                   
select
   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
   bigint(sum(a.fact_fee)*100),
   bigint(sum(case when b.product_no in ('98910037662','98910037691','98910037653') then a.fact_fee else 0 end )*100)
 from 
    bass2.dw_acct_shoulditem_today_20111223 a,
    bass2.dw_product_20111223  b
 where
   a.user_id=b.user_id
 group by
   b.brand_id 



select
   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
   bigint(sum(a.fact_fee)*100),
   bigint(sum(case when b.product_no in ('98910037946','98910037868') then a.fact_fee else 0 end )*100)
 from 
    bass2.dw_acct_shoulditem_today_20111227 a,
    bass2.dw_product_20111227  b
 where
   a.user_id=b.user_id
 group by
   b.brand_id 


select
   coalesce(bass1.fn_get_all_dim('BASS_STD1_0055',char(b.brand_id)),'2'),
   bigint(sum(a.fact_fee)*100),
   bigint(sum(case when b.product_no in ('98910037992') then a.fact_fee else 0 end )*100)
 from 
    bass2.dw_acct_shoulditem_today_20111228 a,
    bass2.dw_product_20111228  b
 where
   a.user_id=b.user_id
 group by
   b.brand_id 




update (select * from G_S_22038_DAY where  time_id = 20111223 ) a 
set income = char(bigint(income)-201610000)
where BRAND_ID = '2' and income = '413869654'

update (select * from G_S_22038_DAY where  time_id = 20111227 ) a 
set income = char(bigint(income)-112320000)
where BRAND_ID = '2' and income = '320755720'



update (select * from G_S_22038_DAY where  time_id = 20111228 ) a 
set income = char(bigint(income)-218006200)
where BRAND_ID = '2' and income = '407818214'


select sum(bigint(income)) from    G_S_22038_DAY where     time_id in ( 20111228  ,20111227,20111223)   
1
1786084207
1
1254148007
       
select sum(bigint(income)) from    G_S_22038_DAY_20111231 where     time_id in ( 20111228  ,20111227,20111223)          

    1
1786084207
            
select sum(bigint(income)) from    G_S_22038_DAY where     time_id in ( 20111228  ,20111227,20111223)   and brand_id = '2'
      1
610507388
      
select sum(bigint(income)) from    G_S_22038_DAY_20111231 where     time_id in ( 20111228  ,20111227,20111223)    and brand_id = '2'      

---------------------
1
1142443588


select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0,0,0
                from
                  bass2.dw_acct_shoulditem_today_20111228 a,
                  bass2.dw_product_20111228  b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100 in (4,5,6,7)
                  and a.user_id=b.user_id
                                                        and   b.product_no in ('98910037992')
                   and a.ITEM_ID in (80000797)  
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2') 
		  
		  

select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0,0
                from
                  bass2.dw_acct_shoulditem_today_20111228 a,
                  bass2.dw_product_20111228  b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100=5
                  and a.user_id=b.user_id
		                                                      and   b.product_no in ('98910037992')
                   and a.ITEM_ID in (80000797)
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')

 select 
                   COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2'),
                   0,0,0,0,0,0,0,0,0,0,
                   sum(a.fact_fee)*100,
                   0
                from
                  bass2.dw_acct_shoulditem_today_20111228 a,
                  bass2.dw_product_20111228 b
                where
                  int(coalesce(bass1.fn_get_all_dim('BASS_STD1_0074',char(a.item_id)),'0901'))/100=6
                  and a.user_id=b.user_id
                  		                                                         and   b.product_no in ('98910037992')
                   and a.ITEM_ID in (80000797)
                group by 
                  COALESCE(BASS1.FN_GET_ALL_DIM('BASS_STD1_0055',char(brand_id)),'2')

		                     
                             

update app.g_runlog 
set return_flag=0
where time_id in (20111223,20111227,20111228)
and return_flag=1
and unit_code = '22038'


                             
select * from    app.g_runlog 
where    time_id in (20111223,20111227,20111228)
      and unit_code = '22038'
                   
                   

select (
select sum(bigint(income)) from    G_S_22038_DAY where     time_id in ( 20111228  ,20111227,20111223)   
) 调整后
,(
select sum(bigint(income)) from    G_S_22038_DAY_20111231 where     time_id in ( 20111228  ,20111227,20111223)          
) 调整前
 , (
select sum(bigint(income)) from    G_S_22038_DAY_20111231 where     time_id in ( 20111228  ,20111227,20111223)          
)-
 (
select sum(bigint(income)) from    G_S_22038_DAY where     time_id in ( 20111228  ,20111227,20111223)   
) 调整值
from bass2.dual



select * from  table( bass1.get_after('22038')) a 


select * from bass1.mon_all_interface 
where interface_code in ('02018','02019','02020','02021')                   




select * from G_S_22091_DAY

select count(0) from G_S_22091_DAY
select count(0) from G_S_22091_DAY_OLD_20111201

delete from G_S_22091_DAY
INSERT INTO G_S_22091_DAY
(
         TIME_ID
        ,DEAL_DATE
        ,CHANNEL_ID
        ,DEAL_TYPE
        ,NEW_USER_CNT
        ,PAYMENT_REC_CNT
        ,PAYMENT_REC_FEE
        ,CARD_SALE_CNT
        ,VAL_BUSI_REC_CNT
        ,VAL_BUSI_OPEN_CNT
        ,IMP_VAL_OPEN_CNT
        ,TERM_CONTRACT_SALE_CNT
        ,TERM_SINGLE_SALE_CNT
        ,TERM_SALE_CNT
        ,MOBILE_SALE_CNT
        ,TERM_UNITE_SALE_CNT
        ,BASE_REC_CNT
        ,QRY_REC_CNT
)
SELECT 
         TIME_ID
        ,DEAL_DATE
        ,CHANNEL_ID
        ,DEAL_TYPE
        ,NEW_USER_CNT
        ,PAYMENT_REC_CNT
        ,PAYMENT_REC_FEE
        ,CARD_SALE_CNT
        ,VAL_BUSI_REC_CNT
        ,VAL_BUSI_OPEN_CNT
        ,IMP_VAL_OPEN_CNT
        ,'0' TERM_CONTRACT_SALE_CNT
        ,'0' TERM_SINGLE_SALE_CNT
        ,TERM_SALE_CNT
        ,MOBILE_SALE_CNT
        ,'0' TERM_UNITE_SALE_CNT
        ,BASE_REC_CNT
        ,QRY_REC_CNT
FROM G_S_22091_DAY_OLD_20111201





select * from   G_S_22091_DAY
select DEAL_TYPE
,sum(bigint(NEW_USER_CNT)) NEW_USER_CNT
,sum(bigint(PAYMENT_REC_CNT)) PAYMENT_REC_CNT
,sum(bigint(PAYMENT_REC_FEE))PAYMENT_REC_FEE
,sum(bigint(CARD_SALE_CNT))CARD_SALE_CNT
,sum(bigint(VAL_BUSI_REC_CNT))VAL_BUSI_REC_CNT
,sum(bigint(VAL_BUSI_OPEN_CNT))VAL_BUSI_OPEN_CNT
,sum(bigint(IMP_VAL_OPEN_CNT))IMP_VAL_OPEN_CNT
,sum(bigint(TERM_SALE_CNT))TERM_SALE_CNT
,sum(bigint(MOBILE_SALE_CNT))MOBILE_SALE_CNT
,sum(bigint(BASE_REC_CNT))BASE_REC_CNT
,sum(bigint(QRY_REC_CNT))QRY_REC_CNT
from   bass1.G_S_22091_DAY_OLD_20111201 where time_id  = 20111130
group by DEAL_TYPE


RENAME BASS1.G_S_22091_DAY TO G_S_22091_DAY_OLD_20111201
CREATE TABLE "BASS1   "."G_S_22091_DAY"  (
                  "TIME_ID" INTEGER , 
                  "DEAL_DATE" CHAR(8) , 
                  "CHANNEL_ID" CHAR(40) , 
                  "DEAL_TYPE" CHAR(1) , 
                  "NEW_USER_CNT" CHAR(8) , 
                  "PAYMENT_REC_CNT" CHAR(10) , 
                  "PAYMENT_REC_FEE" CHAR(10) , 
                  "CARD_SALE_CNT" CHAR(8) , 
                  "VAL_BUSI_REC_CNT" CHAR(10) , 
                  "VAL_BUSI_OPEN_CNT" CHAR(10) , 
                  "IMP_VAL_OPEN_CNT" CHAR(10) , 
		  TERM_CONTRACT_SALE_CNT CHAR(10),
		  TERM_SINGLE_SALE_CNT CHAR(10),
                  "TERM_SALE_CNT" CHAR(10) , 
                  "MOBILE_SALE_CNT" CHAR(10) , 
		  TERM_UNITE_SALE_CNT CHAR(10),
		  "BASE_REC_CNT" CHAR(10) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("DEAL_DATE",  
                 "CHANNEL_ID",  
                 "DEAL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 

        select 
        20111127 time_id
        ,replace(char(a.OP_TIME),'-','') OP_TIME
        ,'1' CHRG_TYPE
        ,char(bigint(sum(case when OPT_CODE = '4158' then AMOUNT else 0 end ))) CHRG_AMT
        ,char(bigint(sum(case when OPT_CODE = '4159' then AMOUNT else 0 end ))) FAULT_CHRG_AMT
        from BASS2.dw_acct_payment_dm_201111 a
        where  OPT_CODE in ('4158','4159')
        group by replace(char(a.OP_TIME),'-','')
        
        select sum(amount)
                from BASS2.dw_acct_payment_dm_201111 a
        where  OPT_CODE in ('4158','4159')
        and replace(char(a.OP_TIME),'-','') = '20111127' 

        select 
        20111127 time_id
        ,'20111127' OP_TIME
        ,'1' CHRG_TYPE
        ,char(bigint(sum(case when OPT_CODE = '4158' then AMOUNT else 0 end ))) CHRG_AMT
        ,char(bigint(sum(case when OPT_CODE = '4159' then AMOUNT else 0 end ))) FAULT_CHRG_AMT
        from BASS2.dw_acct_payment_dm_201111 a
        group by replace(char(a.OP_TIME),'-','')
with ur


select sum(bigint(CHRG_AMT)) from    bass1.G_S_22047_DAY
select * from    bass1.G_S_22047_DAY
 
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 16 days
and flag = 1
and control_code like 'BASS1%CHECK%'
order by alarmtime desc



select count(0) from G_S_21012_MONTH where time_id = 201108
145817

select * from g_s_21012_month fetch first 10 rows only


select sp_code          ,count(0)
from G_S_21012_MONTH
where time_id = 201109
group by sp_code


select 
PAYTYPE_ID
,sum(bigint(INFO_FEE)) 
,sum(bigint(MONTH_FEE)) 
from G_S_04005_DAY
where time_id / 100 = 201108
and SMS_STATUS = '0'
and substr(SERV_CODE,1,4) in ('1062','1066')
group by PAYTYPE_ID


select sum(bigint(INFO_FEE))
from G_S_04004_DAY
where time_id / 100 = 201108
and MM_SEND_STATUS in ('0','1','2','3')
and APPLCN_TYPE in ('3','4')
and  substr(SVC_CODE,1,4) in ('1062','1066')
and BILLING_TYPE in ('2','3')



select * from G_S_04004_DAY fetch first 10 rows only 
 

select BILLING_TYPE, sum(bigint(INFO_FEE))
from G_S_04004_DAY
where time_id / 100 = 201108
and MM_SEND_STATUS in ('00','01','02','03')
and APPLCN_TYPE in ('3','4')
and  substr(SVC_CODE,1,4) in ('1062','1066')
group by BILLING_TYPE



select * from    bass2.dw_ent_group_relation_20111031


select * from    bass2.DW_ENT_CM_INDIVIDUAL_INFO_EXT_20111031

select * from    bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111031 fetch first 10 rows only 




select * from   bass2.dw_enterprise_msg_20111117 fetch first 10 rows only 


select * from   bass2.dwd_enterprise_member_info_20111110
select distinct ent_city_id,enterprise_id,enterprise_name,qd_group_id,c.CUST_NAME,industry_id,industry_id2
from bass2.dw_ent_group_relation_20111031 a
,bass2.dw_enterprise_msg_20111117 b 
,bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111031 c 
where a.ZW_GROUP_ID = b.ENTERPRISE_ID
and a.QD_GROUP_ID = c.GROUP_CUST_ID




select count(0) from bass2.dw_ENT_GROUP_RELATION_20111117



select count(0) from   bass2.dw_ENT_GROUP_RELATION_20111117
5153
select count(0) from   bass2.dw_ENT_GROUP_RELATION_20111031
1405

select count(0) from   bass2.dw_ENT_GROUP_RELATION_20111110




select distinct ent_city_id,enterprise_id,enterprise_name,qd_group_id,c.CUST_NAME,industry_id,industry_id2
from bass2.dw_ent_group_relation_20111117 a
,bass2.dw_enterprise_msg_20111117 b 
,bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117 c 
where a.ZW_GROUP_ID = b.ENTERPRISE_ID
and a.QD_GROUP_ID = c.GROUP_CUST_ID



select count(0),count(distinct enterprise_id) ,count(distinct qd_group_id ) ,count(0)
from bass2.dw_ent_group_relation_20111117 a
,bass2.dw_enterprise_msg_20111117 b 
,bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117 c 
where a.ZW_GROUP_ID = b.ENTERPRISE_ID
and a.QD_GROUP_ID = c.GROUP_CUST_ID


select count(0),count(distinct zw_group_id) ,count(distinct qd_group_id ) ,count(zw_group_id||qd_group_id)
from bass2.dw_ent_group_relation_20111117 


select * from   G_A_01007_DAY


TIME_ID
ENTERPRISE_ID
CUST_ID
RELA_STATE


select ENTERPRISE_ID,CUST_ID
from (
select ENTERPRISE_ID,CUST_ID ,row_number()over(partition by ENTERPRISE_ID,CUST_ID order by time_id desc ) rn 
from G_A_01007_DAY
)t  where rn = 1


select * from bass2.dw_ent_group_relation_20111117 


select INDUSTRY_CODE,INDUSTRY_CODE2,ESP_INDUSTRY,ESP_INDUSTRY2,ESP_INDUSTRY3,INDUSTRY_NUM from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117 fetch first 10 rows only 
select *
from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117 fetch first 10 rows only 




select 
        GROUP_CUST_ID ENTERPRISE_ID
        ,CUST_NAME ENTERPRISE_NAME
        ,ORGAN_TYPE ORG_TYPE
        ,value(POST_CODE,'') ADRESS_CODE
        ,GROUP_CITY CITY_ID
        ,'' COUNTY_CODE
        ,'' THORPE_CODE
        ,value(POST_ADDRESS,'')  DOORPLATE
        ,POST_POSTCODE DISTRICT_NUM
        ,PHONE TELEPHONE1
        ,PHONE2 TELEPHONT2
        ,POST_POSTCODE POST_CODE
        ,INDUSTRY_CODE INDUSTRY_ID
        ,GROUP_MEMBER_NUM STAFF_CNT
        ,INDUSTRY_NUM UNIT_CNT
        ,ECONOMY_TYPE1 ECONOMY_TYPE
        ,char(year(IN_NET_DATE)) OPEN_YEAR
        ,char(month(IN_NET_DATE)) OPEN_MONTH
        ,CORP_TYPE HOLDING_TYPE
        ,IS_BRANCHED ENTERPRISE_TYPE
        ,'9' OPERATE_TYPE
        ,'' INCOMING_TYPE
        ,'' FUNDS_TYPE
        ,GROUP_STATES STATE
        ,CREATE_DATE CREATE_DATE
        ,SOURCE SOURCE
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117
fetch first 10 rows only 

 


select * from bass2.dim_dr_type
where drtype_name like '%内容%'

select *from bass2.dim_svc_item where svcitem_id in (300001,300002,300003,300004) with ur

select * from dr_sp_billing_20111101

select tabname from syscat.tables where tabname like '%DIM%' and TABSCHEMA = 'BASS1'

select drtype_id,count(0)
from  bass2.cdr_ismg_dtl_20111225
group by drtype_id

select count(0) from bass2.cdr_ismg_dtl_20111225
where  bill_flag = 3 and record_type in (2,12)
and (drtype_id not in (61102) and process_time is not null and substr(sp_code,1,12) is not null
				and svcitem_id in (300001,300002,300003,300004)
			  ) 

select drtype_id,count(0)
from  bass2.Cdr_gprs_local_20111225
group by drtype_id


Cdr_gprs_local_ds

select distinct a from 
(
select '901001' a from bass2.dual union all
select '901002' a from bass2.dual union all
select '901003' a from bass2.dual union all
select '901005' a from bass2.dual union all
select '901012' a from bass2.dual union all
select '901013' a from bass2.dual union all
select '901014' a from bass2.dual union all
select '901021' a from bass2.dual union all
select '901022' a from bass2.dual union all
select '901039' a from bass2.dual union all
select '901040' a from bass2.dual union all
select '901052' a from bass2.dual union all
select '901068' a from bass2.dual union all
select '901069' a from bass2.dual union all
select '901079' a from bass2.dual union all
select '901082' a from bass2.dual union all
select '901083' a from bass2.dual union all
select '901085' a from bass2.dual union all
select '901089' a from bass2.dual union all
select '901091' a from bass2.dual union all
select '901094' a from bass2.dual union all
select '901116' a from bass2.dual union all
select '901118' a from bass2.dual union all
select '901121' a from bass2.dual union all
select '901122' a from bass2.dual union all
select '901128' a from bass2.dual union all
select '901134' a from bass2.dual union all
select '901150' a from bass2.dual union all
select '901168' a from bass2.dual union all
select '901171' a from bass2.dual union all
select '901189' a from bass2.dual union all
select '901410' a from bass2.dual union all
select '901417' a from bass2.dual union all
select '901445' a from bass2.dual union all
select '901446' a from bass2.dual union all
select '901447' a from bass2.dual union all
select '901449' a from bass2.dual union all
select '901500' a from bass2.dual union all
select '901532' a from bass2.dual union all
select '901700' a from bass2.dual union all
select '901708' a from bass2.dual union all
select '901709' a from bass2.dual union all
select '901713' a from bass2.dual union all
select '901714' a from bass2.dual union all
select '901717' a from bass2.dual union all
select '901718' a from bass2.dual union all
select '901721' a from bass2.dual union all
select '901722' a from bass2.dual union all
select '901723' a from bass2.dual union all
select '901729' a from bass2.dual union all
select '901730' a from bass2.dual union all
select '901734' a from bass2.dual union all
select '901736' a from bass2.dual union all
select '901737' a from bass2.dual union all
select '901738' a from bass2.dual union all
select '901743' a from bass2.dual union all
select '901747' a from bass2.dual union all
select '901751' a from bass2.dual union all
select '901752' a from bass2.dual union all
select '901755' a from bass2.dual union all
select '901757' a from bass2.dual union all
select '901758' a from bass2.dual union all
select '901760' a from bass2.dual union all
select '901761' a from bass2.dual union all
select '901763' a from bass2.dual union all
select '901765' a from bass2.dual union all
select '901767' a from bass2.dual union all
select '901768' a from bass2.dual union all
select '901769' a from bass2.dual union all
select '901770' a from bass2.dual union all
select '901771' a from bass2.dual union all
select '901772' a from bass2.dual union all
select '901773' a from bass2.dual union all
select '901775' a from bass2.dual union all
select '901776' a from bass2.dual union all
select '901778' a from bass2.dual union all
select '901779' a from bass2.dual union all
select '901780' a from bass2.dual union all
select '901784' a from bass2.dual union all
select '902006' a from bass2.dual union all
select '902102' a from bass2.dual union all
select '902118' a from bass2.dual union all
select '902138' a from bass2.dual union all
select '902155' a from bass2.dual union all
select '902160' a from bass2.dual union all
select '902950' a from bass2.dual union all
select '909001' a from bass2.dual union all
select '909003' a from bass2.dual union all
select '909007' a from bass2.dual union all
select '909016' a from bass2.dual union all
select '909027' a from bass2.dual union all
select '909049' a from bass2.dual union all
select '909052' a from bass2.dual union all
select '909068' a from bass2.dual union all
select '909099' a from bass2.dual union all
select '909134' a from bass2.dual union all
select '909143' a from bass2.dual union all
select '909159' a from bass2.dual union all
select '909184' a from bass2.dual union all
select '910008' a from bass2.dual union all
select '911028' a from bass2.dual union all
select '911033' a from bass2.dual union all
select '911062' a from bass2.dual union all
select '913007' a from bass2.dual union all
select '913030' a from bass2.dual union all
select '914007' a from bass2.dual union all
select '914017' a from bass2.dual union all
select '914029' a from bass2.dual union all
select '914031' a from bass2.dual union all
select '916006' a from bass2.dual union all
select '916066' a from bass2.dual union all
select '916103' a from bass2.dual union all
select '917038' a from bass2.dual union all
select '917141' a from bass2.dual union all
select '918067' a from bass2.dual union all
select '918145' a from bass2.dual union all
select '919005' a from bass2.dual union all
select '919009' a from bass2.dual union all
select '919013' a from bass2.dual union all
select '919028' a from bass2.dual union all
select '919030' a from bass2.dual union all
select '919110' a from bass2.dual union all
select '919450' a from bass2.dual union all
select '919516' a from bass2.dual union all
select '919533' a from bass2.dual union all
select '919557' a from bass2.dual union all
select '919559' a from bass2.dual union all
select '919571' a from bass2.dual union all
select '919668' a from bass2.dual union all
select '919782' a from bass2.dual union all
select '920020' a from bass2.dual union all
select '920937' a from bass2.dual union all
select '920997' a from bass2.dual union all
select '922015' a from bass2.dual union all
select '922022' a from bass2.dual union all
select '922060' a from bass2.dual union all
select '922459' a from bass2.dual union all
select '930044' a from bass2.dual ) a
except
select distinct a from 
(
select '901001' a from bass2.dual union all
select '901002' a from bass2.dual union all
select '901003' a from bass2.dual union all
select '901005' a from bass2.dual union all
select '901012' a from bass2.dual union all
select '901013' a from bass2.dual union all
select '901014' a from bass2.dual union all
select '901021' a from bass2.dual union all
select '901022' a from bass2.dual union all
select '901039' a from bass2.dual union all
select '901040' a from bass2.dual union all
select '901052' a from bass2.dual union all
select '901053' a from bass2.dual union all
select '901069' a from bass2.dual union all
select '901079' a from bass2.dual union all
select '901081' a from bass2.dual union all
select '901082' a from bass2.dual union all
select '901083' a from bass2.dual union all
select '901085' a from bass2.dual union all
select '901091' a from bass2.dual union all
select '901094' a from bass2.dual union all
select '901116' a from bass2.dual union all
select '901118' a from bass2.dual union all
select '901121' a from bass2.dual union all
select '901122' a from bass2.dual union all
select '901128' a from bass2.dual union all
select '901134' a from bass2.dual union all
select '901145' a from bass2.dual union all
select '901150' a from bass2.dual union all
select '901168' a from bass2.dual union all
select '901171' a from bass2.dual union all
select '901189' a from bass2.dual union all
select '901410' a from bass2.dual union all
select '901417' a from bass2.dual union all
select '901447' a from bass2.dual union all
select '901449' a from bass2.dual union all
select '901532' a from bass2.dual union all
select '901700' a from bass2.dual union all
select '901708' a from bass2.dual union all
select '901713' a from bass2.dual union all
select '901714' a from bass2.dual union all
select '901717' a from bass2.dual union all
select '901718' a from bass2.dual union all
select '901721' a from bass2.dual union all
select '901722' a from bass2.dual union all
select '901723' a from bass2.dual union all
select '901727' a from bass2.dual union all
select '901729' a from bass2.dual union all
select '901730' a from bass2.dual union all
select '901734' a from bass2.dual union all
select '901736' a from bass2.dual union all
select '901737' a from bass2.dual union all
select '901738' a from bass2.dual union all
select '901743' a from bass2.dual union all
select '901747' a from bass2.dual union all
select '901751' a from bass2.dual union all
select '901752' a from bass2.dual union all
select '901755' a from bass2.dual union all
select '901757' a from bass2.dual union all
select '901760' a from bass2.dual union all
select '901761' a from bass2.dual union all
select '901763' a from bass2.dual union all
select '901765' a from bass2.dual union all
select '901767' a from bass2.dual union all
select '901768' a from bass2.dual union all
select '901769' a from bass2.dual union all
select '901771' a from bass2.dual union all
select '901772' a from bass2.dual union all
select '901773' a from bass2.dual union all
select '901775' a from bass2.dual union all
select '901776' a from bass2.dual union all
select '901778' a from bass2.dual union all
select '901779' a from bass2.dual union all
select '901780' a from bass2.dual union all
select '901784' a from bass2.dual union all
select '902006' a from bass2.dual union all
select '902102' a from bass2.dual union all
select '902118' a from bass2.dual union all
select '902155' a from bass2.dual union all
select '902160' a from bass2.dual union all
select '902950' a from bass2.dual union all
select '909001' a from bass2.dual union all
select '909003' a from bass2.dual union all
select '909007' a from bass2.dual union all
select '909027' a from bass2.dual union all
select '909049' a from bass2.dual union all
select '909052' a from bass2.dual union all
select '909099' a from bass2.dual union all
select '909134' a from bass2.dual union all
select '909143' a from bass2.dual union all
select '910008' a from bass2.dual union all
select '910022' a from bass2.dual union all
select '911028' a from bass2.dual union all
select '911033' a from bass2.dual union all
select '911062' a from bass2.dual union all
select '913007' a from bass2.dual union all
select '913030' a from bass2.dual union all
select '914007' a from bass2.dual union all
select '914017' a from bass2.dual union all
select '914029' a from bass2.dual union all
select '914031' a from bass2.dual union all
select '916006' a from bass2.dual union all
select '916066' a from bass2.dual union all
select '916103' a from bass2.dual union all
select '917038' a from bass2.dual union all
select '917141' a from bass2.dual union all
select '918067' a from bass2.dual union all
select '918145' a from bass2.dual union all
select '919009' a from bass2.dual union all
select '919013' a from bass2.dual union all
select '919028' a from bass2.dual union all
select '919516' a from bass2.dual union all
select '919533' a from bass2.dual union all
select '919557' a from bass2.dual union all
select '919559' a from bass2.dual union all
select '919571' a from bass2.dual union all
select '919668' a from bass2.dual union all
select '919782' a from bass2.dual union all
select '920020' a from bass2.dual union all
select '920937' a from bass2.dual union all
select '920997' a from bass2.dual union all
select '922015' a from bass2.dual union all
select '922060' a from bass2.dual union all
select '930044' a from bass2.dual  ) a

select 
distinct sp_code
from G_S_04005_DAY
where time_id / 100 = 201108
and SMS_STATUS = '0'
and substr(SERV_CODE,1,4) in ('1066')


from  bass2.cdr_ismg_dtl_$timeid a
 where (send_state = '0' or send_state is null)
 and substr(ser_code,1,4) in ('1066')
 and svcitem_id in (300001,300002,300003,300004)
 group by bill_flag

select distinct   sp_code,ser_code,bill_flag,svcitem_id,charge4,send_state
from  bass2.cdr_ismg_dtl_20110801 a
where sp_code
in 
(
'901068'
,'901089'
,'901445'
,'901446'
,'901500'
,'901709'
,'901758'
,'901770'
,'902138'
,'909016'
,'909068'
,'909159'
,'909184'
,'919005'
,'919030'
,'919110'
,'919450'
,'922022'
,'922459'
)





select  CHANNEL_TYPE,count(0) ,count(distinct channel_id)
--,  count(distinct time_id ) 
from
(
select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
from G_A_06035_DAY a
where time_id / 100 = 201110
) t where t.rn =1  and CHNL_STATE = '1'

group by  CHANNEL_TYPE
order by 1 



select CHANNEL_TYPE , count(0) ,count(distinct channel_id)
--,  count(distinct CHANNEL_TYPE ) 
from G_I_06021_MONTH 
where time_id = 201110
and CHANNEL_STATUS = '1'
group by  CHANNEL_TYPE 
order by 1 



select channel_id
--,  count(distinct time_id ) 
from
(
select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
from G_A_06035_DAY a
where time_id / 100 <= 201110
) t where t.rn =1 and CHNL_STATE = '1'
except
select channel_id
--,  count(distinct CHANNEL_TYPE ) 
from G_I_06021_MONTH 
where time_id = 201110
and CHANNEL_STATUS = '1'
order by 1 


CHANNEL_ID
100002903,93000097                                

select count(0)  from G_A_06035_DAY a


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06035_DAY 
where time_id / 100 = 201110
group by  time_id 
order by 1 


select count(0) from bass2.dw_channel_info_201110
CHANNEL_ID in (
100000324                               
100001572                               
100001735                               
100002256                               
100002273                               
100002903                               
10590003                                
93000097                                
96000008                                
96000023                                
96000108                                
96000287                                
)



select * from G_A_06035_DAY
where bigint(CHANNEL_ID) in (
100002903                               
,93000097                              
)


100001735

CHANNEL_ID
100002903                               
93000097                                




select count(0) from bass2.dw_channel_info_201109
where CHANNEL_ID in (
100002903                               
,93000097                          
)

G_A_06035_DAY

select  *

from G_A_06035_DAY
where channel_id in (
select channel_id
--,  count(distinct time_id ) 
from
(
select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
from G_A_06035_DAY a
where time_id / 100 <=  201111
) t where t.rn =1 and CHNL_STATE = '1'
except
select char(a.channel_id)
from bass2.dim_channel_info a
where a.channel_type_class in (90105,90102)
)


select * from bass2.ods_channel_info_20111124 a
where CHANNEL_ID in (
95000071                                
,93000097                                
,100002903                               
,100001975                               
,100001717                               
)

and a.channel_type_class in (90105,90102)



CREATE TABLE "BASS1   "."G_A_06035_DAY_NEWEST"  (
                  "TIME_ID" INTEGER , 
                  "CHANNEL_ID" CHAR(40) , 
                  "CHANNEL_TYPE" CHAR(1) , 
                  "SELF_24_IND" CHAR(25) , 
                  "CMCC_ID" CHAR(5) , 
                  "COUNTY" CHAR(30) , 
                  "REGION" CHAR(50) , 
                  "CHANNEL_NAME" CHAR(100) , 
                  "CHANNEL_ADDR" CHAR(100) , 
                  "CHNL_MANAGER_NAME" CHAR(40) , 
                  "CHNL_MANAGER_PHONE" CHAR(40) , 
                  "GEO_ID" CHAR(1) , 
                  "AREA_TYPE" CHAR(1) , 
                  "CHANNEL_BASE_TYPE" CHAR(1) , 
                  "IF_EX" CHAR(1) , 
                  "IF_MOB_SALEHALL" CHAR(1) , 
                  "CHNL_STAR" CHAR(1) , 
                  "CHNL_STATE" CHAR(1) , 
                  "OPEN_TIME" CHAR(4) , 
                  "CLOSE_TIME" CHAR(4) , 
                  "CONTRACT_EFF_DT" CHAR(8) , 
                  "CONTRACT_END_DT" CHAR(8) , 
                  "CO_OP_DUR" CHAR(4) , 
                  "LONGTITUDE" CHAR(10) , 
                  "LATITUDE" CHAR(10) , 
                  "ZX_INVEST_FEE" CHAR(10) , 
                  "SB_INVEST_FEE" CHAR(10) , 
                  "OFFICE_INVEST_FEE" CHAR(10) , 
                  "SUBSIDY_FEE" CHAR(10) )   
                 DISTRIBUTE BY HASH("CHANNEL_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select * from G_A_06035_DAY_NEWEST

insert into G_A_06035_DAY_NEWEST
select 
        20111124 TIME_ID
        ,CHANNEL_ID
        ,CHANNEL_TYPE
        ,SELF_24_IND
        ,CMCC_ID
        ,COUNTY
        ,REGION
        ,CHANNEL_NAME
        ,CHANNEL_ADDR
        ,CHNL_MANAGER_NAME
        ,CHNL_MANAGER_PHONE
        ,GEO_ID
        ,AREA_TYPE
        ,CHANNEL_BASE_TYPE
        ,IF_EX
        ,IF_MOB_SALEHALL
        ,CHNL_STAR
        ,CHNL_STATE
        ,OPEN_TIME
        ,CLOSE_TIME
        ,CONTRACT_EFF_DT
        ,CONTRACT_END_DT
        ,CO_OP_DUR
        ,LONGTITUDE
        ,LATITUDE
        ,ZX_INVEST_FEE
        ,SB_INVEST_FEE
        ,OFFICE_INVEST_FEE
        ,SUBSIDY_FEE
from (
select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
from G_A_06035_DAY a
where time_id / 100 <=  201111
) t where t.rn =1 and CHNL_STATE = '1'



select 
        20111124 TIME_ID
        ,CHANNEL_ID
        ,CHANNEL_TYPE
        ,SELF_24_IND
        ,CMCC_ID
        ,COUNTY
        ,REGION
        ,CHANNEL_NAME
        ,CHANNEL_ADDR
        ,CHNL_MANAGER_NAME
        ,CHNL_MANAGER_PHONE
        ,GEO_ID
        ,AREA_TYPE
        ,CHANNEL_BASE_TYPE
        ,IF_EX
        ,IF_MOB_SALEHALL
        ,CHNL_STAR
        ,'3' CHNL_STATE
        ,OPEN_TIME
        ,CLOSE_TIME
        ,CONTRACT_EFF_DT
        ,CONTRACT_END_DT
        ,CO_OP_DUR
        ,LONGTITUDE
        ,LATITUDE
        ,ZX_INVEST_FEE
        ,SB_INVEST_FEE
        ,OFFICE_INVEST_FEE
        ,SUBSIDY_FEE
from G_A_06035_DAY_NEWEST a
where char(a.channel_id) not in 
(
select char(a.channel_id)
from bass2.dim_channel_info a
where a.channel_type_class in (90105,90102)
)



                select CHANNEL_ID,count(0)  cnt
                from bass1.G_A_06035_DAY
                where time_id =20111124
                group by CHANNEL_ID having count(0) > 1
                

select * from bass2.dim_channel_info where channel_id = 91000178
                
                

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06037_DAY 
group by  time_id 
order by 1 

                
                
select * from bass1.G_I_06023_MONTH
where time_id = 201110
                
                
select * from G_S_21002_DAY
                

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06035_DAY 
group by  time_id 
order by 1 

                
                
select * from   bass2.Dwd_channel_selfsite_info_20111127

                
                

select DEAL_TYPE
,sum(bigint(NEW_USER_CNT)) NEW_USER_CNT
,sum(bigint(PAYMENT_REC_CNT)) PAYMENT_REC_CNT
,sum(bigint(PAYMENT_REC_FEE))PAYMENT_REC_FEE
,sum(bigint(CARD_SALE_CNT))CARD_SALE_CNT
,sum(bigint(VAL_BUSI_REC_CNT))VAL_BUSI_REC_CNT
,sum(bigint(VAL_BUSI_OPEN_CNT))VAL_BUSI_OPEN_CNT
,sum(bigint(IMP_VAL_OPEN_CNT))IMP_VAL_OPEN_CNT
,sum(bigint(TERM_SALE_CNT))TERM_SALE_CNT
,sum(bigint(MOBILE_SALE_CNT))MOBILE_SALE_CNT
,sum(bigint(BASE_REC_CNT))BASE_REC_CNT
,sum(bigint(QRY_REC_CNT))QRY_REC_CNT
from   G_S_22091_DAY where time_id / 100 = 201110
and channel_id = '50500107'
group by DEAL_TYPE

50500107


100001963
100002329
100003003


select *                
from G_I_06021_MONTH 
where time_id = 201110
and channel_id in ( '100001666','100002329','100003003')


select *
from bass2.dim_channel_info 
where char( channel_id) in ( '100001666','100002329','100003003')

select count(0) from  bass2.dw_product_ins_off_ins_prod_201110
where ORG_ID = 100003003

select * from   bass2.dw_channel_info_201110
where  char( channel_id) in ( '100001666','100002329','100003003')

ORGANIZE_ID
382161
381532
382825



select count(0) from  bass2.dw_product_ins_off_ins_prod_201110
where char(ORG_ID)  in ( '382161','381532','382825')

select * 
from bass1.g_s_22091_day where TIME_ID / 100 = 201111




select time_id
,sum(bigint(NEW_USER_CNT)) NEW_USER_CNT
,sum(bigint(PAYMENT_REC_CNT)) PAYMENT_REC_CNT
,sum(bigint(PAYMENT_REC_FEE))PAYMENT_REC_FEE
,sum(bigint(CARD_SALE_CNT))CARD_SALE_CNT
,sum(bigint(VAL_BUSI_REC_CNT))VAL_BUSI_REC_CNT
,sum(bigint(VAL_BUSI_OPEN_CNT))VAL_BUSI_OPEN_CNT
,sum(bigint(IMP_VAL_OPEN_CNT))IMP_VAL_OPEN_CNT
,sum(bigint(TERM_SALE_CNT))TERM_SALE_CNT
,sum(bigint(MOBILE_SALE_CNT))MOBILE_SALE_CNT
,sum(bigint(BASE_REC_CNT))BASE_REC_CNT
,sum(bigint(QRY_REC_CNT))QRY_REC_CNT
from   G_S_22091_DAY where time_id / 100 = 201111
and channel_id = '11111115'
group by time_id


select count(0) from G_S_22091_DAY where time_id  = 20111113

select  count(0) 
,sum(bigint(BUSI_REC_CNT))
,sum(bigint(CHRG_REC_CNT))
,sum(bigint(CHRG_REC_FEE))
--,  count(distinct TIME_ID ) 
from G_S_22066_DAY 
where time_id / 100 = 201110
order by 1 



rename G_S_22047_DAY to G_S_22047_DAY_CANCEL_OLD;
rename G_S_22062_MONTH to G_S_22062_MONTH_CANCEL_OLD;
rename G_S_02048_MONTH to G_S_02048_MONTH_CANCEL_OLD;




CREATE TABLE G_S_22062_MONTH (
         TIME_ID                INTEGER             ---- 记录行号;      
        ,OP_MONTH               CHAR(6)             ---- 月份;联合主键  
        ,CHANNEL_ID             CHAR(40)            ---- 社会渠道标识;联合主键
        ,NUM_ACT_REWARD         CHAR(10)            ---- 卡号销售实发酬金;
        ,NUM_SHLD_REWARD        CHAR(10)            ---- 卡号销售应发酬金;
        ,NUM_INIT_REWARD        CHAR(10)            ---- 卡号销售首付酬金;
        ,NUM_DELAY_ACT_REWARD   CHAR(10)            ---- 卡号销售递延实发酬金;
        ,NUM_DELAY_SHLD_REWARD  CHAR(10)            ---- 卡号销售递延应发酬金;
        ,DAISHOU_REWARD         CHAR(10)            ---- 网点代收话费酬金;
        ,TERM_AGREE_REWARD      CHAR(10)            ---- 合约计划终端销售酬金;
        ,TERM_ONLY_REWARD       CHAR(10)            ---- 终端裸机销售酬金;
        ,TERM_CUSTOMIZE_REWARD  CHAR(10)            ---- 定制终端销售酬金;
        ,TERM_MOBILE_REWARD     CHAR(10)            ----    其中定制手机销售酬金;
        ,TERM_JICAI_REWARD      CHAR(10)            ---- 集采终端销售酬金;
        ,VAL_TYPE1_REWARD       CHAR(10)            ---- 增值业务包月类型一酬金;
        ,VAL_TYPE2_REWARD       CHAR(10)            ---- 增值业务包月类型二酬金;
        ,VAL_TYPE3_REWARD       CHAR(10)            ---- 增值业务包月类型三酬金;
        ,STORE_SUSIDY           CHAR(10)            ---- 门店补贴;      
        ,SALE_ACTIVE_REWARD     CHAR(10)            ---- 销售激励;      
        ,ADD_REWARD             CHAR(10)            ---- 奖励酬金;      
        ,B_CLASS_REWARD         CHAR(10)            ---- B类目录酬金;   
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( OP_MONTH,CHANNEL_ID ) USING HASHING;

CREATE TABLE G_S_22047_DAY (                  
         TIME_ID                INTEGER             ---- 记录行号;      
        ,OP_TIME                CHAR(8)             ---- 办理日期;联合主键
        ,CHRG_TYPE              CHAR(1)             ---- 充值方式;联合主键
        ,CHRG_AMT               CHAR(10)            ---- 充值卡缴费金额;
        ,FAULT_CHRG_AMT         CHAR(10)            ---- 充值卡冲正金额;
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( OP_TIME,CHRG_TYPE ) USING HASHING;

CREATE TABLE G_S_02048_MONTH (                                      --                  
         TIME_ID                INTEGER             ---- 记录行号;      
        ,USER_ID                CHAR(20)            ---- 用户标识;联合主键
        ,MSISDN                 CHAR(15)            ---- MSISDN;联合主键
        ,IMEI                   CHAR(17)            ---- IMEI号码;联合主键
        ,TERM_TYPE              CHAR(1)             ---- 终端类型;1     
        ,NET_FLOW               CHAR(12)            ---- 上网流量;      
        ,NET_DUR                CHAR(8)             ---- 上网时长;    
	 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( USER_ID,MSISDN,IMEI ) USING HASHING;

delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22047_DAY.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22062_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_02048_MONTH.tcl';



insert into app.sch_control_map values (2,'G_S_22047_DAY.tcl' , 'BASS1_G_S_22047_DAY.tcl') ;
insert into app.sch_control_map values (2,'G_S_22062_MONTH.tcl' , 'BASS1_G_S_22062_MONTH.tcl') ;
insert into app.sch_control_map values (2,'G_S_02048_MONTH.tcl' , 'BASS1_G_S_02048_MONTH.tcl') ;



delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22047_DAY';
delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22062_MONTH';
delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_02048_MONTH';



insert into app.sch_control_map values (2,'EXP_G_S_22047_DAY' , 'BASS1_EXP_G_S_22047_DAY') ;
insert into app.sch_control_map values (2,'EXP_G_S_22062_MONTH' , 'BASS1_EXP_G_S_22062_MONTH') ;
insert into app.sch_control_map values (2,'EXP_G_S_02048_MONTH' , 'BASS1_EXP_G_S_02048_MONTH') ;



delete from  bass1.int_program_data where PROGRAM_NAME = 'G_S_22047_DAY.tcl';
delete from   bass1.int_program_data where PROGRAM_NAME = 'G_S_22062_MONTH.tcl';
delete from   bass1.int_program_data where PROGRAM_NAME = 'G_S_02048_MONTH.tcl';



insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_S_22047_DAY.tcl' , 'G_S_22047_DAY.BASS1' , 'G_S_22047_DAY_e' , 'G_S_22047_DAY_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';
insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_S_22062_MONTH.tcl' , 'G_S_22062_MONTH.BASS1' , 'G_S_22062_MONTH_e' , 'G_S_22062_MONTH_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';
insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_S_02048_MONTH.tcl' , 'G_S_02048_MONTH.BASS1' , 'G_S_02048_MONTH_e' , 'G_S_02048_MONTH_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';



delete from  app.g_unit_info where unit_code = '22047';
delete from  app.g_unit_info where unit_code = '22062';
delete from  app.g_unit_info where unit_code = '02048';


select * from app.g_unit_info  where unit_code = '02048';
insert into app.g_unit_info values ('22047' , 0 , '手机充值卡缴费日汇总' , 'bass1.g_s_22047_day' , 1 , 0 ,0 );
insert into app.g_unit_info values ('22062' , 1 , '社会渠道酬金及补贴信息' , 'bass1.g_s_22062_month' , 1 , 0 , 0);
insert into app.g_unit_info values ('02048' , 1 , '用户使用终端WLAN上网情况' , 'bass1.g_s_02048_month' , 1 , 0 , 0);



insert into app.sch_control_before values 
 ('BASS1_G_S_22047_DAY.tcl' , 'BASS2_Dw_acct_payment_dm.tcl')
,('BASS1_G_S_22047_DAY.tcl' , 'BASS2_Dwd_acct_payment_dm.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_G_S_22062_MONTH.tcl' , '')
;
insert into app.sch_control_before values 
 ('BASS1_G_S_02048_MONTH.tcl' , 'BASS2_Cdr_wlan_ds.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_02048_MONTH' , 'BASS1_G_S_02048_MONTH.tcl')
;

insert into app.sch_control_before values 
 ('BASS1_G_S_22062_MONTH.tcl' , 'REP_stat_channel_reward_0019.tcl')
,('BASS1_G_S_22062_MONTH.tcl' , 'BASS1_G_A_06035_DAY.tcl')
;

insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_22047_DAY' , 'BASS1_G_S_22047_DAY.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_22062_MONTH' , 'BASS1_G_S_22062_MONTH.tcl')
;
insert into app.sch_control_before values 
 ('BASS1_EXP_G_S_02048_MONTH' , 'BASS1_G_S_02048_MONTH.tcl')
;



delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_22047_DAY.tcl','BASS1_EXP_G_S_22047_DAY');
delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_22062_MONTH.tcl','BASS1_EXP_G_S_22062_MONTH');
delete from  app.sch_control_task where control_code in ( 'BASS1_G_S_02048_MONTH.tcl','BASS1_EXP_G_S_02048_MONTH');



insert into app.sch_control_task values('BASS1_G_S_22047_DAY.tcl' , 1 , 2 , 'int -s G_S_22047_DAY.tcl' ,10000,-1,'手机充值卡缴费日汇总' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');
insert into app.sch_control_task values('BASS1_G_S_22062_MONTH.tcl' , 2 , 2 , 'int -s G_S_22062_MONTH.tcl' ,-1,-1,'社会渠道酬金及补贴信息' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');
insert into app.sch_control_task values('BASS1_G_S_02048_MONTH.tcl' , 2 , 2 , 'int -s G_S_02048_MONTH.tcl' ,-1,-1,'用户使用终端WLAN上网情况' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');



insert into app.sch_control_task values('BASS1_EXP_G_S_22047_DAY' , 1 , 2 , 'bass1_export bass1.g_s_22047_day YESTERDAY()' ,10000,-1,'EXPORT_of 手机充值卡缴费日汇总' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');
insert into app.sch_control_task values('BASS1_EXP_G_S_22062_MONTH' , 2 , 2 , 'bass1_export bass1.g_s_22062_month LASTMONTH()' ,-1,-1,'EXPORT_of 社会渠道酬金及补贴信息' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');
insert into app.sch_control_task values('BASS1_EXP_G_S_02048_MONTH' , 2 , 2 , 'bass1_export bass1.g_s_02048_month LASTMONTH()' ,-1,-1,'EXPORT_of 用户使用终端WLAN上网情况' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');



update app.sch_control_task set cc_flag = 2 
where cc_flag = 1
and control_code = 'BASS1_EXP_G_S_02048_MONTH'


update app.sch_control_task set cc_flag = 1
where cc_flag = 2
and control_code = 'BASS1_EXP_G_S_22047_DAY'


select count(0) from G_I_22422_MONTH

rename G_I_22422_MONTH to G_I_22422_MONTH_CANCEL_OLD;
CREATE TABLE G_I_22422_MONTH (
	TIME_ID                INTEGER             -- --记录行号       
        ,PRODUCT_NO             CHAR(15)            -- --高风险名单号码 
        ,USER_ID                CHAR(20)            -- --用户标识：主键 
        ,ADD_MONTH              CHAR(6)             -- --加入高风险名单月份：高风险名单号码首次被识别的月份。
	 ) DATA CAPTURE NONE IN TBS_APP_BASS1 
	 INDEX IN TBS_INDEX PARTITIONING KEY( USER_ID ) USING HASHING;
     
     
     select count(0),count(distinct unit_code) from app.g_unit_info  
     



delete from  app.sch_control_map where PROGRAM_NAME = 'G_I_22422_MONTH.tcl';



insert into app.sch_control_map values (2,'G_I_22422_MONTH.tcl' , 'BASS1_G_I_22422_MONTH.tcl') ;



delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_I_22422_MONTH';



insert into app.sch_control_map values (2,'EXP_G_I_22422_MONTH' , 'BASS1_EXP_G_I_22422_MONTH') ;



delete from   bass1.int_program_data where PROGRAM_NAME = 'G_I_22422_MONTH.tcl';



insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_I_22422_MONTH.tcl' , 'G_I_22422_MONTH.BASS1' , 'G_I_22422_MONTH_e' , 'G_I_22422_MONTH_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';



--delete from  app.g_unit_info where unit_code = '22422';

select * from app.g_unit_info where unit_code = '22422';

insert into app.g_unit_info values ('22422' , 1 , '经分系统识别高风险用户名单' , 'bass1.g_i_22422_month' , 1 , 0 , 1);



insert into app.sch_control_before values 
 ('BASS1_G_I_22422_MONTH.tcl' , 'BASS2_Dim_pm_serv_type_vs_expr_ds.tcl')
;



insert into app.sch_control_before values 
 ('BASS1_EXP_G_I_22422_MONTH' , 'BASS1_G_I_22422_MONTH.tcl')
;



delete from  app.sch_control_task where control_code in ( 'BASS1_G_I_22422_MONTH.tcl','BASS1_EXP_G_I_22422_MONTH');



insert into app.sch_control_task values('BASS1_G_I_22422_MONTH.tcl' , 2 , 2 , 'int -s G_I_22422_MONTH.tcl' ,-1,-1,'经分系统识别高风险用户名单' , 'app' , 'BASS1' , 1 , '/bassapp/bass1/tcl/');



insert into app.sch_control_task values('BASS1_EXP_G_I_22422_MONTH' , 2 , 2 , 'bass1_export bass1.g_i_22422_month LASTMONTH()' ,-1,-1,'EXPORT_of 经分系统识别高风险用户名单' , 'app' , 'BASS1' , 1 , '/bassapp/backapp/bin/bass1_export/');

     
     

delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22050_MONTH.tcl';



insert into app.sch_control_map values (2,'G_S_22050_MONTH.tcl' , 'BASS1_G_S_22050_MONTH.tcl') ;



delete from  app.sch_control_map where PROGRAM_NAME = 'EXP_G_S_22050_MONTH';



insert into app.sch_control_map values (2,'EXP_G_S_22050_MONTH' , 'BASS1_EXP_G_S_22050_MONTH') ;



delete from   bass1.int_program_data where PROGRAM_NAME = 'G_S_22050_MONTH.tcl';



insert into bass1.int_program_data select distinct SEQUENCE_ID,PROGRAM_TYPE , 'G_S_22050_MONTH.tcl' , 'G_S_22050_MONTH.BASS1' , 'G_S_22050_MONTH_e' , 'G_S_22050_MONTH_f' from bass1.int_program_data where PROGRAM_NAME = 'G_S_22204_MONTH.tcl';



     


SELECT
	  trim(char(a.CHANNEL_ID)) ,a.organize_id
		,b.ACCEPT_TYPE
		,char( sum( b.NEW_USERS	))
		,char( sum( b.HAND_CNT        ))
		,char( sum( b.HAND_FEE        ))
		,char( sum( b.CARD_SALE_CNT   ))
		,char( sum( b.ACCEPT_CNT      ))
		,char( sum( b.VAL_OPEN_CNT    ))
		,char( sum( b.IMP_ACCEPT_CNT  ))
		,char( sum( b.TERM_SALE_CNT   ))
		,char( sum( b.OTHER_SALE_CNT  ))
		,char( sum( b.ACCEPT_BAS_CNT  ))
		,char( sum( b.QUERY_BAS_CNT   ))
	FROM bass2.Dim_channel_info A
	inner join G_S_22091_DAY_TMP_1 b on a.organize_id = b.channel_id --假设
	WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
	and a.channel_type <> 90886
	and char(b.channel_id) not in (select CHANNEL_ID from G_S_22091_DAY_1  where time_id = 20111130 )
	group by trim(char(a.CHANNEL_ID)),a.organize_id
		,b.ACCEPT_TYPE
	with ur


select distinct channel_id from G_S_22091_DAY_TMP_1
657
select distinct channel_id from G_S_22091_DAY where time_id = 20111130
516
615
100
select count(0) from 
(
select char(b.channel_id)  channel_id
	FROM bass2.Dim_channel_info A
	inner join G_S_22091_DAY_TMP_1 b on a.organize_id = b.channel_id --假设
	WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
	and a.channel_type <> 90886
	and char(b.channel_id) not in (select CHANNEL_ID from G_S_22091_DAY_1  where time_id = 20111130 )
    ) a  ,G_S_22091_DAY b
    where char(a.channel_id) = char(b.channel_id) and b.time_id = 20111130
    
    

select distinct trim(char(CHANNEL_ID)) from (
SELECT
	  trim(char(a.CHANNEL_ID)) CHANNEL_ID,a.organize_id
		,b.ACCEPT_TYPE
		,char( sum( b.NEW_USERS	))
		,char( sum( b.HAND_CNT        ))
		,char( sum( b.HAND_FEE        ))
		,char( sum( b.CARD_SALE_CNT   ))
		,char( sum( b.ACCEPT_CNT      ))
		,char( sum( b.VAL_OPEN_CNT    ))
		,char( sum( b.IMP_ACCEPT_CNT  ))
		,char( sum( b.TERM_SALE_CNT   ))
		,char( sum( b.OTHER_SALE_CNT  ))
		,char( sum( b.ACCEPT_BAS_CNT  ))
		,char( sum( b.QUERY_BAS_CNT   ))
	FROM bass2.Dim_channel_info A
	inner join G_S_22091_DAY_TMP_1 b on a.organize_id = b.channel_id --假设
	WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
	and a.channel_type <> 90886
	and char(b.channel_id) not in (select CHANNEL_ID from G_S_22091_DAY_1  where time_id = 20111130 )
	group by trim(char(a.CHANNEL_ID)),a.organize_id
		,b.ACCEPT_TYPE ) x
	with ur


     select count(0),count(distinct channel_id),count(distinct organize_id)
     from bass2.Dim_channel_info


select sum(bigint(TERM_SALE_CNT)) from G_S_22066_DAY


rename "BASS1   "."G_S_22066_DAY"   to G_S_22066_DAY_old_20111201

CREATE TABLE "BASS1   "."G_S_22066_DAY"  (
                  "TIME_ID" INTEGER , 
                  "DEAL_DATE" CHAR(8) , 
                  "E_CHANNEL_TYPE" CHAR(2) , 
                  "BUSI_REC_CNT" CHAR(10) , 
                  "ACTIVATE_CNT" CHAR(8) , 
                  "TERM_CONTRACT_SALE_CNT" CHAR(10) , 
                  "TERM_SINGLE_SALE_CNT" CHAR(10) , 
                  "TERM_SALE_CNT" CHAR(8) , 
                  "TERM_MOBILE_SALE_CNT" CHAR(10) , 
                  "TERM_UNITE_SALE_CNT" CHAR(10) , 		  
                  "VAL_BUSI_REC_CNT" CHAR(10) , 
                  "VAL_BUSI_CANCEL_CNT" CHAR(10) , 
                  "CHRG_REC_CNT" CHAR(10) , 
                  "CHRG_REC_FEE" CHAR(12) , 
                  "ACCESS_CNT" CHAR(8) , 
                  "QRY_REC_CNT" CHAR(10) )   
                 DISTRIBUTE BY HASH("DEAL_DATE",  
                 "E_CHANNEL_TYPE")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 


select * from G_S_22066_DAY



delete from G_S_22066_DAY
insert into G_S_22066_DAY
select 
         TIME_ID
        ,DEAL_DATE
        ,E_CHANNEL_TYPE
        ,BUSI_REC_CNT
        ,ACTIVATE_CNT
        ,'0' TERM_CONTRACT_SALE_CNT
        ,'0' TERM_SINGLE_SALE_CNT
        ,TERM_SALE_CNT
        ,'0' TERM_MOBILE_SALE_CNT
        ,'0' TERM_UNITE_SALE_CNT
        ,VAL_BUSI_REC_CNT
        ,VAL_BUSI_CANCEL_CNT
        ,CHRG_REC_CNT
        ,CHRG_REC_FEE
        ,ACCESS_CNT
        ,QRY_REC_CNT
from 	 G_S_22066_DAY_old_20111201

select count(0) from G_S_22066_DAY_old_20111201


     select * from G_S_22047_DAY

select  * from bass1.g_rule_check where rule_code = 'R130'
order by 1 desc 

     
select  * from bass1.g_rule_check where rule_code = 'R146'
order by 1 desc 
20111130	4408.00000
20111129	4048.00000
20111128	4506.00000
20111127	3499.00000
20111126	4805.00000
20111125	5543.00000
20111124	5268.00000
20111123	5039.00000
20111122	4204.00000



select time_id , sum(bigint(M_BILL_MMS))
from G_S_22012_DAY
where time_id between 20111125 and 20111130
group by time_id 
order by 1 



select time_id,M_BILL_MMS from G_S_22012_DAY
where time_id > 20110716
order by time_id desc 


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04004_DAY 
where CALL_FEE > '0'
and time_id >= 20111001
group by  time_id 
order by 1 


 select sum(cnts) from 
            (
             select sum(counts) cnts from bass2.dw_newbusi_mms_20111129 a,bass2.dw_product_20111129 b 
							where  a.user_id  = b.user_id
							  and b.usertype_id in (1,2,9)
							  and b.test_mark <>1 
							  and b.userstatus_id not in (4,5,7,9)
							  and a.mm_type=0
							  and a.app_type in (0)
							  and a.send_status in (0,1,2,3)
						union all
						select sum(counts) cnts from bass2.dw_newbusi_mms_20111129 a
                        ,bass2.dw_product_20111129 b 
							where  a.user_id  = b.user_id
							  and b.usertype_id in (1,2,9)
							  and b.test_mark <>1 
							  and b.userstatus_id not in (4,5,7,9)
							  and a.app_type in (1,2,3,4)
						) as aa
                        


select  * from APP.G_FILE_REPORT where err_code<>'00'
order by 2 desc 





select time_id,sum(cnt) from
(
select time_id,count(*) cnt from bass1.g_s_04004_day
where time_id>=20111101
  and mm_bill_type in ('00')
  and applcn_type='0'
group by time_id
union all
select time_id,count(*) cnt from bass1.g_s_04004_day
where time_id>=20111101
  and applcn_type in('1','2','3','4')
group by time_id  
 ) as a
group by time_id

select distinct ECONOMY_TYPE1,ECONOMY_TYPE2
from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129



select * from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where 
--GROUP_STATES not in ('11','12','20','31','32','33','34','35','36')
--or 
--MANAGE_FORMAT not in ('1','2','3','9')
--or 
--control not in ('1','2','3','4','5','9')
--or
 --MANAGE_EARNING is null
--or 
 --ECONOMY_TYPE2 not in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340')
--,'161','191'
--)
--or
 --length(trim(addr)) <> 6
--or 
--length(trim(AREA_CODE)) > 5
--or 
 VOCATION4_EXT not in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')
 
 
 
 
select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
, lower(
 ' *'||b.interface_code||'*dat \' 
) list
 from   bass1.MON_ALL_INTERFACE b where 
deadline  in (15)
and type = 'm'
and sts = 1
 


select * from bass2.channel_user_reward_201110


select count(0) from bass2.stat_channel_reward_0019
select * from bass2.stat_channel_reward_0019 fetch first 10 rows only 


select BUSI_NOTES,MONTHS , count(0) 
--,  count(distinct BUSI_NOTES,MONTHS ) 
from bass2.stat_channel_reward_0019 
group by  BUSI_NOTES,MONTHS 
order by 1 ,2



select BUSI_NOTES, count(0) 
--,  count(distinct BUSI_NOTES,MONTHS ) 
from bass2.stat_channel_reward_0019 
group by  BUSI_NOTES 
order by 1 



select MONTHS , count(0) 
--,  count(distinct BUSI_NOTES,MONTHS ) 
from bass2.stat_channel_reward_0019 
group by  MONTHS 
order by 1 


select * from bass2.stat_channel_reward_0019 
where busi_notes='神州行签约放号'
and op_time =201110




DROP TABLE G_S_22062_MONTH;
CREATE TABLE G_S_22062_MONTH (
         TIME_ID                INTEGER             ---- 记录行号;      
        ,OP_MONTH               CHAR(6)             ---- 月份;联合主键  
        ,CHANNEL_ID             CHAR(40)            ---- 社会渠道标识;联合主键
        ,NUM_ACT_REWARD         CHAR(10)            ---- 卡号销售实发酬金;
        ,NUM_SHLD_REWARD        CHAR(10)            ---- 卡号销售应发酬金;
        ,NUM_INIT_REWARD        CHAR(10)            ---- 卡号销售首付酬金;
        ,NUM_DELAY_ACT_REWARD   CHAR(10)            ---- 卡号销售递延实发酬金;
        ,NUM_DELAY_SHLD_REWARD  CHAR(10)            ---- 卡号销售递延应发酬金;
        ,DAISHOU_REWARD         CHAR(10)            ---- 网点代收话费酬金;
        ,TERM_AGREE_REWARD      CHAR(10)            ---- 合约计划终端销售酬金;
        ,TERM_ONLY_REWARD       CHAR(10)            ---- 终端裸机销售酬金;
        ,TERM_CUSTOMIZE_REWARD  CHAR(10)            ---- 定制终端销售酬金;
        ,TERM_MOBILE_REWARD     CHAR(10)            ----    其中定制手机销售酬金;
        ,TERM_JICAI_REWARD      CHAR(10)            ---- 集采终端销售酬金;
        ,VAL_TYPE1_REWARD       CHAR(10)            ---- 增值业务包月类型一酬金;
        ,VAL_TYPE2_REWARD       CHAR(10)            ---- 增值业务包月类型二酬金;
        ,VAL_TYPE3_REWARD       CHAR(10)            ---- 增值业务包月类型三酬金;
        ,VAL_DIANBO             CHAR(10)            ---- 增值业务包月类型三酬金;
        ,STORE_SUSIDY           CHAR(10)            ---- 门店补贴;      
        ,SALE_ACTIVE_REWARD     CHAR(10)            ---- 销售激励;      
        ,ADD_REWARD             CHAR(10)            ---- 奖励酬金;      
        ,B_CLASS_REWARD         CHAR(10)            ---- B类目录酬金;   
 ) DATA CAPTURE NONE IN TBS_APP_BASS1 INDEX IN TBS_INDEX PARTITIONING KEY( OP_MONTH,CHANNEL_ID ) USING HASHING;



select * from G_S_22062_MONTH


        select count(0) from (
                select distinct channel_id from G_S_22062_MONTH where time_id = 201110
                except
                select distinct channel_id
                from
                (
                select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
                from G_A_06035_DAY a
                where time_id / 100 = 201110
                ) t where t.rn =1  and CHNL_STATE = '1'
        ) o
        with ur
        



select op_time , count(0) 
--,  count(distinct op_time ) 
from bass2.stat_channel_reward_0019 
group by  op_time 
order by 1 

        
select count(0)        
from bass2.stat_channel_reward_0019  a
where op_time = 201110
and CHANNEL_TYPE in (90105,90102)
        
        
select * from G_S_22062_MONTH


                select distinct channel_id from G_S_22062_MONTH where time_id = 201111
                except
                select distinct channel_id
                from
                (
                select a.*,row_number()over(partition by channel_id order by time_id desc ) rn 
                from G_A_06035_DAY a
                where time_id / 100 <= 201111
                ) t where t.rn =1  and CHNL_STATE = '1'

                

BASS1_EXP_G_S_22062_MONTH	BASS1_G_S_22062_MONTH.tcl
BASS1_G_S_22062_MONTH.tcl	REP_stat_channel_reward_0019.tcl

delete from app.sch_control_before 
where control_code = 'BASS1_G_S_22062_MONTH.tcl'
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_acct_payment_dm.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_product_ms.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_cm_busi_radius_dm.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_product_ord_so_log_dm.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_channel_info_ms.tcl
BASS1_G_S_22062_MONTH.tcl	BASS1_G_S_22064_MONTH.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_product_ord_cust_ms.tcl
BASS1_G_S_22062_MONTH.tcl	BASS2_Dw_product_ord_offer_dm.tcl

REP_stat_channel_reward_0019.tcl

insert into 
select * from  table( bass1.get_before('02021')) a 
                
select * from  app.sch_control_task where control_code like '%22062%'
select * from  app.sch_control_before where control_code like '%22062%'
select * from  app.sch_control_runlog where control_code like '%REP_stat_channel_reward_0019.tcl%'
 
 REP_stat_channel_reward_0019.tcl
 
 
 
select 
 b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
, lower(
 'rm *'||b.interface_code||'* ' 
) put_verf
 from   bass1.MON_ALL_INTERFACE b  
--deadline  in (15)
where  type = 'm'
and sts = 1






select count(0) from bass2.DW_XYSC_SCHOOL_REAL_USER_DT_201111

DW_XYSC_SCHOOL_REAL_USER_DT_201105

DW_XYSC_SCHOOL_REAL_USER_DT_201105



DW_XYSC_SCHOOL_REAL_USER_DT_201105




INTERFACE_CODE
02017
22036
22402
22401

INTERFACE_CODE
02017
22036
22402
22401

select * from  table( bass1.get_after('22401')) a 


update app.sch_control_task 
set function_desc = '[作废]'||function_desc
where control_code in  
('BASS1_G_I_02017_MONTH.tcl'
,'BASS1_EXP_G_I_02017_MONTH'
,'BASS1_EXP_G_S_22036_MONTH'
,'BASS1_G_S_22036_MONTH.tcl'
,'BASS1_EXP_G_S_22402_MONTH'
,'BASS1_G_S_22402_MONTH.tcl'
,'BASS1_EXP_G_S_22401_MONTH'
,'BASS1_G_S_22401_MONTH.tcl'
)



BASS1_EXP_G_I_02017_MONTH	BASS1_G_I_02017_MONTH.tcl

BASS1_EXP_G_S_22036_MONTH	BASS1_G_S_22036_MONTH.tcl
BASS1_EXP_G_S_22401_MONTH	BASS1_G_S_22401_MONTH.tcl


BASS1_EXP_G_S_22402_MONTH	BASS1_G_S_22402_MONTH.tcl


update app.sch_control_task set cc_flag = 1
where cc_flag = 2
and control_code in  
('BASS1_G_I_02017_MONTH.tcl'
,'BASS1_EXP_G_I_02017_MONTH'
,'BASS1_EXP_G_S_22036_MONTH'
,'BASS1_G_S_22036_MONTH.tcl'
,'BASS1_EXP_G_S_22402_MONTH'
,'BASS1_G_S_22402_MONTH.tcl'
,'BASS1_EXP_G_S_22401_MONTH'
,'BASS1_G_S_22401_MONTH.tcl'
)


select * from bass1.mon_all_interface where interface_code = '22062'
UPLOAD_TIME
每月15日前
每月10日前

update bass1.mon_all_interface
set UPLOAD_TIME = '每月8日前'
where interface_code = '22062'
and sts = 1



update bass1.mon_all_interface
set deadline = 8
where interface_code = '22062'
and sts = 1





insert into bass1.g_s_05001_month
select * from  bass1.T_GS05001M where time_id = 201111


insert into bass1.g_s_05002_month
select * from  bass1.T_GS05002M where time_id = 201111

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05001_month 
group by  time_id 
order by 1 desc 

select time_id,sum(bigint(STLMNT_FEE))*1.00/sum(bigint(PAY_STLMNT_FEE)) 
from   bass1.g_s_05002_month 
group by time_id 
order by 1 desc 



select * from  table( bass1.get_before('0500')) a 

CONTROL_CODE
BASS1_EXP_G_S_05001_MONTH
BASS1_EXP_G_S_05002_MONTH
BASS1_EXP_G_S_05003_MONTH
BASS1_EXP_G_S_05003_MONTH
BASS1_EXP_G_S_05003_MONTH
BASS1_EXP_G_S_05003_MONTH
BASS1_EXP_G_S_05003_MONTH
BASS1_EXP_G_S_05008_MONTH
BASS1_EXP_G_S_05009_MONTH
BASS1_G_S_05003_MONTH.tcl

insert into app.sch_control_before 
values ('BASS1_EXP_G_S_05002_MONTH','BASS1_EXP_G_S_05001_MONTH')






select distinct substr(a.filename,16,5)
FROM 
(select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 2 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 2 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 
left join bass1.mon_all_interface c on substr(a.filename,16,5) = c.INTERFACE_CODE 
except
select distinct substr(a.filename,16,5)
FROM 
(select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 
left join bass1.mon_all_interface c on substr(a.filename,16,5) = c.INTERFACE_CODE 


except
select * from bass1.mon_all_interface
where type = 'm' and sts =1
and deadline = 8

select distinct interface_code from bass1.mon_all_interface
where type = 'm' and sts =1
and deadline = 15


except
select a from 
(
select '02006' a from bass2.dual union all 
select '02007' a from bass2.dual union all 
select '02031' a from bass2.dual union all 
select '02032' a from bass2.dual union all 
select '02033' a from bass2.dual union all 
select '02052' a from bass2.dual union all 
select '03004' a from bass2.dual union all 
select '03005' a from bass2.dual union all 
select '03012' a from bass2.dual union all 
select '03015' a from bass2.dual union all 
select '03016' a from bass2.dual union all 
select '03017' a from bass2.dual union all 
select '03018' a from bass2.dual union all 
select '06001' a from bass2.dual union all 
select '06002' a from bass2.dual union all 
select '06003' a from bass2.dual union all 
select '21003' a from bass2.dual union all 
select '21006' a from bass2.dual union all 
select '21008' a from bass2.dual union all 
select '21011' a from bass2.dual union all 
select '21012' a from bass2.dual union all 
select '21020' a from bass2.dual union all 
select '22204' a from bass2.dual union all 
select '22040' a from bass2.dual union all 
select '22072' a from bass2.dual union all 
select '22303' a from bass2.dual union all 
select '22304' a from bass2.dual union all 
select '22305' a from bass2.dual union all 
select '22306' a from bass2.dual union all 
select '22307' a from bass2.dual union all 
select '22081' a from bass2.dual union all 
select '22083' a from bass2.dual union all 
select '22085' a from bass2.dual union all 
select '22086' a from bass2.dual union all 
select '22403' a from bass2.dual union all 
select '22404' a from bass2.dual ) a 



select time_id , sum(bigint(D_COMM_USERS)) 
from G_S_22038_DAY 
where time_id >= 20110101
group by time_id
order by 1 desc 



select time_id,sum(bigint(td_tnet_data_flux)) from bass1.g_s_22203_day 
group by time_id
order by 1 desc


--G_S_04005_DAY.tcl
select 
sum(case when SP_CODE = '' then cnt else 0 end )
,sum(case when OPER_CODE = '' then cnt else 0 end )
,sum(case when SERV_CODE = '' then cnt else 0 end )
from (
select 
SP_CODE
,OPER_CODE
,SERV_CODE
,count(0) cnt 
from G_S_04005_DAY
where time_id / 100 = 201110
group by 
SP_CODE
,OPER_CODE
,SERV_CODE
) a 


1	2	3
0	5680941	5680941

select count(0)
from G_S_04005_DAY
where time_id / 100 = 201110

30574088\

901777


select *
from  bass2.dim_sp_service_provider 
where bigint(sp_id) in 
(901777)

select *
from  bass2.dim_sp_service_provider 
where bigint(sp_id) in 
(600032
,901001
,901002
,901012
,901014
,901021
,901022
,901039
,901040
,901052
,901053
,901069
,901079
,901083
,901085
,901094
,901116
,901118
,901122
,901134
,901142
,901150
,901168
,901189
,901302
,901317
,901321
,901322
,901326
,901417
,901427
,901447
,901449
,901454
,901500
,901510
,901525
,901532
,901533
,901585
,901606
,901616
,901623
,901626
,901645
,901646
,901699
,901700
,901708
,901713
,901714
,901717
,901721
,901723
,901727
,901729
,901730
,901731
,901734
,901735
,901736
,901737
,901747
,901748
,901749
,901751
,901752
,901755
,901757
,901763
,901765
,901767
,901768
,901769
,901772
,901773
,901775
,901776
,901777
,901779
,901780
,901781
,901782
,901783
,901787
,901789
,901832
,901838
,901848
,901861
,901863
,901868
,901870
,901871
,901874
,901876
,901877
,901889
,901900
,901919
,901927
,902006
,902102
,902118
,902155
,902160
,902950
,909001
,909007
,909049
,909058
,909134
,910008
,910318
,911756
,913007
,913008
,913030
,914029
,914031
,916006
,916066
,916103
,917038
,917141
,918067
,918145
,919009
,919010
,919013
,919023
,919028
,919516
,919557
,919559
,919571
,919782
,920020
,920937
,922060
,922459
,931001
,931003
,931007
,931010
,931016
,931022
,931030
,931037
,931047
,931048
,931059
,931064
,931067
,931078
,931101
,931104
,931106
,931107
,931140
,931144
,931160
,931167
,931998)

                    
                    )
                    
                    
                    
                    
                      
select * from bass1.g_rule_check where rule_code in ('C1') order by time_id desc

select * from bass1.g_rule_check where rule_code in ('R173') order by time_id desc


select * from bass1.g_rule_check where rule_code in ('R174') order by time_id desc

                    
                    

select plan_id from bass2.dw_product_20111201 fetch first 10 rows only 
                    
                    
select * from bass2.dim_imei_mobile



                    (
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201111 )
order by time_id desc

                    R159_2
                    
                    
                    select
                    (
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201111 ) *1.00
/   (
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201111
) from bass2.dual
                 
                    
                    
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201111
order by time_id desc

            
bass1.int_02004_02008_month_stage

select count(0) from bass1.int_02004_02008_month_stage
                        where usertype_id IN ('2010','2020','2030','9000')
                          and test_flag='0'
                          
                          

                          
                          

select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201011 ) *1.00
/   (
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201011
) from bass2.dual
                 

                          
                          


                    select
                    (
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201111 ) *1.00 日均通信客户数
,
(
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201111
) 日均用户到达数
,(
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201111 ) *1.00 
/   (
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201111
) 比例

from bass2.dual
              
                          
                          
                          
                          


                    select
                    (
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201011 ) *1.00 日均通信客户数
,
(
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201011
) 日均用户到达数
,(
select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R161_4') 
and time_id / 100 = 201011 ) *1.00 
/   (
        select sum(target1)/30 from bass1.g_rule_check where rule_code in ('R159_2') 
and time_id / 100 = 201011
) 比例

from bass2.dual
              
       

select time_id,target1 from bass1.g_rule_check where rule_code in ('R159_1') 
and time_id / 100 = 201112
order by 1 desc 





                          


 select sum(cnts) from 
                    (
                                                select value(sum(counts),0) cnts from bass2.dw_newbusi_ismg_20111214  a,bass2.dw_product_20111214 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1 
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and a.calltype_id in (0,1,10,11)
                                                  and a.send_state='0'
                                                  and a.drtype_id<>61102 
                                                  and substr(a.sp_code,1,12) is not null
                                                  and a.svcitem_id in (300001,300002,300003,300004)
                                        union all
                                        select value(count(0),0) cnts from    G_S_04016_DAY 
                                        where time_id = 20111214 
                                        and RECORD_TYPE in ('00','01','10','11')
                                        and SEND_STATUS = '0'
                                        union all               
                                         select value(sum(counts),0) cnts from bass2.dw_newbusi_sms_20111214  a,bass2.dw_product_20111214 b 
                                                where a.user_id=b.user_id
                                                  and b.usertype_id in (1,2,9)
                                                  and b.test_mark <>1
                                                  and b.userstatus_id not in (4,5,7,9)
                                                  and  a.calltype_id in (0)
                                                  and  a.final_state=1
                                        ) as aa

                                        

--梦网短信条数:
select time_id,count(*) from bass1.G_S_04005_DAY 
where time_id = 20111214
  and calltype_id in ('00','01','10','11')
  and sms_status='0'
group by time_id
 TIME_ID	2
20111214	1009876


--普通短信条数:
select time_id,sum(bigint(SMS_COUNTS)) from bass1.g_s_21007_day
where time_id = 20111214
  and SVC_TYPE_ID in ('11','12','13','20','31','32','40','64','65','66','70')
  and END_STATUS='0'
  and CDR_TYPE_ID in ('00','10','21')
group by time_id
 
 TIME_ID	2
20111214	2005940


--音信互动短信条数:
select time_id,count(*) from bass1.G_S_04014_DAY
where time_id = 20111214
  and sms_send_state='0'
  and sms_bill_type in ('00','01','10','11')
group by time_id  
TIME_ID	2
20111214	322

                                        
                                        

select a.*,b.FUNCTION_DESC from app.sch_control_before  a, app.sch_control_task b 
where (a.control_code 
like '%BASS1_G_S_02024_DAY%'
OR a.control_code  like '%BASS1_G_S_02025_DAY%'
OR a.control_code  like '%BASS1_G_S_04019_DAY%'
OR a.control_code  like '%BASS1_G_S_22048_DAY%'
OR a.control_code  like '%BASS1_G_S_22057_MONTH%'
OR a.control_code  like '%BASS1_G_S_22058_MONTH%'
OR a.control_code  like '%BASS1_G_S_22059_MONTH%'
OR a.control_code  like '%BASS1_G_S_22060_MONTH%'
--OR a.control_code  like '%BASS1_G_A_06035_DAY%'
--OR a.control_code  like '%BASS1_G_A_06036_DAY%'
--OR a.control_code  like '%BASS1_G_A_06037_DAY%'
--OR a.control_code  like '%BASS1_G_I_06038_DAY%'
--OR a.control_code  like '%BASS1_G_I_06039_DAY%'
--OR a.control_code  like '%BASS1_G_S_02066_DAY%'
--OR a.control_code  like '%BASS1_G_S_22075_MONTH%'
--OR a.control_code  like '%BASS1_G_S_22076_MONTH%'
--OR a.control_code  like '%BASS1_G_S_22077_MONTH%'
)
                                       and a.CONTROL_CODE = b.CONTROL_CODE
                                      



select a from 
(
select '01005' a from bass2.dual union all
select '02005' a from bass2.dual union all
select '02006' a from bass2.dual union all
select '02007' a from bass2.dual union all
select '02014' a from bass2.dual union all
select '02015' a from bass2.dual union all
select '02016' a from bass2.dual union all
select '02018' a from bass2.dual union all
select '02019' a from bass2.dual union all
select '02020' a from bass2.dual union all
select '02021' a from bass2.dual union all
select '02031' a from bass2.dual union all
select '02032' a from bass2.dual union all
select '02033' a from bass2.dual union all
select '02034' a from bass2.dual union all
select '02035' a from bass2.dual union all
select '02047' a from bass2.dual union all
select '02048' a from bass2.dual union all
select '02049' a from bass2.dual union all
select '02052' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '03001' a from bass2.dual union all
select '03002' a from bass2.dual union all
select '03003' a from bass2.dual union all
select '03004' a from bass2.dual union all
select '03005' a from bass2.dual union all
select '03007' a from bass2.dual union all
select '03012' a from bass2.dual union all
select '03015' a from bass2.dual union all
select '03016' a from bass2.dual union all
select '03017' a from bass2.dual union all
select '03018' a from bass2.dual union all
select '03019' a from bass2.dual union all
select '06001' a from bass2.dual union all
select '06002' a from bass2.dual union all
select '06003' a from bass2.dual union all
select '06011' a from bass2.dual union all
select '06012' a from bass2.dual union all
select '06021' a from bass2.dual union all
select '06022' a from bass2.dual union all
select '06023' a from bass2.dual union all
select '06029' a from bass2.dual union all
select '06034' a from bass2.dual union all
select '21003' a from bass2.dual union all
select '21006' a from bass2.dual union all
select '21008' a from bass2.dual union all
select '21010' a from bass2.dual union all
select '21011' a from bass2.dual union all
select '21012' a from bass2.dual union all
select '21013' a from bass2.dual union all
select '21014' a from bass2.dual union all
select '21015' a from bass2.dual union all
select '21020' a from bass2.dual union all
select '05001' a from bass2.dual union all
select '05002' a from bass2.dual union all
select '05003' a from bass2.dual union all
select '22009' a from bass2.dual union all
select '22013' a from bass2.dual union all
select '22021' a from bass2.dual union all
select '22025' a from bass2.dual union all
select '22032' a from bass2.dual union all
select '22033' a from bass2.dual union all
select '22039' a from bass2.dual union all
select '22041' a from bass2.dual union all
select '22042' a from bass2.dual union all
select '22043' a from bass2.dual union all
select '22074' a from bass2.dual union all
select '22075' a from bass2.dual union all
select '22076' a from bass2.dual union all
select '22077' a from bass2.dual union all
select '22049' a from bass2.dual union all
select '22050' a from bass2.dual union all
select '22052' a from bass2.dual union all
select '22055' a from bass2.dual union all
select '22056' a from bass2.dual union all
select '22057' a from bass2.dual union all
select '22058' a from bass2.dual union all
select '22059' a from bass2.dual union all
select '22060' a from bass2.dual union all
select '22061' a from bass2.dual union all
select '22062' a from bass2.dual union all
select '22063' a from bass2.dual union all
select '22067' a from bass2.dual union all
select '22068' a from bass2.dual union all
select '22069' a from bass2.dual union all
select '22101' a from bass2.dual union all
select '22103' a from bass2.dual union all
select '22105' a from bass2.dual union all
select '22106' a from bass2.dual union all
select '22204' a from bass2.dual union all
select '22040' a from bass2.dual union all
select '22072' a from bass2.dual union all
select '22303' a from bass2.dual union all
select '22304' a from bass2.dual union all
select '22305' a from bass2.dual union all
select '22306' a from bass2.dual union all
select '22307' a from bass2.dual union all
select '22081' a from bass2.dual union all
select '22083' a from bass2.dual union all
select '22085' a from bass2.dual union all
select '22086' a from bass2.dual union all
select '22403' a from bass2.dual union all
select '22404' a from bass2.dual union all
select '22405' a from bass2.dual union all
select '22406' a from bass2.dual union all
select '22422' a from bass2.dual ) a
except

select distinct  substr(a.filename,16,5)
FROM 
(select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 
left join bass1.mon_all_interface c on substr(a.filename,16,5) = c.INTERFACE_CODE 
where c.STS = 1
                                      
                                      

                                

select a.*,b.FUNCTION_DESC from app.sch_control_before  a, app.sch_control_task b 
where (a.control_code 
like '%BASS1_G_S_02024_DAY%'
OR a.control_code  like '%BASS1_G_S_02025_DAY%'
OR a.control_code  like '%BASS1_G_S_04019_DAY%'
OR a.control_code  like '%BASS1_G_S_22048_DAY%'
OR a.control_code  like '%BASS1_G_S_22057_MONTH%'
OR a.control_code  like '%BASS1_G_S_22058_MONTH%'
OR a.control_code  like '%BASS1_G_S_22059_MONTH%'
OR a.control_code  like '%BASS1_G_S_22060_MONTH%'
--OR a.control_code  like '%BASS1_G_A_06035_DAY%'
--OR a.control_code  like '%BASS1_G_A_06036_DAY%'
--OR a.control_code  like '%BASS1_G_A_06037_DAY%'
--OR a.control_code  like '%BASS1_G_I_06038_DAY%'
--OR a.control_code  like '%BASS1_G_I_06039_DAY%'
--OR a.control_code  like '%BASS1_G_S_02066_DAY%'
--OR a.control_code  like '%BASS1_G_S_22075_MONTH%'
--OR a.control_code  like '%BASS1_G_S_22076_MONTH%'
--OR a.control_code  like '%BASS1_G_S_22077_MONTH%'
)
                                       and a.CONTROL_CODE = b.CONTROL_CODE
                                      


select  count(0) 
,sum(bigint(BUSI_REC_CNT))
,sum(bigint(CHRG_REC_CNT))
,sum(bigint(CHRG_REC_FEE))
--,  count(distinct TIME_ID ) 
from G_S_22066_DAY 
where time_id / 100 = 201111
order by 1                                       


20200123
20200124

select * from bass1.G_I_06023_MONTH
where time_id = 201111
and channel_id in ('20200123','20200124')

select * from bass1.mon_all_interface where interface_code = '06023'




select DEAL_TYPE
,sum(bigint(NEW_USER_CNT)) NEW_USER_CNT
,sum(bigint(PAYMENT_REC_CNT)) PAYMENT_REC_CNT
,sum(bigint(PAYMENT_REC_FEE))PAYMENT_REC_FEE
,sum(bigint(CARD_SALE_CNT))CARD_SALE_CNT
,sum(bigint(VAL_BUSI_REC_CNT))VAL_BUSI_REC_CNT
,sum(bigint(VAL_BUSI_OPEN_CNT))VAL_BUSI_OPEN_CNT
,sum(bigint(IMP_VAL_OPEN_CNT))IMP_VAL_OPEN_CNT
,sum(bigint(TERM_SALE_CNT))TERM_SALE_CNT
,sum(bigint(MOBILE_SALE_CNT))MOBILE_SALE_CNT
,sum(bigint(BASE_REC_CNT))BASE_REC_CNT
,sum(bigint(QRY_REC_CNT))QRY_REC_CNT
from   G_S_22091_DAY where time_id / 100 = 201111
and channel_id = '11111115'
group by DEAL_TYPE

select * from bass2.dim_channel_info 
where CHANNEL_ID = 100000323
CHANNEL_ID	ORGANIZE_ID
100000323	380195


select * from bass1.G_I_06021_MONTH
where time_id = 201111
and channel_id in 
(
'100000323'
,'100001666'
,'100001683'
,'100002255'
,'100002329'
,'100002391'
,'100002418'
,'100002467'
,'100003003'
,'100003064'
,'100003065'
)


select ORG_ID,count(0) from  bass2.dw_product_ins_off_ins_prod_201111
where char(ORG_ID) in 
(
 '100000323'
,'100001666'
,'100001683'
,'100002255'
,'100002329'
,'100002391'
,'100002418'
,'100002467'
,'100003003'
,'100003064'
,'100003065'
)
group by ORG_ID




select * from bass2.dim_channel_info 
where char(channel_id) in 
(
'100000323'
,'100001666'
,'100001683'
,'100002255'
,'100002329'
,'100002391'
,'100002418'
,'100002467'
,'100003003'
,'100003064'
,'100003065'
)


select ORG_ID,count(0) from  bass2.dw_product_ins_off_ins_prod_201111
where ORG_ID in 
(382161
,382300
,382867
,381549
,381532
,382269
,382248
,380195
,382825
,382866
,92000143
)
group by ORG_ID


select * from 
G_S_22091_DAY 
where channel_id in 
(
'100000323'
,'100001666'
,'100001683'
,'100002255'
,'100002329'
,'100002391'
,'100002418'
,'100002467'
,'100003003'
,'100003064'
,'100003065'
)
and time_id between 20111101 and 20111201
and time_id / 100 = 201111




select * from 
G_S_22091_DAY 
where bigint(channel_id)  
in 
(382161
,382300
,382867
,381549
,381532
,382269
,382248
,380195
,382825
,382866
,92000143
)
and time_id / 100 = 201111




select count(*) val1 
from (  select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201111 and mns_type='1'
and (product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID) not in 

(
		select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
		from bass1.g_s_04017_day
		where time_id/100=201111 and mns_type='1'
		group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID )
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID  ) M

select tabname from syscat.tables where tabname like '%CONTROL_BEFORE%'   


SELECT * FROM APP.SCH_CONTROL_BEFORE_20100918 WHERE CONTROL_CODE LIKE  '%21003%'

select *
from bass1.g_s_21003_to_day
where time_id/100=201111 and mns_type='1' and PRODUCT_NO in ( '18708012648'  ,'13549064742','13648914945','13549094395')






select * from    bass1.g_s_21003_to_day
where PRODUCT_NO = '18708012648'
and ROAM_TYPE_ID = '500'
and TOLL_TYPE_ID = '010'
and CALL_TYPE_ID = '01'
and time_id/100 = 201111

select * from 
bass2.cdr_call_dtl_20111109
where PRODUCT_NO = '18708012648'



select * from 
bass2.cdr_call_dtl_20111109
where PRODUCT_NO = '18708012648'
and length(OPP_NUMBER) <= 24




RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20111227BAK;
CREATE TABLE BASS2.DIM_TERM_TAC
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;

ALTER TABLE BASS2.DIM_TERM_TAC_MID ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE



delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID



 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20111227BAK
where net_type <>'2';



select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20111227BAK
group by tac_nuM
having count(*)>1


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20111227BAK
group by tac_nuM
having count(*)>1

select count(0) from BASS2.DIM_TERM_TAC_20111227BAK
select count(0) from BASS2.DIM_TERM_TAC


   select distinct user_id from bass2.dw_product_td_20111226
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
  and product_no like '188%'
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0) 


  
   select distinct user_id from bass2.dw_product_td_20111226
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
  and product_no like '188%'
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0) 
except
 select distinct user_id from bass2.dw_product_td_20111226
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
  and td_2gcard_mark=0
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0)
  
  USER_ID
89160001699075
89160001699044
89160001699055
89160001704781

and user_id in (
'89160001699075'
,'89160001699055'
,'89160001698908'
,'89160001699044'
,'89157333381660'
)



 user_id in ( '89157333391588','89160001699055')
  select 
  user_id
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,td_3gcard_mark
  ,product_no
  ,test_mark
  ,td_3gbook_mark
  from bass2.dw_product_td_20111226
  where
  
  user_id in (
'89160001699075'
,'89160001699055'
,'89160001698908'
,'89160001699044'
,'89157333381660'
,'89157333391588'
)


 select distinct user_id from bass2.dw_product_td_20111226
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  --and td_3gcard_mark=0
  --and td_2gcard_mark=0
  and test_mark=0
  --and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0)
  and  user_id in (
'89160001699075'
,'89160001699055'
,'89160001698908'
,'89160001699044'
,'89157333381660'
,'89157333391588'
)




  select 
  user_id
  ,product_no
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,test_mark
  ,td_3gbook_mark
  ,td_gprs_mark
  ,td_call_mark
  ,td_addon_mark
  ,td_3gcard_mark
  ,td_2gcard_mark
  from bass2.dw_product_td_20111226
  where user_id in ( '89157333391588','89160001699055')
  



select count(0) val1 
from (  select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201111 and mns_type='1'
except
select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
from bass1.g_s_04017_day
where time_id/100=201111 and mns_type='1'
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID  ) M
with ur





  select 
  user_id,20111226
  ,product_no
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,test_mark
  ,td_3gbook_mark
  ,td_gprs_mark
  ,td_call_mark
  ,td_addon_mark
  ,td_3gcard_mark
  ,td_2gcard_mark
  from bass2.dw_product_td_20111226
  where user_id in ( '89160001698908')
  union all
  select 
  user_id,20111225
  ,product_no
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,test_mark
  ,td_3gbook_mark
  ,td_gprs_mark
  ,td_call_mark
  ,td_addon_mark
  ,td_3gcard_mark
  ,td_2gcard_mark
  from bass2.dw_product_td_20111225
  where user_id in ( '89160001698908')
    union all
  select 
  user_id,20111224
  ,product_no
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,test_mark
  ,td_3gbook_mark
  ,td_gprs_mark
  ,td_call_mark
  ,td_addon_mark
  ,td_3gcard_mark
  ,td_2gcard_mark
  from bass2.dw_product_td_20111224
  where user_id in ( '89160001698908')

   union all
  select 
  user_id,20111223
  ,product_no
  ,td_call_mark
  ,td_gprs_mark
  ,td_addon_mark
  ,userstatus_id
  ,usertype_id
  ,test_mark
  ,td_3gbook_mark
  ,td_gprs_mark
  ,td_call_mark
  ,td_addon_mark
  ,td_3gcard_mark
  ,td_2gcard_mark
  from bass2.dw_product_td_20111223
  where user_id in ( '89160001698908')



  
   select distinct user_id from bass2.dw_product_td_20111224
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
    and td_2gcard_mark=0
  and product_no like '188%'
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0) 
except
 select distinct user_id from bass2.dw_product_td_20111224
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
  and td_2gcard_mark=0
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0)
 and product_no like '188%'
 USER_ID
89160001699044
89160001699055
89160001699075

 
 
 
  
   select count(distinct user_id) from bass2.dw_product_td_20111226
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
  and td_3gcard_mark=0
    and td_2gcard_mark=0
  and product_no like '188%'
  and test_mark=0
  and not ((td_3gbook_mark = 1 and td_gprs_mark=1) and td_call_mark = 0 and td_addon_mark = 0) 
  
  
  select * from bass1.g_rule_check where rule_code in ('R111') order by time_id desc



select bigint(TD_MOBILE_CUSTOMER_CNT)-bigint(TD_188_CNT)-bigint(TD_157_CNT)-bigint(TD_GSM_CNT)
,TD_MOBILE_CUSTOMER_CNT,TD_188_CNT,TD_157_CNT,TD_GSM_CNT
  from BASS1.G_S_22201_DAY
  order by time_id desc
 with ur
 
 
 
 select a.*
  from BASS1.G_S_22201_DAY a
  order by time_id desc
 with ur
 
 
 select time_id, bigint(TD_MOBILE_CUSTOMER_CNT)-bigint(TD_188_CNT)-bigint(TD_157_CNT)-bigint(TD_GSM_CNT)
,TD_MOBILE_CUSTOMER_CNT,TD_188_CNT,TD_157_CNT,TD_GSM_CNT
  from BASS1.G_S_22201_DAY
--  where time_id=20111224
order by time_id desc
 with ur
 
 
 
 
 select * from bass2.dw_product_td_20111226
 where CRM_BRAND_ID3 = 700
 and product_no like '188%'
   and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
    and test_mark=0
 
 select user_id,product_no,create_date from bass2.dw_product_20111226
 where CRM_BRAND_ID3 = 700
 and product_no like '188%'
   and userstatus_id in (1,2,3,6,8) 
  and usertype_id in (1,2,9)
    and test_mark=0
 
 
 
 select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04016_DAY 
group by  time_id 
order by 1 




select  time_id,value(count(0),0) cnts from    G_S_04016_DAY 
					where  RECORD_TYPE in ('00','01','10','11')
					and SEND_STATUS = '0'
group by time_id
                    
                    
                    
select * from app.sch_control_before where control_code = 'BASS1_G_S_22012_DAY.tcl'


                    


CREATE TABLE "BASS1   "."DIM_QW_QQT_PKGID"  (
                  NEW_PKG_ID VARCHAR(30) NOT NULL, 
                  OLD_PKG_ID VARCHAR(30) NOT NULL , 
                  PKG_NAME VARCHAR(200) )   
                 DISTRIBUTE BY HASH("NEW_PKG_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 

select count(0),count(distinct NEW_PKG_ID  ) ,count(distinct OLD_PKG_ID  )  from DIM_QW_QQT_PKGID

insert into bass1.DIM_QW_QQT_PKGID
values ('999914211020058001','QW_QQT_JC_SW58','全球通全网统一资费上网套餐58元')
,('999914211020088001','QW_QQT_JC_SW88','全球通全网统一资费上网套餐88元')
,('999914211020128001','QW_QQT_JC_SW128','全球通全网统一资费上网套餐128元')
,('999914211030058001','QW_QQT_JC_SL58','全球通全网统一资费商旅套餐58元')
,('999914211030088001','QW_QQT_JC_SL88','全球通全网统一资费商旅套餐88元')
,('999914211030128001','QW_QQT_JC_SL128','全球通全网统一资费商旅套餐128元')
,('999914211030158001','QW_QQT_JC_SL158','全球通全网统一资费商旅套餐158元')
,('999914211030188001','QW_QQT_JC_SL188','全球通全网统一资费商旅套餐188元')
,('999914211030288001','QW_QQT_JC_SL288','全球通全网统一资费商旅套餐288元')
,('999914211030388001','QW_QQT_JC_SL388','全球通全网统一资费商旅套餐388元')
,('999914211030588001','QW_QQT_JC_SL588','全球通全网统一资费商旅套餐588元')
,('999914211030888001','QW_QQT_JC_SL888','全球通全网统一资费商旅套餐888元')
,('999914211040058001','QW_QQT_JC_BD58','全球通全网统一资费本地套餐58元')
,('999914211040088001','QW_QQT_JC_BD88','全球通全网统一资费本地套餐88元')
,('999914211040128001','QW_QQT_JC_BD128','全球通全网统一资费本地套餐128元')
,('999912220440010001','QW_QQT_DJ_DX0001','全球通全网统一资费套餐专属数据包-短信包')
,('999912220450010001','QW_QQT_DJ_CX0001','全球通全网统一资费套餐专属数据包-彩信包')
,('999912221010006001','QW_QQT_DJ_ZX0001','全球通全网统一资费套餐专属数据包-全球通尊享包')
,('999912220630003001','QW_QQT_DJ_YD0001','全球通全网统一资费套餐专属数据包-全球通阅读包')
,('999912221010005001','QW_QQT_DJ_YY0001','全球通全网统一资费套餐专属数据包-全球通音乐包')
,('999912220470003001','QW_QQT_DJ_FHZX0001','全球通全网统一资费套餐专属数据包-全球通凤凰资讯包')
;

                    

bass1.DIM_QW_QQT_PKGID

select count(0),count(distinct BASE_PKG_ID),count(distinct old_pkg_id)
from 
(
select * from G_I_02022_DAY 
where time_id = 20111227
) a , DIM_QW_QQT_PKGID b 
where a.BASE_PKG_ID = b.old_pkg_idalter table bass1.DIM_QW_QQT_PKGID add unique (NEW_PKG_ID)
 alter table bass1.DIM_QW_QQT_PKGID add unique (OLD_PKG_ID)
 
                    
alter table bass1.DIM_QW_QQT_PKGID add unique (OLD_PKG_ID)
 
select * from bass1.DIM_QW_QQT_PKGID 
                    
                    
select * from G_I_02020_MONTH
where time_id = 201111
                    
select distinct BASE_PKG_ID from bass1.g_i_02022_day 
                    


select count(0),count(distinct user_id) from G_I_02022_DAY 
where time_id = 20111227
                    
73461	73461


73461

select 	count(0)
from (
	select 
		20111227 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,bass1.fn_get_all_dim_ex('BASS_STD1_0114',char(a.offer_id)) BASE_PKG_ID
		,replace(char(date(a.VALID_DATE)),'-','') VALID_DT
		,row_number()over(partition by a.product_instance_id order by expire_date desc ,VALID_DATE desc ) rn 
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'
				      ) c
	,(select user_id from bass2.dw_product_20111227
		    where usertype_id in (1,2,9) 
		    and userstatus_id in (1,2,3,6,8)
		    and test_mark<>1) d
	where  char(a.offer_id) = c.offer_id 
	  and char(a.product_instance_id)  = d.user_id
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-12-27'	  
	  and date(a.VALID_DATE)<='2011-12-27'	
    and date(a.expire_date) >= '2011-12-27'
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20111227 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
			 ) 
) t where t.rn = 1
	 with ur

                    
                    

select *
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'



select 	TIME_ID,USER_ID,BASE_PKG_ID,VALID_DT
from (
	select 
		20111227 TIME_ID
		,char(a.product_instance_id)  USER_ID
		,e.NEW_PKG_ID BASE_PKG_ID
		,replace(char(date(a.VALID_DATE)),'-','') VALID_DT
		,row_number()over(partition by a.product_instance_id order by expire_date desc ,VALID_DATE desc ) rn 
	from  bass2.Dw_product_ins_off_ins_prod_ds a
	,(select xzbas_value  as offer_id 
					from  BASS1.ALL_DIM_LKP 
					where BASS1_TBID = 'BASS_STD1_0114'
					      and bass1_value like 'QW_QQT_JC%'
					      and XZBAS_COLNAME not like '套餐减半%'
				      ) c
	,(select user_id from bass2.dw_product_20111227
		    where usertype_id in (1,2,9) 
		    and userstatus_id in (1,2,3,6,8)
		    and test_mark<>1) d
	,bass1.DIM_QW_QQT_PKGID e
	where  char(a.offer_id) = c.offer_id 
	  and char(a.product_instance_id)  = d.user_id
	  and bass1.fn_get_all_dim_ex('BASS_STD1_0114',char(a.offer_id))  = e.OLD_PKG_ID
	  and a.state =1
	  and a.valid_type = 1
	  and a.OP_TIME = '2011-12-27'	  
	  and date(a.VALID_DATE)<='2011-12-27'	
    and date(a.expire_date) >= '2011-12-27'
	  and not exists (	select 1 from bass2.dwd_product_test_phone_20111227 b 
				where a.product_instance_id = b.USER_ID  and b.sts = 1
			 ) 
) t where t.rn = 1
fetch first 100 rows only 
	 with ur

                          
                          


select time_id
	,a.user_id
	, c.NEW_PKG_ID BASE_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
 join bass1.DIM_QW_QQT_PKGID c on bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID)  = c.OLD_PKG_ID
where a.base_pkg_id not in (SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
with ur

                          
                          
select * from bass1.G_S_02024_DAY_1
                          
                          
                          
select time_id
	,a.user_id
	, value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID),a.BASE_PKG_ID) BASE_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
where a.base_pkg_id not in (SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
with ur

                          
                          


select time_id
	,a.user_id
	, value(c.new_pkg_id,a.BASE_PKG_ID) BASE_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
left join bass1.DIM_QW_QQT_PKGID c on value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID) ,'')= c.old_pkg_id
where a.base_pkg_id not in (SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
with ur




select t.time_id
,value(b.new_pkg_id ,t.BASE_PKG_ID) BASE_PKG_ID
,t.CHANNEL_ID
,t.REC_DT
,t.VALID_DT
from (
select time_id
	,a.user_id
	, value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID),a.BASE_PKG_ID) BASE_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
where a.base_pkg_id not in (SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
) t 
left join bass1.DIM_QW_QQT_PKGID  b on t.BASE_PKG_ID = b.old_pkg_id
with ur

                          



select t.time_id
,t.user_id
,value(b.new_pkg_id ,t.BASE_PKG_ID) BASE_PKG_ID
,t.CHANNEL_ID
,t.REC_DT
,t.VALID_DT
from (
select time_id
	,a.user_id
	, value(bass1.fn_get_all_dim_ex('BASS_STD1_0114',a.BASE_PKG_ID),a.BASE_PKG_ID) BASE_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02024_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
where a.base_pkg_id not in (SELECT 
			distinct XZBAS_VALUE
		FROM BASS1.ALL_DIM_LKP 
		WHERE BASS1_TBID = 'BASS_STD1_0114'
and BASS1_VALUE  not like '%QW%')
) t 
left join bass1.DIM_QW_QQT_PKGID  b on t.BASE_PKG_ID = b.old_pkg_id
with ur

                          
                          
                          
select count(0) cnt from bass1.g_i_02020_month a where time_id = 201110 and  BASE_PROD_ID like '9999%001'

                          
                          

 select distinct value(b.new_pkg_id,BASE_PROD_ID) 
			from G_I_02018_MONTH a 
			left join bass1.DIM_QW_QQT_PKGID  b on a.BASE_PROD_ID = b.old_pkg_id
			where time_id = 201111
            

                         
select  OVER_PROD_ID,count(0) from G_I_02021_MONTH where time_id = 201111
group by OVER_PROD_ID


select *from g_i_02019_month_4



select 
         t.TIME_ID
        ,t.USER_ID
        ,value(b.new_pkg_id ,t.ADD_PKG_ID) ADD_PKG_ID
        ,t.CHANNEL_ID
        ,t.REC_DT
        ,t.VALID_DT
from (
select time_id
	, a.user_id
	, c.BASS1_VALUE ADD_PKG_ID
	, value(char(b.CHANNEL_ID),'BASS1_DS') CHANNEL_ID
	, a.REC_DT
	, a.VALID_DT
from bass1.G_S_02025_DAY_1 a 
left join (select distinct channel_ID,organize_id from  bass2.dim_channel_info a where a.channel_type_class in (90105,90102) ) b on a.CHANNEL_ID = char(b.organize_id )
left join (select XZBAS_VALUE,BASS1_VALUE from BASS1.ALL_DIM_LKP where BASS1_TBID = 'BASS_STD1_0115' ) c on a.ADD_PKG_ID = c.xzbas_value
) t
left join bass1.DIM_QW_QQT_PKGID  b on t.ADD_PKG_ID = b.old_pkg_id
with ur

select *from bass1.mon_all_interface where interface_code =  '02006'
                         


---------------------------------------------------------------------------------
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc


INT_CHECK_IMPORTSERV_MONTH


select * from  app.sch_control_alarm 
where CONTROL_CODE LIKE '%TD%'
order by alarmtime desc

BASS1_INT_CHECK_TD_MONTH.tcl
select * from app.SCH_CONTROL_TASK
where control_code = 'BASS1_INT_CHECK_TD_MONTH.tcl'


select * from  app.sch_control_runlog_his
where CONTROL_CODE LIKE '%TD_MONTH%'

order by alarmtime desc


select * from  app.SCH_CONTROL_TASK
where CONTROL_CODE LIKE '%BASS1_REPORT%'

CMD_LINE
int -s INT_CHECK_R009_MONTH.tcl>/bassapp/bass1/tcl/log/INT_CHECK_IMPORTSERV_MONTH.out.r`date +%Y%m`

update app.SCH_CONTROL_TASK
set cmd_line = 'int -s INT_CHECK_IMPORTSERV_MONTH.tcl>/bassapp/bass1/tcl/log/INT_CHECK_IMPORTSERV_MONTH.out.r`date +%Y%m`'
where CONTROL_CODE LIKE '%INT_CHECK_IMPORTSERV_MONTH%'


select * from  app.SCH_CONTROL_TASK_20100611
where cmd_line LIKE '%INT_CHECK_IMPORTSERV_MONTH%'


order by alarmtime desc


SELECT  * from syscat.tables where tabname like '%SCH_CONTROL_RUNLOG%'

/**
update app.sch_control_runlog 
set flag = -2 
where control_code = 'BASS1_INT_CHECK_INDEX_SAME_DAY.tcl'
and endtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'


update app.sch_control_alarm 
set flag = 1
where alarmtime >=  current timestamp - 1 days
and flag = -1
and control_code like 'BASS1%'
and control_code = 'BASS1_INT_CHECK_INDEX_SAME_DAY.tcl'

**/



select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num in ( '15913269062','13989007120')
and send_time >=  current timestamp - 1 days
and date(send_time) = char(current date )
order by send_time desc
--15889099527



select * from    app.sch_control_runlog 


select * from app.sch_control_alarm  where content like '%准确性指标56%'

---------------------------------------------------------------------------------

select * from   table( bass1.chk_same(0) ) a order by 2
---------------------------------------------------------------------------------

select * from   table( bass1.chk_wave(0) ) a order by 2
---------------------------------------------------------------------------------

---------------------------------------------------------------------------------

select * from app.sch_control_task where control_code in 
(
select control_code from   app.sch_control_runlog where flag = 1 
)
and cc_flag = 1


---------------------------------------------------------------------------------
select * from table(bass1.fn_dn_flret_cnt(9)) a

select * from table(bass1.fn_dn_flret_cnt(11)) a

select * from table(bass1.fn_dn_flret_cnt(13)) a

select * from table(bass1.fn_dn_flret_cnt(15)) a


/*********日**************************************************************************************/

--接口文件级返回检查(正常情况为56条记录) file 
--file lvl
select  * from APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'

select  * from APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code<>'00'

---------------------------------------------------------------------------------
--或者：有接口重传时、记录级重新返回时。
--s_13100_20110301_22303_01_001.dat
--file lvl

select t.*, substr(filename,18,5)
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1

----------------------求未上传（文件级返回）接口！ (当日没返回文件级的接口)
select * from   BASS1.MON_ALL_INTERFACE 
where interface_code 
not in (select substr(filename,18,5) from 
APP.G_FILE_REPORT
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) and type='d'
and interface_code <> '04007'

--record 接口记录集返回检查(正常情况为56条记录) record
---------------------------------------------------------------------------------

select * from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1


--record 查询未返回接口 (已完全上报时) record

select * from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0
---------------------------------------------------------------------------------


--求未导出接口 (通过上一天与本日比较)
select * from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and unit_code 
not in (select unit_code  from  app.g_runlog where time_id=int(replace(char(current date - 1 days),'-',''))
 )


-- record 未返回接口的详细信息 (day)  record
select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0
)
and type = 'd'

-- record 已返回接口的详细信息 (day)  record
select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=1
)
and type = 'd'


--查询未运行的导出程序
SELECT * FROM bass1.MON_ALL_INTERFACE  t
WHERE t.INTERFACE_CODE not IN (
select substr(a.control_code,15,5) from   app.sch_control_runlog  A
where control_code like 'BASS1_EXP%DAY'
AND date(a.begintime) =  date(current date)
AND FLAG = 0
)
AND TYPE='d'


--查询未导出接口 (未完全出数时)

select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 2 days),'-',''))
and return_flag=1
except
select unit_code from app.g_runlog 
where time_id=int(replace(char(current date - 1 days),'-',''))
and return_flag=0


/********月***************************************************************************************/

---月接口文件级返回检查(对于接口重送，相应的进行增加)
--对于重传接口，根据重传次数会增加相应记录数，故做去重处理，防止重复统计
--file 
select *
from 
(
select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code='00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
) t where rn = 1


--文件级返回失败检查
select  * 
from APP.G_FILE_REPORT
where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
and err_code <> '00'
and length(filename)=length('s_13100_201002_03014_01_001.dat')
order by deal_time desc


--查询已返回月接口 记录级

select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1

--已上传未返回 (b表将为NULL)
--mreturn

select distinct return_flag, substr(a.filename,16,5),c.INTERFACE_NAME,a.*,b.*
FROM 
(select t.*
    from 
    (
    select  a.* ,row_number()over(partition by  substr(filename,16,5) order by deal_time desc ) rn 
    from APP.G_FILE_REPORT a
    where substr(filename,9,6) = substr(replace(char(current date - 1 month),'-',''),1,6)
    and err_code='00'
    and length(filename)=length('s_13100_201002_03014_01_001.dat')
    ) t where rn = 1
) a 
left join 
(
select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
) b on substr(a.filename,16,5) = b.unit_code 
left join bass1.mon_all_interface c on substr(a.filename,16,5) = c.INTERFACE_CODE 
where c.STS = 1



/**
--查询未返回月接口 记录级

select * from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=0

--未返回接口的详细信息 (month)

select * from  BASS1.MON_ALL_INTERFACE 
where INTERFACE_CODE in (
select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=0
)
and type = 'm'
**/

--查看deadlineX 的接口有多少已返回。


--分时段接口-查看返回情况
select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月3日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月5日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月8日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月10日前'



select a.* ,b.return_flag from    BASS1.MON_ALL_INTERFACE  a
left join (select * from  app.g_runlog b
where  time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and b.return_flag = 1 
) b on  a.INTERFACE_CODE = b.UNIT_CODE
where  upload_time='每月15日前'

12+15+30+17+10 = 84 







--调度程序耗时:
select A.*,char(a.RUNTIME/60)||'min',char(a.RUNTIME/60/60)||'hr' from   app.sch_control_runlog A
where control_code like 'BASS1%DAY%'
and a.RUNTIME/60 > 5
ORDER BY RUNTIME DESC 



/**
1、22073竞争KPI涉及的校验R163、R164、R165、R166、R167、R168、R169、R170、R171、R172(调度为BASS1_INT_CHECK_COMP_KPI_DAY.tcl)和
21007短信涉及的校验(调度BASS1_INT_CHECK_C1K844TO46_TO_DAY.tcl)超标，数据正常生成的，不要进行任何数据调整，调度直接点击完成后运行后续；

如：
**/
select * from bass1.g_rule_check where rule_code in ('R171','R172','R169') order by time_id desc
20110501	R169	1503.00000	580.00000	1.59130	0.00000
20110501	R171	1499.00000	573.00000	1.61600	0.00000
20110501	R172	633.00000	383.00000	0.65270	0.00000

/**
2、22012日kpi接口涉及的一致性检查，如超标，必须进行调整(调度为BASS1_INT_CHECK_INDEX_SAME_DAY.tcl)，调整22012接口的指标，重跑报错调度，
一定不能点击完成(最频繁的是“离网用户数”这个指标，差一个用户就超标，暂没解决口径不一致情况，二经未改造用户资料表)；

如：
**/
select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end,
         target1,
         target2,
         target3
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
and rule_code='R159_1'
order by 1 desc 


20110418	离网客户数	84.00000	85.00000	-0.01176

20110428	离网客户数	144.00000	134.00000	0.07462

select * from     
bass1.g_s_22012_day 
where time_id=int(replace(char(current date - 1 days),'-',''))

20110517	20110517	2888      	1671364     	23709586    	469322      	3798066     	77        	280936      

20110519	20110519	2306      	1675939     	22918403    	5312      	3834942     	68        	257121      

20110520	20110520	2330      	1678173     	23580986    	476230      	3903368     	80        	284164      
  
 
 20110528	20110528	1888      	1645201     	22985709    	515685      	3774471     	83        	274209      

20110601	20110601	4520      	1646351     	24447434    	520729      	4689422     	120       	492684      --当日离网 ，二经没有打标

20110602	20110602	3423      	1649676     	22326259    	471251      	3738425     	99        	261862      
 
 TIME_ID	BILL_DATE	M_NEW_USERS	M_DAO_USERS	M_BILL_DURATION	M_DATA_FLOWS	M_BILL_SMS	M_OFF_USERS	M_BILL_MMS
20110603	20110603	2900      	1652486     	23148301    	481514      	4124087     	90        	264431      

  --调整脚本，''里更新一定的值就是
--离网客户数
update bass1.g_s_22012_day set m_off_users='97' 
where time_id=int(replace(char(current date - 1 days),'-',''))

 select * from  bass1.G_RULE_CHECK where rule_code = 'C1'
 order by 1 desc 

 select * from  bass1.G_RULE_CHECK where rule_code = 'C1'
 and time_id > 20110825
 order by 1 desc 
 
20110618	C1	2049107.00000	2211895.00000	-0.07360	0.00000
 
 20110607	C1	2059346.00000	4283440.00000	-0.51923	0.00000

 20110605	C1	4405358.00000	2650880.00000	0.66185	0.00000

 20110603	C1	2154443.00000	1826062.00000	0.17983	0.00000

 20110531	C1	2432169.00000	2058116.00000	0.18175	0.00000
20110530	C1	2058116.00000	1980649.00000	0.03911	0.00000


 20110509	C1	2053251.00000	2472205.00000	-0.16947	0.00000

 20110508	C1	2472205.00000	2140554.00000	0.15494	0.00000

20110503	C1	1981494.00000	1819931.00000	0.08877	0.00000

20110502	C1	1819931.00000	2861998.00000	-0.36410	0.00000 
20110501	C1	2861998.00000	3083030.00000	-0.07169	0.00000
20110430	C1	3083030.00000	2551002.00000	0.20856	0.00000
20110429	C1	2551002.00000	2155029.00000	0.18374	0.00000
20110428	C1	2155029.00000	1990225.00000	0.08281	0.00000
20110427	C1	1990225.00000	1987809.00000	0.00122	0.00000


/**

2、月底调度BASS1_INT_CHECK_SAMPLE_TO_DAY.tcl中R107/R108超标，此调度只有在月初1号早上送月底那天的日数据时必须调整，让校验通过，
其它日期调度报错直接点击运行完成；

--调整脚本(数据量大，update有些慢，要几分钟，调了以后如还报错，再调其中“400”和“5”的值，注意微调)
---R107
**/

select * from bass1.g_rule_check where rule_code in ('R107') order by time_id desc
20110531	R107	33.14000	69.10000	-0.52041	0.05000

20110430	R107	67.13000	68.50000	-0.02000	0.05000
select * from bass1.g_rule_check where rule_code in ('R108') order by time_id desc
20110430	R108	544.84000	560.01000	-0.02709	0.05000

---R107
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110929  ) t 
set TOLL_CALL_FEE = char(bigint(TOLL_CALL_FEE)+400) with ur;
109513 row(s) affected.
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110731  ) t 
set TOLL_CALL_FEE = char(bigint(TOLL_CALL_FEE)+10) with ur

--97763 row(s) affected.

--100390 row(s) affected.
--97763 row(s) affected.
--201107 105138 row(s) affected.
---R108
update (select * from  BASS1.G_S_04008_DAY where time_id = 20110929  ) t 
set BASE_BILL_DURATION = char(bigint(BASE_BILL_DURATION)-5) with ur 
20110828
112152 row(s) affected.


--100390 row(s) affected.
--97763 row(s) affected.
--201107 105138 row(s) affected.
select * from   bass1.G_RULE_CHECK where rule_code = 'R109'      
order by time_id desc 


--所有日接口代码：

select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'

--所有月接口代码：

select b.CONTROL_CODE from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'




		   
--每月月初跑
--G_S_21003_STORE_DAY
--每月月初插入上月全月数据
delete from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

insert into G_S_21003_STORE_DAY
select *
from G_S_21003_TO_DAY
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

--统计备份情况()
select count(0) from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

select count(0) from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 1 month),'-',''),1,6))

--统计备份情况()
select count(0) from G_S_21003_STORE_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))

select count(0) from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))

--两者一致，则在G_S_21003_TO_DAY删除前两个月前的数据(如现在是5月，保留3，4月，删除2月数据)
--提高程序速度
delete from G_S_21003_TO_DAY 
where TIME_ID/100 = int(substr(replace(char(current date - 2 month),'-',''),1,6))





--生成重导日数据的命令

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,13)||' '||char(current date - 1 days) 
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'

--生成重导月数据的命令

select b.*
, lower(
 '/bassapp/backapp/bin/bass1_export/bass1_export '||substr(a.control_code,11,15)||' '||substr(char(current date - 1 month) ,1,7)
) exp_cmd
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'


--单独put 某个接口:day



select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%DAY%'
and date(a.begintime) =  date(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='d'

--单独put 某个接口:month

select b.*
, lower(
 'put *'||b.interface_code||'*.dat ' 
) put_dat
, lower(
 'put *'||b.interface_code||'*.verf ' 
) put_verf
from   app.sch_control_runlog  a ,bass1.MON_ALL_INTERFACE b
where a.control_code like 'BASS1%EXP%MONTH%'
and month(a.begintime) =  month(current date)
and substr(a.control_code,15,5) = b.interface_code 
and b.type='m'


--接口号 -  表名 对应关系
select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,13) from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'd'
and b.control_code like '%DAY%'
) t where unit_code = ''

select * from table(
select substr(control_code , 11,5) unit_code,substr(b.CONTROL_CODE,7,15),b.control_code from    
BASS1.MON_ALL_INTERFACE a
, app.sch_control_task b where a.INTERFACE_CODE = substr(control_code , 11,5)
and a.TYPE = 'm'
and b.control_code like '%MONTH%'
) t where unit_code = ''


select * from   bass1.mon_all_interface where INTERFACE_CODE = '06001'




select * from   bass1.dim_21003_ip_type

select * from    bass1.G_S_22059_MONTH_MRKT_0135A 

select count(0) from    BASS1.G_S_22057_MONTH

select count(0) from     app.sch_control_map where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';

delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22058_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22059_MONTH.tcl';
delete from  app.sch_control_map where PROGRAM_NAME = 'G_S_22060_MONTH.tcl';

select count(0) from     bass1.int_program_data where PROGRAM_NAME = 'G_S_22057_MONTH.tcl';

select count(0) from    bass1.int_program_data where PROGRAM_NAME = 'G_S_22060_MONTH.tcl';

select * from    app.g_unit_info  where unit_code = '22057'
select count(0) from    app.sch_control_task  where control_code = 'BASS1_EXP_G_S_22057_MONTH'


select * from   bass2.stat_market_0135_b_final

select * from   bass2.stat_market_0135_b_final

select * from            bass1.G_S_22057_MONTH

select * from   bass2.stat_market_0135_c 

select * from   bass2.stat_channel_reward_0009 

select * from   bass2. dw_channel_local_busi_201106  





select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02054_day where 
                 time_id/100 <= 201106 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
union 
select ENTERPRISE_ID
                from 
                (
                select t.*,row_number()over(partition by ENTERPRISE_ID order by time_id desc) rn 
                from (
                select *
                from g_a_02064_day where 
                 time_id/100 <= 201106 and ENTERPRISE_BUSI_TYPE = '1520'
                 and MANAGE_MODE = '3'
                ) t 
                ) t2 where rn = 1 and STATUS_ID ='1'
                
                
                

 SELECT 
                    SUM(T.SC),
                    COUNT(DISTINCT T.PRODUCT_NO)
                  FROM (
                          SELECT SUM(BIGINT(CALL_DURATION)) AS SC, PRODUCT_NO     
                          FROM BASS1.G_S_04008_DAY
                          WHERE TIME_ID/100=201107
                               AND ADVERSARY_ID<>'010000'
                          GROUP BY PRODUCT_NO
                          UNION 
                          SELECT SUM(BIGINT(CALL_DURATION)) AS SC,PRODUCT_NO
                          FROM BASS1.G_S_04009_DAY
                          WHERE TIME_ID/100=201107
                                AND ADVERSARY_ID<>'010000'
                          GROUP BY PRODUCT_NO
                        )T
                        
                        
select count(0) from     bass2.STAT_ZD_VILLAGE_USERS_201107
                       

select count(0) from     BASS1.G_S_04009_DAY
select * from   BASS1.MON_ALL_INTERFACE 
 where interface_code = '06002'
 
                       

select SCHOOL_ID , count(0) 
--,  count(distinct SCHOOL_ID ) 
from G_I_02032_MONTH 
group by  SCHOOL_ID 
order by 1 


select * from   bass2.dw_product_20110808 where product_no = '13989007120'
                       
select tabname from syscat.tables where tabname like upper('%cdr_sms_2011%')


select * from bass2.CDR_GPRS_LOCAL_20110701 fetch first 10 rows only  


                select distinct B_AREA_CD
                from G_S_04019_DAY where time_id = 20110820
                except 
                select country_code from  bass1.dim_country_city_code 
                select * from   bass1.dim_country_city_code  where country_code like '2%'
                
select tabname from syscat.tables where tabname like '%DIM%COU%'                   
select * from   bass2.DIM_PUB_COUNTRY

select *                 from G_S_04019_DAY where time_id = 20110811
and B_AREA_CD = '2'

1209	未知待查

update 
 G_S_04019_DAY 
 set B_AREA_CD = '1209'
 where time_id = 20110820
and B_AREA_CD = '2'


select * from   G_A_02054_DAY_FIX20110812



USER_ID	CUST_ID	ACCT_ID
89101110015456	89101110420499	89101110200773


select * from   bass2.dw_product_20110812
where product_no = '13908911366'

select * from bass2.dw_cust_20110812 
where CUST_ID = '89101110420499'




select * from   



SELECT CNT1 - CNT2 
FROM 
(
select COUNT(0) CNT1
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201107
           ) f 
where    f.row_id=1 
    ) A        
, (
select COUNT(0) CNT2
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201107 ) e
where e.row_id=1
) B 
select * from   g_s_22066_day where time_id = 20110820



select * from   app.sch_control_task where CMD_LINE like  '%ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD%'



CREATE TABLE BASS2.ODS_PRODUCT_ORD_BUSI_OTHER_20110701  like bass2.ODS_PRODUCT_ORD_BUSI_OTHER_YYYYMMDD  DISTRIBUTE BY HASH(ORDER_BUSI_INFO_ID)   IN TBS_3H INDEX IN TBS_INDEX ; 
                   

select tabname from syscat.tables where tabname like '%ODS_PRODUCT_ORD_BUSI_OTHER%'                      


  select * from g_s_22066_day 
  where e_channel_type = '04'
  order by 1 desc 
  
  select * 
                  from bass1.G_S_22066_DAY
                where time_id in (20110823,20110822)
                
               
               
               
               select * from    G_S_22066_DAY
               
               
               
                 
  select * 
                  from bass1.G_S_22091_DAY
                where time_id in (20110823,20110822)
                
                
select * from   app.sch_control_task where control_code like '%product%other%ds%.tcl'                
select * from   app.sch_control_task where control_code like '%product%%tcl'                

select * from  table( bass1.get_task('DWD_CHANNEL_SELFSITE_INFO')) a 


BASS2_Dwd_channel_selfsite_info_ds.tcl	ODS-DWD 自营渠道基本信息表[I04104]

insert into app.sch_control_before 
values ('BASS1_G_A_06037_DAY.tcl','BASS2_Dwd_channel_selfsite_info_ds.tcl')

  select * 
                  from bass1.G_S_22092_DAY
                where time_id in (20110823,20110822)
                
                
                BASS2_Dwd_product_ord_busi_other_ds.tcl	TR1_L_11060

select * from   app.sch_control_task where control_code like 'TR1_L_1106%'                




select count(0) ,count(distinct user_id ) from    G_I_02016_MONTH where time_id = 201107


select prod_id,count(0) from    G_I_02016_MONTH where time_id = 201107
group by prod_id

PROD_ID	2
106	32
107	33
108	78
300	1
    
  33+78 = 111 

  
    106：30元/月包15小时
    107：50元/月包40小时
	108：100元/月包200小时
    300：本地WLAN资费套餐
    
    select count(0) from    
    (
    select user_id from G_S_03004_MONTH where time_id = 201107 group by user_id having  sum(bigint(FEE_RECEIVABLE)) between 5000 and 12000
    ) a
    
values 111*1.00/587040*100

values 111/0.00193327868598914*100

select * from    bass2.dim_product_item b
where b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)



                select
                    201107,
                        b.prod_id,
                         count(distinct a.user_id)
                from bass2.dwd_product_sprom_active_20110730 a,
                         bass2.dim_product_item b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)
                  and replace(char(date(a.valid_date)),'-','')<='20110731'
                  and replace(char(date(a.expire_date)),'-','')>'20110731'
                  group by b.prod_id
                  
                  1	PROD_ID	3
201107	90030036	23
201107	90030031	23
201107	90030024	63
201107	90005001	1


1	PROD_ID	3
201107	90005001	1
201107	90030024	78
201107	90030031	34
201107	90030036	32


values 39/0.00193327868598914*100

select * from    bass2.stat_2011_user_wlan_mm
select * from    bass2.stat_wlan_2011_user_mm


select distinct extend_id prod_id, name  from   bass2.dim_prod_up_product_item 
where UPPER(name) like '%WLAN%'
and extend_id is not null





                select
                    201107,
                        b.prod_id,
                         count(distinct a.user_id)
                from bass2.dwd_product_sprom_active_20110730 a,
                         (select distinct extend_id prod_id, name  from   bass2.dim_prod_up_product_item 
where UPPER(name) like '%WLAN%'
and extend_id is not null) b
                where a.sprom_id=b.prod_id
                  and b.prod_id in (90030036,90008120,90030031,90008121,90030024,90008122,90005000,90005001,90005002,90005003,90005004,90005005)
                  and replace(char(date(a.valid_date)),'-','')<='20110731'
                  and replace(char(date(a.expire_date)),'-','')>'20110731'
                  group by b.prod_id
                  

select * from   bass2.dim_acct_item
                  where UPPER(item_name) like '%GPRS%'
                  
ITEM_ID	ITEM_NAME
80000594	WLAN包时费
80000105	WLAN包月费
80000106	WLAN基本费
82000031	WLAN费虚科目
80000628	Wlan
80000732	WLAN电子卡订购使用费


select * from bass2.dw_acct_shoulditem_201107
where item_id in (80000594,80000105,80000106,82000031,80000628)                  


select * from   BASS1.ALL_DIM_LKP 

where bass1_tbid = 'BASS_STD1_0074'

dim_acct_item	WLAN基本费	80000106	帐目科目	BASS_STD1_0074	0716	无线局域网（WLAN）通信费
dim_acct_item	WLAN包月费	80000105	帐目科目	BASS_STD1_0074	0715	无线局域网（WLAN）月使用费

select sum(bigint(FEE_RECEIVABLE))/count(distinct a.user_id)/100 from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')
70.28

select avg(bigint(FEE_RECEIVABLE)) from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')

7028

4190





select a.* from   g_s_03004_month a , g_i_02016_month b  
where a.time_id = 201107 
and a.user_id = b.user_id 
and b.TIME_ID = 201107
and ACCT_ITEM_ID in ('0716','0715')
70.28


0626	GPRS套餐费	包含相应数据流量的GPRS月使用费
0627	GPRS通信费	套餐用户超出部分的GPRS通信费，以及非套餐用户的GPRS通信费



select sum(bigint(FEE_RECEIVABLE))/count(distinct a.user_id)/100 from   g_s_03004_month a
where a.time_id = 201107 
and ACCT_ITEM_ID in ('0626','0627')
6


select * from   G_S_22091_DAY
order by 1 desc 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22091_DAY 
group by  time_id 
order by 1 

select count(0) from    BASS2.DWD_PRODUCT_ORD_BUSI_OTHER_20110824


select count(0) from    BASS2.DWD_PRODUCT_ORD_BUSI_OTHER_20110823

BASS2_Dwd_product_ord_busi_other_ds.tcl



insert into app.sch_control_before 
values ('BASS1_G_S_22066_DAY.tcl','BASS2_Dwd_product_ord_busi_other_ds.tcl')

select * from  table( bass1.get_before('22062')) a 



select DEAL_DATE||E_CHANNEL_TYPE||BUSI_REC_CNT||ACTIVATE_CNT||TERM_SALE_CNT||VAL_BUSI_REC_CNT||VAL_BUSI_CANCEL_CNT||CHRG_REC_CNT||CHRG_REC_FEE||ACCESS_CNT||QRY_REC_CNT from bass1.g_s_22066_day where time_id=20110710


select * from   g_s_22066_day order by 1 desc,3

select * from   bass2.dim_device_profile




select date(alarmtime),count(0) from  app.sch_control_alarm 
where  
 control_code like 'BASS1%'
 and substr(char(date(alarmtime)),9,2) in ('28','29','30')
group by date(alarmtime)




select * from  app.sch_control_alarm 
where  
 control_code like 'BASS1%'
 and substr(char(date(alarmtime)),9,2) in ('28','29','30')



select * from    bass1.G_S_04019_DAY where time_id=20110827



select * from   


select * from bass1.g_rule_check 
where rule_code in ('R107') 
and time_id = int(replace(char(current date - 1 days),'-',''))
order by time_id desc




SELECT CNT1 - CNT2 
FROM 
(
select COUNT(0) CNT1
from
( select user_id,usertype_id,time_id,row_number() over(partition by user_id order by time_id desc ) row_id   
           from bass1.g_a_02008_day
           where  time_id/100 <= 201108
           ) f 
where    f.row_id=1 
    ) A        
, (
select COUNT(0) CNT2
from
(select user_id,create_date,product_no,brand_id,sim_code,usertype_id
                ,row_number() over(partition by user_id order by time_id desc ) row_id   
from bass1.g_a_02004_day
where time_id/100 <= 201108 ) e
where e.row_id=1
) B 



select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


CREATE TABLE "BASS1   "."INT_22401_201109"  (
                  "TIME_ID" INTEGER , 
                  "USER_ID" CHAR(20) , 
                  "CELL_ID" CHAR(10) , 
                  "LAC_ID" CHAR(10) , 
                  "CALL_CNT" BIGINT )   
                 DISTRIBUTE BY HASH("TIME_ID",  
                 "USER_ID",  
                 "CELL_ID",  
                 "LAC_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" ; 




select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and control_code like 'BASS1%'
order by alarmtime desc



select * from   bass2.dw_call_opposite_201108
where product_no = '13549083471'


                select USER_ID||CELL_ID||LAC_ID, count(0)  cnt
                from bass1.G_S_22401_MONTH
                where time_id =201108
                group by USER_ID||CELL_ID||LAC_ID having count(0) > 1
                

			select * from   G_I_21020_MONTH
				where
				COMP_BRAND_ID = '021000' and 
				 substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3)  not 
				in ('130','131','132','155','156','185','186','145')   
				and time_id  = 201108 
                


 select * from
(
select distinct  channel_star from bass1.g_i_06021_month
where time_id =201108
  and channel_status='1'
  and channel_type='3'
) aa
where channel_star=''
                
                
                select  * from bass1.g_i_06021_month
where time_id =201108
  and channel_status='1'
  and channel_type='3'
  and channel_star=''
  
  
  
                        select count(0) from   G_I_21020_MONTH
                                where
                                COMP_BRAND_ID = '021000' and 
                                 substr(COMP_PRODUCT_NO,length(trim(COMP_PRODUCT_NO))-10,3)  not 
                                in ('130','131','132','155','156','185','186','145')   
                                and time_id  = 201108 
                                
                                

                select cnt,rn from (
                        select time_id,round(20+rand(1)*10,0) cnt , row_number()over() rn from bass1.g_s_22021_month
                        where show_id = '00030028'
                        ) a 
                where time_id = 201108
                                
                                



select cnt,rn from (
select time_id,round(20+rand(1)*10,0) cnt , row_number()over() rn from 
(select * from bass1.g_s_22021_month 
union all
select 201108 TIME_ID,'201108' MONTH_ID, '00030028' SHOW_ID,'' TARGET_VALUE from bass2.dual
) t
where show_id = '00030028'
) a 
where time_id = 201108


select * from syscat.tables where tabname like '%TERM%TAC%'   
                                
                                
                                
---------------------------------------------------------------------------------
select *  from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 5 days
and control_code like 'BASS1%CHECK%MONTH%'
and control_code  not like 'BASS1%CHECK%WAVE%'
and control_code  not like 'BASS1%CHECK%SAME%'
order by alarmtime desc
                                
                            select count(0) from    (    
select BILL_TYPE||PRODUCT_NO||PRTY_CODE||SP_ID||SERV_CODE||CUSTOM_CHNL||MEET_NUM||PREZENT_BEGIN_TIME||PREZENT_END_TIME||FEE_AMT||BUSI_TYPE||DEAL_TIME||CUST_CONTE from bass1.g_s_04015_day where time_id=20110906
) a

                                
                                
select count(0) from     bass1.g_s_04015_day where time_id=20110906
 and   PRTY_CODE is null 
 
update   (select * from  bass1.g_s_04015_day where     time_id=20110906 ) a 
set BILL_TYPE = ''
where  BILL_TYPE is null 

select * from    bass1.g_s_04015_day where     time_id=20110906
and                          BILL_TYPE = ''
delete from (select * from bass1.g_s_04015_day where     time_id=20110906)  a
where  BILL_TYPE = ''


---------------------------------------------------------------------------------
select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 1 days
and flag = -1
order by alarmtime desc

select * from   bass2.dim_acct_item b 
where UPPER(item_name) like '%BLACK%BERRY%'

ITEM_ID	ITEM_NAME
80000180	BlackBerry功能费
80000184	BlackBerry通信费
80000598	BlackBerry集团客户扩展业务功能费
80000599	BlackBerry集团客户扩展业务通信费
82000111	Black Berry虚科目



select * from   G_I_02022_DAY where user_id = '89160001135476'
20110825	89160001135476      	QW_QQT_JC_SL88                	20110722
20110827	89160001135476      	QW_QQT_JC_SL88                	20110801
20110828	89160001135476      	QW_QQT_JC_SL88                	20110801
20110829	89160001135476      	QW_QQT_JC_SL88                	20110801
20110830	89160001135476      	QW_QQT_JC_SL88                	20110801
20110831	89160001135476      	QW_QQT_JC_SL88                	20110801
20110901	89160001135476      	QW_QQT_JC_SW128               	20110901
20110902	89160001135476      	QW_QQT_JC_SW128               	20110901


20110826	89160001135476      	QW_QQT_JC_SL88                	BASS1_DS                                	20110826	20110901
select * from   G_S_02024_DAY where user_id = '89160001135476'



        select A.*,B.NAME from bass2.dw_product_ins_off_ins_prod_201108 a, bass2.dim_prod_up_product_item  b
where product_instance_id 
in 
('89160001135476'
)
and a.OFFER_ID = b.PRODUCT_ITEM_ID
AND B.NAME LIKE '%全球通%'


select count(0) 
		FROM BASS2.Dim_CHANNEL_INFO A 
		WHERE A.CHANNEL_TYPE_CLASS IN (90105,90102)
	with ur
    

select count(0),count(distinct PRODUCT_NO) from    g_s_04002_day
where time_id = 20110927

4177858	289510
4177858	289510





                select CHANNEL_ID,count(0)  cnt
                from bass1.G_A_06035_DAY
                where time_id =20111001
                group by CHANNEL_ID having count(0) > 1
                
                select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_06035_DAY 
group by  time_id 
order by 1 


insert into app.sch_control_before
values 
 ('BASS1_G_I_02034_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_22403_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_S_22403_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_22404_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02035_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02031_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_S_22404_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
,('BASS1_G_I_02033_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')

BASS1_G_I_02017_MONTH.tcl


insert into app.sch_control_before
values 
 ('BASS1_G_I_02017_MONTH.tcl','BASS1_G_I_02032_MONTH.tcl')
 
 
 update G_I_21020_MONTH 
set CALL_COUNTS = char(int(rand(1)*5+1))
where (
char(TIME_ID) = substr(COMP_LAST_DATE,1,6)
and CALL_COUNTS = '0'
and SMS_COUNTS = '0'
and MMS_COUNTS = '0'
and time_id = 201109 )



select * from   bass1.g_rule_check where rule_code = 'R235'
ORDER BY 1 DESC 



select * from   bass1.g_rule_check where rule_code = 'R235'
ORDER BY 1 DESC 
select '06'||trim(char(int(rand(1)*9))) from bass2.dual


select count(0) from table(
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201107
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201107
)
) t 



select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201107
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201107
)


select distinct SCHOOL_ID from G_I_06001_MONTH where TIME_ID = 201109
and  SCHOOL_ID not in (
select distinct SCHOOL_ID from G_I_02031_MONTH where TIME_ID = 201109
)

select a.stud_cnt
,b.*
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id

G_S_22403_MONTH

update    app.sch_control_task 
set cc_flag = 2
where 
control_code like '%G_S_22403_MONTH%'
or 
control_code like '%G_S_22404_MONTH%'



select a.stud_cnt
,b.*
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt


select * from  app.sch_control_alarm 
where alarmtime >=  current timestamp - 5 days
--and flag = -1
and control_code like 'BASS1%'
order by alarmtime desc

select time_id,count(0)
from G_S_22063_MONTH
group by time_id


select * from   g_i_06003_month where time_id = 201108



                select school_id, count(0)  cnt
                from bass1.G_I_06001_MONTH
                where time_id =201109
                group by SCHOOL_ID having count(0) > 1
                
                


        select distinct  
        201109  TIME_ID
        ,SCHOOL_ID
        ,SCHOOL_NAME
        ,case when value (city_id , substr(SCHOOL_ID,4,3))  = '891' then '13101'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '892' then '13102'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '893' then '13103'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '894' then '13104'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '895' then '13105'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '896' then '13106'
                              when value (city_id , substr(SCHOOL_ID,4,3))  = '897' then '13107'
                        end CMCC_BRANCH_ID
        ,a.school_address       
        ,value(char(cast( SCH_LONGITUDE as decimal(6,4))),'0') SCH_LONGITUDE
        ,value(char(cast( SCH_LATITUDE  as decimal(6,4))),'0') SCH_LATITUDE
        , case when SCHOOL_ID  = '89189100000003' then 'http://www.utibet.edu.cn/' else ''  end WEBSITE
        ,case 
                when school_type in ('4') then '1' 
                when school_type in ('5') then '2'      
                else '3' 
        end SCHOOL_LVL
        ,case 
                when school_level in ('1') then '1' 
                when school_level in ('2') then '3'     
                else '4' 
        end ADMIN_TYPE
        ,char(SCH_SIZE_STUS) STUD_CNT
        ,'100' NEWSTUD_CNT 
        ,char(sch_size_teas) STAFF_CNT
        ,'06'||trim(char(int(rand(1)*9))) CMCC_RATE
from      bass2.Dim_xysc_maintenance_info a
where a.SCHOOL_ID  in (
select distinct SCHOOL_ID from G_I_02032_MONTH where TIME_ID = 201109
)
with ur

                
                
                                select *
                from bass1.G_I_06001_MONTH
                where time_id =201109
               

select count(0) from (
select school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) t


select * from   g_i_06001_month
where time_id = 201109


update     (select * from  g_i_06001_month where  time_id = 201109 )  t
set    t.stud_cnt = (select char(cnt)  from 
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) c
where t.school_id = c.school_id )



select time_id, a.school_id,stud_cnt from     g_i_06001_month  a
,
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) b 
where a.school_id = b.school_id 




update     (select * from  g_i_06001_month where  time_id = 201109 )  t
set    t.stud_cnt = (select char(cnt)  from 
table (
select a.school_id, cnt
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
) c
where t.school_id = c.school_id )
where  t.school_id in 
(
select a.school_id
from (select * from  g_i_06001_month where time_id = 201109 ) a 
, (
select school_id,count(0) cnt 
from G_I_02031_MONTH
where time_id = 201109
group by school_id
) b 
where a.school_id = b.school_id
and bigint(a.stud_cnt) < cnt
)


select * from   bass2.dim_svc_item
where svcitem_name like '%国际%'

select count(0) from    bass2.DW_NEWBUSI_MMS_201109


 select sum(counts)
 from 
 table (
 select a.user_id,counts,substr((case when substr(a.opp_number,1,2) = '86' then substr(a.opp_number,3,11) else a.opp_number
			end ),1,7) hlr_code   from bass2.DW_NEWBUSI_MMS_201109 a 
 where a.SEND_STATUS in (0,1,2,3) 
 and a.SVCITEM_ID in  (400001)
 and  a.calltype_id in (0)
 ) a
 ,bass2.dw_product_201109 b
 ,(select distinct  hlr_code  from   bass2.DIM_GSM_HLR_INFO
                where prov_code = '891'
              ) c
 where 
  a.hlr_code = c.hlr_code
  and  a.user_id=b.user_id
  and  b.usertype_id in (1,2,9)
  
  
  
  select 'P08-JTDX'
,(
select  sum(b.counts)
                      from bass2.dw_enterprise_member_mid_201109 a,bass2.DW_NEWBUSI_MMS_201109 b,
                           bass2.dw_product_201109 c
                      where a.user_id = b.user_id and a.user_id = c.user_id
                         and b.sp_code  = '931007' and b.calltype_id in (1)
			 and calltype_id = 1 
) from bass2.dual



select  sum(b.counts)
                      from bass2.dw_enterprise_member_mid_201109 a,bass2.DW_NEWBUSI_MMS_201109 b
                      where a.user_id = b.user_id 
                         and b.sp_code  = '931007' and b.calltype_id in (1)
			 and calltype_id = 1 

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '931007'


select b.sp_code,b.sp_name from (
select sp_code , count(0) 
--,  count(distinct sp_code ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  sp_code 
) t , bass2.DW_PM_SP_INFO_201109 b 

where char(t.sp_code) = char(b.SP_CODE)


select tabname from syscat.tables where tabname like '%SP_INFO%'   


select * from   bass2.DW_PM_SP_INFO_201109

select * from bass2.dim_up_prod_item

800089
select * from    bass2.dim_prod_up_product_item 
where SUPPLIER_ID = '800089'

801210

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '931007'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where  b.sp_code  = '801210'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 b
where SER_CODE = '106540320000'

select count(0) from   bass2.DW_NEWBUSI_MMS_201109 a
where SER_CODE = '106540320000'
 and  a.calltype_id in (1)
 
select OPER_CODE , count(0) 
--,  count(distinct OPER_CODE ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  OPER_CODE 
order by 1 



select SER_CODE , count(0) 
--,  count(distinct SER_CODE ) 
from bass2.DW_NEWBUSI_MMS_201109 
group by  SER_CODE 
order by 1 

select * from   bass2.dim_svc_item
where svcitem_name like '%点对点%'

select * from   
		        bass2.dw_newbusi_sms_201109 a
		       where  a.calltype_id=1 
		       and a.svcitem_id in (200001,200002,200005)

select tabname from syscat.tables where tabname like '%DIM%SP%CODE%'   

select count(0) from     bass2.dw_newbusi_sms_201109 

select * from   bass2.dim_call_tolltype

select unit_code from app.g_runlog 
where time_id= int(substr(replace(char(current date - 1 month),'-',''),1,6))
and return_flag=1
except
select a from 
(
select '01005' a from bass2.dual union all
select '02005' a from bass2.dual union all
select '02006' a from bass2.dual union all
select '02007' a from bass2.dual union all
select '02014' a from bass2.dual union all
select '02015' a from bass2.dual union all
select '02016' a from bass2.dual union all
select '02018' a from bass2.dual union all
select '02019' a from bass2.dual union all
select '02020' a from bass2.dual union all
select '02021' a from bass2.dual union all
select '02031' a from bass2.dual union all
select '02032' a from bass2.dual union all
select '02033' a from bass2.dual union all
select '02034' a from bass2.dual union all
select '02035' a from bass2.dual union all
select '02047' a from bass2.dual union all
select '02049' a from bass2.dual union all
select '02052' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '03001' a from bass2.dual union all
select '03002' a from bass2.dual union all
select '03003' a from bass2.dual union all
select '03004' a from bass2.dual union all
select '03005' a from bass2.dual union all
select '03007' a from bass2.dual union all
select '03012' a from bass2.dual union all
select '03015' a from bass2.dual union all
select '03016' a from bass2.dual union all
select '03017' a from bass2.dual union all
select '03018' a from bass2.dual union all
select '03019' a from bass2.dual union all
select '06001' a from bass2.dual union all
select '06002' a from bass2.dual union all
select '06003' a from bass2.dual union all
select '06011' a from bass2.dual union all
select '06012' a from bass2.dual union all
select '06021' a from bass2.dual union all
select '06022' a from bass2.dual union all
select '06023' a from bass2.dual union all
select '06029' a from bass2.dual union all
select '06034' a from bass2.dual union all
select '21003' a from bass2.dual union all
select '21006' a from bass2.dual union all
select '21008' a from bass2.dual union all
select '21010' a from bass2.dual union all
select '21011' a from bass2.dual union all
select '21012' a from bass2.dual union all
select '21013' a from bass2.dual union all
select '21014' a from bass2.dual union all
select '21015' a from bass2.dual union all
select '21020' a from bass2.dual union all
select '05001' a from bass2.dual union all
select '05002' a from bass2.dual union all
select '05003' a from bass2.dual union all
select '22009' a from bass2.dual union all
select '22013' a from bass2.dual union all
select '22021' a from bass2.dual union all
select '22025' a from bass2.dual union all
select '22032' a from bass2.dual union all
select '22033' a from bass2.dual union all
select '22039' a from bass2.dual union all
select '22041' a from bass2.dual union all
select '22042' a from bass2.dual union all
select '22043' a from bass2.dual union all
select '22074' a from bass2.dual union all
select '22075' a from bass2.dual union all
select '22076' a from bass2.dual union all
select '22077' a from bass2.dual union all
select '22049' a from bass2.dual union all
select '22050' a from bass2.dual union all
select '22052' a from bass2.dual union all
select '22055' a from bass2.dual union all
select '22056' a from bass2.dual union all
select '22057' a from bass2.dual union all
select '22058' a from bass2.dual union all
select '22059' a from bass2.dual union all
select '22060' a from bass2.dual union all
select '22061' a from bass2.dual union all
select '22063' a from bass2.dual union all
select '22067' a from bass2.dual union all
select '22068' a from bass2.dual union all
select '22069' a from bass2.dual union all
select '22101' a from bass2.dual union all
select '22103' a from bass2.dual union all
select '22105' a from bass2.dual union all
select '22106' a from bass2.dual union all
select '22204' a from bass2.dual union all
select '22036' a from bass2.dual union all
select '22040' a from bass2.dual union all
select '22072' a from bass2.dual union all
select '22303' a from bass2.dual union all
select '22304' a from bass2.dual union all
select '22305' a from bass2.dual union all
select '22306' a from bass2.dual union all
select '22307' a from bass2.dual union all
select '22081' a from bass2.dual union all
select '22083' a from bass2.dual union all
select '22085' a from bass2.dual union all
select '22086' a from bass2.dual union all
select '22403' a from bass2.dual union all
select '22404' a from bass2.dual union all
select '22405' a from bass2.dual union all
select '22406' a from bass2.dual ) a 
except
select substr(filename,18,5) 
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1


















select substr(filename,18,5) 
from 
(
select  a.* ,row_number()over(partition by  substr(filename,18,5) order by deal_time desc ) rn 
from APP.G_FILE_REPORT a
where substr(filename,9,8) = replace(char(current date - 1 days),'-','') and err_code='00'
) t where rn = 1
except
select a from 
(select '01002' a from bass2.dual union all
select '01004' a from bass2.dual union all
select '01006' a from bass2.dual union all
select '01007' a from bass2.dual union all
select '02004' a from bass2.dual union all
select '02008' a from bass2.dual union all
select '02011' a from bass2.dual union all
select '02013' a from bass2.dual union all
select '02022' a from bass2.dual union all
select '02023' a from bass2.dual union all 
select '02024' a from bass2.dual union all
select '02025' a from bass2.dual union all
select '02028' a from bass2.dual union all
select '02053' a from bass2.dual union all
select '02054' a from bass2.dual union all
select '02055' a from bass2.dual union all
select '02056' a from bass2.dual union all
select '02057' a from bass2.dual union all
select '02058' a from bass2.dual union all
select '02059' a from bass2.dual union all
select '02060' a from bass2.dual union all
select '02061' a from bass2.dual union all
select '02062' a from bass2.dual union all
select '02063' a from bass2.dual union all
select '02064' a from bass2.dual union all
select '02065' a from bass2.dual union all
select '02066' a from bass2.dual union all
select '04002' a from bass2.dual union all
select '04003' a from bass2.dual union all
select '04004' a from bass2.dual union all
select '04005' a from bass2.dual union all
select '04006' a from bass2.dual union all
select '04015' a from bass2.dual union all
select '04016' a from bass2.dual union all
select '04017' a from bass2.dual union all
select '04018' a from bass2.dual union all
select '04019' a from bass2.dual union all
select '06031' a from bass2.dual union all
select '06032' a from bass2.dual union all
select '06035' a from bass2.dual union all
select '06036' a from bass2.dual union all
select '06037' a from bass2.dual union all
select '06038' a from bass2.dual union all
select '06039' a from bass2.dual union all
select '21001' a from bass2.dual union all
select '21002' a from bass2.dual union all
select '21004' a from bass2.dual union all
select '21005' a from bass2.dual union all
select '21007' a from bass2.dual union all
select '21009' a from bass2.dual union all
select '21016' a from bass2.dual union all
select '22012' a from bass2.dual union all
select '22038' a from bass2.dual union all
select '22073' a from bass2.dual union all
select '22048' a from bass2.dual union all
select '22066' a from bass2.dual union all
select '22091' a from bass2.dual union all
select '22092' a from bass2.dual union all
select '22102' a from bass2.dual union all
select '22104' a from bass2.dual union all
select '22201' a from bass2.dual union all
select '22202' a from bass2.dual union all
select '22203' a from bass2.dual union all
select '22301' a from bass2.dual union all
select '22302' a from bass2.dual union all
select '22080' a from bass2.dual union all
select '22082' a from bass2.dual union all
select '22084' a from bass2.dual union all
select '04008' a from bass2.dual union all
select '04009' a from bass2.dual union all
select '04010' a from bass2.dual union all
select '04011' a from bass2.dual union all
select '04012' a from bass2.dual ) a 





update (select * from     G_S_22091_DAY where time_id = int(replace(char(current date - 1 days),'-',''))
) 
set NEW_USER_cnt = '1'
where NEW_USER_cnt > '1'

select sum(bigint(NEW_USER_cnt)) from G_S_22091_DAY where time_id = int(replace(char(current date - 1 days),'-',''))


select * from   G_A_02054_DAY where time_id = 20111020


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_22080_DAY 
group by  time_id 
order by 1 


   select * from   bass1.g_rule_check 
where rule_code = 'R255'
order by 1 desc 


select count(0) from    BASS2.DWD_SYS_CMD_DEF_20111025


                  select user_id from bass1.g_i_02022_day
                      where time_id =20111026
                       except
                  select user_id from bass2.dw_product_20111026
                    where usertype_id in (1,2,9) 
                    and userstatus_id in (1,2,3,6,8)
                    and test_mark<>1
                    
USER_ID
89160000925615      
89160000915003      
89160000927714      
89160000925040      
89160000917846      

                     select user_id from bass1.g_i_02022_day
                      where time_id =20111025
                       except
                  select user_id from bass2.dw_product_20111025
                    where usertype_id in (1,2,9) 
                    and userstatus_id in (1,2,3,6,8)
                    and test_mark<>1
                    
delete from (select * from  bass1.g_i_02022_day  where time_id =20111026)
where user_id in 
(
'89660001015961'

)

89660001015961      

select * from    g_a_02004_day 
where user_id = '89160000925615'
                  select *from bass1.g_i_02022_day
                      where time_id =20111025
and  user_id = '89160000925615'                     
                    
                  select * from bass2.dw_product_20111025
                    where user_id = '89160000925615'

bass1.int_02004_02008_month_stage 
        
select * from    g_a_02004_02008_stage 
where user_id = '89160000925615'
            
            select * from    g_a_02008_day 
where user_id = '89160000925615'
            

            
            

select 
         time_id,
         case when rule_code='R159_1' then '新增客户数'
              when rule_code='R159_2' then '客户到达数'
              when rule_code='R159_3' then '上网本客户数'
              when rule_code='R159_4' then '离网客户数'
         end,
         target1,
         target2,
         target3
from bass1.g_rule_check
where 
    rule_code in ('R159_1','R159_2','R159_3','R159_4')
and rule_code='R159_4'
order by 1 desc 

            

                select user_id, count(0)  cnt
                from bass1.G_A_02028_DAY
                where time_id =20111028
                group by user_id having count(0) > 1
                
                      	2

select * from   G_A_02028_DAY
where user_id = '89157334193580'

TIME_ID	USER_ID	PKG_ID	ORDER_DT	STS_CD
20111028	89157334193580      	9999121202901081011001	20111101	1
20111028	89157334193580      	9999121202900981011001	20111028	1

delete from G_A_02028_DAY
where user_id = '89157334193580'
and TIME_ID = 20111028 
and ORDER_DT = '20111101'


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


 select count(0) dup_cnt
        from (
                select user_id, count(0)  cnt
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1
                ) t 
                

from bass1.G_S_02024_DAY
                where time_id =20111101                
                and user_id in (
                                select user_id
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1

                )
                
                
                
                select * from   g_a_22036_day
                
                
                
delete                 
                from bass1.G_S_02024_DAY
                where time_id =20111101                
                and user_id in (
                                select user_id
                from bass1.G_S_02024_DAY
                where time_id =20111101
                group by user_id having count(0) > 1)
               and valid_dt > '20111101'
               
               
               
                


select count(0),count(distinct user_id||busi_code ) from    G_A_02011_DAY 
where time_id = 20111103



delete from (select * from G_A_02011_DAY where time_id = 20111103)


select user_id,busi_code 
from G_A_02011_DAY
where  time_id = 20111103
group by user_id,busi_code having count(0) > 1 

89160000667427      	131


select * from G_A_02011_DAY where time_id = 20111103
and user_id = '89160000667427'
TIME_ID	BUSI_CODE	USER_ID	VALID_DATE	INVALID_DATE
20111103	131	89160000667427      	20000101	20000102
20111103	131	89160000667427      	20111103	20991231

delete from G_A_02011_DAY
where TIME_ID = 20111103
and USER_ID = '89160000667427'
and INVALID_DATE = '20000102'

SELECT DISTINCT 
20111103 time_id
        ,'131' BUSI_CODE
        ,b.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a 
,bass2.dw_product_20111103 b
where 
a.product_instance_id = b.user_id
and b.usertype_id in (1,2,9)
and b.USERSTATUS_ID in (1,2,3,6,8)
and a.offer_id = 113050001402
and date(a.VALID_DATE) < date(a.EXPIRE_DATE)
and date(a.VALID_DATE) <= '2011-11-03'
and date(a.EXPIRE_DATE) > '2011-11-03'
and date(a.VALID_DATE) = '2011-11-03'
and USER_ID = '89160000667427'
with ur


select * from bass1.ALL_DIM_LKP c  where bass1_tbid='BASS_STD1_0075'


SELECT DISTINCT 
20111103 time_id
        ,'132' BUSI_CODE
        ,b.user_id USER_ID
        ,replace(char(date(a.valid_date)),'-','') VALID_DATE
        ,replace(char(date(a.EXPIRE_DATE)),'-','') INVALID_DATE
from 
bass2.dw_product_ins_off_ins_prod_ds a 
,bass2.dw_product_20111103 b
where 
a.product_instance_id = b.user_id
and b.usertype_id in (1,2,9)
and b.USERSTATUS_ID in (1,2,3,6,8)
and a.offer_id = 113050001403
and date(a.VALID_DATE) < date(a.EXPIRE_DATE)
and date(a.VALID_DATE) <= '2011-11-03'
and date(a.EXPIRE_DATE) > '2011-11-03'
and date(a.VALID_DATE) = '2011-11-03'
and USER_ID = '89160000667427'
with ur


                           select
                             coalesce(bass1.fn_get_all_dim('BASS_STD1_0075',char(a.prod_id)),'010')
                             ,a.user_id
                             ,replace(char(date(a.valid_date)),'-','') as valid_date
                             ,replace(char(date(a.expire_date)),'-','') as invalid_date
                           from 
                             bass2.dwd_product_func_20111103 a 
                           where
                             a.service_id>0 
                             and USER_ID = '89160000667427'
                             

                           select
                             coalesce(bass1.fn_get_all_dim('BASS_STD1_0075',char(a.prod_id)),'010')
                             ,a.user_id
                             ,replace(char(date(a.valid_date)),'-','') as valid_date
                             ,replace(char(date(a.expire_date)),'-','') as invalid_date
                           from 
                             bass2.dwd_product_func_20111103 a,
                             bass2.dim_product_item b
                           where
                             a.service_id=0 
                             and a.prod_id=b.prod_id 
                             and USER_ID = '89160000667427'
                             
                             select t.busi_code
                                 ,t.user_id
                                 ,t.valid_date
                                 ,t.invalid_date
               from (select  busi_code
                             ,user_id
                             ,valid_date
                             ,invalid_date
                             ,row_number() over(partition by busi_code,user_id order by valid_date desc ) row_id
                     from session.g_a_02011_day_tmp1 ) t
               where t.row_id=1                           
              
               
               
               select
                    a.busi_code
                   ,a.user_id
                   ,'20000101'
                   ,'20000102'
                 from ( select busi_code,user_id  from bass1.int_02011_snapshot where valid_date<>'20000101' and invalid_date<>'20000102'
                  and USER_ID = '89160000667427'
                  )t 
                  
                 
                 
                 
select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO \
where send_time is not null \
and mobile_num = '15913269062' \
and send_time >=  current timestamp - 1 days \
and date(send_time) = char(current date ) \
order by send_time desc


                 
select count(0) from    bass2.dw_product_20111115
           
          





select substr(opp_number,1,6) ,sum(info_fee)
from 
bass2.dw_call_opposite_201110
where 
substr(opp_number,1,5) = '12590'
and substr(opp_number,1,6)  in ('125900','125904','125905','125906','125907','125908','125901','125902','125903','125909') 
group by substr(opp_number,1,6) 
	



select 
sum(bigint(BASE_BILL_DURATION))
,sum(bigint(CALL_DURATION))/60
from G_S_21002_DAY
where time_id / 100 = 201110
group by TIME_ID


select 
sum(bigint(BASE_BILL_DURATION))
sum(bigint(CALL_DURATION))
from G_S_21002_DAY
where time_id / 100 = 201110
group by TIME_ID



select sum(bigint(NEW_USER_cnt)) from G_S_22091_DAY where time_id = 20111113

select * from  bass2.dim_acct_paytype 
where paytype_name like '%充值卡%'

select PAYMENT_ID, sum(amount)
from BASS2.dw_acct_payment_dm_201110 a
			where  a.PAYMENT_ID  in (select paytype_id from bass2.dim_acct_paytype 
            where paytype_name like '%充值卡%'
            ) 			

group by PAYMENT_ID



 select * from  BASS1.dim_ord_cfg_operation
 where opt_name like '%充值%'
 
 
 select opt_code, sum(amount)
from BASS2.dw_acct_payment_dm_201110 a
			where  a.opt_code  in (select opt_code from BASS1.dim_ord_cfg_operation
            where opt_name like '%充值卡%'
            ) 			

group by opt_code



select a.*,b.*
from 
(
 select opt_code, sum(amount) amt
from BASS2.dw_acct_payment_dm_201110 a
group by opt_code
) a
,BASS1.dim_ord_cfg_operation b 
where a.OPT_CODE = b.OPT_CODE



select a.*,b.*
from 
(
 select OPT_CODE, sum(amount) amt
from BASS2.dw_acct_payment_dm_201110 a
group by OPT_CODE
) a
,BASS2.dim_acct_paytype b 
where a.OPT_CODE = b.PAYTYPE_ID


select * from bass1.mon_all_interface where interface_code = '22062'

select tabname from syscat.tables where lower(tabname) like '%unit_info%'   


select * from  table( bass1.get_task('payment_dm')) a 



RENAME TABLE BASS2.DIM_TERM_TAC TO DIM_TERM_TAC_20111129BAK;
CREATE TABLE BASS2.DIM_TERM_TAC
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;


/**
drop table BASS2.DIM_TERM_TAC_MID
CREATE TABLE BASS2.DIM_TERM_TAC_MID
 (ID             INTEGER,
  TAC_NUM        VARCHAR(15),
  TERM_ID        VARCHAR(10),
  TERM_MODEL     VARCHAR(50),
  TERMPROD_ID    VARCHAR(10),
  TERMPROD_NAME  VARCHAR(200),
  NET_TYPE       CHARACTER(1),
  TERM_TYPE      CHARACTER(1)
 )
  DATA CAPTURE NONE
 IN TBS_DIM
  PARTITIONING KEY
   (ID
   ) USING HASHING;
ALTER TABLE BASS2.DIM_TERM_TAC_MID
  LOCKSIZE ROW
  APPEND OFF
  NOT VOLATILE;
**/
ALTER TABLE BASS2.DIM_TERM_TAC_MID ACTIVATE NOT LOGGED INITIALLY WITH EMPTY TABLE

--201107 529
  

len_val="1 8,9 23,24 33,34 83,84 93,94 293,294 294,295 295"
WORK_PATH=/bassapp/bihome/panzw/tmp
datafilename=i_30000_201111_91005_001.dat
table_name=bass2.DIM_TERM_TAC_MID
DB2_SQLCOMM="db2 \"load client from ${WORK_PATH}/${datafilename} of asc \\
\n
modified by timestampformat=\\\"YYYYMMDDHHMMSS\\\" dateformat=\\\"YYYYMMDD\\\" \\
\n
timeformat=\\\"HHMMSS\\\" \\
\n
method L (${len_val}) \\
\n
messages ./${table_name}.msg \\
\n
replace into ${table_name} nonrecoverable\""

echo ${DB2_SQLCOMM}|sed -e 's/ $//g'

db2 connect to bassdb user bass2 using bass2

db2 "load client from /bassapp/bihome/panzw/tmp/i_30000_201111_91005_001.dat of asc \
 modified by timestampformat=\"YYYYMMDDHHMMSS\" dateformat=\"YYYYMMDD\" \
 timeformat=\"HHMMSS\" \
 method L (1 8,9 23,24 33,34 83,84 93,94 293,294 294,295 295) \
 messages ./bass2.DIM_TERM_TAC_MID.msg \
 replace into bass2.DIM_TERM_TAC_MID nonrecoverable"
 
 
delete from BASS2.DIM_TERM_TAC 
insert into BASS2.DIM_TERM_TAC
select * from BASS2.DIM_TERM_TAC_MID

 insert into BASS2.DIM_TERM_TAC
select 
ID,
TAC_NUM,
TERM_ID,
TERM_MODEL,
TERMPROD_ID,
TERMPROD_NAME,
NET_TYPE,
TERM_TYPE from BASS2.DIM_TERM_TAC_20111129BAK
where net_type <>'2';


select tac_nuM,count(*) from BASS2.DIM_TERM_TAC
group by tac_nuM
having count(*)>1
35805102       	2

select tac_nuM,count(*) from BASS2.DIM_TERM_TAC_20111129BAK
group by tac_nuM
having count(*)>1

select count(0) from    BASS2.DIM_TERM_TAC
 27697
 27733
 select count(0) from    bass2.DIM_TERM_TAC_20111129BAK
 
 select * from  bass1.g_s_22050_month
 select * from  bass1.g_s_22050_month 
 
 select * from G_S_22050_MONTH_old
 
 select * from bass2.dim_channel_info 
 where channel_name like '%中域%'
 
 
 
 
 接口单元名称：全网性渠道合作伙伴情况
合作伙伴	此字段仅取以下分类：
1：苏宁
2：国美
3：迪信通
4：中域
5：其他（两个或者两个以上省公司合作的合作伙伴）



rename bass1.G_S_22050_MONTH to G_S_22050_MONTH_old
CREATE TABLE "BASS1   "."G_S_22050_MONTH"  (
                  "TIME_ID" INTEGER NOT NULL , 
                  "STATMONTH" CHAR(6) NOT NULL , 
                  "COMATE" CHAR(1) NOT NULL , 
                  "COMATE_NAME" CHAR(200) NOT NULL , 
                  "CHANNELCOUNT" CHAR(8) NOT NULL , 
                  "NEWCUSTCOUNT" CHAR(8) NOT NULL , 
                  "PAYCOUNT" CHAR(8) NOT NULL , 
                  "BUSICOUNT" CHAR(8) NOT NULL , 
                  "COMINALCOUNT" CHAR(8) NOT NULL , 
                  "OTHERCOUNT" CHAR(8) NOT NULL , 
                  "QQTOPERATORCOUNT" CHAR(8) NOT NULL , 
                  "SZXOPERATORCOUNT" CHAR(8) NOT NULL , 
                  "DGDDOPERATORCOUNT" CHAR(8) NOT NULL , 
                  "PAYMONEY" CHAR(8) NOT NULL )   
                 DISTRIBUTE BY HASH("TIME_ID")   
                   IN "TBS_APP_BASS1" INDEX IN "TBS_INDEX" NOT LOGGED INITIALLY ; 




select 

                  201110,

                  '201110',

                  COMATE,
                  case 
                  when COMATE = '1' then '苏宁'
                  when COMATE = '2' then '国美'
                  when COMATE = '3' then '迪信通'
                  when COMATE = '4' then '中域'
                  else '其他' end comate_name,
                  CHANNELCOUNT,

                  NEWCUSTCOUNT,

                  PAYCOUNT,

                  BUSICOUNT,

                  COMINALCOUNT,

                  OTHERCOUNT,

                  QQTOPERATORCOUNT,

                  SZXOPERATORCOUNT,

                  DGDDOPERATORCOUNT,

                  PAYMONEY 

                from bass1.g_s_22050_month

               where time_id=201109
              
insert into            bass1.g_s_22050_month
(
         TIME_ID
        ,STATMONTH
        ,COMATE
        ,COMATE_NAME
        ,CHANNELCOUNT
        ,NEWCUSTCOUNT
        ,PAYCOUNT
        ,BUSICOUNT
        ,COMINALCOUNT
        ,OTHERCOUNT
        ,QQTOPERATORCOUNT
        ,SZXOPERATORCOUNT
        ,DGDDOPERATORCOUNT
        ,PAYMONEY
)
   select 
         TIME_ID
        ,STATMONTH
        ,COMATE
        ,''
        ,CHANNELCOUNT
        ,NEWCUSTCOUNT
        ,PAYCOUNT
        ,BUSICOUNT
        ,COMINALCOUNT
        ,OTHERCOUNT
        ,QQTOPERATORCOUNT
        ,SZXOPERATORCOUNT
        ,DGDDOPERATORCOUNT
        ,PAYMONEY
   from G_S_22050_MONTH_old
   
   select * from    G_S_22050_MONTH
   
   
   
   
   

select time_id, count(0),count(distinct PRODUCT_NO) from    g_s_04002_day
where time_id / 100 = 201111
group by  time_id
order by 1 desc

   
   
MOBILE_SALE_CNT
select sum(bigint(TERM_SALE_CNT))
 ,sum(bigint(MOBILE_SALE_CNT))
 from	G_S_22091_DAY
 where time_id / 100 = 201110
 
 
   
   select * from bass2.dw_res_ctms_exchg_20111127
   
   
   select time_id,sum(bigint(CANCEL_CNT)),sum(bigint(QRY_CNT)) , sum(bigint(CANCEL_CNT))*1.00/sum(bigint(QRY_CNT))
from G_S_22080_DAY
group by time_id 
order by 1 desc 



delete from   G_A_01007_DAY where time_id = 20111129


select RELA_STATE , count(0) 
--,  count(distinct RELA_STATE ) 
from G_A_01007_DAY  where  time_id = 20111129
group by  RELA_STATE 
order by 1 


select count(0) from   bass2.dw_ent_group_relation_20111129 



select count(0) ,count(0) from   G_A_01006_DAY 

select * from   G_A_01006_DAY
fetch first 10 rows only 


select 
INDUSTRY_CODE,INDUSTRY_CODE2,ESP_INDUSTRY,ESP_INDUSTRY2,ESP_INDUSTRY3
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117


select * from    bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
fetch first 10 rows only 




select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01007_DAY 
group by  time_id 
order by 1 

TIME_ID	2
20101115	1071
20101118	3525
20110531	7863

select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01006_DAY 
group by  time_id 
order by 1 

TIME_ID	2
20101115	12250
20101118	3525

select distinct ENTERPRISE_ID 
from G_A_01007_DAY
except
select distinct ENTERPRISE_ID 
from G_A_01006_DAY

  

select * from   G_A_01007_DAY
where enterprise_id = '519155287'



TIME_ID	2
20101115	12250
20101118	3525

TIME_ID	2
20101115	1071
20101118	3525
20110531	7863



select distinct ENTERPRISE_ID 
from G_A_01007_DAY
except
select distinct ENTERPRISE_ID 
from G_A_01006_DAY

select qd_group_id from bass2.dw_ent_group_relation_20111129 
except
select GROUP_CUST_ID
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 

select  PRACTICE2,count(0)
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 
group by PRACTICE2


select * from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 
where MANAGE_EARNING is null


select GROUP_CUST_ID,addr,cust_name,STAFF_AMOUNT from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129




select 
        GROUP_CUST_ID ENTERPRISE_ID
        ,value(CUST_NAME,'未知') ENTERPRISE_NAME
        ,value(ORGAN_TYPE,'90') ORG_TYPE
        ,value(ADDR,'540102') ADRESS_CODE
        ,value(GROUP_CITY,'') CITY_ID
        ,value(EXT_FIELD3,'') COUNTY_CODE
        ,value(VILLAGE,'') THORPE_CODE
        ,value(DOORPLATE,'')  DOORPLATE
        ,value(AREA_CODE,'') DISTRICT_NUM
        ,value(PHONE,'') TELEPHONE1
        ,value(PHONE2,'') TELEPHONT2
        ,value(char(POST_POSTCODE),'') POST_CODE
        ,value(VOCATION4_EXT,'0111') INDUSTRY_ID
        ,value(char(GROUP_MEMBER_NUM),'1') STAFF_CNT
        ,value(char(INDUSTRY_NUM),'0') UNIT_CNT
        ,case when ECONOMY_TYPE2 = '161' then '160' 
             when ECONOMY_TYPE2 = '191' then '190' else ECONOMY_TYPE2 end  ECONOMY_TYPE
        ,value(case when PRACTICE1 < '1900' then '2000' else PRACTICE1 end,'2011')  OPEN_YEAR
        ,value(case when PRACTICE2 >= '10' then PRACTICE2 else '0'||trim(PRACTICE2) end,'01')  OPEN_MONTH
        ,value(control,'1')  HOLDING_TYPE
        ,value(GROUP_TYPE_EXT,'1') ENTERPRISE_TYPE
        ,value(MANAGE_FORMAT,'9') OPERATE_TYPE
	,value(MANAGE_EARNING,'02') INCOMING_TYPE
        ,value(EXT_FIELD1,'02') FUNDS_TYPE
        ,case when GROUP_STATES = '10' then '12' when GROUP_STATES = '30' then '36' else GROUP_STATES end  STATE
        ,value(replace(char(CREATE_DATE),'-',''),'$timestamp') CREATE_DATE
        ,'2' SOURCE
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36','10','30')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and value(control,'1')  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
,'161','191'
)
and VOCATION4_EXT in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')



select  ECONOMY_TYPE2,count(0)
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 
group by ECONOMY_TYPE2

select count(0)
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36','10','30')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and value(control,'1')  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340')


select   length(char(POST_POSTCODE)) ,count(0)
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where
    GROUP_CUST_ID is not null 
and GROUP_STATES   in ('11','12','20','31','32','33','34','35','36','10','30')
and ECONOMY_TYPE2  not in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340')
group by  length(char(POST_POSTCODE)) 


select  ORGAN_TYPE,count(0)
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where PRACTICE2 in ('1','2','3','4','5','6','7','8','9','10','11','12')
group by ORGAN_TYPE

select * from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where GROUP_CUST_ID ='DX0207399'





select count(0) from G_A_01006_DAY
where time_id = 20111129




select * from bass2.dw_ent_group_relation_20111129



select distinct 
        20111129 time_id
        ,GROUP_CUST_ID ENTERPRISE_ID
        ,value(substr(CUST_NAME,1,60),'未知') ENTERPRISE_NAME
        ,value(ORGAN_TYPE,'90') ORG_TYPE
        ,value(trim(ADDR),'540102') ADRESS_CODE
        ,value(GROUP_CITY,'') CITY_ID
        ,value(EXT_FIELD3,'') COUNTY_CODE
        ,value(VILLAGE,'') THORPE_CODE
        ,value(substr(DOORPLATE,1,60),'')  DOORPLATE
        ,value(AREA_CODE,'') DISTRICT_NUM
        ,'' TELEPHONE1 --value(PHONE,'')
        ,'' TELEPHONT2 --value(PHONE2,'')
        ,value(substr(char(POST_POSTCODE),1,6),'') POST_CODE
        ,value(VOCATION4_EXT,'0111') INDUSTRY_ID
        ,value(char(GROUP_MEMBER_NUM),'1') STAFF_CNT
        ,value(char(INDUSTRY_NUM),'0') UNIT_CNT
        ,case when ECONOMY_TYPE2 = '161' then '160' 
             when ECONOMY_TYPE2 = '191' then '190' else ECONOMY_TYPE2 end  ECONOMY_TYPE
        ,value(case when PRACTICE1 < '1900' then '2000' else PRACTICE1 end,'2011')  OPEN_YEAR
        ,value(case when PRACTICE2 >= '10' then PRACTICE2 else '0'||trim(PRACTICE2) end,'01')  OPEN_MONTH
        ,value(control,'1')  HOLDING_TYPE
        ,value(GROUP_TYPE_EXT,'1') ENTERPRISE_TYPE
        ,value(MANAGE_FORMAT,'9') OPERATE_TYPE
        ,value(MANAGE_EARNING,'02') INCOMING_TYPE
        ,value(EXT_FIELD1,'02') FUNDS_TYPE
        ,case when GROUP_STATES = '10' then '12' when GROUP_STATES = '30' then '36' else GROUP_STATES end  STATE
        ,value(replace(char(CREATE_DATE),'-',''),'20111129') CREATE_DATE
        ,'2' SOURCE
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 a
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36','10','30')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and value(control,'1')  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
,'161','191'
)
and length(trim(addr)) = 6
and length(char(POST_POSTCODE)) = 6
and VOCATION4_EXT in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')
with ur




select distinct 
        20111129 time_id
        ,GROUP_CUST_ID ENTERPRISE_ID
        ,value(substr(CUST_NAME,1,60),'未知') ENTERPRISE_NAME
        ,value(ORGAN_TYPE,'90') ORG_TYPE
        ,value(trim(ADDR),'540102') ADRESS_CODE
        ,value(GROUP_CITY,'') CITY_ID
        ,value(EXT_FIELD3,'') COUNTY_CODE
        ,value(substr(VILLAGE,1,20),'') THORPE_CODE
        ,value(substr(DOORPLATE,1,60),'')  DOORPLATE
        ,value(AREA_CODE,'') DISTRICT_NUM
        ,'' TELEPHONE1 --value(PHONE,'')
        ,'' TELEPHONT2 --value(PHONE2,'')
        ,'' POST_CODE --value(substr(char(POST_POSTCODE),1,6),'')
        ,value(VOCATION4_EXT,'0111') INDUSTRY_ID
        ,value(char(GROUP_MEMBER_NUM),'1') STAFF_CNT
        ,value(char(INDUSTRY_NUM),'0') UNIT_CNT
        ,case when ECONOMY_TYPE2 = '161' then '160' 
             when ECONOMY_TYPE2 = '191' then '190' else ECONOMY_TYPE2 end  ECONOMY_TYPE
        ,value(case when PRACTICE1 < '1900' then '2000' else PRACTICE1 end,'2011')  OPEN_YEAR
        ,value(case when PRACTICE2 >= '10' then PRACTICE2 else '0'||trim(PRACTICE2) end,'01')  OPEN_MONTH
        ,value(control,'1')  HOLDING_TYPE
        ,value(GROUP_TYPE_EXT,'1') ENTERPRISE_TYPE
        ,value(MANAGE_FORMAT,'9') OPERATE_TYPE
        ,value(MANAGE_EARNING,'02') INCOMING_TYPE
        ,value(EXT_FIELD1,'02') FUNDS_TYPE
        ,case when GROUP_STATES = '10' then '12' when GROUP_STATES = '30' then '36' else GROUP_STATES end  STATE
        ,value(replace(char(CREATE_DATE),'-',''),'20111129') CREATE_DATE
        ,'2' SOURCE
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129 a
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36','10','30')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and value(control,'1')  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
,'161','191'
)
and length(trim(addr)) = 6
and VOCATION4_EXT in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')
with ur

delete from G_A_01006_DAY
where time_id = 20111129


select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01007_DAY 
group by  time_id 
order by 1 



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_A_01006_DAY 
group by  time_id 
order by 1 



select * from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where GROUP_STATES not in ('11','12','20','31','32','33','34','35','36')
or MANAGE_FORMAT not in ('1','2','3','9')
or control not in ('1','2','3','4','5','9')
or MANAGE_EARNING is null
or  ECONOMY_TYPE2 not in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
,'161','191'
)
or length(trim(addr)) <> 6
or length(trim(AREA_CODE)) > 5
or  VOCATION4_EXT not in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')
fetch first 10 rows only 



select count(0) from bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
20095
select count(0) from  bass2.dw_ent_group_relation_20111129 

select qd_group_id
from  bass2.dw_ent_group_relation_20111129 
except
select 
        GROUP_CUST_ID ENTERPRISE_ID
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_20111129
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and control  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
)
and VOCATION4_EXT in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')


select time_id,count(0) from bass1.g_user_lst
group by time_id 
order by 1 desc 


select * from bass1.mon_all_interface
where type = 'd'
d	22066	电子渠道关键数据日汇总	每日新增	每日13点前	13	0	1	1.7.3

insert into bass1.mon_all_interface
select 'd','22047','手机充值卡缴费日汇总','每日新增','每日13点前',13,0,1,'1.7.4' from bass2.dual


select 
                     substr(sp_code,1,12)
                     ,value(substr(oper_code,1,10),'0')
                     ,substr(ser_code,1,21)
                   from 
                     bass2.cdr_ismg_dtl_20111031
                   where drtype_id<>61102 
                   and process_time is not null 
                   and substr(sp_code,1,12) is not null
                   and svcitem_id in (300001,300002,300003,300004) 
                   


   select time_id/100,sum(bigint(CANCEL_CNT)),sum(bigint(QRY_CNT)) , sum(bigint(CANCEL_CNT))*1.00/sum(bigint(QRY_CNT))
from G_S_22080_DAY
group by time_id /100
order by 1 desc 
                   
                   

   select time_id,sum(bigint(CANCEL_CNT)),sum(bigint(QRY_CNT)) , sum(bigint(CANCEL_CNT))*1.00/sum(bigint(QRY_CNT))
from G_S_22080_DAY
group by time_id 
order by 1 desc 
                   
                   



select 
                     *
                   from 
                     bass2.cdr_ismg_dtl_20111031
                   where  product_no= '15089051890'
                   fetch first 100 rows only
                   
                   
                   


select 
                     *
                   from 
                     bass2.cdr_ismg_dtl_20111031
                   where drtype_id<>61102 
                   and process_time is not null 
                   and substr(sp_code,1,12) is not null
                   and svcitem_id in (300001,300002,300003,300004) 
                   and substr(ser_code,1,21) = ''
                   fetch first 100 rows only

89160001442654	-1	89160001504814	13648919128	1066828288010042	891	1082	4	89140007	5103	50005	1	300001	0	0	0	901748			-1	0	0	0	13800891500	089101	001010	2011-10-30 23:51:46.000000	2011-10-31 0:00:57.000000	[NULL]	2	460008901428117	[NULL]	1	0.00	0.00	0.00	0.00	0.00	0.10	0.00	0.00	0.00	0.00	0.00	0.00




cdr_ismg_


select 
                     *
                   from 
                     bass2.cdr_ismg_20111031
                                fetch first 100 rows only
                   where drtype_id<>61102 
                   --and process_time is not null 
                   --and sp_code is not null
and user_id = '89160001442654'
and opp_number = '1066828288010042'
                   fetch first 100 rows only




                   
                   


                   from 
                     bass2.cdr_sms_20111130
                   where drtype_id<>61102 
                   --and process_time is not null 
                   --and substr(sp_code,1,12) is not null
                   --and svcitem_id in (300001,300002,300003,300004) 
                   --and substr(ser_code,1,21) = ''
                   fetch first 100 rows only
                   


select * from bass2.dim_dr_type                   
where drtype_id=5103 or drtype_id=1222

select * from bass2.cdr_sms_20111101
where drtype_id=5103 or drtype_id=1222

                   fetch first 100 rows only

select * from bass2.dw_product_td_20111209
fetch first 10 rows only

select 
td_call_mark 
  , td_gprs_mark
 , td_addon_mark
 ,count(0)
from bass2.dw_product_td_20111209
where user_id in (


select distinct user_id from bass2.dw_product_td_20111209
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9)
  and test_mark=0
  except
  select distinct user_id from bass2.dw_product_td_20111208
where (td_call_mark =1
  or td_gprs_mark =1
  or td_addon_mark=1
  )
  and userstatus_id in (1,2,3,6,8)
  and usertype_id in (1,2,9)
  and test_mark=0
  )
  group by 
  td_call_mark 
  , td_gprs_mark 
 , td_addon_mark
 
 
 select count(0),count(distinct user_id),sum(call_duration_m) call_duration_m from bass2.dw_call_20111209
where MNS_TYPE=1

1	2	CALL_DURATION_M
154383	22534	486251

 select count(0),count(distinct user_id),sum(call_duration_m) call_duration_m from bass2.dw_call_20111208
where MNS_TYPE=1

1	2	CALL_DURATION_M
119484	20020	382601

select *
from bass2.dw_call_20111208
where MNS_TYPE=1
fetch first 10 rows only

select * from bass2.map_pub_brand\


 select CREATE_DATE
 --,crm_brand_name1,crm_brand_name2
 ,count(0)
 from bass2.dw_product_td_20111209 a
 , bass2.map_pub_brand b where 
 a.CRM_BRAND_ID1 = b.CRM_BRAND_ID1
 and a.CRM_BRAND_ID2 = b.CRM_BRAND_ID2
  and (td_call_mark =1
                            or td_gprs_mark =1
                            or td_addon_mark=1)
 and userstatus_id in (1,2,3,6,8) 
 and usertype_id in (1,2,9)
 and test_mark=0 
 and CREATE_DATE >= '2011-12-01'
 group by CREATE_DATE
 --,crm_brand_name1,crm_brand_name2
 
  
 
 
 
select count(0) val1 
from (  
select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
from bass1.g_s_04017_day
where time_id/100=201111 and mns_type='1'
group by product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID 
except
select product_no,ROAM_TYPE_ID,TOLL_TYPE_ID,CALL_TYPE_ID
from bass1.g_s_21003_month
where time_id=201111 and mns_type='1'
) M
with ur


select count(0) from 
bass1.g_s_21003_month
where time_id=201111

16267761




select * from  table( bass1.get_before('21003')) a 


select * from 
bass1.G_S_04015_DAY where time_id = 20111221



select time_id , count(0) 
--,  count(distinct time_id ) 
from G_S_04015_DAY 
group by  time_id 
order by 1 



select
                           20111222
                           ,char(FEETYPE_ID)  
                           ,ltrim(rtrim(PRODUCT_NO))
                           ,value(ltrim(rtrim(REV_PRODUCT_NO)),' ')
                           ,value(SP_CODE, ' ')
                           ,value(SP_SVC_CODE,' ')
                           ,case when customize_way_code in ('1','2','3','4','5') then customize_way_code
                            else '6' end customize_way_code
                           ,value(IN_PRODUCT_NO,' ')
                           ,value('20111222'||substr(BEGIN_TIME,9),' ')
                           ,value('20111222'||substr(END_TIME,9),' ')
                           ,value(char(FEE),'0')
                           ,value(char(BUSITYPE_ID),' ')
                           ,value(substr(replace(replace(char(CDR_TIMES),'-',''),'.',''),1,14),' ')
                           ,value(RING_ID,' ')                        
                        from 
                          bass2.DWD_MR_OPER_CDR_20111221
                          
                          
                          

 select
                           20111222
                           ,char(FEETYPE_ID)  
                           ,ltrim(rtrim(PRODUCT_NO))
                           ,value(ltrim(rtrim(REV_PRODUCT_NO)),' ')
                           ,value(SP_CODE, ' ')
                           ,value(SP_SVC_CODE,' ')
                           ,case when customize_way_code in ('1','2','3','4','5') then customize_way_code
                            else '6' end customize_way_code
                           ,value(IN_PRODUCT_NO,' ')
                           ,value('20111222'||substr(BEGIN_TIME,9),' ')
                           ,value(END_TIME,' ')
                           ,value(char(FEE),'0')
                           ,value(char(BUSITYPE_ID),' ')
                           ,value(substr(replace(replace(char(CDR_TIMES+1 days),'-',''),'.',''),1,14),' ')
                           ,value(RING_ID,' ')                        
                        from 
                          bass2.DWD_MR_OPER_CDR_20111221



delete from bass1.G_S_04015_DAY where time_id = 20111222
insert into bass1.G_S_04015_DAY
                           (
                             TIME_ID           ,
                             BILL_TYPE         ,
                             PRODUCT_NO        ,
                             PRTY_CODE         ,
                             SP_ID             ,
                             SERV_CODE         ,                             
                             CUSTOM_CHNL       ,                             
                             MEET_NUM          ,                             
                             PREZENT_BEGIN_TIME,
                             PREZENT_END_TIME  ,                             
                             FEE_AMT           ,                             
                             BUSI_TYPE         ,
                             DEAL_TIME         ,
                             CUST_CONTE         
                           )
                         select
                           20111222
                           ,char(FEETYPE_ID)  
                           ,ltrim(rtrim(PRODUCT_NO))
                           ,value(ltrim(rtrim(REV_PRODUCT_NO)),' ')
                           ,value(SP_CODE, ' ')
                           ,value(SP_SVC_CODE,' ')
                           ,case when customize_way_code in ('1','2','3','4','5') then customize_way_code
                            else '6' end customize_way_code
                           ,value(IN_PRODUCT_NO,' ')
                           ,value('20111222'||substr(BEGIN_TIME,9),' ')
                           ,value(END_TIME,' ')
                           ,value(char(FEE),'0')
                           ,value(char(BUSITYPE_ID),' ')
                           ,value(substr(replace(replace(char(CDR_TIMES+1 days),'-',''),'.',''),1,14),' ')
                           ,value(RING_ID,' ')                        
                        from 
                          bass2.DWD_MR_OPER_CDR_20111221
fetch first 5630 rows only 

select * from   app.sch_control_runlog 
where control_code like '%04015%'                        
                          
update app.sch_control_runlog 
set BEGINTIME = BEGINTIME +1 days
where control_code = 'BASS1_G_S_04015_DAY.tcl'

                          
update app.sch_control_runlog 
set ENDTIME = ENDTIME +1 days
where control_code = 'BASS1_G_S_04015_DAY.tcl'


BASS1_G_S_04015_DAY.tcl	2011-12-22 5:51:21.438135	2011-12-22 5:51:38.738802	17	0


CONTROL_CODE	BEGINTIME	ENDTIME	RUNTIME	FLAG
BASS1_G_S_04015_DAY.tcl	2011-12-22 5:51:21.438135	2011-12-22 5:51:38.738802	17	0
BASS1_EXP_G_S_04015_DAY	2011-12-22 7:55:04.570476	2011-12-22 7:55:34.334716	29	0


                          
                          select message_id, send_time,mobile_num,message_content from   APP.SMS_SEND_INFO
where send_time is not null
and mobile_num in ( '15913269062','13989007120')
and date(send_time) = date('2011-12-03')
and message_content like '%BASS1_INT_CHECK_TD_MONTH.tcl%'
order by send_time desc



select CUSTCLASS_ID , count(0) 
--,  count(distinct CUSTCLASS_ID ) 
from G_I_02005_MONTH 
group by  CUSTCLASS_ID 
order by 1 





select * from bass1.g_s_04002_day_td
where product_no = '13618963711'/