######################################################################################################
#接口名称：清单集团客户
#接口编码：01006
#接口说明： 
#程序名称: G_A_01006_DAY.tcl
#功能描述: 生成01006的数据
#运行粒度: 日
#源    表 
#输入参数: 
#输出参数: 返回值:0 成功;-1 失败  
#编 写 人：liuzhilong
#编写时间：2010-11-9 16:05:01
#问题记录：
#修改历史: 
#  2011.11.30   boss数据源有所完善，增补上报此接口数据,涉及字段较多，编码转换也很多，容易违反校验，暂缓上报。
#######################################################################################################
proc Deal { op_time optime_month province_id redo_number trace_fd bass1_dir temp_data_dir semi_data_dir final_data_dir conn conn_ctl src_data obj_data final_data } {

    #本月 yyyymm
    set op_month [string range $optime_month 0 3][string range $optime_month 5 6]   
    set timestamp [string range $op_time 0 3][string range $op_time 5 6][string range $op_time 8 9]

    set sql_buff "DELETE FROM bass1.G_A_01006_DAY where time_id=$timestamp"
    exec_sql $sql_buff

# 1. DW_ENT_CM_GROUP_CUSTOMER_EXT_20111117 此表很多属性都是空的，无法填写，只能写死一个值
#e.g. INDUSTRY_CODE,INDUSTRY_CODE2,ESP_INDUSTRY,ESP_INDUSTRY2,ESP_INDUSTRY3


 set sql_buff "
insert into G_A_01006_DAY
select distinct 
	$timestamp time_id
        ,GROUP_CUST_ID ENTERPRISE_ID
        ,value(substr(CUST_NAME,1,60),'未知') ENTERPRISE_NAME
        ,value(ORGAN_TYPE,'90') ORG_TYPE
        ,value(trim(ADDR),'540102') ADRESS_CODE
        ,value(GROUP_CITY,'') CITY_ID
        ,value(EXT_FIELD3,'') COUNTY_CODE
        ,value(substr(VILLAGE,1,20),'') THORPE_CODE
        ,value(substr(DOORPLATE,1,60),'')  DOORPLATE
        ,value(AREA_CODE,'') DISTRICT_NUM
        ,'' TELEPHONE1 --value(PHONE,'')
        ,'' TELEPHONT2 --value(PHONE2,'')
        ,'' POST_CODE --value(substr(char(POST_POSTCODE),1,6),'')
        ,value(VOCATION4_EXT,'0111') INDUSTRY_ID
        ,value(char(STAFF_AMOUNT),'1') STAFF_CNT
        ,value(char(INDUSTRY_NUM),'0') UNIT_CNT
        ,case when ECONOMY_TYPE2 = '161' then '160' 
             when ECONOMY_TYPE2 = '191' then '190' else ECONOMY_TYPE2 end  ECONOMY_TYPE
        ,value(case when PRACTICE1 < '1900' then '2000' else PRACTICE1 end,'2011')  OPEN_YEAR
        ,value(case when PRACTICE2 >= '10' then PRACTICE2 else '0'||trim(PRACTICE2) end,'01')  OPEN_MONTH
        ,value(control,'1')  HOLDING_TYPE
        ,value(GROUP_TYPE_EXT,'1') ENTERPRISE_TYPE
        ,value(MANAGE_FORMAT,'9') OPERATE_TYPE
	,value(MANAGE_EARNING,'02') INCOMING_TYPE
        ,value(EXT_FIELD1,'02') FUNDS_TYPE
        ,case when GROUP_STATES = '10' then '12' when GROUP_STATES = '30' then '36' else GROUP_STATES end  STATE
        ,value(replace(char(CREATE_DATE),'-',''),'$timestamp') CREATE_DATE
        ,'2' SOURCE
from  bass2.DW_ENT_CM_GROUP_CUSTOMER_EXT_$timestamp a
where
    GROUP_CUST_ID is not null 
and GROUP_STATES in ('11','12','20','31','32','33','34','35','36','10','30')
and MANAGE_FORMAT in ('1','2','3','9')
and GROUP_TYPE_EXT in ('1','2')
and value(control,'1')  in ('1','2','3','4','5','9')
and MANAGE_EARNING between '01' and '22'
and EXT_FIELD1 between '01' and '14'
and PRACTICE2  in ('1','2','3','4','5','6','7','8','9','10','11','12')
and ECONOMY_TYPE2 in ( '110','120','130','141','142','143','149','151','159','160','171','172','173','174','190','210','220','230','240','310','320','330','340'
,'161','191'
)
and length(trim(addr)) = 6
and length(trim(AREA_CODE)) <= 5
and VOCATION4_EXT in
('0111','0112','0113','0114','0115','0116','0117','0118','0119','0121','0122','0123','0131','0132','0133','0140','0211','0212','0213','0221','0222','0230','0310','0320','0330','0340','0390','0411','0412','0421','0422','0511','0512','0519','0520','0531','0539','0540','0610','0620','0690','0710','0790','0810','0890','0911','0912','0913','0914','0915','0916','0917','0919','0921','0922','0929','0931','0932','0933','0939','1011','1012','1013','1019','1020','1030','1091','1092','1093','1099','1100','1310','1320','1331','1332','1340','1351','1352','1361','1362','1363','1364','1369','1370','1391','1392','1393','1399','1411','1419','1421','1422','1431','1432','1439','1440','1451','1452','1453','1459','1461','1462','1469','1491','1492','1493','1494','1499','1510','1521','1522','1523','1524','1529','1531','1532','1533','1534','1535','1539','1540','1610','1620','1690','1711','1712','1721','1722','1723','1730','1741','1742','1743','1751','1752','1753','1754','1755','1756','1757','1759','1761','1762','1763','1769','1810','1820','1830','1910','1921','1922','1923','1924','1929','1931','1932','1939','1941','1942','2011','2012','2021','2022','2023','2029','2031','2032','2039','2040','2110','2120','2130','2140','2190','2210','2221','2222','2223','2231','2239','2311','2312','2319','2320','2330','2411','2412','2413','2414','2419','2421','2422','2423','2424','2429','2431','2432','2433','2439','2440','2451','2452','2511','2512','2520','2530','2611','2612','2613','2614','2619','2621','2622','2623','2624','2625','2629','2631','2632','2641','2642','2643','2644','2645','2651','2652','2653','2659','2661','2662','2663','2664','2665','2666','2667','2669','2671','2672','2673','2674','2679','2710','2720','2730','2740','2750','2760','2770','2811','2812','2821','2822','2823','2824','2829','2911','2912','2913','2920','2930','2940','2950','2960','2990','3010','3020','3030','3040','3050','3060','3070','3081','3082','3090','3111','3112','3121','3122','3123','3124','3129','3131','3132','3133','3134','3135','3139','3141','3142','3143','3144','3145','3146','3147','3148','3149','3151','3152','3153','3159','3161','3162','3169','3191','3199','3210','3220','3230','3240','3311','3312','3313','3314','3315','3316','3317','3319','3321','3322','3329','3331','3332','3339','3340','3351','3352','3353','3411','3412','3421','3422','3423','3424','3429','3431','3432','3433','3440','3451','3452','3453','3459','3460','3471','3472','3479','3481','3482','3489','3491','3499','3511','3512','3513','3514','3519','3521','3522','3523','3524','3525','3529','3530','3541','3542','3543','3544','3551','3552','3560','3571','3572','3573','3574','3575','3576','3577','3579','3581','3582','3583','3589','3591','3592','3611','3612','3613','3614','3615','3621','3622','3623','3624','3625','3629','3631','3632','3633','3641','3642','3643','3644','3645','3646','3649','3651','3652','3653','3659','3661','3662','3663','3669','3671','3672','3673','3674','3675','3676','3679','3681','3682','3683','3684','3685','3686','3689','3691','3692','3693','3694','3695','3696','3697','3699','3711','3712','3713','3714','3719','3721','3722','3723','3724','3725','3726','3731','3732','3741','3742','3751','3752','3753','3754','3755','3759','3761','3762','3769','3791','3792','3799','3911','3912','3919','3921','3922','3923','3924','3929','3931','3932','3933','3939','3940','3951','3952','3953','3954','3955','3956','3957','3959','3961','3969','3971','3972','3979','3991','3999','4011','4012','4013','4014','4019','4020','4031','4032','4039','4041','4042','4043','4051','4052','4053','4059','4061','4062','4071','4072','4090','4111','4112','4113','4114','4115','4119','4121','4122','4123','4124','4125','4126','4127','4128','4129','4130','4141','4142','4151','4152','4153','4154','4155','4159','4190','4211','4212','4213','4214','4215','4216','4217','4218','4219','4221','4222','4229','4230','4240','4290','4310','4320','4411','4412','4413','4419','4420','4430','4500','4610','4620','4690','4710','4721','4722','4723','4724','4729','4800','4900','5010','5020','5090','5110','5120','5131','5132','5139','5210','5220','5231','5232','5239','5310','5320','5330','5340','5390','5411','5412','5413','5421','5422','5423','5431','5432','5439','5511','5512','5520','5531','5532','5539','5600','5710','5720','5810','5890','5910','5990','6011','6012','6019','6020','6031','6032','6040','6110','6120','6130','6190','6211','6212','6290','6311','6312','6313','6314','6319','6321','6322','6323','6324','6325','6326','6327','6329','6331','6332','6333','6334','6335','6339','6341','6342','6343','6344','6345','6346','6349','6351','6352','6353','6361','6362','6363','6364','6365','6366','6367','6368','6369','6371','6372','6373','6374','6375','6376','6379','6380','6391','6399','6511','6512','6519','6521','6522','6523','6524','6525','6526','6529','6531','6532','6533','6534','6535','6539','6541','6542','6543','6544','6545','6546','6547','6548','6549','6551','6552','6561','6562','6563','6564','6571','6572','6573','6579','6581','6582','6583','6589','6591','6592','6593','6594','6595','6599','6610','6620','6690','6710','6720','6730','6790','6810','6820','6890','6910','6920','6930','6940','7010','7020','7030','7110','7120','7130','7140','7150','7190','7210','7220','7230','7290','7311','7312','7313','7314','7319','7321','7329','7411','7412','7419','7421','7422','7429','7431','7432','7433','7439','7440','7450','7460','7470','7480','7491','7492','7493','7494','7499','7510','7520','7530','7540','7550','7610','7620','7630','7640','7650','7660','7671','7672','7673','7690','7710','7720','7790','7811','7812','7819','7820','7830','7910','7921','7922','7929','7990','8011','8012','8019','8021','8022','8023','8024','8029','8110','8120','8131','8132','8139','8210','8220','8230','8240','8250','8260','8270','8280','8290','8311','8312','8313','8319','8321','8329','8390','8410','8420','8431','8432','8433','8434','8435','8439','8441','8442','8491','8492','8499','8511','8512','8513','8514','8515','8516','8520','8530','8540','8550','8560','8570','8590','8600','8711','8712','8720','8810','8821','8822','8823','8824','8825','8829','8910','8920','8931','8932','8940','9010','9020','9031','9032','9040','9050','9060','9070','9080','9090','9110','9120','9190','9210','9220','9230','9290','9300','9410','9421','9422','9423','9424','9425','9426','9427','9431','9432','9490','9510','9520','9611','9612','9613','9619','9621','9622','9629','9630','9710','9720','9800')
with ur
"
#    exec_sql $sql_buff
#数据源问题    
#1.GROUP_CUST_ID 有个人客户编码
#2.AREA_CODE 编码格式不一
#3.VOCATION4_EXT 有非法编码 
#4.STAFF_AMOUNT 有为空的
#5.ECONOMY_TYPE2  有非法编码
#6.PRACTICE1，PRACTICE2 编码非法
#7.GROUP_STATES 有非法编码 

#	
#	VOCATION4_EXT
#	
#	
#	GROUP_STATES
#	10 30 
#	ECONOMY_TYPE2
#	161 191
#	
#	fetch first 10 rows only 
#	
#	"控股情况：
#	1-国有
#	2-集体
#	3-私人
#	4-港澳台
#	5-外商
#	9-其他"
#	
#  staff_cnt 
#.....
#集团客户状态：
#10-潜在
# 11-离网
# 12-未入网
#20-在网
#30-无效集团
#31-已破产
#32-被兼并
#33-企业迁移外地
#34-已结业
#35-个体户、聚类集团
#36-其他
#维值10、30为大类，不能填写
#

 
 
           
##	set sql_buff "DELETE FROM bass1.G_A_01006_DAY where time_id=$op_month"
##	puts $sql_buff
##    exec_sql $sql_buff
##
##
##
##	set sql_buff "insert into bass1.G_A_01006_DAY
##
##	              "
##
##  puts $sql_buff
##  exec_sql $sql_buff
##

	return 0
}
